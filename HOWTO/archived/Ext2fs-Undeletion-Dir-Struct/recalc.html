<HTML
><HEAD
><TITLE
>Recalculation</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.57"><LINK
REL="HOME"
TITLE="Ext2fs Undeletion of Directory Structures mini-HOWTO"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="Adding directory entries"
HREF="add.html"><LINK
REL="NEXT"
TITLE="If /lost+found not empty"
HREF="lostnfnd.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Ext2fs Undeletion of Directory Structures mini-HOWTO</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="add.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="lostnfnd.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="RECALC"
>9. Recalculation</A
></H1
><P
>      Now it is time to call <I
CLASS="EMPHASIS"
>e2fsck</I
> to recalculate the
      sizes and checksums.
    </P
><DIV
CLASS="NOTE"
><BLOCKQUOTE
CLASS="NOTE"
><P
><B
>Note: </B
>        I am using <I
CLASS="EMPHASIS"
>e2fsck</I
> version 1.18 and if you have
        another version you should check if some parameters or interaction have
        changed.
      </P
></BLOCKQUOTE
></DIV
><P
>      If you know that you do <I
CLASS="EMPHASIS"
>not</I
> have any files with the
      size of zero that you want to recover you can do the following and skip
      the rest of this section (Of course you can leave out the
      <I
CLASS="EMPHASIS"
>y</I
> parameter, but then you need to answer all
      questions by hand and it may take a lot of time.).
    </P
><P
>      <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>        # e2fsck -f -y /dev/hdy1 &#62; e2fsck.out 2&#62;&#38;1</PRE
></TD
></TR
></TABLE
>
    </P
><P
>      If you instead want the zero files back you have to answer
      <I
CLASS="EMPHASIS"
>no</I
> to all questions about clearing entries and
      <I
CLASS="EMPHASIS"
>yes</I
> to the other ones.
    </P
><P
>      Copy the following 7 lines into a file named "e2fsck-wrapper".
    </P
><P
>      <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>        #!/usr/bin/expect -f
        set timeout -1
        spawn /sbin/e2fsck -f $argv
        expect {
            "Clear&#60;y&#62;? " { send "n" ; exp_continue }
            "&#60;y&#62;? "      { send "y" ; exp_continue }
        }</PRE
></TD
></TR
></TABLE
>
    </P
><P
>      Run the script.
    </P
><P
>      <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>        # ./e2fsck-wrapper /dev/hdy1 &#62; e2fsck.out 2&#62;&#38;1</PRE
></TD
></TR
></TABLE
>
    </P
><P
>      Examine "e2fsck.out" to see what <I
CLASS="EMPHASIS"
>e2fsck</I
> thought about
      your partition.
    </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="add.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="lostnfnd.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Adding directory entries</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>If /lost+found not empty</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>