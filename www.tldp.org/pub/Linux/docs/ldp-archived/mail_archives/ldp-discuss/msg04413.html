<!-- MHonArc v2.5.0b2 -->
<!--X-Subject: (Fwd) question about serial port programming -->
<!--X-From-R13: "Uert Trethfba" <tsretNubbc.gvzbavhz.ftv.pbz> -->
<!--X-Date: Mon, 13 Nov 2000 18:00:50 &#45;0500 (EST) -->
<!--X-Message-Id: 10011131800.ZM1422@hoop.timonium.sgi.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML//EN">
<html>
<head>
<title>(Fwd) question about serial port programming</title>
<link rev="made" href="mailto:gferg@hoop.timonium.sgi.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg04412.html">Date Prev</a>][<a href="msg04414.html">Date Next</a>][<a href="msg04412.html">Thread Prev</a>][<a href="msg04421.html">Thread Next</a>][<a href="maillist.html#04413">Date Index</a>][<a href="threads.html#04413">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>(Fwd) question about serial port programming</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: <A HREF="mailto:ldp-discuss@lists.linuxdoc.org">ldp-discuss@lists.linuxdoc.org</A></li>
<li><em>Subject</em>: (Fwd) question about serial port programming</li>
<li><em>From</em>: &quot;Greg Ferguson&quot; &lt;<A HREF="mailto:gferg@hoop.timonium.sgi.com">gferg@hoop.timonium.sgi.com</A>&gt;</li>
<li><em>Date</em>: Mon, 13 Nov 2000 18:00:55 -0500</li>
<li><em>Cc</em>: <A HREF="mailto:Dan_Wu@3com.com">Dan_Wu@3com.com</A></li>
<li><em>Resent-date</em>: Mon, 13 Nov 2000 18:00:50 -0500 (EST)</li>
<li><em>Resent-from</em>: <A HREF="mailto:ldp-discuss@lists.debian.org">ldp-discuss@lists.debian.org</A></li>
<li><em>Resent-message-id</em>: &lt;u54SH.A.JCF.ANHE6@murphy&gt;</li>
<li><em>Resent-sender</em>: <A HREF="mailto:ldp-discuss-request@lists.debian.org">ldp-discuss-request@lists.debian.org</A></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>
Can someone assist Dan Wu? Please respond directly to
him (Dan_Wu@3com.com)

thanks,
Ferg


--- Forwarded mail from Dan_Wu@3com.com

From: Dan_Wu@3com.com
To: linux-howto@sunsite.unc.edu
Date: Mon, 13 Nov 2000 16:18:27 -0600
Subject: question about serial port programming


Dear Linux HOWTO coordinator,

       The email below was sent to Peter Baumann who wrote the
  serial-programming-howto posted on your web site, but it was
  returned because the email address he put in the article is
  not right. Can you find his correct address for me, or forward
  this email to some other experts in serial port programming?
  Thanks a lot.

Regards,
Dan Wu


Hello, Peter,

     I read your article posted on redhat web site about the serial port
programming. I wonder if you can answer my question if you have some time.

     There're serial cables connecting the serial ports and modems
directly.
There's bi-directional data transfer between the modem and the PC. The max
speed
for the modem is 14.4kbps, the modem sends out the data (to another
device)
slowlier than it receives data from the PC. So I enable the hardware flow
control on the serial port and the modem, in order for the data flow from
PC to
the modem to go through correctly. The flow control does work, and the
data
transfer from PC to modem direction has no problem, however it looks when
flow
control kicks in, the data transfer from modem to PC direction is affected
and
around 200 bytes of data will get lost. If I do one-way transfer only,
modem to
PC direction won't have any problem. It didn't have any problem either
before I
enabled flow control on the serial port. My question is: How does the flow
control affect the data flow from modem to PC? Is the data in the PC's
receive
buffer flushed when flow control kicks in?  Below is my code, can you see
anything wrong? Or any flag missing?
I would appreciate your kind help very much. Look forward to your earliest
reply.

Sincerely,
Dan Wu

             // Setup serial connection with all devices.
        for( i = 0; i &lt; num_devs; i++ )
        {
                // Assemble device path from dev parameter and open
device.
                sprintf( dev_path, &quot;/dev/ttyD%d&quot;, i );
                fd = open( dev_path, O_RDWR | O_NOCTTY );
                if( fd &lt; 0 )
                {
                        pError( &quot;Unable to open device %s\n&quot;, dev_path );
                }
                else
                {
                        // Configure serial port using termios struct.
                        termios_buf.c_lflag &amp;= ~(ECHO | ICANON | IEXTEN |
ISIG);
                        termios_buf.c_iflag &amp;= ~(ECHO | ICANON | IEXTEN |
ISIG);

                        termios_buf.c_oflag &amp;= ~(ECHO | ICANON | IEXTEN |
ISIG);

                        termios_buf.c_cflag &amp;= ~(ICANON );
                        termios_buf.c_iflag &amp;= ~(BRKINT | ICRNL |IGNCR|
INPCK
|ISTRIP | IXON);
                        termios_buf.c_cflag &amp;= ~(CSIZE | PARENB );
                        termios_buf.c_cflag |= CS8;
                //      termios_buf.c_lflag |= NOFLSH;
                        termios_buf.c_cflag |= CRTSCTS;  /* enable
hardware flow
 control */

                        termios_buf.c_cflag &amp;= ~(HUPCL);
                        termios_buf.c_oflag &amp;= ~(OPOST);        /* add
ONLCR */
                        termios_buf.c_cc[VMIN] = 0;
                        termios_buf.c_cc[VTIME] = 20;
                        if( cfsetispeed( &amp;termios_buf, B57600 ) &lt; 0 )
                        {
                                pError( &quot;Cannot set ispeed for %s\n&quot;,
dev_path
);
                                return;
                        }
                        if( cfsetospeed( &amp;termios_buf, B57600 ) &lt; 0 )
                        {
                                pError( &quot;Cannot set ospeed for %s\n&quot;,
dev_path
);
                                return;
                        }
                        if( tcsetattr( fd, TCSAFLUSH, &amp;termios_buf ) &lt; 0 )
                        {
                                pError( &quot;Cannot set termios structure for
%s\n&quot;,
 dev_path );
                                return;
                        }
                        if( tcflush( fd, TCIOFLUSH ) &lt; 0 )
                        //if( tcdrain( fd ) &lt; 0 )
                        {
                                pError( &quot;Error flushing I/O buffers,
errno=%d\n&quot;, errno );
                                return;
                        }

                        // If this far, serial connection is established.

                        //  Write modem configuration string to port.
                        char at_string[50];
                        // &amp;f1 sets modem to factory defaults with
hardware flow
 control.  Without hardware flow
                        // control, data will be corrupted.
                        // e0 turns modem command echo to DTE off.
                        // q0 forces modem to return command result codes
to
DTE.
                        // *v2=3 forces modem to always make an analog
outgoingcall.
                        strcpy( at_string, &quot;at&amp;f1eq*v2=3\r\n&quot; );
                        tprintf( &quot;writing modem configuration string %s to
device %d\n&quot;, at_string, i );
                        write( fd, at_string, strlen( at_string ) );

                }// else fd &lt; 0
        }//for


---End of forwarded mail from Dan_Wu@3com.com


--  
To UNSUBSCRIBE, email to ldp-discuss-request@lists.debian.org
with a subject of &quot;unsubscribe&quot;. Trouble? Contact listmaster@lists.debian.org

</pre>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg04412.html">NEW DEVELPMENT, TOWNHOUSESCALLED DEARFIELD, READING, PA., RT.724.</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg04414.html">Feedback</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg04412.html">NEW DEVELPMENT, TOWNHOUSESCALLED DEARFIELD, READING, PA., RT.724.</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg04421.html">Proposed Raw Socket Programming Howto</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#04413"><strong>Date</strong></a></li>
<li><a href="threads.html#04413"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
