<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
 <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <META NAME="GENERATOR" CONTENT="lfparser_2.50">
 <META NAME="LFCATEGORY" CONTENT="UNIXBasics">
 <link rel="icon" href="../../common/images/lf-16.png" type="image/png">
 <TITLE>lf349, UNIXBasics: The mystery of mount points</TITLE>
<style type="text/css">
<!--
 td.top {font-family: Arial,Geneva,Verdana,Helvetica,sans-serif; font-size:12 }
 pre { font-family:monospace,Courier }
 pre.code { font-family:monospace,Courier;background-color:#aedbe8; }
 p.cl { color:#EE9500 }
 table.left { margin-right:0.3cm }
 a.nodec { text-decoration:none }
 p.trans { font-size:8pt; text-align:right }
 p.clbox { width:50%; alignment:center; background-color:#FFD700; 
           border-style:none; border-width:medium; border-color:#FFD700; 
           padding:0.5cm;  text-align:center }
 p.code { width:80%; alignment:center; background-color:#aedbe8; 
          border-style:none; border-width:medium; border-color:#aedbe8; 
          padding:0.1cm;  text-align:left }
 p.foot { background-color:#AAAAAA; color:#FFFFFF; border-style:none; 
          border-width:medium; border-color:#AAAAAA; padding:0.5cm ; 
          margin-top:0.1cm; margin-right:1cm; margin-left:1cm; 
          text-align:center }
 div.tbbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   margin: 2px 5px 2px 5px;
   text-align: center;
   width: 20em;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
 div.bbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   float: left;
   margin: 2px 5px 2px 5px;
   text-align: center;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
-->
</style>
 
</HEAD>
<BODY bgcolor="#ffffff" text="#000000">
 <!-- this is generated html code. NEVER use this file for your
 translation work. Instead get the file with the same article number
 and .meta.shtml in its name. Translate this meta file and then
 use lfparser program to generate the final article -->
 <!-- lfparser can be obtained from http://main.linuxfocus.org/~guido/dev/lfparser.html -->

<!-- this is used by a number of tools:
 =LF=AUTHOR: Guido Socher
 =LF=CAT___: UNIXBasics
 =LF=TITLE_: The mystery of mount points
 =LF=NUMBER: 349
 =LF=ANAME_: article349.shtml
 =LF=PARSER: 2.50
 -->

<!-- 2pdaIgnoreStart -->

<!-- start navegation bar, current, style=2 -->
 <!-- top navegation bar -->
 <TABLE summary="topbar_1" cellspacing="0" cellpadding="0" border="0" align="center" width="90%">
   <TR bgcolor="#2e2292">
     <TD class="top"><TABLE summary="topbar_1_logo" cellspacing="0" cellpadding="0" border="0" width=
       "100%">
         <TR><TD width="319"><a href="../../index.shtml"><IMG src="../../common/images/logolftop_319x45.gif"
           alt="[LinuxFocus-icon]" width="319" height="45" align="left" 
           border="0"></a></TD>

           <TD class="top">
             <TABLE summary="topbar_1_links" width="100%">
               <TR align="right">
                 <TD class="top">
                 
                 <A class="nodec" href="../../index.shtml"><FONT color=
                 "#DDDDDD" size="2">&lt;--</FONT></A> &nbsp;| 
                 <A class="nodec" href="../map.html"><FONT color=
                 "#DDDDDD" size="2">Map</FONT></A> &nbsp;| 
                 <A class="nodec" href="../indice.html"><FONT color=
                 "#DDDDDD" size="2">Index</FONT></A> &nbsp;| 
                 <A class="nodec" href="../Search/index.html"><FONT color=
                 "#DDDDDD" size="2">Search</FONT></A> </TD>
                 
               </TR>

               <TR align="right">
                 <TD class="top">
                   <HR width="100%" noshade size="1">
                 </TD>
               </TR>
             </TABLE>
           </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end top navegation bar -->
 <!-- blue bar -->
 <TABLE summary="topbar_2" cellspacing="0" cellpadding="0" border="0" align="center"
 width="90%">
   <TR bgcolor="#00ffff">
     <TD><IMG src="../../common/images/transpix.gif" width="1" height=
     "2" alt=""></TD>
   </TR>
 </TABLE>
 <!-- end blue bar -->
 <!-- bottom navegation bar -->
 <TABLE summary="topbar_3" cellspacing="0" cellpadding="0" border="0" align="center"
 width="94%">
   <TR bgcolor="#000000">
     <TD>
       <TABLE summary="topbar_3_links" cellspacing="0" cellpadding="1" border="0" width=
       "100%">
         <TR align="center">
           <TD WIDTH="20%"><A class="nodec" href="../News/index.html"><FONT color=
           "#FFFFFF">News</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Archives/index.html"><FONT color=
           "#FFFFFF">Archives</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Links/index.html"><FONT color=
           "#FFFFFF">Links</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../aboutus.html"><FONT color=
           "#FFFFFF">About LF</FONT></A> </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end bottom navegation bar -->
<!-- stop navegation bar -->

<!-- SSI_INFO -->

<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfdynahead ver 1.5 --><TABLE ALIGN="right" border=0><TR><TD ALIGN="right"><FONT SIZE="-1" FACE="Arial,Helvetica">This document is available in: <A href="../../English/September2004/article349.shtml">English</a> &nbsp;<A href="../../Castellano/September2004/article349.shtml">Castellano</a> &nbsp;<A href="../../ChineseGB/September2004/article349.shtml">ChineseGB</a> &nbsp;<A href="../../Deutsch/September2004/article349.shtml">Deutsch</a> &nbsp;<A href="../../Francais/September2004/article349.shtml">Francais</a> &nbsp;<A href="../../Italiano/September2004/article349.shtml">Italiano</a> &nbsp;<A href="../../Indonesian/September2004/article349.shtml">Indonesian</a> &nbsp;<A href="../../Russian/September2004/article349.shtml">Russian</a> &nbsp;<A href="../../Turkce/September2004/article349.shtml">Turkce</a> &nbsp;<A href="../../Polish/September2004/article349.shtml">Polish</a> &nbsp;</FONT></TD></TR></TABLE><br>
 


<!-- SSI_INFO STOP -->
<!-- 2pdaIgnoreStop -->

<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_START -->
<TABLE ALIGN="LEFT" BORDER="0" WIDTH="195" summary="about the author" class="left">
<TR>
<TD>

<img src="../../common/images/Guido-S.gif" alt=
    "[Photo of the Author]" height="164" width="173">
<BR>by  Guido Socher <a href="http://main.linuxfocus.org/%7Eguido/"><font size="1">(homepage)</font></a>
<BR><BR>
<I>About the author:</I><BR>
<!-- aboutauthor_start -->
<p>Guido likes Linux because of the community. It is a huge
    project and somehow all the different people around the world
    are working towards the same goal: Making it better every
    day.<br>
    Linux is unfortunately now so big that it attracts also the bad
    guys who just try to make profits and don't give anything back.
    Watch out! Often they appear to be small "pro-linux" businesses
    from the outside but they are just opportunistic.</p>
<!-- aboutauthor_stop -->
<!-- TRANSLATED_TO en -->
<!-- TRANSLATED_TO_STOP -->
<!-- INDEX_START -->
<BR><i>Content</i>:
<UL>
  <LI><A HREF="#349lfindex0">Introduction</A></LI>
  <LI><A HREF="#349lfindex1">How it works</A></LI>
  <LI><A HREF="#349lfindex2">The file-system busy problem</A></LI>
  <LI><A HREF="#349lfindex3">But windows can do it!?</A></LI>
  <LI><A HREF="#349lfindex4">Linux can do it too!</A></LI>
  <LI><A HREF="#349lfindex5">Allow anybody to mount a filesystem</A></LI>
  <LI><A HREF="#349lfindex6">Laptops and nfs</A></LI>
  <LI><A HREF="#349lfindex7">Conclusion</A></LI>
  <LI><A HREF="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=349">Talkback form for this article</A></LI>
</UL>

</TD></TR></TABLE>
<!-- INDEX_STOP -->
<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_STOP -->
<!-- HEAD_OF_THE_ARTICLE_START -->
<br>&nbsp;
<table border="0"><tr><td>
<H2>The mystery of mount points</H2>
 <img src="../../common/images2/illustration349.jpg" alt="mount"
    hspace="10">
<!-- ABSTRACT OF THE ARTICLE -->
<P><i>Abstract</i>:
<P>
<!-- articleabstract_start -->

    This article explains the concept of mount points but I hope
    the article has also some information which is interesting to
    readers who are not new to linux.

    
<!-- articleabstract_stop -->

<br><!-- HR divider --><center><font color="#8282e0"><b>_________________ _________________ _________________</b></font></center><br>
</td></tr></table>
<!-- HEAD_OF_THE_ARTICLE_STOP -->
<!-- BODY_OF_THE_ARTICLE_START -->


    <A NAME="349lfindex0">&nbsp;</A>
<H2>Introduction</H2>

    I will first explain the concept of mounting file-systems and
    then come to more advanced features. If you feel that you are
    already a Linux expert then you can start to read a bit further
    down.

    <A NAME="349lfindex1">&nbsp;</A>
<H2>How it works</H2>

    Under windows you have even until today the problem that adding
    a new drive will mess up all the naming conventions. What used
    to be D: drive is suddenly E: and users as well as software
    gets confused about it. <br>
    <br>
    Under Unix you will never have this problem because all the
    physical disks are inserted into the directory tree. You can
    see this if you type "mount" or "df":

    <table>
      <tr>
        <td>
<pre class="code">
# df
Filesystem 1K-blocks    Used Available Use% Mounted on
/dev/hda1    9070728 4701180   3908768  55% /
/dev/hda3   24950428  683412  22999584   3% /home
none          257236       0    257236   0% /dev/shm

# mount
/dev/hda1 on / type ext3 (rw)
none on /proc type proc (rw)
none on /dev/shm type tmpfs (rw)
/dev/hda3 on /home type ext3 (rw)
</pre>
        </td>
      </tr>
    </table>
    Here we have two disk partition one which contains everything
    except /home. This is the root partition "/" and it is physically
    connected to hda1. hda1 is the first partition (1) on the first
    ide harddisk (hda). The third partition (hda3) on the same disk
    is mounted on /home. Thus if you go to /home then you access
    files on hda3. You will never have to worry if this is now D:
    or E: or ??? It is always just a directory tree and it is
    always the same.

    <A NAME="349lfindex2">&nbsp;</A>
<H2>The file-system busy problem</H2>

    Linux buffers file system read and write operations. You will
    notice this when you have usb version 1.1 disk and you access a
    big file. The first time access is slow but the second time you
    open the same file it is very very fast the the light on the
    usb disk does not flash. <br>
    <br>
    Because of this feature you can not just remove a disk that is
    used. You need to unmount it. For normal internal harddisks
    this is never an issue but it can be a problem for cdrom drives
    and USB disks. <br>
    <br>
    If you e.g mount a usb-stick under /mnt/usb and you do "cd
    /mnt/usb" then bash is using this filesystem. If you then try
    to umount it from a different shell window you will get "file
    system busy" and the umount will fail. It is enough to "cd"
    again out from the /mnt/usb and you can umount it. The problem
    is sometimes you forgot who is using it and you have so many
    applications open that it is difficult to find out what is
    causing the umount to fail. <br>
    <br>
    Ask your computer!
<pre class="code">
# fuser -m -u /mnt/usb
/mnt/usb:   1347c(root)  1348c(guido)  1349c(guido)
</pre>
    What you get from the fuser command is a list of processes
    still using the filesystem in question. Now you can check with
    "ps auxw" what this is or you can just kill them. After that
    umount will work.

    <A NAME="349lfindex3">&nbsp;</A>
<H2>But windows can do it!?</H2>

    Why not just pull out the usb-stick? Well, old dos/win3.1
    computers could just be powered off. No shutdown needed. At
    that time some of my friends complained that you had to
    shutdown Linux before powering off. Then win95 came and those
    complains were gone because everybody was used to shut down the
    computer first.

    <A NAME="349lfindex4">&nbsp;</A>
<H2>Linux can do it too!</H2>

    There are also solutions for Linux to be able to just pull out
    the disk (e.g a usb disk). Mandrake Linux has a feature called
    supermount and it gives exactly the same results (or problems)
    as windows. But I don't recommend it because it can cause
    instability and lost files. <br>
    <br>
    It is better to use the mtools (http://mtools.linux.lu/).
    mtools are a set of commands to access floppy drives,
    usb-sticks ... basically any removable media with a FAT
    filesytem and you do not need to mount the filesystem. <br>
    <br>
    Here is the trick:

    <ol>
      <li>
        Edit /etc/mtools.conf and add a line that says<br>
<pre>
drive u: file="/dev/sda1" # or sda4; some usb-stick have partition
                          # 4 created as factory default.
</pre>
        <br>
        <br>
      </li>

      <li>Now you do NOT mount /dev/sda1. Instead you just type<br>
      mdir u:<br>
      to see what is on the usb-stick.<br>
      <br>
      mcopy * u:<br>
      to copy all the files in the current directory to the
      usb-stick.<br>
      <br>
      mcopy u:\* .<br>
      to copy all files from the usb-stick to the current directory
      (note the \ in front of the wildcard).<br>
      <br>
      </li>
    </ol>
    Very easy to use.

    <A NAME="349lfindex5">&nbsp;</A>
<H2>Allow anybody to mount a filesystem</H2>

    Normally you need to be user root to mount filesystems. For
    devices like cdrom or usb-stick you might want to give any user
    the right to mount them. All you need to do in this case, is to
    add a line like this to /etc/fstab:
<pre class="code">
# dev     mount point    fs type   flags
/dev/sda1  /mnt/usb      auto      noauto,user 0 0
</pre>
    This line means that sda1 (the first partition on the first scsi
    disk, usb storage disks are mapped to scsi disks) shall not be
    mounted automatically at startup (noauto) and can be
    mounted/umounted by anybody (user). The FS-type field is also
    set to auto so you can mount a usb-stick formatted with vfat or
    ext2 and the right filesystem will be detected automatically.

    <A NAME="349lfindex6">&nbsp;</A>
<H2>Laptops and nfs</H2>

    The network file system, NFS, is really good if you want to
    have centralized backup of home directories for several users.
    All you need to do is mount the home directories from a central
    server and all users have their individual home directories
    available on all the computers in the network. The same setting
    and preferences and the same data everywhere. It's really good.
    <br>
    <br>
    But how do we handle mobile users with Laptops? (no backups?)
    <br>
    <br>
    Once you are off the network your home directory is gone. One
    solution is to always copy all data (rsync) but this can easily
    lead to inconsistency if you are not very disciplined and often
    you do not need your full home directory. I find it a good
    solution to have a second small home directory with just the
    settings and data I need when I travel. <br>
    <br>
    When you mount a filesystem (any filesystem/disk including nfs)
    on a non empty directory then the content of this directory
    becomes invisible and you see the mounted filesystem. <br>
    <br>
    This is the solution: Create the mount point for the home
    directories (/home) and automount there the different home
    directories when the computer is on the net. However before you
    mount anything create a softlink for the user that owns the
    Laptop to an off-line home directory:
<pre class="code">
/home/guido -&gt; ../home_nonet/guido
</pre>
    When user guido is on the network then he will see his normal
    home directory because the softlink is shaded out. When he is on the road then he will see
    /home_nonet/guido as his home directory (/home/guido). <br>
    <br>
    A very nice solution.

    <A NAME="349lfindex7">&nbsp;</A>
<H2>Conclusion</H2>

    To build an abstraction layer for the hardware has always been
    one of the goals of Unix. To to mount/umount filesystem/disks
    was one of the ways to achieve this. A really advanced and
    modern idea even tough Unix is much older then other modern PC
    operating systems.
  



<!-- BODY_OF_THE_ARTICLE_STOP -->
<!-- 2pdaIgnoreStart -->
<A NAME="talkback">&nbsp;</a>
<h2>Talkback form for this article</h2>
Every article has its own talkback page. On this page you can submit a comment or look at comments from other readers:
<center>
    <table width="250" border=0><tr><td>
    <div class="tbbutton"><A class="nodec" href="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=349">&nbsp;talkback page&nbsp;</a></div>
    </td></tr></table>
</center>

<br clear="all">
<HR size="2" noshade>
<table width="250" border=0><tr><td>
<div class="bbutton"><a class="nodec" href="../../index.shtml">&lt;--, LF Home</a></div>
</td><td>
<div class="bbutton"><a class="nodec" href="index.shtml">Go to the index of this issue</a></div>
</td></tr></table>
<br clear="all">
<HR size="2" noshade>
<!-- ARTICLE FOOT -->
<CENTER><TABLE WIDTH="98%" summary="footer">
<TR><TD ALIGN=CENTER BGCOLOR="#bdc6d5" WIDTH="50%">
<A HREF="../../common/lfteam.html">Webpages maintained by the LinuxFocus Editor team</A>
<BR><FONT COLOR="#1111aa"><a href="../../common/copy.html">&copy; Guido Socher</a><br>&quot;some rights reserved&quot; see <a href="../../license/index.shtml">linuxfocus.org/license/</a><br><a href="http://www.linuxfocus.org">http://www.LinuxFocus.org</a></FONT>
</TD>
<TD BGCOLOR="#bdc6d5">
<!-- TRANSLATION INFO -->
<font size=2>Translation information:</font>
<TABLE summary="translators">
  <tr><td><font size="2">en --&gt; -- : Guido Socher (<a href="http://main.linuxfocus.org/%7Eguido/"><font size="1">homepage</font></a>)</font></td></tr>
</TABLE>
</TD>
</TR></TABLE></CENTER>
<p><font size=1>2004-10-15, generated by lfparser version 2.50</font></p>
<!-- 2pdaIgnoreStop -->
</BODY>
</HTML>
