<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
 <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <META NAME="GENERATOR" CONTENT="lfparser_2.52">
 <META NAME="LFCATEGORY" CONTENT="Hardware">
 <link rel="icon" href="../../common/images/lf-16.png" type="image/png">
 <TITLE>lf375, Hardware: lcdproc -- LCD displays easy to use and easy to build</TITLE>
<style type="text/css">
<!--
 td.top {font-family: Arial,Geneva,Verdana,Helvetica,sans-serif; font-size:12 }
 pre { font-family:monospace,Courier }
 pre.code { font-family:monospace,Courier;background-color:#aedbe8; }
 p.cl { color:#EE9500 }
 table.left { margin-right:0.3cm }
 a.nodec { text-decoration:none }
 p.trans { font-size:8pt; text-align:right }
 p.clbox { width:50%; alignment:center; background-color:#FFD700; 
           border-style:none; border-width:medium; border-color:#FFD700; 
           padding:0.5cm;  text-align:center }
 p.code { width:80%; alignment:center; background-color:#aedbe8; 
          border-style:none; border-width:medium; border-color:#aedbe8; 
          padding:0.1cm;  text-align:left }
 p.foot { background-color:#AAAAAA; color:#FFFFFF; border-style:none; 
          border-width:medium; border-color:#AAAAAA; padding:0.5cm ; 
          margin-top:0.1cm; margin-right:1cm; margin-left:1cm; 
          text-align:center }
 div.tbbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   margin: 2px 5px 2px 5px;
   text-align: center;
   width: 20em;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
 div.bbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   float: left;
   margin: 2px 5px 2px 5px;
   text-align: center;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
-->
</style>
 
</HEAD>
<BODY bgcolor="#ffffff" text="#000000">
 <!-- this is generated html code. NEVER use this file for your
 translation work. Instead get the file with the same article number
 and .meta.shtml in its name. Translate this meta file and then
 use lfparser program to generate the final article -->
 <!-- lfparser can be obtained from http://main.linuxfocus.org/~guido/dev/lfparser.html -->

<!-- this is used by a number of tools:
 =LF=AUTHOR: Guido     Socher
 =LF=CAT___: Hardware
 =LF=TITLE_: lcdproc -- LCD displays easy to use and easy to build
 =LF=NUMBER: 375
 =LF=ANAME_: article375.shtml
 =LF=PARSER: 2.52
 -->

<!-- 2pdaIgnoreStart -->

<!-- start navegation bar, current, style=2 -->
 <!-- top navegation bar -->
 <TABLE summary="topbar_1" cellspacing="0" cellpadding="0" border="0" align="center" width="90%">
   <TR bgcolor="#2e2292">
     <TD class="top"><TABLE summary="topbar_1_logo" cellspacing="0" cellpadding="0" border="0" width=
       "100%">
         <TR><TD width="319"><a href="../../index.shtml"><IMG src="../../common/images/logolftop_319x45.gif"
           alt="[LinuxFocus-icon]" width="319" height="45" align="left" 
           border="0"></a></TD>

           <TD class="top">
             <TABLE summary="topbar_1_links" width="100%">
               <TR align="right">
                 <TD class="top">
                 
                 <A class="nodec" href="../../index.shtml"><FONT color=
                 "#DDDDDD" size="2">&lt;--</FONT></A> &nbsp;| 
                 <A class="nodec" href="../map.html"><FONT color=
                 "#DDDDDD" size="2">Map</FONT></A> &nbsp;| 
                 <A class="nodec" href="../indice.html"><FONT color=
                 "#DDDDDD" size="2">Index</FONT></A> &nbsp;| 
                 <A class="nodec" href="../Search/index.html"><FONT color=
                 "#DDDDDD" size="2">Search</FONT></A> </TD>
                 
               </TR>

               <TR align="right">
                 <TD class="top">
                   <HR width="100%" noshade size="1">
                 </TD>
               </TR>
             </TABLE>
           </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end top navegation bar -->
 <!-- blue bar -->
 <TABLE summary="topbar_2" cellspacing="0" cellpadding="0" border="0" align="center"
 width="90%">
   <TR bgcolor="#00ffff">
     <TD><IMG src="../../common/images/transpix.gif" width="1" height=
     "2" alt=""></TD>
   </TR>
 </TABLE>
 <!-- end blue bar -->
 <!-- bottom navegation bar -->
 <TABLE summary="topbar_3" cellspacing="0" cellpadding="0" border="0" align="center"
 width="94%">
   <TR bgcolor="#000000">
     <TD>
       <TABLE summary="topbar_3_links" cellspacing="0" cellpadding="1" border="0" width=
       "100%">
         <TR align="center">
           <TD WIDTH="20%"><A class="nodec" href="../News/index.html"><FONT color=
           "#FFFFFF">News</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Archives/index.html"><FONT color=
           "#FFFFFF">Archives</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Links/index.html"><FONT color=
           "#FFFFFF">Links</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../aboutus.html"><FONT color=
           "#FFFFFF">About LF</FONT></A> </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end bottom navegation bar -->
<!-- stop navegation bar -->

<!-- SSI_INFO -->

<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfdynahead ver 1.5 --><TABLE ALIGN="right" border=0><TR><TD ALIGN="right"><FONT SIZE="-1" FACE="Arial,Helvetica">This document is available in: <A href="../../English/April2005/article375.shtml">English</a> &nbsp;<A href="../../ChineseGB/April2005/article375.shtml">ChineseGB</a> &nbsp;<A href="../../Francais/April2005/article375.shtml">Francais</a> &nbsp;</FONT></TD></TR></TABLE><br>
 


<!-- SSI_INFO STOP -->
<!-- 2pdaIgnoreStop -->

<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_START -->
<TABLE ALIGN="LEFT" BORDER="0" WIDTH="195" summary="about the author" class="left">
<TR>
<TD>

<img src="../../common/images/Guido-S.gif" alt=
    "[Photo of the Author]" height="164" width="173">
<BR>by  Guido Socher <a href="http://linuxfocus.org/~guido/"><font size="1">(homepage)</font></a>
<BR><BR>
<I>About the author:</I><BR>
<!-- aboutauthor_start -->
<p>Guido likes Linux because it is a really good system to
    develop your own hardware.</p>
<!-- aboutauthor_stop -->
<!-- TRANSLATED_TO en -->
<!-- TRANSLATED_TO_STOP -->
<!-- INDEX_START -->
<BR><i>Content</i>:
<UL>
  <LI><A HREF="#375lfindex0">What is lcdproc?</A></LI>
  <LI><A HREF="#375lfindex1">The hardware</A></LI>
  <LI><A HREF="#375lfindex2">The circuit diagram</A></LI>
  <LI><A HREF="#375lfindex3">The lcdproc parallel port power patch</A></LI>
  <LI><A HREF="#375lfindex4">The LCDd.conf file</A></LI>
  <LI><A HREF="#375lfindex5">Our own application</A></LI>
  <LI><A HREF="#375lfindex6">References</A></LI>
  <LI><A HREF="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=375">Talkback form for this article</A></LI>
</UL>

</TD></TR></TABLE>
<!-- INDEX_STOP -->
<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_STOP -->
<!-- HEAD_OF_THE_ARTICLE_START -->
<br>&nbsp;
<table border="0"><tr><td>
<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfPdf ver 0.1 -->
<TABLE style="border-style:outset; border-width:1px" align="right" bgcolor="#ff9616" cellspacing="1"><TR><TD bgcolor="#ff9616">
        <a href="../Archives/lf-2005_04-0375.pdf"><small>PDF</small></a>
        </TD></TR></TABLE>
         

<H2>lcdproc -- LCD displays easy to use and easy to build</H2>
 <img src="../../common/images2/article375/title.jpg" alt="[Illustration]" hspace="10" width="350" height="163">
<!-- ABSTRACT OF THE ARTICLE -->
<P><i>Abstract</i>:
<P>
<!-- articleabstract_start -->

    Those readers that might have expected now an article about
    microcontrollers should not worry. I will definitely continue.
    The next hardware article will again be about microcontrollers.
    I have also created a page where you find all recent
    electronics articles: <a href=
    "http://www.tuxgraphics.org/electronics/">http://www.tuxgraphics.org/electronics/</a><br>
    I hope that this makes it easier to follow and to get an
    overview. <br><br>
     Long time linuxfocus readers will still remember my old <a href=
    "../March2003/article286.shtml">March 2003: Linux USB LCD
    display with watchdog and buttons</a> and <a href=
    "../May2002/article236.shtml">A LCD control panel for your
    Linux server</a> articles. Those where really "luxury" LCD
    panels with hardware watchdog and ADC etc... Over time I have
    noticed that all this extra functionality is something that I
    do not use so often. <br><br>
    This article presents now the "basic" model: LCD display and 2
    buttons; simple and easy to build for everybody.

    
<!-- articleabstract_stop -->

<br><!-- HR divider --><center><font color="#8282e0"><b>_________________ _________________ _________________</b></font></center><br>
</td></tr></table>
<!-- HEAD_OF_THE_ARTICLE_STOP -->
<!-- BODY_OF_THE_ARTICLE_START -->


    <A NAME="375lfindex0">&nbsp;</A>
<H2>What is lcdproc?</H2>

    <img src="../../common/images2/article375/firsttests.jpg" align="right" alt="LCDd" width="270" height="100"> Lcdproc used to be at the very
    beginning a program to display some statistics (cpu load,
    uptime, time, ...) on an external LCD display. Over time it has
    however evolved into a much more generic solution. Today the
    lcdproc package contains LCDd, a generic server and LCD driver,
    plus many clients. One of those clients is still the actual
    executable called lcdproc which still shows server statistics
    however there are also others. This client server architecture
    has the big advantage that you do not need to write your client
    in a specific language. You just need to use the simple
    ascii protocol between client and server. Here is an example
    which implements a <a href=
    "../../common/src2/article375/lcddate_pl.html">clock in just 36
    lines of perl code</a>. It displays time and date and the
    upper right corner shows a little icon called "heartbeat". The
   "heartbeat" is
    added by the LCDd server. This "heartbeat" icon blinks once in a
    while to indicate that the display is still alive. <br>
    <br>
    In lcdproc you can have more than just strings. You get
    bar-graphs, scrollers, title bars.... and text strings. At the
    beginning of the program you define those objects (they are
    called widgets) and then you fill them with data. It's
    explained in the <a href=
    "../../common/src2/article375/lcdproc-0.5-dev-guide.pdf">LCDproc
    Developer's Guide</a> from page 7 and on wards. <br>
    <br>
    The main part of the <a href=
    "../../common/src2/article375/lcddate_pl.html">little LCD
    clock</a> example program looks like this:
<pre class="code">
#!/usr/bin/perl -w
....
# initiate the communication:
print $remote "hello\n";
....
# set our name and define a text string widget
print $remote "client_set name lcdtime\n";
print $remote "screen_add scr1\n";
print $remote "widget_add scr1 str1 string\n";
....
while(1)
{
    ....
    $date = scalar localtime;
    # now write to the LCD:
    print $remote "widget_set scr1 str1 1 1 \"$date\"\n";
    sleep 10;
}
</pre>
    Easy enough? OK, then let's build something more useful.

    <A NAME="375lfindex1">&nbsp;</A>
<H2>The hardware</H2>

    The parallel port of a PC works according to specifications
    with 5V. If you now take a look at the datasheet of a modern
    LCD display (e.g from tuxgraphics: <a href=
    "http://shop.tuxgraphics.org/electronic/lcd.html">http://shop.tuxgraphics.org/electronic/lcd.html</a>)
    you will notice that even though the displays are big they need
    extremely little power. Only 2 mA ! With so little current
    it must be possible to power the display directly from the
    parallel port. The advantage is then that you do not need any
    extra power connector. It is just one LCD display with one
    connector to the parallel port. Very convenient. <br>
    <br>
     It is possible with a parallel port that really provides 5V.
    The problem is that there are some which do not follow the
    specifications. So how do you know if your parallel port is
    good enough for "self powered" solution? Here is a little test:


    <ol>
      <li>Install lcdproc with the "parallel port power" patch (see
      references).</li>

      <li>Configure the /etc/LCDd.conf file as described further
      down.</li>

      <li>Start the program LCDd as root.</li>

      <li>Take a digital voltmeter and measure the voltage on pin
      1. It should be 4.90V or more (measure between pin 1 and
      pin 18 = GND).</li>

      <li>Now connect a 33K resistor to the parallel port between
      pin 1 and pin 18. The voltage should go down to 4.25V. If you get
      more then your parallel port is very good. If you get less then
      the "self powered" solution will not work.
      </li>
    </ol>
    If this test passes then you can go for the "parallel port
    power" solution using the tuxgraphics 20x2 display (or equivalent). This is
    tested. It will work. <br>
    <br>
    <img src="../../common/images2/article375/conn_usba.gif" align="right" alt="usb A connector pinout" width="246" height="120"> If your parallel port is
    a bit weak then don't worry too much. You can either use the
    internal 5V of your PC (you have to open it for this purpose)
    or you can get 5V from an free USB connector. <br clear="all">

    <A NAME="375lfindex2">&nbsp;</A>
<H2>The circuit diagram</H2>

    The first diagram shows the connections for a LCD display with
    2 buttons using the "parallel port power" solution. <br>

    <center>
      <a href=
      "../../common/src2/article375/lcdproc-selfpower.png"><img src="../../common/src2/article375/lcdproc-selfpower_th.gif" alt="parallel port powered LCD display" width="400" height="300"></a>
    </center>
    <br>
<pre class="code">
Parallel port
pin 1 , strobe  = 220, supply voltage
pin 2 , D0      = LCD pin D4
pin 3 , D1      = LCD pin D5
pin 4 , D2      = LCD pin D6
pin 5 , D3      = LCD pin D7

pin 6 , D4      = LCD pin RS
pin 7 , D5      = LCD pin RW
pin 8 , D6      = LCD pin EN

pin 10, ACK     = button A, upper red button
pin 12, PE      = button C, lower black button

pin 14, strobe  = 220, supply voltage
pin 16, strobe  = 220, supply voltage
pin 17, strobe  = 220, supply voltage

pin 18, ground  = 0V, GND
</pre>
    <br>
    <br>
    This second drawing shows the connections for a LCD display
    with 2 buttons and external power:

    <center>
      <a href=
      "../../common/src2/article375/lcdproc-seppower.png"><img src="../../common/src2/article375/lcdproc-seppower_th.gif" alt="parallel port powered LCD display" width="400" height="300"></a>
    </center>
    <br>
    <br>
    As for all new electronics articles you can again get a kit
    with all the components from <a href=
    "http://shop.tuxgraphics.org">shop.tuxgraphics.org</a> <br>
    <br>
    I have mounted the lcd display in a black plastic frame:

    <center>
      <img src="../../common/images2/article375/tuxgraphics20x2LCD_back.jpg" alt="my display, back" width="340" height="165"><br>
      <br>
      <img src="../../common/images2/article375/tuxgraphics20x2LCD_front.jpg" alt="my display, front" width="340" height="167">
    </center>

    <A NAME="375lfindex3">&nbsp;</A>
<H2>The lcdproc parallel port power patch</H2>

    LCDd sends always some data to the display. One could therefore
    use some diodes and derive the power from the signal lines. The
    problem is that diodes will cause a voltage drop of at least
    0.5V even at low currents. We can't afford this. There are
    however enough output lines free if you use LCDd with just one
    LCD display. Nothing is easier than patching the LCDd software
    to always keep those free pins on logical "1". We still insert
    some resistors to have a minimum short circuit protection (or
    stupid mistake protection ;-). The patch for lcdproc-0.4.5 is
    available from the download section. You apply it like this:
<pre class="code">
tar zxvf lcdproc-0.4.5.tar.gz
cd lcdproc-0.4.5
patch -p 1 &lt; lcdproc-0.4.5-pp-powerpatch-v1.txt
./configure --enable-drivers=hd44780
make

make install
(or you can just copy LCDd.conf /etc and copy server/LCDd to /usr/bin)
</pre>

    <A NAME="375lfindex4">&nbsp;</A>
<H2>The LCDd.conf file</H2>

    The /etc/LCDd.conf file configures our LCD driver and server
    (=the LCDd process). In the /etc/LCDd.conf file you need to
    uncomment the following in order to use a HD44780 compatible
    display with wiring as described in this article:
<pre class="code">
[server]
Driver=HD44780

[HD44780]
# Hitachi HD44780 driver

Port=0x3BC
# Port where the LPT is. Usual values are 0x278, 0x378 and 0x3BC

ConnectionType=4bit
Keypad=yes
Backlight=no

Size=20x2
# Specifies the size of the LCD.

DelayMult=4
DelayBus=true
</pre>
    The difficult part is the port address (0x278, 0x378 and
    0x3BC). How do you know at which IO address your parallel port
    is? The easiest is to load the parport kernel module (modprobe
    parport) and then look at /proc/ioports:
<pre class="code">
modprobe parport
modprobe parport_pc

cat /proc/ioports

...
0388-0389 : OPL2/3 (left)
038a-038b : OPL2/3 (right)
<b>03bc-03be : parport0</b>
03c0-03df : vga+
03f6-03f6 : ide0
...

in this case you use: 0x3bc
</pre>

    <A NAME="375lfindex5">&nbsp;</A>
<H2>Our own application</H2>

    You have seen at the beginning of this article how easy it is
    to send some text strings to the display. It becomes a bit more
    complicated if you want an interactive display (with the two
    buttons). In this case we need to avoid the sleep statement
    otherwise the buttons are not responsive during the sleep
    period. At the same time we need a blocking statement which
    stops the loop. What we need is the system call "select". It
    stops execution until a timeout or until a button is pressed at
    the display. <br>
    <br>
    Our application will provide some stats (mem, swap, cpu, time)
    and you can use the buttons to shutdown the machine. <br>
    <br>
    The script is called servermenu_pl and you find it in the
    download section. <br>
    <br>
    I present here only such a basic application as experience from
    previous articles showed that most readers just want to know
    how to do something and then they have their own applications
    for it. I received emails with all kind of ideas, CD-burning
    station, weather station PC, alarm systems, ... all this can be
    done. Just modify the code a bit. <br>
    It's really cool and a lot of fun to play with this display and
    lcdproc.

    <center>
      <img src="../../common/images2/article375/sm-all.jpg" alt="servermenu in operation" width="320" height="366"><br>
    </center>

    <A NAME="375lfindex6">&nbsp;</A>
<H2>References</H2>


    <ul>
      <li><a href="../../common/src2/article375/index.html"><b>Download</b>
      section for this article</a></li>

      <li>lcdproc homepage: <a href=
      "http://www.lcdproc.org">http://www.lcdproc.org</a></li>

      <li>The <a href="http://shop.tuxgraphics.org">tuxgraphics
      online shop</a>. You can order all the needed parts from this
      shop (<a href="http://shop.tuxgraphics.org">http://shop.tuxgraphics.org</a>).</li>
    </ul>
    <!-- vim: set sw=2 ts=2 et tw=80: -->
  



<!-- BODY_OF_THE_ARTICLE_STOP -->
<!-- 2pdaIgnoreStart -->
<A NAME="talkback">&nbsp;</a>
<h2>Talkback form for this article</h2>
Every article has its own talkback page. On this page you can submit a comment or look at comments from other readers:
<center>
    <table width="250" border=0><tr><td>
    <div class="tbbutton"><A class="nodec" href="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=375">&nbsp;talkback page&nbsp;</a></div>
    </td></tr></table>
</center>

<br clear="all">
<HR size="2" noshade>
<table width="250" border=0><tr><td>
<div class="bbutton"><a class="nodec" href="../../index.shtml">&lt;--, LF Home</a></div>
</td><td>
<div class="bbutton"><a class="nodec" href="index.shtml">Go to the index of this issue</a></div>
</td></tr></table>
<br clear="all">
<HR size="2" noshade>
<!-- ARTICLE FOOT -->
<CENTER><TABLE WIDTH="98%" summary="footer">
<TR><TD ALIGN=CENTER BGCOLOR="#bdc6d5" WIDTH="50%">
<A HREF="../../common/lfteam.html">Webpages maintained by the LinuxFocus Editor team</A>
<BR><FONT COLOR="#1111aa"><a href="../../common/copy.html">&copy; Guido     Socher</a><br>&quot;some rights reserved&quot; see <a href="../../license/index.shtml">linuxfocus.org/license/</a><br><a href="http://www.linuxfocus.org">http://www.LinuxFocus.org</a></FONT>
</TD>
<TD BGCOLOR="#bdc6d5">
<!-- TRANSLATION INFO -->
<font size=2>Translation information:</font>
<TABLE summary="translators">
  <tr><td><font size="2">en --&gt; -- : Guido Socher (<a href="http://linuxfocus.org/~guido/"><font size="1">homepage</font></a>)</font></td></tr>
</TABLE>
</TD>
</TR></TABLE></CENTER>
<p><font size=1>2005-04-19, generated by lfparser version 2.52</font></p>
<!-- 2pdaIgnoreStop -->
</BODY>
</HTML>
