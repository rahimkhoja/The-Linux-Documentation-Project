<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
 <META http-equiv="Content-Type" content="text/html; charset=koi8-r">
 <META NAME="GENERATOR" CONTENT="lfparser_2.48">
 <META NAME="LFCATEGORY" CONTENT="UNIXBasics">
 <link rel="icon" href="../../common/images/lf-16.png" type="image/png">
 <TITLE>lf349, UNIXBasics: Тайны монтирования</TITLE>
<style type="text/css">
<!--
 td.top {font-family: Arial,Geneva,Verdana,Helvetica,sans-serif; font-size:12 }
 pre { font-family:monospace,Courier }
 pre.code { font-family:monospace,Courier;background-color:#aedbe8; }
 p.cl { color:#EE9500 }
 table.left { margin-right:0.3cm }
 a.nodec { text-decoration:none }
 p.trans { font-size:8pt; text-align:right }
 p.clbox { width:50%; alignment:center; background-color:#FFD700; 
           border-style:none; border-width:medium; border-color:#FFD700; 
           padding:0.5cm;  text-align:center }
 p.code { width:80%; alignment:center; background-color:#aedbe8; 
          border-style:none; border-width:medium; border-color:#aedbe8; 
          padding:0.1cm;  text-align:left }
 p.foot { background-color:#AAAAAA; color:#FFFFFF; border-style:none; 
          border-width:medium; border-color:#AAAAAA; padding:0.5cm ; 
          margin-top:0.1cm; margin-right:1cm; margin-left:1cm; 
          text-align:center }
 .mark  { background-color:#e6e6ff }
-->
</style>
 
</HEAD>
<BODY bgcolor="#ffffff" text="#000000">
 <!-- this is generated html code. NEVER use this file for your
 translation work. Instead get the file with the same article number
 and .meta.shtml in its name. Translate this meta file and then
 use lfparser program to generate the final article -->
 <!-- lfparser can be obtained from http://main.linuxfocus.org/~guido/dev/lfparser.html -->

<!-- this is used by a number of tools:
 =LF=AUTHOR: Guido Socher
 =LF=CAT___: UNIXBasics
 =LF=TITLE_: Тайны монтирования
 =LF=NUMBER: 349
 =LF=ANAME_: article349.shtml
 -->

<!-- 2pdaIgnoreStart -->

<!-- start navegation bar, style=2 -->
 <!-- top navegation bar -->
 <TABLE summary="topbar_1" cellspacing="0" cellpadding="0" border="0" align="center" width="90%">
   <TR bgcolor="#2e2292">
     <TD class="top"><TABLE summary="topbar_1_logo" cellspacing="0" cellpadding="0" border="0" width=
       "100%">
         <TR><TD width="319"><a href="../../index.shtml"><IMG src="../../common/images/logolftop_319x45.gif"
           alt="[LinuxFocus-icon]" width="319" height="45" align="left" 
           border="0"></a></TD>

           <TD class="top">
             <TABLE summary="topbar_1_links" width="100%">
               <TR align="right">
                 <TD class="top">
                 
                 <A class="nodec" href="../../index.shtml"><FONT color=
                 "#DDDDDD" size="2">&lt;--</FONT></A> &nbsp;| 
                 <A class="nodec" href="../map.html"><FONT color=
                 "#DDDDDD" size="2">Карта</FONT></A> &nbsp;| 
                 <A class="nodec" href="../indice.html"><FONT color=
                 "#DDDDDD" size="2">Индекс</FONT></A> &nbsp;| 
                 <A class="nodec" href="../Search/index.shtml"><FONT color=
                 "#DDDDDD" size="2">Поиск</FONT></A> </TD>
                 
               </TR>

               <TR align="right">
                 <TD class="top">
                   <HR width="100%" noshade size="1">
                 </TD>
               </TR>
             </TABLE>
           </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end top navegation bar -->
 <!-- blue bar -->
 <TABLE summary="topbar_2" cellspacing="0" cellpadding="0" border="0" align="center"
 width="90%">
   <TR bgcolor="#00ffff">
     <TD><IMG src="../../common/images/transpix.gif" width="1" height=
     "2" alt=""></TD>
   </TR>
 </TABLE>
 <!-- end blue bar -->
 <!-- bottom navegation bar -->
 <TABLE summary="topbar_3" cellspacing="0" cellpadding="0" border="0" align="center"
 width="94%">
   <TR bgcolor="#000000">
     <TD>
       <TABLE summary="topbar_3_links" cellspacing="0" cellpadding="1" border="0" width=
       "100%">
         <TR align="center">
           <TD WIDTH="20%"><A class="nodec" href="../News/index.shtml"><FONT color=
           "#FFFFFF">Новости</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Archives/"><FONT color=
           "#FFFFFF">Архивы</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Links/index.shtml"><FONT color=
           "#FFFFFF">Ссылки</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../aboutus.html"><FONT color=
           "#FFFFFF">Про LF</FONT></A> </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end bottom navegation bar -->
<!-- stop navegation bar -->

<!-- SSI_INFO -->

<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfdynahead ver 1.5 --><TABLE ALIGN="right" border=0><TR><TD ALIGN="right"><FONT SIZE="-1" FACE="Arial,Helvetica">эта страница доступна на следующих языках: <A href="../../English/September2004/article349.shtml">English</a> &nbsp;<A href="../../Castellano/September2004/article349.shtml">Castellano</a> &nbsp;<A href="../../ChineseGB/September2004/article349.shtml">ChineseGB</a> &nbsp;<A href="../../Deutsch/September2004/article349.shtml">Deutsch</a> &nbsp;<A href="../../Francais/September2004/article349.shtml">Francais</a> &nbsp;<A href="../../Italiano/September2004/article349.shtml">Italiano</a> &nbsp;<A href="../../Indonesian/September2004/article349.shtml">Indonesian</a> &nbsp;<A href="../../Russian/September2004/article349.shtml">Russian</a> &nbsp;<A href="../../Turkce/September2004/article349.shtml">Turkce</a> &nbsp;<A href="../../Polish/September2004/article349.shtml">Polish</a> &nbsp;</FONT></TD></TR></TABLE><br>
 


<!-- SSI_INFO STOP -->
<!-- 2pdaIgnoreStop -->

<!-- SHORT BIO ABOUT THE AUTHOR -->
<TABLE ALIGN="LEFT" BORDER="0" WIDTH="195" summary="about the author" class="left">
<TR>
<TD>

<img src="../../common/images/Guido-S.gif" alt=
    "[Photo of the Author]" height="164" width="173">
<BR>автор  Guido Socher <a href="http://main.linuxfocus.org/%7Eguido/"><font size="1">(homepage)</font></a>
<BR><BR>
<I>Об авторе:</I><BR>
<!-- aboutauthor_start -->
<p>Guido нравится Linux из-за сообщества. Это огромный проект,
	в котором трудятся люди со всего мира, чтобы сделать Linux лучше
	и делают они это каждый день.<br>
	К сожалению проект Linux сегодня настолько большой, что привлекает
	людей, которые хотят только получить прибыль, ничего не дав взамен.
	Осторожно! Они обычно появляются как "pro-linux", но они всего лишь
	заинтересованы в собственной прибыли.
	</p>
<!-- aboutauthor_stop -->
<!-- TRANSLATED TO ru -->
<BR><BR><I>Перевод на Русский:</I><BR>
Pukhlyakov Kirill <small>&lt;kirill(at)linuxfocus.org&gt;</small>
<br>
<!--
 =LF=TRANSTO=ru: Pukhlyakov Kirill
-->
<!-- TRANSLATED TO STOP -->
<BR><i>Содержание</i>:
<UL>
  <LI><A HREF="#349lfindex0">Введение</A></LI>
  <LI><A HREF="#349lfindex1">Как это работает</A></LI>
  <LI><A HREF="#349lfindex2">Проблема занятости файловой системы</A></LI>
  <LI><A HREF="#349lfindex3">Но windows может это делать!?</A></LI>
  <LI><A HREF="#349lfindex4">Linux тоже может это делать!</A></LI>
  <LI><A HREF="#349lfindex5">Как разрешить всем пользователям монтировать файловые системы</A></LI>
  <LI><A HREF="#349lfindex6">Лэптопы и nfs</A></LI>
  <LI><A HREF="#349lfindex7">Вывод</A></LI>
  <LI><A HREF="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=349">Страница отзывов</A></LI>
</UL>

</TD></TR></TABLE>
<!-- HEAD OF THE ARTICLE -->
<br>&nbsp;
<table border="0"><tr><td>
<H2>Тайны монтирования</H2>
 <img src="../../common/images2/illustration349.jpg" alt="mount"
    hspace="10">
<!-- ABSTRACT OF THE ARTICLE -->
<P><i>Резюме</i>:
<P>
<!-- articleabstract_start -->

	В заметке рассматриваются вопросы монтирования дисков. Она должна быть
	интересна даже тем из вас кто знаком с ОС Linux.

    
<!-- articleabstract_stop -->

<br><!-- HR divider --><center><font color="#8282e0"><b>_________________ _________________ _________________</b></font></center><br>
</td></tr></table>
<!-- BODY OF THE ARTICLE -->


    <A NAME="349lfindex0">&nbsp;</A>
<H2>Введение</H2>

	Сначала я расскажу об основах монтирования файловых систем, а затем
	рассмотрю более сложные возможности. Если вы чувствуете себя экспертом в
	области Linux - читайте немного ниже.

    <A NAME="349lfindex1">&nbsp;</A>
<H2>Как это работает</H2>

	В настоящее время пользователи windows знакомы со следующей проблемой:
	добавление нового диска приводит к возникновению беспорядка в
	существующей последовательности обозначений. Например то, что было диском
	D: вдруг стало диском E:, вследствие чего и пользователи и программное
	обеспечение пребывают в недоумении.<br>
    <br>
	Используя Unix вы никогда не столкнетесь с подобной проблемой, потому что
	все физические диски устанавливаются в дерево каталогов. Вы можете убедиться
	в этом, набрав команду "mount" или "df":

    <table>
      <tr>
        <td>
<pre class="code">
# df
Filesystem 1K-blocks    Used Available Use% Mounted on
/dev/hda1    9070728 4701180   3908768  55% /
/dev/hda3   24950428  683412  22999584   3% /home
none          257236       0    257236   0% /dev/shm

# mount
/dev/hda1 on / type ext3 (rw)
none on /proc type proc (rw)
none on /dev/shm type tmpfs (rw)
/dev/hda3 on /home type ext3 (rw)
</pre>
        </td>
      </tr>
    </table>
	Мы видим два раздела диска, один из которых содержит все кроме
	&quot;/home&quot;. Это раздел &quot;/&quot; и физически он
	присоединен к hda1. hda1 - это первый раздел (1) первого ide диска
	(hda). Третий раздел (hda3) этого диска подмонтирован к &quot;/home&quot;
	Таким образом если вы обратитесь к &quot;/home&quot; вы получите
	доступ к файлам раздела hda3. Вам никогда не придется беспокоиться
	какая это буква - D:, E: или ???. Это всегда просто каталог и всегда
	один и тот же.

    <A NAME="349lfindex2">&nbsp;</A>
<H2>Проблема занятости файловой системы</H2>

    ОС Linux помещает операции файловой системы по чтению и записи в
	буфер. Можно заметить это читая большой файл с usb (1.1) диска.
	Первый раз чтение занимает достаточно много времени, но повторное чтение
	того же самого файла происходит намного быстрее - лампочка на диске
	даже не мерцает.<br>
    <br>
	Следствием такой возможности использования дисков является то, что
	вы не можете просто изъять используемый диск, необходимо его сначала
	размонтировать. Для обычных жестких дисков это не проблема для
	обсуждения, это касается cdrom приводов и USB дисков.<br>
    <br>
    Предположим вы подмонтировали usb-stick в /mnt/usb и выполнили команду
	"cd /mnt/usb" - bash уже использует эту файловую систему. Если вы попробуете
	размонтировать это устройство из другого окна оболочки вы получите сообщение
	"file system busy" и размонтирование не будет выполнено. Чтобы решить эту
	проблему достаточно выполнить команду "cd" в /mnt/usb и тогда можно
	размонтировать. Иногда проблема может быть в том, что вы забыли кто
	использует эту файловую систему - открыто так много приложений, что это не
	удивительно.<br>
    <br>
    Спросите компьютер!
<pre class="code">
# fuser -m -u /mnt/usb
/mnt/usb:   1347c(root)  1348c(guido)  1349c(guido)
</pre>
	Команда выводит список процессов использующих файловую систему. Теперь командой
	"ps auxw" можно узнать что это или просто остановить эти процессы. После этого
	umount выполнит свою работу.

    <A NAME="349lfindex3">&nbsp;</A>
<H2>Но windows может это делать!?</H2>

	Почему бы просто не вынуть usb-stick? Старые компьютеры  с dos/win3.1
	можно было просто отключить от питания. Не было никаких	shutdown'ов.
	В то время некоторые мои знакомые жаловались, что перед отключением
	Linux от питания сначала надо было сделать shutdown. Затем появилась
	win95 и все эти разговоры прекратились - ей также надо было сначало
	выполнить shutdown и только потом выключать питание.

    <A NAME="349lfindex4">&nbsp;</A>
<H2>Linux тоже может это делать!</H2>

    Для ОС Linux также есть решения позволяющие просто взять и вынуть диск
	( например usb disk ). В дистрибутиве Mandrake это называется supermount -
	воспользовавшись вы получите такой же результат ( или проблемы ) как в
	windows. Не рекомендую вам пользоваться этим - возможны проблемы со
	стабильностью работы и не исключена потеря файлов.<br>
    <br>
    Намного лучше пользоваться набором утилит mtools (http://mtools.linux.lu/) -
	это команды для доступа к дискетам, usb-stick'ам ... короче говоря любой
	носитель с файловой системой FAT. Исспользуя этот набор утилит вам не надо
	ничего монтировать.<br>
    <br>
    Небольшой совет:

    <ol>
      <li>
        Отредактируйте /etc/mtools.conf добавив следующую строку<br>
<pre>
drive u: file="/dev/sda1" # or sda4; some usb-stick have partion
                          # 4 created as factory default.
</pre>
        <br>
        <br>
      </li>

      <li>Теперь вам НЕ надо монтировать /dev/sda1. Просто наберите <br>
      mdir u:<br>
      чтобы узнать что на usb-stick'е.<br>
      <br>
      mcopy * u:<br>
      копирование всех файлов текущего каталога на usb-stick.<br>
      <br>
      mcopy u:\* .<br>
      копирование всех файлов с usb-stick'а в текущий каталог.<br>
      <br>
      </li>
    </ol>
    Этот набор утилит прост в использовании и очень удобен.

    <A NAME="349lfindex5">&nbsp;</A>
<H2>Как разрешить всем пользователям монтировать файловые системы</H2>

	Чтобы подмонтировать файловую систему обычно надо обладать привилегиями
	root'а. Но возможно для некоторых устройств ( например cdrom или usb-stick )
	вы желаете позволить делать это любому пользователю. В этом случае все,
	что вам необходимо сделать это добавить следующую строку в файл /etc/fstab:

<pre class="code">
# dev     mount point    fs type   flags
/dev/sda1  /mnt/usb      auto      noauto,user 0 0
</pre>
	В этой строке содержится следующая информация: sda1 ( первый раздел
	первого scsi диска, usb диски отображаются как scsi устройства ), не
	может быть подмонтирован при запуске системы ( noauto ) и может быть
	подмонтирован/размонтирован любым пользователем ( user ). Поле FS-type
	также установлено в auto - можно монтировать usb-stick с файловой системой
	vfat или ext2 и она будет определена автоматически.

    <A NAME="349lfindex6">&nbsp;</A>
<H2>Лэптопы и nfs</H2>

	NFS полезна если вам необходим централизованный бэкап домашних каталогов
	нескольких пользователей. Все что нужно - это подмонтировать домашние каталоги
	с центрального сервера и у всех пользователей будут индивидуальные каталоги
	доступные на всех компьютерах в сети. Одни и те же данные, установки и т.д.
	везде. Это действительно удобно.
    <br>
    <br>
	Но как быть в случае с мобильными пользователями?
    <br>
    <br>
	Как только вы отключаетесь от сети - ваш каталог теряется. Одно из
	возможных решений - всегда копировать данные ( rsync ), но это может
	привести к нарушению целостности каталога если вы недостаточно дисциплинированны
	или вам не всегда нужна полная копия домашнего каталога. Я нашел неплохое
	решение этой проблемы - создать второй небольшой домашний каталог с данными
	и установками необходимыми мне только во время поездок.<br>
    <br>
    Когда вы монтируете файловую систему ( любая  файловая система/диск с nfs )
	на непустой каталог - содержимое этого каталога становится невидимым и вы видите
	только подмонтированную файловую систему.<br>
    <br>
    Вот мое решение: создаем точку монтирования для домашних каталогов
    ( /home ) и производим автомонтирование ( automount ) в нее различных домашних
	каталогов когда компьютер в сети. Кроме того, перед монтированием создаем
    softlink для пользователя, владельца лэптопа на off-line домашний каталог:
<pre class="code">
/home/guido -&gt; ../home_nonet/guido
</pre>
    Когда пользователь guido в сети, он видит свой обычный домашний каталог. Когда он в пути
	он видит /home_nonet/guido своим домашним каталогом ( /home/guido ). <br>
    <br>
    Это решение мне очень нравится.

    <A NAME="349lfindex7">&nbsp;</A>
<H2>Вывод</H2>

	Построение абстрактного уровня для устройств всегда было целью Unix. Подмонтирование/
	размонтирование файловых систем/дисков одна из возможностей достичь этого.
  



<!-- 2pdaIgnoreStart -->
<A NAME="talkback">&nbsp;</a>
<h2>Страница отзывов</h2>
У каждой заметки есть страница отзывов. На этой странице вы можете оставить 
свой комментарий или просмотреть комментарии других читателей 
<center>
<table border="0"  CELLSPACING="2" CELLPADDING="1" summary="tb-button-outerpart">
 <tr BGCOLOR="#C2C2C2"><td align=center>
  <table border="3"  CELLSPACING="2" CELLPADDING="1" summary="tb-button">
   <tr BGCOLOR="#C2C2C2"><td align=center>
    <A href="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=349"><b>&nbsp;talkback page&nbsp;</b></a>
   </td></tr></table>
</td></tr></table>
</center>

<HR size="2" noshade>
<a style="background-color:#bdc6d5" href="index.shtml">&lt;--, перейти к начальной странице выпуска </a><br><HR size="2" noshade>
<!-- ARTICLE FOOT -->
<CENTER><TABLE WIDTH="98%" summary="footer">
<TR><TD ALIGN=CENTER BGCOLOR="#bdc6d5" WIDTH="50%">
<A HREF="../../common/lfteam.html">Webpages maintained by the LinuxFocus Editor team</A>
<BR><FONT COLOR="#1111aa"><a href="../../common/copy.html">&copy; Guido Socher</a><br>&quot;some rights reserved&quot; see <a href="../../license/index.shtml">linuxfocus.org/license/</a><br><a href="http://www.linuxfocus.org">http://www.LinuxFocus.org</a></FONT>
</TD>
<TD BGCOLOR="#bdc6d5">
<!-- TRANSLATION INFO -->
<font size=2>Translation information:</font>
<TABLE summary="translators">
  <tr><td><font size="2">en --&gt; -- : Guido Socher (<a href="http://main.linuxfocus.org/%7Eguido/"><font size="1">homepage</font></a>)</font></td></tr>
  <tr><td><font size="2">en --&gt; ru: Pukhlyakov Kirill &lt;kirill(at)linuxfocus.org&gt;</font></td></tr>
</TABLE>
</TD>
</TR></TABLE></CENTER>
<p><font size=1>2004-10-14, generated by lfparser version 2.48</font></p>
<!-- 2pdaIgnoreStop -->
</BODY>
</HTML>
