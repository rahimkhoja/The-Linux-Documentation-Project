<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
 <META http-equiv="Content-Type" content="text/html; charset=gb2312">
 <META NAME="GENERATOR" CONTENT="lfparser_2.51">
 <META NAME="LFCATEGORY" CONTENT="SoftwareDevelopment">
 <link rel="icon" href="../../common/images/lf-16.png" type="image/png">
 <TITLE>lf354, SoftwareDevelopment: SPF 简介</TITLE>
<style type="text/css">
<!--
 td.top {font-family: Arial,Geneva,Verdana,Helvetica,sans-serif; font-size:12 }
 pre { font-family:monospace,Courier }
 pre.code { font-family:monospace,Courier;background-color:#aedbe8; }
 p.cl { color:#EE9500 }
 table.left { margin-right:0.3cm }
 a.nodec { text-decoration:none }
 p.trans { font-size:8pt; text-align:right }
 p.clbox { width:50%; alignment:center; background-color:#FFD700; 
           border-style:none; border-width:medium; border-color:#FFD700; 
           padding:0.5cm;  text-align:center }
 p.code { width:80%; alignment:center; background-color:#aedbe8; 
          border-style:none; border-width:medium; border-color:#aedbe8; 
          padding:0.1cm;  text-align:left }
 p.foot { background-color:#AAAAAA; color:#FFFFFF; border-style:none; 
          border-width:medium; border-color:#AAAAAA; padding:0.5cm ; 
          margin-top:0.1cm; margin-right:1cm; margin-left:1cm; 
          text-align:center }
 div.tbbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   margin: 2px 5px 2px 5px;
   text-align: center;
   width: 20em;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
 div.bbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   float: left;
   margin: 2px 5px 2px 5px;
   text-align: center;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
-->
</style>
 
</HEAD>
<BODY bgcolor="#ffffff" text="#000000">
 <!-- this is generated html code. NEVER use this file for your
 translation work. Instead get the file with the same article number
 and .meta.shtml in its name. Translate this meta file and then
 use lfparser program to generate the final article -->
 <!-- lfparser can be obtained from http://main.linuxfocus.org/~guido/dev/lfparser.html -->

<!-- this is used by a number of tools:
 =LF=AUTHOR: Bruno     Sousa
 =LF=CAT___: SoftwareDevelopment
 =LF=TITLE_: SPF 简介
 =LF=NUMBER: 354
 =LF=ANAME_: article354.shtml
 =LF=PARSER: 2.51
 -->

<!-- 2pdaIgnoreStart -->

<!-- start navegation bar, current, style=2 -->
 <!-- top navegation bar -->
 <TABLE summary="topbar_1" cellspacing="0" cellpadding="0" border="0" align="center" width="90%">
   <TR bgcolor="#2e2292">
     <TD class="top"><TABLE summary="topbar_1_logo" cellspacing="0" cellpadding="0" border="0" width=
       "100%">
         <TR><TD width="319"><a href="../../index.shtml"><IMG src="../../common/images/logolftop_319x45.gif"
           alt="[LinuxFocus-icon]" width="319" height="45" align="left" 
           border="0"></a></TD>

           <TD class="top">
             <TABLE summary="topbar_1_links" width="100%">
               <TR align="right">
                 <TD class="top">
                 
                 <A class="nodec" href="../../index.shtml"><FONT color=
                 "#DDDDDD" size="2">&lt;--</FONT></A> &nbsp;| 
                 <A class="nodec" href="../map.html"><FONT color=
                 "#DDDDDD" size="2">站点地图</FONT></A> &nbsp;| 
                 <A class="nodec" href="../indice.html"><FONT color=
                 "#DDDDDD" size="2">索引</FONT></A> &nbsp;| 
                 <A class="nodec" href="../Search/index.shtml"><FONT color=
                 "#DDDDDD" size="2">搜索</FONT></A> </TD>
                 
               </TR>

               <TR align="right">
                 <TD class="top">
                   <HR width="100%" noshade size="1">
                 </TD>
               </TR>
             </TABLE>
           </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end top navegation bar -->
 <!-- blue bar -->
 <TABLE summary="topbar_2" cellspacing="0" cellpadding="0" border="0" align="center"
 width="90%">
   <TR bgcolor="#00ffff">
     <TD><IMG src="../../common/images/transpix.gif" width="1" height=
     "2" alt=""></TD>
   </TR>
 </TABLE>
 <!-- end blue bar -->
 <!-- bottom navegation bar -->
 <TABLE summary="topbar_3" cellspacing="0" cellpadding="0" border="0" align="center"
 width="94%">
   <TR bgcolor="#000000">
     <TD>
       <TABLE summary="topbar_3_links" cellspacing="0" cellpadding="1" border="0" width=
       "100%">
         <TR align="center">
           <TD WIDTH="20%"><A class="nodec" href="../News/index.shtml"><FONT color=
           "#FFFFFF">新闻</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Archives/"><FONT color=
           "#FFFFFF">过往期刊</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Links/index.shtml"><FONT color=
           "#FFFFFF">链接</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../aboutus.html"><FONT color=
           "#FFFFFF">关于LF</FONT></A> </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end bottom navegation bar -->
<!-- stop navegation bar -->

<!-- SSI_INFO -->

<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfdynahead ver 1.5 --><TABLE ALIGN="right" border=0><TR><TD ALIGN="right"><FONT SIZE="-1" FACE="Arial,Helvetica">This document is available in: <A href="../../English/December2004/article354.shtml">English</a> &nbsp;<A href="../../ChineseGB/December2004/article354.shtml">ChineseGB</a> &nbsp;<A href="../../Deutsch/December2004/article354.shtml">Deutsch</a> &nbsp;<A href="../../Francais/December2004/article354.shtml">Francais</a> &nbsp;<A href="../../Italiano/December2004/article354.shtml">Italiano</a> &nbsp;<A href="../../Nederlands/December2004/article354.shtml">Nederlands</a> &nbsp;<A href="../../Portugues/December2004/article354.shtml">Portugues</a> &nbsp;<A href="../../Polish/December2004/article354.shtml">Polish</a> &nbsp;</FONT></TD></TR></TABLE><br>
 


<!-- SSI_INFO STOP -->
<!-- 2pdaIgnoreStop -->

<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_START -->
<TABLE ALIGN="LEFT" BORDER="0" WIDTH="195" summary="about the author" class="left">
<TR>
<TD>

<img src="../../common/images/BrunoSousa.jpg" alt="[Photo of the Author]" width="100" height="142">
<BR>by  Bruno Sousa <br> <small>&lt;bruno/at/linuxfocus.org&gt;</small>
<BR><BR>
<I>关于作者:</I><BR>
<!-- aboutauthor_start -->
<p>Bruno 是一个葡萄牙学生，在课余时间研究 Linux 和摄影技术。<br></p>
<!-- aboutauthor_stop -->
<!-- TRANSLATED_TO gb -->
<!-- TRANSLATED_TO_STOP -->
<!-- INDEX_START -->
<BR><i>目录</i>:
<UL>
  <LI><A HREF="#354lfindex0">SPF 有哪些需求？</A></LI>
  <LI><A HREF="#354lfindex1">SPF 的 TXT 记录</A></LI>
  <LI><A HREF="#354lfindex2">嘿！我是 ISP</A></LI>
  <LI><A HREF="#354lfindex3">有什么需要担心的?</A></LI>
  <LI><A HREF="#354lfindex4">结论</A></LI>
  <LI><A HREF="#354lfindex5">参考文献</A></LI>
  <LI><A HREF="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=354">对这篇文章发表评论</A></LI>
</UL>

</TD></TR></TABLE>
<!-- INDEX_STOP -->
<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_STOP -->
<!-- HEAD_OF_THE_ARTICLE_START -->
<br>&nbsp;
<table border="0"><tr><td>
<H2>SPF 简介</H2>
 <img hspace="10" alt="[Illustration]" src="../../common/images2/article354.gif" width="171" height="98">
<!-- ABSTRACT OF THE ARTICLE -->
<P><i>摘要</i>:
<P>
<!-- articleabstract_start -->

    SPF 是发送方策略框架 (Sender Policy Framework) 的缩写，希望能成为一个防伪标准，来防止伪造邮件地址。这篇文章对 SPF 进行了简单介绍，并介绍了它的一些优点和不足。
    <br>
<!-- articleabstract_stop -->

<br><!-- HR divider --><center><font color="#8282e0"><b>_________________ _________________ _________________</b></font></center><br>
</td></tr></table>
<!-- HEAD_OF_THE_ARTICLE_STOP -->
<!-- BODY_OF_THE_ARTICLE_START -->

      SPF 诞生于2003年，它的缔造者 Meng Weng Wong 结合了反向 MX 域名解析(Reverse MX) 和 DMP (Designated Mailer Protocol) 的优点而付予了 SPF 生命。
			<br>
			<br>
      SPF 使用电子邮件头部信息中的 return-path (或 MAIL FROM) 字段，因为所有的 MTA 都可以处理包含这些字段的邮件。不过微软也提出了一种叫做 PRA (Purported Responsible Address)的方法。PRA 对应于 MUA (比如 thunderbird) 使用的终端用户的地址。
			<br>
			<br>
      这样，当我们把 SPF 和 PRA 结合起来的时候，就可以得到所谓的“Sender ID”了。Sender ID 允许电子邮件的接收者通过检查 MAIL FROM 和 PRA 来验证邮件的合法性。有的说法认为，MAIL FROM 检查由 MTA 进行，而 PRA 检查由 MUA 来完成。
			<br>
			<br>
      事实上，SPF 需要 DNS 以某种特定的方式来工作。也就是必须提供所谓的“反向 MX 解析”记录，这些记录用来解析来自给定域名的邮件对应的发送主机。这和目前使用的 MX 记录不通，后者是用来解析给定域名对应的接收邮件的主机的。


    <A NAME="354lfindex0">&nbsp;</A>
<H2>SPF 有哪些需求？</H2>

    要想用 SPF 来保护你的系统，你必须：
<ol>
  <li>配置 DNS，添加 TXT 记录，用于容纳 SPF 问询的信息。</li>
  <li>配置你的电子邮件系统(qmail, sendmail)使用 SPF，也就是说对服务器上每封进入的邮件进行验证。</li>
</ol>

    上述第一步要在邮件服务器所属的域名服务器上进行调整，下一节中，我们将讨论这个记录的细节内容。你首先需要确定的一点是你的域名服务器(bind，djbdns)所使用的语法。但别担心，SPF 的官方网站提供了一个很好用的向导来指导你如何添加记录。

    <A NAME="354lfindex1">&nbsp;</A>
<H2>SPF 的 TXT 记录</H2>

    SPF 记录包含在一个 TXT 记录之中，格式如下：
<pre>
		v=spf1 [[pre] type [ext] ] ... [mod]
</pre>

<br>
    每个参数的含义如下表所示：
	<table border="1">
 		<tr><td><b><font size="4">参数</font></b></td>
			  <td> <b><font size="4">描述</font></b> </td>
    </tr>
    <tr><td> v=spf1 </td> <td> SPF 的版本。如果使用 Sender ID 的话，这个字段就应该是 v=spf2</td> </tr>
    <tr><td> pre    </td> <td> 定义匹配时的返回值。<br> <br>
        可能的返回值包括：
			<table>
			<tr><td><b>返回值</b></td> <td> <b>描述</b> </td></tr>
      <tr><td><b>+</b> </td> <td> 缺省值。在测试完成的时候表示通过。 </td></tr>
      <tr><td> <b>-</b> </td> <td> 表示测试失败。这个值通常是 -all，表示没有其他任何匹配发生。</td></tr>
      <tr><td> <b>~</b> </td> <td> 表示软失败，通常表示测试没有完成。</td></tr>
			<tr><td> <b>?</b> </td> <td> 表示不置可否。这个值也通常在测试没有完成的时候使用。</td></tr>
			</table>
		</td> </tr>

    <tr><td> type </td> <td> 定义使用的确认测试的类型。 <br><br>
        可能的值包括：
			<table colspan="2">
        <tr valign="top"><td><b>候选值</b></td> <td> <b>描述</b> </td></tr>
        <tr valign="top"><td>include </td> <td>
            包含一个给定的域名的测试<br>以 include:domain 的形式书写。
<br><br></td> </tr>
			<tr valign="top"><td>all</td> <td> 终止测试序列。<br>
          比如，如果选项是
          -all，那么到达这条记录也就意味着测试失败了。但是如果无法确定，可以使用"?all"来表示，这样，测试将被接受。
			<br><br></td> </tr>
      <tr valign="top"><td>ip4</td> <td> 使用 IPv4 进行验证。<br>
          这个可以以 ip4:ipv4 或 ip4:ipv4/cidr 的形式使用。建议使用这个参数，以减少域名服务器的负荷。
			<br><br></td> </tr>

			<tr valign="top"><td>ip6</td> <td> 使用 IPv6 进行验证。<br><br></td> </tr>

      <tr valign="top"><td>a</td> <td> 使用一个域名进行验证。<br>
          这将引起对域名服务器进行一次 A RR 查询。<br>
          可以按照 a:domain, a:domain/cidr 或 a/cidr 的形式来使用。
			<br><br></td> </tr>

			<tr valign="top"><td>mx</td> <td> 使用 DNS MX RR 进行验证。<br>
          MX RR 定义了收信的 MTA，这可能和发信的 MTA 是不同的，这种情况基于 mx 的测试将会失败。 <br>
          可以用 mx:domain, mx:domain/cidr 或 mx/cidr 这些形式进行 mx 验证。
			<br><br></td> </tr>

			<tr valign="top"><td>ptr</td> <td> 使用域名服务器的 PTR RR 进行验证。<br>
          这时，SPF 使用 PTR RR 和反向图进行查询。如果返回的主机名位于同一个域名之内，就验证通过了。<br>
          这个参数的写法是 ptr:domain
			<br><br></td></tr>

			<tr valign="top"><td>exist</td> <td> 验证域名的存在性。<br>
          可以写成 exist:domain 的形式。<br><br></td> </tr>

			</table>
		</td> </tr>

    <tr><td> ext </td> <td> 定义对 type
        的可选扩展。如果没有这个字段，那么仅使用单个记录进行问询。</td></tr>

    <tr><td> mod </td> <td> 这是最后的类型指示，作为记录的一个修正值。<br><br>

			<table>
        <tr valign="top"><td><b>修正值</b> </td> <td> <b>描述</b> </td> </tr>
		    <tr valign="top"><td> redirect </td> <td>
            重定向查询，使用给出的域名的 SPF 记录。<br>
            以 redirect=domain 的方式使用。<br><br></td> </tr>
        <tr valign="top"><td> exp</td> <td>
            这条记录必须是最后一条，允许给出一条定制的失败消息。<br>
<pre class=code>
<small>
IN TXT "v=spf1 mx -all exp=getlost.example.com"

getlost IN TXT "You are not authorized to send mail for the domain"
</small>
</pre>
<br>
				</td></tr>

			</table>
  </table>

  <A NAME="354lfindex2">&nbsp;</A>
<H2>嘿！我是 ISP</H2>

  ISP 实施 SPF 可能对于他们处于漫游状态(roaming)的用户带来一些麻烦，当这些用户习惯使用 POP-before-Relay 这样的方式处理邮件，而不是 SASL SMTP 的时候问题就会出现。
<br>
<br>
  嗯，如果你是一个被垃圾邮件、地址欺骗所困扰的 ISP 的话，你就必须考虑你的邮件策略、开始使用 SPF 了。
<br>
<br>
  这里是你可以考虑的几个步骤。
<ol>
  <li>首先设置你的 MTA 使用 SASL，比如，你可以在端口 25 和 587 使用它。</li>
  <li>告诉你的用户你已经使用了这个策略(spf.pobox.com 给出了一个通知的例子，参见参考文献)。</li>
  <li>给你的用户一个宽限期，也就是说，把你的 SPF 记录加入到域名服务器之中，但使用“软失败”(~all)而不是“失败”(-all)。</li>
</ol>

  <p>这样，你就保护了你的服务器、你的客户和整个世界免受垃圾邮件之类的困扰了。

  <p>SPF 的官方站点上有很多信息，还等什么呢？


    <A NAME="354lfindex3">&nbsp;</A>
<H2>有什么需要担心的?</H2>

    SPF 是一个对于欺骗的完美保护。但它有一个局限：传统的邮件转发方式不再有效了。你不能仅仅从你的 MTA 接受邮件并简单地重新发送它了。你必须重写发送地址。常见的 MTA 的补丁可以在 <a href="http://spf.pobox.com/downloads.html"> SPF 的网站</a>找到。换句话说，如果你把 SPF 记录加入到了域名服务器，你就必须更新你的 MTA 来进行发送地址改写，即使你还没有对 SPF 记录进行检查。

    <A NAME="354lfindex4">&nbsp;</A>
<H2>结论</H2>

    <p>你可能觉得 SPF 的实施有点难以理解。不过这确实不算复杂，而且还有一个不错的向导来帮你完成这个转换(参见参考文献)。

    <p>如果你被垃圾邮件所困扰的话，SPF 将可以帮助你，保护你的域名免受伪造邮件地址的影响，你所要做的仅仅是在域名服务器上添加一行文本并配置你的电子邮件服务器而已。

    <p>SPF 的优点有很多。不过，像我对一些人所说的，这不是一夜之间就可以达到的，SPF 的好处将通过日积月累来表现出来，当其他人都使用它的时候就能明显地看到了。

    <p>我也提到了 Sender ID，这和 SPF 有关，但我没有去解释它。可能你已经知道原因了，微软的策略一向如此---软件专利。在参考文献中，你可以看到 openspf.org 对于 Sender ID 的立场声明。

    <p>下一篇文章中，我们将讨论 MTA 的设置，我们到时再见。

    <p>我仅仅希望给你一个 SPF
    的简短说明。如果你对此感兴趣，想要了解更多信息的话，你可以看看参考文献，本文的内容就来自于此。

<A NAME="354lfindex5">&nbsp;</A>
<H2>参考文献</H2>

	 <a href="http://spf.pobox.com">SPF 官方网站。</a>
<br>
	 <a href="http://spf.pobox.com/faq.html">SPF 官方 FAQ。</a>
<br>
	 <a href="http://spf.pobox.com/wizard.html">SPF 官方向导。</a>
<br>
	 <a href="http://www.openspf.org/OpenSPF_community_position_v101.html">
     openspf.org 对于 SenderID 的立场</a>
<br>
	 <a
     href="http://trends.newsforge.com/article.pl?sid=04/08/26/1326244&amp;tid=29">一篇关于
     Sender ID 和 SPF 的不错的文章。</a>
<br>
	 <a href="http://spf.pobox.com/saslconversion.html">转向 SASL 时对用户提出警示</a>
<br>
		<a href="http://www.zytrax.com/books/dns/ch9/spf.html">HOWTO - 定义
      SPF 记录</a>
<br>
     <!-- vim: set sw=2 ts=2 et tw=74: -->
  



<!-- BODY_OF_THE_ARTICLE_STOP -->
<!-- 2pdaIgnoreStart -->
<A NAME="talkback">&nbsp;</a>
<h2>对这篇文章发表评论</h2>
每篇文章都有各自的反馈页面。在这个页面里，您可以提交评论，也可以查看其他读者的评论：
<center>
    <table width="250" border=0><tr><td>
    <div class="tbbutton"><A class="nodec" href="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=354">&nbsp;反馈页面&nbsp;</a></div>
    </td></tr></table>
</center>

<br clear="all">
<HR size="2" noshade>
<table width="250" border=0><tr><td>
<div class="bbutton"><a class="nodec" href="../../index.shtml">&lt;--, LF 首页</a></div>
</td><td>
<div class="bbutton"><a class="nodec" href="index.shtml">Go to the index of this issue</a></div>
</td></tr></table>
<br clear="all">
<HR size="2" noshade>
<!-- ARTICLE FOOT -->
<CENTER><TABLE WIDTH="98%" summary="footer">
<TR><TD ALIGN=CENTER BGCOLOR="#bdc6d5" WIDTH="50%">
<A HREF="../../common/lfteam.html">主页由LinuxFocus编辑组维护</A>
<BR><FONT COLOR="#1111aa"><a href="../../common/copy.html">&copy; Bruno     Sousa</a><br>&quot;some rights reserved&quot; see <a href="../../license/index.shtml">linuxfocus.org/license/</a><br><a href="http://www.linuxfocus.org">http://www.LinuxFocus.org</a></FONT>
</TD>
<TD BGCOLOR="#bdc6d5">
<!-- TRANSLATION INFO -->
<font size=2>翻译信息:</font>
<TABLE summary="translators">
  <tr><td><font size="2">en --&gt; -- : Bruno Sousa <small>&lt;bruno/at/linuxfocus.org&gt;</small></font></td></tr>
  <tr><td><font size="2">en --&gt; cn: 王旭(Wang Xu) &lt;wangxu(at)linuxfocus.org&gt;</font></td></tr>
</TABLE>
</TD>
</TR></TABLE></CENTER>
<p><font size=1>2004-12-18, generated by lfparser version 2.51</font></p>
<!-- 2pdaIgnoreStop -->
</BODY>
</HTML>
