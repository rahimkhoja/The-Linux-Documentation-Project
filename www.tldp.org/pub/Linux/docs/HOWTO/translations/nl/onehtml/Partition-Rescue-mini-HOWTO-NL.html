<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Partitie Rescue mini HOWTO</TITLE>


</HEAD>
<BODY>
<H1>Partitie Rescue mini HOWTO</H1>

 
<H2>Jean-Daniel Dodin, vertaald door Ellen Bokhorst</H2>jan 22, 2000 - do005722_partition_03
 
<P><HR>
<EM>Wauw ! mijn disk is leeg ! Linux is weg ! Als je vreest
op een dag met een dergelijk of ander probleem te worden geconfronteerd,
lees dit dan...
 </EM>
<HR>
<H2><A NAME="s1">1. Wat staat er in</A></H2>

<P>Deze mini-HOWTO richt zich alleen tot het "lost partition table" probleem.
Dit kan zo zijn wanneer:
<P>
<UL>
<LI>je geen toegang meer hebt tot je computer, met de melding "no operating system",</LI>
<LI>je een nieuw systeem (bv windows) hebt ge&iuml;nstallerd) en Linux niet
meer ziet, en windows de gehele capaciteit van de disk in beslag neemt.</LI>
</UL>
<P>Hier zal je leren dat als je het juiste weet en het toepast, Linux 
gewoonlijk veilig uit dergelijke situaties komt. 
<P>We zullen eerst bekijken wat je kunt doen <EM>voordat</EM> het probleem zich
voordoet om een toekomstig herstel te vereenvoudigen en wat je 
<EM>na</EM> het herstel moet doen. Er is weinig aan te doen om het verwijderen
van een disk te voorkomen, meestal gebeurt dit automatisch door windows of
een Linux installatie met niet juist functionerende programma's of fouten
van gebruikers - er kan niets worden gedaan om dit te voorkomen behalve
voorzichtig te zijn, maar dat ben je al, nietwaar?
<P>Het kan ook gebeuren door het gebruik van MSDOS/Windows fdisk. Vermijd dit
zoveel je kan, maar waarschijnlijk kun je dat niet.
<P>Ik heb dit heel wat keren gedaan, op mijn computer en op die van anderen, en
wist Linux meestal en soms ook windows te herstellen.
Ik wens je geluk!
<H2><A NAME="s2">2. Wat nu te doen?</A></H2>

<P>Als je dit uit nieuwsgierigheid leest of slechts op zoek bent naar informatie
en je bevindt je op een Linux-systeem, doe dan onmiddellijk het volgende:
<P>
<UL>
<LI>open een root terminal of xterm,</LI>
<LI>typ in "/sbin/fdisk -l" </LI>
</UL>
<P>je zal worden beloond op een lijst met alle huidige partities op alle disks
die op je computer aanwezig zijn.
<P>
<UL>
<LI>Schrijf dit op een stuk papier (of geef op "/sbin/fdisk -l | lpr" om het af
te drukken) en bewaar het voor toekomstig gebruik op een veilige plaats.</LI>
</UL>
<P>Als je geen systeembeheerder bent, zou je je over dit probleem geen zorgen
hoeven maken en kun je ophouden met dit te lezen.
<H2><A NAME="s3">3. Wettige zaken</A></H2>

<P>Deze mini-HOWTO valt onder het Copyright (c) 2000 door Jean-Daniel Dodin.
Alle rechten voorbehouden. Je mag er (bijna) alles mee doen wat je wilt.
Het maakt me niet uit. Zorg er alleen voor dat mijn naam intact blijft.
Ik hoop slechts dat het voor iemand in de Linux-gemeenschap bruikbaar zal zijn.
<P>Ik ben niet verantwoordelijk voor enige schade aan computers als
resultaat van het lezen van deze HOWTO.
Als je enige schade veroorzaakt, _is het je EIGEN fout, NIET DE MIJNE!_
Wees voorzichtig bij het partitioneren van disks, en maak geen vergissingen,
omdat het fataal kan zijn! Maak van al je belangrijke gegevens een backup
en controleer dat alles wat je doet juist is! Wat hier wordt beschreven,
werkte op mijn computer, maar het werkt mogelijk wel of niet op jouw computer.
Alhoewel het voor iedereen zou moeten werken, kan ik je niets
garanderen. Dit is de laatste waarschuwing die je krijgt: _MAAK EEN BACKUP
VAN BELANGRIJKE GEGEVENS!_
Of kort gezegd: Gebruik het op eigen risico!
<H2><A NAME="s4">4. Wat moet ik op 't moment weten?</A></H2>

<P>Je <EM>moet</EM> weten dat je in geval van enig belangrijk probleem met je
harddisk <EM>moet</EM> stoppen het in 't geheel te gebruiken in 
<EM>write</EM> mode, tenminste de tijd die nodig is om te begrijpen wat er
aan de hand is. De informatie erop is zeer kwetsbaar...
<P>Als je ooit op een morgen wakker wordt, je computer aangeeft "can't load,
no system installed", dan <EM>moet je niet beginnen met alles opnieuw
te installeren</EM>.
<P>Als je windows hebt ge&iuml;nstalleerd, kan ik je niet beloven dat je je
gegevens terug kunt krijgen, maar het is waarschijnlijk dat je al je Linux
spul kunt herstellen, op voorwaarde dat het zich niet te laag in de
diskstructuur bevindt. Dit is omdat een aantal windows virussen al hetgeen
zich op de allereerste diskcylinder bevindt, verwijdert. Ik heb echter nog
nooit met een dergelijk virus ge&euml;xperimenteerd en kan het niet met
zekerheid zeggen. Probeer het in ieder geval te herstellen.
<P>Je moet ook weten dat ik je al deze informatie alleen verstrek met informatie
als doel. Noch ik noch enige andere mensen behalve jijzelf kunnen 
verantwoordelijk worden gesteld voor enig probleem dat er zich met je
gegevens voor kan doen door het gebruik van deze info. Er zijn te veel 
verschillende systemen in de wereld voor dat ook maar iemand iets kan beloven.
Ik kan je slechts geluk wensen en hopen, dat je me aardig vindt, blij zult zijn
gegevens te kunnen herstellen.
<H2><A NAME="s5">5. Disks</A></H2>

<P>Een harddisk is opgebouwd uit sectoren genummerd van 0 tot aan het maximum.
<P>dmesg geeft bijvoorbeeld:
<P>hdb: ST34321A, 4103MB w/128kB Cache, CHS=523/255/63
<P>CHS staat voor Cylinders, Heads, Sectoren.
<P>523*255*63=8401995 sectoren van 512 bytes, dus de 4103Mbytes. Dit is slechts
een logische indeling, het hoeft niet noodzakelijk hetgeen te zijn wat 
(afgezien van de totale grootte) op de ombouw van de disk is geschreven.
<P>De werkelijke grootte van de sectoren is voor ons niet interessant, gegeven
dat we niets willen wijzigen, maar een voorgaande staat willen herstellen.
Voor ons is de door fdisk gegeven grootte prima.
<P>De grootte gezien door het systeem is direct afhankelijk van het werk van de
BIOS (Basic Input/Output System - de PC's ROM). De mode van de harddisk
aangegeven in de BIOS is essentieel. Het is op een nieuwe disk beter gebruik
te maken van de automatische harddisk herkenning van de BIOS en "yes" te
antwoorden. Hoe dan ook, iedere wijziging op dit niveau kan alle gegevens
van de disk ru&iuml;neren, dus speel hier niet zonder belangrijke reden mee.
<P>Dit is waarschijnlijk waar je disk gebruik van maakt, dus maak je niet
ongerust.
<H2><A NAME="s6">6. Partities</A></H2>

<P>Disks zijn momenteel groot, 13 Gb is niet zeldzaam, dus het is niet handig
alles in slechts &eacute;&eacute;n deel te hebben.
Alleen windows doet dit, en als je Linux gebruikt, kan dit zo zjn omdat
je er niet bewust van bent hoe ineffeci&euml;nt het andere is.
<P>Dus een harddisk is gewoonlijk in een aantal stukken onderverdeeld die
"partities" worden genoemd (zie de "partitie mini HOWTO" voor details, en
lees ook /usr/doc/package/util/README.fdisk)
<P>Laten we eens kijken naar een (deel van) mijn eigen afdruk van fdisk -l :
<P>Disk /dev/hdb: 255 heads, 63 sectors, 523 cylinders Units = cylinders of
16065 * 512 bytes 
<P>Device Boot Start End Blocks Id System 
<P>/dev/hdb1 1 153 1228941 83 Linux 
<P>/dev/hdb2 154 166 104422+ 82 Linux swap 
<P>/dev/hdb3 * 167 291 1004062+ 83 Linux 
<P>/dev/hdb4 295 523 1839442+ 5 Extended 
<P>/dev/hdb5 295 422 1028128+ 83 Linux 
<P>/dev/hdb6 423 523 811251 6 FAT16 
<P>Dit is mijn tweede harddisk, gebonden aan gissingen en uitprobeersels
(de eerste is te eenvoudig en dus niet interessant).
<P>/dev/hdb is mijn tweede ide-disk (slave op de primaire interface),
<P>/dev/hdb1 is de eerste primaire partitie, draaiend vanaf het eerste (1) blok
tot blok 153.
<P>Er kunnen vier van dergelijke primaire partities zijn. Als iemand er meer dan
4 wil, moet &eacute;&eacute;n ervan een "extended" partitie zijn (niet
noodzakelijkerwijs de vierde) en alle andere partities worden "logical"
genoemd en deze bevinden zich <EM>binnenin</EM> de extended partitie. Merk op
dat partitienummer 5 en partitienummer drie hetzelfde begin hebben.
Nummer vijf is logical, nummer 4 extended. Logische partities beginnen altijd
op 5, zelfs als er geen 4 primaire partities zijn.
<H2><A NAME="s7">7. Waarom is er een probleem?</A></H2>

<P>Het probleem is dat alle ge&iuml;nstalleerde Besturingssystemen de disks
moeten delen en bij de start kan de bios alleen de eerste scannen, er moet
een zogeheten "partitietabel" zijn aan het allereerste begin van deze disk.
Deze partitietabel is te vinden in de Master Boot Record (MBR) naast de
bootloader.
<P>Enig onjuist gebruik van de MBR door &eacute;&eacute;n van de OS'sen leidt
tot problemen. Bij het trachten te installeren van enig systeem, een ja
antwoord op een vraag als "automatische partitionering?" zal zeer
waarschijnlijk problemen opleveren... Dit geldt vooral met windows,
vooral bij een aangepaste windows installatie die door speciaal gefabriceerde
PC's worden uitgevoerd.
(wanneer er geen echte "windows" cd is ingesloten).
Maar gebeurt tevens bij nieuwe "slimme" (niet zo slimme!) Linux installatie
programma's die met de meeste recente distributies worden meegegeven.
<H2><A NAME="s8">8. Oplossen van het probleem</A></H2>

<P>Let alsjeblieft op! De hieropvolgende gegeven uitleg zal je terugleiden naar
een vorig systeem, waarbij je alles op je recent ge&iuml;nstalleerde systeem
verliest, als daar iets op staat!
Je moet kiezen...
<H2>8.1 Het eenvoudiger geval</H2>

<P>Alles is eenvoudig als je het bij de hand hebt:
<P>
<UL>
<LI>een disk (diskette of cd) waarmee het mogelijk is Linux zelf op te laten
starten met fdisk beschikbaar
- met de meeste rescue-disks van enige distributie kan dit,</LI>
<LI>een stuk papier met daar de inhoud van fdisk -l op geschreven.</LI>
</UL>
<P>Het is voldoende
<P>
<OL>
<LI>Linux te starten,</LI>
<LI>fdisk /dev/hda te starten (of welke disk je dan ook wilt herstellen),</LI>
<LI>fdisk te gebruiken om (met de optie d) alle bestaande partities op de
beschadigde disk te verwijderen,</LI>
<LI>fdisk te gebruiken om alle primaire (1-4) partities op het stukje papier
opgeschreven, aan te maken,</LI>
<LI>ze de van toepassing zijnde tag (t optie) te geven: 82 is voor Linux swap,
83 voor Linux main (L geeft je een lijst), 5 is extended en moet worden
gedaan voor het aanmaken van de logische partities,</LI>
<LI>het aanmaken van enige logische partities.</LI>
</OL>
<P>fdisk is een klein en zeer slim programma. Er zijn van fdisk diverse
maaksels, maar ik geef altijd de voorkeur aan het allernoodzakelijkste
(ik heb het hier over die van Linux uiteraard, niet de anderen...).
<P>Wees je ervan bewust dat fdisk niets naar disk wegschrijft totdat je de
w en return aanslaat.
Voor het geval je vreest een fout te maken, tik de q (quit) in of 
Ctrl C (\^{ }C) om veilig te stoppen.
<P>Wanneer je nieuwe partitietabel is weggeschreven, start je Linux. De kans
bestaat dat je dat niet zoals gebruikelijk kunt doen: mogelijk is ook lilo
beschadigd en zal je een bootdiskette nodig hebben of vanaf een cd moeten
booten (kies de optie "booting the installed partition").
<P>Als je lilo gebruikt om te booten, toets je "lilo" in zodra je als root
bent ingelogd en druk je op de return om je favoriete bootloader te
herinstalleren.
<P>Je Linux zou daar helemaal moeten zijn, test het. 
Probeer zover van toepassing ook windows te starten.
Als je dit niet kunt, bestaat er een (zeer kleine) kans dat je de gegevens
vanuit Linux kunt lezen, misschien door het lezen van  
raw sector per sector. Als je de disksectors waarop je gegevens zich
bevinden niet kunt identificeren, gebruik dan dd om ze naar een bestand
te kopi&euml;ren. Dit is alleen verstandig voor tekst.
Dit herstel valt NIET binnen het kader van deze mini-HOWTO.
<H2>8.2 Een niet zo eenvoudige situatie</H2>

<H3>Met de hand</H3>

<P>Dit is wanneer de voorgaande situatie niet kan worden gebruikt, vanwege
het ontbreken van de uitvoer van fdisk op een stuk papier of 
als je een verouderde uitdraai hebt.
<P>Houdt als eerste in de gaten dat zolang je niets naar disk wegschrijft, je
je gegevens niet kunt verwijderen (behalve met fdisk), dus kun je het
blok per blok proberen.
Dat wil zeggen dat je het begin van de partitie moet weten. Als, laten we
zeggen een 153 niet werkt, probeer dan een 154, enzovoort.
<P>Dit kan vervelend zijn, maar als je bij benadering de grootte van de 
Linux-partitie weet, bestaat er een kans op herstel.
<H3>gpart</H3>

<P>Maar er is een betere manier als je het net nog steeds kunt benaderen of
als je "gpart" bij de hand hebt.
<P>"gpart - raadt naar PC-type harddiskpartities" geeft de eerste regel van de
manpage van gpart (man gpart) aan.
<P>"gpart probeert te gissen welke partities op een harddisk voorkomen. Als de
primaire partitietabel verloren is gegaan, is overschreven of geru&iuml;neerd
komen de partities nog steeds op de disk voor, maar kan het besturingssysteem
ze niet benaderen." Dit is precies wat we nodig hebben.
<P>gpart is nog steeds in beta, maar het is reeds een zeer goede tool.
<P>Het probleem is als volgt: het eerste blok van iedere partitie is gemarkeerd.
Maar als het niet is overschreven wordt het nooit "gedemarkeerd". Dus op een
oude disk komen veel
"eerste partitieblokken" voor en gpart probeert naar beste kunnen te gissen
welke de goede is. In feite is het niet zo moeilijk uit te proberen, er wordt
door gpart niets naar disk weggeschreven.
<P>Hier is het resultaat van gpart over de voorheen bekeken disk hdb:
<P>root@charles:/home/jdd &gt; gpart /dev/hdb
<P>Begin scan... 
<P>Possible partition(Linux ext2), size(1200Mb), offset(0Mb) 
<P>Possible partition(Windows NTFS), size(1200Mb), offset(1200Mb) 
<P>Possible partition(Linux ext2), size(1004Mb), offset(2402Mb) 
<P>Possible partition(Windows NTFS), size(1600Mb), offset(4102Mb) 
<P>End scan.
<P>Checking partitions...
<P>* Warning: partition(OS/2 HPFS, NTFS, QNX or Advanced UNIX) ends beyond
disk end . 
<P>Partition(Linux ext2 filesystem): primary 
<P>Partition(OS/2 HPFS, NTFS, QNX or Advanced UNIX): primary 
<P>Partition(Linux ext2 filesystem): primary 
<P>Partition(OS/2 HPFS, NTFS, QNX or Advanced UNIX): invalid primary 
<P>Ok.
<P>Guessed primary partition table:
<P>Primary partition(1) 
<P>type: 131(0x83)(Linux ext2 filesystem) 
<P>size: 1200mb #s(2457880) s(63-2457942) 
<P>chs: (0/1/1)-(152/254/61)d (0/1/1)-(152/254/61)r 
<P>Primary partition(2) 
<P>type: 007(0x07)(OS/2 HPFS, NTFS, QNX or Advanced UNIX) 
<P>size: 1200mb #s(2457880) s(2457944-4915823) 
<P>chs: (152/254/63)-(305/253/60)d (152/254/63)-(305/253/60)r 
<P>Primary partition(3) 
<P>type: 131(0x83)(Linux ext2 filesystem) 
<P>size: 1004mb #s(2056256) s(4919781-6976036) 
<P>chs: (306/61/49)-(434/60/47)d (306/61/49)-(434/60/47)r 
<P>Primary partition(4) 
<P>type: 000(0x00)(unused) size: 0mb #s(0) s(0-0) chs: (0/0/0)-(0/0/0)d
(0/0/0)-(0/0/0)r 
<P>Zoals je kunt zien, kunnen primaire partities worden hersteld, maar 
extended partities niet.
<P>Dos partities zijn gelabeld met "windows NTFS" omdat ze werden aangemaakt
tijdens een poging Windows 2000 te installeren
(een zeer vervelende ervaring !). De "invalid" partitie is in feite de
extended partitie.
<P>Hiermee kan men met fdisk proberen de partitietabel opnieuw aan
te maken (denk eraan dat dit zonder risico is aangezien het origineel reeds
verloren is gegaan).
<H2>8.3 Het betere geval</H2>

<P>Partition Magic is een commercieel product, niet zo goedkoop gezien het 
weinige dat men ermee kan
(in Frankrijk bij benadering honderd dollar), maar met een zeer hoge
reputatie. Ik gebruik het echter nooit en zal er geen
waarde aan toekennen. Er wordt van gezegd dat het met partities alles kan
doen, inclusief het herstellen ervan. Het is echter een windows-tool, en ik
weet niet of er een dos-variant van is. Als men voor het gebruik van
Partition magic, windows moet installeren, is de belangstelling er niet
groot voor.
<P>De oorspronkelijke partition-rescue mini HOWTO van Ralf was in belangrijke
mate gebaseerd op het gebruik van Partition Magic, dus veronderstel dat het
een zeer goede oplossing is als je waardevolle gegevens op je Linux-partitie
hebt en niet veel Linux-capaciteiten. Er zijn nu echter zeer recente
maaksels van Partition Magic en ik denk dat het beter is als je
de handleiding leest.
<H2><A NAME="s9">9. Auteurs</A></H2>

<P>De auteur van deze HOWTO is Jean-Daniel Dodin. 
Ik ben te bereiken via jdanield@free.fr
of via jdanield@linux-france.org of jdanield@club-internet.fr.
<P>Mijn website is nu (januari 20, 2000) te vinden op 
http://perso.club-internet.fr/jdanield,
maar mogelijk is het spoedig te vinden op jdanield.free.fr of enig
persoonlijk adres gegeven door www.free.fr IAP. Linux pages, die voor jou
van het meeste belang zijn, zijn te vinden op www.linux-france.fr/article/jdanield.
<P>Ik wil Rolf Klausen (E-mail: rolfk@romsdal.vgs.no http://www2.romsdal.vgs.no/~rolfk/) bedanken wie de vorige partition-rescue mini HOWTO schreef, zelfs
al herschreef ik het bijna volledig, hij had als eerste het goede idee.
<P>Ieder ander lid van de Linux-gemeenschap en iedereen die Linux ondersteunt
en documentatie en programma's voor Linux schrijft en alle auteurs van de
LDP en praktisch iedereen die ook maar betrokken is in alles dat met Linux
heeft te maken.
In het bijzonder Linus B. Thorvalds - hij is _The King_ !!! 
<P>Ik wil ook Michail Brzitwa &lt;mb@ichabod.han.de&gt; bedanken; voor het
schrijven van gpart !
<H2><A NAME="s10">10. Meest recente versie</A></H2>

<P>De meest recente versie van deze mini-HOWTO is te vinden op mijn
Linux website op www.linux-france/article/jdanield/.
</BODY>
</HTML>
