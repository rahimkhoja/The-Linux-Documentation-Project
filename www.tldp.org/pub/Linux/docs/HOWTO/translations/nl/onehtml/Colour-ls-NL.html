<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Kleuren met Linux terminals</TITLE>


</HEAD>
<BODY>
<H1>Kleuren met Linux terminals</H1>

<H2>Thorbj&oslash;rn Ravn Andersen, <CODE>ravn@dit.ou.dk</CODE><BR>
Vertaald door: Ellen Bokhorst, bokkie@nl.linux.org</H2>v1.4, 7 augustus 1997
<P><HR>
<EM>De meeste Linux distributies hebben een '<CODE>ls</CODE>' opdracht voor het
weergeven van de inhoud van een directory. Hiermee kan de uitvoer visueel
worden versterkt door van verschillende kleuren gebruik te maken,
maar het configureren om 't uit te proberen zou weleens niet zo'n
alledaagse taak kunnen zijn. Dit document legt de diverse aspecten uit en
de eerste stappen in het wijzigen van de setup door het configureren
van bestaande software. Het geeft de lokaties van alternatieve software, die in het algemeen niet mee worden geleverd met Slackware of RedHat en die
met de meeste versies van Unix kunnen worden gebruikt.
De HTML versie is ook beschikbaar vanaf mijn eigen bron op
<A HREF="http://www.mip.ou.dk/~ravn/colour-ls">http://www.mip.ou.dk/~ravn/colour-ls</A>.</EM>
<HR>
<H2><A NAME="s1">1. Introductie</A></H2>

<P>In de afgelopen jaren zijn kleurenschermen zeer gewoon geworden,
en gebruikers beginnen dit uit te buiten door programma's te gebruiken
die kleuren aanwenden om een snelle visuele terugkoppeling te geven op
b.v. gereserveerde sleutelwoorden in programmeertalen, of directe
kennisgeving van onjuist gespelde woorden.
<P>Aangezien de Linux tekstconsole kleur ondersteunt, werd de GNU ls
snel gewijzigd om kleurenuitvoer te ondersteunen en werd dit
aan Slackware rond versie 2.0 toegevoegd. Verbeterde versies van 
deze patches zijn nu verhuisd naar de standaard GNU-distributie 
van ls, en zouden daarom nu onderhand onderdeel van alle nieuwe 
Linux-distributies moeten zijn.
<P>Deze revisie is een update van een belangrijk herschrijven van
de initi&euml;le release, inclusief informatie over xterms en
het patchen van de kernel.
<P>De informatie in dit document is bevestigd voor Redhat 4.1, en is
van origine gecompileerd met de 2.0.2 release van Slackware, en de
1.1.54 kernel. De informatie over de kernel-patch werd verkregen met
slackware 2.2.0 met de 1.2.13 kernel, met tcsh als de standaard-shell,
en later bevestigd met een 2.0.27 kernel. Als je een andere configuratie
of unix versie gebruikt, zou ik een notitie met vermelding van je
besturingssysteem en versie, en of kleurenondersteuning standaard wordt
ondersteund, waarderen.
<H2><A NAME="s2">2. Snelle start voor de ongeduldigen</A></H2>

<P>Wijzig de volgende bestanden in je home-directory, als je 
een <EM>nieuwe</EM> Linux-distributie hebt.
Ze hebben na de volgende login effect.
<P>
<BLOCKQUOTE><CODE>
<PRE>
~/.bashrc:
    alias ls="ls &hyphen;&hyphen;color"

~/.cshrc:
    alias ls 'ls &hyphen;&hyphen;color'
    
</PRE>
</CODE></BLOCKQUOTE>
<P>Dat is het!
<P>Het kan zijn dat je ook een ``<CODE>eval `dircolors
$HOME/.colourrc`</CODE>'' wilt doen, om je eigen kleuren te krijgen.
Dit bestand is aangemaakt met ``<CODE>dircolors -p >$HOME/.colourrc</CODE>'' en is rijk van commentaar voorzien voor verdere wijziging.
<H2><A NAME="s3">3. Heb ik het allemaal?</A></H2>

<P>Als eerste moet je weten of je een <CODE>ls</CODE> versie hebt die weet
hoe het op de juiste wijze kleuren toe moet kennen.
Probeer de volgende opdracht in een Linux tekstconsole
(alhoewel ook een xterm voldoet):
<P>
<BLOCKQUOTE><CODE>
<PRE>
% ls &hyphen;&hyphen;color
</PRE>
</CODE></BLOCKQUOTE>
<P>(de <CODE>%</CODE> is een shell-prompt):
<P>Als je een foutmelding krijgt die aangeeft dat <CODE>ls</CODE> de
optie niet begrijpt, zul je een nieuwe versie van het GNU fileutils
package moeten installeren.
Als je geen geschikt upgrade package voor je distributie hebt, 
dan kun je de laatste versie gewoon bij je GNU
mirror ophalen en deze direct van de bron installeren.
<P>Als je <EM>geen</EM> foutmelding krijgt, heb je een <CODE>ls</CODE>
die de opdracht begrijpt. Helaas bevatten een aantal van de eerdere
versies, waaronder de bij Slackware (en mogelijk anderen) geleverde
versies, fouten. De <CODE>ls</CODE> geleverd bij Redhat 4.1 is versie 
3.13 en deze is okay.
<P>
<BLOCKQUOTE><CODE>
<PRE>
% ls &hyphen;&hyphen;version
ls - GNU fileutils-3.13
</PRE>
</CODE></BLOCKQUOTE>
<P>Als je de opdracht ``<CODE>ls &hyphen;&hyphen; color</CODE>'' onder
Linux op een op tekst gebaseerde console uitvoerde, zou de uitvoer van kleuren
moeten zijn voorzien, overeenkomstig de standaardwaarden op het systeem,
en kun je nu beslissen of er iets is dat je wilt veranderen.
<P>Als je het in een xterm uitvoerde, kan het zijn dat je wel of geen 
kleurwijzigingen zag. Net als met <CODE>ls</CODE> zelf, gaf het originele
xterm-programma geen enkele ondersteuning voor kleur voor de
programma's die daaronder draaide, maar recente versies doen dit wel.
Als je xterm geen kleuren ondersteunt, zou je een nieuwe versie zoals
beschreven aan het einde van dit document, op moeten halen.
Schakel in de tussentijd gewoon naar tekstmode en ga van daaruit verder.
<H2><A NAME="s4">4. Uit welke kleuren kun je kiezen?</A></H2>

<P>Dit shell-script (met dank aan de velen die me bash versies opstuurden) toont
alle standaard kleurencombinaties op de huidige console. Als er geen
kleuren tevoorschijn komen, ondersteunt je console geen ANSI kleuren
selecties.
<P>
<BLOCKQUOTE><CODE>
<PRE>
#!/bin/bash
# Toon ANSI kleuren.
#
esc="\033["
echo -n " _ _ _ _ _40 _ _ _ 41_ _ _ _42 _ _ _ 43" 
echo "_ _ _ 44_ _ _ _45 _ _ _ 46_ _ _ _47 _"
for fore in 30 31 32 33 34 35 36 37; do
  line1="$fore  " 
  line2="    "
  for back in 40 41 42 43 44 45 46 47; do
    line1="${line1}${esc}${back};${fore}m Normal  ${esc}0m"
    line2="${line2}${esc}${back};${fore};1m Bold    ${esc}0m"
  done
  echo -e "$line1\n$line2"
done
</PRE>
</CODE></BLOCKQUOTE>
<P>Het nummer van de voorgrondkleur wordt links getoond, 
en het nummer van de achtergrond in de omlijning.
Als je benadrukte tekens wilt, voeg je een "1" toe aan de
parameters, dus helder blauw op wit is dan "37;44;1". De hele ANSI
selectie reeks is dan 
<PRE>
ESC [ 3 7 ; 4 4 ; 1 m
</PRE>
<P>Opmerking: De achtergrond kan thans niet benadrukt zijn, dus je kunt geel
alleen als voorgrondkleur hebben.
(benadrukt bruin). Dit is een beperking van de hardware.
<P>
<PRE>
De kleuren zijn:
        0 - zwart    4 - blauw         3# is voorgrond
        1 - rood     5 - magenta       4# is achtergrond
        2 - groen    6 - cyan
        3 - geel     7 - wit           ;1 is benadrukt
</PRE>
<H2><A NAME="s5">5. Hoe kleuren te configureren met ls</A></H2>

<P>
<P>Als je de in <CODE>ls</CODE> ingebouwde standaardkleurenset wilt wijzigen,
heb je een persoonlijke kopie ervan in je home-directory nodig, die je
kunt krijgen met
<BLOCKQUOTE><CODE>
<PRE>
cd ; dircolors -p > .coloursrc 
</PRE>
</CODE></BLOCKQUOTE>
<P>Na het wijzigen van dit goed-becommentarieerde bestand
zul je het in de omgevingsstring LS_COLORS moeten laten lezen,
wat gewoonlijk wordt bewerkstelligd met
<BLOCKQUOTE><CODE>
<PRE>
eval `dircolors .colourrc`
</PRE>
</CODE></BLOCKQUOTE>
<P>Je moet deze regel in je
.bashrc/.cshrc/.tcshrc (afhankelijk van je shell) plaatsen, om dit bij 
iedere login te laten doen.  
Zie de dircolors(1) manual page voor details.
<H2><A NAME="s6">6. Hoe de standaard wit-op-zwart tekstmode te wijzigen</A></H2>

<P>Je zult de terminal driver code moeten laten weten dat je een andere
standaard wilt. Er bestaat geen standaard manier waarop je dit kunt
doen, maar onder Linux heb je het setterm programma.
<P>"setterm" gebruikt de informatie in de terminal database om de 
kenmerken in te stellen.
Selecties maak je bijvoorbeeld als volgt 
<BLOCKQUOTE><CODE>
<PRE>
setterm -foreground black -background white -store
</PRE>
</CODE></BLOCKQUOTE>
<P>waar "-store" naast de feitelijke wijzigingen ervoor zorgt dat het 
ook de standaard wordt voor de huidige console.
Dit vereist dat de huidige terminal
(TERM omgevingsvariabele) "goed genoeg" is beschreven in de termcap
database. Als setterm om wat voor reden dan ook niet werkt, zijn hier
een aantal alternatieven:
<H2>6.1 Xterm</H2>

<P>E&eacute;n van deze xterms zou beschikbaar moeten zijn
en tenminste &eacute;&eacute;n daarvan ondersteunt kleur.
<P>
<BLOCKQUOTE><CODE>
<PRE>
xterm -fg white -bg blue4
color_xterm -fg white -bg blue4
color-xterm -fg white -bg blue4
nxterm -fg white -bg blue4
</PRE>
</CODE></BLOCKQUOTE>
<P>waar 'color_xterm' de kleurenversie van 'ls' ondersteund. Deze bepaalde
keuze lijkt op de kleuren die op een SGI worden gebruikt.
<H2>6.2 Virtuele console</H2>

<P>Je kunt de kernel voor eens en voor altijd wijzigen, als ook in een
runtime standaard voorzien voor de virtuele consoles met een escape
sequence. Ik raad je de kernelpatch aan als je je eigen kernel hebt
gecompileerd.
<P>Het kernel bronbestand is <CODE>/usr/src/linux/drivers/char/console.c</CODE>
zo ongeveer bij regel 1940 zou je het volgende moeten wijzigen
<P>
<BLOCKQUOTE><CODE>
<PRE>
        def_color       = 0x07;   /* white */
        ulcolor         = 0x0f;   /* bold white */
        halfcolor       = 0x08;   /* grey */
</PRE>
</CODE></BLOCKQUOTE>
<P>Ik gebruik wit op blauw met
<BLOCKQUOTE><CODE>
<PRE>
        def_color       = 0x17;   /* white */
        ulcolor         = 0x1f;   /* bold white */
        halfcolor       = 0x18;   /* grey */
</PRE>
</CODE></BLOCKQUOTE>
<P>De nummers zijn de attribuutcodes die door de videokaart in
hexadecimaal worden gebruikt: het meest significante cijfer 
(de "1" in de voorbeeldkleuren hierboven) is de achtergrond; 
het minst significant de
voorgrond. 0 = black, 1 = blue, 2 = green, 3 = cyan, 4 = red, 5 =
purple, 6 = bruin/geel, 7 = wit. Voeg 8 toe om "heldere"
kleuren te krijgen. Merk op dat in de meeste gevallen een heldere
achtergrond == knipperende tekens, matte achtergrond. (Van
<A HREF="mailto:sjlam1@mda023.cc.monash.edu.au">sjlam1@mda023.cc.monash.edu.au</A>).
<P>Je kunt ook een nieuwe run-time standaard voor een virtueel console
aanvullen, op een per-display basis met de niet-standaard ANSI sequence
(gevonden door het bladeren door de kernelbronnen)
<BLOCKQUOTE><CODE>
<PRE>
        ESC [ 8 ]
</PRE>
</CODE></BLOCKQUOTE>
<P>waarmee de standaardwaarden op de huidige voor- en achtergrondkleuren wordt
ingesteld. Vervolgens selecteert de Reset Attribuut string
(ESC [ m) deze kleuren in plaats van wit op zwart.
<P>Je zult in feite, iedere keer dat je reboot, deze string naar de console 
moeten echo&euml;n. Afhankelijk van waar je je Linux box voor gebruikt,
kunnen verscheidene plaatsen hier geschikt voor zijn:
<H3>/etc/issue</H3>

<P>Dit is waar "Welcome to Linux xx.yy" onder Slackware wordt getoond, en
het is een goede keuze voor een stand-alone uitrusting.
(en waarschijnlijk verderfelijk voor gebruikers die met telnet inloggen)
Dit bestand wordt tijdens het booten aangemaakt
(Slackware in /etc/rc.d/rc.S; Redhat in /etc/rc.d/rc.local),
en je zou de regels moeten wijzigen waarin zoiets staat als
<P>
<BLOCKQUOTE><CODE>
<PRE>
  echo ""> /etc/issue
  echo Welcome to Linux `/bin/uname -a | /bin/cut -d\  -f3`. >> /etc/issue
</PRE>
</CODE></BLOCKQUOTE>
<P>in
<BLOCKQUOTE><CODE>
<PRE>
  ESCAPE="&lt;vervang dit door een enkel escape-teken>"
  echo "${ESCAPE}[H${ESCAPE}[37;44m${ESCAPE}[8]${ESCAPE}[2J"> /etc/issue
  echo Welcome to Linux `/bin/uname -a | /bin/cut -d\  -f3`. >> /etc/issue
</PRE>
</CODE></BLOCKQUOTE>
<P>Deze code zal de cursor linksboven op het scherm plaatsen, 
de kleur instellen (hier wit op blauw),
deze selectie opslaan en de rest van het scherm wissen. De wijziging
heeft na de volgende opstart effect. Denk eraan de _literal_
escape-teken in het bestand in te voegen met C-q in emacs of 
control-v in vi, aangezien sh, die voor het uitvoeren 
van het script wordt gebruikt, de <CODE>/033</CODE> syntax blijkbaar niet begrijpt.
<H3>/etc/profile of .profile</H3>

<P>
<BLOCKQUOTE><CODE>
<PRE>
  if [ "$TERM" = "console" ]; then
      echo "\033[37;44m\033[8]" #
# of gebruik setterm.
      setterm -foreground white -background blue -store
  fi
</PRE>
</CODE></BLOCKQUOTE>
<H3>/etc/login of .login</H3>

<P>
<BLOCKQUOTE><CODE>
<PRE>
  if ( "$TERM" == "console" ) then
    echo "\033[37;44m\033[8]"  
# of gebruik setterm.
      setterm -foreground white -background blue -store
  endif
</PRE>
</CODE></BLOCKQUOTE>
<H2>6.3 Remote login</H2>

<P>Je zou het programma setterm zoals hierboven moeten kunnen gebruiken.
Nogmaals, dit vereist dat de remote machine genoeg bekend is met je
terminal, en dat de terminal-emulator die in de login voorziet kleuren
ondersteunt.
<P>In mijn ervaring zijn de beste vt100 emulaties die op dit moment 
voor andere platformen beschikbaar zijn:
<UL>
<LI>MS-DOS:         MS-Kermit (vrij, geen Microsoft product)</LI>
<LI>Windows 95/NT:  Kermit/95 (shareware)</LI>
<LI>OS/2:           Kermit/95 (shareware).  Merk op dat de
standaard telnet kleuren begrijpt en lokaal kan worden aangepast.</LI>
</UL>
<P>Zie 
<A HREF="http://www.columbia.edu/kermit/">http://www.columbia.edu/kermit/</A> voor details over
Kermit.
<H2><A NAME="s7">7. Software</A></H2>

<P>Bij alle informatie die hier is beschreven werd uitgegaan van een GNU/Linux
installatie. Als je iets anders hebt (zoals b.v. een Sun draaiende onder X
of zo) kun je de feitelijke software zelf verkrijgen en compileren.
<P>De kleurenversie van 'xterm' is gebaseerd op de standaard xterm source
met een patch die vanaf elke X11R6 site beschikbaar is.
Het gerucht gaat dat de xterm gedistribueerd met R6.3 
intern kleurenondersteuning biedt, maar dat is niet door mij getest.
<P>
<BLOCKQUOTE><CODE>
<PRE>
ftp://ftp.denet.dk/pub/X11/contrib/utilities/color-xterm-R6pl5-patch.gz
</PRE>
</CODE></BLOCKQUOTE>
<P>Zie de documentatie als je een oudere versie van X gebruikt.
<EM>Opmerking:</EM> Ik heb dit zelf niet uitgeprobeerd!
<P>'ls' is in de GNU fileutils package beschikbaar vanaf prep.mit.edu of 
&eacute;&eacute;n van de verscheidene mirrors. Haal tenminste versie 3.13 op.
<BLOCKQUOTE><CODE>
<PRE>
ftp://ftp.denet.dk/pub/gnu/fileutils-3.XX.tar.gz
</PRE>
</CODE></BLOCKQUOTE>
<P>Ik heb zelf color-ls succesvol gecompileerd op Solaris, SunOS en Irix.
<P>Ik zou feedback over deze tekst waarderen.
Mijn e-mailadres is 
<A HREF="mailto:ravn@dit.ou.dk">ravn@dit.ou.dk</A>.
<P>&hyphen;&hyphen;
<P>Thorbj&oslash;rn Ravn Andersen
</BODY>
</HTML>
