<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Visuele beep mini-Howto</TITLE>


</HEAD>
<BODY>
<H1>Visuele beep mini-Howto</H1>

<H2>Alessandro Rubini, <CODE>rubini@linux.it</CODE>,<BR>
Vertaald door: Ellen Bokhorst, <CODE>bokkie@nl.linux.org</CODE></H2>v2.3, 3-12-2001
<P><HR>
<EM>In dit document wordt uitgelegd hoe termcap kan worden gebruikt om een
visuele beep op een systeem te configureren en het beschrijft hoe een hoorbare
beep op verzoek kan worden gedeactiveerd.</EM>
<HR>
<H2><A NAME="s1">1. Copyright en Licentie</A></H2>

<P>Dit document is auteursrechtelijk beschermd (c) door Alessandro Rubini.
<P>Dit document wordt gedistribueerd onder de voorwaarden van de GNU Free
Documentation License. Als het goed is heb je hiervan een kopie ontvangen.
Zo niet, dan is het beschikbaar vanaf
<A HREF="http://www.fsf.org/licenses/fdl.html">http://www.fsf.org/licenses/fdl.html</A>.
<H2><A NAME="s2">2. Introductie</A></H2>

<P>De Linux console driver laat de hoorbare beep klinken wanneer een BEL teken
wordt uitgevoerd (ASCII-code 7). Alhoewel dit de juiste keuze is voor het
standaard functioneren, houden veel gebruikers er niet van als hun
computer deze beep laat horen. Deze mini-Howto is bedoeld om uit te leggen
hoe aan applicaties te laten weten de BEL-code niet uit te voeren.
Hierin wordt ook uitgelegd hoe de kernel en het X Window Systeem te instrueren
het beepen te voorkomen wanneer een BEL wordt uitgevoerd.
Houd in de gaten dat het meeste van dit document refereert naar de tekstconsole,aangezien het configureren van de X-server een eenvoudige vergaarbak is
voor iedere gebruiker die in een grafische omgeving werkt.
<P>Naar mijn mening is de beste manier om een lawaaiige computer het zwijgen op
te leggen door er hardwarematig iets aan te veranderen, in mijn eigen computer
zit zelfs geen luidspreker.
<H2><A NAME="s3">3. Speakerectomy</A></H2>

<P>Speakerectomy is verreweg de briljantste oplossing voor het probleem met
de hoorbare beep. Zoals de naam impliceert, bestaat het uit het verwijderen
van de beeps door het verwijderen van de beeper.
De bewerking is rechttoe rechtaan en je hebt zelfs geen verdoving nodig,
maar als je dat wilt is er plaats voor enig raffinement.
<P>PC's worden gewoonlijk uitgerust met een dwaze switch om de CPU klok te
vertragen. Als je
in een multitasking omgeving werkt, wordt de switch nooit gebruikt, aangezien
je de computer zelfs niet hoeft te vertragen om spellen gebaseerd op
software loops te draaien. Helaas kunnen we de switch niet gebruiken
om de processor snelheid te verhogen, maar we kunnen het wel gebruiken
om de luidspreker te activeren/deactiveren.
Soms is de speaker wel handig zelfs al vind je een zwijgzame getallenkraker
wel prettig, bijvoorbeeld om het einde van een langdurige compilatie te
signaleren. Om de functionaliteit van de switch te veranderen, 
ontkoppel je het gewoon van het moederbord en verbind je de draden in
serie met de luidspreker.
<P>Bezitters van laptop boxen, hebben helaas niet zo eenvoudig toegang tot
de luidspreker, noch hebben zij een vrije switch voor gebruik
van een andere taak. De voorkeursoplossing voor die gebruikers is het
configureren van de software om het beepen te voorkomen, zoals hieronder
wordt beschreven.
<H2><A NAME="s4">4. Per console Beep Configuratie</A></H2>

<P>Sinds Linux 1.3.43 voegde Martin Mares de mogelijkheid toe de toon en
duur van de beep te configureren door het wijzigen van <CODE>console.c</CODE>. 
Iedere console kan zo worden geconfigureerd dat het voorziet in een
andere duur en/of toon van het beepgeluid;
de taak wordt bewerkstelligd door het gebruik van escape sequences
voor het console device. Je kunt je eigen <CODE>~/.profile</CODE> of
<CODE>~/.login</CODE> bestand configureren om een ander beepgeluid 
(of zonodig zonder enige beep) geassocieerd met een console te selecteren.
<P>De escape sequences werken als volgt:
<UL>
<LI>ESC-<CODE>[10;</CODE>xx<CODE>]</CODE> selecteert de beepfrequency in Hertz. De waarde
zou moeten liggen in het bereik, 21-32766, anders is het resultaat 
ongedefinieerd. Als het `xx' argument ontbreekt, is de standaardwaarde
(750Hz) van toepassing, zoals in `ESC-<CODE>[10]</CODE>.</LI>
<LI>ESC-<CODE>[11;</CODE>xx<CODE>]</CODE> selecteert de duur van de beep in milliseconden.
Als je meer dan 2 seconden opgeeft, geldt de standaardwaarde (125ms). 
Wederom, als het `xx' argument ontbreekt (ESC-<CODE>[11]</CODE>) zal de
standaardwaarde worden gebruikt.</LI>
</UL>
<P>Om bijvoorbeeld een 50Hz toon voor de duur van &eacute;&eacute;n seconde
te selecteren, gebruik je
"<CODE>echo -e "\\33[10;50]\\33[11;1000]"</CODE>" met <CODE>bash</CODE> (waar "-e"
betekent `ga uit van Escape sequences'. Als je gebruik maakt van <CODE>tcsh</CODE>
luidt de opdracht hiervoor "<CODE>echo "\\033[10;50]\\033[11;1000]"</CODE>".
<P>Alhoewel ik niet bekend ben met een versie van de opdracht <CODE>setterm</CODE>
die een dergelijke configuratie ondersteunt, zou het goed kunnen dat een
toekomstige versie een opdrachtregeloptie ondersteunt voor het
configuren van het beepgeluid.
<P>Als je Linux-1.3.43 of nieuwer draait, ben je wellicht tevreden met
de escape sequences en hoef je niet verder te lezen. Als je een oudere kernel
hebt, of je wilt de visuele beep, dan zal je in je schik zijn met de rest
van het document.
<H2><A NAME="s5">5. Basisconcepten van termcap en terminfo</A></H2>

<P>Het bestand <CODE>/etc/termcap</CODE> is een tekstbestand waarin de
<CODE>term</CODE>inal <CODE>cap</CODE>aciteiten worden opgesomd.
Verscheidene applicaties maken gebruik van de <CODE>termcap</CODE>
informatie om de cursor op het scherm te verplaatsen en het doen
van andere op het scherm ge&ouml;ri&euml;nteerde taken.
<CODE>tcsh</CODE>, <CODE>bash</CODE>, <CODE>vi</CODE> en alle op de <CODE>curses</CODE> library
gebaseerde applicaties maken gebruik van de <CODE>termcap</CODE> database.
<P>De database beschrijft verscheidene typen terminals.
De omgevingsvariabele <CODE>TERM</CODE> selecteert tijdens de uitvoering
het juiste functioneren, door het benoemen van een
<CODE>termcap</CODE> veld dat door applicaties moet worden gebruikt.
<P>In de database verschijnt iedere capaciteit van de terminal als een uit
twee letters bestaande code en een representatie van de feitelijke
escape sequence welke wordt gebruikt om het gewenste effect te krijgen.
Het scheidingsteken tussen de verschillende capaciteiten is de dubbele punt
(":"). Als een voorbeeld, verschijnt de hoorbare beep, met code "bl",
gewoonlijk als "tt/bl=^G/". Deze sequence geeft aan dat het beepgeluid wordt
verkregen door het afdrukken van het control-G teken, de ASCII bell.
<P>In aanvulling op <CODE>bl</CODE> wordt de <CODE>vb</CODE> herkend.
Het wordt gebruikt als representatie van de "visuele bel". 
<CODE>vb</CODE> ontbreekt gewoonlijk in het <CODE>linux</CODE> record van 
het <CODE>termcap</CODE> bestand.
<P>De meeste moderne applicaties en library's maken gebruik van de 
<CODE>terminfo</CODE> database in plaats van
<CODE>termcap</CODE>. Deze database gebruikt een bestand per type terminal en
komt voor in <CODE>/usr/lib/terminfo</CODE>; ter voorkoming van zeer grote
directory's wordt de beschrijving van ieder type terminal opgeslagen in
een directory met de naam gelijk aan de eerste letter van de naam van
het type terminal; het <CODE>linux</CODE> record is daarom te vinden in de
directory <CODE>/usr/lib/terminfo/l/linux</CODE>. Om een 
<CODE>terminfo</CODE> record te bouwen ``compileer'' je de <CODE>termcap</CODE> 
beschrijving;
refereer naar het programma <CODE>tic</CODE> en de manual page hiervan.
<H2><A NAME="s6">6. Defini&euml;ren van een visuele beep</A></H2>

<P>Je kunt het veld <CODE>vb</CODE> in je eigen termcap bestand plaatsen, als het nog
niet voor je is gedefinieerd.  Dennis Henriksen
(duke@diku.dk) deed de suggestie de volgende regel in het <CODE>linux</CODE>
record van <CODE>termcap</CODE> te plaatsen (merk op dat het record in oude
distributies <CODE>console</CODE> wordt genoemd):
<BLOCKQUOTE><CODE>
<PRE>
:vb=\E7\E[?5h\E[?5l\E[?5h\E[?5l\E[?5h\E[?5l\E[?5h\E[?5l\E8:\
</PRE>
</CODE></BLOCKQUOTE>

De laatste backslash wordt gebruikt op de newline in de database te
escapen. Dennis' code doet het volgende (in zijn eigen woorden):
<UL>
<LI>Bewaar de cursorpositie (gewoon een voorzorgsmaatregel).</LI>
<LI>Wijzig de achtergrondkleur verscheidene malen tussen normaal
en reverse.</LI>
<LI>Herstel de cursorpositie.</LI>
</UL>
<H2><A NAME="s7">7. Deactiveren van de hoorbare beep op de tekstconsole</A></H2>

<P>Als je de visuele beep op je console wilt forceren dan kun je het
"<CODE>bl</CODE>" veld in <CODE>termcap</CODE> gebruiken en het met dezelfde string
defini&euml;ren als eerder aangegeven voor "<CODE>vb</CODE>".  
Deze benadering is handig als je iedere applicatie niet aan wilt passen
(wat hoe dan ook hierna wordt beschreven).
Ik gebruik deze optie op alle computers waar ik Linux op draai en 
waar ik de speaker niet kan ontkoppelen.
<H2><A NAME="s8">8. Applicaties opgeven beepen te voorkomen</A></H2>

<P>Dit is een onvolledige lijst met applicaties die kunnen worden ge&iuml;nstrueerd
het veld <CODE>vb</CODE> te gebruiken voor het huidige type terminal 
(door gebruik van of de informatie in <CODE>termcapr</CODE> of die in
<CODE>terminfo</CODE>):
<P>
<UL>
<LI>De X server: gebruik de opdracht "<CODE>xset b</CODE>"  voor
het selecteren van het functioneren van de beep.
Aan de opdracht kunnen drie numerieke argumenten worden
opgegeven: volume, toon en duur. "<CODE>xset -b</CODE>" deactiveert
de beep in alle opzichten. Het configureren van de X-server heeft
effect op alle applicaties die op het display worden uitgevoerd.</LI>
<LI><CODE>xterm</CODE>: xterm kan iedere beep converteren naar een visuele
beep of hoorbaar signaal. Als je de hoorbare beep gebruikt,
zijn de instellingen van "<CODE>xset</CODE>" van toepassing.
De bel in <CODE>xterm</CODE> is standaard hoorbaar, maar je kunt de
opdrachtregeloptie "<CODE>-vb</CODE>" gebruiken en de
"<CODE>xterm*visualBell: true</CODE>" bron om het om te zetten naar een
visuele flits. Je kunt tijdens de uitvoering schakelen tussen een
visueel/hoorbaar signaal door gebruik te maken van het menu,
dat kan worden aangeroepen met de control-linker-muisknop.
Als je X draait zal je de volgende informatie zeer waarschijnlijk
niet nodig hebben.</LI>
<LI><CODE>tcsh</CODE> (6.04 en later): "<CODE>set visiblebell</CODE>".  De instructie
kan worden geplaatst in <CODE>.cshrc</CODE> of kan interactief worden
aangeroepen. Gebruik voor het resetten van de hoorbare beep
"<CODE>unset visiblebell</CODE>". Gebruik voor het deactiveren van
enige bekendmaking in plaats daarvan "<CODE>set nobeep</CODE>".</LI>
<LI><CODE>bash</CODE> (iedere bash, zover als ik weet): plaats 
"<CODE>set bell-style
visible</CODE>" in <CODE>~/.bashrc</CODE>. Mogelijke belstijlen zijn ook
"none" en "audible".</LI>
<LI><CODE>bash</CODE> 
(met <CODE>readline</CODE>, als tevens andere op <CODE>readline</CODE>
gebaseerde applicaties): plaats "<CODE>set prefer-visible-bell</CODE>" in
<CODE>~/.inputrc</CODE>.</LI>
<LI><CODE>nvi</CODE> en <CODE>elvis</CODE>: plaats "<CODE>set flash</CODE>" in
<CODE>~/.exrc</CODE> of "<CODE>:set flash</CODE>" interactief (merk
de dubbele punt op). Gebruik <CODE>noflash</CODE> in plaats van
<CODE>flash?</CODE> om de visuele beep te deactiveren.</LI>
<LI><CODE>emacs</CODE>: plaats "<CODE>(setq visible-bell t)</CODE>" in 
<CODE>~/.emacs</CODE>. Het wordt gedeactiveerd door "<CODE>(setq visible-bell
nil)</CODE>".</LI>
<LI><CODE>less</CODE>: gebruik "<CODE>-q</CODE>" op de opdrachtregel om de visuele beep
te gebruiken, gebruik
"<CODE>-Q</CODE>" voor het deactiveren van enige bekendmaking.
 
Standaardopties kunnen worden geplaatst in de omgevingsvariabele
"<CODE>LESS</CODE>".</LI>
<LI><CODE>screen</CODE>: gebruik de opdracht CtrlA-CtrlG. Het verandert het
functioneren van alle virtuele schermen.
Raadpleeg de man page onder "CUSTOMIZATION" voor het instellen
van de standaardwaarde.</LI>
</UL>
<H2><A NAME="s9">9. De donkere kant van het probleem</A></H2>

<P>Het slechte nieuws is dat niet iedere applicatie gebruik maakt van
<CODE>termcap</CODE> of <CODE>terminfo</CODE>. In de meeste kleine programma's wordt
gebruik gemaakt van de 'backslash-a' (alarm)
tekens in de C-broncode. De "alarm" code wordt een letterlijke ASCII-BEL
in de strings zoals opgeslagen in het uitvoerbare bestand.  Echte applicaties
behoren niet tot deze categorie, maar wees voorzichtig met C-beginnelingen
die je hun eigen programma's geven. Studenten in de computerwetenschap
zijn het ergste van iedereen, dat verzeker ik je.
<P>De enige manier om van deze programma's zwijgzame applicaties te maken is
speakerectomy, of het gebruik van de escape sequences door Martin Mares.
</BODY>
</HTML>
