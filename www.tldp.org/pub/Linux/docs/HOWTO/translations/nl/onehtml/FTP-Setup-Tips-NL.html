<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>FTP Setup Tips </TITLE>


</HEAD>
<BODY>
<H1>FTP Setup Tips </H1>

<H2>Will Harris, <CODE>wil@redhat.com</CODE> <BR>
Vertaler: Reggy Ekkebus, <CODE>reggy@zeelandnet.nl</CODE></H2>v1.1, 20 april 1999.
<H2><A NAME="s1">1. Inleiding</A></H2>

<P>"Red Hat Tips" is documentatie die bedoeld is om Red Hat gebruikers te
helpen met bepaalde taken. Enkele van deze documenten zijn voor beginnende
gebruikers, andere zijn voor gevorderde gebruikers. Als je een bijdrage wilt
leveren, zend die dan naar <CODE>tech-sup@redhat.com</CODE>. Als je veranderingen
hebt voor een individueel Tips document, zend die dan naar de auteur van dat
document.
<H2><A NAME="s2">2. Introductie</A></H2>

<P>Dit document beschrijft de configuratie voor wu-ftpd en proftpd voor
gewone gebruikers en anonieme gebruikers. 
Je moet root zijn voor dit gehele proces.
<P>Het eerste deel gaat over het instellen van wu-ftpd en anonieme ftp.
Het tweede deel gaat over het instellen van proftpd.
<H2><A NAME="s3">3. Voorbereiding</A></H2>

<P>Installeer de NetKit-B en anonftp RPM's. NetKit-B heeft de FTP server
daemon; anonftp heeft de binaries, libraries en dingen die in de FTP directory
gaan.
<P>/home/ftp is de root directory van je FTP server. Anonftp zet het meeste
voor je op, maar er zijn nog een paar dingen die je zelf moet doen.
<P>Je moet een kopie van <CODE>/etc/passwd</CODE> en <CODE>/etc/group</CODE> in
<CODE>/home/ftp/etc</CODE> zetten, zodat het <CODE>/ls</CODE> commando de
gebruikersnamen en groepnamen ook weergeeft.
Voor de veiligheid van je systeem moet je de gecodeerde wachtwoorden 
vervangen door sterretjes. Om <CODE>/etc/passwd</CODE> naar
<CODE>/home/ftp/etc/passwd</CODE> te kopie&euml;ren en de wachtwoorden te vervangen
door sterretjes, gebruik je dit commando: 
<P>
<BLOCKQUOTE><CODE>
<PRE>
        sed -e 's/:[^:]*:/:*:/' /etc/passwd >~ftp/etc/passwd
</PRE>
</CODE></BLOCKQUOTE>
<P>In <CODE>/etc/group</CODE> staan onder Red Hat Linux geen wachtwoorden, dus
deze kun je gewoon kopie&euml;ren: 
<P>
<BLOCKQUOTE><CODE>
<PRE>
        cp /etc/group ~ftp/etc/group
</PRE>
</CODE></BLOCKQUOTE>
<P>Een andere optie (en een goed idee voor veiligheid) is het gebruik van 
shadow passwords. Onder linux kun je dit doen door simpelweg het volgende
uit te voeren:
<P>
<BLOCKQUOTE><CODE>
<PRE>
        pwconv
</PRE>
</CODE></BLOCKQUOTE>
<P>Dit commando converteert het password bestand naar shadow, vernieuwt de 
pam libs om shadow passwords te gebruiken en een permissie te zetten
op <CODE>/etc/shadow</CODE>. 
Als je dit doet, dan kun je gewoon de bestanden <CODE>/etc/passwd</CODE> en 
<CODE>/etc/group</CODE> kopie&euml;ren:
<P>
<BLOCKQUOTE><CODE>
<PRE>
        cp /etc/passwd /etc/group ~ftp/etc/
</PRE>
</CODE></BLOCKQUOTE>
<P>Dat is dat, kijk het voor de zekerheid nog even na voor je verder gaat.
<P>Notitie: De enige regels die we eigenlijk nu nodig hebben zijn die van de root.
<H2><A NAME="s4">4. Beveiligen</A></H2>

<P>De anonftp RPM plaatst enkele binaries en libraries in de <CODE>/home/ftp</CODE>
directory om Ftp gebruikers dingen te laten doen zoals: 
automatisch bestanden unzippen als ze worden opgehaald of het ophalen van
een hele directory met tar bestanden. Er zijn een paar extra bestanden
geplaatst door de anonftp RPM die bijna nooit gebruikt worden en die moeten
worden verwijderd om de veiligheid te bevorderen.
<P>
<BLOCKQUOTE><CODE>
<PRE>
        cd /home/ftp/bin
        rm cpio sh zcat
        cd ../etc
        rm ld.so.cache
        cd ../lib
        rm ld.so* libtermcap*
</PRE>
</CODE></BLOCKQUOTE>
<P>Tot slot moet je de permissies van bestanden veranderen om de veiligheid
te bevorderen.
<P>
<BLOCKQUOTE><CODE>
<PRE>
        chmod 111 ~ftp/bin/* ~ftp/bin ~ftp/etc ~ftp/lib
        chmod 444 ~ftp/etc/*
        chmod 555 ~ftp ~ftp/lib/*
</PRE>
</CODE></BLOCKQUOTE>
<P>Als je klaar bent moet je het volgende hebben:
<P>
<BLOCKQUOTE><CODE>
<PRE>
        bin:
        total 164
        ---x--x--x   1 root     root        14776 Oct 31 09:54 compress
        ---x--x--x   1 root     root        45277 Oct 29 21:59 gzip
        ---x--x--x   1 root     root        22977 Oct 29 20:07 ls
        ---x--x--x   1 root     root        77873 Oct 25 17:49 tar
</PRE>
</CODE></BLOCKQUOTE>
<P>
<BLOCKQUOTE><CODE>
<PRE>
        etc:
        total 2
        -r--r--r--   1 root     root          495 Mar 20 19:46 group
        -r--r--r--   1 root     root          921 Mar 20 19:45 passwd
</PRE>
</CODE></BLOCKQUOTE>
<P>
<BLOCKQUOTE><CODE>
<PRE>
        lib:
        total 702
        -r-xr-xr-x   1 root     root        20994 Oct 30 18:58 ld-linux.so.1
        -r-xr-xr-x   1 root     root        20994 Oct 30 18:58 ld-linux.so.1.7.5
        lrwxrwxrwx   1 root     root           13 Mar 20 19:43 libc.so.5 -> libc.so.5.0.9
        -r-xr-xr-x   1 root     root       669157 Oct 30 19:53 libc.so.5.0.9
</PRE>
</CODE></BLOCKQUOTE>
<P>Als er bestanden ontbreken, begin dan opnieuw en herinstalleer de anonftp
RPM. Om de permissies te zien als hierboven typ:
<P>
<BLOCKQUOTE><CODE>
<PRE>
        ls -al
</PRE>
</CODE></BLOCKQUOTE>
<P>Nu alles veilig is moet je de <CODE>/pub</CODE> directory aanmaken
waar je de bestanden zet voor de anonieme ftp. 
<P>
<BLOCKQUOTE><CODE>
<PRE>
        mkdir ~ftp/pub
        chmod 555 ~ftp/pub
</PRE>
</CODE></BLOCKQUOTE>
<P>Plaats elk bestand dat je wilt aanbieden via FTP in de <CODE>/pub</CODE>
directory. Je mag ook subdirectory's aanmaken in de <CODE>/pub</CODE> directory.
<P>Voor de veiligheid en om zeker te weten dat anonieme gebruikers ook 
de bestanden kunnen lezen, doe dan dit met elk bestand en elke directory: 
<P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
        chmod 444 (naam van het bestand)
        chmod 555 (naam van de directory)
</PRE>
</CODE></BLOCKQUOTE>
<P>Een 'incoming' directory is af te raden, omdat je dan last kunt hebben van
software piraterij. Sommige mensen zetten dan software op je site, waar je voor
moet betalen en de houder van de site krijgt dan een bekeuring, omdat die 
verantwoordelijk is voor de dingen die op de site staan. Als het echt
nodig is doe dan dit: 
<BLOCKQUOTE><CODE>
<PRE>
        mkdir ~ftp/incoming
        chmod 333 incoming
</PRE>
</CODE></BLOCKQUOTE>
<P>De mode 333 betekent dat ze alleen in de directory kunnen schrijven en niet
lezen.
<P>Dat was het! Voor de veiligheid: zorg dat alles in <CODE>/home/ftp</CODE>
niet te schrijven is.
<P>
<BLOCKQUOTE><CODE>
<PRE>
        chmod -R a-w ~ftp
</PRE>
</CODE></BLOCKQUOTE>
<P>(Je mag als root nog wel in de directory schrijven).
<H2><A NAME="s5">5. ProFTPd Setup</A></H2>

<P> OK, voor degenen die ProFTPd willen: eerst kijken of je de nieuwste 
versie hebt.
<P><CODE>
<A HREF="ftp://ftp.proftpd.org">ProFTPd</A></CODE> 
<P>voor de RPM (Opmerking: Deze worden niet onderhouden door RedHat Software).
<P><CODE>
<A HREF="ftp://rhcn.redhat.com/pub/rhcn/RPMS/">ProFTPd RPM</A></CODE>
<P>Als je het pakket eenmaal gedownload en ge&iuml;nstalleerd hebt via een van de
methoden.
<P>(Onthoud: Om proftpd te installeren via rpm moet je de wu-ftpd en anonftp wegdoen.) 
Je moet het configuratiebestand aanpassen voor je site.
Als je de RHCN rpm gebruikte, staat het configuratiebestand in
<CODE>/etc/proftpd.conf</CODE>.  Als je hem zelf gecompileerd hebt, staat het
configuratiebestand in: <CODE>/usr/local/etc/proftpd.conf</CODE>.
<P>Nu voor de configuratie: open het configuratiebestand met een editor naar keuze. 
Het bestand ziet er ongeveer uit als hieronder:
<P>
<BLOCKQUOTE><CODE>
<PRE>
        # This is a basic ProFTPD configuration file (rename it to
        # 'proftpd.conf' for actual use.  It establishes a single server
        # and a single anonymous login.  It assumes that you have a user/group
        # "nobody" and "ftp" for normal operation and anon.

        ServerName                      "ProFTPD Default Installation"
        ServerType                      standalone
        DefaultServer                   on

        # Port 21 is the standard FTP port.
        Port                            21
        # Umask 022 is a good standard umask to prevent new dirs and files
        # from being group and world writable.
        Umask                           022

        # To prevent DoS attacks, set the maximum number of child processes
        # to 30.  If you need to allow more than 30 concurrent connections
        # at once, simply increase this value.  Note that this ONLY works
        # in standalone mode, in inetd mode you should use an inetd server
        # that allows you to limit maximum number of processes per service
        # (such as xinetd)
        MaxInstances                    30

        # Set the user and group that the server normally runs at.
        User                            nobody
        Group                           nogroup

        # Normaal gesproken willen we dat bestanden overschrijfbaar zijn.
        &lt;Directory /*&gt;
          AllowOverwrite                on
        &lt;/Directory&gt;

        # A basic anonymous configuration, no upload directory's.
        &lt;Anonymous ~ftp&gt;
        User                          ftp
        Group                         ftp
        # We want clients to be able to login with "anonymous" as well as "ftp"
        UserAlias                     anonymous ftp

        # Beperk het aantal anonieme logins
        MaxClients                    10

        # We want 'welcome.msg' displayed at login, and '.message' displayed
        # in each newly chdired directory.
        DisplayLogin                  welcome.msg
        DisplayFirstChdir             .message

        # Limit WRITE everywhere in the anonymous chroot
        &lt;Limit WRITE&gt;
           DenyAll
        &lt;/Limit&gt;

        &lt;/Anonymous&gt;
</PRE>
</CODE></BLOCKQUOTE>
<P>Het eerste wat we doen is onze server configureren voor onze eigen site. We
beginnen met de volgende regel:
<P>
<BLOCKQUOTE><CODE>
<PRE>
        ServerName                             "ProFTPD Default Installation"
</PRE>
</CODE></BLOCKQUOTE>
<P>Verander het in een zelfgekozen server naam. Bijvoorbeeld "Reggy's Ftpsite".
Dan zal het er zo uitzien:
<P>
<BLOCKQUOTE><CODE>
<PRE>
        ServerName                              "Reggy's Ftpsite""
</PRE>
</CODE></BLOCKQUOTE>
<P>Daarna gaan we kijken welk servertype we nemen. Je kunt kiezen tussen een
die altijd draait of een net als de inetd deamon, dat betekent dat de server
start en stopt als de connecties komen en gaan. inetd heeft mijn voorkeur, 
dus ik verander het en dan ziet het er zo uit:
<P>
<BLOCKQUOTE><CODE>
<PRE>
        ServerType                      inetd
</PRE>
</CODE></BLOCKQUOTE>
<P>
<P>Onthoud: Als je het wilt starten met inetd dan moet je ook een regel aanmaken 
in <CODE>/etc/inetd.conf</CODE>: 
<P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
        ftp     stream  tcp     nowait  root    /usr/sbin/proftpd       proftpd
</PRE>
</CODE></BLOCKQUOTE>
<P>Voor stand alone moet je jezelf hier niet druk over maken. Je moet niets
veranderen aan de Port en Umask, het mag wel. Ik laat de User nobody en
verander de group ook in nobody. Dus dit gaat er zo uitzien: 
<P>
<BLOCKQUOTE><CODE>
<PRE>
        User                            nobody
        Group                           nobody
</PRE>
</CODE></BLOCKQUOTE>
<P>Nu moet je een beslissing nemen over de bestanden. Ik vind het niet
leuk dat bestanden overschrijfbaar zijn, dus ik verander het in:
<P>
<BLOCKQUOTE><CODE>
<PRE>
        &lt;Directory /*&gt;
          AllowOverwrite                off
        &lt;/Directory&gt;
</PRE>
</CODE></BLOCKQUOTE>
<P>De setup voor anonymous laat ik met rust. Dit staat standaard aan, zonder dat ze 
kunnen schrijven.Er zijn nog veel meer andere opties voor ProFTPd. Kijk in de overige
documentatie voor meer opties.
<H2><A NAME="s6">6. Overige documentatie</A></H2>

<P>Zie Garfinkel en Spafford, ``Practical Unix Security'' <CODE>
<A HREF="http://www.oreilly.com">O'Reilly and Associates.</A></CODE>, 1996, pagina's 
487-494 voor meer info. En
<P><CODE>
<A HREF="http://www.landfield.com/wu-ftpd/">wu-FTPd</A></CODE>
<P><CODE>
<A HREF="http://www.proftpd.org/">ProFTPd</A></CODE>
<H2><A NAME="s7">7. Copyright Gegevens</A></H2>

<P>Dit document is auteursrechtelijk beschermd. Copyright (C) 1999 door de auteur.  
Herdistributie van dit document mag alleen als de inhoud hetzelfde
blijft. Met andere woorden, je mag dit document afdrukken en herdistribueren.
</BODY>
</HTML>
