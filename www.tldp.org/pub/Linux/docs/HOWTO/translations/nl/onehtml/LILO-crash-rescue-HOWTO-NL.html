<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>LILO, Linux Crash Rescue HOW-TO</TITLE>


</HEAD>
<BODY>
<H1>LILO, Linux Crash Rescue HOW-TO</H1>

<H2>Al Dev (Alavoor Vasudevan) 
<A HREF="mailto:alavoor@yahoo.com">alavoor@yahoo.com</A>,<BR>
Vertaald door: 
<A HREF="mailto:bokkie@nl.linux.org">bokkie@nl.linux.org</A></H2>v5.0, 5 dec 2000
<P><HR>
<EM>In dit document worden methoden besproken om een hersteloperatie uit
te voeren na Linux systeemstoringen.
Er kunnen diverse redenen zijn voor linux systeemstoringen -
LILO is geru&iuml;neerd, of het lukt niet linux te booten, of de
Master Boot Record (MBR) is beschadigd, of linux slaagt er niet in
te booten als een ander besturingssysteem, zoals Windows NT, is ge&iuml;nstalleerd, waardoor LILO of de MBR wordt gewist.</EM>
<HR>
<H2><A NAME="s1">1. Introductie</A></H2>

<P>Je kunt ongelukken niet voorkomen en als het gebeurt bij linux systemen dan
kan het de master boot record (MBR) of LILO (Linux boot loader) beschadigen.
Er kunnen situaties ontstaan waarbij linux vanwege gebreken aan de harddisk
niet zal booten. LILO kan ook falen als je per ongeluk de harddisk
herpartitioneert of je een ander extra besturingssysteem, zoals Windows 98/NT
op de linux computer installeert.
<P>Dit document reikt je een aantal idee&euml;n aan, tips en een snelle leidraad
om snel een hersteloperatie uit te voeren zonder honderden pagina's
documentatie over LILO of linux door te hoeven nemen.
<H2>1.1  Snelle stappen naar herstel</H2>

<P>Volg deze stappen voor een herstel van LILO- of systeemstoringen.
<P>
<OL>
<LI> <B>SCENE 1:</B> Als je systeem niet boot -

Haal de tomsrtbt floppy op 
<A HREF="http://www.toms.net/rb">http://www.toms.net/rb</A>
Boot met tomsrtbt floppy
Gebruik fdisk /dev/hda om naar de partities te zoeken
Probeer als volgt achter de rootpartitie te komen:
<HR>
<PRE>
bash# fdisk /dev/hda
bash# mkdir /dev/hda1 /test
bash# ls /test
Als het goed is zie je de rootpartitie als volgt weergegeven:
bin   fd    lib   mnt  proc  sbin  usr
boot  dev   etc   home  lost+found  opt  root  tmp   var
</PRE>
<HR>

Als dit geen rootpartitie is, probeer dan de volgende partitie /dev/hda2.
Probeer vervolgens hda3, hda4, hda5, enz.. totdat je de rootpartitie vindt.
Herhaal dit voor andere devices, zoals hdb, hdc, hdd, enz.. als je het nog
steeds niet hebt gevonden. Ook zijn de /usr, /var en /boot partitie nodig
aangezien deze vereist zijn voor het aanmaken van de nieuwe lilo
configuratie.
 
In mijn geval is de rootpartitie /dev/hda4 die in de voorbeelden hieronder
wordt gebruikt:
<HR>
<PRE>
 bash# mkdir /hda4
 bash# mount /dev/hda4 /hda4
 bash# cat /hda4/etc/fstab
 Lees de uitvoer van fstab en mount zoals hieronder weergegeven de partities.
 bash# mount /dev/hda5 /hda4/boot
 bash# mount /dev/hda6 /hda4/usr
 bash# mount /dev/hda7 /hda4/var
 bash# mount /dev/hda8 /hda4/opt
 bash# mount /dev/hda9 /hda4/root
 bash# mount /dev/hda10 /hda4/home
 
</PRE>
<HR>

 
Wijzig /etc/fstab (niet /hda4/etc/fstab) en plaats hierin het volgende
(hiergegeven voorbeeldcode) -
<HR>
<PRE>
        /dev/hda5  /hda4/boot      ext2 defaults 1 1
        /dev/hda6  /hda4/usr       ext2 defaults 1 1
        /dev/hda7  /hda4/var       ext2 defaults 1 1
        /dev/hda8  /hda4/opt       ext2 defaults 1 1
        /dev/hda9  /hda4/root      ext2 defaults 1 1
        /dev/hda10 /hda4/home      ext2 defaults 1 1
        /dev/hda11 /hda4/win95part vfat defaults 1 1

Op mijn computer bevat hda4 de linux boot/root partitie en
hda1 het windows 95 vfat systeem.

 bash# mkdir /hda4/win95part
 bash# mount /hda4/win95part
 En repareer het systeem met de opdracht fsck of e2fsck.
 bash# man fsck
 bash# man e2fsck
</PRE>
<HR>
</LI>
<LI> <B>SCENE 2:</B> Als LILO niet werkt.
Volg scene 1 en als dat niet werkt, dan
<HR>
<PRE>

bash# mkdir /hda4 
bash# mount /hda4
bash# mount -a 
bash# chroot /hda4 /sbin/lilo -q
bash# man chroot
bash# chroot /hda4 /sbin/lilo 
</PRE>
<HR>

Als alternatief kun je direct gebruik maken van /sbin/lilo in plaats van
chroot. De -r optie van lilo doet in feite een chroot.
Het is zeer sterk aan te bevelen dat je gebruik maakt van chroot, in plaats
van lilo -r, aangezien het prettiger is en je kunt er makkelijker fouten
mee afvangen.

<HR>
<PRE>
bash# man lilo
bash# /sbin/lilo -r /hda4
</PRE>
<HR>
</LI>
<LI> <B>SCENE 3:</B> Als LILO niet werkt..
Als scene 1 en 2 niet werken, en je de bootdisk hebt gemaakt met
`mkbootdisk' (tijdens de installatie of door middel van
`man mkbootdisk'), boot hier dan mee en repareer je partities.
mkbootdisk zit in het mkbootdisk*.rpm package, je moet het
installeren.</LI>
<LI> <B>SCENE 4:</B> Als het met scene 1, 2, of 3 niet lukte en je hebt
geen bootdisk
Als je een andere computer met daarop linux draaiend hebt, log
dan in als root en geef op
<HR>
<PRE>
bash$ man mkbootdisk
bash# cp /etc/lilo.conf /etc/lilo-original.conf
</PRE>
<HR>

Wijzig het bestand /etc/lilo.conf, plaats hierin de naam van de 
rootpartitie, zoals verkregen in 'scene 1', doe een lege diskette in het
diskettestation en geef de opdracht
<HR>
<PRE>
bash# mkbootdisk /dev/fd0
</PRE>
<HR>

Zorg ervoor dat je /etc/lilo-original.conf terug kopieert naar 
/etc/lilo.conf!! Gebruik deze diskette voor scene 3</LI>
<LI> <B>SCENE 5: </B>Als het met de scenes 1, 2, 3 en 4 niet lukt, probeer
dan het volgende
<I><B>Stap 1: </B></I>
Boot tomsrtbt en mount de partities en maak een backup van de
rootpartitie naar een andere partitie met diskruimte met de
commando's -
<HR>
<PRE>
        Wijzig /etc/fstab en plaats hierin (gegeven voorbeeldcode) -
                /dev/hdb1 /b1 vfat defaults 1 1
bash$ mkdir /b1; mount /b1
bash$ cd /
bash$ tar cvf /b1/root-a4.tar   a4
</PRE>
<HR>

<I><B>Stap 2: </B></I>
Doe de Linux cdrom in het station, reboot en installeer redhat linux op
/dev/hda4 (maar installeer GEEN extra packages, je hoeft alleen de root
bootsystemen, en LILO manager te installeren (dat is een absoluut minimum).
Hiermee zal LILO ook op de harddisk worden ge&iuml;nstalleerd.
Boot nu linux en login als root en geef de opdracht -
<HR>
<PRE>
bash$ man mkbootdisk
bash# cp /etc/lilo.conf /etc/lilo-original.conf
</PRE>
<HR>

Opmerking: Je MOET er aan denken lilo-original.conf terug te kopi&euml;ren
naar lilo.conf!
Wijzig het bestand /etc/lilo.conf en plaats hierin de naam van de 
rootpartitie zoals je deze in 'scene 1' verkreeg, doe een lege diskette
in het station en geef dan op -
<HR>
<PRE>
bash# mkbootdisk /dev/fd0
bash# cp /etc/lilo-original.conf /etc/lilo.conf
</PRE>
<HR>

Gebruik deze diskette voor de probleemcomputer en test deze
bootdiskette om te zien of het werkt en zet dan alle bestanden
terug waarvan je met behulp van tar op /b1/root-a4.tar zoals
aangegeven in stap 1 een backup hebt gemaakt.</LI>
</OL>
<H2>1.2 Voorzorgsmaatregelen</H2>

<P>Je zou de volgende voorzorgsmaatregelen moeten nemen om problemen in
de toekomst te tackelen.
<P>
<UL>
<LI> Je MOET van tijd tot tijd een bootdisk aanmaken en wanneer je
wijzingen aan de partitie aanbrengt.
Doe een lege diskette in het diskettestation en geef dan de opdracht -
<HR>
<PRE>
bash$ man mkbootdisk
bash$ mkbootdisk --help
bash$ mkbootdisk --device /dev/fd0 2.2.12-20
</PRE>
<HR>
</LI>
<LI>Je moet de tomsrtbt bootfloppy bij de hand hebben. Breng een bezoek aan
<A HREF="http://www.toms.net/rb">http://www.toms.net/rb</A></LI>
<LI>Je moet de Yard rescue- en bootfloppy bij de hand hebben. Breng een bezoek
aan 
<A HREF="http://www.croftj.net/~fawcett/yard">http://www.croftj.net/~fawcett/yard</A></LI>
<LI> Backup /root en /boot directory's. Boot de Tomsrtbt floppy en

<HR>
<PRE>
bash# vi /etc/fstab
En plaats daarin deze regels -
                /dev/hda1 /a1 vfat defaults 1 1
                /dev/hdb1 /b1 vfat defaults 1 1
In mijn geval had hda1 de linux root partitie '/'
bash# cd / 
bash# tar cvf /b1/linux-root-partition-hda1.tar  a1
bash# tar cvf /b1/linux-boot-partition-hda1.tar  a1/boot
</PRE>
<HR>
</LI>
</UL>
<H2>1.3 LILO verwijderen</H2>

<P>Je kunt de bootsector vervangen door de DOS bootloader door het uitvoeren
van de DOS-opdracht:
<HR>
<PRE>
        FDISK  /MBR
</PRE>
<HR>

MBR staat voor "Master Boot Record".
<P>Zie ook de LILO documentatie onder linux in /usr/doc/lilo* voor andere
methoden om LILO te de-installeren. En zie tevens `man lilo'.
<H2>1.4 Gebruikelijke fouten</H2>

<P>Na het wijzigen van /etc/lilo.conf MOET je lilo opstarten om ervoor te 
zorgen dat de wijzigingen effect hebben.
Het is een zeer gebruikelijke fout van nieuwe gebruikers. Typ -
<HR>
<PRE>
bash# lilo -v -v -v
</PRE>
<HR>
<H2><A NAME="s2">2. Gerelateerde URL's</A></H2>

<P>Bezoek de volgende plaatsen welke zijn gerelateerd aan LILO, Rescue Linux,
crash herstel:
<UL>
<LI> Mini Lilo HOWTO op 
<A HREF="http://www.linuxdoc.org/HOWTO/mini/LILO.html">http://www.linuxdoc.org/HOWTO/mini/LILO.html</A></LI>
<LI> Bootdisk-HOWTO op 
<A HREF="http://www.metalab.unc.edu/LDP/HOWTO/Bootdisk-HOWTO/index.html">http://www.metalab.unc.edu/LDP/HOWTO/Bootdisk-HOWTO/index.html</A></LI>
<LI> Voorgefabriceerde bootdisks op 
<A HREF="http://www.linuxdoc.org/HOWTO/Bootdisk-HOWTO/a1277.html">http://www.linuxdoc.org/HOWTO/Bootdisk-HOWTO/a1277.html</A></LI>
<LI> Tomsrtbt's bootdiskette 
<A HREF="http://www.toms.net/rb">http://www.toms.net/rb</A></LI>
<LI> Yard rescue- en bootdiskette 
<A HREF="http://www.croftj.net/~fawcett/yard">http://www.croftj.net/~fawcett/yard</A></LI>
<LI> BootPrompt-HOWTO op 
<A HREF="http://www.linuxdoc.org/HOWTO/BootPrompt-HOWTO.html">http://www.linuxdoc.org/HOWTO/BootPrompt-HOWTO.html</A></LI>
<LI> Multiboot met LILO mini HOWTO op 
<A HREF="http://www.linuxdoc.org/HOWTO/mini/Multiboot-with-LILO.html">http://www.linuxdoc.org/HOWTO/mini/Multiboot-with-LILO.html</A></LI>
<LI> Linux+WinNT mini HOWTO op 
<A HREF="http://www.linuxdoc.org/HOWTO/mini/Linux+WinNT.html">http://www.linuxdoc.org/HOWTO/mini/Linux+WinNT.html</A></LI>
<LI> Linux goodies main site 
<A HREF="http://www.aldev.8m.com">http://www.aldev.8m.com</A></LI>
<LI> Linux goodies mirrorsite 
<A HREF="http://aldev.webjump.com">http://aldev.webjump.com</A></LI>
<LI> Vim kleurenteksteditor voor C++, C 
<A HREF="http://metalab.unc.edu/LDP/HOWTO/Vim-HOWTO.html">http://metalab.unc.edu/LDP/HOWTO/Vim-HOWTO.html</A></LI>
</UL>
<H2><A NAME="s3">3. Andere formaten van dit document</A></H2>

<P>Dit document is in 11 verschillende formaten gepubliceerd, te weten
- DVI, Postscript, Latex, Adobe Acrobat PDF, LyX, GNU-info, HTML,
RTF(Rich Text Format), Plain-text, Unix man pages en SGML.
<UL>
<LI>Je kunt dit HOWTO document ophalen als een enkel getarred bestand in
HTML, DVI, Postscript of SGML formaat vanaf -
<A HREF="ftp://sunsite.unc.edu/pub/Linux/docs/HOWTO/other-formats/">ftp://sunsite.unc.edu/pub/Linux/docs/HOWTO/other-formats/</A></LI>
<LI>Een versie in gewone tekst is te vinden in: 
<A HREF="ftp://sunsite.unc.edu/pub/Linux/docs/HOWTO">ftp://sunsite.unc.edu/pub/Linux/docs/HOWTO</A></LI>
<LI>Vertalingen naar andere talen zoals Frans, Duits, Spaans, Chinees,
Japans zijn te vinden in
<A HREF="ftp://sunsite.unc.edu/pub/Linux/docs/HOWTO">ftp://sunsite.unc.edu/pub/Linux/docs/HOWTO</A>
Alle hulp voor het vertalen naar andere talen is welkom.</LI>
</UL>
<P>Dit document is geschreven met behulp van een tool genaamd de "SGML-Tools" 
welke kan worden opgehaald vanaf - 
<A HREF="http://www.sgmltools.org">http://www.sgmltools.org</A>
Voor het compileren van de source gebruik je de volgende commando's
<UL>
<LI>sgml2html LILO-crash-rescue-HOWTO.sgml  (genereren html-bestand)</LI>
<LI>sgml2rtf  LILO-crash-rescue-HOWTO.sgml  (genereren RTF-bestand)</LI>
<LI>sgml2latex LILO-crash-rescue-HOWTO.sgml (genereren latex bestand)</LI>
</UL>
<P>LaTeX documenten kunnen worden geconverteerd naar PDF bestanden door er
eenvoudigweg Postscript uitvoer van te produceren met behulp van
<B>sgml2latex</B> ( en dvips) en de uitvoer te gebruiken met
de Acrobat <B>distill</B> (
<A HREF="http://www.adobe.com">http://www.adobe.com</A>) opdracht
zoals met:
<HR>
<PRE>
bash$ man sgml2latex
bash$ sgml2latex filename.sgml
bash$ man dvips
bash$ dvips -o filename.ps filename.dvi
bash$ distill filename.ps
bash$ man ghostscript
bash$ man ps2pdf
bash$ ps2pdf input.ps output.pdf
bash$ acroread output.pdf &amp;
</PRE>
<HR>

Of je kunt de Ghostscript opdracht <B>ps2pdf</B> gebruiken.
ps2pdf is werkbestanddeel voor praktisch alle functionaliteit van
Adobe's Acrobat Distiller product: het converteert PostScript bestanden
naar Portable Document Format (PDF) bestanden. 
<B>ps2pdf</B> is als een zeer klein commando-script (batch bestand)
ge&iuml;mplementeerd dat Ghostscript aanroept, waarbij het een
speciaal "uitvoerdevice" selecteert, genaamd 
<B>pdfwrite</B>. 
Om ps2pdf te kunnen gebruiken, moet het pdfwrite device zijn opgenomen in
de makefile wanneer Ghostscript wordt gecompileerd;
Zie voor details de documentatie over het bouwen van Ghostscript.
<P>Dit howto document is te vinden op
<UL>
<LI> 
<A HREF="http://metalab.unc.edu/LDP/HOWTO/LILO-crash-rescue-HOWTO.html">http://metalab.unc.edu/LDP/HOWTO/LILO-crash-rescue-HOWTO.html</A></LI>
</UL>
<P>Dit document is ook te vinden op de volgende mirrorsites -
<UL>
<LI> 
<A HREF="http://www.caldera.com/LDP/HOWTO/LILO-crash-rescue-HOWTO.html">http://www.caldera.com/LDP/HOWTO/LILO-crash-rescue-HOWTO.html</A></LI>
<LI> 
<A HREF="http://www.WGS.com/LDP/HOWTO/LILO-crash-rescue-HOWTO.html">http://www.WGS.com/LDP/HOWTO/LILO-crash-rescue-HOWTO.html</A></LI>
<LI> 
<A HREF="http://www.cc.gatech.edu/linux/LDP/HOWTO/LILO-crash-rescue-HOWTO.html">http://www.cc.gatech.edu/linux/LDP/HOWTO/LILO-crash-rescue-HOWTO.html</A></LI>
<LI> 
<A HREF="http://www.redhat.com/linux-info/ldp/HOWTO/LILO-crash-rescue-HOWTO.html">http://www.redhat.com/linux-info/ldp/HOWTO/LILO-crash-rescue-HOWTO.html</A></LI>
<LI> Andere mirror-sites in de buurt (netwerk-adres-wijsheid) zijn te
vinden op 
<A HREF="http://metalab.unc.edu/LDP/mirrors.html">http://metalab.unc.edu/LDP/mirrors.html</A>
selecteer een site en ga naar de directory 
/LDP/HOWTO/LILO-crash-rescue-HOWTO.html</LI>
</UL>
<P>Gebruik het xdvi-programma om dit document in het dvi-formaat te bekijken.
Het xdvi-programma is te vinden in het
tetex-xdvi*.rpm package in Redhat Linux wat kan worden gevonden via de
ControlPanel | Applications | Publishing | TeX menu buttons.
<BLOCKQUOTE><CODE>
<PRE>
        Geef het volgende commando om het dvi-document te lezen -
                xdvi -geometry 80x90 howto.dvi
        En pas de grootte van het scherm met de muis aan. 
        Zie de manpage over xdvi. 
        Gebruik de pijltjestoetsen, Page Up, Page Down keys, om door
        het document te manoeuvreren, je kunt ook de
        'f', 'd', 'u', 'c', 'l', 'r', 'p', 'n' letter
        toetsen gebruiken om naar boven, onder, het midden, de volgende
        pagina, vorige pagina, enz te gaan.
        Druk op 'x' om het expert-menu uit te schakelen.
</PRE>
</CODE></BLOCKQUOTE>

Je kunt het postscript-bestand lezen met behulp van het programma 'gv' 
(ghostview) of 'ghostscript'.
Het ghostscript programma is te vinden in het ghostscript*.rpm package en
het gv programma is te vinden in het gv*.rpm package in Redhat Linux
welke kan worden gelokaliseerd via de ControlPanel | Applications | Graphics 
menu buttons. Het gv programma is veel gebruikersvriendelijker dan ghostscript.
Ghostscript en gv zijn ook voor andere platformen beschikbaar zoals OS/2,
Windows 95 en NT.
<BLOCKQUOTE><CODE>
<PRE>
        Geef het volgende commando om het postscript document te lezen -
                gv howto.ps

        Met gebruik van ghostscript geef je op -
                ghostscript howto.ps
</PRE>
</CODE></BLOCKQUOTE>
<P>Je kunt het HTML-formaat document lezen met Netscape Navigator, Microsoft
Internet explorer, Redhat Baron Web browser of enige andere webbrowser.
<P>Je kunt de latex, LyX uitvoer lezen met LyX een X-Window front end naar
latex.
<H2><A NAME="s4">4. Copyright</A></H2>

<P>Copyright beleid is GNU/GPL zoals door de LDP (Linux Documentation project).
LDP is een GNU/GPL project.
Aanvullende verzoeken bestaan daaruit dat de naam, het emailadres van
de auteur en deze copyrightmelding op alle kopie&euml;n behouden blijven.
Als je wijzigingen aanbrengt of dit document aanvult, laat dit dan aan
alle auteurs van dit document weten.
Merknamen, in dit document genoemd, zijn in eigendom van hun respectieve
eigenaren.
</BODY>
</HTML>
