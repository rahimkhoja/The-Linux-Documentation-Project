<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Bzip2 Howto</TITLE>


</HEAD>
<BODY>
<H1>Bzip2 Howto</H1>

<H2>David Fetter,
<A HREF="mailto:david@fetter.org">david@fetter.org</A><BR>
Vertaald door: Ellen Bokhorst 
<A HREF="mailto:bokkie@nl.linux.org">bokkie@nl.linux.org</A></H2>v2.00 Zo Aug 22 1999
<P><HR>
<EM>Dit document vertelt je hoe je het nieuwe bzip2 compressie-programma kunt
gebruiken. De lokale kopie van de sgml 
<A HREF="sgml/Bzip2-HOWTO.sgml">sgml/Bzip2-HOWTO.sgml</A>
staat momenteel op de huidige site, en de sgml van de "auteur" staat op
<A HREF="http://fetter.org/Bzip2-HOWTO/">http://fetter.org/Bzip2-HOWTO/</A>.</EM>
<HR>
<H2><A NAME="s1">1. Introductie</A></H2>

<P> 
Bzip2 is een blits nieuw algoritme voor het comprimeren van gegevens.
Het maakt gewoonlijk bestanden aan, die
uit 60-70% van de grootte van hun met gzip gecomprimeerde tegenhangers bestaan.
<P> Dit document leidt je door een paar algemene applicaties voor bzip2.
<P> Toekomstige versies van dit document zullen de applicaties van
libbzip2 en de bzip2 C library behandelen,
waarvan de auteur 
<A HREF="mailto:Julian_Seward@muraroa.demon.co.uk">Julian Seward</A> zo vriendelijk is geweest, ze te schrijven. De
bzip2 handleiding, met low-level informatie over de library kan worden
gevonden bij
<A HREF="http://www.bzip2.org/bzip2/docs/manual_toc.html">http://www.bzip2.org/bzip2/docs/manual_toc.html</A>.
<P> Toekomstige versies van het document kunnen ook een samenvatting bevatten
van de bespreking over of
(en hoe) bzip2 in de Linux kernel zou moeten worden gebruikt.
<H2>1.1 Revisie Historie</H2>

<H3>v2.00</H3>

<P>De sectie 
<A HREF="#bzip2-with-less">Gebruiken van bzip2 met less</A> is
gewijzigd, aangezien .tar.bzip2 bestanden nu werkelijk kunnen worden gelezen.
Met dank aan Nicola Fabiano 
<A HREF="mailto:mc8644@mclink.it">mailto:mc8644@mclink.it</A> 
voor de correctie.
<P>De buzzit utility bijgewerkt.
<P>De informatie over tar bijgewerkt.
<H3>v1.92</H3>

<P>De sectie 
<A HREF="#bzip2-binaries">Verkrijgen van bzip2 binaries</A> 
bijgewerkt, waaronder het toevoegen van die van S.u.S.E.
<H3>v1.91</H3>

<P> Een typo gecorrigeerd en een aantal uitdrukkingen van de shell 
verduidelijkt in de 
<A HREF="#bzip2-with-tar">sectie over het gebruiken van bzip2 met tar</A>.
Met dank aan Alessandro Rubini hiervoor.
<P> De buzzit tool bijgewerkt niet op het originele bzip2-archief te
stampen.
<P> bgrep toegevoegd, een op zgrep lijkende tool.
<H3>v1.9</H3>

<P> Het gcc 2.7.* probleem verduidelijkt. Met dank aan Ulrik Dickow 
om me hierop te wijzen.
<P>De elegante wijze van Leonard Jean-Marc om met tar te werken, toegevoegd. 
<P>De Zweedse vertaling van Linus Ãkerlund toegevoegd.
<P>De wu-ftpd sectie door een suggestie van Arnaud Launay gecorrigeerd.
<P>Vertalingen naar een eigen sectie verplaatst.
<H3>v1.8</H3>

<P> buzzit en tar.diff in de sgml geplaatst waar ze horen. 
Leestekens en formattering hersteld.
Met dank aan Arnaud Launay voor zijn hulp
bij het corrigeren van mijn kopie. :-)
<P> xv project laten vervallen vanwege gebrek aan voldoende belangstelling.
<P> lokartikelen toegevoegd voor toekomstige versies van dit document.
<H3>v1.7</H3>

<P> buzzit utility toegevoegd.
<P>De patch hersteld met het oog op gnu tar.
<H3>v1.6 </H3>

<P> Toegevoegd TenThumbs' Netscape enabler.
<P> Door zijn suggestie ook lesspipe.sh gewijzigd. Het zou nu beter moeten
werken.
<H3>v1.5</H3>

<P> De Franse vertaling van Arnaud Launay, en zijn wu-ftpd bestand
toegevoegd.
<H3>v1.4</H3>

<P> De Japanse vertaling van Tetsu Isaji toegevoegd.
<H3>v1.3</H3>

<P> Toegevoegd Ulrik Dickow's .emacs voor 19.30 en hoger.
<P>(Ook de jka-compr.el patch voor emacs door zijn suggestie. Oeps!
Bzip2 heeft nog(?) geen "append" flag.)
<H3>v1.2</H3>

<P> De patch voor emacs gewijzigd zodat het automatisch
.bz2 bestanden herkent.
<H3>v1.1</H3>

<P>Een patch voor emacs toegevoegd.
<H3>v1.0</H3>

<P> Ronde 1.
<H2><A NAME="get-bzip2"></A> <A NAME="s2">2. Verkrijgen van bzip2</A></H2>

<P>De homepage van Bzip2 homepage bevindt zich op 
<A HREF="http://www.bzip2.org/">De UK homesite</A>.  De mirrorsite in de United States is 
<A HREF="http://www.digistar.com/bzip2/index.html">hier</A>.
<H2>2.1 Bzip2-HOWTO in je eigen taal</H2>

<P> Mensen die Frans spreken willen zich misschien wenden tot de Franse
documenten van Arnaud Launay.
De webversie is te vinden op 
<A HREF="http://www.freenix.fr/linux/HOWTO/mini/Bzip2.html">http://www.freenix.fr/linux/HOWTO/mini/Bzip2.html</A>, en je kunt ftp 
<A HREF="ftp://ftp.lip6.fr/pub/linux/french/docs/HOWTO/mini/Bzip2.gz">ftp://ftp.lip6.fr/pub/linux/french/docs/HOWTO/mini/Bzip2.gz</A>
gebruiken.
Er kan met Arnaud contact worden gezocht via elektronische mail
op 
<A HREF="mailto:zoro@mygale.org">mailto:zoro@mygale.org</A><P> Mensen die Japans spreken willen zich misschien wenden tot de Japanse
documenten van Tetsu Isaji
<A HREF="http://jf.gee.kyoto-u.ac.jp/JF/JF.html">http://jf.gee.kyoto-u.ac.jp/JF/JF.html</A>. Isaji kan
worden bereikt via zijn homepage op
<A HREF="http://www2s.biglobe.ne.jp/~kaien/">http://www2s.biglobe.ne.jp/~kaien/</A>, of 
via elektronische mail op 
<A HREF="mailto:isaji@mxu.meshnet.or.jp">mailto:isaji@mxu.meshnet.or.jp</A><P> Mensen die Zweeds spreken willen zich misschien wenden tot 
de Zweedse documenten van Linus Ãkerlund
<A HREF="http://user.tninet.se/~uxm165t/linux_doc.html">http://user.tninet.se/~uxm165t/linux_doc.html</A>.
Linus kan worden bereikt via elektronische mail op
<A HREF="mailto:uxm165t@tninet.se">mailto:uxm165t@tninet.se</A><H2><A NAME="bzip2-binaries"></A> 2.2 Verkrijgen van de voorgecompileerde binaries van bzip2</H2>

<P>Zie de homesites
<H2>2.3 Verkrijgen van de sources van bzip2</H2>

<P>Ze zijn afkomstig van de Offici&euml;le sites (zie 
<A HREF="#get-bzip2">Verkrijgen van Bzip2</A> voor waar.
<H2>2.4 bzip2 voor je computer compileren</H2>

<P><B>Als je gcc 2.7.*</B> hebt, wijzig dan de regel waarin staat
<BLOCKQUOTE><CODE>
<PRE>
CFLAGS = -O3 -fomit-frame-pointer -funroll-loops
</PRE>
</CODE></BLOCKQUOTE>
<P>in
<BLOCKQUOTE><CODE>
<PRE>
CFLAGS = -O2 -fomit-frame-pointer
</PRE>
</CODE></BLOCKQUOTE>
<P> dat wil zeggen, vervang -O3 door -O2 en laat -funroll-loops weg. 
Misschien dat je ook enige -m* flags toe wilt voegen (zoals bijvoorbeeld
-m486), die je gebruikt als je kernels aan het compileren bent.
<P>Het voorkomen van de -funroll-loops is het belangrijkste gedeelte,
aangezien dit ervoor zorgt dan vele
gcc 2.7's de verkeerde code genereren, en alle gcc 2.7's 
genereren langzamere en grotere code. Voor andere compilers (lcc, egcs,
gcc 2.8.x) zijn de standaard CFLAGS prima.
<P><CODE>make</CODE> en installeer het daarna gewoon volgens de README.
<H2><A NAME="s3">3. Gebruiken van bzip2 op zichzelf</A></H2>

<P>Lees de Prima Manual page :)
<H2><A NAME="bzip2-with-tar"></A> <A NAME="s4">4. bzip2 met tar gebruiken</A></H2>

<P>Hieronder staan drie manieren om bzip2 met tar te gebruiken, te weten
<H2>4.1 Gemakkelijkst in te stellen:</H2>

<P>Deze methode vereist in 't geheel geen setup. 
Om het met bzip2 ingepakte tar-archief in de huidige directory
uit te pakken, tik je in
<BLOCKQUOTE><CODE>
<PRE>
/path/naar/bzip2 -cd foo.tar.bz2 | tar xf -
</PRE>
</CODE></BLOCKQUOTE>
<P>of 
<BLOCKQUOTE><CODE>
<PRE>
tar --use-compress-prog=bzip2 xf foo.tar.bz2
</PRE>
</CODE></BLOCKQUOTE>
<P>Deze werken, maar het kan een PITA zijn om het vaak te typen.
<H2>4.2 Makkelijk in te stellen, tamelijk makkelijk te gebruiken, geenroot-privileges nodig:</H2>

<P> Met dank aan 
<A HREF="mailto:leonard@sct1.is.belgacom.be">Leonard Jean-Marc</A> voor de tip. Ook met dank aan 
<A HREF="mailto:rubini@morgana.systemy.it">Alessandro Rubini</A> voor
onderscheid te maken tussen bash en csh.
<P>Je kunt als volgt een regel in .bashrc plaatsen:
<BLOCKQUOTE><CODE>
<PRE>
alias btar='tar --use-compress-program /usr/local/bin/bzip2 '
</PRE>
</CODE></BLOCKQUOTE>
<P>De analoge regel ziet er in .tcshrc, of .cshrc ongeveer zo uit:
<BLOCKQUOTE><CODE>
<PRE>
alias btar 'tar --use-compress-program /usr/local/bin/bzip2'
</PRE>
</CODE></BLOCKQUOTE>
<H2>4.3 Ook makkelijk te gebruiken, maar hiervoor heb je root-toegangnodig.</H2>

<P>Update je tar tot de laatste versie van GNU, die is op het moment 1.13.10.
Het kan worden gevonden bij 
<A HREF="ftp://alpha.gnu.org/gnu/tar/">de ftpsite van GNU</A> of iedere mirror.
<H2><A NAME="bzip2-with-less"></A> <A NAME="s5">5. bzip2 met less gebruiken</A></H2>

<P>Om bzip2 bestanden al doende te decomprimeren, d.w.z. 
om "less" te kunnen gebruiken zonder ze eerst te decomprimeren,
kun je als volgt een lesspipe.sh (man less) maken:
<P>
<PRE>
#!/bin/sh
# Dit is een preprocessor voor 'less'. Het wordt gebruikt wanneer de
# omgevingsvariabele ervan is ingesteld:
# LESSOPEN="|lesspipe.sh %s"

  case "$1" in
  *.tar) tar tvvf $1 2>/dev/null ;; # Bekijk de inhoud van diverse tar-bestanden
  *.tgz) tar tzvvf $1 2>/dev/null ;;
# Deze werkt voor de ongewijzigde versie van tar:
  *.tar.bz2) bzip2 -cd $1 $1 2>/dev/null | tar tvvf - ;;
# Deze werkt voor die versie van tar waarop de patch is toegepast:
# *.tar.bz2) tyvvf $1 2>/dev/null ;;
  *.tar.gz) tar tzvvf $1 2>/dev/null ;;
  *.tar.Z) tar tzvvf $1 2>/dev/null ;;
  *.tar.z) tar tzvvf $1 2>/dev/null ;;
  *.bz2) bzip2 -dc $1  2>/dev/null ;; # Bekijk gecomprimeerde bestanden
  *.Z) gzip -dc $1  2>/dev/null ;;
  *.z) gzip -dc $1  2>/dev/null ;;
  *.gz) gzip -dc $1  2>/dev/null ;;
  *.zip) unzip -l $1 2>/dev/null ;;
  *.1|*.2|*.3|*.4|*.5|*.6|*.7|*.8|*.9|*.n|*.man) FILE=`file -L $1` ; # groff src
    FILE=`echo $FILE | cut -d ' ' -f 2`
    if [ "$FILE" = "troff" ]; then
      groff -s -p -t -e -Tascii -mandoc $1
    fi ;;
  *) cat $1 2>/dev/null ;;
#  *) FILE=`file -L $1` ; # Controleer of het een binary is, zo ja -- bekijken met 'strings'
#    FILE1=`echo $FILE | cut -d ' ' -f 2`
#    FILE2=`echo $FILE | cut -d ' ' -f 3`
#    if [ "$FILE1" = "Linux/i386" -o "$FILE2" = "Linux/i386" \
#         -o "$FILE1" = "ELF" -o "$FILE2" = "ELF" ]; then
#      strings $1
#    fi ;;
  esac
</PRE>
<H2><A NAME="s6">6. Bzip2 met emacs gebruiken</A></H2>

<H2>6.1 emacs voor iedereen wijzigen:</H2>

<P>Ik heb de volgende patch geschreven voor jka-compr.el welke bzip2 aan
de auto-compression-mode toevoegt.
<P><B>Disclaimer:</B> Ik heb dit alleen met emacs-20.2 getest, maar ik heb
geen reden om aan te nemen, dat een vergelijkbare aanpak niet met andere
versies zou werken.
<P>Om het te gebruiken,
<OL>
<LI>Ga je naar de source-directory van emacs-20.2/lisp 
(waar je het ooit hebt uitgepakt)</LI>
<LI>Plaats de hieronder staande patch in een bestand met de naam
jka-compr.el.diff (dit zou het enige in dat bestand moeten zijn ;).</LI>
<LI>Tik in
<BLOCKQUOTE><CODE>
<PRE>
 patch &lt; jka-compr.el.diff
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>Start emacs, en tik in
<BLOCKQUOTE><CODE>
<PRE>
 M-x byte-compile-file jka-compr.el
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>Ga uit emacs.</LI>
<LI>Verplaats je originele jka-compr.elc naar een veilige plek 
voor het geval van bugs.</LI>
<LI>Vervang het door de nieuwe jka-compr.elc.</LI>
<LI>Veel plezier!</LI>
</OL>
<P>
<PRE>
--- jka-compr.el        Sat Jul 26 17:02:39 1997
+++ jka-compr.el.new    Thu Feb  5 17:44:35 1998
@@ -44,7 +44,7 @@
 ;; De variabele, jka-compr-compression-info-list kan worden gebruikt om
 ;; jka-compr aan te passen dat het met andere compressieprogramma's werkt.
 ;; De standaardwaarde van deze variabele staat om jka-compr te laten werken met
-;; Unix compress en gzip.
+;; Unix compress en gzip. David Fetter voegde bzip2 ondersteuning toe :)
 ;;
 ;; Als je je ongerust maakt over de stderr uitvoer van gzip en andere
 ;; compressie/decompressie programma's die in je buffers terecht komt, je
@@ -121,7 +121,9 @@
 
 
 ;;; Ik heb dit zodanig gedefinieerd in de veronderstelling dat .Z bestanden
 ;;; in unix
-;;; compress formaat zijn; en .gz bestanden in gzip formaat.
+;;; compress formaat zijn; en .gz bestanden in gzip formaat, en .bz2 bestanden,
+;;; in het snelle nieuwe bzip2 formaat van http://www.muraroa.demon.co.uk.
+;;; Ga door met het goede werk, mensen!
 (defcustom jka-compr-compression-info-list
   ;;[regexp
   ;; compr-message  compr-prog  compr-args
@@ -131,6 +133,10 @@
      "compressing"    "compress"     ("-c")
      "uncompressing"  "uncompress"   ("-c")
      nil t]
+    ["\\.bz2\\'"
+     "bzip2ing"        "bzip2"         ("")
+     "bunzip2ing"      "bzip2"         ("-d")
+     nil t]
     ["\\.tgz\\'"
      "zipping"        "gzip"         ("-c" "-q")
      "unzipping"      "gzip"         ("-c" "-q" "-d")
</PRE>
<H2>6.2 emacs voor &eacute;&eacute;n persoon wijzigen:</H2>

<P>Met dank hiervoor aan Ulrik Dickow, 
<A HREF="mailto:ukdATkampsax.dk">ukd@kampsax.dk</A>, Systeem Programmeur bij Kampsax Technology:
<P>Om het zodanig te maken dat je bzip2 automatisch kunt gebruiken als
je geen systeembeheerder bent, voeg je het volgende toe aan je .emacs
bestand.
<P>
<PRE>
;; Automatische (de)compressie bij het laden/bewaren van bestanden 
(gzip(1) en gelijken)
;; We starten het in de uit stand, zodat bzip2(1) ondersteuning kan worden
;; toegevoegd.
;; Bij elkaar gezette code door Ulrik Dickow voor ~/.emacs met Emacs 19.34.
;; Zou ook met vele oudere en nieuwere versies van Emacs moeten werken.
;; Echter geen garantie.
;;
(if (fboundp 'auto-compression-mode) ; Emacs 19.30+
    (auto-compression-mode 0)
  (require 'jka-compr)
  (toggle-auto-compression 0))
;; Voeg nu bzip2 ondersteuning toe en zet auto compressie weer aan.
(add-to-list 'jka-compr-compression-info-list
             ["\\.bz2\\(~\\|\\.~[0-9]+~\\)?\\'"
              "zipping"        "bzip2"         ()
              "unzipping"      "bzip2"         ("-d")
              nil t])
(toggle-auto-compression 1 t)
</PRE>
<H2><A NAME="s7">7. bzip2 met wu-ftpd gebruiken</A></H2>

<P>Met dank aan Arnaud Launay voor deze bandbreedte besparing. Het volgende zou in
/etc/ftpconversions geplaatst moeten worden om tijdens het werken compressies
en decompressies met bzip2 uit te voeren.
Zorg er wel voor dat de paths (zoals /bin/compress) juist zijn.
<P>
<PRE>
 :.Z:  :  :/bin/compress -d -c %s:T_REG|T_ASCII:O_UNCOMPRESS:UNCOMPRESS
 :   : :.Z:/bin/compress -c %s:T_REG:O_COMPRESS:COMPRESS
 :.gz: :  :/bin/gzip -cd %s:T_REG|T_ASCII:O_UNCOMPRESS:GUNZIP
 :   : :.gz:/bin/gzip -9 -c %s:T_REG:O_COMPRESS:GZIP
 :.bz2: :  :/bin/bzip2 -cd %s:T_REG|T_ASCII:O_UNCOMPRESS:BUNZIP2
 :   : :.bz2:/bin/bzip2 -9 -c %s:T_REG:O_COMPRESS:BZIP2
 :   : :.tar:/bin/tar -c -f - %s:T_REG|T_DIR:O_TAR:TAR
 :   : :.tar.Z:/bin/tar -c -Z -f - %s:T_REG|T_DIR:O_COMPRESS|O_TAR:TAR+COMPRESS
 :   : :.tar.gz:/bin/tar -c -z -f - %s:T_REG|T_DIR:O_COMPRESS|O_TAR:TAR+GZIP
 :   : :.tar.bz2:/bin/tar -c -y -f - %s:T_REG|T_DIR:O_COMPRESS|O_TAR:TAR+BZIP2
</PRE>
<H2><A NAME="s8">8. bzip2 met grep gebruiken</A></H2>

<P>Het volgende utility dat ik bgrep noem, is een kleine aanpassing op
zgrep dat met Linux wordt meegeleverd.
Je kunt het gebruiken om, met grep, bestanden te doorzoeken zonder ze
eerst met bzip2 te decomprimeren.
<P>
<PRE>
#!/bin/sh

# bgrep -- een omhulsel rondom een grep-programma waarmee bestanden zonodig
worden gedecomprimeerd
PATH="/usr/bin:$PATH"; export PATH

prog=`echo $0 | sed 's|.*/||'`
case "$prog" in
        *egrep) grep=${EGREP-egrep}     ;;
        *fgrep) grep=${FGREP-fgrep}     ;;
        *)      grep=${GREP-grep}       ;;
esac
pat=""
while test $# -ne 0; do
  case "$1" in
  -e | -f) opt="$opt $1"; shift; pat="$1"
           if test "$grep" = grep; then  # grep zit vol fouten met -e op SVR4
             grep=egrep
           fi;;
  -*)      opt="$opt $1";;
   *)      if test -z "$pat"; then
             pat="$1"
           else
             break;
           fi;;
  esac
  shift
done

if test -z "$pat"; then
  echo "doorzoek bzip2 bestanden met grep"
  echo "usage: $prog [grep_options] pattern [files]"
  exit 1
fi

list=0
silent=0
op=`echo "$opt" | sed -e 's/ //g' -e 's/-//g'`
case "$op" in
  *l*) list=1
esac
case "$op" in
  *h*) silent=1
esac

if test $# -eq 0; then
  bzip2 -cd | $grep $opt "$pat"
  exit $?
fi

res=0
for i do
  if test $list -eq 1; then
    bzip2 -cdfq "$i" | $grep $opt "$pat" > /dev/null &amp;&amp; echo $i
    r=$?
  elif test $# -eq 1 -o $silent -eq 1; then
    bzip2 -cd "$i" | $grep $opt "$pat"
    r=$?
  else
    bzip2 -cd "$i" | $grep $opt "$pat" | sed "s|^|${i}:|"
    r=$?
  fi
  test "$r" -ne 0 &amp;&amp; res="$r"
done
exit $res
</PRE>
<H2><A NAME="s9">9. bzip2 met Netscape onder X gebruiken</A></H2>

<P>tenthumbs@cybernex.net zegt:
<P>
<BLOCKQUOTE><CODE>
Ik vond ook een manier om bzip2 met Linux Netscape te gebruiken
voor Content-Encoding net als het gzip gebruikt. Voeg dit toe aan
$HOME/.Xdefaults of $HOME/.Xresources:
</CODE></BLOCKQUOTE>
<P>Ik gebruik de optie -s omdat ik eerder wat snelheid bij het decomprimeren
zou verruilen tegen het gebruik van RAM.
Je kunt de optie achterwege laten als je dat wilt.
<P>
<PRE>
Netscape*encodingFilters:      \
        x-compress :  : .Z     : uncompress -c  \n\
        compress   :  : .Z     : uncompress -c  \n\
        x-gzip     :  : .z,.gz : gzip -cdq      \n\
        gzip       :  : .z,.gz : gzip -cdq      \n\
        x-bzip2    :  : .bz2   : bzip2 -ds \n
</PRE>
<H2><A NAME="s10">10. bzip2 gebruiken om andere compressieformaten opnieuw te</A>comprimeren</H2>

<P>Het volgende perl-programma accepteert gecomprimeerde bestanden
in andere formaten (.tar.gz, .tgz. .tar.Z, en .Z ) en pakt ze opnieuw
in voor betere compressie.
De perl-source heeft alle soorten handige documentatie
over wat het doet en hoe het dit doet. Deze laatste
versie accepteert bestanden als invoer op de commando-regel. 
Zonder commando-regel argumenten, probeert het ieder bestand in de 
huidige werkdirectory opnieuw in te pakken.
<P>
<P>
<PRE>
#!/usr/bin/perl -w

##########################################################
#                                                        #
# Dit programma zet ingepakte en met gzip gecomprimeerde #
# programma's in de huidige directory om in het bzip2    #
# formaat. Het handelt de .tgz extensie op een redelijke #
# manier af door er een .tar.bz2 bestand van te maken.   #
#                                                        #
##########################################################
$counter = 0;
$saved_bytes = 0;
$totals_file = '/tmp/machine_bzip2_total';
$machine_bzip2_total = 0;

@raw = (defined @ARGV)?@ARGV:&lt;*>;

foreach(@raw) {
    next if /^bzip/;
    next unless /\.(tgz|gz|Z)$/;
    push @files, $_;
}
$total = scalar(@files);

foreach (@files) {
    if (/tgz$/) {
        ($new=$_) =~ s/tgz$/tar.bz2/;
    } else {
        ($new=$_) =~ s/\.g?z$/.bz2/i;
    }
    $orig_size = (stat $_)[7];
    ++$counter;
    print "Repacking $_ ($counter/$total)...\n";
    if ((system "gzip -cd $_ |bzip2 >$new") == 0) {
        $new_size = (stat $new)[7];
        $factor = int(100*$new_size/$orig_size+.5);
        $saved_bytes += $orig_size-$new_size;
        print "$new is about $factor% of the size of $_. :",($factor&lt;100)?')':'(',"\n";
        unlink $_;
    } else {
        print "Arrgghh!  Er is iets gebeurd met $_: $!\n";
    }
}
print "Je hebt "
    , ($saved_bytes>=0)?"bespaard ":"verloren "
    , abs($saved_bytes)
    , " bytes aan opslagruimte :"
    , ($saved_bytes>=0)?")":"("
    , "\n"
    ;

unless (-e '/tmp/machine_bzip2_total') {
    system ('echo "0" >/tmp/machine_bzip2_total');
    system ('chmod', '0666', '/tmp/machine_bzip2_total');
}


chomp($machine_bzip2_total = `cat $totals_file`);
open TOTAL, ">$totals_file"
     or die "Kan system-wide totaalniet openen: $!";
$machine_bzip2_total += $saved_bytes;
print TOTAL $machine_bzip2_total;
close TOTAL;

print "Dat is een totaal van ",`cat $totals_file`," bytes bespaard.\n";
</PRE>
</BODY>
</HTML>
