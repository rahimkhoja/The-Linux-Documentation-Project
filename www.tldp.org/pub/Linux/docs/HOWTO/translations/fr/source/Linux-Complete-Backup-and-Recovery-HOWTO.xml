<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
  "http://www.docbook.org/xml/4.3/docbookx.dtd" [

<!-- <!entity header system "header.sgml"> -->
<!-- These allow the equivalent of #includes below. C^2 -->

<!ENTITY make.fdisk SYSTEM "inclusions/make.fdisk">
<!ENTITY make.dev.hda SYSTEM "inclusions/make.dev.hda">
<!ENTITY mount.dev.hda SYSTEM "inclusions/mount.dev.hda">
<!ENTITY dev.hda SYSTEM "inclusions/dev.hda">
<!ENTITY save.metadata SYSTEM "inclusions/save.metadata">
<!ENTITY restore.metadata SYSTEM "inclusions/restore.metadata">
<!ENTITY back.up.all SYSTEM "inclusions/back.up.all">
<!ENTITY back.up.all.ssh SYSTEM "inclusions/back.up.all.ssh">
<!ENTITY restore.all SYSTEM "inclusions/restore.all">
<!ENTITY restore.all.ssh SYSTEM "inclusions/restore.all.ssh">
<!ENTITY get.tester SYSTEM "inclusions/get.tester">
<!ENTITY restore.tester SYSTEM "inclusions/restore.tester">
<!ENTITY first.stage SYSTEM "inclusions/first.stage">
<!ENTITY longversion "$Header: /usr/cvs/LDP/howto/docbook/Linux-Complete-Backup-and-Recovery-HOWTO/Linux-Complete-Backup-and-Recovery-HOWTO.sgml,v 1.26 2004/04/30 01:18:32 gferg Exp $">
<!ENTITY myemail "charlescurley CHEZ charlescurley POINT com">
<!ENTITY myurl "http://www.charlescurley.com">
<!ENTITY % review "IGNORE">
]>

<!-- Allow review comments. To make them go away for release, change 
     "INCLUDE" to "IGNORE" -->
<!-- <!entity % review "INCLUDE"> -->

<article lang="fr" id="index">

<articleinfo>
 
<title>
    Guide pratique de sauvegarde et de récupération sous Linux
</title>

<subtitle>
    Version française du guide pratique <foreignphrase lang="en">Linux Complete 
    Backup and Recovery HOWTO</foreignphrase>
</subtitle>

<pubdate>10 octobre 2004</pubdate>
<releaseinfo>1.6.fr.1.0</releaseinfo>

<author>
   <firstname>Charles</firstname>
   <surname>Curley</surname>
 <email>&myemail;</email>
</author>

<othercredit role="traduction" class="translator">
   <firstname>Denis</firstname>
   <surname>Berhaut</surname>
   <contrib>Adaptation française</contrib>
   <email>denis POINT berhaut CHEZ free POINT fr</email>
</othercredit>

<othercredit role="relecture" class="translator">
  <firstname>Guillaume</firstname>
  <surname>Lelarge</surname>
  <contrib>Relecture de la version française</contrib>
  <email>gleu CHEZ wanadoo POINT fr</email>
</othercredit>

<othercredit role="publication" class="copyeditor">
   <firstname>Jean-Philippe</firstname>
   <surname>Guérard</surname>
   <contrib>Préparation de la publication de la v.f.</contrib>
   <email>fevrier CHEZ tigreraye POINT org</email>
</othercredit>

<revhistory>

<!-- Additional revision history entries go here -->
<!-- Can we automate this? C^2 -->

<!-- Chaque nouvelle version de l'adaptation française doit faire 
     l'objet d'une entrée séparée de l'historique des révisions.
  -->

<revision>
<revnumber>1.6.fr.1.0</revnumber>
<date>2004-10-10</date>
<authorinitials>DB, GL, JPG</authorinitials>

<revremark>

    Première adaptation française.

</revremark>
</revision>

<!--

    Conformément à la licence, il est nécessaire de conserver une copie 
    du texte de l'historique des révision en version originale.

  -->

<revision>
    <revnumber>1.6</revnumber>
    <date>2004-04-29</date>
    <authorinitials>C^2</authorinitials>

    <revremark>

        Ajout de notes sur Knoppix, Syslinux, PPART, QtParted, quelques 
        autres CDROM de secours, ainsi que quelques corrections.

        <emphasis lang="en">(Added Knoppix notes, Syslinux, PPART, QtParted,
        some other rescue CDs, and made some fixes.)</emphasis>

    </revremark>
</revision>

<revision>
    <revnumber>1.5</revnumber>
    <date>2003-12-19</date>
    <authorinitials>C^2</authorinitials>
    
    <revremark>
    
        Notes sur Fedora et GRUB.

        <emphasis lang="en">(Fedora and GRUB notes.)</emphasis>
    
    </revremark>
</revision>

 <revision>
    <revnumber>1.4</revnumber>
    <date>2003-08-17</date>
    <authorinitials>C^2</authorinitials>
    <revremark>
    
        Quelques notes sur le gravage des CDROM et rajouts concernant
        les fichiers à exclure.
    
        <emphasis lang="en">(Some notes on burning CD-ROMs, and more 
        on files to exclude.)</emphasis>

    </revremark>
       
</revision>
<revision>
    <revnumber>1.3</revnumber>
    <date>2003-04-24</date>
    <authorinitials>C^2</authorinitials>
    <revremark>
    
        Substitution d'une nouvelle adresse de courrier électronique et d'une
        URL aux anciennes.

        <emphasis lang="en">(Substituted new email address and URL for 
        old.)</emphasis>
        
    </revremark>
</revision>

<revision>
    <revnumber>1.2</revnumber>
    <date>2003-02-12</date>
    <authorinitials>C^2</authorinitials>
    <revremark>
    
        Ajout de notes pour Red Hat 8.0, pour le support de FAT32, 
        scission de la première étape des scripts de restauration, ainsi 
        que quelques changements mineurs. Notes sur <link 
        linkend="amanda">Amanda</link>.

        <emphasis lang="en">(Added Red Hat 8.0 notes, support for FAT32, split
        the first stage restore scripts, and other minor changes. Notes on 
        <link linkend="amanda">Amanda</link>.)</emphasis>

    </revremark>
</revision>

<revision>
    <revnumber>1.1</revnumber>
    <date>2002-09-10</date>
    <authorinitials>C^2</authorinitials>
    <revremark>
	
        Nouveau code pour prendre en charge les partitions ext3 dans le 
        fichier <link 
        linkend="make.fdisk"><filename>make.fdisk</filename></link>, 
        ainsi qu'une note sur <link 
        linkend="initrd"><filename>initrd</filename></link>.

        <emphasis lang="en">(New code to handle ext3 partitions in <link 
        linkend="make.fdisk"> <filename>make.fdisk</filename> </link>, 
        and a note on <link linkend="initrd"> 
        <filename>initrd</filename> </link>.)</emphasis>

    </revremark>
</revision>

<revision>
    <revnumber>1.0</revnumber>
    <date>2002-07-24</date>
    <authorinitials>C^2</authorinitials>
    
    <revremark>
    
        Désormais, nous utilisons la compression bz2 pour la première 
        étape, disposons de l'option «&nbsp;run time&nbsp;» pour la 
        vérification des blocs défectueux et avons créé un script qui 
        exécute entièrement la première étape.
    
        <emphasis lang="en">(We now use bz2 compression in the first 
        stage, have the run time option to check for bad 
        blocks, and have a script that runs the entire first 
        stage.)</emphasis>

    </revremark>
</revision>

</revhistory>

<abstract><para>

    Imaginez une seconde que votre disque dur vient de se transformer en 
    un palet de hockey hors de prix. Imaginez qu'après un incendie, 
    votre ordinateur ressemble à un sujet que Salvador Dali
    apprécierait. Et maintenant&nbsp;?

</para>
<para>

    La restauration complète, que l'on appelle parfois restauration 
    intégrale de système, est un processus consistant à remonter un 
    ordinateur après une panne catastrophique. Pour effectuer une 
    restauration complète, vous devez disposer de sauvegardes complètes, 
    non seulement de vos systèmes de fichiers, mais aussi des 
    informations sur vos partitions, ainsi que sur d'autres données. Ce 
    guide pratique est un tutoriel qui vous montrera pas à pas comment 
    sauvegarder un ordinateur sous Linux pour être en mesure d'effectuer 
    une restauration intégrale de système, et comment effectuer cette 
    restauration intégrale de système. Il comprend des scripts destinés 
    à ces tâches.

</para></abstract>

</articleinfo>

 <!-- Section1: intro -->

<sect1 id="intro">

<title>Introduction</title>

<para>

Le processus de restauration intégrale de système consiste à&nbsp;: 
installer le système d'exploitation à partir des disques du produit. 
installer le logiciel de sauvegarde de façon à pouvoir restaurer vos 
données. Restaurer vos données. Puis, il vous faudra restaurer les 
fonctionnalités en vérifiant vos fichiers de configuration, les 
droits, etc.

</para>

<para>

    Le processus et les scripts décrits dans ce guide pratique 
    sauvegarderont la réinstallation du système d'exploitation. Le 
    processus décrit ici restaurera uniquement les sauvegardes des 
    fichiers de l'ordinateur de production. La restauration vous 
    rétablira votre configuration intacte, vous épargnant des heures de 
    vérification de votre configuration et des données.

</para>

<sect2 id="copyright">

<title>

    Droits d'utilisation <foreignphrase lang="en">(Copyright 
    Information)</foreignphrase>

</title>

<para>

Copyright &copy; 2001, 2002, 2003 Charles Curley pour la version 
originale.

</para>

<para>

Copyright &copy; 2004 Denis Berhaut, Guillaume Lelarge, Jean-Philippe Guérard
pour la version française.

</para>

<para>

Ce document est distribué selon les termes de la licence GNU Free 
Documentation License (GFDL), décrite ci-dessous. Permission est 
accordée de copier, distribuer et de modifier ce document selon les 
termes de la GNU Free Documentation Licence, version 1.1 ou ultérieure 
publiée par la Free Software Foundation à condition qu'il ne contienne 
ni Section Inaltérable, ni texte de première ou de quatrième de 
couverture. Une copie de la licence est incluse dans la section <link 
linkend="appendix1gfdl"><quote>Licence GNU Free 
Documentation</quote></link>.

</para>

<para><foreignphrase lang="en">

Copyright © 2001, 2002, 2003 Charles Curley and distributed under the 
terms of the GNU Free Documentation License (GFDL) license, stated 
below. Permission is granted to copy, distribute and/or modify this 
document under the terms of the GNU Free Documentation License, Version 
1.1 or any later version published by the Free Software Foundation; with 
no Invariant Sections, with no Front-Cover Texts, and with no Back-Cover 
Texts. A copy of the license is included in the section entitled <link 
linkend="appendix1gfdl"><quote>GNU Free Documentation 
License</quote></link>.

</foreignphrase></para>

<para><foreignphrase lang="en">

If you have any questions, please contact 

<email>linux-howto at metalab.unc.edu</email>.

</foreignphrase></para>

<para>

Pour toute question relative à la version originale de ce document, 
veuillez contacter en anglais

<email>linux TIRET howto CHEZ metalab POINT unc POINT edu</email>.

</para>

<para>

    N'hésitez pas à faire parvenir tout commentaire relatif à la version 
    française de ce document à

    <email>commentaires CHEZ traduc POINT org</email>

    en précisant son titre, sa date et sa version.

</para>


 </sect2>
 <sect2 id="disclaimers">

<title>
    Limitation de Responsabilité
    
    (<foreignphrase lang="en">Disclaimers</foreignphrase>)
    
</title>

<para>
 
    Ni l'auteur de ce document, ni le <ulink 
    url="http://www.tldp.org/">Projet de documentation Linux</ulink> ou 
    qui que ce soit d'autre ne pourra être tenu responsable du contenu 
    de ce document. L'utilisation des concepts, exemples et autres 
    contenus du document s'effectue à vos risques et périls. Il peut 
    comporter des erreurs ou des inexactitudes pouvant endommager votre 
    système. Procédez prudemment, et bien qu'il n'y ait probablement pas 
    d'erreur, l'auteur dégage toute responsabilité à leur sujet.

</para>

<para><foreignphrase lang="en">

     No liability for the contents of this documents can be accepted by 
     the author, the <ulink url="http://www.tldp.org/">Linux 
     Documentation Project</ulink> or anyone else. Use the concepts, 
     examples and other content at your own risk. There may be errors 
     and inaccuracies that may damage your system. Proceed with caution, 
     and, although errors are unlikely, the author take no 
     responsibility for them.

</foreignphrase></para>

<para>

    Sauf mention spécifique, les droits d'auteur sont la possession de 
    leurs propriétaires respectifs. L'utilisation d'un terme dans ce 
    document ne devrait pas être considérée comme ayant une influence 
    sur la validité d'une quelconque marque déposée ou marque de 
    services.

</para>

<para><foreignphrase lang="en">

    All copyrights are held by their by their respective owners, unless 
    specifically noted otherwise. Use of a term in this document should 
    not be regarded as affecting the validity of any trademark or 
    service mark.

</foreignphrase></para>

<para>
 
    Le fait de nommer un produit ou une marque ne doit pas être 
    considéré comme une approbation.

</para>

<para><foreignphrase lang="en">

    Naming of particular products or brands should not be seen as 
    endorsements.

</foreignphrase></para>
 
<para>

    Nous vous recommandons fortement d'effectuer une sauvegarde de votre 
    système avant une installation importante et d'effectuer des 
    sauvegardes à intervalles réguliers. De plus, nous vous recommandons 
    fortement d'utiliser un ordinateur expérimental dédié lorsque vous 
    mettrez les mains dans le cambouis des matériaux de ce guide 
    pratique, en particulier les scripts.

</para>

<para><foreignphrase lang="en">

    You are strongly recommended to take a backup of your system before 
    major installation and backups at regular intervals. In addition, 
    you are strongly recommended to use a sacrificial experimental 
    computer when mucking with the material, especially the scripts, in 
    this HOWTO.

</foreignphrase></para>

</sect2>

<sect2 id="newversions">

<title>Nouvelles versions</title>

<para>

Vous pourrez trouver ce document à sa <ulink 
url="&myurl;/Linux-Complete-Backup-and-Recovery-HOWTO.html">page 
d'accueil</ulink> ou sur le site internet du <ulink 
url="http://www.tldp.org/">projet de documentation Linux</ulink> dans de 
nombreux formats. Envoyez vos commentaires à l'adresse 
<email>&myemail;</email>.

</para>

<para>

En fonction de votre navigateur, il vous faudra peut-être maintenir la 
touche majuscule appuyée pour les télécharger lorsque vous cliquerez 
dessus.

</para>

<itemizedlist>

<listitem><para>

<ulink 
url="&myurl;/Linux-Complete-Backup-and-Recovery-HOWTO/Linux-Complete-Backup-and-
Recovery-HOWTO.chunky.html.tar.bz2">compression 
bzip2 de divers fichiers (beaucoup de petites pages. Lecture plus 
rapide.) HTML</ulink>

</para></listitem>

<listitem><para>

<ulink 
url="&myurl;/Linux-Complete-Backup-and-Recovery-HOWTO/Linux-Complete-Backup-and-
Recovery-HOWTO.smooth.html.tar.bz2"> 
compression bzip2 <quote>douce</quote> (une énorme page &mdash; pas de 
petits fichiers. Recherches plus faciles). HTML</ulink>

</para></listitem>

<listitem><para>

<ulink 
url="&myurl;/Linux-Complete-Backup-and-Recovery-HOWTO/Linux-Complete-Backup-and-
Recovery-HOWTO.ps.bz2"> 
compression bzip2 postscript (format lettre US)</ulink>

</para></listitem>

<listitem><para>

<ulink 
url="&myurl;/Linux-Complete-Backup-and-Recovery-HOWTO/Linux-Complete-Backup-and-
Recovery-HOWTO.pdf.bz2"> 
compression bzip2 PDF (format lettre US)</ulink>

</para></listitem>

<listitem><para>

<ulink
url="&myurl;/Linux-Complete-Backup-and-Recovery-HOWTO/Linux-Complete-Backup-and-
Recovery-HOWTO.txt.bz2">
compression bzip2 texte brut ASCII</ulink>

</para></listitem>

<listitem><para>

Utilise les <ulink 
url="&myurl;/Linux-Complete-Backup-and-Recovery-HOWTO/Linux-Complete-Backup-and-
Recovery-HOWTO.tar.bz2">sources</ulink>, 
Luke.

</para></listitem>

</itemizedlist>

</sect2>

<sect2 id="credits">

<title>Historique</title>

<para>

Ce document provient de deux articles publiés à l'origine dans <ulink 
url="http://www.linuxjournal.com/"><citetitle pubwork="journal">le 
Linux Journal</citetitle></ulink>. Je tiens à remercier <citetitle 
pubwork="journal"> le Linux Journal</citetitle> pour avoir modifié les 
droits sur ces articles, rendant la rédaction de ce guide pratique 
possible.

</para>

<para>

Je remercie particulièrement Joy Y Goodreau pour son excellente mise en forme du
guide pratique, et David Palomares pour avoir corrigé l'orthographe du prénom de
Salvador Dali.

</para>
 
<para>

D'autres remerciements vont à <ulink url="mailto:pon CHEZ iki POINT fi">
Pasi Oja-Nisula</ulink> pour avoir corrigé un bogue et fourni des informations sur
<ulink url="http://www.knoppix-fr.org/">Knoppix</ulink>.

</para>

<!-- <para>
-->
<!-- In this version I have the pleasure of acknowledging: -->
<!-- </para>
-->
<!-- <para>
-->
<!-- <email>
nom CHEZ site POINT org</email>
-->
<!-- </para>
-->
<!-- <para> -->
<!-- <emphasis>Merci de maquiller les adresses pour que les pirates -->
<!-- n'obtiennent pas les adresses de ce guide pratique et n'envoient pas de
spams. -->
<!-- Ceci s'est déjà produit dans le passé..</emphasis> -->
<!-- </para> -->

<!-- <para> -->
<!-- <emphasis>Une société</emphasis>  est citée pour m'avoir envoyé -->
<!-- de la documentation sur leur produit ainsi que la permission de faire
référence à -->
<!-- leur matériau. Ces références ont été approuvées avant d'être insérées -->
<!-- ici et seront clairement mentionnées. -->
<!-- </para> -->

</sect2>

<sect2 id="feedback">
<title>Commentaires et réactions</title>

<para>

Les réactions que vous pourrez faire à ce document sont bienvenues. Sans vos
corrections, suggestions et autres apports, ce document n'existerait pas.
Envoyez-moi, en anglais, vos ajouts, commentaires et critiques à cette adresse&nbsp;:
<email>&myemail;</email>.

</para>

<para>
    
    N'hésitez pas à faire parvenir tout commentaire relatif à la
    version française de ce document à
    
    <email>commentaires CHEZ traduc POINT org</email>
    
    en précisant son titre, sa date et sa version.
    
</para>

</sect2>
 
<sect2 id="translations">
<title>Traductions</title>

<para>

Tout le monde ne parle pas anglais. Les volontaires sont bienvenus.

</para>

<!-- <para>
-->
<!-- <itemizedlist>
-->
<!-- <listitem>
-->
<!-- <para>
-->
<!-- <ulink url="http://linuxdoc.org/">
Traduction en allemand</ulink>
-->
<!-- by <email>
qui CHEZ où POINT de</email>
-->
<!-- </para>
-->
<!-- </listitem>
-->
<!-- <listitem>
-->
<para>

<ulink url="http://www.traduc.org/docs/howto/lecture/">Traduction en 
français</ulink> par

<personname>
    <firstname>Denis</firstname>
    <surname>Berhaut</surname>
</personname>

<email>denis POINT berhaut CHEZ free POINT fr</email>

</para>

<para>

Relecture par

<personname>
    <firstname>Guillaume</firstname>
    <surname>Lelarge</surname>
</personname>

<email>gleu CHEZ wanadoo POINT fr</email>

</para>

<!-- </listitem>
-->
<!-- <listitem>
-->
<!-- <para>
-->
<!-- <ulink url="http://linuxdoc.org/">
Traduction en italien</ulink>
-->
<!-- par <email>
qui CHEZ où POINT it
-->
<!-- </para>
-->
<!-- </listitem>
-->
<!-- </itemizedlist>
-->
<!-- </para>
-->

</sect2>

</sect1>

<sect1 id="Overview">

 <title>Tour d'horizon</title>

<para>

Mettre en &oelig;uvre le processus présenté ci-dessous n'est pas facile et 
peut être dangereux pour vos données. Entraînez-vous avant d'en avoir 
besoin&nbsp;! Faites comme moi et <emphasis>utilisez un ordinateur 
sacrifié d'avance.</emphasis>&nbsp;!

</para>

 <para>

Dans ce guide pratique, l'ordinateur cible est un Pentium. À l'origine, 
la version de <ulink url="http://www.fr.redhat.com">Red Hat</ulink> 7.1 
Linux serveur ou poste de travail était installée sur un disque dur IDE. 
Depuis, il a été mis à jour vers la Red Hat 8.0 et <ulink 
url="http://fedora.redhat.com/">Fedora Core 1</ulink>. L'ordinateur 
cible ne contient pas beaucoup de données dans la mesure où c'est une 
<quote>machine sacrifiée</quote> consacrée aux tests. En fait, je ne 
voulais pas tester ce processus avec un ordinateur de production et des 
données de production. Aussi, j'ai effectué une installation avant 
d'engager les tests pour être en mesure de réinstaller si j'avais besoin 
de retourner à une configuration connue.

</para>

 <note><title>N.B.</title>
 <para>
 
Les exemples de commandes montreront, en général, ce que j'ai dû 
effectuer pour récupérer le système cible. Vous utiliserez sans doute 
des commandes similaires, mais avec des paramètres différents. C'est à 
vous de vous assurer que vous dupliquez votre configuration, et non pas 
la configuration de l'ordinateur de test.

  </para></note>
  
<para>

La procédure initiale a été mise au point dans le livre de W. Curtis Preston,
<ulink url="http://www.oreilly.com/catalog/unixbr/">
<citetitle pubwork="book">Unix Backup &amp; Recovery</citetitle></ulink>,
O'Reilly &amp; Associates, 1999, que j'ai approuvé dans le <ulink
url="http://www2.linuxjournal.com/lj-issues/issue78/3839.html">
<citetitle pubwork="journal">Linux Journal</citetitle></ulink>.
Cependant, le livre est un peu léger en ce qui concerne les questions
spécifiques, concrètes. Par exemple, quels fichiers faut-il sauvegarder&nbsp;?
Quelles méta données sont à conserver, et comment&nbsp;?

</para>

<para>

Avant de démarrer le processus publié dans ce guide pratique, il vous faudra
sauvegarder votre système à l'aide d'un outil de sauvegarde classique comme
Amanda, <trademark class="trade">BRU</trademark>, tar, <trademark
class="registered">Arkeia</trademark>ou cpio. La question suivante sera de
déterminer comment exécuter l'outil qui restaurera vos données à partir d'un matériel
hors d'usage.

</para>

<para>

Les utilisateurs du Red Hat Package Manager (RPM) des distributions Linux
devront aussi sauver les méta données RPM en tant que parties intégrantes de
leurs sauvegardes normales. Une instruction du type&nbsp;:

</para>

<programlisting>
bash# <command>rpm -Va > /etc/rpmVa.txt</command>
</programlisting>

<para>

dans votre script de sauvegarde vous donnera une base de comparaison du résultat
à obtenir après une restauration intégrale de système.

</para>

<para>
Pour arriver à ce point, il vous faut&nbsp;: </para>
 <itemizedlist>
 <listitem>
	<para>
Votre matériel remonté et de nouveau en état de marche, les composants ayant été
remplacés. Le BIOS devrait être configuré correctement, y compris l'heure et la
date, ainsi que les paramètres du disque dur. À ce stade, il n'y a pas de raison
d'utiliser un disque dur différent.</para>
 </listitem>
 <listitem>
	<para>
 Un lecteur <ulink url="http://www.iomega.com/">
<trademark class="registered">Iomega</trademark>
</ulink>
<ulink url="http://www.iomega.com/zip/products/par100_250.html">
<trademark class="registered">ZIP</trademark> sur port parallèle</ulink>
ou équivalent. Vous aurez besoin d'au moins 30&nbsp;Mo d'espace libre.</para>
 </listitem>
 <listitem>
	<para>Votre média de sauvegarde.</para>
 </listitem>
 <listitem>
	<para>Un système Linux minimal pour vous permettre de lancer le logiciel de
restauration.</para>
 </listitem>
 </itemizedlist>

<para>
Pour en arriver là, au moins deux étapes de sauvegarde sont nécessaires,
peut-être trois. La nature exacte de ce que vous sauvegardez et à quelle étape
vous sauvegardez est déterminée par votre processus de restauration. Par
exemple, si vous restaurez un serveur de bandes, il se peut que vous n'ayez pas
besoin du réseau pendant le processus de restauration. Donc, sauvegardez le
réseau uniquement lors de vos sauvegardes habituelles.</para>

<para>
De plus, vous restaurerez par étapes. À l'étape une, nous construisons les
partitions, les systèmes de fichiers, etc. et restaurons un minimum de fichiers
du disque ZIP. L'objectif de la première étape est de pouvoir initialiser un
ordinateur disposant d'une connexion réseau, de lecteurs de bandes, d'un
logiciel de restauration ou de tout ce qui est nécessaire pour l'étape
deux.</para>

<para>
La seconde étape si nécessaire, consiste à restaurer le logiciel de sauvegarde
et les bases de données associées. Par exemple, supposons que vous utilisiez
Arkeia et que vous prépariez un disque zip de restauration intégrale de système
pour votre serveur de sauvegarde. Arkeia occupe énormément d'espace pour sa base
de données sur les disques durs du serveur. Si vous le désirez, vous pouvez
récupérer la base de données à partir des bandes. À la place, pourquoi ne pas
archiver et compresser avec tar et gzip l'intégralité du répertoire arkeia
(/usr/knox), et l'enregistrer sur un autre ordinateur à l'aide de nfs ou
ssh&nbsp;? La première étape, comme nous l'avons défini plus bas, ne comprend pas X.
Vous aurez donc quelques tests à effectuer si vous désirez sauvegarder X avec
votre programme de sauvegarde. Pour certains programmes de restauration, X est
indispensable.</para>

<para>
Bien sûr, si vous utilisez d'autres programmes de sauvegarde, vous aurez
peut-être un travail de détective à effectuer. Vous devrez déterminer les
répertoires et les fichiers nécessaires à son fonctionnement. Si vous utilisez
tar, gzip, cpio, mt ou dd comme outils de sauvegarde et de restauration, ils
devront être enregistrés sur votre disque ZIP et restaurés pendant la première
étape décrite plus bas.</para>

<para>
La dernière étape est une restauration intégrale à partir d'une bande ou d'un
autre média. Après avoir terminé la dernière étape, vous devriez pouvoir
démarrer un système entièrement restauré et opérationnel.</para>

<sect2 id="limitations">
<title>Limitations</title>
 
<para>
Ce guide pratique se limite à la création d'une sauvegarde minimum de sorte que,
ayant ensuite restauré cette sauvegarde vers un nouveau matériel (<quote>
restauration intégrale de système</quote>), vous pourrez ensuite utiliser vos
sauvegardes traditionnelles pour restaurer
un système totalement opérationnel. Ce guide pratique ne traite pas de vos
sauvegardes traditionnelles.</para>

<para>
Même dans ce cadre étroit, ce guide pratique n'est pas exhaustif. Vous devrez
encore faire des recherches, éditer des scripts et effectuer des tests.</para>
 
<para>
Les scripts présentés restaurent les données des partitions telles qu'elles sont
sur le disque dur d'origine. Ce serait formidable si vous pouviez restaurer sur
un ordinateur identique ou au moins un disque dur identique, mais c'est rarement
le cas. Pour l'instant, il y a deux remèdes (qui prendront plus de sens après
que vous ayez lu le reste du guide pratique)&nbsp;:</para>

<itemizedlist>
	<listitem>
	 <para>
Éditez le fichier d'entrée de la table des partitions. Je l'ai fait quelquefois.
Vous pouvez aussi recourir à ce moyen pour ajouter de nouvelles partitions ou en
supprimer (mais éditez les scripts qui utilisent aussi le fichier d'entrées de
la table des partitions).</para>
	</listitem>
	<listitem>
	 <para>
Créez à la main une nouvelle table des partitions et partez de ce point. c'est
une des raisons qui fait que <link linkend="restore.metadata"><filename>
restore.metadata</filename></link> n'appelle pas le script de reconstruction du
disque dur. Utilisez le <link linkend="mount.dev.hda">script de reconstruction</link>.</para>
	</listitem>
</itemizedlist>

<para>
Les scripts présentés ici prennent en charge uniquement ext2fs, FAT12, FAT16 et
FAT32. Vous aurez besoin d'autres outils pour sauvegarder et restaurer des
systèmes de fichiers que nous n'avons pas couverts, à moins que des volontaires
passionnés ne codent les scripts pour le faire. <ulink
url="http://www.partimage.org/">Partition Image</ulink> se présente comme un candidat
utile.</para>

</sect2>

</sect1>

<sect1 id="Preparation">
<title>Préparation</title>

<note>
 <title>AVERTISSEMENT</title>
 <para>
Effectuez vos sauvegardes traditionnelles de façon régulière. Ce guide pratique
est sans intérêt si vous ne le faites pas.</para>
</note>

<para>
Fabriquez vous-même un disque de secours. J'utilise <ulink
url="http://www.toms.net/rb">tomsrtbt</ulink>. Il est bien documenté et tient
sur une disquette qui comprend de nombreux
outils utiles. Sa liste de discussion est active et les quelques questions que
j'ai posées ont trouvé rapidement une réponse précise. J'apprécie cela dans un
produit dont ma boutique peut dépendre un jour.</para>

<para>
Ensuite, imaginez comment sauvegarder le système d'exploitation dont vous aurez
besoin pour restaurer vos sauvegardes traditionnelles. J'ai suivi les conseils
de Preston et j'ai utilisé un lecteur ZIP sur port parallèle. Les lecteurs
contiennent à peu près 90&nbsp;Mo utiles. J'ai besoin d'environ 85&nbsp;Mo pour
sauvegarder mon ordinateur, ce qui fait qu'un lecteur de 100&nbsp;Mo peut être votre
salut.</para>

<sect2 id="installingzipdrive">
<title>Installation du lecteur ZIP</title>

<para>
L'installation du lecteur ZIP est décrite dans le <ulink
url="http://www.tldp.org/HOWTO/mini/ZIP-Drive.html">
guide pratique des disques ZIP</ulink>, qui est disponible auprès du <ulink
url="http://www.tldp.org/">Linux Documentation Project</ulink>
et, pour sa traduction française, à l'adresse <ulink
url="http://www.traduc.org/docs/howto/lecture/ZIP-Drive.html">
http://www.traduc.org/docs/HOWTO/vf/ZIP-Drive.html</ulink>
. <!-- njt.com: bad hostname 2003 07 25 -->
</para>

</sect2>

</sect1>

<sect1 id="CreatingtheStage1BackUp">
<title>Création de la sauvegarde de l'étape 1</title>

<para>
Votre sauvegarde de production étant effectuée, il est indispensable de
conserver les informations de partitions pour pouvoir les reconstruire.</para>

<para>
Le script  <link linkend="make.fdisk"><filename>make.fdisk</filename></link>
recherche les informations des partitions du disque dur et les enregistre dans
trois fichiers. Le premier est un script exécutable, nommé <link
linkend="make.dev.hda"><filename>make.dev.x</filename></link> (où <quote>x</quote>
est le nom du fichier de périphérique, c'est-à-dire hda). Le second est <link
linkend="mount.dev.hda"><filename>mount.dev.x</filename></link>, qui crée les
points de montage et qui y monte les partitions nouvellement créées. Le dernier,
<link linkend="dev.hda"><filename>dev.x</filename></link>, est constitué des
commandes nécessaires à <command>fdisk</command> pour construire les partitions.
Vous précisez quel disque dur vous désirez, pour construire les scripts associés
(et donc les noms de fichiers) en nommant le fichier de périphérique associé comme
argument de <link linkend="make.fdisk"><filename>make.fdisk</filename></link>. Par
exemple, sur un système IDE classique,</para>

<programlisting>
bash# <command>make.fdisk /dev/hda</command>
</programlisting>

<para>
produit les scripts <link linkend="make.dev.hda"><filename>make.dev.hda</filename></link>,
<link linkend="mount.dev.hda"><filename>mount.dev.hda</filename></link> ainsi que le
fichier en entrée de <command>fdisk</command>, <link
linkend="dev.hda"><filename>dev.hda</filename></link>.</para>

<para>
De plus, si <link linkend="make.fdisk"><filename>make.fdisk</filename></link>
rencontre une partition FAT, il conserve le secteur d'amorçage de la partition
dans un fichier nommé <filename>dev.xy</filename>, où x est le nom de périphérique
du disque (c'est-à-dire sdc, hda) et y est le numéro de la partition. Le secteur
d'amorçage est le premier secteur (512 octets) de la partition. Ce secteur est
restauré en même temps que les partitions sont reconstruites, dans le script
<filename>make.dev.hda</filename>.</para>

<para>
Heureusement, le prix des disques durs s'effondre presque aussi vite que la
confiance du public envers les politiciens après une élection. Donc, c'est une
bonne chose que les fichiers produits soient au format texte et puissent être
édités manuellement. C'est la façon la plus difficile mais la plus flexible pour
effectuer une reconstruction sur un plus grand disque de remplacement. (Voir 
<link linkend="todo">la liste du carnet de route</link>.)</para>

<para>
Les autres méta données sont conservées dans le script <link
linkend="save.metadata"><filename>save.metadata</filename></link>.
Le script enregistre les informations de partition dans le fichier
<filename>fdisk.hda</filename> à la racine du disque ZIP. C'est une bonne idée
d'imprimer ce fichier ainsi que votre <filename>/etc/fstab</filename> pour
avoir une copie durable au cas où vous devriez restaurer manuellement les
données de la partition. Vous pouvez enregistrer une arborescence en alternant
l'utilisation de deux consoles virtuelles, par le lancement de
<command>fdisk</command> dans l'une et en affichant par la commande
cat <filename>/etc/fstab</filename> ou <filename>/fdisk.hda</filename>
au besoin. Cependant, pratiquer ainsi peut mener à l'erreur.</para>

<para>
Vous voudrez aussi conserver les fichiers se rapportant à votre méthode de
restauration. Par exemple, si vous utilisez nfs pour sauvegarder vos données,
vous devrez conserver hosts.allow, hosts.deny, exports, etc. De même, si vous
utilisez un processus de restauration adossé au réseau comme Amanda ou Quick
Restore, il vous faudra conserver les fichiers de configuration réseau tels que
HOSTNAME, hosts, etc., ainsi que l'arborescence logicielle qui s'y
rapporte.</para>

<para>
La façon la plus simple de régler ces questions ainsi que d'autres similaires
est de conserver l'intégralité du répertoire etc.</para>

<para>
Il est impossible à un lecteur ZIP de 100&nbsp;Mo de contenir à lui tout seul
l'installation d'une distribution moderne d'un serveur Linux. Nous ne pouvons
pas conserver l'ensemble du zinzin. Il nous faut être bien plus sélectifs. De
quels fichiers avons-nous besoin&nbsp;?</para>

<itemizedlist>
 <listitem>
	<para>
Le répertoire /boot.</para>
 </listitem>
 <listitem>
	<para>
Le répertoire /etc et ses sous-répertoires.</para>
 </listitem>
 <listitem>
	<para>
Les répertoires nécessaires au moment du démarrage.</para>
 </listitem>
 <listitem>
	<para>
Les fichiers de périphériques dans /dev.</para>
 </listitem>
 </itemizedlist>

<para>
Pour déterminer les répertoires nécessaires au démarrage, il nous faut 
regarder dans le fichier d'initialisation du démarrage 
<filename>/etc/rc.sysinit</filename>. Il détermine son propre chemin 
ainsi&nbsp;:</para>

<programlisting>
PATH=/bin:/sbin:/usr/bin:/usr/sbin
export PATH
</programlisting>

<para>
Les essais et les erreurs ont indiqué que nous avons besoin d'autres
répertoires, tels que <filename>/dev</filename>. Sous Linux, vous ne pouvez pas
faire grand-chose sans les fichiers de périphériques.</para>

<para>
Lorsque vous lirez le script <link
linkend="save.metadata"><filename>save.metadata</filename></link>, vous remarquerez
que nous ne sauvegardons pas nécessairement les fichiers qui sont appelés par
leur chemin absolu.</para>

<para>
Il nous faudra peut-être procéder à plusieurs itérations de sauvegarde, tester
la restauration intégrale du système, réinstaller d'un CDROM et essayer encore,
avant d'obtenir un script de sauvegarde fonctionnel. Pour la préparation de ce
guide pratique, j'ai fait cinq itérations avant de réussir une restauration.
C'est la raison pour laquelle il est nécessaire d'utiliser des scripts dès que
possible. Testez soigneusement&nbsp;!</para>

<para>
L'une des choses à faire avec un système basé sur RPM est d'utiliser le
programme <command>rpm</command> pour déterminer l'emplacement des fichiers. Par
exemple, pour obtenir la liste complète des fichiers utilisés par le paquet openssh,
saisissez&nbsp;:</para>

<programlisting>
bash# <command>rpm -ql openssh</command>
</programlisting>

<para>
Certains éléments ne sont pas nécessaires, comme les pages man. Vous pouvez les
inspecter un par un et décider de les sauvegarder ou non.</para>
 
<note>
<title>AVERTISSEMENT</title>
 <para>
La seconde étape de la restauration est menée sans que les fichiers précédemment
restaurés soient écrasés. Cela signifie que les fichiers restaurés durant la
première étape sont ceux qui seront utilisés après la fin de la restauration.
Donc, mettez à jour vos sauvegardes intégrales de système à chaque fois que vous
mettez à jour des fichiers de ces répertoires.</para>
 </note>

<note>
<title>AVERTISSEMENT</title>
 <para>
La version de <command>tar</command> fournie avec <ulink
url="http://www.toms.net/rb">tomsrtbt</ulink> ne préserve pas le propriétaire lors de
la restauration. Ceci peut poser problème à des applications comme <link
linkend="amanda">Amanda</link>. Amanda, outil de sauvegarde et de restauration,
a plusieurs répertoires dont le propriétaire est son utilisateur éponyme. La
solution est&nbsp;:</para>
 <itemizedlist>
	<listitem>
	 <para>
Notez quels sont les répertoires et les fichiers dont root n'est pas
propriétaire.</para>
	</listitem>
	<listitem>
	 <para>
Notez l'identifiant de leurs propriétaires.</para>
	</listitem>
	<listitem>
	 <para>
Faites en sorte que le processus de restauration comprenne le rétablissement du
propriétaire. Par exemple&nbsp;:</para>
 <programlisting>
bash# <command>chown -R amanda:disk /var/lib/amanda</command>
</programlisting>
 <para>
vous pouvez aussi ajouter cette ligne à vos scripts de la deuxième étape de
restauration, comme dans
<link linkend="restore.tester"><filename>restore.tester</filename></link>.</para>
	</listitem>
 </itemizedlist>
 </note>

<sect2 id="ThemeAndVariations">
<title>Variations sur le thème</title>

<sect3>
<title>Pas de lecteur ZIP</title>

<para>
Ce processus de sauvegarde vous oblige à disposer du lecteur de disque ZIP à
chaque sauvegarde. Vous pouvez créer le contenu du disque ZIP dans un
répertoire, puis le sauvegarder via le réseau. Ensuite, il vous faudra
simplement construire un disque ZIP sur le serveur de sauvegarde (avec la
commande <command>cp -rp</command>) lorsque vous aurez besoin de restaurer.</para>

<para>
Le processus de sauvegarde sera plus rapide, mais vérifiez tout de même que le
répertoire créé tiendra sur votre disque ZIP (avec la commande
<command>du -hs $cible.zip</command>)&nbsp;! Vous devrez éditer la définition
de la variable <varname>zip</varname> dans le fichier <link
linkend="save.metadata"><filename>save.metadata</filename></link>.</para>

<para>
Mon portable ne supportant pas la présence simultanée d'une carte réseau et d'un
lecteur ZIP, c'est le processus que j'utilise pour le sauvegarder. Je conserve
une image de sauvegarde en même temps que la courante, ce qui fait que je
dispose d'un système de secours au cas où l'ordinateur planterait pendant une
sauvegarde.</para>

<para>
Vous pouvez aussi sauvegarder sur plusieurs disques ZIP des données qui en
valent la peine, et les transférer sur le système pendant la restauration.</para>

</sect3>

<sect3>
<title>Cédérom</title>

<para>
Ceci est similaire à l'option <quote>pas de lecteur ZIP</quote> 
ci-dessus. Enregistrez vos sauvegardes dans un répertoire de votre 
disque dur, comme mentionné. Puis, utilisez la commande 
<command>mkisofs</command> pour créer une image ISO 9660 de ce 
répertoire et gravez-la.

</para>

<para>

De nos jours, beaucoup d'ordinateurs sont livrés avec un lecteur de 
CDROM mais pas de disquette. De plus, les lecteurs de disquette 
tombent en panne. C'est pourquoi, graver votre CDROM avec une image qui permette
d'amorcer le système est une bonne idée. La mauvaise 
nouvelle, c'est que le format <quote>El Torito</quote> supporte les 
disquettes de 1,2&nbsp;Mo, 1,44&nbsp;Mo et 2,88&nbsp;Mo, et que <ulink 
url="http://www.toms.net/rb">tomsrtbt</ulink> utilise une disquette de 
1,7&nbsp;Mo. La bonne nouvelle, c'est que vous pouvez obtenir une 
version en 2,88&nbsp;Mo, 
<filename>tomsrtbt-2.0.103.ElTorito.288.img</filename> , des mêmes 
miroirs que là où vous vous procurez l'image pour disquette. Placez une 
<emphasis>copie</emphasis>

<footnote><para>

Je fais ressortir copie parce que <command>mkisofs</command> détruira le 
fichier dans le répertoire où il fabrique l'image ISO.

</para></footnote>

dans le répertoire racine des fichiers de sauvegarde. Puis, utilisez 
l'option -b de la commande <command>mkisofs</command> pour spécifier que 
<filename>tomsrtbt-2.0.103.ElTorito.288.img</filename> est le fichier de 
l'image d'amorçage.</para>

<para>

Le seul point noir de ce processus est que beaucoup de vieux BIOS ne 
supportent pas les images de disquette de 2,88&nbsp;Mo sur CDROM. 
Beaucoup de ceux-ci s'amorceront avec une disquette <ulink 
url="http://www.toms.net/rb">tomsrtbt</ulink>.

</para>

<para>
On peut aussi utiliser <ulink url="http://syslinux.zytor.com/">Syslinux</ulink>.
Il n'est pas dépendant de l'image d'une disquette et vous pouvez construire
votre propre CD avec un certain nombre d'outils tels que <ulink
url="http://www.toms.net/rb">tomsrtbt</ulink>.</para>

<para>
Il vous faudra peut-être ajuster les options du BIOS pour pouvoir amorcer sur le
lecteur de CDROM.</para>

<para><emphasis>Testez</emphasis> vos CDROM sur le lecteur que vous utiliserez
pour la restauration. S'il se trouve que vous devez modifier les scripts, vous
pouvez les copier dans <filename>/tmp</filename>, un disque en mémoire vive sous
<ulink url="http://www.toms.net/rb">tomsrtbt</ulink>, et les y éditer. Les
scripts s'exécuteront à cet emplacement. Un disque en MEV étant volatil par
nature, enregistrez vos changements avant de réamorcer&nbsp;!</para>

</sect3>

<sect3>
<title>Disques ZIP multiples</title>

<para>
En séparant les deux premiers scripts de la première étape, <link
linkend="restore.metadata"><filename>restore.metadata</filename></link>
et <link linkend="save.metadata"><filename>save.metadata</filename></link>, vous
pouvez répartir les méta données de la première étape sur plusieurs disques
ZIP.</para>

<!-- &ZIP; -->
</sect3>
 
<sect3>
<title>Exclusions de l'enregistrement de la première étape</title>

<para>
Lors de la première étape, il est parfois nécessaire de compresser quelques
méga-octets de données, particulièrement lorsque vous atteignez les limites de
votre disque ZIP. La fonction <command>crunch</command> du script <link
linkend="save.metadata"><filename>save.metadata</filename></link>
accepte de nombreux paramètres pour alimenter la commande
<command>tar</command>. Elle accepte aussi le paramètre
<command>--exclude</command>. Ainsi, par exemple, vous pouvez exclure les
répertoires <filename>samba</filename> et <filename>X11</filename> situés dans
<filename>/etc</filename> de cette façon&nbsp;:</para>

<programlisting>
crunch etc etc --exclude etc/samba --exclude etc/X11
</programlisting>

<para>

Pourquoi ces deux-là&nbsp;? Parce qu'ils consomment beaucoup d'espace disque 
et que nous n'en avons pas besoin pour l'amorçage.

</para>

<para>
Si vous possédez un nombre important de noyaux, vous pouvez éliminer les
modules de tous les noyaux sur lesquels vous n'amorcerez pas. vérifiez votre
<filename>lilo.conf</filename> ou <filename>grub.conf</filename>
pour connaître le noyau que vous utiliserez, puis vérifiez
<filename>/lib/modules</filename> pour connaître les répertoires des modules que
vous pouvez exclure.</para>

<para>
Où trouver d'autres bons candidats à l'exclusion&nbsp;? Listez les répertoires
cible avec la commande <command>ls -alSr</command> pour les fichiers
individuels, et avec la commande <command>du | sort -n</command>
pour les répertoires.</para>

<para>
Une autre façon (probablement plus nette), d'exclure les répertoires est
d'écrire la liste complète des répertoires dans un fichier puis d'y faire
référence via l'option tar <filename>--exclude-from=FILENAME</filename>.</para>

</sect3>

<sect3 id="initrd">
<title>Initrd</title>

<para>
Si votre système utilise un disque MEV pour initialiser, ou initrd pour amorcer,
assurez-vous que <link
linkend="restore.metadata"><filename>restore.metadata</filename></link> crée le
répertoire <filename>/initrd</filename>. La façon la plus simple de le faire
est de s'assurer qu'ils figurent dans la liste des répertoires utilisés dans la
boucle de création des répertoires (vers la fin).</para>

<para>
Votre système utilise probablement initrd s'il démarre sur un disque SCSI ou si
sa racine est sur une partition ext3fs. Vérifiez dans
<filename>/etc/lilo.conf</filename> s'il appelle un tel script.</para>

</sect3>

</sect2>

</sect1>

<sect1 id="firststagerestore">

<title>Première étape de restauration</title>

<sect2 id="Bootingtomsrtbt">

<title>Démarrer tomsrtbt</title>

<para>

La première chose à faire avant de démarrer le processus de restauration 
est de vérifier que l'heure du système est correctement réglée. Pour ce 
faire, configurez le BIOS. La précision du réglage de l'heure dépendra 
de vos applications. Pour une restauration, une précision de quelques 
minutes devrait être suffisante. Cela devrait permettre aux événements 
dépendant de l'heure de redémarrer à leur point d'arrêt lorsque vous 
lancerez finalement la restauration du système.

</para>

<para>

Avant de démarrer <ulink url="http://www.toms.net/rb">tomsrtbt</ulink>, 
vérifiez que votre lecteur ZIP est installé sur un port parallèle, soit 
<filename>/dev/lp0</filename> soit <filename>/dev/lp1</filename>. Le 
logiciel d'initialisation chargera pour vous le pilote du lecteur zip 
sur le port parallèle.

</para>

<!-- 

<para>

Sur ma machine de test, j'ai un clone de carte Ethernet ne2000. Ceci 
évidemment, appelle le pilote 3c59x dans les correspondances du noyau de 
<ulink url="http://www.toms.net/rb">tomsrtbt</ulink>. On peut contourner 
le problème en disant au noyau d'ignorer cette plage d'adresses. À 
l'invite de lilo, je saisirai&nbsp;:

</para>

<programlisting>
<![ CDATA [lilo: zImage reserve=0x300,32]]>
</programlisting>

-->

<para>

L'étape suivante est la configuration du mode vidéo. D'habitude, j'aime 
afficher à l'écran tout ce qui est possible. À l'apparition de la 
sélection du mode vidéo, je sélectionne le mode 6, 80 colonnes par 60 
lignes. Il se peut que votre matériel ne soit pas capable de supporter 
de si hautes résolutions, aussi effectuez des tests.

</para>

</sect2>

<sect2 id="restoration">

<title>Restauration</title>

<para>

Une fois <ulink url="http://www.toms.net/rb">tomsrtbt</ulink> démarré et 
que vous voyez une console, montez le lecteur ZIP. C'est probablement 
une bonne idée de le monter en lecture seule&nbsp;:

</para>

<programlisting>
# mount /dev/sda1 /mnt -o ro
</programlisting>

<para>

Vérifiez sa présence&nbsp;:

</para>

<programlisting>
# ls -l /mnt
</programlisting>

<para>

À ce stade, vous pouvez lancer la restauration automatiquement ou 
manuellement. Utilisez la restauration automatique si vous n'avez pas 
besoin d'effectuer des changements pendant celle-ci.

</para>

<para>

Une remarque cependant si vous avez plusieurs disques durs. Si votre 
installation de Linux monte des partitions à partir de plusieurs disques 
durs, vous devez monter la partition racine en premier. Ceci pour être 
certain que les répertoires des points de montage sont créés sur la 
partition à laquelle ils appartiennent. Le script <filename> 
first.stage</filename> lancera les scripts de montage des lecteurs dans 
leur ordre de création. Si vous les avez créés (dans le script 
<filename>save.metadata</filename>) dans un ordre découlant de l'arbre 
racine, le processus de montage devrait se dérouler correctement.

</para>

<para>

Si vous avez plusieurs disques durs, et qu'ils se montent de façon 
croisée, faites-le à votre main. Vous pouvez combiner et éditer 
les scripts pour les monter dans le bon ordre, où les monter 
manuellement.

</para>

<sect3>
<title>Automatisée</title>
	
<para>
	
Le processus automatique lance tous les scripts manuels dans le bon 
ordre. Il ne permet pas les interventions manuelles, telles que la 
création de systèmes de fichiers que ce guide pratique ne prend pas en 
charge. Pour lancer la première étape de restauration automatiquement, 
saisissez&nbsp;:

</para>

<programlisting>
# /mnt/root.bin/first.stage
</programlisting>

<para>

Si vous désirez rechercher les blocs endommagés, ajoutez l'option 
<quote><option>-c</option></quote>.

</para>

</sect3>
<sect3>

<title>Manuelle</title>

<para>

Pour lancer le processus manuel, positionnez-vous dans le répertoire où 
se trouvent les scripts, dans le lecteur ZIP.

</para>

<programlisting>
# cd /mnt/root.bin
</programlisting>

<para>

Lancez maintenant le(s) script(s) qui restaurer(a/ont) les informations 
de partition et créer(a/ont) les systèmes de fichiers. Vous pouvez les 
lancer dans n'importe quel ordre, par exemple&nbsp;:

</para>

<programlisting>
# ./make.dev.hda
</programlisting>

<para>

Si vous désirez qu'une recherche de blocs endommagés s'effectue, ajoutez 
l'option <quote><option>-c</option></quote>.

</para>

<para>

Ce script va&nbsp;:

</para>

<itemizedlist>
<listitem><para>
 
Nettoyer les 1024 premiers octets du disque dur, détruire toutes les 
tables des partitions existantes ainsi que le bloc de démarrage (MBR).

</para></listitem>

<listitem><para>

Recréer les partitions des informations collectées quand vous avez lancé 
<link linkend="make.fdisk"> <filename>make.fdisk</filename></link>.

</para></listitem>

<listitem><para>

Créer correctement des partitions ext2 et ext3 ainsi que des partitions 
swap. Si vous ajoutez l'option <quote><option>-c</option></quote> au 
script, il vérifiera aussi les blocs défectueux.

</para></listitem>

<listitem><para>

Créer différents types de partitions FAT.

</para></listitem>

</itemizedlist>

<note><title>N.B.</title>

<para>

Si vous devez restaurer d'autres systèmes d'exploitation, c'est le 
moment de le faire. Lorsque c'est terminé, redémarrez avec <ulink 
url="http://www.toms.net/rb"> tomsrtbt</ulink> et continuez la 
restauration de Linux.

</para></note>

<para>

À présent, lancez le(s) script(s) qui crée(nt) des points de montage et 
montez les partitions.

</para>

<programlisting>
# ./mount.dev.hda
</programlisting>

<para>

Une fois que vous avez créé tous vos répertoires et que vous y avez 
monté les partitions, vous pouvez lancer le script <link 
linkend="restore.metadata"> <filename>restore.metadata</filename> 
</link>. Il restaurera le contenu du lecteur zip sur le disque dur.

</para>

<para>
	
Vous devriez voir un répertoire du répertoire racine du lecteur zip, 
puis une liste des fichiers d'archives tels qu'ils sont restaurés. 
L'exécution de la commande tar sous <ulink 
url="http://www.toms.net/rb">tomsrtbt</ulink> vous dira que la taille 
d'un bloc de tar est de 20, et c'est très bien ainsi. Vous pouvez 
l'ignorer. Assurez-vous que lilo affiche ses résultats&nbsp;:

</para>

<screen>
Added linux *
</screen>

<para>

Un affichage suivra, correspondant à la commande 
<quote><command>df&nbsp;-m</command></quote>.

</para>

 </sect3>

<sect3>
 
<title>Touche finale</title>

<para>

Si d'habitude vous démarrez directement sous X, vous aurez peut-être 
quelques problèmes. Pour les éviter, changez temporairement votre niveau 
de démarrage. Dans le fichier <filename> /target/etc/inittab</filename>, 
trouvez la ligne qui ressemble à&nbsp;:

</para>

<programlisting>
id:5:initdefault:
</programlisting>

<para>
et transformez-la en&nbsp;:
</para>

<programlisting>
id:3:initdefault:
</programlisting>

<para>

Vous pouvez maintenant démarrer en douceur. Retirez la disquette <ulink 
url="http://www.toms.net/rb">tomsrtbt</ulink> de votre lecteur si vous 
ne l'avez pas encore fait, et faites le salut à trois doigts à votre 
ordinateur (N.D.T.&nbsp;: CTRL+MAJ+SUP), ou son équivalent&nbsp;:

</para>

<programlisting>
# <command>reboot</command>
</programlisting>

<para>

L'ordinateur va s'arrêter et redémarrer.

</para>
 </sect3>
 </sect2>
 </sect1>
 
 <sect1 id="SecondStageRestoration">
 <title>Seconde étape de la restauration</title>

 <para>
 
Au redémarrage de l'ordinateur, vérifiez dans le BIOS que l'heure est à 
peu près correcte.</para>
 
 <para>

Une fois la vérification terminée, sortez du BIOS et redémarrez sur le 
disque dur. Laissez simplement la séquence de démarrage normal de 
l'ordinateur se dérouler. Vous verrez un nombre important de messages 
d'erreurs, essentiellement de type <quote> Impossible de trouver 
bla-bla&nbsp;! Ouahhh&nbsp;!</quote> Si vous avez bien travaillé jusqu'à 
maintenant, ces messages d'erreurs seront sans importance. Vous n'avez 
pas besoin de linuxconf ou d'apache pour cette opération.

  </para>

 <note><title>N.B.</title>
 <para>
 
Vous pouvez aussi démarrer en mode utilisateur unique (single 
user)&nbsp;: à l'invite de lilo, saisissez&nbsp;: <userinput>linux 
single</userinput>, mais il vous faudra configurer manuellement votre 
réseau et lancer sshd ou tous les démons nécessaires au redémarrage de 
votre système. Chaque système a sa méthode spécifique.</para>

 </note>
 
 <para>

Vous devriez vous identifier sur une console en tant que super 
utilisateur (root) (désolé, pas de session X, pas d'utilisateurs). À 
présent, vous devriez pouvoir utiliser le réseau, par exemple pour 
monter la sauvegarde de votre système via nfs.
 
 </para>

 <para>

Si vous avez effectué la sauvegarde en deux étapes que j'ai suggérées 
pour Arkeia, vous pouvez maintenant restaurer les exécutables et la base 
de données d'Arkeia. Vous devriez pouvoir lancer

</para>

<programlisting>
/etc/rc.d/init.d/arkeia start
</programlisting>

 <para>

et démarrer le serveur. Si vous avez une interface graphique installée 
sur un autre ordinateur, vous devriez pouvoir vous connecter à Arkeia 
sur votre serveur de bandes et préparer la restauration.
 
 </para>

 <note>
 <title>N.B.</title>
 <para>
 
Pendant la restauration, lisez attentivement la documentation de 
restauration de vos programmes. Par exemple, d'habitude, tar ne restaure 
pas certaines caractéristiques de fichiers, telles que le bit suid. Les 
droits sur les fichiers sont fixées par l'utilisateur avec la 
commande umask. Pour restaurer vos fichiers exactement comme vous les 
avez sauvegardés, utilisez l'option tar avec l'option p. De la même 
manière, vérifiez que votre logiciel de restauration restaure les 
données de façon identique à la sauvegarde.</para>
 
 </note>

<para>

Pour restaurer l'ordinateur de test, saisissez&nbsp;:

</para>

<programlisting>
bash# restore.all
</programlisting>

<para>

Si vous avez sauvegardé et restauré avec tar, et avez utilisé l'option 
-k (conserver les anciens fichiers, ne pas écraser), vous constaterez un 
nombre important de&nbsp;:

</para>

<screen>
tar: usr/sbin/rpcinfo: Could not create file: File exists
tar: usr/sbin/zdump: Could not create file: File exists
tar: usr/sbin/zic: Could not create file: File exists
tar: usr/sbin/ab: Could not create file: File exists
</screen>

<para>

Ceci est normal, tar refusant d'écraser les fichiers que vous avez 
restaurés pendant la première étape.

</para>

<para>

Puis redémarrez. À la fermeture, vous verrez un nombre important de messages
d'erreurs, tels que <quote>no such pid</quote>.
Ils font partie du processus. Le programme de fermeture utilise les fichiers pid
des démons qui tournaient au moment de la sauvegarde pour fermer les démons qui
n'avaient pas été lancés au dernier démarrage. Et évidemment, il n'ont pas de
PID.</para>
 
<para>
Votre système devrait s'initialiser normalement avec beaucoup moins d'erreurs
que précédemment et idéalement sans erreurs. Le test décisif du bon
fonctionnement de votre restauration sur un système basé sur des RPM est de
vérifier tous les paquets&nbsp;:</para>
 
<programlisting>
bash# <command>rpm -Va</command>
</programlisting>
 
<para>
Si vous constatez des messages d'erreurs de dépendances, vous pouvez lancer la
commande <command>/etc/cron.daily/prelink</command> pour les enlever.</para>

<para>
Certains fichiers, tels que les fichiers de configuration et les journaux,
auront naturellement changé&nbsp;; vous devriez pouvoir mentalement les exclure
du rapport. Vous pouvez rediriger la sortie dans un fichier, et le comparer
grâce à diff avec celui effectué lors de la sauvegarde (/etc/rpmVa.txt), ce qui
accélérera considérablement cette étape. Les utilisateurs d'Emacs devraient se
renseigner sur ses aptitudes à comparer des fichiers.</para>

<para>
À présent, votre système devrait être lancé et fonctionner. C'est le moment de
tester vos applications, particulièrement celles lancées en tant que démons.
Plus les applications seront sophistiquées, plus il vous faudra effectuer des
tests. S'il y a des utilisateurs distants, interdisez leur l'accès du système,
ou passez le en <quote>lecture seule</quote> le temps des tests. Ceci vaut
particulièrement pour les bases de données, afin empêcher une corruption ou une
perte de données pire que ce qu'il pourrait déjà y avoir.</para>

<para>
Si d'habitude vous redémarrez directement sous X et que vous l'avez désactivé
plus haut, testez X avant de le réactiver. Réactivez-le en rétablissant cette
unique ligne dans le fichier /etc/inittab&nbsp;:</para>

<programlisting>
id:5:initdefault:
</programlisting>

<para>

Vous pourrez alors aller faire la fête, prendre un peu d'aspirine et 
aller au dodo.

</para>

</sect1>

<sect1 id="DistributionSpecificNotes">
<title>Notes spécifiques aux distributions</title>

<para>
Vous trouverez ci-dessous des remarques nées de l'expérience, distribution par
distribution. Si vous avez des remarques concernant d'autres distributions,
envoyez-les-moi.</para>

<sect2 id="fedora">
<title>Fedora</title>

<para>
<ulink url="http://fedora.redhat.com/">Fedora</ulink>
est issue de Red Hat 9. Effectuez les modifications suivantes&nbsp;:</para>
 <itemizedlist>
	<listitem>
	 <para>
Fedora utilise <link linkend="grub">
grub</link>, et non lilo. Effectuez les modifications suivantes.</para>
	</listitem>
	<listitem>
	 <para>
Il n'est plus nécessaire de sauvegarder les bibliothèques kerberos 
séparément, comme dans la <link linkend="redhat80">Red Hat 8.0</link>. 
Enlevez ou mettez en commentaire cette ligne du fichier <link 
linkend="save.metadata"> <filename>save.metadata</filename> 
</link>&nbsp;:

</para>

<programlisting>
# RH8. Fedora 1 puts them in /lib # crunch kerberos usr/kerberos/lib/
</programlisting>

	</listitem>
	<listitem>
<para>
	 
Les noms des bibliothèques nécessaires à la sauvegarde de SSH ont 
changé. Aussi, dans le fichier <link linkend="save.metadata"> 
<filename>save.metadata</filename></link>&nbsp;:</para>

<programlisting>
# save these so we can use ssh for restore. *crack* for RH 7.0 login
# authentication.
# RH 8.0
# crunch usr.lib usr/lib/*crack* usr/lib/libz* usr/lib/libssl*
usr/lib/libcrypto*
# Fedora 1
crunch usr.lib usr/lib/*crack* usr/lib/libz* usr/lib/libwrap* usr/lib/libk*
usr/lib/libgss*
</programlisting>

	</listitem>
	<listitem>
<para>
 
Dans le fichier <link linkend="restore.metadata"> 
<filename>restore.metadata</filename></link>, il y a un plus grand 
nombre de répertoires à sauvegarder.

</para>

<programlisting>
# If you boot via an initrd, make sure you build a directory here so
# the kernel can mount the initrd at boot. tmp/.font-unix is for the
# xfs font server.
for dir in mnt/save mnt/zip mnt/cdrom mnt/floppy mnt/imports mnt/dosc mnt/nfs\
proc initrd tmp/.font-unix var/empty/sshd var/lock/subsys var/log; do
</programlisting>

<para>
Certains modes sont à configurer&nbsp;:</para>

<programlisting>
chmod a-w $target/proc		# Restore /proc's read-only permissions
# Set modes
chmod 0111 $target/var/empty/sshd
chmod 0775 $target/var/lock
# For Fedora. First two for xfs.
chroot $target
chown xfs:xfs /tmp/.font-unix
chmod 1777 $target/tmp/.font-unix
# set the sticky bit.
chmod 1777 $target/tmp
</programlisting>
	</listitem>
 </itemizedlist>
 </sect2>
 <sect2 id="redhat9">
 <title>Red Hat 9</title>
 <para>
Je n'ai jamais travaillé sous Red Hat 9. Les commentaires concernant <link
linkend="fedora">
Fedora</link>
devraient s'appliquer également à la Red Hat 9.</para>
 </sect2>
 <sect2 id="redhat80">
 <title>Red Hat 8.0</title>
 <para>
Il est nécessaire de modifier Red Hat 8.0 uniquement si vous vous connectez
après la première étape de restauration via ssh. Si vous effectuez la
deuxième étape de restauration avec ssh, effectuez les
modifications suivantes&nbsp;:</para>
 <itemizedlist>
	<listitem>
	 <para>
Dans le fichier <filename>
save.metadata</filename>, ajoutez les bibliothèques kerberos à la première étape
de sauvegarde&nbsp;:</para>
	 <programlisting>
crunch kerberos usr/kerberos/lib/</programlisting>
	</listitem>
	<listitem>
	 <para>
Dans le fichier <filename>
restore.metadata</filename>, il y a une boucle qui crée plusieurs répertoires.
Tout d'abord, ajoutez le nom de ces deux répertoires à la liste&nbsp;:
<filename>
/var/empty/sshd</filename>
et <filename>
/var/lock/subsys</filename>
. Red Hat 8.0 utilisant par défaut ext3fs, a besoin d'un disque en MEV au
démarrage. Aussi assurez-vous que <filename>
initrd</filename>
est dans la liste. Puis, s'il n'y est pas encore, ajoutez l'argument <command>
-p</command>
à la commande mkdir.</para>
	 <para>
Le groupe propriétaire du répertoire  <filename>
/var/lock/subsys</filename>
est le groupe lock, aussi changez son propriétaire.</para>
	 <programlisting>
chroot $target /bin/chown root:lock /var/lock</programlisting>
	 <para>
Pour finir, <filename>
usr/lib/libcrypto*</filename>
a disparu, aussi vous pouvez le retirer de la ligne qui traite <filename>
usr/lib</filename>
.</para>
	</listitem>
 </itemizedlist>
 </sect2>
 <sect2 id="RedHat71">
 <title>Red Hat 7.1</title>
 <para>
À l'origine, j'ai utilisé cette distribution sur mon ordinateur de test. Je n'ai
eu aucun problème avec.</para>
 </sect2>
 <sect2 id="RedHat70">
 <title>Red Hat 7.0</title>
 <para>
Il semble que cette version ait besoin de libcrack (dans /usr/lib) et de ses
fichiers pour authentifier les utilisateurs. Aussi, dans le fichier <link
linkend="save.metadata"><filename>save.metadata</filename></link>, ajoutez ce
qui suit à la ligne qui sauvegarde /usr/lib&nbsp;: /usr/lib/*crack* et activez
cette ligne.</para>
 </sect2>
 <sect2 id="knoppix">
 <title>Knoppix</title>
 <para>
Je n'ai pas utilisé <ulink url="http://www.knoppix.org/">Knoppix</ulink>, mais
d'autres que moi l'ont fait. <ulink url="mailto:pon at iki dot fi">
Pasi Oja-Nisula</ulink> nous en parle&nbsp;:</para>
 <blockquote>
	<para>
Pour moi, le grand avantage de knoppix est que je n'ai pas besoin d'un médium de
démarrage propre à chaque machine mais que je peux utiliser les mêmes outils
tout le temps. Et le support matériel de Knoppix est vraiment excellent. Je n'ai
pas tant d'expérience que ça avec les différentes plates-formes mais toutes les
machines que j'ai essayé ont bien fonctionné, les pilotes scsi ont été trouvés,
etc...</para>
	<para>
J'effectue le travail de restauration en copiant les sauvegardes sur une autre
machine du réseau. Restaurer implique de démarrer à partir du CDROM de
Knoppix, d'aller chercher le fichier metadata.tar.gz sur l'autre machine du
réseau. Puis de d'appeler make.dev, mount.dev, d'aller chercher les autres
fichiers tar.gz, grub et de redémarrer. Il y a bien quelques saisies mais, grâce
à vos scripts, c'est très simple. À moins que vous ne passiez de ide à scsi ou
quelque chose de ce genre, mais même ainsi, ce n'est pas si difficile dans la
mesure où Linux peut facilement être restauré sur différents matériels.</para>
 </blockquote>
 <para>
Jetez aussi un coup d'&oelig;il à <ulink
url="http://www-106.ibm.com/developerworks/linux/library/l-knopx.html?ca=dgr-
lnxw04Knoppix">
<quote>
Récupération de système avec Knoppix (System recovery with
Knoppix, N.D.T.&nbsp;: pas de version française)</quote>
</ulink>
.</para>
 </sect2>
 </sect1>
 <sect1 id="ApplicationSpecificNotes">
 <title>
Notes concernant certaines application</title>
 <para>
Vous trouverez ci-dessous quelques remarques sur la sauvegarde de certaines
applications.</para>
 <sect2 id="grub">
 <title>
GRUB</title>
 <para>
Le chargeur d'amorçage par défaut de <link linkend="fedora">
Fedora</link>
est le <ulink url="http://www.gnu.org/software/grub/">
Grand Chargeur D'amorçage Unifié (Grand Unified Bootloader (GRUB))</ulink>
. Il doit être lancé à la fin de la première étape, sans quoi vous ne pourrez
pas démarrer ensuite. Pour l'inclure dans la première étape de restauration,
effectuez les modifications suivantes&nbsp;:</para>
 <itemizedlist>
	<listitem>
	 <para>
Éditez la pénultième stance de <link linkend="restore.metadata">
<filename>
restore.metadata</filename></link>&nbsp;:</para>
	 <programlisting>
# Now install the boot sector.
# chroot $target /sbin/lilo -C /etc/lilo.conf
chroot $target /sbin/grub-install /dev/hda
</programlisting>

	</listitem>
	<listitem>
	 <para>
Ajoutez la stance suivante à <link linkend="save.metadata">
<filename>
save.metadata</filename></link>&nbsp;:</para>

<programlisting>
# Grub requires these at installation time.
crunch usr.share.grub usr/share/grub
</programlisting>

	</listitem>
 </itemizedlist>
 </sect2>
 <sect2 id="tripwire">
 <title>
Tripwire</title>
 <para>
Si vous utilisez Tripwire ou une autre application qui utilise une base de
données de métadonnées en fichiers, reconstruisez cette base de données
immédiatement après la restauration.</para>
 </sect2>
 <sect2 id="Squid">
 <title>
Squid</title>
 <para>
Squid est un serveur HTTP de cache et de proximité. Il stocke donc une grande
quantité de données temporaires sur le disque dur. Il n'y a aucune raison de les
sauvegarder. Insérez <quote>
--exclude /var/spool/squid</quote>
dans la commande tar appropriée du script de sauvegarde de la deuxième étape.
Puis, laissez squid reconstruire sa structure de répertoires lui-même. Ajoutez
une commande pour que squid s'initialise tout seul à la fin du script de
restauration de la deuxième étape. Voilà comment j'ai fait avec ssh dans le
fichier <link linkend="restore.tester">
<filename>
restore.tester</filename></link>&nbsp;:</para>
 <programlisting>
ssh $target "mkdir /var/spool/squid ; chown squid:squid /var/spool/squid;\
 /usr/sbin/squid -z; touch /var/spool/squid/.OPB_NOBACKUP"
</programlisting>
 <para>
La dernière commande crée un fichier de longueur 0 appelé .OPB_NOBACKUP. Il est
à destination d' <link linkend="arkeia">
Arkeia</link>, et lui dit de ne rien sauvegarder en dessous de ce
répertoire.</para>
 </sect2>
 <sect2 id="arkeia">
 <title>
Arkeia</title>
 <para>
Ces notes sont basées sur des tests effectués avec Arkeia 4.2.</para>
 <para>
<ulink url="http://www.arkeia.com/">
Arkeia</ulink>
est un programme de sauvegarde et de restauration qui tourne sur une grande
variété de plate-formes. Vous pouvez utiliser Arkeia dans votre programme de
restauration intégrale de système, mais je ferais deux observations.</para>
 <para>
La première est probablement celle qui pose le plus de problèmes, dans la mesure
où il n'y a pas de solution plus élégante que de sélectionner à la main et dans
le navigateur les répertoires à restaurer. Ceci est dû au fait qu'apparemment,
Arkeia ne dispose pas de mécanisme pour ne pas restaurer des fichiers déjà
présents sur le disque, rien qui soit analogue à  <command>
tar</command>
et à son option -p. Si vous paramétrez simplement une restauration complète, la
restauration plantera car Arkeia écrasera une bibliothèque utilisée au moment de
la restauration, à savoir <filename>
lib/libc-2.1.1.so</filename>
. Une sélection à la main des répertoires à restaurer est moins risquée, aussi
je la recommande.</para>
 <para>
La seconde observation est qu'il vous faudra sauvegarder le dictionnaire des
données et/ou les programmes d'Arkeia. Pour le faire, modifiez le script
<filename>
save.metadata</filename>
en ajoutant Arkeia à la liste des répertoires à sauvegarder&nbsp;:</para>

<programlisting>
# arkeia specific: tar cf - usr/knox | gzip -c > $zip/arkeia.tar.gz
</programlisting>

 <para>
C'est ainsi que vous <emphasis>
devez</emphasis>
sauvegarder le dictionnaire des données car Arkeia ne le fait pas. C'est un des
reproches que je fais à Arkeia, mais je le résous sur mon propre PC en
sauvegardant le dictionnaire des données sur bande avec <ulink
url="http://www.estinc.com/">
The TOLIS Group's BRU</ulink>
.</para>
<!-- bad host name: 2003 07 25 -->
 <para>
Le script <filename>
restore.metadata</filename>
restaurera le dictionnaire des données automatiquement.</para>

</sect2>

<sect2 id="amanda">
<title>Amanda</title>

<para>
<ulink url="http://www.amanda.org/">Amanda</ulink>, archiveur automatique
avancé sur disque en réseau du Maryland (The Advanced Maryland Automatic Network
Disk Archiver), marche plutôt bien avec cet ensemble de scripts. Utilisez le
processus normal de sauvegarde d'Amanda et créez votre première étape comme
d'habitude. Amanda stocke les données sur bande au format tar ou cpio, donc vous
pouvez restaurer des fichiers individuels jusqu'à des images complètes de
sauvegarde. Ce qu'il y a de bien dans une restauration d'image complète est que
vous pouvez utiliser les variantes de ce guide pratique pour restaurer à partir
de l'image ou à partir de la bande directement. J'ai pu réparer ma machine de
tests avec les instructions de W. Curtis Preston <ulink
url="http://www.oreilly.com/catalog/unixbr/"><citetitle pubwork="book">et de son
Unix Backup &amp; Recovery</citetitle></ulink>. Pour plus d'informations,
consultez le lien <link linkend="resources">Ressources</link>. Le chapitre du
livre qui concerne Amanda est <ulink
url="http://www.backupcentral.com/amanda.html">en ligne</ulink>.</para>

<para>
J'ai effectué deux changements au script <link linkend="restore.tester">
<filename>restore.tester</filename></link>. Premièrement, je l'ai modifié pour
qu'il accepte un nom de fichier comme argument. Puis, comme la commande d'Amanda
<command>amrestore</command> décompresse les données pendant qu'il les restaure,
je l'ai réécrit pour qu'il envoie, via la commande cat, le fichier dans le canal
(pipe) plutôt que de le décompresser.</para>

<para>
La ligne en question ressemble à&nbsp;:</para>

<programlisting>
cat $fichier | ssh $cible "umask 000 ; cd / ; tar -xpkf - " </programlisting>

<para>
où <command>$fichier</command> est l'argument du script, l'image récupérée de la
bande par la commande <command>amrestore</command>.</para>

<para>
Comme les arguments de la ligne de commande de <command>tar</command>
interdisent l'écrasement de fichiers, restaurez les images dans l'ordre
<emphasis>inverse</emphasis> de leur ordre de création. Restaurez les plus
récents en premier.</para>

<para>
Avec Amanda, il n'est pas nécessaire de déterminer manuellement les
propriétaires si vous sauvegardez le répertoire des données d'Amanda avec le
fichier <link linkend="save.metadata"><filename>save.metadata</filename></link>.
Ce devrait être une instruction du type&nbsp;:</para>

<programlisting>
bash# <command>chown -R amanda:disk /var/lib/amanda</command>
</programlisting>

<para>
Vous pouvez aussi ajouter cette ligne à vos scripts de la deuxième étape de
restauration, comme dans <link
linkend="restore.tester"><filename>restore.tester</filename></link>.</para>

</sect2>

</sect1>

<sect1 id="SomeAdviceforDisasterRecovery">
<title>Quelques conseils pour une récupération après un désastre</title>

<para>
Vous devriez placer les disques zip de chaque ordinateur et les sorties papier
que vous avez effectuées dans un endroit sur de votre boutique. Vous devriez
conserver des copies de ces sauvegardes dans un site de stockage extérieur.
L'intérêt principal d'un site de stockage extérieur est de rendre possible une
récupération après un désastre&nbsp;; restaurer chaque hôte sur un matériel de
remplacement fait d'ailleurs partie d'une récupération après un désastre.</para>

<para>
Vous devriez conserver plusieurs disquettes de <ulink
url="http://www.toms.net/rb">tomsrtbt</ulink> ainsi que si possible plusieurs
disques zip à l'extérieur. De plus, installez des copies de la distribution de
<ulink url="http://www.toms.net/rb">tomsrtbt</ulink> sur plusieurs de vos
ordinateurs, de façon à ce qu'ils puissent se restaurer mutuellement.</para>

<para>
Vous devriez probablement conserver des copies de ce guide pratique, agrémentées
d'annotations spécifiques à votre site, avec vos sauvegardes et sur votre site
extérieur de conservation des sauvegardes.</para>

</sect1>

<sect1 id="WhatNow">
<title>Et maintenant&nbsp;?</title>

<para>
Ce guide pratique est le résultat d'expérimentations sur un seul ordinateur.
Vous y trouverez sans aucun doute des répertoires ou des fichiers nécessaires à
la première étape de votre sauvegarde. Je n'ai pas essayé de sauvegarder ni de
restaurer X à la première étape, pas plus que je ne me suis occupé d'autres
processeurs qu'Intel.</para>

<para>
J'apprécierais que vous me fassiez des retours sur vos tests et les
améliorations que vous avez apportées à ces scripts pour vos ordinateurs.
J'encourage aussi les éditeurs de logiciels de sauvegarde à rédiger une
documentation permettant d'effectuer une sauvegarde minimum de leurs produits.
J'aimerais que grâce à ces efforts la communauté Linux dorme un tout petit peu
mieux chaque nuit.</para>

<sect2 id="todo">
<title>Liste de travail</title>

<para>
Les volontaires sont bienvenus. Avant de commencer un thème, consultez-moi pour
savoir si quelqu'un d'autre y travaille déjà.</para>
 <itemizedlist>
	<listitem>
	 <para>
Un éditeur de partitions pour ajuster les limites des partitions dans le fichier
<filename>dev.hdx</filename>. Cela permettra aux utilisateurs d'ajuster les
partitions sur un disque dur différent, ou sur le même, mais avec une géométrie
différente, ou encore d'ajuster la taille des partitions sur le même disque dur.
Une interface graphique serait certainement une bonne chose. D'un autre côté, le
programme de la FSF  <ulink
url="http://www.gnu.org/software/parted"><filename>parted</filename></ulink>
semble pouvoir répondre partiellement au besoin. Il redimensionne les partitions
existantes, mais avec certaines restrictions.</para>
	</listitem>
	<listitem>
	 <para>
<link linkend="make.fdisk"><filename>make.fdisk</filename></link>
est le seul actuellement à reconnaître certaines partitions FAT, pas toutes.
Ajouter du code à <link
linkend="make.fdisk"><filename>make.fdisk</filename></link>
pour qu'il reconnaisse les autres et écrire les instructions appropriées pour
qu'il les reconstruise dans les fichiers en sortie.</para>
	</listitem>
	<listitem>
	 <para>
Pour les partitions FAT12 et FAT16, nous ne formatons pas, n'écrivons pas de
zéro dans la partition de telle sorte que MS-DOS 6.x les reconnaisse
correctement. Reportez-vous aux notes sur <command>fdisk</command> pour une
explication du problème.</para>
	</listitem>
	<listitem>
	 <para>
Faire un script pour mettre les systèmes de fichiers ext2/3 sur disque
ZIP.</para>
	</listitem>
	<listitem>
	 <para>
Traduire ce guide dans d'autres langues.</para>
	</listitem>
	<listitem>
	 <para>
Déterminer dans quelle mesure loadlin ou des programmes de ce type affectent le
processus.</para>
	</listitem>
	<listitem>
	 <para>
J'ai mentionné le gestionnaire de paquets de (Red Hat Red Hat Package
Manager&nbsp;: rpm) de temps en temps. Quelles sont les commandes deb
équivalentes&nbsp;?</para>
	</listitem>
 </itemizedlist>

</sect2>

</sect1>

<sect1 id="TheScripts">
<title>Les scripts</title>

<para>
Reportez-vous aux notes situées au début de chaque script pour voir le résumé de
ce qu'il fait.</para>
 
<sect2 id="FirstStage">
<title>Première étape</title>

<sect3 id="make.fdisk">
<title><filename>make.fdisk</filename></title>

<para>

    Ce script, lancé pendant la sauvegarde, crée des scripts semblables 
    à <link 
    linkend="make.dev.hda"><filename>make.dev.hda</filename></link> et 
    <link 
    linkend="mount.dev.hda"><filename>mount.dev.x</filename></link>, 
    plus bas, pour que vous les lanciez à la restauration. Il produit 
    aussi des fichiers de données semblables à <link 
    linkend="dev.hda"><filename>dev.hda</filename></link>, plus bas. Le 
    nom du script et du fichier de données qui est produit dépend du 
    périphérique donné en paramètre à ce script. Ce script, lancé à la 
    restauration, crée les partitions sur le disque dur. 
    <filename>make.fdisk</filename> est appelé par <link 
    linkend="save.metadata"><filename>save.metadata</filename></link>, 
    plus bas.
    
</para>
<!-- #include program listings to make updates easier. C^2 -->
<programlisting>
&make.fdisk;
</programlisting>

</sect3>

<sect3 id="make.dev.hda">

<title><filename>make.dev.hda</filename></title>

<para>
	
    Ce script est un exemple de la production de <link 
    linkend="make.fdisk"><filename>make.fdisk</filename></link>, plus 
    haut. Il fait appel à des fichiers de données comme <link 
    linkend="dev.hda"><filename>dev.hda</filename></link>, plus bas. Il 
    crée des partitions et des systèmes de fichiers sur certains d'entre 
    elles. C'est le premier script lancé à la restauration.

</para>

<para>

    Si vous êtes suffisamment courageux pour éditer <link 
    linkend="dev.hda"><filename>dev.hda</filename></link> (voir plus 
    haut), pour, disons, ajouter une nouvelle partition, il se peut que 
    vous deviez éditer ce script.</para>

<para>

Si vous voulez que make.dev.hda vérifie les secteurs défectueux quand il
installe un système de fichiers sur les partitions, saisissez en ligne de
commande l'option &quot;-c&quot;.</para>

<programlisting>
&make.dev.hda;
</programlisting>

</sect3>
<sect3 id="mount.dev.hda">

<title><filename>mount.dev.hda</filename></title>

<para>

Ce script est un exemple de la production de <link 
linkend="make.fdisk"><filename>make.fdisk</filename></link>, plus haut. 
Il crée des points de montage et monte les partitions, préparant le 
système de fichiers cible à la restauration des fichiers. C'est le 
second script lancé à la restauration.

</para>

<para>

Si vous êtes suffisamment courageux pour éditer <link 
linkend="dev.hda"><filename>dev.hda</filename></link> (voir plus haut), 
pour, disons, ajouter une nouvelle partition, il se peut que vous deviez 
éditer ce script.

</para>
<programlisting>
&mount.dev.hda;
</programlisting>

</sect3>

<sect3 id="dev.hda">
<title><filename>dev.hda</filename></title>

<para>

    Ce fichier de données est utilisé au moment de la restauration. Il 
    est utilisé par <command>fdisk</command> et est alimenté par <link 
    linkend="make.dev.hda"><filename>make.dev.hda</filename></link>. Il 
    est produit pendant la sauvegarde par <link 
    linkend="make.fdisk"><filename>make.fdisk</filename></link>. Ceux 
    qui connaissent bien <command>fdisk</command> reconnaîtront que 
    chaque ligne est une commande ou une valeur de 
    <command>fdisk</command>, tel qu'un numéro de cylindre. Donc, il est 
    possible de changer les tailles des partitions et d'ajouter de 
    nouvelles partitions en éditant ce fichier. C'est pourquoi la 
    pénultième commande est <command>v</command>, qui vérifiera la table 
    des partitions avant qu'elle soit écrite.

</para>

<programlisting>
&dev.hda;
</programlisting>

</sect3>
<sect3 id="save.metadata">

<title><filename>save.metadata</filename></title>

<para>

C'est le premier script lancé dans le processus de sauvegarde. Il 
appelle <link 
linkend="make.fdisk"><filename>make.fdisk</filename></link>, plus haut. 
Si vous devez sauvegarder un disque dur SCSI ou plusieurs disques durs, 
faites de sorte que l'appel à <link 
linkend="make.fdisk"><filename>make.fdisk</filename></link> soit 
effectué de façon correcte.

</para>

<programlisting>
&save.metadata;
</programlisting>

</sect3>

<sect3 id="restore.metadata">

<title><filename>restore.metadata</filename></title>

<para>

Ce script restaure les métadonnées du disque ZIP à la première étape de 
la restauration.

</para>

<programlisting>
&restore.metadata;
</programlisting>

</sect3>

 <sect3 id="first.stage">

<title><filename>first.stage</filename></title>

<para>

Ce script effectue complètement la première étape de la restauration 
sans intervention humaine.

</para>

<para>

Si vous désirez vérifier les secteurs défectueux pendant la création des 
systèmes de fichiers des partitions, utilisez l'option de ligne de 
commande <quote>-c</quote>.

</para>

<programlisting>
&first.stage;
</programlisting>

</sect3>

</sect2>

<sect2 id="SecondStage">

<title>Deuxième étape</title>

<para>

Ces scripts sont lancés sur l'ordinateur à sauvegarder ou restaurer.

</para>

<sect3 id="back.up.all">

<title><filename>back.up.all</filename></title>

<para>

    Ce script effectue une sauvegarde vers un autre ordinateur via un 
    montage NFS. Vous pouvez l'adapter pour effectuer vos sauvegardes 
    vers une bande ou d'autres supports.

</para>
    
    
<programlisting>
&back.up.all;
</programlisting>

</sect3>

<sect3 id="back.up.all.ssh">

<title><filename>back.up.all.ssh</filename></title>

<para>

    Ce script fait exactement la même chose que <link 
    linkend="back.up.all"><filename>back.up.all</filename></link> mais 
    il utilise ssh à la place de nfs.
    
</para>

<programlisting>
&back.up.all.ssh;
</programlisting>

</sect3>

<sect3 id="restore.all">

<title><filename>restore.all</filename></title>

<para>

Vous utiliserez ce script de restauration si votre sauvegarde a été 
effectuée avec <link
linkend="back.up.all"><filename>back.up.all</filename></link>.</para>

<programlisting>
&restore.all;
</programlisting>

</sect3>

<sect3 id="restore.all.ssh">

<title><filename>restore.all.ssh</filename></title>

<para>

Vous utiliserez ce script de restauration si votre sauvegarde a été 
effectuée avec <link 
linkend="back.up.all.ssh"><filename>back.up.all.ssh</filename></link>.

</para>

<programlisting>
&restore.all.ssh;
</programlisting>

</sect3>
</sect2>

<sect2 id="BackupServerScripts">

<title>Scripts de sauvegarde du serveur</title>

<para>

Les scripts ssh décrits ci-dessus sont susceptibles de poser un problème 
de sécurité. Si vous les lancez derrière un pare-feu, le pare-feu doit 
permettre à ssh d'accéder au serveur de sauvegarde. Dans ce cas, il se 
peut qu'un pirate intelligent soit aussi capable de pirater le serveur 
de sauvegarde. Il serait plus sûr d'exécuter les scripts de sauvegarde 
et de restauration sur le serveur de sauvegarde, et de laisser le 
serveur de sauvegarde accéder au pare-feu. Ces scripts sont conçus pour 
fonctionner ainsi. Renommez-les en <filename>get.x</filename> et en 
<filename>restore.x</filename> où <filename>x</filename> est le nom de 
l'ordinateur cible. Éditez-les (la variable &dollar;target 
d'initialisation définissant la cible) pour qu'ils utilisent le nom 
d'hôte de l'ordinateur cible, ou réécrivez-les pour qu'ils utilisent un 
argument de ligne de commande.

</para>

<para>

    Ces scripts effectuent complètement la sauvegarde et la restauration 
    de la cible, et pas uniquement la première étape de la sauvegarde et 
    de la restauration. Remarquez aussi que 
    <filename>get.tester</filename> sauvegarde aussi le disque ZIP, au 
    cas où vous auriez besoin de remplacer un disque ZIP défectueux.

</para>

<para>

    J'utilise couramment ces scripts.

</para>

<sect3 id="get.tester">

<title><filename>get.tester</filename></title>

<programlisting>
&get.tester;
</programlisting>

</sect3>
<sect3 id="restore.tester">

<title><filename>restore.tester</filename></title>

<programlisting>
&restore.tester;
</programlisting>

</sect3>
</sect2>
</sect1>

<sect1 id="resources">

<title>Ressources</title>

<para>

    Dans le désordre. Il y a des points que vous avez peut-être envie 
    d'approfondir. Une présence dans cette liste ne doit pas être 
    comprise comme une approbation. En fait, bien souvent, je n'ai pas 
    utilisé le produit et ne peux pas le commenter.
    
</para>

<itemizedlist>

<listitem><para>

<ulink url="http://www.oreilly.com/catalog/unixbr/author.html">W. Curtis 
Preston</ulink> et son excellent <ulink 
url="http://www.oreilly.com/catalog/unixbr/"><citetitle 
pubwork="book">Unix Backup &amp; Recovery</citetitle></ulink>. Voici le 
livre qui m'a fait démarrer ce travail de restauration intégrale de 
systèmes. Je le recommande chaleureusement ; <ulink 
url="http://www2.linuxjournal.com/lj-issues/issue78/3839.html">lire mon 
bilan</ulink>.

</para></listitem>

<listitem><para>


Une vieille (datant de 2000) liste de <ulink 
url="http://www.fokus.gmd.de/linux/linux-distrib-small.html">petites 
distributions Linux.</ulink>

</para></listitem>

<listitem><para>

<ulink url="http://www.toms.net/rb"> tomsrtbt</ulink>, 
<quote>l'essentiel de Linux sur une disquette.</quote> Tom est aussi lié 
à d'autres petites distributions.

</para></listitem>

<listitem><para>

    Le <ulink url="http://www.tldp.org/">projet de documentation 
    Linux</ulink>. En particulier, jetez un coup d'&oelig;il à 
    <citetitle pubwork="article">LILO, Linux Crash Rescue 
    HOW-TO</citetitle>.

</para></listitem>

<listitem><para>

Le programme de la Free Software Foundation <ulink 
url="http://www.gnu.org/software/parted"><filename>parted</filename></ulink> 
pour éditer (agrandir, diminuer, déplacer) les partitions.

</para></listitem>

<listitem><para>

<ulink url="http://qtparted.sourceforge.net/">QtParted</ulink> semble 
faire la même chose mais avec une interface graphique.

</para></listitem>

<listitem><para>

<ulink url="http://www.partimage.org/">Partition Image</ulink> pour les 
sauvegardes des partitions.

</para>

<para>

De sa page eb&nbsp;: <quote>Partition Image est un utilitaire 
Linux/UNIX qui sauvegarde des partitions d'un grand nombre de formats 
(voir plus bas) dans un fichier image. Le fichier image peut être 
comprimé au format GZIP/BZIP2 pour économiser de l'espace, et être 
découpé en plusieurs fichiers destinés à être copiés sur des supports 
amovibles (des disques ZIP par exemple) La partition peut être 
sauvegardée sur le réseau depuis la version 0.6.0.</quote>

</para></listitem>

<listitem><para>

<ulink url="http://sourceforge.net/projects/bacula"> Bacula</ulink> est 
un produit de sauvegarde sous licence GPL comprenant du code pour 
effectuer une restauration intégrale de système, qui a été inspiré en 
partie par ce guide pratique.

</para></listitem>

<listitem><para>

<quote><ulink url="http://www.feyrer.de/g4u/">g4u ghost pour unix 
(&apos;ghost for unix&apos;)</ulink> est une disquette/CDROM de 
démarrage basée sur NetBSD qui permet de cloner facilement des disques 
durs de PC devant être déployés via FTP avec une configuration commune 
sur un certain nombre de PC. La disquette (ou le CDROM) a deux 
fonctions. La première est de transférer l'image comprimée d'un disque 
dur local vers un serveur FTP. L'autre est de restaurer cette image par 
FTP, la décompresser et la restaurer sur un disque; la configuration 
réseau est obtenu par DHCP. Le disque dur étant traité comme une image, 
n'importe quel système d'exploitation ou de fichiers peut être déployé à 
l'aide de g4u.</quote>

</para>
</listitem>

<listitem><para>

<quote>Nous présentons <ulink
url="http://www.cs.utah.edu/flux/papers/frisbee-usenix03-base.html">Frisbee</ulink>,
qui est un système destiné à sauvegarder, transférer et installer les
images de disques entiers, avec comme objectifs d'être rapide et
extensible dans un environnement de réseau local. Techniquement, Frisbee
utilise une méthode particulière de compression qui tient compte des
systèmes de fichiers, un protocole maison de diffusion sélective de
niveau application et un découpage de trames flexible de niveau
application. De cette conception, il en résulte un système capable de
distribuer rapidement et de façon fiable l'image d'un disque à de
nombreux clients simultanés. Par exemple, Frisbee est capable d'écrire
un total de 50 giga-octets de données sur 80 disques en 34 secondes,
ceci sur des PC standards. Nous décrivons la conception et la mise en
&oelig;uvre de Frisbee, examinons les décisions importantes de
conception et évaluons ses performances.</quote>

</para></listitem>

<listitem><para>

Il y a un certain nombre de distributions disponibles sous forme de clés 
USB. Rendez-vous sur le site de <ulink 
url="http://www.distrowatch.com/">DistroWatch</ulink> pour plus de 
détails.

</para></listitem>

<listitem><para>

Kits de secours basées sur CDROM. Ceci n'est pas une liste 
exhaustive. Si vous en connaissez une (ou du moins qui prétend en être 
une), <ulink url="&myemail;">faites-le moi savoir.</ulink> Vous 
trouverez des informations plus récentes sur <ulink 
url="http://www.distrowatch.com/">DistroWatch</ulink>.

</para><itemizedlist>

<listitem><para>

Le <ulink url="http://www.microwerks.net/~hugo/">Mondo</ulink> de Hugo 
Rabson <quote>... crée un ou plusieurs CDROM (ou disquettes + bandes) 
amorçables de secours contenant tout ou partie de votre système 
de fichiers. En cas de perte catastrophique de données, vous pourrez 
restaurer intégralement.</quote>

</para></listitem>

<listitem><para>

Le <ulink url="http://crashrecovery.org/">kit de récupération après une 
panne irrécupérable (Crash Recovery Kit for Linux)</ulink>

</para></listitem>

<listitem> <para>

<ulink 
url="http://www-106.ibm.com/developerworks/linux/library/l-knopx.html?ca=dgr-
lnxw04Knoppix"><quote>Récupération 
de système avec Knoppix (System recovery with Knoppix)</quote></ulink> 
est une bonne introduction à la récupération de système en général et 
dispose de liens <ulink 
url="http://www.knoppix.org/">Knoppix</ulink>utiles.

</para></listitem>

<listitem><para>

<quote><ulink url="http://emergencycd2.sourceforge.net/">Cool Linux 
CD</ulink> est une version de Linux sur CDROM. Il est basé sur le 
noyau 2.4 et on y trouve des logiciels libres et de 
démonstration.</quote>

</para></listitem>

<listitem><para>

<ulink 
url="http://www.sysresccd.org/index.en.php">SystemRescueCd</ulink> <quote> 
est un système linux monté sur un CDROM amorçable, destiné à réparer 
votre système et vos données après une panne irrécupérable. Il a aussi 
pour but de faciliter les tâches d'administration de votre ordinateur, 
telles que créer et éditer les partitions du disque dur. Il contient un 
bon nombre d'utilitaires système (parted, partimage, fstools, ...) et 
basiques (éditeurs, midnight commander, outils réseau). Il a pour 
objectif d'être facile à utiliser&nbsp;: démarrez simplement avec le 
CDROM et vous pourrez tout faire. Son noyau supporte les principaux 
systèmes de fichiers (ext2/ext3, reiserfs, xfs, jfs, vfat, ntfs, 
iso9660) et réseaux (samba et nfs).</quote>

</para></listitem>

<listitem><para>

<ulink url="http://syslinux.zytor.com/">Syslinux</ulink> crée le code de 
démarrage pour des images de disquettes, de CDROM et de PXE 
(Environnement de pré-exécution) Intel. Il ne dépend pas d'une image de 
disquette. Vous pourrez créer vos propres CDROM à l'aide de certains 
outils, tels que <ulink url="http://www.toms.net/rb">tomsrtbt</ulink>.

</para></listitem>

<listitem><para>

Au cas où voudriez vous débrouiller tout seul&nbsp;: <quote><ulink 
url="http://www.linux-live.org/">Linux Live</ulink> est un ensemble de 
scripts bash qui vous permet de créer votre propre LiveCD à partir de 
n'importe quelle distribution Linux. Installez simplement votre 
distribution favorite, enlevez tous les fichiers superflus (les pages de 
manuel, par exemple, et tous les autres fichiers que vous n'estimez pas 
importants).</quote>

</para></listitem>

<listitem><para>

<quote>Le <ulink url="http://www.linbox.com/en/ppart.html">CDROM 
PPART</ulink> vous permet de générer un CD amorçable de récupération de 
système à partir de disques durs précédemment sauvegardés.</quote>

</para></listitem>

<listitem><para>

<ulink url="http://rescuecd.sourceforge.net/">Timo's Rescue CD Set (Le 
CD de secours de Timo)</ulink>&nbsp;: <quote>Cette boîte à outils 
constitue mon approche pour générer facilement un CD amorçable de 
sauvegarde de système, qui peut aisément être adapté à vos besoins. Le 
projet est en train de se transformer en une distribution "debian sur 
CDROM", ce qui fait qu'il n'est pas seulement utilisable comme CD de 
secours mais que l'on peut aussi installer une debian complète sur le 
CD.</quote>

</para></listitem>

<listitem><para>

La <ulink url="http://www.frozentech.com/content/livecd.php">liste des 
distributions basées sur CDROM</ulink> comprend plus de distributions 
basées sur CDROM.

</para></listitem>

</itemizedlist>

</listitem>

</itemizedlist>

</sect1>

<appendix id="appendix1gfdl">

<title>License GNU Free Documentation</title>
 <para>
Version 1.1, March 2000</para>
 <blockquote>
 <para>
Copyright (C) 2000 Free Software Foundation, Inc. 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.</para>
 </blockquote>
 <sect1 label="0" id="gfdl02">
 <title>
PREAMBULE</title>
 <para>
The purpose of this License is to make a manual, textbook, or other written document "free" in the sense of freedom: to assure everyone the effective freedom to copy and redistribute it, with or without modifying it, either commercially or noncommercially. Secondarily, this License preserves for the author and publisher a way to get credit for their work, while not being considered responsible for modifications made by others.</para>
 <para>
This License is a kind of "copyleft", which means that derivative works of the document must themselves be free in the same sense. It complements the GNU General Public License, which is a copyleft license designed for free software.</para>
 <para>
We have designed this License in order to use it for manuals for free software, because free software needs free documentation: a free program should come with manuals providing the same freedoms that the software does. But this License is not limited to software manuals; it can be used for any textual work, regardless of subject matter or whether it is published as a printed book. We recommend this License principally for works whose purpose is instruction or reference.</para>
 </sect1>
 <sect1 label="1" id="gfdl03">
 <title>
APPLICABILITY AND DEFINITIONS</title>
 <para>
This License applies to any manual or other work that contains a notice placed by the copyright holder saying it can be distributed under the terms of this License. The "Document", below, refers to any such manual or work. Any member of the public is a licensee, and is addressed as "you".</para>
 <para>
A "Modified Version" of the Document means any work containing the Document or a portion of it, either copied verbatim, or with modifications and/or translated into another language.</para>
 <para>
A "Secondary Section" is a named appendix or a front-matter section of the Document that deals exclusively with the relationship of the publishers or authors of the Document to the Document's overall subject (or to related matters) and contains nothing that could fall directly within that overall subject. (For example, if the Document is in part a textbook of mathematics, a Secondary Section may not explain any mathematics.) The relationship could be a matter of historical connection with the subject or with related matters, or of legal, commercial, philosophical, ethical or political position regarding them.</para>
 <para>
The "Invariant Sections" are certain Secondary Sections whose titles are designated, as being those of Invariant Sections, in the notice that says that the Document is released under this License.</para>
 <para>
The "Cover Texts" are certain short passages of text that are listed, as Front-Cover Texts or Back-Cover Texts, in the notice that says that the Document is released under this License.</para>
 <para>
A "Transparent" copy of the Document means a machine-readable copy, represented in a format whose specification is available to the general public, whose contents can be viewed and edited directly and straightforwardly with generic text editors or (for images composed of pixels) generic paint programs or (for drawings) some widely available drawing editor, and that is suitable for input to text formatters or for automatic translation to a variety of formats suitable for input to text formatters. A copy made in an otherwise Transparent file format whose markup has been designed to thwart or discourage subsequent modification by readers is not Transparent. A copy that is not "Transparent" is called "Opaque".</para>
 <para>
Examples of suitable formats for Transparent copies include plain ASCII without markup, Texinfo input format, LaTeX input format, SGML or XML using a publicly available DTD, and standard-conforming simple HTML designed for human modification. Opaque formats include PostScript, PDF, proprietary formats that can be read and edited only by proprietary word processors, SGML or XML for which the DTD and/or processing tools are not generally available, and the machine-generated HTML produced by some word processors for output purposes only.</para>
 <para>
The "Title Page" means, for a printed book, the title page itself, plus such following pages as are needed to hold, legibly, the material this License requires to appear in the title page. For works in formats which do not have any title page as such, "Title Page" means the text near the most prominent appearance of the work's title, preceding the beginning of the body of the text.</para>
 </sect1>
 <sect1 label="2" id="gfdl04">
 <title>
VERBATIM COPYING</title>
 <para>
You may copy and distribute the Document in any medium, either commercially or noncommercially, provided that this License, the copyright notices, and the license notice saying this License applies to the Document are reproduced in all copies, and that you add no other conditions whatsoever to those of this License. You may not use technical measures to obstruct or control the reading or further copying of the copies you make or distribute. However, you may accept compensation in exchange for copies. If you distribute a large enough number of copies you must also follow the conditions in section 3.</para>
 <para>
You may also lend copies, under the same conditions stated above, and you may publicly display copies.</para>
 </sect1>
 <sect1 label="3" id="gfdl05">
 <title>
COPYING IN QUANTITY</title>
 <para>
If you publish printed copies of the Document numbering more than 100, and the Document's license notice requires Cover Texts, you must enclose the copies in covers that carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on the back cover. Both covers must also clearly and legibly identify you as the publisher of these copies. The front cover must present the full title with all words of the title equally prominent and visible. You may add other material on the covers in addition. Copying with changes limited to the covers, as long as they preserve the title of the Document and satisfy these conditions, can be treated as verbatim copying in other respects.</para>
 <para>
If the required texts for either cover are too voluminous to fit legibly, you should put the first ones listed (as many as fit reasonably) on the actual cover, and continue the rest onto adjacent pages.</para>
 <para>
If you publish or distribute Opaque copies of the Document numbering more than 100, you must either include a machine-readable Transparent copy along with each Opaque copy, or state in or with each Opaque copy a publicly-accessible computer-network location containing a complete Transparent copy of the Document, free of added material, which the general network-using public has access to download anonymously at no charge using public-standard network protocols. If you use the latter option, you must take reasonably prudent steps, when you begin distribution of Opaque copies in quantity, to ensure that this Transparent copy will remain thus accessible at the stated location until at least one year after the last time you distribute an Opaque copy (directly or through your agents or retailers) of that edition to the public.</para>
 <para>
It is requested, but not required, that you contact the authors of the Document well before redistributing any large number of copies, to give them a chance to provide you with an updated version of the Document.</para>
 </sect1>
 <sect1 label="4" id="gfdl06">
 <title>
MODIFICATIONS</title>
 <para>
You may copy and distribute a Modified Version of the Document under the conditions of sections 2 and 3 above, provided that you release the Modified Version under precisely this License, with the Modified Version filling the role of the Document, thus licensing distribution and modification of the Modified Version to whoever possesses a copy of it. In addition, you must do these things in the Modified Version:</para>
 <orderedlist numeration="upperalpha">
 <listitem>
<para>
Use in the Title Page (and on the covers, if any) a title distinct from that of the Document, and from those of previous versions (which should, if there were any, be listed in the History section of the Document). You may use the same title as a previous version if the original publisher of that version gives permission.</para>
 </listitem>
 <listitem>
<para>
List on the Title Page, as authors, one or more persons or entities responsible for authorship of the modifications in the Modified Version, together with at least five of the principal authors of the Document (all of its principal authors, if it has less than five).</para>
 </listitem>
 <listitem>
<para>
State on the Title page the name of the publisher of the Modified Version, as the publisher.</para>
 </listitem>
 <listitem>
<para>
Preserve all the copyright notices of the Document.</para>
 </listitem>
 <listitem>
<para>
Add an appropriate copyright notice for your modifications adjacent to the other copyright notices.</para>
 </listitem>
 <listitem>
<para>
Include, immediately after the copyright notices, a license notice giving the public permission to use the Modified Version under the terms of this License, in the form shown in the Addendum below.</para>
 </listitem>
 <listitem>
<para>
Preserve in that license notice the full lists of Invariant Sections and required Cover Texts given in the Document's license notice.</para>
 </listitem>
 <listitem>
<para>
Include an unaltered copy of this License.</para>
 </listitem>
 <listitem>
<para>
Preserve the section entitled "History", and its title, and add to it an item stating at least the title, year, new authors, and publisher of the Modified Version as given on the Title Page. If there is no section entitled "History" in the Document, create one stating the title, year, authors, and publisher of the Document as given on its Title Page, then add an item describing the Modified Version as stated in the previous sentence.</para>
 </listitem>
 <listitem>
<para>
Preserve the network location, if any, given in the Document for public access to a Transparent copy of the Document, and likewise the network locations given in the Document for previous versions it was based on. These may be placed in the "History" section. You may omit a network location for a work that was published at least four years before the Document itself, or if the original publisher of the version it refers to gives permission.</para>
 </listitem>
 <listitem>
<para>
In any section entitled "Acknowledgements" or "Dedications", preserve the section's title, and preserve in the section all the substance and tone of each of the contributor acknowledgements and/or dedications given therein.</para>
 </listitem>
 <listitem>
<para>
Preserve all the Invariant Sections of the Document, unaltered in their text and in their titles. Section numbers or the equivalent are not considered part of the section titles.</para>
 </listitem>
 <listitem>
<para>
Delete any section entitled "Endorsements". Such a section may not be included in the Modified Version.</para>
 </listitem>
 <listitem>
<para>
Do not retitle any existing section as "Endorsements" or to conflict in title with any Invariant Section.</para>
 </listitem>
 </orderedlist>
 <para>
If the Modified Version includes new front-matter sections or appendices that qualify as Secondary Sections and contain no material copied from the Document, you may at your option designate some or all of these sections as invariant. To do this, add their titles to the list of Invariant Sections in the Modified Version's license notice. These titles must be distinct from any other section titles.</para>
 <para>
You may add a section entitled "Endorsements", provided it contains nothing but endorsements of your Modified Version by various parties--for example, statements of peer review or that the text has been approved by an organization as the authoritative definition of a standard.</para>
 <para>
You may add a passage of up to five words as a Front-Cover Text, and a passage of up to 25 words as a Back-Cover Text, to the end of the list of Cover Texts in the Modified Version. Only one passage of Front-Cover Text and one of Back-Cover Text may be added by (or through arrangements made by) any one entity. If the Document already includes a cover text for the same cover, previously added by you or by arrangement made by the same entity you are acting on behalf of, you may not add another; but you may replace the old one, on explicit permission from the previous publisher that added the old one.</para>
 <para>
The author(s) and publisher(s) of the Document do not by this License give permission to use their names for publicity for or to assert or imply endorsement of any Modified Version.</para>
 </sect1>
 <sect1 label="5" id="gfdl07">
 <title>
COMBINING DOCUMENTS</title>
 <para>
You may combine the Document with other documents released under this License, under the terms defined in section 4 above for modified versions, provided that you include in the combination all of the Invariant Sections of all of the original documents, unmodified, and list them all as Invariant Sections of your combined work in its license notice.</para>
 <para>
The combined work need only contain one copy of this License, and multiple identical Invariant Sections may be replaced with a single copy. If there are multiple Invariant Sections with the same name but different contents, make the title of each such section unique by adding at the end of it, in parentheses, the name of the original author or publisher of that section if known, or else a unique number. Make the same adjustment to the section titles in the list of Invariant Sections in the license notice of the combined work.</para>
 <para>
In the combination, you must combine any sections entitled "History" in the various original documents, forming one section entitled "History"; likewise combine any sections entitled "Acknowledgements", and any sections entitled "Dedications". You must delete all sections entitled "Endorsements."</para>
 </sect1>
 <sect1 label="6" id="gfdl08">
 <title>
COLLECTIONS OF DOCUMENTS</title>
 <para>
You may make a collection consisting of the Document and other documents released under this License, and replace the individual copies of this License in the various documents with a single copy that is included in the collection, provided that you follow the rules of this License for verbatim copying of each of the documents in all other respects.</para>
 <para>
You may extract a single document from such a collection, and distribute it individually under this License, provided you insert a copy of this License into the extracted document, and follow this License in all other respects regarding verbatim copying of that document.</para>
 </sect1>
 <sect1 label="7" id="gfdl09">
 <title>
AGGREGATION WITH INDEPENDENT WORKS</title>
 <para>
A compilation of the Document or its derivatives with other separate and independent documents or works, in or on a volume of a storage or distribution medium, does not as a whole count as a Modified Version of the Document, provided no compilation copyright is claimed for the compilation. Such a compilation is called an "aggregate", and this License does not apply to the other self-contained works thus compiled with the Document, on account of their being thus compiled, if they are not themselves derivative works of the Document.</para>
 <para>
If the Cover Text requirement of section 3 is applicable to these copies of the Document, then if the Document is less than one quarter of the entire aggregate, the Document's Cover Texts may be placed on covers that surround only the Document within the aggregate. Otherwise they must appear on covers around the whole aggregate.</para>
 </sect1>
 <sect1 label="8" id="gfdl10">
 <title>
TRANSLATION</title>
 <para>
Translation is considered a kind of modification, so you may distribute translations of the Document under the terms of section 4. Replacing Invariant Sections with translations requires special permission from their copyright holders, but you may include translations of some or all Invariant Sections in addition to the original versions of these Invariant Sections. You may include a translation of this License provided that you also include the original English version of this License. In case of a disagreement between the translation and the original English version of this License, the original English version will prevail.</para>
 </sect1>
 <sect1 label="9" id="gfdl11">
 <title>
TERMINATION</title>
 <para>
You may not copy, modify, sublicense, or distribute the Document except as expressly provided for under this License. Any other attempt to copy, modify, sublicense or distribute the Document is void, and will automatically terminate your rights under this License. However, parties who have received copies, or rights, from you under this License will not have their licenses terminated so long as such parties remain in full compliance.</para>
 </sect1>
 <sect1 label="10" id="gfdl12">
 <title>
FUTURE REVISIONS OF THIS LICENSE</title>
 <para>
The Free Software Foundation may publish new, revised versions of the GNU Free Documentation License from time to time. Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns. See <ulink url="http://www.gnu.org/copyleft/">
http://www.gnu.org/copyleft/</ulink>
.</para>
 <para>
Each version of the License is given a distinguishing version number. If the Document specifies that a particular numbered version of this License "or any later version" applies to it, you have the option of following the terms and conditions either of that specified version or of any later version that has been published (not as a draft) by the Free Software Foundation. If the Document does not specify a version number of this License, you may choose any version ever published (not as a draft) by the Free Software Foundation.</para>
 </sect1>
 <sect1 label="11" id="gfdl13">
 <title>
How to use this License for your documents</title>
 <para>
To use this License in a document you have written, include a copy of the License in the document and put the following copyright and license notices just after the title page:</para>
<blockquote>
<para>
 Copyright (c) YEAR YOUR NAME. Permission is granted to copy, distribute and/or modify this document under the terms of the GNU Free Documentation License, Version 1.1 or any later version published by the Free Software Foundation; with the Invariant Sections being LIST THEIR TITLES, with the Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST. A copy of the license is included in the section entitled "GNU Free Documentation License". </para>
</blockquote>
 <para>
If you have no Invariant Sections, write "with no Invariant Sections" instead of saying which ones are invariant. If you have no Front-Cover Texts, write "no Front-Cover Texts" instead of "Front-Cover Texts being LIST"; likewise for Back-Cover Texts.</para>
 <para>
If your document contains nontrivial examples of program code, we recommend releasing these examples in parallel under your choice of free software license, such as the GNU General Public License, to permit their use in free software.</para>
 </sect1>
 </appendix>
</article>

