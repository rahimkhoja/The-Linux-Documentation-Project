<!doctype linuxdoc system>

<article>

<title>Comment activer la comptabilité des processus sous Linux
<author>Albert M. C. Tam,
<tt><htmlurl url="mailto:bertie@scn.org" name="bertie@scn.org"></tt><newline>
Adaptation française par
<htmlurl name="Miodrag Vallat" url="mailto:miodrag@ifrance.com">.
<date>8 Août 1997

<abstract>

Décrit comment activer la comptabilité des processus sur un système Linux, et
l'emploi des diverses commandes de comptabilité des processus.
</abstract>

<toc>

<sect>Introduction
<p>
Ce document décrit comment activer la comptabilité des processus sur un système
Linux, et l'emploi des diverses commandes de comptabilité des processus. Il
s'adresse aux utilisateurs des noyaux de version 1.3.73 ou ultérieure (testé
récemment avec un système RedHat 4.1 de noyau 2.0.27). Les noyaux plus anciens
que le 1.3.73 nécessitent une rustine afin de pouvoir disposer de la
comptabilité des processus.
<p>
Ce document est placé en «copyleft» par Albert M. C. Tam,
<tt><htmlurl url="mailto:bertio@scn.org" name="bertie@scn.org"></tt>.
Vous êtes autorisé à utiliser, copier et distribuer ce document à des fins non
commerciales, tant que le nom de l'auteur et ce copyright est préservé dans
chaque copie, et que le document n'est pas modifié. Ce document est distribué
car potentiellement utile, mais <bf>sans aucune garantie</bf>, ni explicite, ni
implicite.
Bien qu'un grand soin ait été apporté pour s'assurer de la justesse de ce
document, l'auteur et le traducteur ne pourront être tenus responsables de
toute erreur ou dommage causés par l'utilisation des informations contenues
dans ce document.
<p>
N'hésitez pas à envoyer vos remarques et suggestions à l'auteur,
<tt><htmlurl url="mailto:bertie@scn.org" name="bertie@scn.org"></tt>
si vous découvrez des erreurs ou s'il manque des informations. J'en serai ravi.

<sect>Qu'est-ce que la comptabilité des processus~?
<p>
La comptabilité des processus est l'opération d'enregistrement et de
récapitulation des commandes exécutées sous Linux. Les noyaux Linux récents
sont capables de maintenir des informations sur les commandes exécutées,
l'utilisateur les ayant exécutées, le temps CPU consacré, et bien plus encore.
<p>
La comptabilité des processus vous permet de conserver des informations
détaillées sur les ressources système utilisées, leur répartition entre les
utilisateurs, et de surveiller le système.

<sect>Où en est la comptabilité des processus sous Linux~?
<p>
Le support de comptabilité des processus a été intégré dans les noyaux récents
à partir de la version 1.3.73. Si vous utilisez un noyau plus ancien, il vous
faudra des rustines. Celles-ci sont disponibles en
<htmlurl url="ftp://iguana.hut.fi/pub/linux/Kernel/process_accounting">

<sect>Besoins de la comptabilité des processus sous Linux
<p>
<sect1>Noyau
<p>
Un noyau Linux de version 1.3.73 ou ultérieure~; je recommande une version 2.x.
Les sources du noyau sont disponibles en
<htmlurl url="http://metalab.unc.edu/pub/Linux/kernel/v2.0">

<sect1>Logiciels de comptabilité
<p>
Selon votre distribution Linux, les logiciels de comptabilité seront ou ne
seront pas installés sur votre système. S'ils ne le sont pas, essayez de les
télécharger en
<htmlurl url="http://metalab.unc.edu/pub/Linux/system/admin/quota-acct-modified.tgz">

<sect>Mise en place de la comptabilité des processus sous Linux
<p>
<sect1>Compiler et installer les logiciels de comptabilité
<p>
Les logiciels de comptabilité sont disponibles en
<htmlurl url="http://metalab.unc.edu/pub/Linux/system/admin/quota-acct-modified.tgz">
<sect1>Modifier les scripts d'initialisation du système pour lancer la
comptabilité des processus au démarrage
<p>
Voici un exemple~:
<tscreen><verb>
	# Activer la comptabilité des processus.
	if [ -x /sbin/accton ]
	then
        	/sbin/accton /var/log/pacct
			echo "Comptabilité des processus activée."
	fi
</verb></tscreen>

<sect1>Créer le fichier de statistiques «pacct»
<p>
Vos logiciels de comptabilité exécuteront leurs commandes sur le fichier
<file>/var/log/pacct</file> par défaut.
<p>
Pour créer le fichier de statistiques~:
<tscreen><verb>
	touch /var/log/pacct
</verb></tscreen>
<p>
Ce fichier de statistiques doit être la propriété de <tt>root</tt>, avec
permission de lecture et d'écriture pour <tt>root</tt>, et permission de
lecture pour le reste du monde~:
<tscreen><verb>
	chown root /var/log/pacct
	chmod 0644 /var/log/pacct
</verb></tscreen>

<sect1>Redémarrer
<p>
Redémarrer le système pour que les modifications prennent effet.

<sect>Commandes de comptabilité diverses

<sect1>ac
<p>
<file>ac</file> affiche des statistiques sur le temps de connexion des
utilisateurs en heures, en fonction des logins et des logout du fichier
<file>/var/log/wtmp</file>. <file>ac</file> est également capable d'afficher les
temps totaux par jour (option <tt>-d</tt>), et par utilisateur (option
<tt>-p</tt>).

<sect1>accton
<p>
<file>accton</file> est utilisé pour activer ou désactiver la comptabilité des
processus. Cette commande est généralement exécutée au démarrage ou à l'arrêt
du système via les scripts d'initialisation.

<sect1>last
<p>
<file>last</file> parcourt le fichier <file>/var/log/wtmp</file> et affiche des
informations sur le temps de connexion des utilisateurs.

<sect1>sa
<p>
<file>sa</file> résume les statistiques de comptabilité de la commande
précédente, triées par temps d'entrées/sorties, temps processeur, depuis le
fichier <file>/var/account/pacct</file>.

<sect1>lastcomm
<p>
<file>lastcomm</file> affiche la liste de toutes les commandes précédemment
exécutées, depuis le fichier <file>/var/account/pacct</file>.

</article>
