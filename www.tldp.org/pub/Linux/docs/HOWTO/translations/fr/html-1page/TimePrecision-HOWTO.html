<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
        Gestion pr&eacute;cise de l'heure et de la date
    </title><link href="style.css" rel="stylesheet" type="text/css"><meta content="DocBook XSL Stylesheets V1.69.1" name="generator"><meta name="description" content="

      Ce document pr&eacute;sente la gestion de la date et de l'heure sous 
      Linux. Il explique &eacute;galement comment r&eacute;gler la date et l'heure de 
      votre syst&egrave;me et comment synchroniser votre machine via le 
      protocole NTP.

  "></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article" lang="fr"><div class="titlepage"><div><div><h1 class="title"><a name="N10001"></a>
        Gestion pr&eacute;cise de l'heure et de la date
    </h1></div><div><h3 class="subtitle"><i>
        Version fran&ccedil;aise du <span class="foreignphrase"><em class="foreignphrase">Managing Accurate Date and 
        Time</em></span>
    </i></h3></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Avi</span> <span class="surname">Alkalay</span></h3><div class="affiliation"><span class="orgname">
            IBM &eacute;quipe Impact Linux&nbsp;: <a href="http://ibm.com/linux" target="_top">http://ibm.com/linux</a>
          <br></span><span class="orgdiv">
            Consultant Linux et normes ouvertes&nbsp;: architecte en 
            chef informatique et logiciels
          <br></span><div class="address"><p><span style="white-space: pre;">
            <code class="email">&lt;<a href="mailto:avi CHEZ unix POINT sh">avi CHEZ unix POINT sh</a>&gt;</code>
          </span></p></div></div></div><p class="othercredit"><span class="contrib">
          Suggestion d'utiliser pool.ntp.org et des serveurs publics de 
          temps NTP de strate 2
        </span>: <span class="firstname">Brad</span> <span class="surname">Knowles</span></p><p class="othercredit"><span class="contrib">Suggestion d'utiliser ntpq au lieu de ntpdc</span>: <span class="firstname">Kent</span> <span class="surname">Borg</span></p><p class="othercredit"><span class="contrib">Explication des informations donn&eacute;es par ntpq et 
        ntpdc</span>: <span class="firstname">Yura</span> <span class="surname">Moron</span></p><p class="othercredit"><span class="contrib"><a href="http://www.linux.or.jp/JF/JFdocs/TimePrecision-HOWTO/" target="_top">Adaptation japonaise</a></span>: <span class="firstname">Takeo</span> <span class="surname">Nakano</span></p><p class="othercredit"><span class="contrib"><a href="http://computerlib.narod.ru/html/linuxtime.htm" target="_top">Adaptation russe</a></span>: <span class="firstname">SHAKI</span></p><p class="othercredit"><span class="contrib"><a href="http://tldp.fsf.hu/HOWTO/TimePrecision-HOWTO-hu/index.html" target="_top">Adaptation hongroise</a>, la section chrony et la toute premi&egrave;re section</span>: <span class="firstname">Mihaly</span> <span class="surname">Gyulai</span></p><p class="othercredit"><span class="contrib"><a href="http://www.traduc.org/docs/HOWTO/lecture/TimePrecision-HOWTO.html" target="_top">Adaptation fran&ccedil;aise</a></span>: <span class="firstname">Philippe</span> <span class="surname">Wautelet</span></p><p class="othercredit"><span class="contrib">Relecture de la version fran&ccedil;aise</span>: <span class="firstname">Rapha&euml;l</span> <span class="surname">Semeteys</span></p><p class="othercredit"><span class="contrib">Pr&eacute;paration de la publication de la v.f.</span>: <span class="firstname">Jean-Philippe</span> <span class="surname">Gu&eacute;rard</span></p></div></div><div><p class="releaseinfo">Version&nbsp;: 1.0.9.fr.1.0</p></div><div><p class="copyright">Copyright &copy; 2002, 2003, 2004 Avi Alkalay</p></div><div><p class="copyright">Copyright &copy; 2004, 2005 Philippe Wautelet, Rapha&euml;l Semeteys, Jean-Philippe Gu&eacute;rard</p></div><div><p class="pubdate">2005-09-24</p></div><div><div class="revhistory"><table summary="Revision history" width="100%" border="1"><tr><th colspan="3" valign="top" align="left"><b>Historique des versions</b></th></tr><tr><td align="left">Version 1.0.9.fr.1.0</td><td align="left">2005-09-24</td><td align="left">PW, RS, JPG</td></tr><tr><td colspan="3" align="left">
        
            Adaptation fran&ccedil;aise de la version 1.0.9.
        
        </td></tr><tr><td align="left">Version 1.0.9</td><td align="left">2005-05-03</td><td align="left">Avi</td></tr><tr><td colspan="3" align="left">Inclusion d'un lien vers la traduction fran&ccedil;aise (<span class="emphasis"><em>Included link to french translation</em></span>).</td></tr><tr><td align="left">Version 1.0.8</td><td align="left">2004-10-29</td><td align="left">MG</td></tr><tr><td colspan="3" align="left">Adaptation hongroise, la section chrony et la toute premi&egrave;re section (<span class="emphasis"><em>Hungarian translation, the chrony section and the very first section</em></span>).</td></tr><tr><td align="left">Version 1.0.7.fr.1.0</td><td align="left">2005-03-22</td><td align="left">PW, RS, JPG</td></tr><tr><td colspan="3" align="left">Premi&egrave;re traduction fran&ccedil;aise.</td></tr><tr><td align="left">Version 1.0.7</td><td align="left">2004-07-09</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">
        
            Note pr&egrave;s de la licence pour signaler qu'il n'est pas
            n&eacute;cessaire de demander une autorisation pour traduire ce
            document&nbsp;; petites corrections pour plusieurs phrases
            (<span class="emphasis"><em>Disclaimer near to license, to let people know
            they can translate without asking permission; Small fixes in
            some phrases</em></span>).
            
        </td></tr><tr><td align="left">Version 1.0.6</td><td align="left">2004-02-25</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Ajout&eacute; remerciements et lien vers la traduction russe (<span class="emphasis"><em>Included credits and link to russian translation</em></span>).</td></tr><tr><td align="left">Version 1.0.5</td><td align="left">2003-07-05</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Chang&eacute; l'adresse vers les serveurs de temps publics et ajout&eacute; pool.ntp.org (<span class="emphasis"><em>Changed public time servers list URL. Added pool.ntp.org</em></span>).</td></tr><tr><td align="left">Version 1.0.4</td><td align="left">2002-12-21</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Ajout&eacute; remerciements et lien vers la traduction japonaise (<span class="emphasis"><em>Added japanese translation link and credits</em></span>).</td></tr><tr><td align="left">Version 1.0.3</td><td align="left">2002-08-24</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Corrig&eacute; les largeurs d'&eacute;crans et de listings (<span class="emphasis"><em>Fixed wrong screen and programlisting widths</em></span>).</td></tr><tr><td align="left">Version 1.0.2</td><td align="left">2002-08-04</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Lien vers une page de serveurs de temps publics (<span class="emphasis"><em>Link to public time servers page</em></span>).</td></tr><tr><td align="left">Version 1.0.1</td><td align="left">2002-05-07</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Conversion finale en XML et r&eacute;organisation des fichiers (<span class="emphasis"><em>Final XML conversion. Files reorganization</em></span>).</td></tr><tr><td align="left">Version 1.0</td><td align="left">2002-04-28</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Image termin&eacute;e (<span class="emphasis"><em>Finalized image</em></span>).</td></tr><tr><td align="left">Version 0.8</td><td align="left">2002-04-27</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Remplac&eacute; ntpdc par ntpq dans l'exemple (<span class="emphasis"><em>Switched from ntpdc example to ntpq, based on contributions</em></span>).</td></tr><tr><td align="left">Version 0.8.1</td><td align="left">2002-04-20</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Graphique am&eacute;lior&eacute; et liens vers d'autres documents (<span class="emphasis"><em>Improved graphic. Links to other doc locations</em></span>).</td></tr><tr><td align="left">Version 0.8</td><td align="left">2002-04-14</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Am&eacute;lioration de la figure NTP (<span class="emphasis"><em>Better tuning of NTP graphic</em></span>).</td></tr><tr><td align="left">Version 0.76</td><td align="left">2002-04-13</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Ajout&eacute; une figure sur l'architecture (<span class="emphasis"><em>Inclusion of architecture graphic</em></span>).</td></tr><tr><td align="left">Version 0.75</td><td align="left">2002-04-10</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Correction orthographe et utilisation DocBook XSLT 1.50 (<span class="emphasis"><em>Spell checked. Using DocBook XSLT 1.50</em></span>).</td></tr><tr><td align="left">Version 0.65</td><td align="left">2002-03-31</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Pass&eacute; au format XML 4.1.2 DocBook (<span class="emphasis"><em>Upgraded to XML 4.1.2 DocBook format</em></span>).</td></tr><tr><td align="left">Version 0.6</td><td align="left">2002-03-29</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Termin&eacute; le m&eacute;canisme des fuseaux horaires sur Linux. Cr&eacute;&eacute; l'annexe. Il ne reste plus que les dessins. (<span class="emphasis"><em>Finished timezone mechanism on Linux. Created appendix. Now only drawings are needed</em></span>).</td></tr><tr><td align="left">Version 0.4</td><td align="left">2002-03-24</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Toute la structure est d&eacute;finie. Tous les exemples de commandes sont &eacute;crits (<span class="emphasis"><em>All skeleton defined. All command examples written</em></span>).</td></tr><tr><td align="left">Version 0.2</td><td align="left">2002-03-19</td><td align="left">AVI</td></tr><tr><td colspan="3" align="left">Premi&egrave;re version DocBook (<span class="emphasis"><em>First DocBook version</em></span>).</td></tr></table></div></div><div><div class="abstract"><p class="title"><b>R&eacute;sum&eacute;</b></p><p>

      Ce document pr&eacute;sente la gestion de la date et de l'heure sous 
      Linux. Il explique &eacute;galement comment r&eacute;gler la date et l'heure de 
      votre syst&egrave;me et comment synchroniser votre machine via le 
      protocole NTP.

  </p></div></div></div><div></div><hr></div><div class="toc"><p><b>Table des mati&egrave;res</b></p><dl><dt><span class="section"><a href="#why">1. Pourquoi avoir une horloge pr&eacute;cise&nbsp;?</a></span></dt><dd><dl><dt><span class="section"><a href="#why.pcclock">1.1. De quels facteurs d&eacute;pend l'horloge mat&eacute;rielle&nbsp;?</a></span></dt></dl></dd><dt><span class="section"><a href="#time">2. L'heure et la date en informatique</a></span></dt><dt><span class="section"><a href="#tz">3. Qu'est-ce qu'un fuseau horaire&nbsp;?</a></span></dt><dd><dl><dt><span class="section"><a href="#tz.dst">3.1. L'heure d'&eacute;t&eacute;</a></span></dt><dt><span class="section"><a href="#tz.examples">3.2. Exemples de fuseaux horaires</a></span></dt><dt><span class="section"><a href="#tz.linux">3.3. Les fuseaux horaires et Linux</a></span></dt></dl></dd><dt><span class="section"><a href="#set">4. Les param&egrave;tres corrects pour votre machine Linux</a></span></dt><dd><dl><dt><span class="section"><a href="#set.tz">4.1. S&eacute;lection du fuseau horaire</a></span></dt><dt><span class="section"><a href="#set.hwclock">4.2. R&eacute;gler l'horloge mat&eacute;rielle</a></span></dt></dl></dd><dt><span class="section"><a href="#ntp">5. Synchronisation pr&eacute;cise de l'heure</a></span></dt><dd><dl><dt><span class="section"><a href="#ntp.ntp">5.1. <span class="acronym">NTP</span>&nbsp;: protocole de diffusion du temps en r&eacute;seau (Network Time Protocol)</a></span></dt><dt><span class="section"><a href="#ntp.arch">5.2. Construire une architecture simple de synchronisation de l'heure</a></span></dt><dt><span class="section"><a href="#ntp.configs">5.3. Configuration <span class="acronym">NTP</span></a></span></dt><dt><span class="section"><a href="#ntp.watch">5.4. Observer votre machine se synchroniser</a></span></dt><dt><span class="section"><a href="#ntp.boot">5.5. Lancer automatiquement <span class="acronym">NTP</span> au d&eacute;marrage</a></span></dt></dl></dd><dt><span class="section"><a href="#ntp.chrony">6. Une horloge pr&eacute;cise avec le programme <span><strong class="command">chrony</strong></span></a></span></dt><dd><dl><dt><span class="section"><a href="#ntp.chrony.diff">6.1. En quoi <span><strong class="command">chrony</strong></span> diff&egrave;re de <span><strong class="command">ntp</strong></span>&nbsp;?</a></span></dt><dt><span class="section"><a href="#ntp.chrony.how">6.2. Comment utiliser <span><strong class="command">chrony</strong></span>&nbsp;?</a></span></dt></dl></dd><dt><span class="appendix"><a href="#about">A. &Agrave; propos de ce document</a></span></dt></dl></div><div class="section" lang="fr"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="why"></a>1.&nbsp;Pourquoi avoir une horloge pr&eacute;cise&nbsp;?</h2></div></div><div></div></div><p>
    
        Si votre ordinateur ne se connecte jamais &agrave; d'autres ordinateurs 
        (ou &agrave; d'autres appareils utilisant une horloge), la pr&eacute;cision de 
        l'horloge n'est pas critique en elle-m&ecirc;me, elle d&eacute;pend des 
        besoins de l'utilisateur. Cependant, les programmes qui d'une 
        fa&ccedil;on ou l'autre utilisent internet d&eacute;pendent d'une date et 
        d'une heure pr&eacute;cises. Voici quelques situations o&ugrave; vous pourriez 
        en avoir besoin&nbsp;:
        
    </p><div class="itemizedlist"><ul type="disc"><li><p>Pour des logiciels effectuant des transactions&nbsp;;</p></li><li><p>Pour des applications commerciales (p.ex. eBay)&nbsp;;</p></li><li><p>Pour des clients et serveurs de messagerie&nbsp;;</p></li><li><p>Pour des sites web qui utilisent des cookies&nbsp;;</p></li><li><p>Pour des applications web distibu&eacute;es&nbsp;;</p></li><li><p>Pour certains services web&nbsp;;</p></li><li><p>Pour des applications distribu&eacute;es &agrave; base de 
      composants telles que <span class="acronym">J2EE</span>, 
      <span class="acronym">.NET</span>, et c&aelig;tera&nbsp;;</p></li><li><p>Pour des syst&egrave;mes de fichiers modernes avanc&eacute;s et 
      parall&egrave;les tels que AFS, DFS, GFS, GPFS, et 
      c&aelig;tera.</p></li></ul></div><p>Et bien s&ucirc;r, pour utiliser votre ordinateur pour r&eacute;gler votre montre.</p><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="why.pcclock"></a>1.1.&nbsp;De quels facteurs d&eacute;pend l'horloge mat&eacute;rielle&nbsp;?</h3></div></div><div></div></div><p>Ici, nous allons un peu parler de la pr&eacute;cision de l'horloge mat&eacute;rielle.</p><p>Dans les PC, des oscillateurs &agrave; quartz g&egrave;rent l'horloge mat&eacute;rielle. La fr&eacute;quence de l'oscillateur est divis&eacute;e et finalement on obtient un compteur qui est incr&eacute;ment&eacute; d'une unit&eacute; toutes les secondes (en r&eacute;alit&eacute; c'est plus compliqu&eacute; que &ccedil;&agrave;, mais c'est suffisant pour nous). L'oscillateur fonctionne m&ecirc;me lorsque l'ordinateur est &eacute;teint. D&egrave;s lors, au d&eacute;marrage de l'ordinateur (et de Linux), l'horloge mat&eacute;rielle peut donner l'heure actuelle. La stabilit&eacute; de cette horloge d&eacute;pend principalement de la temp&eacute;rature de son environnement mais aussi de la pression atmosph&eacute;rique et de la stabilit&eacute; de la tension de son alimentation &eacute;lectrique. L'horloge mat&eacute;rielle est fiable &agrave; court terme. Cependant, &agrave; long terme, elle d&eacute;rive par rapport &agrave; l'heure exacte. Puisque l'on peut continuellement comparer la fr&eacute;quence de notre horloge mat&eacute;rielle &agrave; celle d'une horloge exacte, on peut calculer la fr&eacute;quence de l'horloge mat&eacute;rielle et ainsi reconstituer l'heure exacte. Si cette horloge exacte se trouve dans notre r&eacute;seau local, la pr&eacute;cision de l'horloge de votre machine Linux sera de l'ordre de 0.01s. Si vous utilisez plut&ocirc;t internet, votre horloge sera au plus &agrave; 0.2s de l'heure exacte.</p></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="time"></a>2.&nbsp;L'heure et la date en informatique</h2></div></div><div></div></div><p>
    
        Pour d&eacute;terminer l'heure actuelle en un endroit donn&eacute; de la 
        plan&egrave;te, un ordinateur a besoin d'exactement deux 
        informations&nbsp;:
        
    </p><div class="orderedlist"><ol type="1"><li><p>
      
          l'heure <span class="acronym">UTC</span> exacte (en fran&ccedil;ais Temps 
          Universel Coordonn&eacute; &mdash; qui a remplac&eacute; l'heure 
          <span class="acronym">GMT</span>)&nbsp;;
      
      </p></li><li><p>
      
          le fuseau horaire local.
          
      </p></li></ol></div><p>
    
        Pour les ordinateurs, il y a aussi une horloge mat&eacute;rielle 
        interne qui sert de temps de base pour le syst&egrave;me 
        d'exploitation.
    
    </p><p>
    
        La date et l'heure du syst&egrave;me d'exploitation (nous n'utiliserons 
        plus que le terme date <span class="emphasis"><em>ou</em></span> heure pour 
        exprimer les deux &agrave; partir de maintenant) sont r&eacute;gl&eacute;es au 
        d&eacute;marrage par un script qui lit l'horloge mat&eacute;rielle et l'ajuste 
        en fonction du fuseau horaire (il n'est pas stock&eacute; dans le 
        <span class="acronym">BIOS</span>). Apr&egrave;s cette synchronisation, les 
        heures du <span class="acronym">BIOS</span> et du syst&egrave;me d'exploitation 
        sont compl&egrave;tement ind&eacute;pendantes. D&egrave;s lors, apr&egrave;s un certain 
        temps, il peut y avoir plusieurs secondes de d&eacute;calage. Laquelle 
        est correcte&nbsp;? Sans pr&eacute;cautions particuli&egrave;res, aucune.
        
    </p><p>Nous allons maintenant discuter comment les rendre toutes les deux <span class="emphasis"><em>100% fiables</em></span>.</p></div><div class="section" lang="fr"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tz"></a>3.&nbsp;Qu'est-ce qu'un fuseau horaire&nbsp;?</h2></div></div><div></div></div><p>Les fuseaux horaires sont des divisions g&eacute;ographiques du globe terrestre tous les 15&deg; de longitude, commen&ccedil;ant &agrave; Greenwich en Angleterre, cr&eacute;&eacute;es pour aider les gens &agrave;&nbsp;d&eacute;terminer l'heure qu'il est partout dans le monde.</p><p>De nos jours, il s'agit plus de divisions politiques que g&eacute;ographiques, parce que parfois les gens ont besoin d'avoir la m&ecirc;me heure que d'autres en des lieux pas trop &eacute;loign&eacute;s. Et pour faire des &eacute;conomies d'&eacute;nergies, nous avons aujourd'hui l'heure d'&eacute;t&eacute; qui correspond &agrave; un changement de fuseau horaire.</p><p>Les fuseaux horaires sont g&eacute;n&eacute;ralement d&eacute;finis par les gouvernements ou par un institut d'astronomie et sont repr&eacute;sent&eacute;s par un code de 3 ou 4 lettres. Voir <a href="#tz.examples" title="3.2.&nbsp;Exemples de fuseaux horaires">Section&nbsp;3.2, &laquo;&nbsp;Exemples de fuseaux horaires&nbsp;&raquo;</a> pour des exemples.</p><p>Si vous voulez conna&icirc;tre l'heure actuelle n'importe o&ugrave; dans le monde, vous pouvez utiliser les sites web <a href="http://www.timezoneconverter.com/" target="_top">timezoneconverter.com</a> (en anglais) ou <a href="http://www.horlogeparlante.com/" target="_top">horlogeparlante.com</a> (en fran&ccedil;ais)</p><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="tz.dst"></a>3.1.&nbsp;L'heure d'&eacute;t&eacute;</h3></div></div><div></div></div><p>
      
          Pour faire des &eacute;conomies d'&eacute;nergie, les gouvernements ont cr&eacute;&eacute; 
          l'heure d'&eacute;t&eacute; (appel&eacute;e en anglais <span class="foreignphrase" lang="en"><em class="foreignphrase">Daylight Savings Time</em></span> ou <span class="acronym">DST</span>). Nos horloges sont avanc&eacute;es d'une 
          heure et cela fait sembler nos journ&eacute;es plus longues. En fait, 
          cela revient seulement &agrave; changer de fuseau horaire. Le temps 
          primitif (<span class="acronym">UTC</span>) est encore, et 
          restera toujours, le m&ecirc;me.
      
      </p><p>
      
          Nous verrons plus tard comment activer ou d&eacute;sactiver 
          automatiquement l'heure d'&eacute;t&eacute; dans Linux.
          
      </p></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="tz.examples"></a>3.2.&nbsp;Exemples de fuseaux horaires</h3></div></div><div></div></div><p>Il n'y a rien de plus parlant que des exemples&nbsp;:</p><div class="table"><a name="tz.ex.br"></a><p class="title"><b>Tableau&nbsp;1.&nbsp;Fuseaux horaires du Br&eacute;sil. D&eacute;calage par rapport &agrave; l'heure <span class="acronym">UTC</span></b></p><table summary="Fuseaux horaires du Br&eacute;sil. D&eacute;calage par rapport &agrave; l'heure UTC" border="1"><colgroup><col width="33%"><col width="33%"><col width="34%"></colgroup><thead><tr><th>Nom et d&eacute;calage</th><th>Nom et d&eacute;calage <a href="#tz.dst" title="3.1.&nbsp;L'heure d'&eacute;t&eacute;">heure d'&eacute;t&eacute;</a></th><th>Lieux</th></tr></thead><tbody><tr><td>BREST -2:00</td><td>BREDT -1:00</td><td>Fernando de Noronha</td></tr><tr><td>BRST -3:00</td><td>BRDT -2:00</td><td>Sao Paulo, Rio, Brasilia, Minas Gerais,
              R&eacute;gion Nord-Est, R&eacute;gion Sud, et c&aelig;tera</td></tr><tr><td>BRWST -4:00</td><td>BRWDT -3:00</td><td>R&eacute;gion Ouest</td></tr><tr><td>BRAST -5:00</td><td>BRADT -4:00</td><td>Acre</td></tr></tbody></table></div><p>Si vous avez une table telle que celle-ci pour les USA ou 
      l'Europe, envoyez-la moi s'il-vous-pla&icirc;t.</p></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="tz.linux"></a>3.3.&nbsp;Les fuseaux horaires et Linux</h3></div></div><div></div></div><p>Les syst&egrave;mes Linux utilisent les fuseaux horaires dynamiques GLIBC bas&eacute;s sur <code class="filename">/etc/localtime</code>. Ce fichier est un lien vers (ou une copie) d'un fichier d'information de fuseau horaire situ&eacute; g&eacute;n&eacute;ralement dans le r&eacute;pertoire <code class="filename">/usr/share/zoneinfo</code>.</p><p>D'un point de vue g&eacute;ophysique, il y a seulement 360&deg;/15&deg;=24 fuseaux horaires dans le monde. Mais pour rendre les choses faciles pour tous et pour tenir compte de toutes les variations politiques (comme l'heure d'&eacute;t&eacute;), vous trouverez des centaines de fichiers d'information de fuseau horaire dans <code class="filename">/usr/share/zoneinfo</code>, chacun valable pour une ville, un pays, et c&aelig;tera.</p><p>Certains pays, comme le Br&eacute;sil, n'ont pas un jour fixe pour passer &agrave; l'heure d'&eacute;t&eacute;. Il est d&eacute;fini chaque ann&eacute;e quelques mois avant l'&eacute;t&eacute; et peut vous obliger &agrave; changer votre fichier d'information de fuseau horaire qui peut &ecirc;tre compil&eacute; avec la commande <span><strong class="command">zic</strong></span> &agrave; partir d'un fichier comme celui-ci.</p><div class="example"><a name="N10268"></a><p class="title"><b>Exemple&nbsp;1.&nbsp;Fichier d'information de fuseau horaire pour le Br&eacute;sil</b></p><pre class="programlisting">
# Fuseaux horaires du Br&eacute;sil
#
# Les fuseaux horaires br&eacute;siliens sont :
# BREST: Est de Brasilia. Fernando de Noronha.
# BRST:  Brasilia, Sao Paulo, Rio, Nord-est, Sud, et c&aelig;tera
# BRWST: Ouest de Brasilia. Mato Grosso, Manaus
# BRAST: Acre.
#
# En heure d'&eacute;t&eacute;, la lettre 'S' devient 'D'.
#
# Pour installer, ex&eacute;cuter :
#
# # zic Brazil.txt
#
# Les fichiers de fuseaux horaires seront install&eacute;s dans
# /usr/share/zoneinfo (d&eacute;pend de votre distribution). Ensuite,
# cr&eacute;ez un lien symbolique de votre zone vers /etc/localtime&nbsp;:
#
# # ln -sf /usr/share/zoneinfo/Brazil/Brasilia /etc/localtime
#
#
# Si vous avez des mises &agrave; jour ou de nouveaux standards pour ce
# fichier, envoyez-les en anglais &agrave;
#
# Avi Alkalay &lt;avi @ unix.sh&gt;
#
# Derni&egrave;re mise &agrave; jour : 18 Nov 2000
# Ce fichier est disponible sur http://avi.alkalay.net/linux/zoneinfo/
#

# Rule  NAME    FROM  TO    TYPE  IN    ON   AT    SAVE   LETTER/S
Rule    Brazil  1931  1932  -     Oct   3    0:00  1:00   D
Rule    Brazil  1932  1933  -     Mar   31   0:00  0      S
Rule    Brazil  1949  only  -     Dec   1    0:00  1:00   D
Rule    Brazil  1950  only  -     Apr   30   0:00  0      S
Rule    Brazil  1950  1952  -     Dec   1    0:00  1:00   D
Rule    Brazil  1951  only  -     Apr   16   0:00  0      S
Rule    Brazil  1952  only  -     Mar   31   0:00  0      S
Rule    Brazil  1953  only  -     Feb   28   0:00  0      S
Rule    Brazil  1963  only  -     Oct   23   0:00  1:00   D
Rule    Brazil  1964  only  -     Mar   1    0:00  0      S
Rule    Brazil  1965  only  -     Jan   31   0:00  1:00   D
Rule    Brazil  1965  only  -     Mar   31   0:00  0      S
Rule    Brazil  1965  only  -     Dec   1    0:00  1:00   D
Rule    Brazil  1966  1968  -     Mar   1    0:00  0      S
Rule    Brazil  1966  1967  -     Nov   1    0:00  1:00   D
Rule    Brazil  1984  only  -     Nov   2    0:00  1:00   D
Rule    Brazil  1985  only  -     Mar   15   0:00  0      S
Rule    Brazil  1985  only  -     Nov   2    0:00  1:00   D
Rule    Brazil  1986  only  -     Mar   15   0:00  0      S
Rule    Brazil  1986  only  -     Oct   25   0:00  1:00   D
Rule    Brazil  1987  only  -     Feb   14   0:00  0      S
Rule    Brazil  1987  only  -     Oct   25   0:00  1:00   D
Rule    Brazil  1988  only  -     Feb   7    0:00  0      S
Rule    Brazil  1988  only  -     Oct   16   0:00  1:00   D
Rule    Brazil  1989  only  -     Jan   29   0:00  0      S
Rule    Brazil  1989  only  -     Oct   15   0:00  1:00   D
Rule    Brazil  1990  only  -     Feb   11   0:00  0      S
Rule    Brazil  1990  only  -     Oct   21   0:00  1:00   D
Rule    Brazil  1991  only  -     Feb   17   0:00  0      S
Rule    Brazil  1991  only  -     Oct   20   0:00  1:00   D
Rule    Brazil  1992  only  -     Feb   9    0:00  0      S
Rule    Brazil  1992  only  -     Oct   25   0:00  1:00   D
Rule    Brazil  1993  only  -     Jan   31   0:00  0      S
Rule    Brazil  1993  only  -     Oct   17   0:00  1:00   D
Rule    Brazil  1994  only  -     Feb   20   0:00  0      S
Rule    Brazil  1994  only  -     Oct   16   0:00  1:00   D
Rule    Brazil  1995  only  -     Feb   19   0:00  0      S
Rule    Brazil  1995  only  -     Oct   15   0:00  1:00   D
Rule    Brazil  1996  only  -     Feb   11   0:00  0      S
Rule    Brazil  1996  only  -     Oct   06   0:00  1:00   D
Rule    Brazil  1997  only  -     Feb   16   0:00  0      S
Rule    Brazil  1997  only  -     Oct   06   0:00  1:00   D
Rule    Brazil  1998  only  -     Mar   01   0:00  0      S
Rule    Brazil  1998  only  -     Oct   11   0:00  1:00   D
Rule    Brazil  1999  only  -     Feb   21   0:00  0      S
Rule    Brazil  1999  only  -     Oct   03   0:00  1:00   D
Rule    Brazil  2000  only  -     Feb   27   0:00  0      S
Rule    Brazil  2000  only  -     Oct   8    0:00  1:00   D
Rule    Brazil  2001  only  -     Feb   18   0:00  0      S


# Zone  NAME                          GMTOFF  RULES/SAVE    FORMAT  [UNTIL]
Zone    Brazil/DeNoronha              -2:00   Brazil        BRE%sT
Zone    posix/Brazil/DeNoronha        -2:00   Brazil        BRE%sT
Zone    right/Brazil/DeNoronha        -2:00   Brazil        BRE%sT
Zone    Brazil/East                   -2:00   Brazil        BRE%sT
Zone    posix/Brazil/East             -2:00   Brazil        BRE%sT
Zone    right/Brazil/East             -2:00   Brazil        BRE%sT

Zone    America/Sao_Paulo             -3:00   Brazil        BR%sT
Zone    America/Rio_de_Janeiro        -3:00   Brazil        BR%sT
Zone    America/Brasilia              -3:00   Brazil        BR%sT
Zone    posix/America/Sao_Paulo       -3:00   Brazil        BR%sT
Zone    posix/America/Rio_de_Janeiro  -3:00   Brazil        BR%sT
Zone    posix/America/Salvador        -3:00   Brazil        BR%sT
Zone    posix/America/Brasilia        -3:00   Brazil        BR%sT
Zone    posix/Brazil/Central          -3:00   Brazil        BR%sT
Zone    posix/Brazil/Brasilia         -3:00   Brazil        BR%sT
Zone    posix/Brazil/Sao_Paulo        -3:00   Brazil        BR%sT
Zone    posix/Brazil/Salvador         -3:00   Brazil        BR%sT
Zone    posix/Brazil/Rio_de_Janeiro   -3:00   Brazil        BR%sT
Zone    right/America/Sao_Paulo       -3:00   Brazil        BR%sT
Zone    right/America/Rio_de_Janeiro  -3:00   Brazil        BR%sT
Zone    right/America/Salvador        -3:00   Brazil        BR%sT
Zone    right/America/Brasilia        -3:00   Brazil        BR%sT
Zone    right/Brazil/Central          -3:00   Brazil        BR%sT
Zone    right/Brazil/Brasilia         -3:00   Brazil        BR%sT
Zone    right/Brazil/Sao_Paulo        -3:00   Brazil        BR%sT
Zone    right/Brazil/Salvador         -3:00   Brazil        BR%sT
Zone    right/Brazil/Rio_de_Janeiro   -3:00   Brazil        BR%sT
Zone    Brazil/Central                -3:00   Brazil        BR%sT
Zone    Brazil/Brasilia               -3:00   Brazil        BR%sT
Zone    Brazil/Sao_Paulo              -3:00   Brazil        BR%sT
Zone    Brazil/Rio_de_Janeiro         -3:00   Brazil        BR%sT
Zone    Brazil/Salvador               -3:00   Brazil        BR%sT

Zone    Brazil/West                   -4:00   Brazil        BRW%sT
Zone    Brazil/Manaus                 -4:00   Brazil        BRW%sT
Zone    Brazil/Rondonia               -4:00   Brazil        BRW%sT
Zone    Brazil/Roraima                -4:00   Brazil        BRW%sT
Zone    Brazil/Mato_Grosso            -4:00   Brazil        BRW%sT
Zone    posix/Brazil/Manaus           -4:00   Brazil        BRW%sT
Zone    posix/Brazil/Mato_Grosso      -4:00   Brazil        BRW%sT
Zone    right/Brazil/Manaus           -4:00   Brazil        BRW%sT
Zone    right/Brazil/Mato_Grosso      -4:00   Brazil        BRW%sT
Zone    posix/America/Manaus          -4:00   Brazil        BRW%sT
Zone    right/America/Manaus          -4:00   Brazil        BRW%sT

Zone    Brazil/Acre                   -5:00   Brazil        BRA%sT
</pre></div><p>
      
          Une ligne <span><strong class="command">Rule</strong></span> d&eacute;finit la date et l'heure &agrave; 
          laquelle s'effectue un changement de fuseau horaire, tandis 
          qu'une ligne <span><strong class="command">Zone</strong></span> r&eacute;f&eacute;rence la r&egrave;gle 
          (<span><strong class="command">Rule</strong></span>) qui la g&eacute;rera. Notez que le nom de 
          la <span><strong class="command">Zone</strong></span> est en fait le nom du fichier dans 
          le r&eacute;pertoire <code class="filename">/usr/share/zoneinfo</code> et qu'il peut 
          y avoir plusieurs noms pour le m&ecirc;me fuseau horaire afin qu'il 
          soit plus facile de trouver sa propre zone.
          
      </p><p>Les commentaires du fichier expliquent comment installer ces fuseaux horaires en utilisant le compilateur de fichier d'information de fuseau horaire <span><strong class="command">zic</strong></span>. Pour le rendre effectif, vous n'avez plus qu'&agrave; cr&eacute;er un lien (ou copier) du fichier d'information de fuseau horaire vers <code class="filename">/etc/localtime</code>. Pour certaines distributions, il y a une m&eacute;thode de niveau sup&eacute;rieur (et pr&eacute;f&eacute;rable) pour r&eacute;gler le fuseau horaire d&eacute;crite dans <a href="#set.tz" title="4.1.&nbsp;S&eacute;lection du fuseau horaire">Section&nbsp;4.1, &laquo;&nbsp;S&eacute;lection du fuseau horaire&nbsp;&raquo;</a>.</p><p>Apr&egrave;s avoir fait pointer <code class="filename">/etc/localtime</code> vers le fichier de fuseau horaire correct, les r&egrave;gles de cette zone s'appliquent d&eacute;j&agrave; et les changements de fuseau sont automatiques&nbsp;; vous n'avez plus &agrave; changer l'heure manuellement.</p><p>La s&eacute;quence suivante de commandes illustre la dynamique de la gestion des fuseaux horaires sous Linux. Notez qu'elles ont toutes &eacute;t&eacute; ex&eacute;cut&eacute;es en moins d'une minute&nbsp;:</p><pre class="screen">
<code class="prompt">bash$ </code><span><strong class="command">ls -al /etc/localtime</strong></span>
lrwxrwxrwx  1 root root 35 May 22  2001 /etc/localtime -&gt; <span class="emphasis"><em>/usr/share/zoneinfo/Brazil/Brasilia</em></span>
<code class="prompt">bash$ </code><span><strong class="command">date</strong></span>
Fri Mar 29 20:13:38 <span class="emphasis"><em>BRST</em></span> 2002
<code class="prompt">bash# </code><span><strong class="command">ln -sf /usr/share/zoneinfo/GMT /etc/localtime</strong></span>
<code class="prompt">bash$ </code><span><strong class="command">date</strong></span>
Fri Mar 29 23:13:47 <span class="emphasis"><em>GMT</em></span> 2002
<code class="prompt">bash# </code><span><strong class="command">ln -sf /usr/share/zoneinfo/Brazil/Brasilia /etc/localtime</strong></span>
<code class="prompt">bash$ </code><span><strong class="command">date</strong></span>
Fri Mar 29 20:14:03 <span class="emphasis"><em>BRST</em></span> 2002
</pre><p>
      
          &Agrave; 20:13, j'&eacute;tais dans le fuseau horaire par d&eacute;faut du Br&eacute;sil 
          (BRST)&nbsp;; ensuite, je suis pass&eacute; &agrave; l'heure GMT et 
          l'horloge du syst&egrave;me est pass&eacute;e &agrave; 23:13&nbsp;! Quand votre 
          fuseau horaire passera &agrave; l'heure d'&eacute;t&eacute;, vous verrez un effet 
          similaire, mais cette fois les r&egrave;gles sont toutes &agrave; 
          l'int&eacute;rieur de votre fichier 
          <code class="filename">/etc/localtime</code> (qui ne change pas au 
          contraire de cet exemple).
      
      </p><p>
      
          Une application tournant sur cette machine (par exemple un 
          serveur web g&eacute;n&eacute;rant des fichiers journaux) sera sensible &agrave; ce 
          changement&nbsp;; il est donc tr&egrave;s important pour les 
          d&eacute;veloppeurs de se souvenir que l'heure locale est &eacute;gale &agrave; 
          l'<span class="emphasis"><em>heure universelle</em></span> actuelle plus le 
          <span class="emphasis"><em>fuseau horaire</em></span> actuel, comme d&eacute;crit dans 
          <a href="#time" title="2.&nbsp;L'heure et la date en informatique">Section&nbsp;2, &laquo;&nbsp;L'heure et la date en informatique&nbsp;&raquo;</a>.
          
      </p><p>Finalement, je suis revenu &agrave; mon fuseau horaire de d&eacute;part.</p></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="set"></a>4.&nbsp;Les param&egrave;tres corrects pour votre machine Linux</h2></div></div><div></div></div><p>
    
        Quel que soit le syst&egrave;me que vous voulez installer, vous devez 
        conna&icirc;tre votre fuseau horaire. Il peut &ecirc;tre d&eacute;termin&eacute; par une 
        ville, une r&eacute;gion ou un pays. Vous devez aussi d&eacute;cider comment 
        r&eacute;gler l'heure du <span class="acronym">BIOS</span>. Ici, vous pouvez 
        suivre deux strat&eacute;gies&nbsp;:
    
    </p><div class="variablelist"><dl><dt><span class="term"><span class="emphasis"><em>Machine avec seulement Linux</em></span></span></dt><dd><p>
        
            Dans ce cas, vous pouvez mettre l'heure du 
            <span class="acronym">BIOS</span> &agrave; l'heure <span class="acronym">UTC</span>. 
            Les changements de fuseaux horaires seront g&eacute;r&eacute;s 
            dynamiquement comme expliqu&eacute; dans <a href="#tz.linux" title="3.3.&nbsp;Les fuseaux horaires et Linux">Section&nbsp;3.3, &laquo;&nbsp;Les fuseaux horaires et Linux&nbsp;&raquo;</a>.
        
        </p></dd><dt><span class="term"><span class="emphasis"><em>Machine avec Linux et MS Windows</em></span></span></dt><dd><p>
        
            Windows manipule l'heure d'une mani&egrave;re plus primitive que 
            Linux. Pour Windows, l'heure du <span class="acronym">BIOS</span> 
            correspond toujours &agrave; l'heure locale, les changements de 
            fuseaux sont donc plus agressifs car ils changent 
            directement l'horloge mat&eacute;rielle. Et puisque Linux et 
            Windows initialisent tous deux leur heure &agrave; partir de 
            l'horloge mat&eacute;rielle, si les deux sont pr&eacute;sents, Linux doit 
            la manipuler de la m&ecirc;me fa&ccedil;on. Dans ce cas, vous devez 
            mettre votre <span class="acronym">BIOS</span> &agrave; l'heure locale.
        
        </p></dd></dl></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="set.tz"></a>4.1.&nbsp;S&eacute;lection du fuseau horaire</h3></div></div><div></div></div><p>
          
          Sur les syst&egrave;mes Red Hat Linux et d&eacute;riv&eacute;s, vous pouvez r&eacute;gler 
          la strat&eacute;gie pour l'horloge mat&eacute;rielle et les fuseaux horaires 
          gr&acirc;ce &agrave; la commande <span><strong class="command">timeconfig</strong></span>, qui utilise 
          une interface conviviale. Vous pouvez aussi le faire de fa&ccedil;on 
          non-interactive&nbsp;:
      
      </p><div class="example"><a name="N10317"></a><p class="title"><b>Exemple&nbsp;2.&nbsp;Outil de configuration de l'heure</b></p><pre class="screen">
<code class="prompt">bash# </code><span><strong class="command">timeconfig "Brasil/East"</strong></span>         # r&egrave;gle l'horloge mat&eacute;rielle &agrave; l'heure locale
<code class="prompt">bash# </code>                                 # et le fuseau horaire sur la zone est du Br&eacute;sil
<code class="prompt">bash# </code>
<code class="prompt">bash# </code><span><strong class="command">timeconfig --utc "Brasil/East"</strong></span>   # r&egrave;gle l'horloge mat&eacute;rielle &agrave; l'heure UTC
<code class="prompt">bash# </code>                                 # et le fuseau horaire sur la zone est du Br&eacute;sil
</pre></div><p>De toute fa&ccedil;on, cela change le fichier <code class="filename">/etc/sysconfig/clock</code> qui est lu au d&eacute;marrage. Vous pouvez l'&eacute;diter manuellement. Il ressemble &agrave; ceci&nbsp;:</p><div class="example"><a name="N1033D"></a><p class="title"><b>Exemple&nbsp;3.&nbsp;<code class="filename">/etc/sysconfig/clock</code> file</b></p><pre class="programlisting">
ZONE="Brazil/East"
UTC=true
ARC=false
</pre></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="set.hwclock"></a>4.2.&nbsp;R&eacute;gler l'horloge mat&eacute;rielle</h3></div></div><div></div></div><p>
      
          Je vous conseille de ne changer votre horloge mat&eacute;rielle que 
          si vous comprenez comment obtenir l'heure exacte, comme 
          expliqu&eacute; dans <a href="#ntp" title="5.&nbsp;Synchronisation pr&eacute;cise de l'heure">Section&nbsp;5, &laquo;&nbsp;Synchronisation pr&eacute;cise de l'heure&nbsp;&raquo;</a>.
      
      </p><p>
      
          La commande <span><strong class="command">hwclock</strong></span> lit ou r&egrave;gle l'horloge 
          mat&eacute;rielle en fonction des param&egrave;tres que vous lui donnez et 
          qui sont document&eacute;s dans son manuel. Mais vous n'avez 
          normalement pas &agrave; l'utiliser si vous avez une distribution 
          moderne. Apr&egrave;s avoir choisi votre strat&eacute;gie pour l'horloge 
          mat&eacute;rielle et les fuseaux horaires, vous pouvez utiliser la 
          commande de haut niveau <span><strong class="command">setclock</strong></span> pour 
          r&eacute;gler correctement votre horloge mat&eacute;rielle. Vous n'avez pas 
          besoin de passer de param&egrave;tres car <span><strong class="command">setclock</strong></span> 
          appelle intelligemment <span><strong class="command">hwclock</strong></span> pour r&eacute;gler 
          le <span class="acronym">BIOS</span> en se basant sur l'heure courante 
          de votre syst&egrave;me d'exploitation. <span class="emphasis"><em>Vous devriez donc 
          toujours utiliser la commande 
          <span><strong class="command">setclock</strong></span>.</em></span>
          
      </p><p>
      
          Mais si vous &ecirc;tes minimaliste et pr&eacute;f&eacute;rez la fa&ccedil;on compliqu&eacute;e, 
          voici quelques exemples d'utilisation de 
          <span><strong class="command">hwclock</strong></span>&nbsp;:
          
      </p><div class="example"><a name="N10371"></a><p class="title"><b>Exemple&nbsp;4.&nbsp;Utilisation de <span>setclock</span> et <span>hwclock</span></b></p><pre class="screen">
<code class="prompt">bash# </code><span><strong class="command">setclock</strong></span>                                  # La mani&egrave;re simple de r&eacute;gler l'horloge mat&eacute;rielle
<code class="prompt">bash# </code>
<code class="prompt">bash# </code><span><strong class="command">hwclock</strong></span>                                   # Lit l'horloge mat&eacute;rielle
<code class="prompt">bash# </code>
<code class="prompt">bash# </code><span><strong class="command">hwclock --systohc --utc</strong></span>                   # R&egrave;gle l'horloge mat&eacute;rielle avec l'heure UTC
<code class="prompt">bash# </code>                                          # bas&eacute;e sur l'heure actuelle du syst&egrave;me
<code class="prompt">bash# </code>
<code class="prompt">bash# </code><span><strong class="command">hwclock --systohc</strong></span>                         # R&egrave;gle l'horloge mat&eacute;rielle avec l'heure actuelle
<code class="prompt">bash# </code>                                          # bas&eacute;e sur l'heure actuelle du syst&egrave;me
<code class="prompt">bash# </code>
<code class="prompt">bash# </code><span><strong class="command">hwclock --set --date "21 Oct 2004 21:17"</strong></span>  # R&egrave;gle l'horloge mat&eacute;rielle avec l'heure sp&eacute;cifi&eacute;e
</pre></div><p>
      
        Puisque l'heure du syst&egrave;me est ind&eacute;pendante de l'horloge 
        mat&eacute;rielle, tout changement dans le <span class="acronym">BIOS</span> 
        n'appara&icirc;tra que lors du d&eacute;marrage suivant.
        
      </p><p>Une autre option pour changer l'horloge mat&eacute;rielle est de red&eacute;marrer l'ordinateur et d'acc&eacute;der &agrave; l'&eacute;cran de configuration du <span class="acronym">BIOS</span>. Sur les plates-formes <a href="http://ibm.com/servers/eserver/zseries/os/linux/" target="_top">IBM e-server zSeries</a> vous devez le faire au niveau de z/VM parce que Linux tourne sur des machines virtuelles cr&eacute;&eacute;es par z/VM.</p></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ntp"></a>5.&nbsp;Synchronisation pr&eacute;cise de l'heure</h2></div></div><div></div></div><p>Avoir l'heure exacte sur tous vos syst&egrave;mes est aussi important que d'avoir une strat&eacute;gie solide de la s&eacute;curit&eacute; du r&eacute;seau (ce qui est bien plus qu'utiliser des pare-feu). C'est un des &eacute;l&eacute;ments essentiels d'une administration syst&egrave;me bas&eacute;e sur de bonnes pratiques qui m&egrave;ne &agrave; des syst&egrave;mes bien organis&eacute;s et s&ucirc;rs. Une heure pr&eacute;cise est particuli&egrave;rement n&eacute;cessaire lorsqu'on travaille avec des applications distribu&eacute;es, des services web ou des outils distribu&eacute;s de surveillance r&eacute;seau.</p><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="ntp.ntp"></a>5.1.&nbsp;<span class="acronym">NTP</span>&nbsp;: protocole de diffusion du temps en r&eacute;seau (Network Time Protocol)</h3></div></div><div></div></div><p>Nous ne d&eacute;crirons pas ici le protocole, mais comment cette magnifique invention, ajout&eacute;e &agrave; la pr&eacute;sence envahissante d'internet, peut nous &ecirc;tre utile. Vous pouvez en apprendre plus sur <a href="http://www.ntp.org/" target="_top">www.ntp.org</a>.</p><p>Une fois le syst&egrave;me configur&eacute;, <span class="acronym">NTP</span> arrivera &agrave; garder l'heure exacte en ne faisant que de tr&egrave;s petits ajustements pour ne pas perturber les applications en cours d'ex&eacute;cution.</p><p>L'heure exacte peut &ecirc;tre obtenue en utilisant des appareils bas&eacute;s sur la fr&eacute;quence &eacute;lectronique des atomes. Il existe aussi une m&eacute;thode bas&eacute;e sur le syst&egrave;me de satellites <span class="acronym">GPS</span>. La premi&egrave;re est plus fiable, mais la seconde n'est pas si mauvaise. Les deux n&eacute;cessitent un mat&eacute;riel tr&egrave;s sp&eacute;cifique et tr&egrave;s cher, mais leurs propri&eacute;taires (en g&eacute;n&eacute;ral des universit&eacute;s ou des laboratoires de recherche) les connectent &agrave; des ordinateurs qui font tourner un serveur <span class="acronym">NTP</span> qui sont connect&eacute;s &agrave; internet et qui vous laissent y acc&eacute;der gratuitement. Et c'est gr&acirc;ce &agrave; eux que nous synchroniserons nos syst&egrave;mes.</p></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="ntp.arch"></a>5.2.&nbsp;Construire une architecture simple de synchronisation de l'heure</h3></div></div><div></div></div><p>Vous aurez besoin de &nbsp;:</p><div class="orderedlist"><ol type="1"><li><p>Une connexion directe ou indirecte (&agrave; travers un pare-feu) &agrave; internet.</p></li><li><p>Choisir des serveurs <span class="acronym">NTP</span>. Vous pouvez utiliser le serveur public <a href="http://www.fortytwo.ch/time/" target="_top">pool.ntp.org</a> ou en choisir dans la <a href="http://www.eecis.udel.edu/~mills/ntp/clock2a.html" target="_top">deuxi&egrave;me strate de serveurs de temps publics</a> sur le site web de <span class="acronym">NTP</span>. Si vous n'avez pas d'acc&egrave;s &agrave; internet, votre administrateur <span class="acronym">WAN</span> (ce doit &ecirc;tre un type intelligent) peut probablement vous donner des adresses internes.</p></li><li><p>Avoir le logiciel <span class="acronym">NTP</span> install&eacute; sur tous les syst&egrave;mes que vous voulez synchroniser. Vous pouvez trouver les RPM sur les c&eacute;d&eacute;roms de votre distribution Linux favorite ou <a href="http://rpmfind.net/linux/rpm2html/search.php?query=ntp" target="_top">faire une recherche</a> sur <a href="http://rpmfind.net/" target="_top">http://rpmfind.net/</a>.</p></li></ol></div><p>Voici un exemple d'une bonne architecture&nbsp;:</p><div class="figure"><a name="N10416"></a><p class="title"><b>Figure&nbsp;1.&nbsp;Serveurs relais locaux pour NTP</b></p><div class="mediaobject" align="center"><img src="images/TimePrecision-HOWTO/ntp.png" align="middle" alt="Architecture NTP"></div></div><p>
      
          Si vous avez plusieurs machines &agrave; synchroniser, <span class="emphasis"><em>ne 
          les faites pas</em></span> toutes acc&eacute;der aux serveurs 
          <span class="acronym">NTP</span> externes que vous avez choisis. Seuls 
          deux de vos serveurs doivent acc&eacute;der aux serveurs 
          <span class="acronym">NTP</span> externes. Les autres machines se 
          synchroniseront sur ces deux derni&egrave;res. Nous les appellerons 
          <span class="emphasis"><em>serveurs relais</em></span>.
      
      </p><p>
      
          Vos serveurs relais peuvent &ecirc;tre n'importe lesquelles de vos 
          machines d&eacute;j&agrave; disponibles sur votre r&eacute;seau. 
          <span class="acronym">NTP</span> consomme tr&egrave;s peu de m&eacute;moire et de 
          processeur. Vous n'avez pas besoin d'une machine d&eacute;di&eacute;e &agrave; 
          cette fonction.
      
      </p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td valign="top" align="center" rowspan="2" width="25"><img alt="[Astuce]" src="images/tip.png"></td><th align="left">Astuce</th></tr><tr><td valign="top" align="left"><p>
      
          Cr&eacute;er des alias pour les noms d'h&ocirc;tes de vos serveurs relais 
          locaux est une bonne id&eacute;e. Vous pouvez d&eacute;finir par exemple 
          ntp1.mon-domaine.fr et ntp2.mon-domaine.fr. Puis n'utilisez 
          que ces noms en configurant les machines clientes. De cette 
          fa&ccedil;on, vous pouvez d&eacute;placer la fonctionnalit&eacute; 
          <span class="acronym">NTP</span> vers un nouveau serveur relais (avec un 
          adresse IP et un nom d'h&ocirc;te diff&eacute;rents) sans avoir &agrave; 
          reconfigurer les clients. Demandez &agrave; votre administrateur 
          <span class="acronym">DNS</span> de cr&eacute;er ces alias.
      
      </p></td></tr></table></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="ntp.configs"></a>5.3.&nbsp;Configuration <span class="acronym">NTP</span></h3></div></div><div></div></div><div class="variablelist"><dl><dt><span class="term"><span class="emphasis"><em>Pour vos serveurs relais</em></span></span></dt><dd><p>&Eacute;ditez <code class="filename">/etc/ntp.conf</code> et ajoutez les serveurs distants que vous avez choisis&nbsp;:</p><div class="example"><a name="N10451"></a><p class="title"><b>Exemple&nbsp;5.&nbsp;Fichier <code class="filename">/etc/ntp.conf</code>des machines relais</b></p><pre class="programlisting">
server  ntp.cnrs.fr        # Un serveur de strate 1 de cnrs.fr
server  autre-ntp.gouv.fr  # Un serveur de strate 2 de gouv.fr
</pre></div><p>
            
                De nouveau, vous pouvez utiliser le serveur public 
                <a href="http://www.fortytwo.ch/time/" target="_top">pool.ntp.org</a> 
                ou obtenir une liste de <a href="http://www.eecis.udel.edu/~mills/ntp/clock2a.html" target="_top">serveurs 
                de temps publics</a> sur le site web de 
                <span class="acronym">NTP</span>.
                        
            </p></dd><dt><span class="term"><span class="emphasis"><em>Pour vos clients</em></span></span></dt><dd><p>&Eacute;ditez <code class="filename">/etc/ntp.conf</code> et ajoutez vos serveurs relais avec un nom standard&nbsp;:</p><div class="example"><a name="N10473"></a><p class="title"><b>Exemple&nbsp;6.&nbsp;Fichier <code class="filename">/etc/ntp.conf</code> des machines clientes</b></p><pre class="programlisting">
server  ntp1.mon-domaine.fr   # Mon premier serveur relais local
server  ntp2.mon-domaine.fr   # Mon deuxi&egrave;me serveur relais local
</pre></div></dd></dl></div><p>Si votre machine a une heure UTC diff&eacute;rente de plusieurs minutes par rapport aux serveurs <span class="acronym">NTP</span>, <span class="acronym">NTP</span> ne fonctionnera pas. Dans ce cas, vous devez d'abord faire un synchronisation compl&egrave;te. Je vous recommande de le faire en dehors des heures de production. Vous n'avez besoin de le faire que lors de l'initialisation de votre configuration <span class="acronym">NTP</span>, jamais plus apr&egrave;s&nbsp;:</p><div class="example"><a name="N10488"></a><p class="title"><b>Exemple&nbsp;7.&nbsp;Premi&egrave;re synchronisation</b></p><pre class="screen">
<code class="prompt">bash# </code><span><strong class="command">ntpdate autre-ntp.gouv.fr</strong></span>	<a name="sync1"></a><img border="0" alt="1" src="images/callouts/1.png">
24 Mar 18:16:36 ntpdate[10254]: step time server 200.100.20.10 offset -15.266188 sec
<code class="prompt">bash# </code><span><strong class="command">ntpdate autre-ntp.gouv.fr</strong></span>	<a name="sync2"></a><img border="0" alt="2" src="images/callouts/2.png">
24 Mar 18:16:43 ntpdate[10255]: adjust time server 200.100.20.10 offset -0.000267 sec
</pre><div class="calloutlist"><table summary="Callout list" border="0"><tr><td align="left" valign="top" width="5%"><a href="#sync1"><img border="0" alt="1" src="images/callouts/1.png"></a> </td><td align="left" valign="top"><p>Premi&egrave;re synchronisation compl&egrave;te. L'horloge retardait de 15 secondes.</p></td></tr><tr><td align="left" valign="top" width="5%"><a href="#sync2"><img border="0" alt="2" src="images/callouts/2.png"></a> </td><td align="left" valign="top"><p>Deuxi&egrave;me synchronisation compl&egrave;te, juste pour &ecirc;tre s&ucirc;r. Maintenant, nous ne retardons pratiquement plus, ce qui est une bonne chose.</p></td></tr></table></div></div><p>La derni&egrave;re &eacute;tape consiste &agrave; d&eacute;marrer ou &agrave; red&eacute;marrer le d&eacute;mon <span class="acronym">NTP</span> sur chaque machine&nbsp;:</p><pre class="screen"><code class="prompt">bash# </code><span><strong class="command">service ntpd restart</strong></span></pre></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="ntp.watch"></a>5.4.&nbsp;Observer votre machine se synchroniser</h3></div></div><div></div></div><p>Maintenant que tout est configur&eacute;, <span class="acronym">NTP</span> va garder l'heure de votre machine synchronis&eacute;e. Vous pouvez observer ce processus en utilisant la commande d'interrogation NTP (<span><strong class="command">ntpq</strong></span>)&nbsp;:</p><div class="example"><a name="N104C5"></a><p class="title"><b>Exemple&nbsp;8.&nbsp;Un exemple d'interrogation de l'&eacute;tat de la synchronisation temporelle</b></p><pre class="screen">
<code class="prompt">bash# </code><span><strong class="command">ntpq -p</strong></span>
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
-jj.cs.umb.edu   gandalf.sigmaso  3 u   95 1024  377   31.681  -18.549   1.572
 milo.mcs.anl.go ntp0.mcs.anl.go  2 u  818 1024  125   41.993  -15.264   1.392
-mailer1.psc.edu ntp1.usno.navy.  2 u  972 1024  377   38.206   19.589  28.028
-dr-zaius.cs.wis ben.cs.wisc.edu  2 u  502 1024  357   55.098    3.979   0.333
+taylor.cs.wisc. ben.cs.wisc.edu  2 u  454 1024  347   54.127    3.379   0.047
-ntp0.cis.strath harris.cc.strat  3 u  507 1024  377  115.274   -5.025   1.642
*clock.via.net   .GPS.            1 u  426 1024  377  107.424   -3.018   2.534
 ntp1.conectiv.c 0.0.0.0         16 u    - 1024    0    0.000    0.000 4000.00
+bonehed.lcs.mit .GPS.            1 u  984 1024  377   25.126    0.131  30.939
-world.std.com   204.34.198.40    2 u  119 1024  377   24.229   -6.884   0.421
</pre></div><div class="variablelist"><p class="title"><b>La signification de chaque colonne</b></p><dl><dt><span class="term"><span class="emphasis"><em>remote</em></span></span></dt><dd><p>Est le nom du serveur <span class="acronym">NTP</span> distant. Si vous utilisez l'option <code class="option">-n</code>, vous verrez les adresses IP de ces serveurs &agrave; la place de leurs noms.</p></dd><dt><span class="term"><span class="emphasis"><em>refid</em></span></span></dt><dd><p>Indique d'o&ugrave; chaque serveur obtient son heure. Il peut s'agir d'un nom d'h&ocirc;te ou de quelque chose comme <span class="acronym">.GPS.</span>, indiquant une source <span class="acronym">GPS</span> (Global Positioning System).</p></dd><dt><span class="term"><span class="emphasis"><em>st</em></span></span></dt><dd><p>La <span class="emphasis"><em>strate</em></span> est un nombre allant de 1 &agrave; 16 qui indique la pr&eacute;cision du serveur distant. 1 est le plus fiable, 16 signifie que le serveur n'est pas disponible. Votre strate sera &eacute;gale &agrave; celle du serveur distant le plus fiable plus 1. Ne vous connectez jamais &agrave; un serveur de la strate 1, utilisez ceux de niveau 2&nbsp;! Ces serveurs sont largement suffisants pour nos besoins, et cette politique permet de r&eacute;duire le trafic vers les serveurs de la premi&egrave;re strate.</p></dd><dt><span class="term"><span class="emphasis"><em>poll</em></span></span></dt><dd><p>L'intervalle (en secondes) entre deux requ&ecirc;tes de temps. La valeur sera comprise entre les valeurs minimales et maximales autoris&eacute;es. Initialement la valeur sera petite pour permettre une synchronisation rapide. Une fois que les horloges sont synchrones, le temps entre deux requ&ecirc;tes augmentera pour diminuer le trafic r&eacute;seau et la charge sur les serveurs de temps populaires.</p></dd><dt><span class="term"><span class="emphasis"><em>reach</em></span></span></dt><dd><p>C'est une repr&eacute;sentation en base 8 d'un tableau de 8 bits repr&eacute;sentant les 8 derni&egrave;res fois que la machine a essay&eacute; d'atteindre le serveur. Le bit est mis &agrave; 1 si le serveur distant a pu &ecirc;tre atteint.</p></dd><dt><span class="term"><span class="emphasis"><em>delay</em></span></span></dt><dd><p>Le d&eacute;lai (en secondes) n&eacute;cessaire pour recevoir une r&eacute;ponse &agrave; une demande de "quelle heure est-il&nbsp;?".</p></dd><dt><span class="term"><span class="emphasis"><em>offset</em></span></span></dt><dd><p>La valeur la plus importante. Le d&eacute;calage de temps entre le serveur local et le serveur distant. Pendant la synchronisation, le d&eacute;calage diminue, indiquant que l'horloge locale devient plus pr&eacute;cise.</p></dd><dt><span class="term"><span class="emphasis"><em>jitter</em></span></span></dt><dd><p>Cette colonne indique la dispersion, qui est une mesure de la variance statistique du d&eacute;calage pendant plusieurs paires de requ&ecirc;te/r&eacute;ponse successives. Des valeurs faibles de la dispersion sont meilleures que des valeurs &eacute;lev&eacute;es. Plus elles sont faibles, plus la synchronisation temporelle sera pr&eacute;cise.</p></dd></dl></div><div class="variablelist"><p class="title"><b>Signification des signes devant les noms de serveur</b></p><dl><dt><span class="term"><span class="emphasis"><em>-</em></span></span></dt><dd><p>Signifie que le service NTP local n'aime pas beaucoup ce serveur</p></dd><dt><span class="term"><span class="emphasis"><em>+</em></span></span></dt><dd><p>Signifie que le service NTP local aime ce serveur</p></dd><dt><span class="term"><span class="emphasis"><em>x</em></span></span></dt><dd><p>Marque un mauvais serveur</p></dd><dt><span class="term"><span class="emphasis"><em>*</em></span></span></dt><dd><p>Indique le serveur pr&eacute;f&eacute;r&eacute; actuel</p></dd></dl></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="ntp.boot"></a>5.5.&nbsp;Lancer automatiquement <span class="acronym">NTP</span> au d&eacute;marrage</h3></div></div><div></div></div><p>Si vous voulez toujours avoir le service <span class="acronym">NTP</span> sur votre machine m&ecirc;me si vous la red&eacute;marrez, faites ceci sur chaque machine&nbsp;:</p><pre class="screen"><code class="prompt">bash# </code><span><strong class="command">chkconfig --level 2345 ntpd on</strong></span></pre><p>Cela garantira un d&eacute;marrage automatique.</p><p>Si votre machine fonctionne longtemps sans red&eacute;marrage (des mois ou des ann&eacute;es), vous remarquerez une importante diff&eacute;rence entre la tr&egrave;s impr&eacute;cise horloge mat&eacute;rielle et l'heure syst&egrave;me (maintenant tr&egrave;s pr&eacute;cise). Les distributions Linux modernes copient l'heure syst&egrave;me dans l'horloge mat&eacute;rielle chaque fois que le syst&egrave;me est arr&ecirc;t&eacute; en utilisant un <a href="#set.hwclock" title="4.2.&nbsp;R&eacute;gler l'horloge mat&eacute;rielle">m&eacute;canisme similaire &agrave; la commande <span><strong class="command">setclock</strong></span></a>. De cette fa&ccedil;on, au d&eacute;marrage suivant, vous obtiendrez une date et une heure presque aussi pr&eacute;cises que ce qu'elles &eacute;taient lors de l'arr&ecirc;t de votre ordinateur.</p></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ntp.chrony"></a>6.&nbsp;Une horloge pr&eacute;cise avec le programme <span><strong class="command">chrony</strong></span></h2></div></div><div></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="ntp.chrony.diff"></a>6.1.&nbsp;En quoi <span><strong class="command">chrony</strong></span> diff&egrave;re de <span><strong class="command">ntp</strong></span>&nbsp;?</h3></div></div><div></div></div><p><span><strong class="command">Chrony</strong></span> utilise aussi le protocole <span class="acronym">NTP</span> et est aussi con&ccedil;u pour rendre l'horloge de Linux plus fiable. Il est aussi adapt&eacute; &agrave; des syst&egrave;mes qui n'ont pas de connexion internet. La source d'heure exacte peut donc &ecirc;tre n'importe quelle horloge pr&eacute;cise &agrave; partir de laquelle on puisse lire l'heure et la transmettre au programme. De plus, il est &eacute;galement capable d'estimer la d&eacute;rive de l'horloge mat&eacute;rielle et, en se basant sur celle-ci, d'ajuster l'horloge mat&eacute;rielle au d&eacute;marrage de l'ordinateur.</p><p>La version 1.20 de <span><strong class="command">chrony</strong></span> ne supporte pas encore les horloges internes de type GPS ou les r&eacute;cepteurs radio DCF, mais la structure du programme rend de telles extensions possibles.</p></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="ntp.chrony.how"></a>6.2.&nbsp;Comment utiliser <span><strong class="command">chrony</strong></span>&nbsp;?</h3></div></div><div></div></div><p><span><strong class="command">Chrony</strong></span> est constitu&eacute; de deux parties&nbsp;: le d&eacute;mon <span><strong class="command">chronyd</strong></span> et l'interface utilisateur<span><strong class="command">chronyc</strong></span>.</p><p>Vous pouvez trouver <span><strong class="command">chrony</strong></span> sur <a href="http://chrony.sunsite.dk/index.php/" target="_top">chrony.sunsite.dk/index.php</a></p></div></div><div class="appendix" lang="fr"><h2 class="title" style="clear: both"><a name="about"></a>A.&nbsp;&Agrave; propos de ce document</h2><p>Copyright 2002, 2003, 2004 Avi Alkalay.</p><p>Copyright 2004, 2005 Philippe Wautelet et copyright 2005 Rapha&euml;l Semeteys pour la traduction fran&ccedil;aise.</p><p><span class="foreignphrase" lang="en"><em class="foreignphrase">
    
        This document must be distributed under the terms of <a href=" http://www.gnu.org/copyleft/fdl.html" target="_top">GNU Free 
        Documentation License</a>. Please translate, adapt, improve, 
        redistrubute using the original XML DocBook source right bellow. 
        Let me know if you want me to put a link to your 
        translation/adaptation/improvement here.
    
    </em></span></p><p>
    
        Ce document doit &ecirc;tre distribu&eacute; sous les termes de la <a href="http://www.gnu.org/copyleft/fdl.html" target="_top"> licence de 
        documentation libre GNU (GFDL)</a>. Traduisez, adaptez, 
        am&eacute;liorez ou redistribuez SVP en utilisant le fichier source 
        original ci-dessous au format XML DocBook. Faites-moi savoir si 
        vous voulez que j'ajoute un lien ici vers votre version 
        traduite, adapt&eacute;e ou am&eacute;lior&eacute;e.
        
    </p><p>
    
        Ce document est disponible aux endroits suivants&nbsp;:
    
    </p><div class="itemizedlist"><ul type="disc"><li><p>
    
            <a href="http://avi.alkalay.net/linux/docs/TimePrecision/" target="_top">Site 
            officiel de la version originale</a> [<a href="http://avi.alkalay.net/linux/docs/TimePrecision/timeprecision.tar.gz" target="_top">Code 
            source XML DocBook</a>]&nbsp;;
    
        </p></li><li><p>
        
            <a href="http://en.tldp.org/HOWTO/TimePrecision-HOWTO/" target="_top">LinuxDoc, en 
            tant que guide pratique (version anglaise)</a> [<a href="http://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/html_single/TimePrecision-HOWTO.html" target="_top">une 
            seule page</a>] [<a href="http://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/pdf/TimePrecision-HOWTO.pdf" target="_top">PDF</a>]&nbsp;;
        
        </p></li><li><p>
        
            Takeo Nakano
            
            <code class="email">&lt;<a href="mailto:nakano CHEZ apm POINT seikei POINT ac POINT jp">nakano CHEZ apm POINT seikei POINT ac POINT jp</a>&gt;</code>
            
            <a href="http://www.linux.or.jp/JF/JFdocs/TimePrecision-HOWTO/" target="_top">traduction 
            japonaise</a> [<a href="http://www.linux.or.jp/JF/JFdocs/TimePrecision-HOWTO.txt" target="_top">version 
            texte</a>]&nbsp;;
            
        </p></li><li><p>
        
            SHAKI <code class="email">&lt;<a href="mailto:sha-ki CHEZ narod POINT ru">sha-ki CHEZ narod POINT ru</a>&gt;</code> <a href="http://computerlib.narod.ru/html/linuxtime.htm" target="_top">traduction 
            russe</a>&nbsp;;
            
        </p></li><li><p>

            Mihaly Gyulai &lt;gyulai CHEZ fbi POINT hu&gt; <a href="http://tldp.fsf.hu/HOWTO/TimePrecision-HOWTO-hu/index.html" target="_top">traduction 
            hongroise</a>&nbsp;;
            
        </p></li><li><p>
        
            <a href="http://www.traduc.org/docs/howto/lecture/TimePrecision-HOWTO.html" target="_top">Derni&egrave;re 
            version fran&ccedil;aise de ce document</a> [<a href="http://www.traduc.org/cgi-bin/viewcvs.cgi/guides_pratiques/TimePrecision-HOWTO.xml" target="_top">Code source XML 
            DocBook</a>].

        </p></li></ul></div></div></div></body></html>