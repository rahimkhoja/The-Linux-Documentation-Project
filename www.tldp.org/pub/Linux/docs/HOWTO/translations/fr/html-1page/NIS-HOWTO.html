<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.21">
 <TITLE>Le Linux NIS(YP)/NYS/NIS+ HOWTO</TITLE>
</HEAD>
<BODY>
<H1>Le Linux NIS(YP)/NYS/NIS+ HOWTO</H1>

<H2>Thorsten Kukuk</H2>Version 0.12, 12 Juin 1998
<HR>
<EM>Ce document décrit la façon de configurer Linux en client de NIS(YP)
ou de NIS+, et la façon d'installer un serveur NIS.</EM>
<HR>
<H2><A NAME="s1">1. Version française</A></H2>


<P>Ce document constitue la version française du NIS-HOWTO,
adaptation réalisée par Frédéric Veynachter 
(frederic.veynachter@hol.fr), le 26 juillet 1998, fortement inspirée
de la traduction précédemment réalisée par Éric Dumas (dumas@Linux.EU.Org), 
le 19 Novembre 1997.</P>
<P>Vous pouvez consulter ce document sur les sites suivants :
<UL>
<LI> 
<A HREF="http://www.freenix.fr/linux/HOWTO/">http://www.freenix.fr/linux/HOWTO</A> </LI>
<LI> 
<A HREF="ftp://ftp.lip6.fr/pub/linux/french/docs/HOWTO/">ftp://ftp.lip6.fr/pub/linux/french/docs/HOWTO</A></LI>
</UL>

ainsi que leurs nombreux miroirs.</P>
<P>Pour plus de renseignements concernant la traduction en langue française
des documents du LDP (<EM>Linux Documentation Project</EM>), consultez
le document "Liste-des-HOWTO" que l'on trouve aux mêmex endroits.</P>
<P>Les différents sites conseillés dans  ce document possèdent
sûrement des miroirs plus proches de chez vous, comme par exemple
ftp.lip6.fr, ftp.loria.fr ... utilisez-les !</P>

<H2><A NAME="s2">2. Introduction</A></H2>

<P>Les machines sous Linux sont de plus en plus souvent installées et connectées
dans des réseaux informatiques.Pour simplifier l'administration système,
la plupart des réseaux (surtout ceux qui sont fondés sur du matériel Sun)
fonctionnent avec le <EM>Network Information Service</EM>. Les machines Linux peuvent
tirer de nombreux avantages des services NIS existant, ou fournir elles-mêmes ces
services. Elles peuvent également se comporter comme des clients NIS+, mais il 
s'agit encore d'une version béta.</P>
<P>Ce document tente de répondre aux questions concernant la mise en place et la
configuration de NIS(YP) et de NIS+ sur votre machine Linux. N'oubliez pas de lire
la section concernant 
<A HREF="#portmapper">le Portmapper RPC</A>.</P>
<P>Le NIS-Howto est rédigé et maintenu par:</P>
<P>
<BLOCKQUOTE>
Thorsten Kukuk, <CODE>kukuk@vt.uni-paderborn.de</CODE>
</BLOCKQUOTE>
</P>
<P>La version initiale de ce document a été réalisée par:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
Andrea Dell'Amico       &lt;adellam@ZIA.ms.it>
Mitchum DSouza          &lt;Mitch.DSouza@NetComm.IE>
Erwin Embsen            &lt;erwin@nioz.nl>
Peter Eriksson          &lt;peter@ifm.liu.se>
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>que nous tenons à remercier.</P>

<H2><A NAME="ss2.1">2.1 Nouvelles versions de ce document</A>
</H2>

<P>Vous pourrez toujours trouver la dernière version de ce document sur le web
via l'URL 
<A HREF="http://sunsite.unc.edu/mdw/HOWTO/NIS-HOWTO.html">http://sunsite.unc.edu/mdw/HOWTO/NIS-HOWTO.html</A>.</P>
<P>Les nouvelles versions de ce document seront également présentes sur différents
sites ftp et web consacrés à Linux, y compris sur la page principale du LDP 
(Linux Documentation Project).</P>
<P>Des liens vers les traductions de ce document peuvent être trouvés à l'adresse
<A HREF="http://www-vt.uni-paderborn.de/~kukuk/linux/nis-howto.html">http://www-vt.uni-paderborn.de/~kukuk/linux/nis-howto.html</A>.</P>

<H2><A NAME="ss2.2">2.2 Avertissement</A>
</H2>

<P>Même si ce document rassemble le maximum de données selon notre connaissance,
il peut contenir, et contient sans doute, certaines erreurs. Nous vous demandons de
lire attentivement tous les fichiers README qui sont livrés avec les outils décrits 
dans ce document, pour avoir plus de détails et une information plus précise.
Nous essayerons, dans la mesure du possible, d'éviter que des erreurs se glissent 
ans ce document.</P>

<H2><A NAME="ss2.3">2.3 Retour d'information et corrections</A>
</H2>

<P>Si vous avez des questions ou des commentaires à propos de ce document, n'hésitez 
pas à envoyer un courrier électronique à 
<A HREF="mailto:kukuk@vt.uni-paderborn.de">kukuk@vt.uni-paderborn.de</A>.
J'accepte volontiers toutes les suggestions ou critiques. Si vous trouvez une anomalie
ou une erreur dans ce document, merci de me le faire savoir, pour que je puisse la 
corriger dans la prochaine version.</P>
<P>Merci de ne pas m'envoyer de questions concernant des problèmes spécifiques à
une distribution de Linux. Je ne les connais pas toutes. J'essayerai néanmoins
d'intégrer toute solution qui me sera envoyée.</P>

<H2><A NAME="ss2.4">2.4 Remerciements</A>
</H2>

<P>Nous voudrions remercier toutes les personnes qui ont contribué 
(directement ou indirectement) à ce document. Par ordre alphabétique :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
Byron A Jeff            &lt;byron@cc.gatech.edu>
Miquel van Smoorenburg  &lt;miquels@cistron.nl>
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Theo de Raadt &lt;deraadt@theos.com> est à l'origine du code yp-clients. 
Swen Thuemmler &lt;swen@uni-paderborn.de> a porté ce code pour Linux et il a
également porté le code yp-routines pour la libc (toujours fondé sur le
travail de Theo). Thorsten Kukuk a totalement ré-écrit toutes les routines
NIS(YP) et NIS+ pour la GNU libc 2.x.</P>

<H2><A NAME="s3">3. Glossaire et informations générales</A></H2>

<H2><A NAME="ss3.1">3.1 Glossaire des termes employés</A>
</H2>

<P>Dans ce document, bon nombre d'acronymes sont employés. Voici la liste des plus
utilisés, avec une brève explication.</P>
<P>
<DL>
<DT><B>DBM</B><DD><P>DataBase Management (Gestion de la base de données): bibliothèque de fonctions
pour maintenir les clefs et le contenu de la base de données.</P>

<DT><B>DLL</B><DD><P>Dynamically Linked Library (Bibliothèque liée dynamiquement): bibliothèque 
de fonctions chargées dynamiquement à l'exécution.</P>

<DT><B>domainname</B><DD><P>Nom du domaine : nom "clef" utilisé par
les clients NIS pour qu'ils puissent trouver un serveur NIS convenable qui gère
la clef du domaine. Notez que cela n'a rien à voir avec le "domaine" DNS 
(nom de la machine) des machines.</P>

<DT><B>FTP</B><DD><P>File Transfer Protocol  (Protocole de transfert de fichiers) : 
protocole utilisé pour transférer des fichiers entre deux 
ordinateurs.</P>

<DT><B>libnsl</B><DD><P>Name services library  : bibliothèque 
d'appels systèmes (tels que <CODE>getpwnam, getservbyname, ...</CODE>)
sur les systèmes Unix SVR4. La GNU libc utilise cette bibliothèque
pour les fonctions NIS (YP) et NIS+.</P>

<DT><B>libsocket</B><DD><P>Bibliothèque de fonctions de manipulation de sockets
<CODE>socket, bind, listen, ...</CODE> sur les systèmes SVR4.</P>

<DT><B>NIS</B><DD><P>Network Information Service (Service d'information du réseau): 
service qui permet à certaines informations d'être connues par toutes les
machines disponibles sur le réseau. Ce service est géré dans la bibliothèque
standard de la libc Linux. Il est considéré par la suite comme étant le
"NIS traditionnel".</P>

<DT><B>NIS+</B><DD><P>Network Information Service (Plus...)   :
en gros, version de NIS améliorée. NIS+ a été conçu par Sun Microsystems Inc. 
pour remplacer NIS, avec un niveau de sécurité supérieur et une meilleure
gestion pour les grosses installations.</P>

<DT><B>NYS</B><DD><P>Il s'agit du nom d'un projet de développement et de standardisation
pour NIS+, YP et Switch. 
Il est dirigé par Peter Eriksson (&lt;peter@ifm.liu.se&gt;).
Il contient entre autres choses une réimplémentation complète
du code de NIS (c'est-à-dire YP) qui utilise
les fonctionnalités <EM> Name Services Switch</EM> de 
la bibliothèque NYS.</P>

<DT><B>NSS</B><DD><P>Name Service Switch (littéralement, commutation des noms de service): le fichier 
/etc/nsswitch.conf détermine l'ordre de recherche d'informations en fonction 
des services demandés.</P>

<DT><B>RPC</B><DD><P>Remote Procedure Call (Appel de procédure distante): les routines RPC 
permettent aux programmes C d'appeler d'autres machines à travers le réseau.
Lorsque des personnes parlent de RPC, elles parlent souvent en fait
de la version Sun RPC.</P>

<DT><B>YP</B><DD><P>Yellow Pages(tm)  : marque déposée par 
British Telecom. (les pages jaunes... comme les nôtres !).</P>

<DT><B>TCP-IP</B><DD><P>Transmission Control Protocol/Internet Protocol :
protocole de communication le plus fréquemment
utilisé sur les machines Unix.</P>
</DL>
</P>

<H2><A NAME="ss3.2">3.2 Quelques informations générales</A>
</H2>

<P>Les quatre lignes ci-dessous sont une citation du manuel d'administration réseau de
Sun&trade; System.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
    "NIS was formerly known as Sun Yellow Pages (YP) but
     the name Yellow Pages(tm) is a registered trademark
     in the United Kingdom of British Telecom plc and may
     not be used without permission."

    "NIS etait formellement connu sous le nom de 
     Yellow Pages (YP) (Pages Jaunes) mais le nom 
     Yellow Pages(tm) est une marque enregistree au 
     Royaume Uni par British Telecom et ne peut etre 
     utilisee sans autorisation."
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>NIS est l'abréviation pour <EM>Network Information Service</EM> (Service d'Information Réseau).
Son but est de fournir des informations, qui doivent être connues sur l'ensemble du réseau,
à toutes les machines connectées. Les informations susceptibles d'être distribuées
par NIS sont:</P>
<P>
<UL>
<LI>noms de login, mots de passe, répertoires d'ouverture (/etc/passwd)</LI>
<LI>renseignements sur les groupes d'utilisateurs (/etc/group)</LI>
</UL>
</P>
<P>Par exemple, si votre mot de passe et les informations s'y rattachant sont enregistrés dans la
base de données NIS, vous pourrez vous loguer sur toutes les machines du réseau sur 
lesquelles un client NIS est lancé.</P>
<P>Sun est une marque déposée de Sun Microsystems Inc, brevetée par SunSoft, Inc.</P>


<H2><A NAME="s4">4. NIS ou NIS+ ?</A></H2>

<P>Le choix entre NIS et NIS+ est facile à faire : utilisez NIS tant que vous n'avez pas besoin
d'utiliser NIS+ ou si vous avez des besoins de sécurité importants. NIS+ est bien plus 
problématique à administrer (c'est plutôt facile à manipuler du côté du client,
mais en ce qui concerne le côté serveur, c'est une horreur). Un autre problème est que le
support de NIS+ pour Linux est encore en cours de développement : vous devrez avoir la toute
dernière version de glibc ou attendre la sortie de glibc 2.1. Il existe un portage du NIS+
glibc pour libc5, qui consiste à installer une libc de remplacement.</P>

<H2><A NAME="ss4.1">4.1 libc 4/5 avec "NIS traditionnel" ou NYS ?</A>
</H2>

<P>Le choix entre "NIS traditionnel" ou le code NIS dans la bibliothèque NYS est un choix entre
paresse et maturité d'un côté, flexibilité et amour de l'aventure de l'autre.</P>
<P>Le code "NIS traditionnel" se trouve dans la bibliothèque C standard, existe depuis fort longtemps,
et souffre parfois de son age et de son léger manque de souplesse.</P>
<P>Le code NIS de la bibliothèque NYS vous oblige à recompiler la bibliothèque libc pour y
inclure le code NYS (à moins que vous ne trouviez une version de libc précompilée
chez quelqu'un qui l'a déjà fait).</P>
<P>Une autre différence est que le code "NIS traditionnel" gère en partie les groupes de
réseaux NIS (<EM>Netgroups</EM>), alors que le code NYS ne le fait pas. D'un autre côté,
le code NYS vous permet d'utiliser les mots de passe Shadow d'une manière transparente.
Le code "NIS traditionnel" ne permet pas d'utiliser les mots de passe Shadow sur NIS.</P>
<P>Vous pouvez cependant oublier tout ça si vous utilisez la nouvelle bibliothèque GNU C 2.x
(alias libc6). Elle comporte un vrai support de NSS (<EM>Name Switch Service</EM>), ce qui la 
rend vraiment souple, et elle est capable de gérer les "maps" NIS/NIS+ suivantes : aliases, 
ethers, group, hosts, netgroups, networks, protocols, publickey, passwd, rpc, services
et shadow. La bibliothèque GNU C ne pose aucun problème avec les mots de passe Shadow sur NIS.</P>

<H2><A NAME="s5">5. Comment ça marche ?</A></H2>

<H2><A NAME="ss5.1">5.1 Comment fonctionne NIS(YP) ?</A>
</H2>

<P>A l'intérieur d'un réseau, il doit y avoir au moins une machine
faisant office de serveur NIS. Vous pouvez avoir plusieurs serveurs
NIS, chacun gérant plusieurs "domaines" NIS, ou bien vous
pouvez avoir des serveurs NIS coopératifs. Dans ce cas, l'un d'entre eux est dit
serveur NIS <EM>maître</EM>, les autres étant serveurs
NIS esclaves. Vous pouvez également mélanger les deux possibilités.</P>
<P>Les serveurs esclaves n'ont qu'une copie de la base de données et la
reçoivent du serveur NIS maître lorsque des changement sont effectués
dans la base de données. En fonction du nombre de machine et de la
fiabilité de votre réseau, vous pouvez décider d'installer un ou
plusieurs serveurs esclaves. Lorsqu'un serveur NIS tombe en panne ou
bien s'il est trop long pour répondre aux requêtes, un client NIS
connecté à ce serveur va alors essayer d'en trouver un en état de
marche.</P>
<P>Les bases de données NIS sont au format DBM, un dérivé des bases de données
ASCII. Par exemple, les fichiers <CODE>/etc/passwd</CODE> et <CODE>/etc/group</CODE>  
peuvent être directement convertis dans le format DBM en utilisant un 
programme de conversion <EM>ASCII-to-DBM</EM> (<CODE>makedbm</CODE> est 
inclus dans les programmes du serveur). Le serveur NIS maître devrait 
avoir les deux types : la base ASCII et la base DBM.</P>
<P>Les serveurs esclaves seront avertis de tout changement dans les tables
NIS (grâce au programme <CODE>yppush</CODE>), et effectueront automatiquement les changements
nécessaires pour synchroniser leurs bases de données. Les clients NIS n'ont
pas besoin d'effectuer cette opération puisqu'ils communiquent 
tout le temps avec le serveur NIS pour lire les informations rangées 
dans les bases de données DBM.</P>
<P>L'auteur des clients YP pour Linux nous a informé que la nouvelle
version de <CODE>ypbind</CODE> (située dans l'archive <CODE>ypbind-3.3.tar.gz</CODE>)
permet d'indiquer le serveur NIS à contacter dans un fichier de configuration,
ce qui évite d'effectuer un <EM>broadcast</EM> (ce qui n'est pas
sécurisé car n'importe qui peut installer un serveur NIS et peut donc
répondre aux requêtes...).</P>

<H2><A NAME="ss5.2">5.2 Comment fonctionne NIS+ ?</A>
</H2>

<P>NIS+ est une nouvelle version du service d'information réseau
de Sun. La différence la plus notable entre NIS et NIS+ est
que NIS+ est capable de gérer des données chiffrées ainsi que
l'authentification <EM>via</EM> les RPC sécurisés.</P>
<P>Le modèle de nommage de NIS+ est basé sur une structure 
arborescente. Chaque noeud de l'arbre correspond à un objet NIS+, à
partir duquel nous avons six types :
directory, entry, group, link, table et private (répertoire,
entrée, groupe, lien, table et privé).</P>
<P>Le répertoire NIS+ qui constitue la racine de l'espace de nommage
NIS+ est appelé le répertoire racine. Il existe deux répertoires
spéciaux NIS+ : org_dir et groups_dir. Le premier regroupe toutes
les tables d'administration, telles que passwd, hosts, et mail_aliases.
Le second répertoire contient les objets groupe NIS+ qui sont utilisés
pour contrôler les accès. L'ensemble des répertoires org_dir, groups_dir 
et leurs parents sont considérés comme étant un domaine NIS+.</P>

<H2><A NAME="portmapper"></A> <A NAME="s6">6. Le RPC Portmapper</A></H2>

<P>Pour lancer n'importe lequel des programmes mentionnés ci-dessous, vous
aurez besoin de lancer le programme <CODE>/usr/sbin/rpc.portmap</CODE>.
Certaines distributions de <B>Linux</B> ont déjà dans le code
du script <CODE>/etc/rc.d/rc.inet2</CODE>  ce qui est nécessaire pour lancer
ce démon.  Tout ce que vous avez à faire, c'est de décommenter ce qui
est nécessaire puis à rebooter votre machine pour l'activer.
Lisez la documentation de votre distribution pour plus de détails.</P>
<P>Le RPC portmapper (portmap(8)) est un serveur qui convertit les
numéros des programmes RPC en numéros de ports pour le protocole
TCP/IP (ou UDP/IP). Il doit être lancé dans un certain ordre pour 
réaliser les appels RPC (ce que fait le programme client NIS/NIS+)
vers les serveurs (comme par exemple un serveur NIS/NIS+) sur cette machine.
Lorsque le serveur RPC est lancé, il va indiquer au démon <CODE>portmap</CODE>
quel numéro de port il scrute, et quels sont les numéros de programmes RPC
avec lesquels il est prêt à travailler. Lorsque le client souhaite réaliser
un appel RPC à certain numéro de programme, il contacte dans un premier 
temps <CODE>portmap</CODE> sur le serveur de la machine pour déterminer le 
numéro de port où il doit alors envoyer les paquets RPC.</P>
<P>En principe, les serveurs RPC standards sont lancés par <CODE>inetd</CODE> 
(manuel inetd(8)), donc <CODE>portmap</CODE> doit être lancé avant 
qu'<CODE>inetd</CODE> ne le soit.</P>
<P>Pour les RPC sécurisés, le portmapper a besoin des services 
d'horloge. Assurez-vous qu'ils sont activés dans le fichier 
<CODE>/etc/inetd.conf</CODE> sur toutes les machines :
<BLOCKQUOTE><CODE>
<PRE>
#
# Time service is used for clock syncronization.
#
time    stream  tcp     nowait  root    internal
time    dgram   udp     wait    root    internal
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>IMPORTANT : n'oubliez pas de relancer inetd après toute modification de ce fichier !</P>

<H2><A NAME="s7">7. De quoi avez-vous besoin pour configurer NIS ?</A></H2>



<H2><A NAME="ss7.1">7.1 Déterminez si vous êtes un serveur, un esclave ou un client</A>
</H2>

<P>Pour répondre à cette question, nous pouvons considérer deux cas :
<OL>
<LI>votre machine va être insérée dans un réseau avec des serveurs NIS déjà
existants&nbsp;;</LI>
<LI>vous n'avez pas encore de serveur NIS dans votre réseau.</LI>
</OL>
</P>
<P>Dans le premier cas, vous n'aurez besoin que des programmes clients
(<CODE>ypbind, ypwhich, ypcat, yppoll, ypmatch</CODE>). Le programme le plus
important est <CODE>ypbind</CODE>. Ce démon doit toujours être lancé,
c'est-à-dire qu'il doit toujours apparaître dans la liste des processus.
Comme c'est un démon, il doit être lancé au démarrage de votre machine
dans le fichier de démarrage (<CODE>/etc/rc.local, /etc/init.d/nis, /etc/rc.d/init.d/ypbind</CODE>). 
Dès que <CODE>ypbind</CODE> fonctionne, votre système devient un client NIS.</P>
<P>Dans le second cas, vous n'avez pas de serveur NIS, donc vous aurez 
également besoin d'un programme serveur NIS (généralement <CODE>ypserv</CODE>).
La section 10 (<EM> 10 Configurer un serveur NIS </EM>) décrit comment configurer un serveur 
NIS sur votre machine Linux en utilisant la version <CODE>ypserv</CODE> implémentée par 
Peter Eriksson et Thorsten Kukuk. On peut remarquer
qu'à partir de la version 0.14 de cette implémentation, le concept
de maître-esclave dont nous avons parlé dans la section 5.1 est géré.</P>
<P>Il existe également un autre serveur NIS en libre distribution, appelé <CODE>yps</CODE>,
écrit par Tobias Reber en Allemagne, et qui gére le concept de maître-esclave mais qui
a d'autres limitations et qui n'est plus maintenu.</P>

<H2><A NAME="ss7.2">7.2 Les programmes</A>
</H2>

<P>La bibliothèque <CODE>/usr/lib/libc.a</CODE> (version 4.4.2 et 
supérieure) ou la bibliothèque dynamique partagée <CODE>/lib/libc.so.x</CODE> 
contient tous les appels systèmes correspondants
pour compiler sans problème les programmes clients et serveurs NIS.
Pour la glibc 2.x, vous aurez également besoin de <CODE>/lib/libnsl.so.1</CODE>.</P>
<P>Certaines personnes ont signalé que NIS ne fonctionne qu'avec 
<CODE>/usr/lib/libc.a</CODE> version 4.5.21 et supérieure, donc, pour plus de sûreté, 
évitez d'utiliser des bibliothèques plus anciennes.
Les clients NIS peuvent être récupérés sur les sites suivants :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  Site                   Repertoire                      Nom du fichier

  ftp.kernel.org        /pub/linux/utils/net/NIS         yp-tools-2.0.tar.gz
  ftp.kernel.org        /pub/linux/utils/net/NIS         ypbind-mt-1.2.tar.gz
  ftp.kernel.org        /pub/linux/utils/net/NIS         ypbind-3.3.tar.gz
  sunsite.unc.edu       /pub/Linux/system/Network/admin  yp-clients-2.2.tar.gz
  ftp.uni-paderborn.de  /linux/local/yp                  yp-clients-2.2.tar.gz
  ftp.uni-paderborn.de  /linux/local/yp                  ypbind-3.3.tar.gz
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Une fois que vous aurez récupéré ces programmes, suivez les instructions
qui sont livrées avec. <CODE>yp-clients 2.2</CODE> doit être utilisé avec les bibliothèques
<CODE>libc4</CODE> et <CODE>libc5</CODE> jusqu'à la version 5.4.20. Les <CODE>libc 5.4.21</CODE> et 
<CODE>glibc 2.x</CODE> nécessitent <CODE>yp-tools 1.4.1</CODE>. La nouvelle version 
<CODE>yp-tools 2.0</CODE> fonctionnera avec toutes les libc Linux. Vous ne devriez pas utiliser les 
<CODE>libc 5.4.21 - 5.4.35</CODE> car elles présentent de nombreux défauts. Utilisez la 
<CODE>libc 5.4.36</CODE> ou une version supérieure, sinon, la plupart des programmes de YP
ne fonctionneront pas. <CODE>ypbind 3.3</CODE> fonctionnera également avec toutes les 
bibliothèques. Vous ne devriez jamais utiliser la version <CODE>ypbind</CODE> qui est fournie
dans <CODE>yp-clients 2.2</CODE>.</P>

<H2><A NAME="ss7.3">7.3 Le démon ypbind</A>
</H2>


<P>Nous supposons que vous avez compilé correctement les programmes et que 
vous êtes prêt à les installer. L'endroit où installer le démon 
<CODE>ypbind</CODE> est le répertoire <CODE>/usr/sbin</CODE>. Certains
peuvent vous dire que vous n'avez pas besoin de <CODE>ypbind</CODE> sur
un système qui utilise NYS. C'est faux : <CODE>ypwhich</CODE> et <CODE>ypcat</CODE> en ont
besoin.</P>
<P>Vous  devez réaliser cette opération en tant que super-utilisateur (i.e. "root"), bien sûr. 
Les autres binaires (<CODE>ypwhich, ypcat, yppoll, ypmatch</CODE>) doivent être
placés dans un répertoire accessible à tous les utilisateurs, 
normalement c'est le répertoire <CODE>/usr/bin</CODE> qui est utilisé.</P>
<P>Le programme ypbind a besoin d'un fichier de configuration
<CODE>/etc/yp.conf</CODE>. Vous pouvez y indiquer, en dur, le nom du serveur NIS.
Pour plus d'informations, consultez la page de manuel de <CODE>ypbind(8)</CODE>. 
Vous aurez également besoin de ce ficher pour NYS. 
Un court exemple :
<BLOCKQUOTE><CODE>
<PRE>
  ypserver voyager
  ypserver ds9
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Si le système est capable de résoudre les noms de machine sans NIS,
vous pouvez utiliser le nom de la machine. Dans le cas contraire, 
utilisez l'adresse IP.</P>
<P>Il est souhaitable de tester ypbind avant de l'inclure dans 
les fichiers de <CODE>/etc/rc.d/</CODE>. Pour tester <CODE>ypbind</CODE> faites ceci :
<UL>
<LI>Vérifiez que votre nom de domaine est défini. Si ce n'est pas le cas, 
faites  

<BLOCKQUOTE><CODE>
<PRE>
            /bin/domainname-yp nis.domain
        
</PRE>
</CODE></BLOCKQUOTE>


où <CODE>nis.domain</CODE> doit être une chaîne, qui n'a normalement RIEN A 
VOIR avec le nom de votre machine ! La raison est que cela rend plus
difficile le travail des pirates pour trouver les mots de passe de 
la base de données du serveurs NIS. Si vous ne connaissez pas le nom
du domaine de votre réseau, contactez votre administrateur système.
</LI>
<LI>Lancez <CODE>/usr/sbin/rpc.portmap</CODE> s'il ne tourne pas déjà.
</LI>
<LI>Créez le répertoire <CODE>/var/yp</CODE> s'il n'existe pas.
</LI>
<LI>Lancez <CODE>/usr/sbin/ypbind</CODE>
</LI>
<LI>Utilisez la commande <CODE>rpcinfo -p localhost</CODE> pour 
vérifier qu'<CODE>ypbind</CODE> est capable d'enregistrer ses services
dans portmapper. La commande <CODE>rpcinfo</CODE> devrait produire 
un message de ce style : 
<BLOCKQUOTE><CODE>
<PRE>
       program vers proto   port
        100000    2   tcp    111  portmapper
        100000    2   udp    111  portmapper
        100007    2   udp    637  ypbind
        100007    2   tcp    639  ypbind
        300019    1   udp    660
      
</PRE>
</CODE></BLOCKQUOTE>

</LI>
<LI>Vous pouvez également lancer <CODE>rpcinfo -u localhost ypbind</CODE>. 
Cette commande devrait alors produire :

<BLOCKQUOTE><CODE>
<PRE>
        program 100007 version 2 ready and waiting
      
</PRE>
</CODE></BLOCKQUOTE>
</LI>
</UL>
</P>
<P>Vous devriez alors être capable d'utiliser les programmes clients tels 
que <CODE>ypcat</CODE>, etc. Par exemple, <CODE>ypcat passwd</CODE> vous 
donne la liste des mots de passe (chiffrés !) de la base de données
NIS.</P>
<P>IMPORTANT : si vous avez évité la procédure de test, vérifiez que vous
avez positionné le nom de votre domaine, et créé le répertoire :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
    /var/yp
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Ce répertoire DOIT exister pour qu'<CODE>ypbind</CODE> soit correctement lancé.</P>
<P>Pour vérifier que le nom de domaine est correctement configurer, utilisez le
programme <CODE>/bin/ypdomainname</CODE>, fourni avec yp-tools 2.0. Il utilise la
fonction <EM>yp_get_default_domain</EM>, qui est plus restrictive. Elle n'autorise pas,
par exemple, le nom de domaine "(none)", qui est celui par défaut avec Linux
et qui crée de nombreux problèmes.</P>
<P>Si le test a fonctionné, vous pouvez alors modifier les fichiers
<CODE>/etc/rc.d</CODE> sur votre système pour qu'<CODE>ypbind</CODE> soit
lancé lors de l'amorçage de la machine et pour que votre machine se
comporte comme un client NIS. Assurez-vous que le nom de domaine soit
configuré lors de l'amorçage.</P>
<P>Normalement, tout est prêt. Relancez votre machine et observez les
messages pour voir si ypbind est lancé.</P>

<H2><A NAME="ss7.4">7.4 Configurer un client NIS en utilisant le NIS traditionnel</A>
</H2>


<P>Pour la recherche de noms de machines, vous devez ajouter "nis"
dans la ligne "host" du fichier <CODE>/etc/host.conf</CODE>. Lisez la 
page de manuel "resolv+.8" pour plus de détails.</P>
<P>Ajoutez ensuite la ligne suivante dans le fichier <CODE>/etc/passwd</CODE>
de vos machines clientes :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
+::::::
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Vous pouvez également utiliser les caractères + et - pour
inclure/exclure ou modifier certains utilisateurs. Si vous souhaitez
exclure l'utilisateur guest, ajoutez <CODE>-guest</CODE>
à votre fichier <CODE>/etc/passwd</CODE>. Si vous souhaitez utiliser
un interpréteur de commandes différent (par exemple ksh)
pour l'utilisateur "linux", ajoutez la ligne <CODE>+linux::::::/bin/ksh</CODE>.
Les champs que vous ne souhaitez pas modifier doivent rester vides.
Vous pouvez également utiliser les Netgroups pour gérer les utilisateurs.</P>
<P>Par exemple, pour n'utiliser que les login miquels, dth et ed, ainsi que
tous les membres du netgroup sysadmin, tout en ayant quand même
accès aux comptes des autres utilisateurs :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
      +miquels:::::::
      +ed:::::::
      +dth:::::::
      +@sysadmins:::::::
      -ftp
      +:*::::::/etc/NoShell
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Remarquez qu'avec Linux, vous pouvez également surcharger le 
champ mot de passe, comme nous l'avons fait dans cet exemple. Nous avons
également supprimé le login "ftp" : cet utilisateur n'est plus connu 
sur la machine et le ftp anonyme ne fonctionnera pas.</P>
<P>Le netgroup peut être défini de la sorte :
<BLOCKQUOTE><CODE>
<PRE>
sysadmins (-,software,) (-,kukuk,)
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>IMPORTANT : la fonctionnalité de netgroup n'est implémentée qu'à
partir de la libc version 4.5.26. Mais si vous possédez une libc plus
ancienne que la 4.5.26, tout utilisateur dans la base de donnée des
mots de passe peut accéder à la machine linux si vous lancez ypbind.</P>

<H2><A NAME="ss7.5">7.5 Configurer un client NIS en utilisant NYS</A>
</H2>


<P>Il vous suffit d'avoir le fichier de configuration NIS 
(<CODE>/etc/yp.conf</CODE>) qui pointe sur le (ou les) serveur(s) adéquat(s), ainsi qu'un fichier 
<CODE>/etc/nsswitch.conf</CODE> correctement configuré.</P>
<P>Vous devriez également installer ypbind. Il n'est pas nécessaire
pour la libc, mais les outils NIS(YP) en ont besoin. </P>
<P>Si vous souhaitez utiliser les fonctionnalités
d'inclusion/exclusion d'utilisateurs (+/-guest/+@admins), 
vous devez utiliser "passwd: compat" et "group: compat". 
Notez qu'il n'existe pas de "shadow: compat" ! 
Vous devez utiliser "shadow: files nis" dans ce dernier cas.</P>
<P>Les sources de NYS sont fournies avec les sources de libc5. Lorsque vous
lancez la configuration pour la première fois, répondez "NO" à la
question "Values correct" (NDT: en français, "Est-ce que les valeurs sont
correctes ?"), puis répondez "YES" à la question "Build a NYS libc
from nys" (NDT: en français, "Construire une libc NYS à partir
de nys ?").</P>

<H2><A NAME="ss7.6">7.6 Configurer un client NIS en utilisant la glibc 2.x</A>
</H2>


<P>La glibc utilise la version "NIS traditionnelle", donc vous
devrez lancer ypbind. Le fichier <CODE>/etc/nsswitch.conf</CODE> doit également
être correctement configuré. Si vous utilisez le mode compat pour 
les tables passwd, shadow ou group, vous devez ajouter le 
caractère "+" à la fin de ces fichiers, et vous pourrez alors utiliser
les fonctionnalités d'inclusion/d'exclusion d'utilisateurs.
La configuration est exactement la même que sous Solaris 2.x.</P>

<H2><A NAME="ss7.7">7.7 Le fichier nsswitch.conf</A>
</H2>


<P>Le fichier de configuration <CODE>/etc/nsswitch.conf</CODE> détermine 
l'ordre dans lequel sont effectuées les recherches de certaines
informations, en fonction des données et des services, de la même manière que
le fichier <CODE>/etc/host.conf</CODE> détermine la façon dont les recherches de
noms de machines se font. Par exemple, la ligne </P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
    hosts: files nis dns
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>indique que la recherche d'un nom de machine sera d'abord effectuée
dans le fichier local <CODE>/etc/hosts</CODE>, puis dans la table NIS et enfin 
en utilisant le DNS (<CODE>/etc/resolv.conf</CODE> et <CODE>named</CODE>). Si aucune machine
ne correspond, alors une erreur est renvoyée. Ce fichier doit être accessible en
lecture pour tous les utilisateurs !</P>
<P>Voici un bon exemple de fichier /etc/nsswitch.conf pour NIS:
<BLOCKQUOTE><CODE>
<PRE>
#
# /etc/nsswitch.conf
#
# Un exemple de configuration de NSS (Name Service Switch). Ce fichier doit 
# etre trie en mettant en tete les services les plus utilises.
#
# L'entree '[NOTFOUND=return]' signifie que la recherche d'une entree
# doit s'arreter si la recherche dans l'entree precedente n'a rien donne
# Notez que si la recherche echoue pour tout autre raison 
# (par exemple, le serveur NIS ne repond pas), alors la recherche continue
# avec l'entree suivante.
#
# Les entrees connues sont :
#
#       nisplus                 NIS+ (NIS version 3)
#       nis                     NIS (NIS version 2), connu comme YP
#       dns                     DNS (Domain Name Service)
#       files                   Fichiers locaux
#       db                      Bases de donnees /var/db 
#       [NOTFOUND=return]       Arret de la recherche si l'on n'a rien trouve
#

passwd:     compat
group:      compat
shadow:     compat

passwd_compat: nis
group_compat: nis
shadow_compat: nis

hosts:      nis files dns

services:   nis [NOTFOUND=return] files
networks:   nis [NOTFOUND=return] files
protocols:  nis [NOTFOUND=return] files
rpc:        nis [NOTFOUND=return] files
ethers:     nis [NOTFOUND=return] files
netmasks:   nis [NOTFOUND=return] files
netgroup:   nis
bootparams: nis [NOTFOUND=return] files
publickey:  nis [NOTFOUND=return] files
automount:  files
aliases:    nis [NOTFOUND=return] files
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Les entrées passwd_compat, group_compat et shadow_compat ne sont 
gérées qu'avec la glibc 2.x. S'il n'y a pas d'entrée shadow 
dans <CODE>/etc/nsswitch.conf</CODE>, la glibc utilisera l'entrée passwd pour effectuer
ses recherches. Il existe certaines entrées supplémentaires
avec la glibc comme <CODE>hesoid</CODE>. Pour plus d'informations, consultez la 
documentation de la glibc.</P>

<H2><A NAME="s8">8. Mots de passe Shadow avec NIS et PAM</A></H2>

<P>L'utilisation des mots de passe Shadow avec NIS est toujours une mauvaise idée.
Vous perdez toute la sécurité apportée par le système Shadow. Une bonne
façon d'éviter les mots de passe Shadow avec NIS est de ne mettre dans le fichier
<CODE>/etc/shadow</CODE> que les utilisateurs du système local. Enlevez de la base de
données Shadow toutes les entrées correspondant aux utilisateurs NIS, et remettez
les mots de passe dans <CODE>/etc/passwd</CODE>. Vous pourrez ainsi utiliser le système
Shadow pour le super-utilisateur (i.e. "root"), et les mots de passe classiques pour
les utilisateurs NIS. Cette solution a l'avantage de pouvoir fonctionner avec tous
les clients NIS.</P>
<P>Si cette option n'est pas possible pour vous, il faudra utiliser la bibliothèque
GNU C 2.x. C'est la seule bibliothèque libc pour Linux qui gère l'utilisation
des mots de passe Shadow avec NIS. Sous Linux, la libc5 ne le permet pas. La libc5
compilée avec le support de NYS contient une partie de code permettant le mélange
Shadow - NIS, mais ce code présente de sérieuses erreurs dans certains cas et
ne fonctionne pas correctement avec toutes les entrées Shadow.</P>
<P>Le problème suivant est PAM. La bibliothèque GNU C gère l'utilisation des
mots de passe Shadow avec NIS, mais PAM ne le fait pas, essentiellement <CODE> pam_pwdb/libpwdb</CODE>.
C'est un gros problème pour les utilisateurs de RedHat 5.x. Si vous avez glibc et PAM,
vous devez changer les entrées dans <CODE>/etc/pam.d/*</CODE>. Changez toutes les entrées
de pam_pwdb par l'intermédiaire des modules pam_auth_unix_*. Cette méthode devrait
fonctionner.</P>

<H2><A NAME="s9">9. Que faut-il pour configurer NIS+ ?</A></H2>



<H2><A NAME="ss9.1">9.1 Les programmes</A>
</H2>


<P>Le code de NIS+ pour Linux a été développé pour la bibliothèque GNU C 2.
Il existe également une version pour la libc5 de Linux, puisque toutes les applications
commerciales sont compilées en édition de lien avec cette bibliothèque, et que 
vous ne pouvez pas les recompiler en utilisant la glibc. Il y a des problèmes avec
la libc5 et NIS+: Vous ne pourrez pas réaliser d'édition de lien statique de vos
programmes, et les programmes compilés avec cette bibliothèque ne fonctionneront
pas avec les autres versions de la libc5.</P>
<P>Vous devez récupérer et recompiler la dernière version de la glibc2,
et une distribution basée sur cette bibliothèque comme la
Redhat Mustang ou l'instable Debian. Mais attention : il 
s'agit toujours d'une version bêta. Lisez la documentation
concernant la glibc et celle fournie par la distribution.
La glibc2.0.x ne gère pas pleinement NIS+, et ne l'intégrera
jamais. La première version avec la gestion NIS+ sera la 2.1.</P>
<P>Les programmes clients NIS+ peuvent être récupérés sur les sites :
<BLOCKQUOTE><CODE>
<PRE>
  Site                   Repertoire                 Nom du fichier

  ftp.kernel.org         /pub/software/libs/glibc   libc-*, glibc-crypt-*,
                                                    glibc-linuxthreads-*
  ftp.kernel.org         /pub/linux/utils/net/NIS+  nis-tools-1.4.2.tar.gz
  ftp.kernel.org         /pub/linux/utils/net/NIS+  pam_keylogin-1.2.tar.gz
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Les distributions basées sur la glibc peuvent être récupérées sur les sites :
<BLOCKQUOTE><CODE>
<PRE>
  Site                   Repertoire

  ftp.redhat.com         /pub/redhat/redhat-5.1
  ftp.debian.org         /pub/debian/dists/hamm
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Pour compiler la glibc, suivez les instructions livrées avec les sources.
Vous pouvez trouver à l'adresse suivante la version patchée de la libc5,
basée sur NYS et sur les sources de la glibc, qui peut être utilisée pour 
remplacer la libc5. </P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  Site                   Repertoire                 Nom du fichier

  ftp.kernel.org         /pub/linux/utils/net/NIS+  libc-5.4.44-nsl-0.4.10.tar.gz
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Vous pouvez également consulter le site
<A HREF="http://www-vt.uni-paderborn.de/~kukuk/linux/nisplus.html">http://www-vt.uni-paderborn.de/~kukuk/linux/nisplus.html</A>
pour plus d'informations ainsi que pour avoir les dernières sources.</P>

<H2><A NAME="ss9.2">9.2 Configurer un client NIS+</A>
</H2>


<P>IMPORTANT : pour configurer un client NIS+, lisez la documentation
NIS+ Solaris pour voir ce qu'il convient de faire du côté serveur.
Ce document ne décrit que le côté client !</P>
<P>Après avoir installé la nouvelle libc ainsi que nis-tools, créez les références
pour le nouveau client sur le serveur NIS+. Assurez vous que <CODE>portmap</CODE> est lancé.
Ensuite, vérifiez que votre PC Linux est à la même heure que le serveur NIS+. Pour
réaliser des RPC sécurisés, vous disposez d'une courte période de 3 minutes,
durant lesquelles les références sont valides. Lancer <CODE>xntpd</CODE> sur toutes
les machines peut être une bonne idée. Après tout ça, exécutez les commandes 
suivantes :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
domainname nisplus.domain.
nisinit -c -H &lt;serveur NIS+>
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>pour initialiser le système de lancement. Lisez la page de manuel de
nisinit pour connaître les différentes options existantes.
Assurez-vous que le nom de domaine est toujours bien positionné lors
d'un réamorçage. Si vous ne connaissez pas votre nom de domaine NIS+
sur votre réseau, demandez-le à votre administrateur système.</P>
<P>Pensez également à modifier votre ficher <CODE>/etc/nsswitch.conf</CODE>.
Assurez-vous que le seul service situé avec publickey est <CODE>nisplus</CODE>
("publickey: nisplus"), et rien d'autre !</P>
<P>Ensuite, lancez <CODE>keyserv</CODE> et assurez-vous qu'il sera toujours lancé
lors de l'amorçage de la machine. Lancez 
<BLOCKQUOTE><CODE>
<PRE>
keylogin -r
</PRE>
</CODE></BLOCKQUOTE>

pour conserver la clef privée sur votre système (j'espère
que vous avez ajouté la clef publique de la nouvelle machine 
sur le serveur NIS+ !).</P>
<P>"niscat passwd.org_dir" doit désormais vous donner toutes les entrées
contenues dans la base de données passwd.</P>

<H2><A NAME="ss9.3">9.3 NIS+, keylogin, login et PAM</A>
</H2>

<P>Lorsque l'utilisateur se connecte, il a besoin de fixer sa clef secrète
sur le serveur de clef. Cela est effectué en appelant <CODE>keylogin</CODE>. 
Le login à partir du paquetage shadow fera cela à la place de 
l'utilisateur. Pour un login de type PAM, vous devez installer 
<CODE>pam_keylogin-1.1.tar.gz</CODE> et modifier le fichier 
<CODE>/etc/pam.d/login</CODE> pour utiliser <CODE>pam_unix_auth</CODE>, et non <CODE>pwdb</CODE> qui 
ne gère pas NIS+. Voici un exemple :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
#%PAM-1.0
auth       required     /lib/security/pam_securetty.so
auth       required     /lib/security/pam_keylogin.so
auth       required     /lib/security/pam_unix_auth.so
auth       required     /lib/security/pam_nologin.so
account    required     /lib/security/pam_unix_acct.so
password   required     /lib/security/pam_unix_passwd.so
session    required     /lib/security/pam_unix_session.so
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="ss9.4">9.4 Le fichier nsswitch.conf</A>
</H2>


<P>Le fichier de configuration <CODE>/etc/nsswitch.conf</CODE> détermine 
l'ordre dans lequel sont effectuées les recherches de certaines
informations, en fonction des données et des services, de la même manière que
le fichier <CODE>/etc/host.conf</CODE> détermine la façon dont les recherches de
noms de machines se font. Par exemple, la ligne </P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
    hosts: files nisplus dns
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>indique que la fonction de recherche doit dans un premier temps
chercher dans le fichier local <CODE>/etc/hosts</CODE>, suivi par une recherche
NIS+ et enfin <EM>via</EM> le service de recherche de noms
(<CODE>/etc/resolv.conf</CODE> et <CODE>named</CODE>).  À ce moment là, si aucune machine n'est
trouvée, alors une erreur est renvoyée.</P>
<P>Voici un exemple de bon fichier <CODE>/etc/nsswitch.conf</CODE>
<BLOCKQUOTE><CODE>
<PRE>
# Un exemple de configuration de NSS. Ce fichier doit etre trie en 
# mettant en tete les services les plus utilises.
#
# L'entree '[NOTFOUND=return]' signifie que la recherche d'une entree
# doit s'arreter si la recherche dans l'entree precedente n'a rien donne
# Notez que si la recherche echoue pour tout autre raison 
# (par exemple, le serveur NIS ne repond pas), alors la recherche continue
# avec l'entree suivante.
#
# Les entrees connues sont :
#
#       nisplus                 NIS+ (NIS version 3)
#       nis                     NIS (NIS version 2), connu comme YP
#       dns                     DNS (Domain Name Service)
#       files                   Fichiers locaux
#       db                      Bases de donnees /var/db 
#       [NOTFOUND=return]       Arret de la recherche si l'on a rien trouve
#
passwd:     compat
# pour libc5: passwd: files nisplus
group:      compat
# pour libc5: group: files nisplus
shadow:     compat
# pour libc5: shadow: files nisplus

passwd_compat: nisplus
group_compat:  nisplus
shadow_compat: nisplus

hosts:      nisplus files dns

services:   nisplus [NOTFOUND=return] files
networks:   nisplus [NOTFOUND=return] files
protocols:  nisplus [NOTFOUND=return] files
rpc:        nisplus [NOTFOUND=return] files
ethers:     nisplus [NOTFOUND=return] files
netmasks:   nisplus [NOTFOUND=return] files
netgroup:   nisplus
bootparams: nisplus [NOTFOUND=return] files
publickey:  nisplus
automount:  files
aliases:    nisplus [NOTFOUND=return] files
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="s10">10. Configurer un serveur NIS</A></H2>



<H2><A NAME="ss10.1">10.1 Le programme serveur ypserv</A>
</H2>


<P>Ce document ne décrit que la manière de configurer le serveur NIS "ypserv".</P>
<P>Les programmes serveur NIS peuvent être trouvés sur :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  Site                   Repertoire                    Nom de fichier

  ftp.kernel.org         /pub/linux/utils/net/NIS      ypserv-1.3.2.tar.gz
  wauug.erols.com        /pub/net/nis                  ypserv-1.3.2.tar.gz
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Vous pouvez également regarder le document
<A HREF="http://www-vt.uni-paderborn.de/~kukuk/linux/nis.html">http://www-vt.uni-paderborn.de/~kukuk/linux/nis.html</A>
pour obtenir de plus amples informations ainsi que les sources.</P>
<P>La configuration du serveur est la même que cela soit le NIS 
traditionnel ou NYS.</P>
<P>Compilez les sources pour générer les programmes "ypserv" et "makedbm".
Si votre serveur est considéré comme maître, déterminez quels fichiers
vous souhaitez rendre disponibles via NIS et ajoutez ou supprimez
les entrées appropriées dans <CODE>/var/yp/Makefile</CODE>.</P>
<P>Il y a une seule grande différence entre <CODE>ypserv 1.1</CODE> et <CODE>ypserv 1.2</CODE>. Depuis
la version 1.2, <CODE>ypserv</CODE> utilise une mémoire cache pour les manipulations de fichiers.
Cela signifie que vous devez toujours appeler <CODE>makedbm</CODE> avec l'option <CODE>-c</CODE> si
créez de nouvelles maps. Assurez-vous que vous utilisez le nouveau <CODE>/var/yp/Makefile</CODE>
fourni avec <CODE>ypserv 1.2</CODE> ou une version supérieure, ou ajoutez l'option <CODE>-c</CODE>
à <CODE>makedbm</CODE> dans le Makefile. Si vous ne le faites pas, <CODE>ypserv</CODE> continuera
à utiliser les anciennes maps, et non les nouvelles.</P>
<P>Éditez ensuite <CODE>/var/yp/securenets</CODE> et <CODE>/etc/ypserv.conf</CODE>. Pour plus
d'information, lisez les pages de manuel <CODE>ypserv(8)</CODE> et <CODE>ypserv.conf(5)</CODE>.</P>
<P>Assurez-vous que le portmapper (<CODE>portmap(8)</CODE>) fonctionne
et lancez le serveur <CODE>ypserv</CODE>. La commande </P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
    % rpcinfo -u localhost ypserv
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>doit vous répondre un message du genre </P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
    program 100004 version 2 ready and waiting
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Maintenant, générez la base de donnée NIS (YP). 
Sur le serveur maître, lancez :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
    % /usr/lib/yp/ypinit -m
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>sur un esclave, assurez-vous que ypwhich -m fonctionne. C'est à dire que votre esclave
doit être configuré en tant que client NIS, puis lancez:
<BLOCKQUOTE><CODE>
<PRE>
    % /usr/lib/yp/ypinit -s masterhost
</PRE>
</CODE></BLOCKQUOTE>

pour que la machine soit un esclave NIS.</P>
<P>Ça y est, votre serveur fonctionne.</P>
<P>Si vous avez de plus gros problèmes, vous pouvez lancer <CODE>ypserv</CODE> et <CODE>ypbind</CODE>
en mode debug sur des xterms différents. La sortie écran du mode débug devrait vous
montrer ce qui ne va pas.</P>
<P>Il est possible que vous souhaitiez ajouter les lignes suivantes
sur le serveur esclave dans la <CODE>crontab</CODE> root :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
      20 *    * * *    /usr/lib/yp/ypxfr_1perhour
      40 6    * * *    /usr/lib/yp/ypxfr_1perday
      55 6,18 * * *    /usr/lib/yp/ypxfr_2perday
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>De cette manière, vous êtes sûr que les maps NIS sont synchronisées
et sont à jour, même s'il peut arriver qu'une mise à jour soit 
ratée parce que l'esclave était arrêté lors de la mise à jour du
maître.</P>
<P>Vous pouvez ajouter un esclave n'importe quand, ensuite. Tout d'abord, assurez-vous que le
nouveau <CODE>ypserv</CODE> a les droits pour contacter le serveur maître. Ensuite, lancez
<BLOCKQUOTE><CODE>
<PRE>
    % /usr/lib/yp/ypinit -s masterhost
</PRE>
</CODE></BLOCKQUOTE>

sur l'esclave, et ajoutez le nom du serveur au fichier <CODE>/var/yp/ypservers</CODE>. Après
cela, lancez la commande "make" dans le répertoire <CODE>/var/yp</CODE> pour mettre les maps
à jour.</P>
<P>Si vous souhaitez restreindre l'accès au serveur NIS, vous devez
configurer le serveur NIS comme s'il était également un client 
en lançant <CODE>ypbind</CODE> et en ajoutant les entrées "+" dans le 
fichier <CODE>/etc/passwd</CODE>. La bibliothèque de fonctions
va alors ignorer les entrées normales après la première
entrée NIS et va récupérer le reste des informations en utilisant NIS.
C'est de cette manière que sont maintenues les règles d'accès NIS.
Par exemple :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
     root:x:0:0:root:/root:/bin/bash
     daemon:*:1:1:daemon:/usr/sbin:
     bin:*:2:2:bin:/bin:
     sys:*:3:3:sys:/dev:
     sync:*:4:100:sync:/bin:/bin/sync
     games:*:5:100:games:/usr/games:
     man:*:6:100:man:/var/catman:
     lp:*:7:7:lp:/var/spool/lpd:
     mail:*:8:8:mail:/var/spool/mail:
     news:*:9:9:news:/var/spool/news:
     uucp:*:10:50:uucp:/var/spool/uucp:
     nobody:*:65534:65534:noone at all,,,,:/dev/null:
     +miquels::::::
     +:*:::::/etc/NoShell
     [ Tous les utilisateurs normaux APRES cette ligne !]
     tester:*:299:10:Just a test account:/tmp:
     miquels:1234567890123:101:10:Miquel van Smoorenburg:/home/miquels:/bin/zsh
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>L'utilisateur <EM>tester</EM> existera toujours mais il aura l'interpréteur de
commandes <CODE>/etc/NoShell</CODE>. L'utilisateur <EM>miquels</EM> aura un accès normal.</P>
<P>Sinon, vous pouvez également éditer le fichier <CODE>/var/yp/Makefile</CODE> 
et configurer NIS pour qu'il utilise un autre fichier passwd.
Sur de gros systèmes, les fichiers passwd et group sont généralement
conservés dans le répertoire <CODE>/var/yp/ypfiles/</CODE>. Si vous 
utilisez les outils standards pour administrer le fichier mot 
de passe ("passwd", "chfn",
"adduser"), cela ne fonctionnera plus et devrez alors créer vos propres outils.</P>
<P>Toutefois, <CODE>yppasswd</CODE>, <CODE>ypchsh</CODE> et <CODE>ypchfn</CODE> fonctionneront bien sur.</P>

<H2><A NAME="ss10.2">10.2 Le programme serveur yps</A>
</H2>


<P>Pour mettre en place le serveur NIS <CODE>yps</CODE>, consultez les paragraphes
précédents. Sa configuration est assez similaire sans être exactement
la même, donc faites attention si vous essayez d'appliquer les
instructions de <CODE>ypserv</CODE> à <CODE>yps</CODE>! Cependant, <CODE>yps</CODE> n'est plus maintenu 
par son auteur, et contient un certain nombre de failles de sécurité. Vous
devriez éviter de vous en servir.</P>
<P>Ce serveur NIS peut être trouvé sur :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
    Site                Repertoire               Nom du Fichier

  ftp.lysator.liu.se  /pub/NYS/servers            yps-0.21.tar.gz
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="ss10.3">10.3 Le programme rpc.yppasswdd</A>
</H2>

<P>À chaque fois qu'un utilisateur change son mot de passe, le mot de 
passe de la  base de données NIS, ainsi que celui des autres bases
de données NIS, doit être mis à jour. Le programme
<CODE>rpc.yppasswd</CODE> est un serveur qui gére les modifications
de mot de passe et qui s'assure que les informations NIS seront 
correctement mises à jour. <CODE>rpc.yppasswdd</CODE> est désormais intégré
dans <CODE>ypserv</CODE>. Vous n'avez plus besoin des vieilles versions séparées
<CODE>yppasswd-0.9.tar.gz</CODE> ou <CODE>yppasswd-0.10.tar.gz</CODE>, et vous ne devriez
plus les utiliser. La version de <CODE>rpc.yppasswdd</CODE> qui est comprise dans 
<CODE>ypserv 1.3.2</CODE> gère totalement les Shadow. <CODE>yppasswd</CODE> fait
maintenant parti de yp-tools-1.2.tar.gz.</P>
<P>Le lancement de <CODE>rpc.yppasswdd</CODE> n'est nécessaire que sur le serveur maître.
Par défaut, les utilisateurs ne sont pas autorisés à changer leur Nom complet
(NDT: Prénom + Nom), ni leur shell. Vous pouvez cependant les y autoriser en utilisant
l'option <CODE>-e</CODE> de <CODE>chfn</CODE> ou l'option <CODE>-e</CODE> de <CODE>-e</CODE> de <CODE>chsh</CODE>.</P>

<H2><A NAME="s11">11. Vérifier l'installation de NIS ou de NYS </A></H2>

<P>Si tout fonctionne correctement (comme cela devrait être), vous devriez être
capable de vérifier votre installation avec quelques commandes simples. Supposons que 
le fichier de mots de passe soit géré par NIS, la commande </P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
    % ypcat passwd
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>devrait alors vous donner le contenu du fichier des mots de passe.
La commande </P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
    % ypmatch id_utilisateur passwd
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>(où <EM>id_utilisateur</EM> est le nom de login d'un utilisateur) devrait
vous donner l'entrée de l'utilisateur dans le fichier des mots de passe NIS.
Les commandes <CODE>ypcat</CODE> et <CODE>ypmatch</CODE> doivent être incluses 
dans la distribution du NIS (ou NYS) traditionnel.</P>
<P>Si un utilisateur ne peut pas se connecter, lancez le programme suivant
sur la machine cliente :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
#include &lt;stdio.h>
#include &lt;pwd.h>
#include &lt;sys/types.h>

int
main(int argc, char *argv[])
{
  struct passwd *pwd;

  if(argc != 2)
    {
      fprintf(stderr,"Usage: getwpnam username\n");
      exit(1);
    }

  pwd=getpwnam(argv[1]);

  if(pwd != NULL)
    {
      printf("name.....: [%s]\n",pwd->pw_name);
      printf("password.: [%s]\n",pwd->pw_passwd);
      printf("user id..: [%d]\n", pwd->pw_uid);
      printf("group id.: [%d]\n",pwd->pw_gid);
      printf("gecos....: [%s]\n",pwd->pw_gecos);
      printf("directory: [%s]\n",pwd->pw_dir);
      printf("shell....: [%s]\n",pwd->pw_shell);
    }
  else
    fprintf(stderr,"User \"%s\" not found!\n",argv[1]);

  exit(0);
}
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Faites tourner ce programme avec le nom de l'utilisateur en
paramètre. Il va afficher toutes les informations renvoyées
par la fonction <CODE>getpwnam</CODE> concernant l'utilisateur.
Cela peut vous permettre de savoir si l'entrée est correcte. Un problème
assez fréquemment rencontré est une redéfinition du champ de mot
de passe par un "*".</P>

<H2><A NAME="s12">12. Problèmes et erreurs de fonctionnement de NIS</A></H2>

<P>Voici certains problèmes rencontrés par différents utilisateurs :</P>
<P>
<OL>
<LI>Les bibliothèques 4.5.19 sont défectueuses. NIS ne fonctionnera pas
avec.
</LI>
<LI>Si vous faites une mise à jour de 4.5.19 à 4.5.24 alors la commande
<CODE>su</CODE> plante. Vous devez récupérer la commande 
<CODE>su</CODE> à partir de la distribution de la <EM>slackware</EM>
1.2.0 ou supérieure. Éventuellement, vous pouvez également y 
récupérer les bibliothèques mises à jour.
</LI>
<LI> Vous pouvez avoir quelques problèmes avec NIS et DNS sur la même 
machine si vous utilisez une vieille distribution en <EM>a.out</EM>. 
Le serveur DNS ne supporte pas toujours NIS.
</LI>
<LI> Lorsqu'un serveur NIS tombe et est relancé, <CODE>ypbind</CODE>
démarre avec des messages du genre :
<PRE>
         yp_match: clnt_call:
                     RPC: Unable to receive; errno = Connection refused
        
</PRE>

et les logins sont refusés pour les utilisateurs référencés dans
la base de donnée NIS. Loguez vous en tant que root si vous le 
pouvez, tuez <CODE>ypbind</CODE> puis relancez-le.
</LI>
<LI>Après avoir mis à jour la <CODE>libc</CODE> version supérieure à 5.4.20,
les outils YP ne fonctionneront plus. Vous devez utiliser les <CODE>yp-tools version 1.2</CODE> ou supérieure pour la <CODE>libc &gt;= 5.4.21</CODE> et <CODE>glibc 2.x</CODE>, 
et la version <CODE>yp-clients 2.2</CODE> pour les versions précédentes.
<CODE>yp-tools 2.0</CODE> devrait fonctionner avec toutes les bibliothèques.
</LI>
<LI>Dans les <CODE>libc 5.4.21 - 5.4.35</CODE>, <CODE>yp_maplist</CODE> est défectueux. 
Vous devrez prendre une version 5.4.36 ou supérieure, sinon, certains programmes 
pour YP comme <CODE>ypwhich</CODE> généreront une erreur <EM>seg.fault</EM>.
</LI>
<LI>La <CODE>libc5</CODE> avec le NIS traditionnel ne gère pas l'utilisation des mots de passe
Shadow avec NIS. Vous devez donc utiliser la <CODE>libc5</CODE> avec NYS ou la <CODE>glibc 2.x</CODE>.
</LI>
<LI><CODE>ypcat shadow</CODE> ne montre pas la map Shadow. C'est là quelque chose de correct,
puisque le nom de la map Shadow est "shadow.byname", et non "shadow".
</LI>
</OL>
</P>

<H2><A NAME="s13">13. FAQ : Les questions les plus fréquemment posées</A></H2>

<P>Bon nombre de questions doivent être résolues désormais. Si vous avez
des questions sans réponse, vous pouvez poster un message dans les
forums de discussion :
<BLOCKQUOTE><CODE>
<PRE>
    comp.os.linux.help
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>ou</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
    comp.os.linux.networking
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>ou contacter l'un des auteurs de ce HOWTO.</P>
</BODY>
</HTML>
