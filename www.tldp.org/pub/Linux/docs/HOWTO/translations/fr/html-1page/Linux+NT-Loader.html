<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.21">
 <TITLE>NT OS Loader + Linux mini-HOWTO</TITLE>
</HEAD>
<BODY>
<H1>NT OS Loader + Linux mini-HOWTO</H1>

<H2>Bernd Reichert, &lt;reichert@dial.eunet.ch&gt; <BR>
Version française&nbsp;: Etienne BERNARD &lt;bernard@isia.cma.fr&gt;</H2>v1.11, 2 September 1997
<HR>
<EM>Ce document décrit l'utilisation du chargeur de système d'exploitation
de Windows NT pour démarrer Linux.
Cette procédure a été testée avec Windows NT 4.0 Workstation et Linux 2.0</EM>
<HR>
<H2><A NAME="s1">1. Comment fonctionne le Chargeur NT</A></H2>

<P>Le chargeur de système d'exploitation de NT aime avoir le secteur de boot
des autres systèmes d'exploitation sous forme de fichier. Il lit le fichier,
et lance le système d'exploitation sélectionné, c'est-à-dire Window NT,
sous différents modes, ou n'importe quel autre OS (système d'exploitation).</P>

<H2><A NAME="s2">2. Trucs et astuces pour installer Windows NT et Linux sur le même système</A></H2>

<H2><A NAME="ss2.1">2.1 Installation de Windows NT</A>
</H2>

<P>Essayez d'installer Windows NT en premier. Si vous désirez utiliser le
système de fichier NTFS pour votre partition dédiée à Window NT, n'oubliez
pas que Linux ne permet pas encore d'écrire sur les partitions NTFS.
Le driver, encore béta, pour faire cela se trouve à 
<A HREF="http://www.informatik.hu-berlin.de/~loewis/ntfs">http://www.informatik.hu-berlin.de/~loewis/ntfs</A>. Vous
devriez créer une partition FAT pour l'échange de données, ou vous pouvez
aussi utiliser des disquettes au format DOS.</P>

<H2><A NAME="ss2.2">2.2 Partitionnement</A>
</H2>

<P>Un autre Mini-HOWTO vous conseille de ne pas utiliser l'"administrateur
de disque" de Windows NT pour créer les partitions racine et de swap de
Linux. Il est suffisant de laisser un espace libre. Je recommande également
d'utiliser le <CODE>fdisk</CODE> de Linux plus tard.</P>

<H2><A NAME="ss2.3">2.3 Installation de Linux</A>
</H2>

<P>A présent, démarrez Linux à partir des disquettes, puis créez la partition
root et celle de swap. <CODE>fdisk</CODE> considère que la partition NTFS est une
partition HPFS. C'est normal. Démarrez à nouveau depuis les disquettes, et
installez Linux à votre convenance.</P>

<P>Au cas où la procédure d'installation vous proposerait de monter la
partition HPFS qu'il a trouvé, ignorez cela.</P>

<H2><A NAME="ss2.4">2.4 Lilo</A>
</H2>

<P>Une fois que vous avez atteint la section dédiée à Lilo, spécifiez
votre partition root de linux en tant que périphérique de démarrage,
car le <EM>Master Boot Record</EM> (MBR) de votre disque dur est occupé
par Windows NT. Cela signifie que les entrées <CODE>root</CODE> et <CODE>boot</CODE>
dans le fichier <CODE>/etc/lilo.conf</CODE> ont les mêmes valeurs.
Si vous avez un disque dur IDE, et que la partition dédiée à Linux se
trouve sur la deuxième partition, l'entrée correspondant à <CODE>boot</CODE>
dans le fichier <CODE>/etc/lilo.conf</CODE> devrait ressembler à&nbsp;:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
boot=/dev/hda2
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Si vous possédez deux disques dur, et que Linux se trouve sur la
première partition du second disque, la section <CODE>boot</CODE> du fichier
<CODE>/etc/lilo.conf</CODE> ressemble à&nbsp;:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
boot=/dev/hdb1
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Configurez lilo pour utiliser un noyau correspondant à votre système.
Au préalable, si vous n'êtes pas sûr de vous, vérifiez le noyau en
démarrant depuis une disquette.</P>

<P>Si vous ne pouvez pas booter sous Windows NT, vous avez un
problème. J'espère que vous avez créé une disquette de réparation
récemment.</P>

<H2><A NAME="s3">3. Le programme Bootpart</A></H2>

<P>Il existe un programme pour Windows NT, nommé <CODE>bootpart</CODE> et écrit
par G. Vollant qui peut réaliser le travail des deux prochains points
pour vous. <CODE>bootpart</CODE> peut être récupéré sur 
<A HREF="http://ourworld.compuserve.com/homepages/gvollant/bootpart.htm">http://ourworld.compuserve.com/homepages/gvollant/bootpart.htm</A>.</P>

<P>Si vous décidez de faire vous même ce que fait ce programme, utilisez
les procédures décrites aux points 5 et 6.</P>


<H2><A NAME="s4">4. Le travail à faire sous Linux</A></H2>

<P>Vous devrez démarrer à partir de disquettes tant que la partie du
travail à réaliser sous NT ne sera pas achevée.</P>

<P>Vous devez récupérer le secteur de démarrage de votre partition root
Linux. Si on suppose que votre partition Linux se trouve sur
<CODE>/dev/hda2</CODE>, la commande à utiliser est&nbsp;:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# dd if=/dev/hda2 of=/bootsect.lnx bs=512 count=1
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Si le fichier <CODE>bootsect.lnx</CODE> fait plus de 512 octets, il y a eu un
problème.</P>
<P>A présent, copiez le fichier <CODE>bootsect.lnx</CODE> sur une disquette au
format DOS, si c'est la moyen que vous utilisez pour transférer des
fichiers sur votre partition NTFS.</P>
<P>Vous pouvez utiliser la commande</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# mcopy /bootsect.lnx a:
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>ou bien</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# mount -t msdos /dev/fd0 /mnt
# copy /bootsect.lnx /mnt
# umount /mnt
</PRE>
</CODE></BLOCKQUOTE>
</P>


<H2><A NAME="s5">5. Le travail à faire sous Windows NT</A></H2>

<P>Copiez le fichier de la disquette sur <CODE>C:\bootsect.lnx</CODE>. Je ne
vous explique pas comment faire.</P>
<P>Le fichier <CODE>c:\boot.ini</CODE> est à Windows NT ce que
<CODE>/etc/lilo.conf/</CODE> est à Linux. Enlevez les attributs <EM>système</EM> et
<EM>lecture seule</EM> avant de le modifier, avec la commande&nbsp;:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
C:\> attrib -s -r c:\boot.ini 
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Editez, avec <CODE>notepad</CODE> par exemple, le fichier <CODE>boot.ini</CODE>, comme
suit&nbsp;:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
[boot loader]
timeout=30
default=multi(0)disk(0)rdisk(0)partition(1)\WINNT
[operating systems]
multi(0)disk(0)rdisk(0)partition(1)\WINNT="Windows NT Workstation ... 
multi(0)disk(0)rdisk(0)partition(1)\WINNT="Windows NT Workstation ...
C:\BOOTSECT.LNX="Linux"
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Seule la dernière ligne a été ajoutée sur cet exemple. Si vous avez
changé <CODE>boot.ini</CODE>, restaurez les attributs du fichiers à leur
valeurs initiales, avec la commande&nbsp;:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
C:\attrib +s +r c:\boot.ini 
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Aprés un redémarrage de votre Windows NT, vous devriez voir apparaître
ceci&nbsp;:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  OS Loader V4.00
 
  Please select the operating system to start:

  Windows NT Workstation Version 4.0
  Windows NT Workstation Version 4.0 [VGA mode]
  Linux
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>(NdT: Je ne sais pas ce que cela donne pour la version française de
Windows NT)</P>
<P>Sélectionnez <CODE>Linux</CODE> et vous verrez apparaître</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  LILO loading Linux ....
</PRE>
</CODE></BLOCKQUOTE>
</P>


<H2><A NAME="s6">6. Même joueur joue encore</A></H2>

<P>A chaque fois que le secteur de démarrage de votre partition Linux est
modifié, vous devez transférer une nouvelle copie de <CODE>bootsect.lnx</CODE>
vers <CODE>C:\BOOTSECT.LNX</CODE>. Cela est par exemple nécessaire
lorsque vous installez un nouveau noyau avec lilo. Comme vous pouvez
le constater, un tel système n'est pas idéal pour tester des noyaux
expérimentaux.</P>


<H2><A NAME="s7">7. En cas de problème...</A></H2>

<P>Si cela ne fonctionne pas comme prévu, vérifiez que vous pouvez booter
à l'aide d'une disquette. Si <CODE>/dev/hdb1</CODE> est votre partition
Linux, votre fichier <CODE>/etc/lilo.conf</CODE> devrait avoir les entrées
suivantes&nbsp;:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
root=/dev/hdb1
boot=/dev/fd0
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Lancez lilo avec une disquette dans le lecteur, puis essayez de
démarrer à partir de cette disquette. Si Linux sur <CODE>/dev/hdb1</CODE>
ne peut être démarré, le chargeur NT ne pourra pas le lancer non plus.
Si vous voyez apparaître une floppée de <CODE>01 01 01 01</CODE>, c'est que votre
secteur de démarrage ne peut être accédé. Vérifiez que tous vos
disques sont reconnus par le BIOS.</P>

<P>Si votre disquette vous permet de démarrer Linux, vous pouvez
récupérer le secteur de démarrage de la disquette pour le chargeur NT
avec la commande&nbsp;:</P>

<P>
<BLOCKQUOTE><CODE>
<PRE>
# dd if=/dev/fd0 of=/bootsect.lnx bs=512 count=1
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Vous pouvez garder cette disquette, qui servira de disquette de secours,
au cas où votre installation de Windows NT empêche le démarrage de Linux.</P>


<H2><A NAME="s8">8. Références</A></H2>

<P>
<UL>
<LI>Le mini-HOWTO Linux+WindowsNT</LI>
<LI>La FAQ de FreeBSD 2.x</LI>
</UL>
</P>

<H2><A NAME="s9">9. Remerciements</A></H2>

<P>
<UL>
<LI>Merci à 
<A HREF="mailto:z3c20@ttacs.ttu.edu">Xiaoming Yi</A> pour m'avoir indiqué que la
procédure fonctionnait également pour les disques autres que le
premier.</LI>
<LI>Merci à 
<A HREF="mailto:Frank.Dennler@zkb.ch">Frank        Dennler</A> pour l'astuce de la disquette.</LI>
</UL>
</P>

<H2><A NAME="s10">10. Commentaires</A></H2>

<P>Tous les commentaires sont les bienvenus.</P>

</BODY>
</HTML>
