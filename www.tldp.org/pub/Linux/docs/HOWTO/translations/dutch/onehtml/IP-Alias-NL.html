<HTML
><HEAD
><TITLE
>Instellen van IP-Aliasing op een Linux Machine
		Mini-HOWTO</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"></HEAD
><BODY
CLASS="ARTICLE"
BACKGROUND="../IMAGES/back.gif"
LINK="#000099"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
></A
>Instellen van IP-Aliasing op een Linux Machine
		Mini-HOWTO</H1
><H3
CLASS="AUTHOR"
><A
NAME="AEN4"
>Harish Pillay</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>&nbsp;<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:h.pillay@ieee.org"
>h.pillay@ieee.org</A
>&#62;</TT
><br>
				</P
></DIV
></DIV
><H3
CLASS="AUTHOR"
><A
NAME="AEN11"
>Vertaald door: Ellen Bokhorst</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
><TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:bokkie@nl.linux.org"
>bokkie@nl.linux.org</A
>&#62;</TT
></P
></DIV
></DIV
><P
CLASS="PUBDATE"
>2001-01-23<BR></P
><DIV
CLASS="REVHISTORY"
><TABLE
WIDTH="100%"
BORDER="0"
><TR
><TH
ALIGN="LEFT"
VALIGN="TOP"
COLSPAN="3"
><B
>Wijzigingen</B
></TH
></TR
><TR
><TD
ALIGN="LEFT"
>Herziening 1.2</TD
><TD
ALIGN="LEFT"
>2001-01-26</TD
><TD
ALIGN="LEFT"
>Herzien door: JEY</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
></TD
></TR
><TR
><TD
ALIGN="LEFT"
>Herziening 1.1</TD
><TD
ALIGN="LEFT"
>2001-01-24</TD
><TD
ALIGN="LEFT"
>Herzien door: JEY</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
></TD
></TR
><TR
><TD
ALIGN="LEFT"
>Herziening 1.0</TD
><TD
ALIGN="LEFT"
>1997-01-13</TD
><TD
ALIGN="LEFT"
>Herzien door: HP</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
></TD
></TR
></TABLE
></DIV
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN18"
></A
><P
></P
><P
>Dit is een procedure handboek over hoe IP
			aliasing op een Linux box in te stellen en te draaien
			en over hoe de computer zo kan worden ingesteld dat e-mail
			via het met alias ingestelde IP-adres kan worden ontvangen.
			</P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Inhoudsopgave</B
></DT
><DT
><A
HREF="#MYSETUP"
>Mijn Setup</A
></DT
><DT
><A
HREF="#COMMANDS"
>Opdrachten</A
></DT
><DT
><A
HREF="#TROUBLESHOOTING"
>Probleemoplossing: Vragen en Antwoorden</A
></DT
><DT
><A
HREF="#ACKNOWLEDGEMENTS"
>Erkenningen</A
></DT
></DL
></DIV
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="MYSETUP"
></A
>Mijn Setup</H2
><P
></P
><UL
><LI
><P
>IP Alias is standaard in kernels
			2.0.x en 2.2.x, en beschikbaar als een optie
			tijdens compileren in 2.4.x
			(IP Alias is in 2.4.x afgekeurd en vervangen
			door een krachtiger firewalling mechanisme).
     </P
></LI
><LI
><P
>IP Alias gecompileerd als een
			laadbare module. Je moet aan de "make config"
			opdracht om je kernel te maken hebben aangegeven
			dat je de IP Masq als een (M)odule wilt hebben
			gecompileerd. Kijk in de Modules HOW-TO (als
			dit voorkomt) of kijk in de info in
     <TT
CLASS="FILENAME"
>/usr/src/linux/Documentation/modules.txt.</TT
></P
></LI
><LI
><P
>Ik moet twee extra IP's ondersteunen
			boven de IP die door mij is toegewezen.
			</P
></LI
><LI
><P
>Een D-Link DE620 pocket adapter
			(niet van belang, werkt met alle ondersteunde
			netwerkadapters).
                        </P
></LI
></UL
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="COMMANDS"
></A
>Opdrachten</H2
><P
></P
><OL
TYPE="1"
><LI
><P
>Laad de IP-alias module (je kunt
			deze stap overslaan als je de module in de kernel
			compileerde):
                        </P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SCREEN"
>/sbin/insmod /lib/modules/`uname -r`/ipv4/ip_alias.o</PRE
></TD
></TR
></TABLE
></LI
><LI
><P
>Stel de loopback, eth0, en alle
			IP-adressen beginnend met het hoofd IP-adres in voor
			de eth0 interface:
                        </P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SCREEN"
>/sbin/ifconfig lo 127.0.0.1
/sbin/ifconfig eth0 up
/sbin/ifconfig eth0 172.16.3.1
/sbin/ifconfig eth0:0 172.16.3.10
/sbin/ifconfig eth0:1 172.16.3.100</PRE
></TD
></TR
></TABLE
><P
>172.16.3.1 is het hoofd IP-adres, terwijl .10
		     en .100 de aliassen zijn. De magie is de
		     eth0:x waar x=0,1,2,...n voor de verschillende 
		     IP-adressen staat. Het hoofd IP-adres hoeft geen
		     alias te zijn.
		     </P
></LI
><LI
><P
>Stel de routes in. Routeer eerst
			het loopback, dan het net, en als laatste de diverse
			IP-adressen beginnend met het standaard (oorspronkelijk
			toegewezen) IP-adres:
		        </P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SCREEN"
>/sbin/route add -net 127.0.0.0
/sbin/route add -net 172.16.3.0 dev eth0
/sbin/route add -host 172.16.3.1 dev eth0
/sbin/route add -host 172.16.3.10 dev eth0:0
/sbin/route add -host 172.16.3.100 dev eth0:1
/sbin/route add default gw 172.16.3.200</PRE
></TD
></TR
></TABLE
><P
>Dat is alles.</P
></LI
></OL
><P
>Bij het voorbeeld IP-adres hierboven, gebruik ik
		het Priv&eacute; IP-adres (RFC 1918) voor illustratieve
		doeleinden. Vervang ze door je eigen offici&euml;le of
		priv&eacute; IP-adressen.
		</P
><P
>Het voorbeeld toont slechts 3 IP-adressen. Het max is
		ingesteld op 256 in
			<TT
CLASS="FILENAME"
>/usr/include/linux/net_alias.h.</TT
>
			256 IP adressen op EEN kaart is heel veel :-)!</P
><P
>Zo ziet mijn <TT
CLASS="FILENAME"
>/sbin/ifconfig</TT
>
		eruit:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>lo	  Link encap:Local Loopback
	       inet addr:127.0.0.1  Bcast:127.255.255.255  Mask:255.0.0.0
			 UP BROADCAST LOOPBACK RUNNING	MTU:3584  Metric:1
		    RX packets:5088 errors:0 dropped:0 overruns:0
		    TX packets:5088 errors:0 dropped:0 overruns:0

eth0	  Link encap:10Mbps Ethernet  HWaddr 00:8E:B8:83:19:20
		    inet addr:172.16.3.1  Bcast:172.16.3.255
		    Mask:255.255.255.0
		    UP BROADCAST RUNNING PROMISC MULTICAST  MTU:1500
		    Metric:1
		    RX packets:334036 errors:0 dropped:0 overruns:0
		    TX packets:11605 errors:0 dropped:0 overruns:0
		    Interrupt:7 Base address:0x378

eth0:0	  Link encap:10Mbps Ethernet  HWaddr 00:8E:B8:83:19:20
		    inet addr:172.16.3.10  Bcast:172.16.3.255
		    Mask:255.255.255.0
		    UP BROADCAST RUNNING  MTU:1500  Metric:1
		    RX packets:0 errors:0 dropped:0 overruns:0
		    TX packets:0 errors:0 dropped:0 overruns:0

eth0:1	  Link encap:10Mbps Ethernet  HWaddr 00:8E:B8:83:19:20
		    inet addr:172.16.3.100  Bcast:172.16.3.255
		    Mask:255.255.255.0
		    UP BROADCAST RUNNING  MTU:1500  Metric:1
		    RX packets:1 errors:0 dropped:0 overruns:0
		    TX packets:0 errors:0 dropped:0
		    overruns:0</PRE
></TD
></TR
></TABLE
><P
>En <TT
CLASS="FILENAME"
>/proc/net/aliases</TT
>:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>device	       family	 address
eth0:0		 2	172.16.3.10
eth0:1		 2	172.16.3.100</PRE
></TD
></TR
></TABLE
><P
>And <TT
CLASS="FILENAME"
>/proc/net/alias_types</TT
>:
		</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>type	name		n_attach
2	ip		2</PRE
></TD
></TR
></TABLE
><P
>Natuurlijk werd dat in
		<TT
CLASS="FILENAME"
>/proc/net</TT
> aangemaakt met de opdracht
		<B
CLASS="COMMAND"
>ifconfig</B
> en niet met de hand!
		</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="TROUBLESHOOTING"
></A
>Probleemoplossing: Vragen en Antwoorden</H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="KEEPSETTINGS"
></A
>Vraag: Hoe kan ik, ook na een
		reboot, de instellingen behouden?</H3
><P
>Antwoord: Of je nu een 
			<B
CLASS="COMMAND"
>init</B
>,
			in de stijl van BSD of SysV
			(Redhat&trade; bijvoorbeeld)
			gebruikt, je kunt het altijd
			opnemen in 
			<TT
CLASS="FILENAME"
>/etc/rc.d/rc.local</TT
>.
			Dit heb ik op mijn SysV init systeem
			(Redhat&trade; 3.0.3 en 4.0):</P
><P
>Mijn
	<TT
CLASS="FILENAME"
>/etc/rc.d/rc.local</TT
>:
	(gewijzigd om de relevante onderdelen te laten zien)</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>#instellen van de IP-alias interfaces
echo "Instellen van 172.16.3.1, 172.16.3.10, 172.16.3.100 IP Aliassen ..."
/sbin/ifconfig lo 127.0.0.1
/sbin/ifconfig eth0 up
/sbin/ifconfig eth0 172.16.3.1
/sbin/ifconfig eth0:0 172.16.3.10
/sbin/ifconfig eth0:1 172.16.3.100
#instellen van de routes
echo "Instellen van IP-routes ..."
/sbin/route add -net 127.0.0.0
/sbin/route add -net 172.16.3.0 dev eth0
/sbin/route add -host 172.16.3.1 eth0
/sbin/route add -host 172.16.3.10 eth0:0
/sbin/route add -host 172.16.3.100 eth0:1
/sbin/route add default gw 172.16.3.200
# </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="SETTINGUPMAIL"
></A
>Vraag: Hoe stel ik de IP-alias machine zo in dat ik op de diverse
aliased IP-adressen e-mail kan ontvangen (op een machine met sendmail)?</H3
><P
>Antwoord: Maak (als deze nog niet bestaat) bijvoorbeeld een bestand 
met de naam <TT
CLASS="FILENAME"
>/etc/mynames.cw</TT
> aan. Het bestand hoeft
niet pers&eacute; deze precieze naam te hebben noch in de
<TT
CLASS="FILENAME"
>/etc directory</TT
> te staan.</P
><P
>Plaats in dat bestand de offici&euml;le domeinnamen van de aliased 
IP-adressen. Als deze aliased IP-adressen geen domeinnaam hebben, dan
kun je het IP-adres zelf plaatsen.</P
><P
> Het bestand <TT
CLASS="FILENAME"
>/etc/mynames.cw</TT
> zou er ongeveer
zo uit kunnen zien:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
># /etc/mynames.cw - plaats hier alle aliassen voor je machine; # is commentaar
domain.one.net
domain.two.com
domain.three.org
4.5.6.7 </PRE
></TD
></TR
></TABLE
><P
>Voeg in het bestand
<TT
CLASS="FILENAME"
>sendmail.cf</TT
> het volgende toe, daar waar het een file
class macro Fw definieert:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>&#13;##################
#   local info	 #
##################


# bestand met hostnamen voor wie we mail ontvangen
Fw/etc/mynames.cw</PRE
></TD
></TR
></TABLE
><P
>Daarmee zou het moeten lukken. Test de nieuwe instelling uit
door sendmail in testmode aan te roepen. Hieronder volgt een voorbeeld:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>ganymede$ /usr/lib/sendmail -bt
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &#60; ruleset&#62; &#60; address&#62;
&#62; 0 me@4.5.6.7
rewrite: ruleset  0   input: me @ 4 . 5 . 6 . 7
rewrite: ruleset 98   input: me @ 4 . 5 . 6 . 7
rewrite: ruleset 98 returns: me @ 4 . 5 . 6 . 7
rewrite: ruleset 97   input: me @ 4 . 5 . 6 . 7
rewrite: ruleset  3   input: me @ 4 . 5 . 6 . 7
rewrite: ruleset 96   input: me &#60; @ 4 . 5 . 6 . 7 &#62;
rewrite: ruleset 96 returns: me &#60; @ 4 . 5 . 6 . 7 . &#62;
rewrite: ruleset  3 returns: me &#60; @ 4 . 5 . 6 . 7 . &#62;
rewrite: ruleset  0   input: me &#60; @ 4 . 5 . 6 . 7 . &#62;
rewrite: ruleset 98   input: me &#60; @ 4 . 5 . 6 . 7 . &#62;
rewrite: ruleset 98 returns: me &#60; @ 4 . 5 . 6 . 7 . &#62;
rewrite: ruleset  0 returns: $# local $: me
rewrite: ruleset 97 returns: $# local $: me
rewrite: ruleset  0 returns: $# local $: me
&#62; 0 me@4.5.6.8
rewrite: ruleset  0   input: me @ 4 . 5 . 6 . 8
rewrite: ruleset 98   input: me @ 4 . 5 . 6 . 8
rewrite: ruleset 98 returns: me @ 4 . 5 . 6 . 8
rewrite: ruleset 97   input: me @ 4 . 5 . 6 . 8
rewrite: ruleset  3   input: me @ 4 . 5 . 6 . 8
rewrite: ruleset 96   input: me &#60; @ 4 . 5 . 6 . 8 &#62;
rewrite: ruleset 96 returns: me &#60; @ 4 . 5 . 6 . 8 &#62;
rewrite: ruleset  3 returns: me &#60; @ 4 . 5 . 6 . 8 &#62;
rewrite: ruleset  0   input: me &#60; @ 4 . 5 . 6 . 8 &#62;
rewrite: ruleset 98   input: me &#60; @ 4 . 5 . 6 . 8 &#62;
rewrite: ruleset 98 returns: me &#60; @ 4 . 5 . 6 . 8 &#62;
rewrite: ruleset 95   input: &#60; &#62; me &#60; @ 4 . 5 . 6 . 8 &#62;
rewrite: ruleset 95 returns: me &#60; @ 4 . 5 . 6 . 8 &#62;
rewrite: ruleset  0 returns: $# smtp $@ 4 . 5 . 6 . 8 $: me &#60; @ 4 . 5
. 6 . 8 &#62;
rewrite: ruleset 97 returns: $# smtp $@ 4 . 5 . 6 . 8 $: me &#60; @ 4 . 5
. 6 . 8 &#62;
rewrite: ruleset  0 returns: $# smtp $@ 4 . 5 . 6 . 8 $: me &#60; @ 4 . 5
. 6 . 8 &#62;
&#62;</PRE
></TD
></TR
></TABLE
><P
>Merk op dat toen ik me@4.5.6.7 testte, het de mail op de lokale
machine bezorgde, terwijl me@.4.5.6.8 uit handen werd gegeven aan de smtp
mailer.
Dat is de juiste response.</P
><P
>Alles is nu ingesteld.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="ACKNOWLEDGEMENTS"
></A
>Erkenningen</H2
><P
>Met dank aan al degenen die dit geweldige werk hebben gedaan betreft Linux en IP Aliasing. 
En vooral dank aan Juan Jose Ciarlante voor het verduidelijken van mijn vragen.</P
><P
>Eer komt toe aan de uitblinkende programmeurs!</P
><P
>Email me via <TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:h.pillay@ieee.org"
><A
HREF="mailto:h.pillay@ieee.org"
TARGET="_top"
>h.pillay@ieee.org</A
></A
>&#62;</TT
>
als je dit document nuttig vond of suggesties hebt ter verbetering.</P
><P
>Veel plezier.</P
><P
>Wellicht dat je de
			<A
HREF="http://www.linuxdoc.org/HOWTO/Networking-Overview-HOWTO.html"
TARGET="_top"
>De
			Linux Networking Overview HOWTO</A
>
			wilt raadplegen voor extra informatie over netwerken.</P
></DIV
></DIV
></BODY
></HTML
>