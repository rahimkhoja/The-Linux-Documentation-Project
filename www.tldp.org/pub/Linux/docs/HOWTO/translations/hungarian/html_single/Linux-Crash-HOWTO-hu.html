<HTML
><HEAD
>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-2">
<TITLE
>Linux Crash HOGYAN</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2">Linux Crash HOGYAN</H1
><H3
CLASS="AUTHOR"
><A
NAME="AEN4"
>Norman Patten</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>nepatten@us.ibm.com</P
></DIV
></DIV
><P
CLASS="PUBDATE"
>2002.01.30<BR></P
><DIV
CLASS="REVHISTORY"
><TABLE
WIDTH="100%"
BORDER="0"
><TR
><TH
ALIGN="LEFT"
VALIGN="TOP"
COLSPAN="3"
><B
>Verziótörténet</B
></TH
></TR
><TR
><TD
ALIGN="LEFT"
>Verzió: 1.0</TD
><TD
ALIGN="LEFT"
>2002.01.30</TD
><TD
ALIGN="LEFT"
>Átdolgozta: NM</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Elsõ kiadás.</TD
></TR
></TABLE
></DIV
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN11"><P
></P
><P
>Ez a dokumentum az LKCD (Linux Kernel Crash Dump) csomag telepítését és használatát írja le. </P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Tartalomjegyzék</B
></DT
><DT
>1. <A
HREF="#INTRO"
>Bevezetés</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="#COPYRIGHT"
>Szerzõi jog és licenc</A
></DT
><DT
>1.2. <A
HREF="#AEN32"
>Magyar fordítás</A
></DT
></DL
></DD
><DT
>2. <A
HREF="#HOWITWORKS"
>Hogyan mûködik az LKCD</A
></DT
><DD
><DL
><DT
>2.1. <A
HREF="#WHATYOUNEED"
>Mire van szükséged?</A
></DT
></DL
></DD
><DT
>3. <A
HREF="#INSTALL"
>Az lkcd telepítése</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="#AEN50"
>Telepítés forráskódból</A
></DT
><DT
>3.2. <A
HREF="#AEN60"
>Az LKCD programok fordítása és telepítése</A
></DT
><DT
>3.3. <A
HREF="#AEN66"
>Telepített állományok</A
></DT
><DT
>3.4. <A
HREF="#AEN69"
>Az LKCD telepítése RPM csomagból</A
></DT
><DT
>3.5. <A
HREF="#AEN73"
>A kernel foltozása</A
></DT
><DT
>3.6. <A
HREF="#AEN82"
>A kernel fordítása és telepítése</A
></DT
></DL
></DD
><DT
>4. <A
HREF="#SETUP"
>A crash beállítása, tesztelése és futtatása</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="#AEN93"
>A crash dump beállítása</A
></DT
><DT
>4.2. <A
HREF="#AEN100"
>A crash tesztelése</A
></DT
><DT
>4.3. <A
HREF="#AEN107"
>A crash futtatása</A
></DT
></DL
></DD
></DL
></DIV
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="INTRO">1. Bevezetés</H2
><P
>    Az <STRONG
>LKCD (Linux Kernel Crash Dump)</STRONG
>
projekt kernel foltok és alkalmazások együttese, mely lehetõvé teszi a kernel memóriatartalmának elmentését kernel pánik esetén. A kernel állapotát tartalmazó állomány a mellékelt alkalmazásokkal együtt lehetõvé teszi a kernel pánik utólagos hibakeresését. A legtöbb fizetõs Unix operációs rendszert hasonló crash alkalmazásokkal szállítják, de ez a csomag meglehetõsen új a Linuxban, és kézzel kell hozzáadni. Az LKCD alkalmazás nem alkalmas megfelelõ információk összegyûjtésére hardver okozta pánik vagy szegmenshiba esetén. A teljes LKCD csomag letölthetõ a 
    <A
HREF="http://lkcd.sourceforge.net/"
TARGET="_top"
>http://lkcd.sourceforge.net/</A
> oldalról.
    </P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="COPYRIGHT">1.1. Szerzõi jog és licenc</H3
><P
>This document is copyrighted (c) 2002 by Norman Patten.
Ezen dokumentum másolása, terjesztése és/vagy módosítása engedélyezett a GNU Free Documentation License 1.1 változata, vagy bármelyik késõbbi, a Free Software Foundation által közzétett változat feltételei szerint; állandó fejezetek nélkül, elõlapi és hátoldali szöveg nélkül. A licenc másolata elérhetõ a <A
HREF="http://www.gnu.org/copyleft/fdl.html"
TARGET="_top"
> http://www.gnu.org/copyleft/fdl.html</A
> oldalon. </P
><P
>A Linux védjegy Linus Torvalds tulajdona. Az lkcd a Silicon Graphics Inc. által meghatározott feltételek szerint terjeszthetõ.</P
><P
>Visszajelzést a 
      <A
HREF="mailto:nepatten@us.ibm.com"
TARGET="_top"
><I
CLASS="CITETITLE"
>nepatten@us.ibm.com</I
></A
> címre lehet küldeni.
      </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN32">1.2. Magyar fordítás</H3
><P
>A magyar fordítást <A
HREF="mailto:zfuri@avaya.com_NO_SPAM"
TARGET="_top"
>Furi Zoltán</A
> készítette (2003.04.15).
A lektorálást <A
HREF="mailto:dacasa@freemail.hu_NO_SPAM"
TARGET="_top"
>Daczi László</A
> végezte el (2003.04.16).
Bármilyen fordítással kapcsolatos észrevételt a <A
HREF="mailto:linuxhowto@sch.bme.hu_NO_SPAM"
TARGET="_top"
>linuxhowto@sch.bme.hu</A
> címre küldjetek.
A dokumentum legfrissebb változata megtalálható a <A
HREF="http://tldp.fsf.hu/index.html"
TARGET="_top"
>Magyar Linux Dokumentációs Projekt</A
> honlapján.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="HOWITWORKS">2. Hogyan mûködik az LKCD</H2
><P
>Amikor a kernel olyan hibával találkozik amelyet nem tud lekezelni, meghívja a "panic" (pánik) függvényt. Ez a pánik az LKCD-ben egy ún. kernel dump-ot eredményez, ekkor a kernel memóriájának a tartalma egy elõre kijelölt, ún. dump területre másolódik. Dump eszközként alapból az elsõdleges swap terület van beállítva. A kernel nem teljes mértékben mûködõképes ekkor, de még elegendõ mértékben ahhoz, hogy kimásolja a memória tartalmát a lemezre. Miután a dump befejezte a memória tartalmának másolását a lemezre, a rendszer újraindul. Amikor a rendszer újraindul, új crash dump fájlt keres. Ha talál, akkor átmásolja azt a dump helyérõl egy másik partícióra, alapból a "/var/log/dump" könyvtárba. Az állomány másolása után a rendszer folytatja a normális indulási folyamatot. A vizsgálatokat egy késõbbi idõpontban el lehet végezni. </P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="WHATYOUNEED">2.1. Mire van szükséged?</H3
><P
>Az <TT
CLASS="FILENAME"
>lkcd-kernelxxx.diff</TT
> fájlra a kernel foltozásához. A támogatott kernelverzió folyamatosan változik. Az <TT
CLASS="FILENAME"
>lkcdutils-xx.src.rpm</TT
>  tartalmazza az alkalmazás forráskódját és a beállításhoz, illetve a crash adatok olvasásához szükséges programokat. E szöveg írásának idején egy futtatható i386 rpm csomag elérhetõ az  <A
HREF="http://lkcd.sourceforge.net/"
TARGET="_top"
>lkcd.sourceforge.net</A
> webhelyen, de így is szükséged lesz az indításhoz a szkriptekre a forrás rpm csomagból. </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="INSTALL">3. Az lkcd telepítése</H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="AEN50">3.1. Telepítés forráskódból</H3
><P
>      Szerezd be az <TT
CLASS="FILENAME"
>lkcdutils-xxx.src.rpm</TT
> csomagot  és telepítsd az <B
CLASS="COMMAND"
>rpm -i kcdutils-xxx.src.rpm</B
> paranccsal.
Ez egy <TT
CLASS="FILENAME"
>lkcdutils-xxx.tar.gz</TT
> nevû fájlt helyez az <TT
CLASS="FILENAME"
>/usr/src/redhat/SOURCES</TT
> könyvtárba. Ez a fájl az lkcd források tömörített tar állománya. Csomagold ki a forrást egy tetszõleges könyvtárba (például "<TT
CLASS="FILENAME"
>/usr/src</TT
>" a <B
CLASS="COMMAND"
>tar -zxvf kcdutils-xxx.src.rpm</B
> paranccsal.  Ez létre fogja hozni a "<TT
CLASS="FILENAME"
>kcdutils-xxx</TT
>" könyvtárat, amelyben az LKCD csomag részeinek forráskódja lesz.
      </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN60">3.2. Az LKCD programok fordítása és telepítése</H3
><P
>Az LKCD a hagyományos GCC fordítót és make fájlokat használja. A programok fordításához lépj be LKCD forráskönyvtárába, és futtasd a <B
CLASS="COMMAND"
>./configure</B
> szkriptet a konfigurációs állományok elkészítéséhez.  A következõ lépés a <B
CLASS="COMMAND"
>make</B
>  futtatása az alkalmazás fordításához, és végül futtasd a <B
CLASS="COMMAND"
>make install</B
> parancsot  a programok és kézikönyv oldalak telepítéséhez.
      </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN66">3.3. Telepített állományok</H3
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>  /etc/sysconfig/dump             # A dump konfigurációs állománya
  /sbin/lcrash                    # A crash alkalmazás
  /sbin/lkcd                      # Szkript a crash konfigurálására és mentésére
  /sbin/lkcd_config               # A dump konfigurációs programja
  /sbin/lkcd_ksyms                # A kernel szimbólumok visszaállító programja  
  /usr/include/sial_api.h         # A SIAL API header állománya
  /usr/lib/libsial.a              # Simple Image Access Language függvénykönyvtár
  /usr/man/man1/lcrash.1          # lcrash kézikönyv oldalak
  /usr/man/man1/lkcd_config.1     # lkcd_config kézikönyv oldalak
  /usr/man/man1/lkcd_ksyms.1      # lkcd_ksyms kézikönyv oldalak
  /usr/share/sial/lcrash/ps.sial  # A SIAL ps parancsának implementációja
      </PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN69">3.4. Az LKCD telepítése RPM csomagból</H3
><P
>      Telepítheted az elõre lefordított programokat rpm csomagból az
      <B
CLASS="COMMAND"
>rpm -i kcdutils-xxx.rpm</B
> futtatásával. Azonban még foltozni kell a kernelt, és telepíteni az indító szkriptet. Egyébként kihagyhatod az alkalmazás fordításának lépéseit. </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN73">3.5. A kernel foltozása</H3
><P
>A következõ lépés a kernel foltozása és újrafordítása. Foltoznod kell a kernel forrást az  a <A
HREF="http://lkcd.sourceforge.net/"
TARGET="_top"
>http://lkcd.sourceforge.net/</A
> oldalról letöltött <TT
CLASS="FILENAME"
>lkcd-xxx.diff</TT
> fájlal.  Másold a foltot ugyanabba a könyvtárba, ahol a kerneled forrása van, és futtasd a <B
CLASS="COMMAND"
>patch -p0 &#60; lkcd-kernelxxx.diff</B
> parancsot.  Gyõzõdj meg róla, hogy a folt verziója azonos a használt kernelével. A következõ lépésben a kernel konfigurálásával engedélyezned kell a crash dump támogatást. Alapbeállításban a crash támogatás, miután alkalmaztad a foltot, ki van kapcsolva. Ha a  <B
CLASS="COMMAND"
>make menuconfig</B
> vagy a <B
CLASS="COMMAND"
>make xconfig</B
> parancsot használod, az "LKCD support" opció a "kernel hacking" fejezet alatt található. Szükséged lehet még további opciók engedélyezésére. További részletekért olvasd el a <A
HREF="http://tldp.org/HOWTO/Kernel-HOWTO.html"
TARGET="_top"
>The Linux Kernel HOWTO</A
> (Linux kernel HOGYAN) leírást . </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN82">3.6. A kernel fordítása és telepítése</H3
><P
>      A következõ lépés a crash opcióval engedélyezett kernel fordítása és telepítése. A kernel forráskönyvtárban futtasd egymás után a következõ parancsokat: </P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
> 
  make depend 
  make install 
  make modules
  make modules_install
      </PRE
></FONT
></TD
></TR
></TABLE
><P
>Ez lefordítja és telepíti az új kernelt, de neked kell átmásolnod a <TT
CLASS="FILENAME"
>Kerntypes</TT
> állományt a kernel forráskönyvtárból a  <TT
CLASS="FILENAME"
>/boot</TT
>  könyvtárba. Szükség lesz még a  <TT
CLASS="FILENAME"
>lilo.conf</TT
>  állomány szerkesztésére is, hogy legyen benne az új kerneledre mutató bejegyzés is. További információért olvasd el a <A
HREF="http://tldp.org/HOWTO/Kernel-HOWTO.html"
TARGET="_top"
>http://www.tldp.org/HOWTO/Kernel-HOWTO.html</A
> leírást. </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="SETUP">4. A crash beállítása, tesztelése és futtatása</H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="AEN93">4.1. A crash dump beállítása</H3
><P
>A swap partícióra írt core állomány elmentéséhez, azt (mármint a core fájlt &#8211; a lektor) az indulási folyamat során a swap partíció aktiválása elõtt át kell másolni egy másik partícióra. Ennek végrehajtásához a <TT
CLASS="FILENAME"
>sysinit</TT
> 
indítóállományt meg kell változtatni. Az lkcd forrás tartalmaz egy 
<TT
CLASS="FILENAME"
>scripts</TT
> könyvtárat, amely foltokat tartalmaz különbözõ sysinit indító szkriptekhez. Ezek a foltok hozzáadják az indító szkripthez a  <B
CLASS="COMMAND"
>lkcd config</B
> és az <B
CLASS="COMMAND"
>lkcd save</B
> parancsokat , ezek engedélyezik a crash dump szolgáltatást, illetve a létezõ crash dump fájl elmentésérõl gondoskodnak.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN100">4.2. A crash tesztelése</H3
><P
>Az új crash beállítás tesztelése érdekében, pánik kieszközöléséért, fordítsd le a következõ forrásprogramot a <B
CLASS="COMMAND"
>cc -c -I/usr/src/linux/include panic.c</B
> paranccsal. A <TT
CLASS="FILENAME"
>panic.o</TT
> modul lefordítása után pánik elõidézéséhez csak töltsük be azt <B
CLASS="COMMAND"
>insmod panic.o</B
> paranccsal. </P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>  ### panic.c ###########################

  #define __KERNEL__
  # MODULE 

  # include init_module(void)

  int init_module (void)
  {
      panic(" panic has been called");
      return 0;
  }
      </PRE
></FONT
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN107">4.3. A crash futtatása</H3
><P
>A core állomány megtekintéséhez futtasd a <B
CLASS="COMMAND"
>lcrash</B
> parancsot a következõ paraméterekkel: </P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>  <B
CLASS="COMMAND"
>lcrash [ System.map fájl ] [ dump fájl ] [ Kerntypes ]</B
>

  Példa:

  <B
CLASS="COMMAND"
>lcrash /boot/System.map ./dump.1 /boot/Kerntypes</B
>
      </PRE
></FONT
></TD
></TR
></TABLE
><P
>Néhány percet igénybe fog venni a kernel állomány betöltése a memóriába, majd kidob a crash parancssorba. A crash parancssorba beírhatsz egy <TT
CLASS="USERINPUT"
><B
>?</B
></TT
> karaktert a használható parancsok megtekintéséhez. </P
></DIV
></DIV
></DIV
></BODY
></HTML
>
