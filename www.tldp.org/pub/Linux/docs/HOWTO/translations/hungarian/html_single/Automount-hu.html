<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.21">
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-2">

 <TITLE>Önmûködõ felcsatolás mini-HOGYAN</TITLE>
</HEAD>
<BODY>
<H1>Önmûködõ felcsatolás mini-HOGYAN</H1>

<H2>Rahul Sundaram,
<A HREF="mailto:rahulsundaram@yahoo.co.in">rahulsundaram@yahoo.co.in</A></H2>v1.6, 2002.12.27
<HR>
<EM>Itt elolvashatod, hogyan kell az autofs önmûködõ fájlrendszer-felcsatolást beállítani.</EM>
<HR>
<H2><A NAME="s1">1. Bevezetõ</A></H2>

<H2><A NAME="ss1.1">1.1 Kiadások története</A>
</H2>

<P>
<UL>
<LI>1.5-ös változat alatt - Don munkája.</LI>
<LI>1.5-ös változat - Szerzõi jog és egyéb mellékes részletek Rahul által hozzáadva. Sundaram átveszi a karbantartást.</LI>
<LI>1.5.1-es verzió - VFAT kérdések mélyebb részletességgel kidolgozva.</LI>
<LI>1.5.2-es verzió - Kiadások története és egyéb apró javítások.</LI>
<LI>1.6-os verzió - Néhány kérdés és válasz hozzáadása.</LI>
</UL>
</P>
<H2><A NAME="ss1.2">1.2 Automount - mi ez és miért használjam?</A>
</H2>

<P>Az önmûködõ felcsatolás egy folyamat, ahol a egyes fájlrendszerek felcsatolását és
lecsatolását egy démon végzi. Ha a fájlrendszer nincsen felcsatolva és a
felhasználó megpróbálja elérni, akkor az önmûködõen felcsatolódik. Ez
különösen hasznos nagy hálózati környezetben és keresztbe csatolt
fájlrendszerek esetén (fõleg amikor nincs minden gép állandóan hálózatra
kapcsolva). Nagyon hasznos cserélhetõ lemezes meghajtók
használatakor is. Mondok más példát, ha eddig nem gyõzött meg: dos
fájlrendszerek felcsatolása ASCII konverzióval, majd anélkül. Ha új Linux
felhasználó vagy, nem tudod, mi az a felcsatolás és mi a démon, akkor tanulmányozd a
vonatkozó dokumentációkat.</P>

<H2><A NAME="ss1.3">1.3 Az önmûködõ felcsatolás fajtái</A>
</H2>

<P>Az önmûködõ felcsatolás két megvalósítása lelhetõ fel  Linux alatt: az <EM>AMD</EM> és az <EM>autofs</EM>. Az AMD egy önmûködõ felcsatoló-démon, a felszínen a SunOS AMD programhoz hasonlatosan dolgozik. Felhasználói szinten megvalósított megoldás, azaz nem része a rendszermagnak. A rendszermagnak nem szükséges részt vennie abban, ha NFS-t csatolsz a helyi gépre, AMD démonnal,
ami irányítja az összes önmûködõ csatolást az NFS rendszeren keresztül. Az Autofs egy újabb fejlesztés, de ez már része a rendszermagnak. A mag fájlrendszer kódja tudja, hol vannak a csatolási pontok a normál fájlrendszerben, az Automount program pedig kezeli ezt. Csak az autofs megoldást fogjuk megvizsgálni.</P>

<H2><A NAME="s2">2. Adminisztráció</A></H2>

<H2><A NAME="ss2.1">2.1 Szerzõi jogok</A>
</H2>

<P>A mini-HOGYAN szerzõi jogait Rahul Sundaram birtokolja. Minden jog fenntartva. Erre a dokumentumra 
a 
<A HREF="http://tldp.org/copyright.html">Linux Dokumentációs Projekt licensze</A> vonatkozik. A kereskedelmi felhasználás engedélyezett, de értesíts engem errõl. Segítséget adok bárkinek, aki
lefordítaná a dokumentumot. Ha szükséged van a licenszfeltételek átlépésére, 
lépj kapcsolatba velem a 
<A HREF="mailto:Rahulsundaram@yahoo.co.in">rahulsundaram@yahoo.co.in</A> e-mail címen. A legújabb verziót mindig a The Linux Documentation Project 
honlapján találod meg, 
<A HREF="http://tldp.org/HOWTO/mini/Automount.html">http://tldp.org/HOWTO/mini/Automount.html</A>.</P>

<H2><A NAME="ss2.2">2.2 A felelõsség teljes kizárása</A>
</H2>

<P>Habár a legjobb tudásom szerint írtam meg ezt a HOGYANt, nem vagyok felelõs 
semmiféle kárért, amit ebben a dokumentumban foglaltakra alapozott tevékenység 
okozott. Lehetetlen letesztelni minden konfiguráción a dolgokat. Ezért
lehet, hogy néhány ötlet nem mûködik a Te rendszereden. Ha bármi hibát
találsz, értesíts engem. Javítom, amint lehetséges.</P>
<P>A dokumentum olyan, amilyen. Nagy munka árán született meg, de csak a saját
felelõsségedre használd. Semmilyen esetben sem vállalok felelõsséget
azért, ha eme dokumentum alapján bármi kárt teszel a rendszeredben.</P>

<H2><A NAME="ss2.3">2.3 Magyar fordítás</A>
</H2>

<P>A magyar fordítást 
<A HREF="mailto:aaron@szentimre.hu_NO_SPAM">Novák Áron</A> készítette (2003.02.10).
A lektorálást 
<A HREF="mailto:laca@janus.gimsz.sulinet.hu_NO_SPAM">Szijjártó László</A> végezte el (2003.03.06).
A fordítás javítva (R1; 2003.03.07).
Bármilyen fordítással kapcsolatos észrevételt a 
<A HREF="mailto:linuxhowto@sch.bme.hu_NO_SPAM">linuxhowto@sch.bme.hu</A> címre küldjetek.
A dokumentum legfrissebb változata megtalálható a 
<A HREF="http://tldp.fsf.hu/index.html">Magyar Linux Dokumentációs Projekt</A> honlapján.</P>
<H2><A NAME="s3">3. Telepítés</A></H2>

<P>Az Autofs rendszermag-területen megvalósított eszköz, azaz a rendszermagnak tartalmaznia kell az Autofs támogatást. Az összes változat a 2.2.xx verziótól kezdõdõen tartalmazza ezt.</P>
<P>Szükséges még az Automount program és a konfigurációs fájlok. A RedHat (és Debian - 
<A HREF="mailto:toldim@index.hu_NO_SPAM">Toldi Miklós</A> megj.) összeállításban elérhetõek ezek a csomagok (lehet, hogy már telepítéskor felkerült).</P>

<H2><A NAME="s4">4. Beállítás</A></H2>

<P>Az RPM csomagokat könnyedén telepítheted, de most jön az a rész, ami nem egyértelmû, ha nem csináltál még ilyet.</P>

<P>Az /etc könyvtárban találhatók az <CODE>auto.master</CODE> és az <CODE>auto.misc</CODE> fájlok.
Az alapértelmezett auto.master fájl így néz ki:
<PRE>
/auto   /etc/auto.misc  --timeout=60
</PRE>
</P>
<P>Az elsõ bejegyzés nem a csatolási pont. Ez a csatolási pontok gyûjteménye,
gyûjtõkönyvtára a második bejegyzésre vonatkozóan. A harmadik érték azt határozza meg, 
hogy 60 másodpercnek kell eltelni használat nélkül ahhoz, hogy az eszközt önmûködõen 
leválassza. Lecsatolás elõtt majd mindig be kell fejezned a lemez használatát.</P>
<P>Az auto.misc egy "térképfájl". Bármilyen nevet adhatsz neki. Ez éppen auto.misc névre hallgat, mert eredetileg a /misc könyvtárat irányította. A térképfájlokat az auto.master fájlban lehet definiálni (akár többet is). 
Az én auto.misc fájlom így néz ki:
<PRE>
kernel          -ro,soft,intr           ftp.kernel.org:/pub/linux
cd              -fstype=iso9660,ro      :/dev/cdrom
zip             -fstype=auto            :/dev/hdd4
floppy          -fstype=vfat            :/dev/fd0
</PRE>
</P>
<P>Az elsõ oszlop (a kulcs) a felcsatolási pont. Ebben az esetben /auto/floppy 
vagy bármi egyéb. A középsõ bejegyzés az opciók helye, olvasd el a mount man
oldalt ezzel kapcsolatban. Az utolsó oszlop pedig a felcsatolandó fájlrendszert
tartalmazza. A "kernel" bejegyzés egy NFS csatolás. A kettõspont minden esetben 
azt jelöli, hogy a helyi gépen található az eszköz.</P>


<H2><A NAME="s5">5. Lassú a lecsatolás</A></H2>

<P>Lehet, hogy feltûnt neked a 60 másodperces idõtúllépés, és azt gondolod: <EM>ez elég hosszú 
idõ ahhoz, hogy a floppy kiadására várjak... Inkább csak szinkronizálom a lemezeket és kiszedem 
felcsatolt állapotban, és senki se veszi észre.</EM> Javasolj <CODE>õrültebb módszert!</CODE>
Elõször is, be tudod állítani az idõtúllépést. De nem biztos, hogy eredményre vezet, ha 15
másodperces lecsatolást állítasz be. A rendszeredtõl függõen elképzelhetõ, hogy egyszerûen 
kiadod az umount parancsot normál felhasználóként. Van egy másik módja, hogy rávedd az 
Automount programot a lecsatolásra. Ha egy (program leállítással) <CODE>SIGUSR1</CODE> jelet 
kap az Automount folyamat, minden lecsatolásra kerül, ahol ez lehetséges. De mielõtt 
"Válassz le mindent!" gombot gyártanál az ablakkezelõ rendszeredhez, jó ha tudod, 
hogy ez nem valósítható meg.</P>
<P>Az Automount folyamat root felhasználóként fut és kizárólag root
felhasználótól fogad el jeleket.(ez az, amiért normál felhasználó nem tudja
újraindítani a gépet - a fordító). Félmegoldás, ha normál felhasználóknak is
lehetõséget adunk a fel- és lecsatoláshoz. Egyszerûen kivitelezhetõ ez egy
suid-root C programmal, ami elvégzi a piszkos munkát. A sudo-val a
felhasználók is küldhetnek megfelelõ kill jelet. Az egyetlen probléma, hogy
a sudo nem teszi lehetõvé a folyamatokon belül alparancsok (subcommand) használatát,
amivel ki lehet keresni az aktuális PID-et (folyamatazonosítót). Lehetséges,
hogy van killall parancsod, amivel már meg tudod ezt tenni (a következõt
írd be a /etc/sudoers fájlba - a lektor):</P>
<P>
<PRE>
ALL     ALL=NOPASSWD:/usr/bin/killall -USR1 automount
</PRE>
</P>
<P>Egyébként engedélyezhetjük a felhasználóknak a -SIGUSR1 jel küldését az összes
folyamathoz. Ez különféle változásokat idéz elõ: néhány ablakkezelõ újraindul, 
de az xemacs-ot leállítja. Reménykedjünk, hogy nincs puffer túlcsordulás a killall-ban...</P>

<H2><A NAME="s6">6. Kérdések</A></H2>



<H2><A NAME="ss6.1">6.1 Nem látom az /auto/floppy-t és más felcsatolási pontokat</A>
</H2>

<P>Ha az automount rendesen be van állítva, akkor a felcsatolási pont csak akkor látszik ha az használatban van, amelyik nincs, az rejtve marad. Ha a könyvtárakat grafikus felületen tallózod, akkor be kell gépelned a könyvtárat, 
a legtöbb program megpróbál átváltani arra, így az eszköz fel lesz csatolva. Nincs lehetõség válogatni a láthatatlan felcsatolási pontokból, ez
talán az autofs legnagyobb hátránya. Ha viszont nem ez a gond, hanem
tényleg nem mûködik a csatolás, akkor szerkeszd a konfigurációs
állományokat.(Segítségképpen: az egyik .c-re végzõdik)</P>
<P>Néhány ember azzal próbálkozik, hogy egy szimbolikus linket hoz létre az önmûködõ felcsatolás könyvtárára. Ez általában azt eredményezi, hogy néhány program nem látja a könyvtárat (ha a felcsatolás mûködik, ez a kérdésre a válasz), de egyébként felcsatolja a fájlrendszert, ha listázod a könyvtárat.</P>

<H2><A NAME="ss6.2">6.2 Hol látom, hogy mi van felcsatolva?</A>
</H2>

<P>A <CODE>df</CODE> vagy a <CODE>mount</CODE>(opciók nélkül) parancs kiírja. A mount ráadásként a felcsatolás beállításait is megmutatja.</P>



<H2><A NAME="ss6.3">6.3 Beraktam egy win95 "vfat" fájlrendszerû lemezt, de hagyományos FAT rendszerûként ismeri fel</A>
</H2>

<P>Ez nem az automount hibája. Az önmûködõ felcsatolás nem próbálja meg vfat-ként kezelni a fájlrendszert, ha azt sikeresen csatolta MS-DOS típusúként. A VFAT egy kiterjesztése a FAT fájlrendszernek. A hosszú fájlnevek használatát biztosítja Windows 95 és Windows NT operációs rendszerekhez.</P>
<P>Egy mount program fejlesztõ szerint, amióta a mount csak egy illesztõfelület a rendszerhíváshoz, amelyiknek kötelezõ megadni a fájlrendszer típusát, a felhasználón múlik a fájlrendszer típus felismerése. Ahelyett, hogy a mount végigpróbálgatná sorrendben a fájlrendszer típusokat felcsatolásnál, inkább a jelenlegi "heurisztikus" módszer kerül elõtérbe. Néhány felhasználó egyszerûen nem fordítja bele az msdos támogatást a rendszermagba; ezt megelõzendõ az vfat-ot elõbb próbálja ki az msdos-nál. Ez a legtöbb embernél mûködik is, azonban néhányuknak msdos fájlrendszerre van szükségük.
Ezt így lehet kikerülni: átmásolod a /proc/filesytems fájlt az /etc/filesystems-be és átszerkeszted úgy, hogy a vfat elõbb legyen, mint az msdos. (kösz Mark)</P>
<P>Ariel (aslinux@dsgml.com) írta:</P>
<P>"
hogy a vfat-ot elõbb próbálja a fat-nál, csak hozd létre(vagy szerkeszd át)
az /etc/filesystems fájlt</P>
<P>A lista prioritás szerint van rendezve, ahogyan a fájlrendszer
típusokat
végigpróbálja.</P>
<P>Hozd létre a fájlt: cp /proc/filesystems /etc/filesystems.
Változtasd meg a sorrendet a kedvenc szövegszerkesztõddel. Azokat a
fájlrendszer-típusokat, amiket gyakran használsz, rakd elõre. Ettõl
gyorsabban tudod majd felcsatolni azokat. És persze rakd a vfat-ot az msdos
elé. Gyõzõdj meg róla, hogy mindkettõt tartalmazza, mert lehetséges, hogy
szükséged lesz nem VFAT fájlrendszerek felcsatolására.
Az enyém így néz ki:</P>
<P>ext2
vfat
msdos
iso9660</P>
<P>****</P>
<P>Egy másodperces idõtúllépést használok a cserélhetõ lemezes meghajtókhoz.
Hozz létre különálló "térképeket" különbözõ idõtúllépéssel, amire éppen
szükséged van.</P>
<P>Azt gondolod: egy másodperc? Az rengeteg erõforrást pazarol! - de nem fog.
Emlékezz arra, hogy a rendszer lecsatolja a nem használt dolgokat.</P>
<P>Az egy másodperces lecsatolás azt jelenti, hogy amint nincsen használatban
az eszköz, lecsatolja.</P>
<P>A 'sync'-et el ne felejtsd a floppy-hoz beállítani!</P>
<P>Például:</P>
<P>floppy      -fstype=auto,sync,user,umask=002,gid=floppy     :/dev/fd0"</P>
<P>Ez a korrekt válasz a kérdésre.</P>

<H2><A NAME="ss6.4">6.4 A fájlrendszeremet (<CODE>/auto/grumblesmurf</CODE>) felcsatoltam és a <CODE>kill -SIGUSR1</CODE> nem csatolja le.</A>
</H2>

<P>Akkor azt valami használja. Lehet, hogy a root sem tudja majd lecsatolni
manuálisan. Ha te csatoltad fel, (például: senki más nem
használhatta), akkor nézz egy héj után, ami ebben a könyvtárban áll. Ha
ilyen nincs, akkor lehet, hogy egy könyvtártallózó program a hibás. Ha már
feladtad a keresést, próbáld ki a fuser parancsot. Segíthet.(Ez képes
beazonosítani azt, hogy egy adott könyvtárat vagy fájlt milyen folyamatok
használnak - a fordító)</P>

<H2><A NAME="ss6.5">6.5 Mi történik, ha a / könyvtárat adom meg az automounter programnak?</A>
</H2>

<P>Nem ajánlom. Ha /grumblesmurf könyvtárat szeretnél, ajánlom helyette a szimbolikus hivatkozást, ami sokkal biztonságosabb.</P>

<H2><A NAME="ss6.6">6.6 Lehet két térképfájlom azonos könyvtárban?</A>
</H2>

<P>Legjobb tudomásom szerint nem. Próbáld meg, hogy egy térképfájlt használsz különbözõ beállításokkal a bejegyzésekhez.</P>

<H2><A NAME="ss6.7">6.7 SuSE összeállítást használok és szükségem volna <CODE>---timeout</CODE>-ra a <CODE>--timeout</CODE> helyett</A>
</H2>

<P>Egy másik megoldás az "idõtúllépés nem mûködik" problémára: egy <CODE>-t idõ</CODE> kapcsoló kell az autofs scriptnek.</P>

<H2><A NAME="ss6.8">6.8 Hogyan tudom a jogosultságokat és a tulajdonosokat beállítani a FAT fájlrendszeren?</A>
</H2>

<P>Nézd át a mount man oldalait az opciókért. Ami kellhet: uid=érték vagy umask=érték. Egy valami nem mûködik FAT esetén: mode=érték. Bocs, ez van. Értesítsd azokat az embereket, akik szoktak fájlrendszereket csatolni.</P>

<H2><A NAME="ss6.9">6.9 Hogyan lehet tallózni egy autofs könyvtárat, amikor az alkönyvtárai nincsenek felcsatolva?</A>
Philippe Froidevaux (philippe.froidevaux@unifr.ch) írta:</H2>

<P>"Az autofs szerzõje mondja "nincs megoldás"</P>
<P>egy jó ötlet (egy hírcsoportból):</P>
<P>"ne a /home/blauser -t csatold, hanem a /mount/.auto/blauser-t, aztán hozz
létre egy hivatkozást: /home/blauser -> /mount/.auto/blauser</P>
<P>Most már tallózhatod a /home könyvtárat, aztán amikor belépsz, 
csatolódik a blauser.</P>
<P>Azért van ezzel egy kis probléma: nem elegáns, mivel minden felhasználónál munkát jelent. (egy héjprogrammal persze automatizálható - a fordító)</P>
<P>Van másik megoldás, az AMD használata az autofs helyett. Tudnod kell, hogy az
AMD lassabb.</P>



<H2><A NAME="ss6.10">6.10 Kinek köszönhetem az autofs programot?</A>
</H2>

<P>Ez csak egy dokumentáció ami felhívja az emberek figyelmét arra, hogy
milyen nagyszerû az autofs és milyen egyszerû használni. Az eredeti
megvalósításhoz (AMD) képest az autofs remekül dokumentált. A fejlesztõk
fogadják ezért õszinte köszönetemet. Minden szerzõi jogot a Transmeta cég
birtokol, ezért nincsen stáblista, de Peter Anvin kompetens ember a
programmal kapcsolatban. Peter tartott egy elõadást az autofs-rõl a
LinuxWorld Expo rendezvényen, 1999. március 3-án.</P>

<H2><A NAME="ss6.11">6.11 Honnan tudhatok meg többet az önmûködõ fájlrendszer-csatlakoztatásról?</A>
</H2>

<P>Itt egy autofs útmutató: 
<A HREF="http://www.linuxhq.com/lg/issue24/nielsen.html">http://www.linuxhq.com/lg/issue24/nielsen.html</A>.
Ajánlom figyelmedbe még az am-utils leírást a 
<A HREF="http://www.cs.columbia.edu/~ezk/am-utils">http://www.cs.columbia.edu/~ezk/am-utils</A> honlapon.</P>

<H2><A NAME="ss6.12">6.12 Hogyan tudok kapcsolatba kerülni a fejlesztõkkel? Van levelezõlista autofs témában?</A>
</H2>

<P>Én nem tudok ilyesmirõl. Értesíts engem, ha vannak ez ügyben fejlemények.</P>

<H2><A NAME="ss6.13">6.13 Köszönetnyilvánítások, visszajelzés, ajánlás</A>
</H2>

<P>Köszönöm Don
<A HREF="mailto:don@sabotage.org">Don</A>nak (az email cím úgy tûnik nem él) az eredeti mini-HOGYANba fektetett munkáját.
Köszönöm Arielnek a win95 vfat témában nyújtott segítségét. Köszönöm az összes barátomnak a támogatását és azt, hogy türelmesek voltak velem,
míg befejeztem ezt a munkát. Légyszíves írj nekem, 
<A HREF="mailto:rahulsundaram@yahoo.co.in">Rahul Sundaram</A>-nek, ha bármi ötleted,
javaslatod van, vagy van valami jó leírásod amit hozzáadhatnék a dokumentumhoz. Köszönöm. Ezt a dokumentumot elhunyt szüleimnek
Mr. V. Sundaram-nek és Mrs. S. Soundara Sundaram-nek ajánlom.</P>
</BODY>
</HTML>
