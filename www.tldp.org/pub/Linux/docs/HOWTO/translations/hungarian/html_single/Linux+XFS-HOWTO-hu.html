<HTML
><HEAD
>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-2">
<TITLE
>Linux + XFS HOGYAN</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2">Linux + XFS HOGYAN</H1
><H2
CLASS="SUBTITLE"
>Szteroiddal fûtött Linux</H2
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
>Russel Ingram</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ringram@gargoylecc.com<br>
&nbsp;&nbsp;&nbsp;&nbsp;</P
></DIV
></DIV
><DIV
CLASS="REVHISTORY"
><TABLE
WIDTH="100%"
BORDER="0"
><TR
><TH
ALIGN="LEFT"
VALIGN="TOP"
COLSPAN="3"
><B
>Verziótörténet</B
></TH
></TR
><TR
><TD
ALIGN="LEFT"
>Verzió: v1.1</TD
><TD
ALIGN="LEFT"
>2002.05.12</TD
><TD
ALIGN="LEFT"
>Átdolgozta: ri</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Frissült az SGI cvs-rõl szóló információ, ami már a jelenlegi állapotot tükrözi.
     Számos változtatás, pontosítás történt az olvasói visszajelzések alapján.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Verzió: v1.02</TD
><TD
ALIGN="LEFT"
>2001.10.08</TD
><TD
ALIGN="LEFT"
>Átdolgozta: ri</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>A dokumentum néhány megjegyzéssel, blokkjegyzettel lett kibõvítve. Az "Utolsó simítások" 
	 fejezetben kijavítottam az utasítások leírásában levõ hibát. Az "XFS segédprogramok 
	 fordítása és telepítése" fejezet megjegyzésében az e2fsprogs-devel csomag libuuid.a 
	 csomagra változott.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Verzió: v1.01</TD
><TD
ALIGN="LEFT"
>2001.10.04</TD
><TD
ALIGN="LEFT"
>Átdolgozta: ri</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Hibajavítás az "Utolsó simítások" fejezetben, számos változás a külalakban.</TD
></TR
></TABLE
></DIV
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN28"><P
></P
><P
>    Ez a dokumentum leírja, hogyan építs fel  
    egy SGI XFS naplózó fájlrendszeren futó Linux rendszert.
   </P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Tartalomjegyzék</B
></DT
><DT
>1. <A
HREF="#AEN30"
>Bevezetés</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="#AEN32"
>Az XFS naplózó fájlrendszer bemutatása</A
></DT
><DT
>1.2. <A
HREF="#AEN35"
>Elõszó, visszajelzés, készítõk</A
></DT
><DT
>1.3. <A
HREF="#AEN43"
>Szerzõi jog és a felhasználás feltételei</A
></DT
><DT
>1.4. <A
HREF="#AEN51"
>Magyar fordítás</A
></DT
></DL
></DD
><DT
>2. <A
HREF="#AEN58"
>Elõkészületek az XFS támogatás telepítéséhez</A
></DT
><DD
><DL
><DT
>2.1. <A
HREF="#AEN60"
>A Linux 2.4.x-XFS forráskód letöltése</A
></DT
><DT
>2.2. <A
HREF="#AEN96"
>XFS támogatás: kernelbe fordítva vagy modulként betöltve?</A
></DT
></DL
></DD
><DT
>3. <A
HREF="#AEN113"
>Kernel beállítás és telepítés</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="#AEN115"
>A kernel beállítása az XFS támogatáshoz</A
></DT
><DT
>3.2. <A
HREF="#AEN122"
>A kernel és a modulok fordítása</A
></DT
><DT
>3.3. <A
HREF="#AEN127"
>Az új kernel és modulok telepítése</A
></DT
><DT
>3.4. <A
HREF="#AEN132"
>Egy új bejegyzés hozzáadása a lilo beállításokhoz, a beállítások érvényesítése</A
></DT
><DT
>3.5. <A
HREF="#AEN140"
>Az XFS segédprogramok fordítása és telepítése</A
></DT
><DT
>3.6. <A
HREF="#AEN154"
>Az új kernel indítása</A
></DT
></DL
></DD
><DT
>4. <A
HREF="#AEN161"
>A fájlrendszer lecserélése</A
></DT
><DD
><DL
><DT
>4.1. <A
HREF="#AEN164"
>A gyökérkönyvtár átmásolása</A
></DT
><DT
>4.2. <A
HREF="#AEN192"
>Utolsó simítások</A
></DT
></DL
></DD
></DL
></DIV
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="AEN30">1. Bevezetés</H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="AEN32">1.1. Az XFS naplózó fájlrendszer bemutatása</H3
><P
>     Ez a dokumentum leírja, hogyan lehet egy Linux rendszert felépíteni és futtatni 
     az SGI XFS naplózó fájlrendszeren. Idézet az XFS GYIK-ból:  "Az XFS naplózó 
     fájlrendszert az SGI fejlesztette ki az SGI IRIX operációs rendszerhez történõ
     alkalmazásra, és most a GPL keretein belül a Linux számára is használhatóvá vált. 
     A fájlrendszer különösen jól méretezhetõ, kihasználja a B-fa adta lehetõségeket a 
     nagyméretû, több részletben tárolt fájlok, és a különösen nagyméretû könyvtárak 
     tárolásához. A naplózó képesség azt jelenti, hogy búcsút mondhatunk az fsck 
     hibajavítására történõ várakozásra, vagy a fájlbejegyzési hiba miatti aggodalomnak." 
     Az XFS naplózó fájlrendszert az SGI alapvetõen a nagyteljesítményû kiszolgáló 
     rendszerek számára tervezte, ezért kapta a jelen leírás a "Szteroiddal fûtött Linux" alcímet.
    </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN35">1.2. Elõszó, visszajelzés, készítõk</H3
><P
>     Az Irix rendszeradminisztrátorok közösségének egészen friss tagjaként 
     valósággal szerelmese lettem az Irix számára kifejlesztett megbízható 
     fájlrendszernek (amely természetesen az XFS).  Mondanom sem kell, figyelemmel
     kísértem a fájlrendszer Linux-ra átírásáról szóló híreket, és már a kezdetektõl fogva
     arról álmodoztam, hogy Linux rendszeremet csakis XFS fájlrendszeren futtatom.
     A projekt már elérkezett arra a pontra, amikor ez valósággá válhat (valójában ez már
     közel egy évvel a jelen írás megszületése elõtt megtörtént). A nagyszámú programkészítési/
     programátültetési projekt ellenére a dokumentációk nem mindig olyan könnyen
     fellelhetõk, vagy érthetõek mint szeretnénk. Ez a leírás ezt a helyzetet próbálja meg 
     orvosolni.
 
   </P
><P
>     A jelen leírásban található információk Jason Walker és Russel Cattelan által 
     az XFS fejlesztõi listára küldött levelek gyûjteményén, az SGI Open Source 
     Development weboldalakon összegyûjtött információkon, valamint saját 
     (Russel Ingram) beállítási tapasztalataimon alapul.   
    </P
><P
>     Küldj nyugodtan egy e-mailt erre a címre: <TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:ringram@gargoylecc.com"
>ringram@gargoylecc.com</A
>&#62;</TT
> 
	 ha javítani valót találsz benne, vagy valamilyen információ/URL illetve egyéb hiányzik 
     belõle. Minél több visszajelzést kapok errõl HOGYANról, annál több segítséget 
     tudok nyújtani mindenkinek.   
    </P
><P
>     A leírás legfrissebb angol nyelvû változatát a következõ helyen találod: 
     <A
HREF="http://www.gargoylecc.com/Linux+XFS-HOWTO/t1.html"
TARGET="_top"
>      Gargoyle Computer Consulting
     </A
>.
    </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN43">1.3. Szerzõi jog és a felhasználás feltételei</H3
><P
>     A szerzõi jogokat Russel Ingram birtokolja; copyright (c) 2001; ez egy INGYENES 
     leírás. A GPL feltételei szerint te is szabadon terjesztheted.   
    </P
><P
>     Ennek a leírásnak a tartalma Russel legjobb tudása szerint megfelel a 
     valóságnak. Mivel azonban az XFS linuxos átiratát emberek készítették el, így 
     lehetnek benne tévedések, hibák ezek idõnként elõfordulnak.   
    </P
><P
>     Semmilyen személy, csoport vagy egyéb szervezet nem felelõs a számítógépe(i)dben 
     esett bármilyen kárért, amit az ebben a leírásban közölt információk felhasználása okozott.
     Azaz:
    </P
><P
>    </P
><P
>     <EM
>      A SZERZÕ NEM VÁLLAL FELELÕSSÉGET SEMMILYEN KÁRÉRT, AMELYET A JELEN LEÍRÁSBAN
      KÖZÖLT INFORMÁCIÓKRA ALAPOZOTT TEVÉKENYSÉG OKOZOTT.
     </EM
>
    </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN51">1.4. Magyar fordítás</H3
><P
>    A magyar fordítást <A
HREF="mailto:dacas@freemail.hu_NO_SPAM"
TARGET="_top"
>Daczi László</A
> készítette (2002.05.30).
    Bármilyen fordítással kapcsolatos észrevételt a <A
HREF="mailto:linuxhowto@sch.bme.hu_NO_SPAM"
TARGET="_top"
>linuxhowto@sch.bme.hu</A
> címre küldjetek.
    A lektorálást <A
HREF="mailto:tech.translation@axelero.hu_NO_SPAM"
TARGET="_top"
>Varga Zsolt</A
> végezte el (2002.06.27). A fordítás javítva 2002.10.29.-én.
    A dokumentum legfrissebb változata megtalálható a <A
HREF="http://tldp.fsf.hu/index.html"
TARGET="_top"
>Magyar Linux Dokumentációs Projekt</A
> honlapján.
   </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN58">2. Elõkészületek az XFS támogatás telepítéséhez</H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="AEN60">2.1. A Linux 2.4.x-XFS forráskód letöltése</H3
><P
>    Az SGI Open Source Development oldalai jelenleg az egyetlen olyan hely, ahol elérhetõ az XFS támogatás Linux alatt 
    használható forráskódja. Innen CVS-en keresztül töltheted le az anyagokat     
   </P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Megjegyzés"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>Megjegyzés</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>jelenleg két különbözõ változat érhetõ el:
     <P
></P
><UL
><LI
><P
>linux-2.5-xfs: fejlesztõi változat</P
></LI
><LI
><P
>linux-2.4-xfs: stabil, hibamentes változat</P
></LI
></UL
>
    </P
></TD
></TR
></TABLE
></DIV
><P
>    Az én tapasztalataim a 2.4 verzión alapulnak, de úgy gondolom, a fejlesztõi
	változatban is minden ugyanúgy mûködik. Mindkét változatot szinkronizálják a
	saját rendszermag-ágával, legalábbis annak fõ változataival.
   </P
><P
>    A kernel forrás letöltéséhez szükséges lépések a következõk:
   </P
><P
>    A. A Linux kernel forrása általában az /usr/src könyvtárban van, tehát elõször 
    lépj be ebbe a könyvtárba (vagy ahová a kernel forrást telepítetted - a ford.)
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ cd /usr/src   
    </PRE
></FONT
></TD
></TR
></TABLE
>	
   </P
><P
>    B. Állítsd be a CVSROOT környezeti változót, hogy az a megfelelõ CVS kiszolgálóra 
    mutasson     
   </P
><P
></P
><UL
><LI
><P
>      ha sh, bash, ksh, stb-t használsz...:   
      <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>       $ export CVSROOT=':pserver:cvs@oss.sgi.com:/cvs'    
      </PRE
></FONT
></TD
></TR
></TABLE
>
     </P
></LI
><LI
><P
>      Csh vagy tcsh használata esetén:     
      <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>       $ setenv CVSROOT  :pserver:cvs@oss.sgi.com:/cvs   
      </PRE
></FONT
></TD
></TR
></TABLE
>
     </P
></LI
></UL
><P
>    Ha gyakran szeretnéd frissíteni a kernelt, érdemes ezt beletenni a login
    scriptbe.
  
 </P
><P
>    C. Jelentkezz be a CVS kiszolgálóra.    
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ cvs login  (a jelszó: "cvs")   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><P
>    Ezt csak EGYSZER kell megtenned, nem minden alkalommal, amikor ezt a CVS-t használod.
   </P
><P
>    D. Töltsd le a linux-2.4-xfs forráskódot. Az elsõ alkalommal ez valahogy így 
    néz ki:   
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ cvs -z3 co linux-2.4-xfs    
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><P
>    Legközelebb csak le kell ellenõrizni a forrást, valahogy így...    
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ cvs -z3 update linux-2.4-xfs   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><P
>    ...majd frissíteni a nálad lévõ forráskódot a CVS kiszolgálón lévõ legfrissebb
    változatra.
 
  </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN96">2.2. XFS támogatás: kernelbe fordítva vagy modulként betöltve?</H3
><P
>    Az XFS támogatást modulként is lehetséges kernelbe fordítani, ami aztán RAM diszk és 
    néhány lilo konfigurációs beállítás segítségével mûködik is (nekem legalábbis így mondták).
    Én nem próbáltam ezt ki egyelõre, tehát nem tudom leírni ennek a menetét, ezért 
    idézek Russel Cattelan fejlesztõi levelezõlistára beküldött levelébõl:   
   </P
><A
NAME="AEN99"><TABLE
BORDER="0"
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
CLASS="BLOCKQUOTE"
><TR
><TD
WIDTH="10%"
VALIGN="TOP"
>&nbsp;</TD
><TD
WIDTH="80%"
VALIGN="TOP"
><P
>     Valójában nem nehéz az xfs támogatást modulként futtatni. A cmd/xfs/misc 
     könyvtárban van egy módosított mkinitrd, amely mindig elõállít egy RAM diszket 
     az xfs és xfs_support számára.   
    </P
><P
>     Elég egyszer hozzáadni az initrd betöltésére vonatkozó bejegyzést a lilo.conf 
     állományban ÉS: 
    </P
><P
>     <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>      append = "ramdisk_size=25000"   
     </PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
>     Az alapértelmezett méret 4096, ami közel sem elég az xfs támogatáshoz.   
    </P
><P
>     Részlet a hordozható gépem beállításainak listájából:   
    </P
><P
>     <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>      punch[12:57am]-=&#62;mount
      /dev/ide/host0/bus0/target0/lun0/part8 on / type xfs (rw,noatime) 
      none on /proc type proc (rw) 
      /dev/ide/host0/bus0/target0/lun0/part6 on /boot type ext2 (rw,noatime) 
      none on /dev/pts type devpts (rw,mode=0620)
      /dev/ide/host0/bus0/target0/lun0/part1 on /mnt/windows type vfat (rw,nosuid,nodev,umask=0) 
      /dev/ide/host0/bus0/target0/lun0/part9 on /blam type xfs (rw)   

      punch[12:57am]-=&#62;lsmod 
      Module                  Size Used by 
      autofs                 13180   1 (autoclean) 
      usb-uhci               24918   0 (unused) 
      usbcore                35339   0 [usb-uhci]
      3c59x                  25149   1 (autoclean) 
      maestro                29757   0 (unused) 
      soundcore               6085   2 [maestro]
      vfat                   13075   1 (autoclean) 
      fat                    37733   0 (autoclean) [vfat] 
      xfs                   447888   2 
      xfs_support            13954   0 [xfs] 
      pagebuf                39935   2 [xfs]   
 
      image=/boot/vmlinuz-2.4.0-XFS-test13-pre4 
      label=t13p4  
      root=/dev/hda8
      initrd=/boot/initrd-2.4.0-XFS-test13p4.img 
      append="ramdisk_size=25000"
      read-only   
     </PRE
></FONT
></TD
></TR
></TABLE
>
    </P
></TD
><TD
WIDTH="10%"
VALIGN="TOP"
>&nbsp;</TD
></TR
><TR
><TD
COLSPAN="2"
ALIGN="RIGHT"
VALIGN="TOP"
>--<SPAN
CLASS="ATTRIBUTION"
>     Russell Cattelan
    </SPAN
></TD
><TD
WIDTH="10%"
>&nbsp;</TD
></TR
></TABLE
><P
>    Ez alapján azt gondolom nem túl nehéz a támogatást modulként a kernelbe 
    fordítani, ez az, amit én is tenni fogok. Megpróbálom majd így használni késõbb, 
    és további részletekkel szolgálok ennek megvalósításáról. Ha valakinek van 
    ideje leírni ennek menetét mielõtt én megtenném ezt, kérem, küldje el e-mailben, 
    én majd beleteszem a leírásba, a szerzõt megilletõ jutalékkal együtt :-))   
   </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN113">3. Kernel beállítás és telepítés</H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="AEN115">3.1. A kernel beállítása az XFS támogatáshoz</H3
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Megjegyzés"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>Megjegyzés</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>     Ha még soha nem állítottál be és fordítottál új linux kernelt, ajánlott  
     elolvasni a Linux Kernel HOGYANt, mielõtt ezeket a lépéseket végrehajtod. 
     A Linux Kernel HOGYANt megtalálod a <A
HREF="http://www.linuxdoc.org/HOWTO/Kernel-HOWTO.html"
TARGET="_top"
>      Linux Documentation Project (LDP) </A
> oldalon vagy valamelyik tükrözésén.
    </P
></TD
></TR
></TABLE
></DIV
><P
>    Miután letöltötted a CVS könyvtárfából az aktuális kernel forrását, annak a 
    /usr/src/linux-2.4-xfs(-beta)/linux könyvtárban kell lennie. Szóval lépj be 
    ebbe a könyvtárba mielõtt kiadnád a make config (méginkább a make menuconfig - 
    a ford.) parancsot a beállítások elvégzéséhez. Az XFS támogatáshoz 
    engedélyezned kell a a "Prompt for development and/or incomplete code/drivers" 
    beállítást a "Code maturity level options" fejezetben majd a "Page Buffer 
    support" és "SGI XFS filesystem support" menüpontokkal kell ezt megtenned 
    (mindkettõ a "File systems" fejezetben található). Lehetõséged van még 
    kiválasztani az "Enable XFS Debug mode" és  "Enable XFS Vnode Tracing" 
    beállításokat az "SGI XFS filesystem support" fejezet alatt. Ezek lassíthatják 
    az XFS fájlrendszered használatát, de hasznosak lehetnek egy összeomlás 
    esetének kivizsgálásában, ha ilyen elõfordulna.   
   </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN122">3.2. A kernel és a modulok fordítása</H3
><P
>    Minden kernel fordításkor ki kell adni az alábbi parancsokat az új kernel 
    (és modulok - a ford.) létrehozása érdekében:   
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ make dep 
     $ make bzImage 
     $ make modules
    </PRE
></FONT
></TD
></TR
></TABLE
> 
   </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN127">3.3. Az új kernel és modulok telepítése</H3
><P
>    Ezt minden kernel telepítéskor újra meg kell csinálni:   
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ make modules_install 
     $ cp arch/i386/boot/bzImage /boot/vmlinuz-2.4.0-XFS   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN132">3.4. Egy új bejegyzés hozzáadása a lilo beállításokhoz, a beállítások érvényesítése</H3
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ vi /etc/lilo.conf
    </PRE
></FONT
></TD
></TR
></TABLE
>   
   </P
><P
>    Hozz létre egy új kernelindító bejegyzést a lilo.conf állományban ehhez 
    hasonlóan:   
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
> 
     image=/boot/vmlinuz-2.4.0-XFS label=xfs  read-only  root=/dev/hda2
    </PRE
></FONT
></TD
></TR
></TABLE
> 
   </P
><P
>    A "root=" szöveg utáni részt másold át egy szintén linuxot indító bejegyzésbõl, 
    a lilo.conf állományból. Ne felejtsd el elindítani a lilo-t a lilo.conf fájl 
    szerkesztése után, hogy a módosítások érvénybe lépjenek (a parancssorba gépeld 
    be "lilo" majd üss egy "enter"-t - a ford.)   
   </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN140">3.5. Az XFS segédprogramok fordítása és telepítése</H3
><P
>    Az XFS támogatással számos eszközt is kapsz, amikkel felépítheted és 
    karbantarthatod a fájlrendszert. Ezek a /usr/src/linux-2.4-xfs(-beta)/cmd/xfsprogs 
    könyvtárban vannak.   
   </P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Megjegyzés"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>Megjegyzés</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>     Ezek az eszközök a /usr/lib/libuuid.a osztott programozói könyvtárra 
     épülnek. Ha a könyvtárat még nem telepítetted, akkor az XFS eszközök 
     lefordítása elõtt feltétlenül tedd ezt meg. Az ezt tartalmazó rpm csomagot
     megtalálod a <A
HREF="http://www.rpmfind.net"
TARGET="_top"
>Rpmfind.net</A
> címen,
     ha rákeresel a "/usr/lib/libuuid.a." szövegre, a Debian csomag neve 
     pedig uuid-dev. Más disztribúciókban ez a programozói könyvtár ezektõl 
     eltérõ csomagban is lehet. Egy jó módszer a megfelelõ csomag megkeresésére, 
     ha a <A
HREF="http://www.google.com/linux"
TARGET="_top"
>Google Linux</A
> 
     keresõmotort használod.
  </P
></TD
></TR
></TABLE
></DIV
><P
>    Lépj be ebbe a könyvtárba:   
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ cd ../cmd/xfsprogs   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><P
>    Fordítsd le, és telepítsd az XFS eszközöket:
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ make install    
    </PRE
></FONT
></TD
></TR
></TABLE
> 
   </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN154">3.6. Az új kernel indítása</H3
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ reboot   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Megjegyzés"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>Megjegyzés</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>     Ha nem állítod be az alapértelmezett kernelnek az XFS támogatással fordított 
     kernelt, akkor bootoláskor be kell gépelned az "xfs" szöveget, majd leütnöd egy 
     enter-t, amikor megjelenik a "LILO Boot:" szöveg a képernyõn.   
    </P
></TD
></TR
></TABLE
></DIV
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="AEN161">4. A fájlrendszer lecserélése</H2
><P
>   Az eljárás befejezõ része talán a legtrükkösebb, és ez vezethet a legkönnyebben 
   adatvesztéshez. Ajánlott egy biztonsági másolatot készítése a teljes 
   rendszerrõl (vagy legalább az összes fontos adatról), mielõtt megkísérled azt az 
   XFS fájlrendszerre másolni. Még példát írni is nehéz errõl, mivel több száz 
   lehetséges módszer létezik. Megadom az alapvetõ parancsokat, amikkel általánosságban új 
   fájlrendszert hozhatsz létre, valamint átadom a saját fájlrendszerem átmásolásából 
   származó tapasztalatokat.   
  </P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN164">4.1. A gyökérkönyvtár átmásolása</H3
><P
>    Az XFS rendszernek a gyökérkönyvtár átmásolása talán a legtrükkösebb része az eljárásnak, 
    mivel ezen van a rendszer és nem tudod leválasztani (értsd: umount - a ford.) 
    mialatt a linux fut. Ha van olyan tartalék fájlrendszered, amit fel tudsz 
    csatlakoztatni (értsd: mount - a ford.), és elfér rajta a gyökérkönyvtár, akkor 
    csinálhatsz valami ehhez hasonlót (nekem a /dev/hda4 a tartalék, és a /dev/hda2 
    a root partíció):   
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ mkfs -t ext2 /dev/hda4 
     $ mkdir /mnt/temp 
     $ mount -t ext2 /dev/hda4 /mnt/temp 
     $ cd / 
     $ tar lcf - .|(cd /mnt/temp; tar xpvf - )   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><P
>    Én a "tar"-ral másoltam át a fájlokat, esetleg használhatod a "cp -dpR" 
    parancsot is, de ha a "tar"-t használod -- mint én a példában tettem az "-l"
    kapcsolóval -- akkor csak az ezen a <EM
>partíción</EM
> lévõ fájlok kerülnek átmásolásra. 
    Pl.: ha van egy másik partíciód, amit a /usr pontra csatlakoztatsz, akkor az azon 
    lévõ fájlokat <EM
>nem</EM
> másolja át (pedig a gyökérkönyvtárból kiindulva ugyebár a 
    /usr könyvtárba is eljuthatunk... - a ford.).   
   </P
><P
>    (Figyelem!!! A szöveg további részében a "/dev/hda2" és a "/dev/hda4" 
    partíciók nem biztos, hogy megfelelnek a Te partícióid hivatkozásainak - a ford.) Következõ 
    lépésként cseréld ki az /etc/fstab és /etc/lilo.conf állományokban a /dev/hda2 
    bejegyzéseket /dev/hda4 -re, majd futtasd a "lilo"-t és indítsd újra a rendszert.   
   </P
><P
>    A rendszer újraindítása után a /dev/hda4 partíció csatlakozik a gyökérkönyvtár 
    pontjára, az eredeti gyökérkönyvtárat pedig nem csatlakoztatja a rendszer. Most 
    egy új XFS fájlrendszert hozhatsz létre a /dev/hda2 helyén.   
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ mkfs -t xfs /dev/hda2   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><P
>    Csatlakoztasd az új XFS fájlrendszert:   
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ mount -t xfs /dev/hda2 /mnt/temp   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><P
>    És másold vissza a gyökérkönyvtárat az eredeti helyére:   
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ cd / 
     $ tar lcf - .|(cd /mnt/temp; tar xpvf -)   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><P
>    Cseréld ki a /etc/fstab és /etc/lilo.conf állományokban a /dev/hda4 
    hivatkozásokat és futtasd a "lilo"-t. A fájlrendszer típusát is módosítanod kell 
    a /dev/fstab állományban. Ennek valahogy így kell kinéznie:   
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     /dev/hda2               /                       xfs    defaults 1 1   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Megjegyzés"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>Megjegyzés</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>     Néhány linux disztribúcióban az fstab állományban nem csak alapértelmezett 
     beállítások szerepelnek. Például a Debian rendszerekben használatos a 
     "defaults,errors=remount-ro." A csatlakozás (mount /a ford.) beállításai 
     különbözõek minden fájlrendszerre nézve, kivéve a "default" kulcsszót. Ha nem 
     ismered a specifikus XFS beállításokat, elégedj meg az alapértelmezettel. 
     A Debianban például nem használható az XFS hibakezelési beállítása, és a 
     fájlrendszer nem lesz felcsatlakoztatva.   
    </P
><P
>	 Ráadásul a fájlrendszer-címkék egyre népszerûbbek, ezért az fstab állományban
	 ilyen bejegyzéseket is láthatsz, mint például ez: 
     <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
> 
      LABEL=/                 /                       ext2    defaults        1 1 
     </PRE
></FONT
></TD
></TR
></TABLE
> 
	  A legegyszerûbb módja a fenti probléma megoldásának az, ha kicseréled a címkét a
	  valódi eszköz állománynevére (például, ha a "/dev/hda1"-re címkével hivatkozol 
	  / cseréld a "LABEL=/" bejegyzést "/dev/hda1"-re). 
	</P
></TD
></TR
></TABLE
></DIV
><P
>    Most indítsd újra a rendszered az új XFS partíción lévõ gyökérkönyvtáraddal.   
   </P
><P
>    Természetesen számos egyéb lehetõséged van a gyökérkönyvtár átmásolására. 
    Ha úgy gondolod, hogy tudsz egy jobbat, feltétlenül szeretnék hallani róla és berakni 
    ebbe a leírásba, ha egyszerûbbnek néz ki a fent leírt ötletnél. Nekem nincs 
    másik felcsatlakoztatható partícióm, viszont van CD íróm, tehát felírtam a 
    gyökérkönyvtáram CD-re, felcsatlakoztattam, mint gyökérkönyvtárat, miközben 
    készítettem egy új XFS partíciót. Minden esetben ugyanazokat az alapvetõ 
    parancsokat kell használni egy új fájlrendszer készítésére és csatlakoztatására.   
   </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN192">4.2. Utolsó simítások</H3
><P
>    Az utolsó lépés a partíciók kicserélése. Ez lényegében ugyanaz, mint amit a 
    gyökérkönyvtár átmásolásakor csináltam. (Normális rendszerben van egy partíció 
    a / könyvtárnak, és egy-egy a boot, usr, tmp, root, stb. könyvtáraknak - a ford.) 
    Azt ajánlom, ezt egyfelhasználós üzemmódban hajtsd végre, így a gyökérkönyvtáron 
    kívül bármit lecsatlakoztathatsz, és az egész csereberét 
    milliónyi újraindítás nélkül elvégezheted. Egyfelhasználós módba úgy kapcsolhatod 
    a rendszert, ha kiadsz egy futási szintet átállító parancsot, például így:   
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ telinit 1   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><P
>    vagy újraindításkor a Lilo promptnál kérd ezt:
 
  </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     LILO Boot: xfs single   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><P
>    Ez elindítja a rendszert, és belépsz egy root parancssorba minden külsõ 
    kapcsolat és virtuális terminál nélkül, így nem fordulhat elõ, hogy valaki, 
    vagy valamilyen program használjon egy fájlrendszert (ez azt eredményezné, 
    hogy az foglalt lenne és nem tudnád leválasztani). Most felcsatlakoztathatod 
    a tartalék fájlrendszered úgy, ahogy elõzõleg már leírtuk, és átmásolhatod rá 
    a következõ könyvtárat (elõször talán töröld le róla a gyökérkönyvtárból 
    felmásolt anyagot). Válaszd le a régi fájlrendszert, készíts rajta egy új xfs 
    fájlrendszert, majd csatlakoztasd fel, és másold rá vissza a régi tartalmát
    stb... Mondjuk ha a /dev/hda3 partíciót a /usr pontra csatlakoztatod fel, akkor
    a mûvelet valahogy így néz ki:   
   </P
><P
>    <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>     $ mount -t ext2 /dev/hda4 /mnt/temp 
     $ cd /usr 
     $ tar lcf - .|(cd /mnt/temp; tar xpvf - )
	 $ cd /mnt/temp 
     $ umount /usr 
     $ mkfs -t xfs /dev/hda3 
     $ mount -t xfs /dev/hda3 /usr 
     $ tar lcf - .|(cd /usr; tar xpvf - )   
    </PRE
></FONT
></TD
></TR
></TABLE
>
   </P
><P
>    Ne felejtsd el kicserélni a /usr könyvtár fájlrendszerének típusát az 
    /etc/fstab állományban xfs-re.   
   </P
><P
>    Ez minden amit tenned kellett. A többi átmásolandó fájlrendszer esetében is
    ugyanígy kell eljárni. Ezután ha teljes többfelhasználós módban újraindítod
    a rendszert, megkapod a saját XFS fájlrendszeren futó szteroiddal fûtött Linuxodat!   
   </P
></DIV
></DIV
></DIV
></BODY
></HTML
>
