<HTML
><HEAD
>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-2">
<TITLE
>Titkosított root fájlrendszer HOGYAN</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"></HEAD
><BODY
CLASS="ARTICLE"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2">Titkosított root fájlrendszer HOGYAN</H1
><H3
CLASS="AUTHOR"
><A
NAME="AEN4"
>Christophe Devine</A
></H3
><DIV
CLASS="REVHISTORY"
><TABLE
WIDTH="100%"
BORDER="0"
><TR
><TH
ALIGN="LEFT"
VALIGN="TOP"
COLSPAN="3"
><B
>Verziótörténet</B
></TH
></TR
><TR
><TD
ALIGN="LEFT"
>Verzió: v1.1</TD
><TD
ALIGN="LEFT"
>2003.12.01</TD
><TD
ALIGN="LEFT"
>Átdolgozta: cd</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>GRUB támogatás hozzáadva.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Verzió: v1.0</TD
><TD
ALIGN="LEFT"
>2003.09.24</TD
><TD
ALIGN="LEFT"
>Átdolgozta: cd</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Elsõ kiadás, az LDP által ellenõrizve.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Verzió: v0.9</TD
><TD
ALIGN="LEFT"
>2003.09.11</TD
><TD
ALIGN="LEFT"
>Átdolgozta: cd</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Frissítve, DocBook XML formátumba konvertálva.</TD
></TR
></TABLE
></DIV
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN7"><P
></P
><P
>Ez a dokumentum leírja, hogyan helyezzük biztonságba adatainkat
a Linux root fájlrendszer erõs titkosítási algoritmust használó titkosításával.
        </P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Tartalomjegyzék</B
></DT
><DT
>1. <A
HREF="#PREPARING-SYSTEM"
>A rendszer elõkészítése</A
></DT
><DD
><DL
><DT
>1.1. <A
HREF="#PARTITION-LAYOUT"
>A partíciók kialakítása</A
></DT
><DT
>1.2. <A
HREF="#INSTALL-KERNEL"
>A Linux-2.4.23 rendszermag telepítése</A
></DT
><DT
>1.3. <A
HREF="#INSTALL-UTIL-LINUX"
>Az util-linux-2.12 telepítése</A
></DT
></DL
></DD
><DT
>2. <A
HREF="#ENCRYPT-ROOT-FILESYSTEM"
>A titkosított root fájlrendszer létrehozása</A
></DT
><DT
>3. <A
HREF="#SETUP-BOOT-DEVICE"
>A boot eszköz beállítása</A
></DT
><DD
><DL
><DT
>3.1. <A
HREF="#INITIAL-RAMDISK"
>A virtuális fájlrendszer (ramdisk) létrehozása</A
></DT
><DT
>3.2. <A
HREF="#BOOTABLE-CD"
>Rendszerindítás CD-ROM-ról</A
></DT
><DT
>3.3. <A
HREF="#BOOT-PARTITION"
>Rendszerindítás fizikai partícióról</A
></DT
></DL
></DD
><DT
>4. <A
HREF="#FINAL-STEPS"
>Utolsó lépések</A
></DT
><DT
>5. <A
HREF="#ABOUT"
>A HOGYANról</A
></DT
><DD
><DL
><DT
>5.1. <A
HREF="#AEN177"
>Magyar fordítás</A
></DT
></DL
></DD
></DL
></DIV
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="PREPARING-SYSTEM">1. A rendszer elõkészítése</H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="PARTITION-LAYOUT">1.1. A partíciók kialakítása</H3
><P
>A lemezünk (hda) legalább három partíciót tartalmazzon:
        <P
></P
><UL
><LI
><P
>hda1: ez a kicsi (~4 Mb), nem titkosított partíció fogja kérni
a jelszavunkat a titkosított root fájlrendszer felcsatolásához.
            </P
></LI
><LI
><P
>hda2: ez a partíció tartalmazza a titkosított root fájlrendszert;
legyen megfelelõen nagy.
            </P
></LI
><LI
><P
>hda3: ez a partíció tartalmazza az aktuális GNU/Linux rendszert.
            </P
></LI
></UL
>
        </P
><P
>Ekkor még a hda1 és a hda2 partíciók nincsenek használatban. A hda3 partíció
tartalmazza az aktuálisan telepített Linux terjesztést; az /usr és a /boot
<EM
>nem</EM
> lehet ettõl a partíciótól elkülönítve.
        </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-KERNEL">1.2. A Linux-2.4.23 rendszermag telepítése</H3
><P
>Két nagyobb projekt létezik, ami erõs titkosítási támogatást ad a rendszermaghoz:
a CryptoAPI és a loop-AES. Ez a HOGYAN a loop-AES projekten alapul, mivel
ez egy assembly nyelven írt, nagyon gyors és optimalizált implementáció,
így maximális teljesítményt nyújt az IA-32 (x86) alapú processzorok számára.
Készítõje Rijndael.
        </P
><P
>Mindenek elõtt töltsük le, majd csomagoljuk ki a loop-AES csomagot:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>wget http://loop-aes.sourceforge.net/loop-AES/loop-AES-v2.0b.tar.bz2
tar -xvjf loop-AES-v2.0b.tar.bz2</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Ezután töltsük le a rendszermag forrását, majd alkalmazzuk a foltot:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>wget http://ftp.kernel.org/pub/linux/kernel/v2.4/linux-2.4.23.tar.bz2
tar -xvjf linux-2.4.23.tar.bz2
cd linux-2.4.23
patch -Np1 -i ../loop-AES-v2.0b/kernel-2.4.23.diff</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Állítsuk be a billentyûzet kiosztását:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>dumpkeys | loadkeys -m - &#62; drivers/char/defkeymap.c</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>A következõ lépésben beállítjuk a rendszermagot; a következõ lehetõségek mindenképp legyenek beállítva:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>make menuconfig

    Block devices  ---&#62;

        &#60;*&#62; Loopback device support
        [*]   AES encrypted loop device support (NEW)

        &#60;*&#62; RAM disk support
        (4096)   Default RAM disk size (NEW)
        [*]   Initial RAM disk (initrd) support

    File systems  ---&#62;

        &#60;*&#62; Ext3 journalling file system support
        &#60;*&#62; Second extended fs support

(fontos: ne legyen beállítva a /dev file system support lehetõség)</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Fordítsuk le és telepítsük a rendszermagot:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>make dep bzImage
make modules modules_install
cp arch/i386/boot/bzImage /boot/vmlinuz-2.4.23</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Ha a grub rendszerbetöltõt használjuk, szerkesszük a /boot/grub/menu.lst
illetve /boot/grub/grub.conf fájlt:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>cat &#62; /boot/grub/menu.lst &#60;&#60; EOF
default 0
timeout 10
color green/black light-green/black
title Linux
    root (hd0,2)
    kernel /boot/vmlinuz-2.4.23 ro root=/dev/hda3 vga=4
EOF</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Ha viszont lilo-t használunk, akkor szerkesszük az /etc/lilo.conf fájlt, és futtassuk a lilo-t:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>cat &#62; /etc/lilo.conf &#60;&#60; EOF
lba32
boot=/dev/hda
prompt
timeout=100
image=/boot/vmlinuz-2.4.23
    label=Linux
    read-only
    root=/dev/hda3
    vga=4
EOF
lilo</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Indítsuk újra a rendszert.
        </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INSTALL-UTIL-LINUX">1.3. Az util-linux-2.12 telepítése</H3
><P
>A losetup programon - amely az util-linux csomag része - alkalmaznunk kell
a foltot, és újra kell fordítanunk az erõs titkosítás támogatásához.
Töltsük le és csomagoljuk ki az util-linux csomagot, majd alkalmazzuk a foltot:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>wget http://ftp.cwi.nl/aeb/util-linux/util-linux-2.12.tar.gz
tar -xvzf util-linux-2.12.tar.gz
cd util-linux-2.12
patch -Np1 -i ../loop-AES-v2.0b/util-linux-2.12.diff</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>20 karakternél rövidebb jelszó használata esetén írjuk be:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>CFLAGS="-O2 -DLOOP_PASSWORD_MIN_LENGTH=8"; export CFLAGS</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Ha fontos kérdés a biztonság, ne használjuk ezt a lehetõséget.
A biztonságnak megvan az ára, jelen esetben ez a hosszú jelszó használata.
        </P
><P
>Fordítsuk le a losetup-ot, majd root felhasználóként telepítsük azt:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>./configure &#38;&#38; make lib mount
cp -f mount/losetup /sbin
rm -f /usr/share/man/man8/losetup.8.gz
cp -f mount/losetup.8 /usr/share/man/man8</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="ENCRYPT-ROOT-FILESYSTEM">2. A titkosított root fájlrendszer létrehozása</H2
><P
>A célpartíció feltöltése véletlenszerû adattal:
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>shred -n 1 -v /dev/hda2</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
>A titkosított loopback eszköz beállítása:
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>losetup -e aes256 -S xxxxxxxxxx /dev/loop0 /dev/hda2
Password:</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
>A szótárral optimalizált támadások kivédése érdekében ajánlott a
-S xxxxxxxxxx opció használata, ahol "xxxxxxxxxx" a véletlenszerûen kiválasztott
álvéletlen sorozat kiindulóérték (random seed). Ezen kívül a rendszerindításkor esetleg fellépõ billentyûzetkiosztási
hibák megelõzése érdekében ne használjunk nem-ASCII karaktereket (ékezeteket stb.) a jelszóban.
    </P
><P
>Hozzuk létre az ext3 fájlrendszert:
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>mke2fs -j /dev/loop0</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
>Ellenõrizzük, hogy helyesen írtuk be a jelszót:
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>losetup -d /dev/loop0
losetup -e aes256 -S xxxxxxxxxx /dev/loop0 /dev/hda2
Password:</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>mkdir /mnt/efs
mount /dev/loop0 /mnt/efs</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
>Összehasonlíthatjuk a titkosított és az eredeti adatokat:
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>xxd /dev/hda2  | less
xxd /dev/loop0 | less</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
>Itt az ideje, hogy telepítsük a titkosított Linux fájlrendszert. Ha egy GNU/Linux
terjesztést használunk (például Debian-t, Slackware-t, Gentoo-t, Mandrake-et, RedHat/Fedora-t,
SuSE-t stb.), futtassuk a következõ parancsot:
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>cp -avx / /mnt/efs</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
>Ha a Linux From Scratch könyvet használjuk, az alábbi eltéréseket kivéve
a dokumentum szerint folytathatjuk a munkát:
        <P
></P
><UL
><LI
><P
>6. fejezet - Az util-linux telepítése:</P
><P
>Alkalmazzuk a loop-AES foltot a forrás kicsomagolása után.</P
></LI
><LI
><P
>8. fejezet - Az LFS rendszer indíthatóvá tétele:</P
><P
>Szorítkozzunk a következõ fejezetre.</P
></LI
></UL
>
    </P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="SETUP-BOOT-DEVICE">3. A boot eszköz beállítása</H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="INITIAL-RAMDISK">3.1. A virtuális fájlrendszer (ramdisk) létrehozása</H3
><P
>Elsõ lépésként chroot-oljunk a titkosított partícióra, és hozzuk létre
a boot eszközhöz a felcsatolási pontot:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>chroot /mnt/efs
mkdir /loader</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Ezután hozzuk létre a virtuális rendszerindító fájlrendszert (initial ramdisk, initrd),
amelyre késõbb szükségünk lesz:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>cd
dd if=/dev/zero of=initrd bs=1k count=4096
mke2fs -F initrd
mkdir ramdisk
mount -o loop initrd ramdisk</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Hozzuk létre a fájlrendszer könyvtárszerkezetét, és másoljuk be a szükséges fájlokat:
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>mkdir ramdisk/{bin,dev,lib,mnt,sbin}
cp /bin/{bash,mount,umount} ramdisk/bin/
ln -s bash ramdisk/bin/sh
mknod -m 600 ramdisk/dev/console c 5 1
mknod -m 600 ramdisk/dev/hda2    b 3 2
mknod -m 600 ramdisk/dev/loop0   b 7 0
cp /lib/{ld-linux.so.2,libc.so.6,libdl.so.2} ramdisk/lib/
cp /lib/{libncurses.so.5,libtermcap.so.2}    ramdisk/lib/
cp /sbin/{losetup,pivot_root} ramdisk/sbin/</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
>Ha a következõ vagy hasonló hibaüzenetet kapjuk, az nem jelent problémát:
"/lib/libncurses.so.5: No such file or directory", vagy 
"/lib/libtermcap.so.2: No such file or directory";
a bash-nek csak ezen programkönyvtárak egyike szükséges. Megtudhatjuk azt, hogy esetünkben melyik
szükséges:
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>ldd /bin/bash</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
>Hozzuk létre a rendszerindító (init) szkriptet (ne felejtsük a "xxxxxxxxxx"
helyére beírni a kiválasztott álvéletlen sorozat kiindulóértéket (random seed)):
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>cat &#62; ramdisk/sbin/init &#60;&#60; "EOF"
#!/bin/sh

/sbin/losetup -e aes256 -S xxxxxxxxxx /dev/loop0 /dev/hda2
/bin/mount -r -n -t ext2 /dev/loop0 /mnt

while [ $? -ne 0 ]
do
    /sbin/losetup -d /dev/loop0
    /sbin/losetup -e aes256 -S xxxxxxxxxx /dev/loop0 /dev/hda2
    /bin/mount -r -n -t ext2 /dev/loop0 /mnt
done

cd /mnt
/sbin/pivot_root . loader
exec /usr/sbin/chroot . /sbin/init
EOF

chmod 755 ramdisk/sbin/init</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
>Csatoljuk le a loopback eszközt, és tömörítsük be a virtuális rendszerindító fájlrendszert:
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>umount -d ramdisk
rmdir ramdisk
gzip initrd
mv initrd.gz /boot/</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="BOOTABLE-CD">3.2. Rendszerindítás CD-ROM-ról</H3
><P
>Erõsen ajánlott a rendszert egy írásvédett eszközrõl indítani,
például egy indítható CD-ROM-ról.
        </P
><P
>Töltsük le, majd csomagoljuk ki a syslinux csomagot:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>wget ftp://ftp.kernel.org/pub/linux/utils/boot/syslinux/syslinux-2.07.tar.gz
tar -xvzf syslinux-2.07.tar.gz</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Állítsuk be az isolinux-ot:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>mkdir bootcd
cp /boot/vmlinuz-2.4.23 bootcd/vmlinuz
cp /boot/initrd.gz syslinux-2.07/isolinux.bin bootcd/
echo "DEFAULT vmlinuz initrd=initrd.gz ro root=/dev/ram0 vga=4" \
    &#62; bootcd/isolinux.cfg</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Hozzuk létre az indítható cd-képet (cd image), és írjuk ki egy írható cd-re:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>mkisofs -o bootcd.iso -b isolinux.bin -c boot.cat \
        -no-emul-boot -boot-load-size 4 -boot-info-table \
        -J -hide-rr-moved -R bootcd/

cdrecord -dev 0,0,0 -speed 4 -v bootcd.iso

rm -rf bootcd{,.iso}</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="BOOT-PARTITION">3.3. Rendszerindítás fizikai partícióról</H3
><P
>A boot partíció egy alternatív rendszerindító eszköz: szükség lehet rá,
ha az indítható CD elvész. <EM
>Vegyük figyelembe, hogy a hda1
egy írható eszköz, ezért nem biztonságos; csak szükség esetén
használjuk!</EM
>
        </P
><P
>Hozzuk létre és csatoljuk fel az ext2 fájlrendszert:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>dd if=/dev/zero of=/dev/hda1 bs=8192
mke2fs /dev/hda1
mount /dev/hda1 /loader</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Másoljuk át a rendszermagot és a virtuális rendszerindító fájlrendszert:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>cp /boot/vmlinuz-2.4.23 /loader/vmlinuz
cp /boot/initrd.gz /loader/</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Ha grub-ot használunk:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>mkdir /loader/boot
cp -av /boot/grub /loader/boot/
cat &#62; /loader/boot/grub/menu.lst &#60;&#60; EOF
default 0
timeout 10
color green/black light-green/black
title Linux
    root (hd0,0)
    kernel /vmlinuz ro root=/dev/ram0 vga=4
    initrd /initrd.gz
EOF
grub-install --root-directory=/loader /dev/hda
umount /loader</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
><P
>Ha lilo-t használunk:
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>mkdir /loader/{boot,dev,etc}
cp /boot/boot.b /loader/boot/
mknod -m 600 /loader/dev/hda  b 3 0
mknod -m 600 /loader/dev/hda1 b 3 1
mknod -m 600 /loader/dev/ram0 b 1 0
cat &#62; /loader/etc/lilo.conf &#60;&#60; EOF
lba32
boot=/dev/hda
prompt
timeout=100
image=/vmlinuz
    label=Linux
    initrd=/initrd.gz
    read-only
    root=/dev/ram0
    vga=4
EOF
lilo -r /loader
umount /loader</PRE
></FONT
></TD
></TR
></TABLE
>
        </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="FINAL-STEPS">4. Utolsó lépések</H2
><P
>Módosítsuk az /etc/fstab fájlt úgy, hogy tartalmazza a következõ sort:
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>/dev/loop0      /      ext3    defaults             0 1</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
>Töröljük az /etc/mtab fájlt, és lépjünk ki a chroot-ból. Legvégül futtassuk a "umount -d /mnt/efs"
parancsot, majd indítsuk újra a rendszert. A hda3-ra már nincs szükség, létrehozhatunk egy
titkosított fájlrendszert ezen a partíción, és használhatjuk biztonsági mentésként.
    </P
><P
>Ha kevés a fizikai memóriánk, szükség lesz swap területre. Tételezzük fel,
hogy a hda4 fogja tartalmazni a titkosított swap partíciót; elõször
létre kell hozni a swap eszközt:
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>shred -n 1 -v /dev/hda4
losetup -e aes256 /dev/loop1 /dev/hda4
mkswap /dev/loop1</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
><P
>Majd hozzunk létre egy indítószkriptet (S00swap) a rendszer indítókönyvtárában
(/etc/rcS.d/ Debian esetén):
    </P
><P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>#!/bin/sh

echo "az elõzõleg kiválasztott jelszó" | \
    losetup -p 0 -e aes256 /dev/loop1 /dev/hda4
swapon /dev/loop1</PRE
></FONT
></TD
></TR
></TABLE
>
    </P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="ABOUT">5. A HOGYANról</H2
><P
>A Titkosított root fájlrendszer HOGYAN 2002 novemberében készült el a
<A
HREF="http://www.linuxfromscratch.org/lfs/news.html"
TARGET="_top"
>Linux From Scratch</A
>
projekt részére. Köszönet mindazoknak, akik azóta segítettek
a HOGYAN tökéletesítésében (fordított idõrendben): Julien Perrot, Grant Stephenson,
Cary W. Gilmer, James Howells, Pedro Baez, Josh Purinton, Jari Ruusu és
Zibeli Aton.
    </P
><P
>A hozzászólásokat
<A
HREF="http://www.cr0.net:8040/about/"
TARGET="_top"
>Christophe Devine</A
> várja.
    </P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN177">5.1. Magyar fordítás</H3
><P
> A magyar fordítást <A
HREF="mailto:vape[kukac]maffia[pont]hu"
TARGET="_top"
>Vadon Péter</A
> készítette (2004.06.15). A lektorálást <A
HREF="mailto:dacas[kukac]freemail[pont]hu"
TARGET="_top"
>Daczi László</A
>  végezte el (2004.06.24). A dokumentum legfrissebb változata megtalálható a <A
HREF="http://tldp.fsf.hu/"
TARGET="_top"
>Magyar Linux Dokumentációs Projekt</A
> honlapján.</P
></DIV
></DIV
></DIV
></BODY
></HTML
>
