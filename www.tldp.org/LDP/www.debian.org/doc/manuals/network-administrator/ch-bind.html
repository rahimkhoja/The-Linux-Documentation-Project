<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">

<html>

<head>

<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">

<title>Debian GNU/Linux Network Administrator's Manual (Obsolete Documentation) - DNS/BIND</title>

<link href="index.html" rel="start">
<link href="ch-nis.html" rel="prev">
<link href="ch-router.html" rel="next">
<link href="index.html#contents" rel="contents">
<link href="index.html#copyright" rel="copyright">
<link href="ch-intro.html" rel="chapter" title="1 Introduction">
<link href="ch-overview.html" rel="chapter" title="2 Overview of a Debian GNU/Linux System">
<link href="ch-tcpip.html" rel="chapter" title="3 TCP/IP">
<link href="ch-uucp.html" rel="chapter" title="4 UUCP">
<link href="ch-ppp.html" rel="chapter" title="5 PPP, SLIP, PLIP">
<link href="ch-nfs.html" rel="chapter" title="6 NFS">
<link href="ch-nis.html" rel="chapter" title="7 NIS">
<link href="ch-bind.html" rel="chapter" title="8 DNS/BIND">
<link href="ch-router.html" rel="chapter" title="9 Router">
<link href="ch-mail.html" rel="chapter" title="10 Mail">
<link href="ch-news.html" rel="chapter" title="11 News">
<link href="ch-ftp.html" rel="chapter" title="12 FTP">
<link href="ch-www.html" rel="chapter" title="13 WWW">
<link href="ch-security.html" rel="chapter" title="14 Security">
<link href="ch-firewall.html" rel="chapter" title="15 Firewall">
<link href="ch-kernel.html" rel="chapter" title="16 Kernel Configuration">
<link href="ch-index.html" rel="chapter" title="17 Index">
<link href="ch-intro.html#s1.1" rel="section" title="1.1 About this manual">
<link href="ch-intro.html#s1.2" rel="section" title="1.2 Where to find newer versions">
<link href="ch-intro.html#s1.3" rel="section" title="1.3 How this manual came about">
<link href="ch-tcpip.html#s3.1" rel="section" title="3.1 Intro">
<link href="ch-tcpip.html#s3.2" rel="section" title="3.2 IP Addresses">
<link href="ch-tcpip.html#s3.3" rel="section" title="3.3 IP Interface Configuration">
<link href="ch-tcpip.html#s3.4" rel="section" title="3.4 Basic IP Routing">
<link href="ch-tcpip.html#s3.5" rel="section" title="3.5 Domain Name Service (DNS)">
<link href="ch-tcpip.html#s3.6" rel="section" title="3.6 ICMP and IP Troubleshooting">
<link href="ch-tcpip.html#s3.7" rel="section" title="3.7 TCP and UDP">
<link href="ch-tcpip.html#s3.8" rel="section" title="3.8 Servers, Daemons and the Superserver">
<link href="ch-bind.html#s-bindnecessary" rel="section" title="8.1 Obtaining the necessary files">
<link href="ch-bind.html#s-bindconfig" rel="section" title="8.2 Configuring BIND">
<link href="ch-bind.html#s-bindadvance" rel="section" title="8.3 Advanced Configuration">
<link href="ch-bind.html#s-bindprimary" rel="section" title="8.4 Setting up a Primary DNS Server">
<link href="ch-bind.html#s-bindsecondary" rel="section" title="8.5 Setting up a Secondary DNS Server">
<link href="ch-bind.html#s-bindtest" rel="section" title="8.6 Testing">
<link href="ch-bind.html#s-bindhelp" rel="section" title="8.7 Obtaining Help With BIND">
<link href="ch-mail.html#s10.1" rel="section" title="10.1 Post Office Protocol (POP3) software">
<link href="ch-mail.html#s10.2" rel="section" title="10.2 Interactive Mail Access Protocol (IMAP) software">
<link href="ch-mail.html#s10.3" rel="section" title="10.3 Simple Mail Transfer Protocol (SMTP) software">
<link href="ch-mail.html#s10.4" rel="section" title="10.4 Other mail processing tools">
<link href="ch-mail.html#s10.5" rel="section" title="10.5 Mailing lists handling software">
<link href="ch-www.html#s13.1" rel="section" title="13.1 Chosing a Web Server that's best for you">
<link href="ch-www.html#s13.2" rel="section" title="13.2 Setting up your Web Server">
<link href="ch-www.html#s13.3" rel="section" title="13.3 Web Proxies">
<link href="ch-www.html#s13.4" rel="section" title="13.4 Tools and Other Programs">
<link href="ch-www.html#s13.5" rel="section" title="13.5 Finding Help">
<link href="ch-security.html#s14.1" rel="section" title="14.1 Before you begin">
<link href="ch-security.html#s14.2" rel="section" title="14.2 Security from a Network standpoint">
<link href="ch-security.html#s14.3" rel="section" title="14.3 Security from a User standpoint">
<link href="ch-security.html#s14.4" rel="section" title="14.4 Security Tools">
<link href="ch-security.html#s14.5" rel="section" title="14.5 Things you can do">
<link href="ch-security.html#s14.6" rel="section" title="14.6 Finding Help">
<link href="ch-firewall.html#s15.1" rel="section" title="15.1 Background information">
<link href="ch-firewall.html#s15.2" rel="section" title="15.2 ipfwadm">
<link href="ch-firewall.html#s15.3" rel="section" title="15.3 IP Masquerading (NAT)">
<link href="ch-firewall.html#s15.4" rel="section" title="15.4 Using Proxy's">
<link href="ch-firewall.html#s15.5" rel="section" title="15.5 Finding Help">
<link href="ch-bind.html#s8.2.1" rel="subsection" title="8.2.1 bindconfig">
<link href="ch-bind.html#s8.2.1.1" rel="subsection" title="8.2.1.1 Step 1 (Ignore this step if installing for the first time via dselect or apt-get)">
<link href="ch-bind.html#s8.2.1.2" rel="subsection" title="8.2.1.2 Step 2">
<link href="ch-bind.html#s8.2.1.3" rel="subsection" title="8.2.1.3 Step 3">
<link href="ch-bind.html#s8.2.1.4" rel="subsection" title="8.2.1.4 Step 4">
<link href="ch-bind.html#s8.2.1.5" rel="subsection" title="8.2.1.5 Step 5">
<link href="ch-bind.html#s8.2.2" rel="subsection" title="8.2.2 resolv.conf">
<link href="ch-bind.html#s8.3.1" rel="subsection" title="8.3.1 named.conf">
<link href="ch-bind.html#s8.3.2" rel="subsection" title="8.3.2 zone files">
<link href="ch-bind.html#s8.3.2.1" rel="subsection" title="8.3.2.1 domain zone files">
<link href="ch-bind.html#s8.3.2.2" rel="subsection" title="8.3.2.2 Reverse Files">
<link href="ch-bind.html#s8.4.1" rel="subsection" title="8.4.1 Preparation">
<link href="ch-bind.html#s8.4.2" rel="subsection" title="8.4.2 Configuring BIND for your new DNS Domain">
<link href="ch-bind.html#s8.4.2.1" rel="subsection" title="8.4.2.1 zone files">
<link href="ch-bind.html#s8.4.2.2" rel="subsection" title="8.4.2.2 named.conf">
<link href="ch-bind.html#s8.5.1" rel="subsection" title="8.5.1 Preparation">
<link href="ch-bind.html#s8.5.2" rel="subsection" title="8.5.2 Configuring BIND as a Secondary Server for your new DNS Domain">
<link href="ch-bind.html#s8.5.2.1" rel="subsection" title="8.5.2.1 Changes to Primary Server">
<link href="ch-bind.html#s8.5.2.2" rel="subsection" title="8.5.2.2 named.conf">
<link href="ch-bind.html#s8.5.2.3" rel="subsection" title="8.5.2.3 zone files">
<link href="ch-bind.html#s8.5.2.4" rel="subsection" title="8.5.2.4 Information">
<link href="ch-mail.html#s10.1.1" rel="subsection" title="10.1.1 qpopper">
<link href="ch-mail.html#s10.1.2" rel="subsection" title="10.1.2 ipop3d">
<link href="ch-mail.html#s10.2.1" rel="subsection" title="10.2.1 imapd">
<link href="ch-mail.html#s10.3.1" rel="subsection" title="10.3.1 sendmail">
<link href="ch-mail.html#s10.3.2" rel="subsection" title="10.3.2 smail">
<link href="ch-mail.html#s10.3.3" rel="subsection" title="10.3.3 exim">
<link href="ch-mail.html#s10.3.4" rel="subsection" title="10.3.4 postfix">
<link href="ch-mail.html#s10.3.5" rel="subsection" title="10.3.5 zmailer">
<link href="ch-mail.html#s10.3.6" rel="subsection" title="10.3.6 ssmtp">
<link href="ch-mail.html#s10.4.1" rel="subsection" title="10.4.1 procmail">
<link href="ch-mail.html#s10.4.2" rel="subsection" title="10.4.2 mailagent">
<link href="ch-mail.html#s10.4.3" rel="subsection" title="10.4.3 deliver">
<link href="ch-mail.html#s10.4.4" rel="subsection" title="10.4.4 smtp-refuser">
<link href="ch-mail.html#s10.5.1" rel="subsection" title="10.5.1 smartlist">
<link href="ch-mail.html#s10.5.2" rel="subsection" title="10.5.2 majordomo">
<link href="ch-mail.html#s10.5.3" rel="subsection" title="10.5.3 listar">
<link href="ch-mail.html#s10.5.4" rel="subsection" title="10.5.4 mailman">
<link href="ch-www.html#s13.2.1" rel="subsection" title="13.2.1 Apache">
<link href="ch-www.html#s13.2.2" rel="subsection" title="13.2.2 Apache with SSL">
<link href="ch-www.html#s13.2.3" rel="subsection" title="13.2.3 Boa">
<link href="ch-www.html#s13.2.4" rel="subsection" title="13.2.4 CERN HTTP">
<link href="ch-www.html#s13.2.5" rel="subsection" title="13.2.5 dhttpd">
<link href="ch-www.html#s13.2.6" rel="subsection" title="13.2.6 NCSA">
<link href="ch-www.html#s13.2.7" rel="subsection" title="13.2.7 wn">
<link href="ch-www.html#s13.3.1" rel="subsection" title="13.3.1 Squid">
<link href="ch-www.html#s13.4.1" rel="subsection" title="13.4.1 Log Tools">
<link href="ch-www.html#s13.4.2" rel="subsection" title="13.4.2 Perl/CGI/Java related items">
<link href="ch-www.html#s13.4.3" rel="subsection" title="13.4.3 Web Development">
<link href="ch-www.html#s13.4.3.1" rel="subsection" title="13.4.3.1 Automation">
<link href="ch-www.html#s13.4.3.2" rel="subsection" title="13.4.3.2 Other Tools">
<link href="ch-security.html#s14.2.1" rel="subsection" title="14.2.1 Securing your Web Server">
<link href="ch-security.html#s14.2.2" rel="subsection" title="14.2.2 Securing your Mail Server">
<link href="ch-security.html#s14.2.3" rel="subsection" title="14.2.3 Securing FTP">
<link href="ch-security.html#s14.2.4" rel="subsection" title="14.2.4 Securing DNS">
<link href="ch-security.html#s14.2.5" rel="subsection" title="14.2.5 Securing Telnet">
<link href="ch-security.html#s14.2.6" rel="subsection" title="14.2.6 Protecting from Denial of Service attacks">
<link href="ch-security.html#s14.2.7" rel="subsection" title="14.2.7 Securing everything else">
<link href="ch-security.html#s14.2.8" rel="subsection" title="14.2.8 Monitoring Tools">
<link href="ch-security.html#s14.3.1" rel="subsection" title="14.3.1 File permissions">
<link href="ch-security.html#s14.3.2" rel="subsection" title="14.3.2 Installed applications">
<link href="ch-security.html#s14.3.3" rel="subsection" title="14.3.3 Other items">
<link href="ch-security.html#s14.3.4" rel="subsection" title="14.3.4 Monitoring tools">
<link href="ch-firewall.html#s15.2.1" rel="subsection" title="15.2.1 Obtaining and installing the software">
<link href="ch-firewall.html#s15.2.2" rel="subsection" title="15.2.2 Kernel changes">
<link href="ch-firewall.html#s15.2.3" rel="subsection" title="15.2.3 Setting up ipfwadm">
<link href="ch-firewall.html#s15.2.4" rel="subsection" title="15.2.4 Using ipfwadm in conjunction with PPP">

</head>

<body>

<p><a name="ch-bind"></a></p>
<hr>

<p>
[ <a href="ch-nis.html">previous</a> ]
[ <a href="index.html#contents">Contents</a> ]
[ <a href="ch-intro.html">1</a> ]
[ <a href="ch-overview.html">2</a> ]
[ <a href="ch-tcpip.html">3</a> ]
[ <a href="ch-uucp.html">4</a> ]
[ <a href="ch-ppp.html">5</a> ]
[ <a href="ch-nfs.html">6</a> ]
[ <a href="ch-nis.html">7</a> ]
[ 8 ]
[ <a href="ch-router.html">9</a> ]
[ <a href="ch-mail.html">10</a> ]
[ <a href="ch-news.html">11</a> ]
[ <a href="ch-ftp.html">12</a> ]
[ <a href="ch-www.html">13</a> ]
[ <a href="ch-security.html">14</a> ]
[ <a href="ch-firewall.html">15</a> ]
[ <a href="ch-kernel.html">16</a> ]
[ <a href="ch-index.html">17</a> ]
[ <a href="ch-router.html">next</a> ]
</p>

<hr>

<h1>
Debian GNU/Linux Network Administrator's Manual (Obsolete Documentation)
<br>Chapter 8 - DNS/BIND
</h1>

<hr>

<p>
author: Ivan E.  Moore II <code><a
href="mailto:rkrusty@debian.org">rkrusty@debian.org</a></code>
</p>

<p>
Welcome.  The purpose of this section is to help you setup BIND on Debian.  The
document will start you out from ground zero to an actually working fully
functional BIND system.  As requested by some people, I will include
instructions on how to setup a working DNS Domain from both a Primary Server
standpoint and a Secondary Server standpoint.
</p>

<p>
I am also going to just focus on BIND 9.x since that is the latest version
being used by Debian.  If you are using BIND 4.x I would recommend you to
upgrade.
</p>

<p>
Please note that most people do not need BIND installed on their system.  In
fact pretty much only servers really need it.  From time to time exploits come
out that will do anywhere from denial of service attacks to actual root
compromises.  Most DNS servers are setup improperly and lead to this.  If you
are setting up a home system you most likely do not need BIND installed.
Please think it over before you proceed.
</p>

<p>
NOTE: Version 8.2.1 of bind and higher have a different layout.  All bind
related configuration files are now in /etc/bind.  These include the zone
files.
</p>

<p>
Please see <a href="#s-bindhelp">Obtaining Help With BIND, Section 8.7</a> for
advanced help with BIND.
</p>

<hr>

<h2><a name="s-bindnecessary"></a>8.1 Obtaining the necessary files</h2>

<p>
Fist off you need to install the proper files.  Go into dselect and install the
following files:
</p>

<pre>
     Required Files:
     
     bind9
     dnsutils
     
     Optional Files:
     
     bind9-doc
     bind9-host
     libbind-dev
     dns-browse
     libnet-dns-perl
     nslint
     dhcp-dns
     dnscvsutil
</pre>

<p>
If you use apt-get, then just run this command:
</p>

<pre>
     apt-get install bind9 bind9-doc dnsutils
</pre>

<hr>

<h2><a name="s-bindconfig"></a>8.2 Configuring BIND</h2>

<hr>

<h3><a name="s8.2.1"></a>8.2.1 bindconfig</h3>

<p>
If you have already installed bind and answered the questions during install
you can go back and reconfigure the base BIND system by typing bindconfig.
This program does just the generic basic settings.  bindconfig is what dpkg
runs when it installs BIND so what I'm about to cover is exactly what you'll go
through when you first install BIND.  This is what it looks like.
</p>

<p>
This program doesn't exist in bind versions 8.2.1 and higher.  It may show up
again sometime, but for now ignore these steps if your using these versions.
</p>

<hr>

<h4><a name="s8.2.1.1"></a>8.2.1.1 Step 1 (Ignore this step if installing for the first time via dselect or apt-get)</h4>

<pre>
     snowcrash:/var/named# bindconfig
     
     It appears that you already have an /etc/named.conf file, suggesting
     that you have already configured BIND version 8.X at least once.  If
     you proceed, a copy of this file will be saved, but no customizations
     that you have made to it will be included in the new configuration.
     
     If this means nothing to you, go ahead and proceed with the remainder
     of the configuration process.  If you have customized /etc/named.conf,
     you probably want to stop now to preserve your customizations.
     
     Proceed to configure BIND, ignoring existing /etc/named.conf? [N]
</pre>

<hr>

<h4><a name="s8.2.1.2"></a>8.2.1.2 Step 2</h4>

<pre>
     BIND Configuration
     ------------------
     By answering the following questions, you can configure BIND for your system.
     If your system has already been configured, the default values will allow you
     to verify your existing configuration.
     
     Press [ENTER]
</pre>

<hr>

<h4><a name="s8.2.1.3"></a>8.2.1.3 Step 3</h4>

<pre>
     Forwarder Hosts
     ---------------
     If you are close to a well-connected host or set of hosts which accept
     recursive DNS queries, it would be to your advantage to use them as forwarders
     in order to reduce traffic over links to outside servers.
     
     Your DNS server will send all queries not in its cache to the forwarders
     first. Each forwarder will be asked in turn until an answer is returned or the
     list is exhausted. If no answer is forthcoming from a forwarder, the server
     will continue as it would have without the forwarders.
     
     To answer this question, separate each address with a space, or answer `none'
     to eliminate all forwarder hosts.
     
     Forwarder IP addresses? []
</pre>

<p>
This option allows you to forward any DNS requests to another DNS server.  The
reason you might want to do this is if your inside a firewall and cannot
directly reach the outside world.  You can point your server to do all it's
lookups from specific servers inside your network which can reach the outside
world.
</p>

<hr>

<h4><a name="s8.2.1.4"></a>8.2.1.4 Step 4</h4>

<pre>
     Localhost Entries
     -----------------
     With this option, BIND will contain entries for the `localhost' pseudo-host
     and its reverse mapping (127.0.0.1). This is recommended.
     
     Enable localhost entries? [Y]
</pre>

<p>
You want this.  This allows mapping to and from your localhost which is
127.0.0.1.
</p>

<hr>

<h4><a name="s8.2.1.5"></a>8.2.1.5 Step 5</h4>

<pre>
     Configuration Complete
     ----------------------
     Advanced configuration, such as sortlists, xfrnets, limits, and other options
     can be accomplished by manually editing the /var/named/boot.options
     configuration file and reloading your nameserver. You may wish to refer to
     the named(8) man page or review the documentation in /usr/doc/net/named to
     assist in further customization.
     
     This automatic configuration does not manipulate zone files; you should ensure
     the proper boot entries are made in /var/named/boot.zones for each primary and
     secondary zone you are serving. If you leave this file empty, your server will
     act conveniently as a caching-only name server.
     
     Saving old /var/named/boot.options to /var/named/boot.options.old ...
     Reading boot.zones ... 
     Reading boot.options ... 
     Rotated `/etc/named.conf' at Mon Dec  7 06:34:58 EST 1998.
     Reload named now with the new configuration? [Y]
</pre>

<p>
All your basic configuration is now complete.  Go ahead and say yes to this so
that bind will be restarted.
</p>

<hr>

<h3><a name="s8.2.2"></a>8.2.2 resolv.conf</h3>

<p>
/etc/resolv.conf is where Linux looks to find out how it should perform DNS
lookups.  The format is as follows:
</p>

<pre>
     domain yourdomain.com
     search yourdomain.com otherdomains.com
     nameserver 192.168.100.1
     nameserver 127.0.0.1
</pre>

<p>
Pretty straight forward.  The first line tells it what domain you are in.  This
can be omitted if you want, but I would recommend using it.  The second line is
a search pattern.  This too can be omitted, but I would also recommend using
it.  Without it you could not do a lookup of a hostname without typing out it's
fully qualified domain name.  ie..  you couldn't lookup beavis.  You'd have to
lookup beavis.otherdomain.com.  (Unless you specified this information in your
/etc/hosts file)
</p>

<p>
The &quot;nameserver&quot; lines tell it a search order for DNS servers.  Now
since we are setting up BIND on your system you will need to change this file.
You'll want it to look more like the following:
</p>

<pre>
     domain yourdomain.com
     search yourdomain.com
     nameserver 127.0.0.1
     nameserver x.x.x.x
</pre>

<p>
Replace &quot;yourdomain.com&quot; with whatever domain you are using and
replace the &quot;x.x.x.x&quot; with a backup DNS server that you can use.
(This way if your's fails you still can perform lookups).
</p>

<p>
Save this file and you should be done.  What this gives you so far is the
ability to lookup DNS information for the Internet.
</p>

<p>
Please refer to <a href="#s-bindprimary">Setting up a Primary DNS Server,
Section 8.4</a> for information on setting up a working DNS Domain.
</p>

<hr>

<h2><a name="s-bindadvance"></a>8.3 Advanced Configuration</h2>

<hr>

<h3><a name="s8.3.1"></a>8.3.1 named.conf</h3>

<p>
named.conf is where you get to tell BIND what where and how.  It is the main
configuration file for BIND.  Prior to BIND 8.x this file was called
named.boot.  Below is the stock named.conf file you get after installing BIND
for the first time.
</p>

<pre>
     
     // generated by named-bootconf.pl
     
     options {
             directory &quot;/var/named&quot;;
             /*
              * If there is a firewall between you and nameservers you want
              * to talk to, you might need to uncomment the query-source
              * directive below.  Previous versions of BIND always asked
              * questions using port 53, but BIND 8.1 uses an unprivileged
              * port by default.
              */
             // query-source address * port 53;
     };
     
     //
     // Boot file for name server
     //
     // type         domain                  source          file
     zone &quot;.&quot; {
             type hint;
             file &quot;named.root&quot;;
     };
     
     // Zone boot information and daemon options are kept in other files
     // (autoincluded from boot.zones)
     //
     // Name server zone boot file
     // See named(8) for syntax and further information
     //
     // type         domain                  source          file
     // (autoincluded from boot.options)
     //
     // Options for name server
     // Use `bindconfig' to automatically configure this file
     //
     // type         domain                  source          file
     zone &quot;localhost&quot; {
             type master;
             file &quot;named.local&quot;;
     };
     
     zone &quot;127.in-addr.arpa&quot; {
             type master;
             file &quot;named.rev-local&quot;;
     };
     
     // Custom configurations below (will be preserved)
</pre>

<p>
The named.conf file is highly configurable.  From just looking at it you can
see how to add a new domain.  To add a new domain you just add the following at
the bottom of your named.conf file:
</p>

<pre>
     zone &quot;newdomain.com&quot; {
             type master;
             file &quot;newdomain.db&quot;;
     };
     
     zone &quot;100.168.192.in-addr.arpa&quot; {
             type master;
             file &quot;192.rev&quot;;
     };
</pre>

<p>
Just replace &quot;newdomain.com&quot; with the name of the domain you are
going to perform DNS for and replace the &quot;100.168.192.in-addr.arpa&quot;
with the proper subnet you will perform reverse DNS for.  Note the name of this
reverse lookup zone: it is the numeric IP address of the net in reverse order,
followed by <code>.in-addr.arpa</code>.  For more information on how this works
please refer to the BIND documentation located in /usr/share/doc.  (if you
installed bind-doc or bind9-doc)
</p>

<p>
the &quot;type&quot; in the above example specifies whether your will be a
master or slave for that domain.  type master means your DNS server will not
rely on anyone else for information on that domain.  Other systems can be setup
to perform zone-transfers of that domain.  zone-transfers means basically
transferring the information to another DNS server so that server can be used
to perform DNS lookups.  If you are going to pull information from another
server you will need to use type slave instead.
</p>

<p>
The &quot;file&quot; in the above example specifies the actual file name where
the information is stored or will be stored.  These files will be (or should
be) located in /var/named by default.  (unless you change the
&quot;directory&quot; statement in /etc/named.conf.)
</p>

<p>
By default BIND is not setup with much security and anyone can pull your
information remotely.  To control who can perform zone-transfers and thus pull
information from your server add this line to your named.conf file:
</p>

<pre>
     
             allow-transfer &quot;192.168.100.1&quot;;  /* this line */
</pre>

<p>
This line would go into the options section like so:
</p>

<pre>
     options {
             directory &quot;/var/named&quot;;
             allow-transfer &quot;192.168.100.1&quot;;  
     };
</pre>

<p>
Replace the 192.168.100.1 with the IP addresses of those servers you want to be
able to perform zone-transfers from your site.  NOTE: This does not mean that
people not listed here will not be able to perform nslookups from your server.
It just means that they have to know what they are looking for.  They will have
to know a hostname or ip address in order to do a lookup.  They will not be
able to just pull all the data stored in your database files.
</p>

<hr>

<h3><a name="s8.3.2"></a>8.3.2 zone files</h3>

<p>
The zone files (or database files) are the heart of your BIND system.  This is
where all the information is stored on what hostname goes with what ip address.
</p>

<hr>

<h4><a name="s8.3.2.1"></a>8.3.2.1 domain zone files</h4>

<p>
Here is an example for a domain file for yourdomain.com.  Please note this is a
very generic example and there are more features to it.  Please refer to the
BIND documentation for help with these features.
</p>

<pre>
     ;
     ; BIND data file for yourdomain.com
     ;
     @       IN      SOA     yourdomain.com. root.yourdomain.com. (
                                   1         ; Serial
                              604800         ; Refresh
                               86400         ; Retry
                             2419200         ; Expire
                              604800 )       ; Default TTL
     
             IN      NS      dns.yourdomain.com.
     	IN	MX	10	mail.yourdomain.com.
     
     www	IN	A	192.168.100.5
     dns	IN	A	192.168.100.10
     mail	IN	A	192.168.100.20
</pre>

<p>
Any line starting with a ; is a comment line and is ignored by BIND.  The first
6 lines are configuration lines for the zone.  These lines tell it what the
zone is (yourdomain.com) who is responsible for it (root.yourdomain.com which
is equivalent to root@yourdomain.com) and a few other things.  These other
things include a serial number used for keeping track of when it's updated, how
often to refresh the database, how often to retry a zone transfer, when the
zone information will expire and a default time to live.  *IMPORTANT* Whenever
you make changes to the zone file, you MUST increment the serial number.  If
you do not do this, prolems can occur, especially if you are a primary server
supplying information to secondary sites.  Most of this information is only
used if you have both master and slave systems
</p>

<p>
The next two lines tell it who the primary DNS server is and who should get the
mail for this domain.  You can have multiple listings of each of these.  To add
more dns servers just repeat exactly what is listed changing the
dns.yourdomain.com with another dns server.  To add another mail server you do
the same thing except you have an extra field.  The &quot;10&quot; in the MX
line states a priority, lower number being first.  What this means is if you
have 2 MX listings, one is 10 and one is 20, it will try to deliver the mail to
the MX listing with the 10 priority and if it fails it will then go to the MX
listing with the 20 priority.
</p>

<p>
The rest of the zone file lists all your hosts and ips.  For more information
other features and configuration of this information check the BIND
documentation.
</p>

<hr>

<h4><a name="s8.3.2.2"></a>8.3.2.2 Reverse Files</h4>

<p>
The reverse lookup files are almost identical to the domain files with only
minor changes.  Here is an example of a reverse lookup file.
</p>

<pre>
     ;
     ; BIND reverse data file for 192.168.100.0
     ;
     @       IN      SOA     yourdomain.com. root.yourdomain.com. (
                                   1         ; Serial
                              604800         ; Refresh
                               86400         ; Retry
                             2419200         ; Expire
                              604800 )       ; Default TTL
     ;
             IN      NS      dns.yourdomain.com.
     
     5	IN	PTR	www.yourdomain.com.
     10	IN	PTR	dns.yourdomain.com.
     20	IN	PTR	mail.yourdomain.com.
</pre>

<p>
The first section of this file is exactly the same as the first section of the
domain zone files.  The bottom section is where it is different.  This time we
are listing the last part of the IP address first and then the hostname last.
</p>

<p>
There are 2 things you must notice here.  You have to use the fully qualified
domain name here and you must put a &quot;.&quot; at the end of it.  These 2
things are important to the file and weird things will happen if you don't do
it this way.  Another possibility is to use &quot;$ORIGIN&quot;, which is a
domain name that is appended automatically to all names not ending in a dot.
The origin can be changed in the db file with $ORIGIN.  Do not forget the
ending dot from $ORIGIN!
</p>

<pre>
     $ORIGIN yourdomain.com.
</pre>

<p>
[Paul Albitz, Cricket Liu: DNS and BIND, O'Reilly &amp; Accosiates, Inc, 1st
Edition July 1994, page 136]
</p>

<hr>

<h2><a name="s-bindprimary"></a>8.4 Setting up a Primary DNS Server</h2>

<p>
The Primary DNS Server is where the master copies of your DNS files are
located.  It can be either a standalone system or other servers (Secondary) can
work off of it by performing zone transfers.  A zone transfer is just that,
transfering of zone files from one system to another.  This is how a Primary
server distributes it's zone information to other servers.
</p>

<p>
This section will cover setting up your Debian system as a Primary DNS server.
I'll go through creating a fake domain and configuring BIND to work with that
domain.
</p>

<hr>

<h3><a name="s8.4.1"></a>8.4.1 Preparation</h3>

<p>
What we are going to do here is create a new domain.  For our purposes we will
use foo.org.  In this section, we will setup your Debian system to be a Primary
server for foo.org.
</p>

<p>
To give you a better understanding on how all this works, I'll use the
following servers with their corresponding IP's for the examples.
</p>

<pre>
     
     www.foo.org  =  192.168.100.10
     news.foo.org =  192.168.100.20
     mail.foo.org =  192.168.100.30
     dns.foo.org  =  192.168.100.40
     dns2.foo.org =  192.168.100.50
</pre>

<p>
Using these for our example, dns.foo.org will represent your Debian server.
dns2.foo.org will be used in <a href="#s-bindsecondary">Setting up a Secondary
DNS Server, Section 8.5</a>.  You will also see that we are using the
192.168.100.x subnet.  For our examples here, we'll be master to this subnet as
well.
</p>

<hr>

<h3><a name="s8.4.2"></a>8.4.2 Configuring BIND for your new DNS Domain</h3>

<p>
Now to configure BIND.  As shown in <a href="#s-bindadvance">Advanced
Configuration, Section 8.3</a>, configuring BIND is rather simple.  Again, I'm
not going to cover any advanced configuration, but if you do wish help with it
please check the <code><a
href="http://www.tdyc.com/archive/dns/index.html">BIND 8.0 Online
Documentation</a></code>.
</p>

<hr>

<h4><a name="s8.4.2.1"></a>8.4.2.1 zone files</h4>

<p>
First we need to create 2 files.  One for your foo.org domain and one for your
192.168.100.x subnet.  We'll start with the foo.org domain file.  You need to
create a file called <code>foo.db</code> in <code>/var/named</code>.  (This
file cand be called whatever you want but I'm using this for the example).  The
file should look somewhat like this:
</p>

<pre>
     
     ;
     ; BIND data file for foo.db
     ; /var/named/foo.db
     ;
     @       IN      SOA     foo.org. root.foo.org. (
                          1998121401         ; Serial
                              604800         ; Refresh
                               86400         ; Retry
                             2419200         ; Expire
                              604800 )       ; Default TTL
     
             IN      NS      dns.foo.org.
     
             IN      MX      10      mail.foo.org.
     
     www	IN	A	192.168.100.10
     news	IN	A	192.168.100.20
     mail	IN	A	192.168.100.30
     dns	IN	A	192.168.100.40
     dns2	IN	A	192.168.100.50
</pre>

<p>
Notice in the above example that I use 1998121401 as the Serial.  I do this for
the main reason of keeping track of when the file was last modified.  It tells
me that the file was last modified 12-14-1998 and it was the first time (01) it
was modified that day.  You don't have to do this but you do need to make sure
you increment the Serial each time you modify it.  (Especially if you have
Secondaries)
</p>

<p>
Now you need to create your 192.168.100.x subnet file.  So create a file called
<code>192.168.100.db</code> in <code>/var/named</code>.  It needs to look
somewhat like this:
</p>

<pre>
     
     ;
     ; BIND reverse data file for 192.168.100.0
     ; /var/named/192.168.100.db
     ;
     @       IN      SOA     foo.org. root.foo.org. (
                          1998121401         ; Serial
                              604800         ; Refresh
                               86400         ; Retry
                             2419200         ; Expire
                              604800 )       ; Default TTL
     
             IN      NS      dns.foo.org.
     
     10	IN	PTR	www.foo.org.
     20	IN	PTR	news.foo.org.
     30	IN	PTR	mail.foo.org.
     40	IN	PTR	dns.foo.org.
     50	IN	PTR	dns2.foo.org.
</pre>

<p>
Please note the (.) at the end of each hostname (eg.  www.foo.org.) The period
MUST be there otherwise your zone will not be read correctly by BIND.
</p>

<hr>

<h4><a name="s8.4.2.2"></a>8.4.2.2 named.conf</h4>

<p>
Now we need to add your new domain to the BIND configuration file.  So go ahead
and edit your <code>/etc/named.conf</code> file and add the following lines at
the bottom.
</p>

<pre>
     
     zone &quot;foo.org&quot; {
             type master;
             file &quot;foo.db&quot;;
     };
     
     zone &quot;100.168.192.in-addr.arpa&quot; {
             type master;
             file &quot;192.168.100.rev&quot;;
     };
</pre>

<p>
Now save that file and your done.  All you have to do now is do a
<code>/etc/init.d/bind reload</code> and test it out.  For help with testing
out BIND, please check <a href="#s-bindtest">Testing, Section 8.6</a>.
</p>

<hr>

<h2><a name="s-bindsecondary"></a>8.5 Setting up a Secondary DNS Server</h2>

<p>
A Secondary DNS Server is basically just a backup server.  I does not hold the
master versions of the zone information but rather it holds copies of them.
Most sites use Secondary servers in remote locations or to cut down on the load
on the Primary server.  The Secondary server performs zone transfers at said
times making sure it has the newest versions of the zone information.
</p>

<hr>

<h3><a name="s8.5.1"></a>8.5.1 Preparation</h3>

<p>
The big difference in setting up a Primary server and a Secondary server is
that your zone files are already built.  The only changes you have to make is
telling BIND on both systems that this server is a Secondary and to perform
zone transfers.
</p>

<hr>

<h3><a name="s8.5.2"></a>8.5.2 Configuring BIND as a Secondary Server for your new DNS Domain</h3>

<hr>

<h4><a name="s8.5.2.1"></a>8.5.2.1 Changes to Primary Server</h4>

<p>
First we need to make changes to your Primary server so that it knows about
your new Secondary server.  On your Primary, edit your <code>foo.db</code>
domain file and add the following line to it.  (note: complete file is being
shown here)
</p>

<pre>
     
     ;
     ; BIND data file for foo.db
     ; /var/named/foo.db
     ;
     @       IN      SOA     foo.org. root.foo.org. (
                          1998121401         ; Serial
                              604800         ; Refresh
                               86400         ; Retry
                             2419200         ; Expire
                              604800 )       ; Default TTL
     
             IN      NS      dns.foo.org.
     	IN	NS	dns2.foo.org.	; ADD THIS LINE ***
     
             IN      MX      10      mail.foo.org.
     
     www     IN      A       192.168.100.10
     news    IN      A       192.168.100.20
     mail    IN      A       192.168.100.30
     dns     IN      A       192.168.100.40
     dns2    IN      A       192.168.100.50
</pre>

<p>
Now edit your <code>/var/named/192.168.100.db</code> file and do the same.
</p>

<pre>
     
     ;
     ; BIND reverse data file for 192.168.100.0
     ; /var/named/192.168.100.db
     ;
     @       IN      SOA     foo.org. root.foo.org. (
                          1998121401         ; Serial
                              604800         ; Refresh
                               86400         ; Retry
                             2419200         ; Expire
                              604800 )       ; Default TTL
     
             IN      NS      dns.foo.org.
     	IN	NS	dns2.foo.org.	;  ADD THIS LINE ***
     
     10      IN      PTR     www.foo.org.
     20      IN      PTR     news.foo.org.
     30      IN      PTR     mail.foo.org.
     40      IN      PTR     dns.foo.org.
     50      IN      PTR     dns2.foo.org.
</pre>

<p>
What your doing by adding the new IN NS line is telling BIND that dns2.foo.org
is also a authorized DNS server for both foo.org and the 192.168.100.x subnet.
With BIND 8.x this also tells bind that whenever a change is made to the zone
files, it needs to notify dns2.foo.org that a change has been made so thaht
dns2.foo.org can perform a zone transfer.
</p>

<p>
Please note that if you have setup your Primary server to only allow zone
transfers from specific hosts, you'll need to make sure that dns2.foo.org is
included in that list.  (allows-transfer option in
<code>/etc/named.conf</code>.)
</p>

<p>
You can now reload your BIND on your Primary server.  (<code>/etc/init.d/bind
reload</code>)
</p>

<hr>

<h4><a name="s8.5.2.2"></a>8.5.2.2 named.conf</h4>

<p>
Now on your Secondary server you need to add information to your
<code>/etc/named.conf</code> file.  Add the following lines to the bottom of
<code>/etc/named.conf</code>:
</p>

<pre>
     
     zone &quot;foo.org&quot; {
             type slave;
             file &quot;foo.db&quot;;
     	masters {
     		192.168.100.40;
     	};
     };
     
     zone &quot;100.168.192.in-addr.arpa&quot; {
             type slave;
             file &quot;192.168.100.db&quot;;
     	masters {
     		192.168.100.40;
     	};
     };
</pre>

<p>
The above tells BIND that your server is a slave (Secondary) for foo.org and
the 192.168.100.x subnet.  It also tells BIND that it needs to obtain the zone
information (foo.db and 192.168.100.db) from 192.168.100.40 which is
dns.foo.org.
</p>

<hr>

<h4><a name="s8.5.2.3"></a>8.5.2.3 zone files</h4>

<p>
Because this is a Secondary Server, there is no need to do anything with zone
files.  BONUS!  As long as you have everything setup right on your Primary and
your named.conf file is configured properly, everything will work properly.
</p>

<p>
You are done.  Reload your BIND and test it out.  <code>/etc/init.d/bind
reload</code>
</p>

<hr>

<h4><a name="s8.5.2.4"></a>8.5.2.4 Information</h4>

<p>
Now.  Each time the Primary site's zone files are modified and the Serial # is
incremented, BIND will send out a notify to all Secondaries (any server in the
zone file with a IN NS statement) stating a change has been made.  BIND on each
of these servers will then check it's own zone files to see if it has the same
version or not.  If the version that the Primary has notified it about is newer
then it will perform a zone transfer and obtain the newer version.
</p>

<p>
If everything is setup properly, you will never need to make any changes to
your Secondary server except to upgrade BIND itself.  All changes from here on
out should be made on the Primary server.  The exception is if a new zone is
added on the primary, you need to add it to the secondaries also if you want
them to be secondary to the new zone.
</p>

<hr>

<h2><a name="s-bindtest"></a>8.6 Testing</h2>

<p>
Testing is the easy part.  If you followed the directions listed here
everything should work fine.  The first thing you need to do before we can
properly test is to reload the database.
</p>

<pre>
     /etc/init.d/bind reload
</pre>

<p>
Then you need to go ahead and load up nslookup and run some queries
</p>

<pre>
     snowcrash:~# nslookup
     Default Server:  localhost
     Address:  127.0.0.1
     
     &gt;
</pre>

<p>
First off when you run nslookup it should look like the above example unless
you have created your own domain and are using an ip address other than
127.0.0.1.  You should be able to type in www.debian.org and it should think
for a few and return with www.debian.org's ip address.
</p>

<p>
If you are following the instructions here for setting up a new domain, your
nslookup should look more like this:
</p>

<pre>
     snowcrash:~# nslookup
     Default Server:  dns.foo.org
     Address:  192.168.100.40
     
     &gt;
</pre>

<p>
You should be able to now lookup each of the hosts we added to your zone files.
(www.foo.org, mail.foo.org, etc...)
</p>

<hr>

<h2><a name="s-bindhelp"></a>8.7 Obtaining Help With BIND</h2>

<p>
The following sites are good sources of help for BIND.
</p>
<ul>
<li>
<p>
<code><a href="http://www.isc.org/bind.html">ISC's BIND Site</a></code>
</p>
</li>
</ul>
<ul>
<li>
<p>
<code><a href="http://www.tdyc.com/archive/dns/index.html">BIND Documentation
Online</a></code>
</p>
</li>
</ul>
<ul>
<li>
<p>
<code><a href="http://www.tdyc.com/archive/LDP/HOWTO/DNS-HOWTO.html">LINUX DNS
HOWTO</a></code>
</p>
</li>
</ul>

<hr>

<p>
[ <a href="ch-nis.html">previous</a> ]
[ <a href="index.html#contents">Contents</a> ]
[ <a href="ch-intro.html">1</a> ]
[ <a href="ch-overview.html">2</a> ]
[ <a href="ch-tcpip.html">3</a> ]
[ <a href="ch-uucp.html">4</a> ]
[ <a href="ch-ppp.html">5</a> ]
[ <a href="ch-nfs.html">6</a> ]
[ <a href="ch-nis.html">7</a> ]
[ 8 ]
[ <a href="ch-router.html">9</a> ]
[ <a href="ch-mail.html">10</a> ]
[ <a href="ch-news.html">11</a> ]
[ <a href="ch-ftp.html">12</a> ]
[ <a href="ch-www.html">13</a> ]
[ <a href="ch-security.html">14</a> ]
[ <a href="ch-firewall.html">15</a> ]
[ <a href="ch-kernel.html">16</a> ]
[ <a href="ch-index.html">17</a> ]
[ <a href="ch-router.html">next</a> ]
</p>

<hr>

<p>
Debian GNU/Linux Network Administrator's Manual (Obsolete Documentation)
</p>

<address>
This manual is OBSOLETE and DEPRECATED since 2000, Instead see http://www.debian.org/doc/user-manuals#quick-reference<br>
<br>
Ardo van Rangelrooij <code><a href="mailto:ardo.van.rangelrooij@tip.nl">ardo.van.rangelrooij@tip.nl</a></code><br>
Oliver Elphick <code><a href="mailto:olly@lfix.co.uk">olly@lfix.co.uk</a></code><br>
Ivan E. Moore II <code><a href="mailto:rkrusty@debian.org">rkrusty@debian.org</a></code><br>
Duncan C. Thomson <code><a href="mailto:duncan@sciuro.demon.co.uk">duncan@sciuro.demon.co.uk</a></code><br>
<br>
</address>
<hr>

</body>

</html>

