<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">

<html>

<head>

<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">

<title>Securing Debian Manual - After installation</title>

<link href="index.en.html" rel="start">
<link href="ch3.en.html" rel="prev">
<link href="ch-sec-services.en.html" rel="next">
<link href="index.en.html#contents" rel="contents">
<link href="index.en.html#copyright" rel="copyright">
<link href="ch1.en.html" rel="chapter" title="1 Introduction">
<link href="ch2.en.html" rel="chapter" title="2 Before you begin">
<link href="ch3.en.html" rel="chapter" title="3 Before and during the installation">
<link href="ch4.en.html" rel="chapter" title="4 After installation">
<link href="ch-sec-services.en.html" rel="chapter" title="5 Securing services running on your system">
<link href="ch-automatic-harden.en.html" rel="chapter" title="6 Automatic hardening of Debian systems">
<link href="ch7.en.html" rel="chapter" title="7 Debian Security Infrastructure">
<link href="ch-sec-tools.en.html" rel="chapter" title="8 Security tools in Debian">
<link href="ch9.en.html" rel="chapter" title="9 Developer's Best Practices for OS Security">
<link href="ch10.en.html" rel="chapter" title="10 Before the compromise">
<link href="ch-after-compromise.en.html" rel="chapter" title="11 After the compromise (incident response)">
<link href="ch12.en.html" rel="chapter" title="12 Frequently asked Questions (FAQ)">
<link href="ap-harden-step.en.html" rel="appendix" title="A The hardening process step by step">
<link href="ap-checklist.en.html" rel="appendix" title="B Configuration checklist">
<link href="ap-snort-box.en.html" rel="appendix" title="C Setting up a stand-alone IDS">
<link href="ap-bridge-fw.en.html" rel="appendix" title="D Setting up a bridge firewall">
<link href="ap-bind-chuser.en.html" rel="appendix" title="E Sample script to change the default Bind installation.">
<link href="ap-fw-security-update.en.html" rel="appendix" title="F Security update protected by a firewall">
<link href="ap-chroot-ssh-env.en.html" rel="appendix" title="G <code>Chroot</code> environment for <code>SSH</code>">
<link href="ap-chroot-apache-env.en.html" rel="appendix" title="H <code>Chroot</code> environment for <code>Apache</code>">
<link href="ch1.en.html#s-authors" rel="section" title="1.1 Authors">
<link href="ch1.en.html#s1.2" rel="section" title="1.2 Where to get the manual (and available formats)">
<link href="ch1.en.html#s1.3" rel="section" title="1.3 Organizational notes/feedback">
<link href="ch1.en.html#s1.4" rel="section" title="1.4 Prior knowledge">
<link href="ch1.en.html#s1.5" rel="section" title="1.5 Things that need to be written (FIXME/TODO)">
<link href="ch1.en.html#s-changelog" rel="section" title="1.6 Changelog/History">
<link href="ch1.en.html#s-credits" rel="section" title="1.7 Credits and thanks!">
<link href="ch2.en.html#s2.1" rel="section" title="2.1 What do you want this system for?">
<link href="ch2.en.html#s-references" rel="section" title="2.2 Be aware of general security problems">
<link href="ch2.en.html#s2.3" rel="section" title="2.3 How does Debian handle security?">
<link href="ch3.en.html#s-bios-passwd" rel="section" title="3.1 Choose a BIOS password">
<link href="ch3.en.html#s3.2" rel="section" title="3.2 Partitioning the system">
<link href="ch3.en.html#s3.3" rel="section" title="3.3 Do not plug to the Internet until ready">
<link href="ch3.en.html#s3.4" rel="section" title="3.4 Set a root password">
<link href="ch3.en.html#s3.5" rel="section" title="3.5 Activate shadow passwords and MD5 passwords">
<link href="ch3.en.html#s3.6" rel="section" title="3.6 Run the minimum number of services required">
<link href="ch3.en.html#s3.7" rel="section" title="3.7 Install the minimum amount of software required">
<link href="ch3.en.html#s3.8" rel="section" title="3.8 Read the Debian security mailing lists">
<link href="ch4.en.html#s-debian-sec-announce" rel="section" title="4.1 Subscribe to the Debian Security Announce mailing list">
<link href="ch4.en.html#s-security-update" rel="section" title="4.2 Execute a security update">
<link href="ch4.en.html#s-bios-boot" rel="section" title="4.3 Change the BIOS (again)">
<link href="ch4.en.html#s-lilo-passwd" rel="section" title="4.4 Set a LILO or GRUB password">
<link href="ch4.en.html#s-kernel-initramfs-prompt" rel="section" title="4.5 Disable root prompt on the initramfs">
<link href="ch4.en.html#s-kernel-root-prompt" rel="section" title="4.6 Remove root prompt on the kernel">
<link href="ch4.en.html#s-restrict-console-login" rel="section" title="4.7 Restricting console login access">
<link href="ch4.en.html#s-restrict-reboots" rel="section" title="4.8 Restricting system reboots through the console">
<link href="ch4.en.html#s4.9" rel="section" title="4.9 Mounting partitions the right way">
<link href="ch4.en.html#s4.10" rel="section" title="4.10 Providing secure user access">
<link href="ch4.en.html#s-tcpwrappers" rel="section" title="4.11 Using tcpwrappers">
<link href="ch4.en.html#s-log-alerts" rel="section" title="4.12 The importance of logs and alerts">
<link href="ch4.en.html#s-kernel-patches" rel="section" title="4.13 Adding kernel patches">
<link href="ch4.en.html#s4.14" rel="section" title="4.14 Protecting against buffer overflows">
<link href="ch4.en.html#s4.15" rel="section" title="4.15 Secure file transfers">
<link href="ch4.en.html#s4.16" rel="section" title="4.16 File system limits and control">
<link href="ch4.en.html#s-network-secure" rel="section" title="4.17 Securing network access">
<link href="ch4.en.html#s-snapshot" rel="section" title="4.18 Taking a snapshot of the system">
<link href="ch4.en.html#s4.19" rel="section" title="4.19 Other recommendations">
<link href="ch-sec-services.en.html#s5.1" rel="section" title="5.1 Securing ssh">
<link href="ch-sec-services.en.html#s5.2" rel="section" title="5.2 Securing Squid">
<link href="ch-sec-services.en.html#s-ftp-secure" rel="section" title="5.3 Securing FTP">
<link href="ch-sec-services.en.html#s5.4" rel="section" title="5.4 Securing access to the X Window System">
<link href="ch-sec-services.en.html#s5.5" rel="section" title="5.5 Securing printing access (the lpd and lprng issue)">
<link href="ch-sec-services.en.html#s5.6" rel="section" title="5.6 Securing the mail service">
<link href="ch-sec-services.en.html#s-sec-bind" rel="section" title="5.7 Securing BIND">
<link href="ch-sec-services.en.html#s5.8" rel="section" title="5.8 Securing Apache">
<link href="ch-sec-services.en.html#s5.9" rel="section" title="5.9 Securing finger">
<link href="ch-sec-services.en.html#s-chroot" rel="section" title="5.10 General chroot and suid paranoia">
<link href="ch-sec-services.en.html#s5.11" rel="section" title="5.11 General cleartext password paranoia">
<link href="ch-sec-services.en.html#s5.12" rel="section" title="5.12 Disabling NIS">
<link href="ch-sec-services.en.html#s-rpc" rel="section" title="5.13 Securing RPC services">
<link href="ch-sec-services.en.html#s-firewall-setup" rel="section" title="5.14 Adding firewall capabilities">
<link href="ch-automatic-harden.en.html#s6.1" rel="section" title="6.1 Harden">
<link href="ch-automatic-harden.en.html#s6.2" rel="section" title="6.2 Bastille Linux">
<link href="ch7.en.html#s-debian-sec-team" rel="section" title="7.1 The Debian Security Team">
<link href="ch7.en.html#s-dsa" rel="section" title="7.2 Debian Security Advisories">
<link href="ch7.en.html#s7.3" rel="section" title="7.3 Security Tracker">
<link href="ch7.en.html#s7.4" rel="section" title="7.4 Debian Security Build Infrastructure">
<link href="ch7.en.html#s-deb-pack-sign" rel="section" title="7.5 Package signing in Debian">
<link href="ch-sec-tools.en.html#s-vuln-asses" rel="section" title="8.1 Remote vulnerability assessment tools">
<link href="ch-sec-tools.en.html#s8.2" rel="section" title="8.2 Network scanner tools">
<link href="ch-sec-tools.en.html#s8.3" rel="section" title="8.3 Internal audits">
<link href="ch-sec-tools.en.html#s8.4" rel="section" title="8.4 Auditing source code">
<link href="ch-sec-tools.en.html#s-vpn" rel="section" title="8.5 Virtual Private Networks">
<link href="ch-sec-tools.en.html#s8.6" rel="section" title="8.6 Public Key Infrastructure (PKI)">
<link href="ch-sec-tools.en.html#s8.7" rel="section" title="8.7 SSL Infrastructure">
<link href="ch-sec-tools.en.html#s8.8" rel="section" title="8.8 Antivirus tools">
<link href="ch-sec-tools.en.html#s-gpg-agent" rel="section" title="8.9 GPG agent">
<link href="ch9.en.html#s-bpp-devel-design" rel="section" title="9.1 Best practices for security review and design">
<link href="ch9.en.html#s-bpp-lower-privs" rel="section" title="9.2 Creating users and groups for software daemons">
<link href="ch10.en.html#s-keep-secure" rel="section" title="10.1 Keep your system secure">
<link href="ch10.en.html#s-periodic-integrity" rel="section" title="10.2 Do periodic integrity checks">
<link href="ch10.en.html#s-intrusion-detect" rel="section" title="10.3 Set up Intrusion Detection">
<link href="ch10.en.html#s10.4" rel="section" title="10.4 Avoiding root-kits">
<link href="ch10.en.html#s10.5" rel="section" title="10.5 Genius/Paranoia Ideas &mdash; what you could do">
<link href="ch-after-compromise.en.html#s11.1" rel="section" title="11.1 General behavior">
<link href="ch-after-compromise.en.html#s11.2" rel="section" title="11.2 Backing up the system">
<link href="ch-after-compromise.en.html#s11.3" rel="section" title="11.3 Contact your local CERT">
<link href="ch-after-compromise.en.html#s11.4" rel="section" title="11.4 Forensic analysis">
<link href="ch12.en.html#s12.1" rel="section" title="12.1 Security in the Debian operating system">
<link href="ch12.en.html#s-vulnerable-system" rel="section" title="12.2 My system is vulnerable! (Are you sure?)">
<link href="ch12.en.html#s-debian-sec-team-faq" rel="section" title="12.3 Questions regarding the Debian security team">
<link href="ap-bridge-fw.en.html#sD.1" rel="section" title="D.1 A bridge providing NAT and firewall capabilities">
<link href="ap-bridge-fw.en.html#sD.2" rel="section" title="D.2 A bridge providing firewall capabilities">
<link href="ap-bridge-fw.en.html#sD.3" rel="section" title="D.3 Basic IPtables rules">
<link href="ap-chroot-ssh-env.en.html#sG.1" rel="section" title="G.1 Chrooting the ssh users">
<link href="ap-chroot-ssh-env.en.html#sG.2" rel="section" title="G.2 Chrooting the ssh server">
<link href="ap-chroot-apache-env.en.html#sH.1" rel="section" title="H.1 Introduction">
<link href="ap-chroot-apache-env.en.html#sH.2" rel="section" title="H.2 Installing the server">
<link href="ap-chroot-apache-env.en.html#sH.3" rel="section" title="H.3 See also">
<link href="ch1.en.html#s1.6.1" rel="subsection" title="1.6.1 Version 3.16 (March 2011)">
<link href="ch1.en.html#s1.6.2" rel="subsection" title="1.6.2 Version 3.15 (December 2010)">
<link href="ch1.en.html#s1.6.3" rel="subsection" title="1.6.3 Version 3.14 (March 2009)">
<link href="ch1.en.html#s1.6.4" rel="subsection" title="1.6.4 Version 3.13 (Februrary 2008)">
<link href="ch1.en.html#s1.6.5" rel="subsection" title="1.6.5 Version 3.12 (August 2007)">
<link href="ch1.en.html#s1.6.6" rel="subsection" title="1.6.6 Version 3.11 (January 2007)">
<link href="ch1.en.html#s1.6.7" rel="subsection" title="1.6.7 Version 3.10 (November 2006)">
<link href="ch1.en.html#s1.6.8" rel="subsection" title="1.6.8 Version 3.9 (October 2006)">
<link href="ch1.en.html#s1.6.9" rel="subsection" title="1.6.9 Version 3.8 (July 2006)">
<link href="ch1.en.html#s1.6.10" rel="subsection" title="1.6.10 Version 3.7 (April 2006)">
<link href="ch1.en.html#s1.6.11" rel="subsection" title="1.6.11 Version 3.6 (March 2006)">
<link href="ch1.en.html#s1.6.12" rel="subsection" title="1.6.12 Version 3.5 (November 2005)">
<link href="ch1.en.html#s1.6.13" rel="subsection" title="1.6.13 Version 3.4 (August-September 2005)">
<link href="ch1.en.html#s1.6.14" rel="subsection" title="1.6.14 Version 3.3 (June 2005)">
<link href="ch1.en.html#s1.6.15" rel="subsection" title="1.6.15 Version 3.2 (March 2005)">
<link href="ch1.en.html#s1.6.16" rel="subsection" title="1.6.16 Version 3.1 (January 2005)">
<link href="ch1.en.html#s1.6.17" rel="subsection" title="1.6.17 Version 3.0 (December 2004)">
<link href="ch1.en.html#s1.6.18" rel="subsection" title="1.6.18 Version 2.99 (March 2004)">
<link href="ch1.en.html#s1.6.19" rel="subsection" title="1.6.19 Version 2.98 (December 2003)">
<link href="ch1.en.html#s1.6.20" rel="subsection" title="1.6.20 Version 2.97 (September 2003)">
<link href="ch1.en.html#s1.6.21" rel="subsection" title="1.6.21 Version 2.96 (August 2003)">
<link href="ch1.en.html#s1.6.22" rel="subsection" title="1.6.22 Version 2.95 (June 2003)">
<link href="ch1.en.html#s1.6.23" rel="subsection" title="1.6.23 Version 2.94 (April 2003)">
<link href="ch1.en.html#s1.6.24" rel="subsection" title="1.6.24 Version 2.93 (March 2003)">
<link href="ch1.en.html#s1.6.25" rel="subsection" title="1.6.25 Version 2.92 (February 2003)">
<link href="ch1.en.html#s1.6.26" rel="subsection" title="1.6.26 Version 2.91 (January/February 2003)">
<link href="ch1.en.html#s1.6.27" rel="subsection" title="1.6.27 Version 2.9 (December 2002)">
<link href="ch1.en.html#s1.6.28" rel="subsection" title="1.6.28 Version 2.8 (November 2002)">
<link href="ch1.en.html#s1.6.29" rel="subsection" title="1.6.29 Version 2.7 (October 2002)">
<link href="ch1.en.html#s1.6.30" rel="subsection" title="1.6.30 Version 2.6 (September 2002)">
<link href="ch1.en.html#s1.6.31" rel="subsection" title="1.6.31 Version 2.5 (September 2002)">
<link href="ch1.en.html#s1.6.32" rel="subsection" title="1.6.32 Version 2.5 (August 2002)">
<link href="ch1.en.html#s1.6.33" rel="subsection" title="1.6.33 Version 2.4">
<link href="ch1.en.html#s1.6.34" rel="subsection" title="1.6.34 Version 2.3">
<link href="ch1.en.html#s1.6.35" rel="subsection" title="1.6.35 Version 2.3">
<link href="ch1.en.html#s1.6.36" rel="subsection" title="1.6.36 Version 2.2">
<link href="ch1.en.html#s1.6.37" rel="subsection" title="1.6.37 Version 2.1">
<link href="ch1.en.html#s1.6.38" rel="subsection" title="1.6.38 Version 2.0">
<link href="ch1.en.html#s1.6.39" rel="subsection" title="1.6.39 Version 1.99">
<link href="ch1.en.html#s1.6.40" rel="subsection" title="1.6.40 Version 1.98">
<link href="ch1.en.html#s1.6.41" rel="subsection" title="1.6.41 Version 1.97">
<link href="ch1.en.html#s1.6.42" rel="subsection" title="1.6.42 Version 1.96">
<link href="ch1.en.html#s1.6.43" rel="subsection" title="1.6.43 Version 1.95">
<link href="ch1.en.html#s1.6.44" rel="subsection" title="1.6.44 Version 1.94">
<link href="ch1.en.html#s1.6.45" rel="subsection" title="1.6.45 Version 1.93">
<link href="ch1.en.html#s1.6.46" rel="subsection" title="1.6.46 Version 1.92">
<link href="ch1.en.html#s1.6.47" rel="subsection" title="1.6.47 Version 1.91">
<link href="ch1.en.html#s1.6.48" rel="subsection" title="1.6.48 Version 1.9">
<link href="ch1.en.html#s1.6.49" rel="subsection" title="1.6.49 Version 1.8">
<link href="ch1.en.html#s1.6.50" rel="subsection" title="1.6.50 Version 1.7">
<link href="ch1.en.html#s1.6.51" rel="subsection" title="1.6.51 Version 1.6">
<link href="ch1.en.html#s1.6.52" rel="subsection" title="1.6.52 Version 1.5">
<link href="ch1.en.html#s1.6.53" rel="subsection" title="1.6.53 Version 1.4">
<link href="ch1.en.html#s1.6.54" rel="subsection" title="1.6.54 Version 1.3">
<link href="ch1.en.html#s1.6.55" rel="subsection" title="1.6.55 Version 1.2">
<link href="ch1.en.html#s1.6.56" rel="subsection" title="1.6.56 Version 1.1">
<link href="ch1.en.html#s1.6.57" rel="subsection" title="1.6.57 Version 1.0">
<link href="ch3.en.html#s3.2.1" rel="subsection" title="3.2.1 Choose an intelligent partition scheme">
<link href="ch3.en.html#s3.2.1.1" rel="subsection" title="3.2.1.1 Selecting the appropriate file systems">
<link href="ch3.en.html#s-disableserv" rel="subsection" title="3.6.1 Disabling daemon services">
<link href="ch3.en.html#s-inetd" rel="subsection" title="3.6.2 Disabling <code>inetd</code> or its services">
<link href="ch3.en.html#s3.7.1" rel="subsection" title="3.7.1 Removing Perl">
<link href="ch4.en.html#s-lib-security-update" rel="subsection" title="4.2.1 Security update of libraries">
<link href="ch4.en.html#s-kernel-security-update" rel="subsection" title="4.2.2 Security update of the kernel">
<link href="ch4.en.html#s4.9.1" rel="subsection" title="4.9.1 Setting <code>/tmp</code> noexec">
<link href="ch4.en.html#s4.9.2" rel="subsection" title="4.9.2 Setting /usr read-only">
<link href="ch4.en.html#s-auth-pam" rel="subsection" title="4.10.1 User authentication: PAM">
<link href="ch4.en.html#s-user-limits" rel="subsection" title="4.10.2 Limiting resource usage: the <code>limits.conf</code> file">
<link href="ch4.en.html#s4.10.3" rel="subsection" title="4.10.3 User login actions: edit <code>/etc/login.defs</code>">
<link href="ch4.en.html#s4.10.4" rel="subsection" title="4.10.4 Restricting ftp: editing <code>/etc/ftpusers</code>">
<link href="ch4.en.html#s4.10.5" rel="subsection" title="4.10.5 Using su">
<link href="ch4.en.html#s4.10.6" rel="subsection" title="4.10.6 Using sudo">
<link href="ch4.en.html#s4.10.7" rel="subsection" title="4.10.7 Disallow remote administrative access">
<link href="ch4.en.html#s-user-restrict" rel="subsection" title="4.10.8 Restricting users's access">
<link href="ch4.en.html#s4.10.9" rel="subsection" title="4.10.9 User auditing">
<link href="ch4.en.html#s4.10.9.1" rel="subsection" title="4.10.9.1 Input and output audit with script">
<link href="ch4.en.html#s4.10.9.2" rel="subsection" title="4.10.9.2 Using the shell history file">
<link href="ch4.en.html#s4.10.9.3" rel="subsection" title="4.10.9.3 Complete user audit with accounting utilities">
<link href="ch4.en.html#s4.10.9.4" rel="subsection" title="4.10.9.4 Other user auditing methods">
<link href="ch4.en.html#s4.10.10" rel="subsection" title="4.10.10 Reviewing user profiles">
<link href="ch4.en.html#s4.10.11" rel="subsection" title="4.10.11 Setting users umasks">
<link href="ch4.en.html#s4.10.12" rel="subsection" title="4.10.12 Limiting what users can see/access">
<link href="ch4.en.html#s-limit-user-perm" rel="subsection" title="4.10.12.1 Limiting access to other user's information">
<link href="ch4.en.html#s-user-pwgen" rel="subsection" title="4.10.13 Generating user passwords">
<link href="ch4.en.html#s4.10.14" rel="subsection" title="4.10.14 Checking user passwords">
<link href="ch4.en.html#s-idle-logoff" rel="subsection" title="4.10.15 Logging off idle users">
<link href="ch4.en.html#s-custom-logcheck" rel="subsection" title="4.12.1 Using and customizing <code>logcheck</code>">
<link href="ch4.en.html#s4.12.2" rel="subsection" title="4.12.2 Configuring where alerts are sent">
<link href="ch4.en.html#s4.12.3" rel="subsection" title="4.12.3 Using a loghost">
<link href="ch4.en.html#s4.12.4" rel="subsection" title="4.12.4 Log file permissions">
<link href="ch4.en.html#s4.14.1" rel="subsection" title="4.14.1 Kernel patch protection for buffer overflows">
<link href="ch4.en.html#s4.14.2" rel="subsection" title="4.14.2 Testing programs for overflows">
<link href="ch4.en.html#s4.16.1" rel="subsection" title="4.16.1 Using quotas">
<link href="ch4.en.html#s-ext2attr" rel="subsection" title="4.16.2 The ext2 filesystem specific attributes (chattr/lsattr)">
<link href="ch4.en.html#s-check-integ" rel="subsection" title="4.16.3 Checking file system integrity">
<link href="ch4.en.html#s4.16.4" rel="subsection" title="4.16.4 Setting up setuid check">
<link href="ch4.en.html#s-kernel-conf" rel="subsection" title="4.17.1 Configuring kernel network features">
<link href="ch4.en.html#s-tcp-syncookies" rel="subsection" title="4.17.2 Configuring syncookies">
<link href="ch4.en.html#s-net-harden" rel="subsection" title="4.17.3 Securing the network on boot-time">
<link href="ch4.en.html#s-kernel-fw" rel="subsection" title="4.17.4 Configuring firewall features">
<link href="ch4.en.html#s-limit-bindaddr" rel="subsection" title="4.17.5 Disabling weak-end hosts issues">
<link href="ch4.en.html#s4.17.6" rel="subsection" title="4.17.6 Protecting against ARP attacks">
<link href="ch4.en.html#s4.19.1" rel="subsection" title="4.19.1 Do not use software depending on svgalib">
<link href="ch-sec-services.en.html#s-ssh-chroot" rel="subsection" title="5.1.1 Chrooting ssh">
<link href="ch-sec-services.en.html#s5.1.2" rel="subsection" title="5.1.2 Ssh clients">
<link href="ch-sec-services.en.html#s5.1.3" rel="subsection" title="5.1.3 Disallowing file transfers">
<link href="ch-sec-services.en.html#s-ssh-only-file" rel="subsection" title="5.1.4 Restricing access to file transfer only">
<link href="ch-sec-services.en.html#s5.4.1" rel="subsection" title="5.4.1 Check your display manager">
<link href="ch-sec-services.en.html#s5.6.1" rel="subsection" title="5.6.1 Configuring a Nullmailer">
<link href="ch-sec-services.en.html#s5.6.2" rel="subsection" title="5.6.2 Providing secure access to mailboxes">
<link href="ch-sec-services.en.html#s5.6.3" rel="subsection" title="5.6.3 Receiving mail securely">
<link href="ch-sec-services.en.html#s-configure-bind" rel="subsection" title="5.7.1 Bind configuration to avoid misuse">
<link href="ch-sec-services.en.html#s-user-bind" rel="subsection" title="5.7.2 Changing BIND's user">
<link href="ch-sec-services.en.html#s-chroot-bind" rel="subsection" title="5.7.3 Chrooting the name server">
<link href="ch-sec-services.en.html#s5.8.1" rel="subsection" title="5.8.1 Disabling users from publishing web contents">
<link href="ch-sec-services.en.html#s5.8.2" rel="subsection" title="5.8.2 Logfiles permissions">
<link href="ch-sec-services.en.html#s5.8.3" rel="subsection" title="5.8.3 Published web files">
<link href="ch-sec-services.en.html#s-auto-chroot" rel="subsection" title="5.10.1 Making chrooted environments automatically">
<link href="ch-sec-services.en.html#s5.13.1" rel="subsection" title="5.13.1 Disabling RPC services completely">
<link href="ch-sec-services.en.html#s5.13.2" rel="subsection" title="5.13.2 Limiting access to RPC services">
<link href="ch-sec-services.en.html#s5.14.1" rel="subsection" title="5.14.1 Firewalling the local system">
<link href="ch-sec-services.en.html#s5.14.2" rel="subsection" title="5.14.2 Using a firewall to protect other systems">
<link href="ch-sec-services.en.html#s5.14.3" rel="subsection" title="5.14.3 Setting up a firewall">
<link href="ch-sec-services.en.html#s-firewall-pack" rel="subsection" title="5.14.3.1 Using firewall packages">
<link href="ch-sec-services.en.html#s5.14.3.2" rel="subsection" title="5.14.3.2 Manual init.d configuration">
<link href="ch-sec-services.en.html#s5.14.3.3" rel="subsection" title="5.14.3.3 Configuring firewall rules through <code>ifup</code>">
<link href="ch-sec-services.en.html#s5.14.3.4" rel="subsection" title="5.14.3.4 Testing your firewall configuration">
<link href="ch7.en.html#s-crossreference" rel="subsection" title="7.2.1 Vulnerability cross references">
<link href="ch7.en.html#s-cve-compatible" rel="subsection" title="7.2.2 CVE compatibility">
<link href="ch7.en.html#s7.4.1" rel="subsection" title="7.4.1 Developer's guide to security updates">
<link href="ch7.en.html#s7.5.1" rel="subsection" title="7.5.1 The current scheme for package signature checks">
<link href="ch7.en.html#s-apt-0.6" rel="subsection" title="7.5.2 Secure apt">
<link href="ch7.en.html#s-check-releases" rel="subsection" title="7.5.3 Per distribution release check">
<link href="ch7.en.html#s7.5.3.1" rel="subsection" title="7.5.3.1 Basic concepts">
<link href="ch7.en.html#s7.5.3.2" rel="subsection" title="7.5.3.2 <code>Release</code> checksums">
<link href="ch7.en.html#s7.5.3.3" rel="subsection" title="7.5.3.3 Verification of the <code>Release</code> file">
<link href="ch7.en.html#s7.5.3.4" rel="subsection" title="7.5.3.4 Check of <code>Release.gpg</code> by <code>apt</code>">
<link href="ch7.en.html#s7.5.3.5" rel="subsection" title="7.5.3.5 How to tell apt what to trust">
<link href="ch7.en.html#s7.5.3.6" rel="subsection" title="7.5.3.6 Finding the key for a repository">
<link href="ch7.en.html#s-secure-apt-add-key" rel="subsection" title="7.5.3.7 Safely adding a key">
<link href="ch7.en.html#s7.5.3.8" rel="subsection" title="7.5.3.8 Verifying key integrity">
<link href="ch7.en.html#s7.5.3.9" rel="subsection" title="7.5.3.9 Debian archive key yearly rotation">
<link href="ch7.en.html#s7.5.3.10" rel="subsection" title="7.5.3.10 Known release checking problems">
<link href="ch7.en.html#s-manual-check-releases" rel="subsection" title="7.5.3.11 Manual per distribution release check">
<link href="ch7.en.html#s-check-non-debian-releases" rel="subsection" title="7.5.4 Release check of non Debian sources">
<link href="ch7.en.html#s-check-pkg-sign" rel="subsection" title="7.5.5 Alternative per-package signing scheme">
<link href="ch-sec-tools.en.html#s8.5.1" rel="subsection" title="8.5.1 Point to Point tunneling">
<link href="ch10.en.html#s-track-vulns" rel="subsection" title="10.1.1 Tracking security vulnerabilities">
<link href="ch10.en.html#s-keep-up-to-date" rel="subsection" title="10.1.2 Continuously update the system">
<link href="ch10.en.html#s10.1.2.1" rel="subsection" title="10.1.2.1 Manually checking which security updates are available">
<link href="ch10.en.html#s-update-desktop" rel="subsection" title="10.1.2.2 Checking for updates at the Desktop">
<link href="ch10.en.html#s-cron-apt" rel="subsection" title="10.1.2.3 Automatically checking for updates with cron-apt">
<link href="ch10.en.html#s-debsecan" rel="subsection" title="10.1.2.4 Automatically checking for security issues with debsecan">
<link href="ch10.en.html#s10.1.2.5" rel="subsection" title="10.1.2.5 Other methods for security updates">
<link href="ch10.en.html#s10.1.3" rel="subsection" title="10.1.3 Avoid using the unstable branch">
<link href="ch10.en.html#s-security-support-testing" rel="subsection" title="10.1.4 Security support for the testing branch">
<link href="ch10.en.html#s10.1.5" rel="subsection" title="10.1.5 Automatic updates in a Debian GNU/Linux system">
<link href="ch10.en.html#s10.3.1" rel="subsection" title="10.3.1 Network based intrusion detection">
<link href="ch10.en.html#s10.3.2" rel="subsection" title="10.3.2 Host based intrusion detection">
<link href="ch10.en.html#s-LKM" rel="subsection" title="10.4.1 Loadable Kernel Modules (LKM)">
<link href="ch10.en.html#s10.4.2" rel="subsection" title="10.4.2 Detecting root-kits">
<link href="ch10.en.html#s-proactive" rel="subsection" title="10.4.2.1 Proactive defense">
<link href="ch10.en.html#s10.4.2.2" rel="subsection" title="10.4.2.2 Reactive defense">
<link href="ch10.en.html#s10.5.1" rel="subsection" title="10.5.1 Building a honeypot">
<link href="ch-after-compromise.en.html#s11.4.1" rel="subsection" title="11.4.1 Analysis of malware">
<link href="ch12.en.html#s12.1.1" rel="subsection" title="12.1.1 Is Debian more secure than X?">
<link href="ch12.en.html#s12.1.1.1" rel="subsection" title="12.1.1.1 Is Debian more secure than other Linux distributions (such as Red Hat, SuSE...)?">
<link href="ch12.en.html#s12.1.2" rel="subsection" title="12.1.2 There are many Debian bugs in Bugtraq. Does this mean that it is very vulnerable?">
<link href="ch12.en.html#s12.1.3" rel="subsection" title="12.1.3 Does Debian have any certification related to security?">
<link href="ch12.en.html#s12.1.4" rel="subsection" title="12.1.4 Are there any hardening programs for Debian?">
<link href="ch12.en.html#s12.1.5" rel="subsection" title="12.1.5 I want to run XYZ service, which one should I choose?">
<link href="ch12.en.html#s12.1.6" rel="subsection" title="12.1.6 How can I make service XYZ more secure in Debian?">
<link href="ch12.en.html#s12.1.7" rel="subsection" title="12.1.7 How can I remove all the banners for services?">
<link href="ch12.en.html#s12.1.8" rel="subsection" title="12.1.8 Are all Debian packages safe?">
<link href="ch12.en.html#s12.1.9" rel="subsection" title="12.1.9 Why are some log files/configuration files world-readable, isn't this insecure?">
<link href="ch12.en.html#s12.1.10" rel="subsection" title="12.1.10 Why does /root/ (or UserX) have 755 permissions?">
<link href="ch12.en.html#s12.1.11" rel="subsection" title="12.1.11 After installing a grsec/firewall, I started receiving many console messages! How do I remove them?">
<link href="ch12.en.html#s-faq-os-users" rel="subsection" title="12.1.12 Operating system users and groups">
<link href="ch12.en.html#s12.1.12.1" rel="subsection" title="12.1.12.1 Are all system users necessary?">
<link href="ch12.en.html#s12.1.12.2" rel="subsection" title="12.1.12.2 I removed a system user! How can I recover?">
<link href="ch12.en.html#s12.1.12.3" rel="subsection" title="12.1.12.3 What is the difference between the adm and the staff group?">
<link href="ch12.en.html#s12.1.13" rel="subsection" title="12.1.13 Why is there a new group when I add a new user? (or Why does Debian give each user one group?)">
<link href="ch12.en.html#s12.1.14" rel="subsection" title="12.1.14 Questions regarding services and open ports">
<link href="ch12.en.html#s12.1.14.1" rel="subsection" title="12.1.14.1 Why are all services activated upon installation?">
<link href="ch12.en.html#s12.1.14.2" rel="subsection" title="12.1.14.2 Can I remove <code>inetd</code>?">
<link href="ch12.en.html#s12.1.14.3" rel="subsection" title="12.1.14.3 Why do I have port 111 open?">
<link href="ch12.en.html#s12.1.14.4" rel="subsection" title="12.1.14.4 What use is <code>identd</code> (port 113) for?">
<link href="ch12.en.html#s12.1.14.5" rel="subsection" title="12.1.14.5 I have services using port 1 and 6, what are they and how can I remove them?">
<link href="ch12.en.html#s12.1.14.6" rel="subsection" title="12.1.14.6 I found the port XYZ open, can I close it?">
<link href="ch12.en.html#s12.1.14.7" rel="subsection" title="12.1.14.7 Will removing services from <code>/etc/services</code> help secure my box?">
<link href="ch12.en.html#s12.1.15" rel="subsection" title="12.1.15 Common security issues">
<link href="ch12.en.html#s12.1.15.1" rel="subsection" title="12.1.15.1 I have lost my password and cannot access the system!">
<link href="ch12.en.html#s12.1.16" rel="subsection" title="12.1.16 How do I accomplish setting up a service for my users without giving out shell accounts?">
<link href="ch12.en.html#s-vulnasses-false-positive" rel="subsection" title="12.2.1 Vulnerability assessment scanner X says my Debian system is vulnerable!">
<link href="ch12.en.html#s12.2.2" rel="subsection" title="12.2.2 I've seen an attack in my system's logs. Is my system compromised?">
<link href="ch12.en.html#s12.2.3" rel="subsection" title="12.2.3 I have found strange 'MARK' lines in my logs: Am I compromised?">
<link href="ch12.en.html#s12.2.4" rel="subsection" title="12.2.4 I found users using 'su' in my logs: Am I compromised?">
<link href="ch12.en.html#s12.2.5" rel="subsection" title="12.2.5 I have found 'possible SYN flooding' in my logs: Am I under attack?">
<link href="ch12.en.html#s12.2.6" rel="subsection" title="12.2.6 I have found strange root sessions in my logs: Am I compromised?">
<link href="ch12.en.html#s12.2.7" rel="subsection" title="12.2.7 I have suffered a break-in, what do I do?">
<link href="ch12.en.html#s12.2.8" rel="subsection" title="12.2.8 How can I trace an attack?">
<link href="ch12.en.html#s12.2.9" rel="subsection" title="12.2.9 Program X in Debian is vulnerable, what do I do?">
<link href="ch12.en.html#s-version-backport" rel="subsection" title="12.2.10 The version number for a package indicates that I am still running a vulnerable version!">
<link href="ch12.en.html#s12.2.11" rel="subsection" title="12.2.11 Specific software">
<link href="ch12.en.html#s12.2.11.1" rel="subsection" title="12.2.11.1 <code>proftpd</code> is vulnerable to a Denial of Service attack.">
<link href="ch12.en.html#s12.2.11.2" rel="subsection" title="12.2.11.2 After installing <code>portsentry</code>, there are a lot of ports open.">
<link href="ch12.en.html#s12.3.1" rel="subsection" title="12.3.1 What is a Debian Security Advisory (DSA)?">
<link href="ch12.en.html#s12.3.2" rel="subsection" title="12.3.2 The signature on Debian advisories does not verify correctly!">
<link href="ch12.en.html#s12.3.3" rel="subsection" title="12.3.3 How is security handled in Debian?">
<link href="ch12.en.html#s12.3.4" rel="subsection" title="12.3.4 Why are you fiddling with an old version of that package?">
<link href="ch12.en.html#s12.3.5" rel="subsection" title="12.3.5 What is the policy for a fixed package to appear in security.debian.org?">
<link href="ch12.en.html#s12.3.6" rel="subsection" title="12.3.6 What does &quot;local (remote)&quot; mean?">
<link href="ch12.en.html#s12.3.7" rel="subsection" title="12.3.7 The version number for a package indicates that I am still running a vulnerable version!">
<link href="ch12.en.html#s-sec-unstable" rel="subsection" title="12.3.8 How is security handled for <samp>testing</samp> and <samp>unstable</samp>?">
<link href="ch12.en.html#s-sec-older" rel="subsection" title="12.3.9 I use an older version of Debian, is it supported by the Debian Security Team?">
<link href="ch12.en.html#s12.3.10" rel="subsection" title="12.3.10 How does <em>testing</em> get security updates?">
<link href="ch12.en.html#s12.3.11" rel="subsection" title="12.3.11 How is security handled for contrib and non-free?">
<link href="ch12.en.html#s12.3.12" rel="subsection" title="12.3.12 Why are there no official mirrors for security.debian.org?">
<link href="ch12.en.html#s12.3.13" rel="subsection" title="12.3.13 I've seen DSA 100 and DSA 102, now where is DSA 101?">
<link href="ch12.en.html#s12.3.14" rel="subsection" title="12.3.14 I tried to download a package listed in one of the security advisories, but I got a `file not found' error.">
<link href="ch12.en.html#s12.3.15" rel="subsection" title="12.3.15 How can I reach the security team?">
<link href="ch12.en.html#s12.3.16" rel="subsection" title="12.3.16 What difference is there between security@debian.org and debian-security@lists.debian.org?">
<link href="ch12.en.html#s12.3.17" rel="subsection" title="12.3.17 I guess I found a security problem, what should I do?">
<link href="ch12.en.html#s12.3.18" rel="subsection" title="12.3.18 How can I contribute to the Debian security team?">
<link href="ch12.en.html#s12.3.19" rel="subsection" title="12.3.19 Who is the Security Team composed of?">
<link href="ch12.en.html#s12.3.20" rel="subsection" title="12.3.20 Does the Debian Security team check every new package in Debian?">
<link href="ch12.en.html#s12.3.21" rel="subsection" title="12.3.21 How much time will it take Debian to fix vulnerability XXXX?">
<link href="ch12.en.html#s12.3.22" rel="subsection" title="12.3.22 How long will security updates be provided?">
<link href="ch12.en.html#s12.3.23" rel="subsection" title="12.3.23 How can I check the integrity of packages?">
<link href="ch12.en.html#s12.3.24" rel="subsection" title="12.3.24 What to do if a random package breaks after a security update?">
<link href="ap-chroot-ssh-env.en.html#sG.1.1" rel="subsection" title="G.1.1 Using <code>libpam-chroot</code>">
<link href="ap-chroot-ssh-env.en.html#sG.1.2" rel="subsection" title="G.1.2 Patching the <code>ssh</code> server">
<link href="ap-chroot-ssh-env.en.html#sG.2.1" rel="subsection" title="G.2.1 Setup a minimal system (the really easy way)">
<link href="ap-chroot-ssh-env.en.html#sG.2.2" rel="subsection" title="G.2.2 Automatically making the environment (the easy way)">
<link href="ap-chroot-ssh-env.en.html#sG.2.3" rel="subsection" title="G.2.3 Manually creating the environment (the hard way)">
<link href="ap-chroot-apache-env.en.html#sH.1.1" rel="subsection" title="H.1.1 Licensing">

</head>

<body>

<p><a name="ch4"></a></p>
<hr>

<p>
[ <a href="ch3.en.html">previous</a> ]
[ <a href="index.en.html#contents">Contents</a> ]
[ <a href="ch1.en.html">1</a> ]
[ <a href="ch2.en.html">2</a> ]
[ <a href="ch3.en.html">3</a> ]
[ 4 ]
[ <a href="ch-sec-services.en.html">5</a> ]
[ <a href="ch-automatic-harden.en.html">6</a> ]
[ <a href="ch7.en.html">7</a> ]
[ <a href="ch-sec-tools.en.html">8</a> ]
[ <a href="ch9.en.html">9</a> ]
[ <a href="ch10.en.html">10</a> ]
[ <a href="ch-after-compromise.en.html">11</a> ]
[ <a href="ch12.en.html">12</a> ]
[ <a href="ap-harden-step.en.html">A</a> ]
[ <a href="ap-checklist.en.html">B</a> ]
[ <a href="ap-snort-box.en.html">C</a> ]
[ <a href="ap-bridge-fw.en.html">D</a> ]
[ <a href="ap-bind-chuser.en.html">E</a> ]
[ <a href="ap-fw-security-update.en.html">F</a> ]
[ <a href="ap-chroot-ssh-env.en.html">G</a> ]
[ <a href="ap-chroot-apache-env.en.html">H</a> ]
[ <a href="ch-sec-services.en.html">next</a> ]
</p>

<hr>

<h1>
Securing Debian Manual
<br>Chapter 4 - After installation
</h1>

<hr>

<p>
Once the system is installed you can still do more to secure the system; some
of the steps described in this chapter can be taken.  Of course this really
depends on your setup but for physical access prevention you should read <a
href="#s-bios-boot">Change the BIOS (again), Section 4.3</a>,<a
href="#s-lilo-passwd">Set a LILO or GRUB password, Section 4.4</a>,<a
href="#s-kernel-root-prompt">Remove root prompt on the kernel, Section 4.6</a>,
<a href="#s-restrict-console-login">Restricting console login access, Section
4.7</a>, and <a href="#s-restrict-reboots">Restricting system reboots through
the console, Section 4.8</a>.
</p>

<p>
Before connecting to any network, especially if it's a public one you should,
at the very least, execute a security update (see <a
href="#s-security-update">Execute a security update, Section 4.2</a>).
Optionally, you could take a snapshot of your system (see <a
href="#s-snapshot">Taking a snapshot of the system, Section 4.18</a>).
</p>

<hr>

<h2><a name="s-debian-sec-announce"></a>4.1 Subscribe to the Debian Security Announce mailing list</h2>

<p>
In order to receive information on available security updates you should
subscribe yourself to the debian-security-announce mailing list in order to
receive the Debian Security Advisories (DSAs).  See <a
href="ch7.en.html#s-debian-sec-team">The Debian Security Team, Section 7.1</a>
for more information on how the Debian security team works.  For information on
how to subscribe to the Debian mailing lists read <code><a
href="http://lists.debian.org">http://lists.debian.org</a></code>.
</p>

<p>
DSAs are signed with the Debian Security Team's signature which can be
retrieved from <code><a
href="http://security.debian.org">http://security.debian.org</a></code>.
</p>

<p>
You should consider, also, subscribing to the <code><a
href="http://lists.debian.org/debian-security">debian-security mailing
list</a></code> for general discussion on security issues in the Debian
operating system.  You will be able to contact other fellow system
administrators in the list as well as Debian developers and upstream developers
of security tools who can answer your questions and offer advice.
</p>

<p>
FIXME: Add the key here too?
</p>

<hr>

<h2><a name="s-security-update"></a>4.2 Execute a security update</h2>

<p>
As soon as new security bugs are detected in packages, Debian maintainers and
upstream authors generally patch them within days or even hours.  After the bug
is fixed, a new package is provided on <code><a
href="http://security.debian.org">http://security.debian.org</a></code>.
</p>

<p>
If you are installing a Debian release you must take into account that since
the release was made there might have been security updates after it has been
determined that a given package is vulnerable.  Also, there might have been
minor releases (there have been four for the Debian 3.0 <em>sarge</em> release)
which include these package updates.
</p>

<p>
During installation security updates are configured for your system and pending
updates downloaded and applied, unless you specifically opt out of this or the
system was not connected to the Internet.  The updates are applied even before
the first boot, so the new system starts its life as up to date as possible.
</p>

<p>
To manually update the system, put the following line in your
<code>sources.list</code> and you will get security updates automatically,
whenever you update your system.  Replace <em>[CODENAME]</em> with the release
codename, e.g.  <em>squeeze</em>.
</p>

<pre>
       deb http://security.debian.org/ [CODENAME]/updates main contrib non-free
</pre>

<p>
<em>Note</em>: If you are using the <em>testing</em> branch use the security
testing mirror sources as described in <a
href="ch10.en.html#s-security-support-testing">Security support for the testing
branch, Section 10.1.4</a>.
</p>

<p>
Once you've done this you can use multiple tools to upgrade your system.  If
you are running a desktop system you will have[<a href="footnotes.en.html#f9"
name="fr9">9</a>] an application called <code>update-notifier</code> that will
make it easy to check if new updates are available, by selecting it you can
make a system upgrade from the desktop (using <code>update-manager</code>).
For more information see <a href="ch10.en.html#s-update-desktop">Checking for
updates at the Desktop, Section 10.1.2.2</a>.  In desktop environments you can
also use <code>synaptic</code> (GNOME), <code>kpackage</code> or
<code>adept</code> (KDE) for more advanced interfaces.  If you are running a
text-only terminal you can use <code>aptitude</code>, <code>apt</code> or
<code>dselect</code> (deprecated) to upgrade:
</p>
<ul>
<li>
<p>
If you want to use <code>aptitude</code>'s text interface you just have to
press <em>u</em> (update) followed by <em>g</em> (to upgrade).  Or just do the
following from the command line (as root):
</p>

<pre>
     # aptitude update
     # aptitude upgrade
</pre>
</li>
</ul>
<ul>
<li>
<p>
If you want to use <code>apt</code> do just like with aptitude but substitute
the <code>aptitude</code> lines above with <code>apt-get</code>.
</p>
</li>
</ul>
<ul>
<li>
<p>
If you want to use <code>dselect</code> then first [U]pdate, then [I]nstall and
finally, [C]onfigure the installed/upgraded packages.
</p>
</li>
</ul>

<p>
If you like, you can add the deb-src lines to
<code>/etc/apt/sources.list</code> as well.  See <code>apt(8)</code> for
further details.
</p>

<hr>

<h3><a name="s-lib-security-update"></a>4.2.1 Security update of libraries</h3>

<p>
Once you have executed a security update you might need to restart some of the
system services.  If you do not do this, some services might still be
vulnerable after a security upgrade.  The reason for this is that daemons that
are running before an upgrade might still be using the old libraries before the
upgrade [<a href="footnotes.en.html#f10" name="fr10">10</a>].  In order to
detect which daemons might need to be restarted you can use the
<code>checkrestart</code> program (available in the <code>debian-goodies</code>
package) or use this one liner[<a href="footnotes.en.html#f11"
name="fr11">11</a>] (as root):
</p>

<pre>
     # lsof | grep &lt;the_upgraded_library&gt; | awk '{print $1, $9}' | uniq | sort -k 1
</pre>

<p>
Some packages (like <code>libc6</code>) will do this check in the postinst
phase for a limited set of services specially since an upgrade of essential
libraries might break some applications (until restarted)[<a
href="footnotes.en.html#f12" name="fr12">12</a>].
</p>

<p>
Bringing the system to run level 1 (single user) and then back to run level 3
(multi user) should take care of the restart of most (if not all) system
services.  But this is not an option if you are executing the security upgrade
from a remote connection (like ssh) since it will be severed.
</p>

<p>
Excercise caution when dealing with security upgrades if you are doing them
over a remote connection like ssh.  A suggested procedure for a security
upgrade that involves a service restart is to restart the SSH daemon and then,
inmediately, attempt a new ssh connection without breaking the previous one.
If the connection fails, revert the upgrade and investigate the issue.
</p>

<hr>

<h3><a name="s-kernel-security-update"></a>4.2.2 Security update of the kernel</h3>

<p>
First, make sure your kernel is being managed through the packaging system.  If
you have installed using the installation system from Debian 3.0 or previous
releases, your kernel is <em>not</em> integrated into the packaging system and
might be out of date.  You can easily confirm this by running:
</p>

<pre>
     $ dpkg -S `readlink -f /vmlinuz`
     linux-image-2.6.18-4-686: /boot/vmlinuz-2.6.18-4-686
</pre>

<p>
If your kernel is not being managed you will see a message saying that the
package manager did not find the file associated to any package instead of the
message above, which says that the file associated to the current running
kernel is being provided by the <code>linux-image-2.6.18-4-686</code>.  So
first, you will need to manually install a kernel image package.  The exact
kernel image you need to install depends on your architecture and your prefered
kernel version.  Once this is done, you will be able to manage the security
updates of the kernel just like those of any other package.  In any case,
notice that the kernel updates will <em>only</em> be done for kernel updates of
the same kernel version you are using, that is, <code>apt</code> will not
automatically upgrade your kernel from the 2.4 release to the 2.6 release (or
from the 2.4.26 release to the 2.4.27 release[<a href="footnotes.en.html#f13"
name="fr13">13</a>]).
</p>

<p>
The installation system of recent Debian releases will handle the selected
kernel as part of the package system.  You can review which kernels you have
installed by running:
</p>

<pre>
     $ COLUMNS=150 dpkg -l 'linux-image*' | awk '$1 ~ /ii/ { print $0 }'
</pre>

<p>
To see if your kernel needs to be updated run:
</p>

<pre>
     $ kernfile=`readlink -f /vmlinuz`
     $ kernel=`dpkg -S $kernfile | awk -F : '{print $1}'`
     $ apt-cache policy $kernel
     linux-image-2.6.18-4-686:
       Installed: 2.6.18.dfsg.1-12
       Candidate: 2.6.18.dfsg.1-12
       Version table:
      *** 2.6.18.dfsg.1-12 0
             100 /var/lib/dpkg/status
</pre>

<p>
If you are doing a security update which includes the kernel image you
<em>need</em> to reboot the system in order for the security update to be
useful.  Otherwise, you will still be running the old (and vulnerable) kernel
image.
</p>

<p>
If you need to do a system reboot (because of a kernel upgrade) you should make
sure that the kernel will boot up correctly and network connectivity will be
restored, specially if the security upgrade is done over a remote connection
like ssh.  For the former you can configure your boot loader to reboot to the
original kernel in the event of a failure (for more detailed information read
<code><a href="http://www.debian-administration.org/?article=70">Remotely
rebooting Debian GNU/Linux machines</a></code>).  For the latter you have to
introduce a network connectivity test script that will check if the kernel has
started up the network subsystem properly and reboot the system if it did
not[<a href="footnotes.en.html#f14" name="fr14">14</a>].  This should prevent
nasty surprises like updating the kernel and then realizing, after a reboot,
that it did not detect or configure the network hardware properly and you need
to travel a long distance to bring the system up again.  Of course, having the
system serial console [<a href="footnotes.en.html#f15" name="fr15">15</a>] in
the system connected to a console or terminal server should also help debug
reboot issues remotely.
</p>

<hr>

<h2><a name="s-bios-boot"></a>4.3 Change the BIOS (again)</h2>

<p>
Remember <a href="ch3.en.html#s-bios-passwd">Choose a BIOS password, Section
3.1</a>?  Well, then you should now, once you do not need to boot from
removable media, to change the default BIOS setup so that it <em>only</em>
boots from the hard drive.  Make sure you will not lose the BIOS password,
otherwise, in the event of a hard disk failure you will not be able to return
to the BIOS and change the setup so you can recover it using, for example, a
CD-ROM.
</p>

<p>
Another less secure but more convenient way is to change the setup to have the
system boot up from the hard disk and, if it fails, try removable media.  By
the way, this is often done because most people don't use the BIOS password
that often; it's easily forgotten.
</p>

<hr>

<h2><a name="s-lilo-passwd"></a>4.4 Set a LILO or GRUB password</h2>

<p>
Anybody can easily get a root-shell and change your passwords by entering
<samp>&lt;name-of-your-bootimage&gt; init=/bin/sh</samp> at the boot prompt.
After changing the passwords and rebooting the system, the person has unlimited
root-access and can do anything he/she wants to the system.  After this
procedure you will not have root access to your system, as you do not know the
root password.
</p>

<p>
To make sure that this cannot happen, you should set a password for the boot
loader.  You can choose between a global password or a password for a certain
image.
</p>

<p>
For LILO you need to edit the config file <code>/etc/lilo.conf</code> and add a
<samp>password</samp> and <samp>restricted</samp> line as in the example below.
</p>

<pre>
       image=/boot/2.2.14-vmlinuz
          label=Linux
          read-only
          password=hackme
          restricted
</pre>

<p>
Then, make sure that the configuration file is not world readable to prevent
local users from reading the password.  When done, rerun lilo.  Omitting the
<samp>restricted</samp> line causes lilo to always prompt for a password,
regardless of whether LILO was passed parameters.  The default permissions for
<code>/etc/lilo.conf</code> grant read and write permissions to root, and
enable read-only access for <code>lilo.conf</code>'s group, root.
</p>

<p>
If you use GRUB instead of LILO, edit <code>/boot/grub/menu.lst</code> and add
the following two lines at the top (substituting, of course <samp>hackme</samp>
with the desired password).  This prevents users from editing the boot items.
<samp>timeout 3</samp> specifies a 3 second delay before <code>grub</code>
boots the default item.
</p>

<pre>
       timeout 3
       password hackme
</pre>

<p>
To further harden the integrity of the password, you may store the password in
an encrypted form.  The utility <code>grub-md5-crypt</code> generates a hashed
password which is compatible with GRUB's encrypted password algorithm (MD5).
To specify in <code>grub</code> that an MD5 format password will be used, use
the following directive:
</p>

<pre>
       timeout 3
       password --md5 $1$bw0ez$tljnxxKLfMzmnDVaQWgjP0
</pre>

<p>
The --md5 parameter was added to instruct <code>grub</code> to perform the MD5
authentication process.  The provided password is the MD5 encrypted version of
hackme.  Using the MD5 password method is preferable to choosing its clear-text
counterpart.  More information about <code>grub</code> passwords may be found
in the <code>grub-doc</code> package.
</p>

<hr>

<h2><a name="s-kernel-initramfs-prompt"></a>4.5 Disable root prompt on the initramfs</h2>

<p>
Note: This applies to the default kernels provided for releases after Debian
3.1
</p>

<p>
Linux 2.6 kernels provide a way to access a root shell while booting which will
be presented during loading the initramfs on error.  This is helpful to permit
the administrator to enter a rescue shell with root permissions.  This shell
can be used to manually load modules when autodetection fails.  This behavior
is the default for <code>initramfs-tools</code> generated initramfs.  The
following message will appear:
</p>

<pre>
       &quot;ALERT!  /dev/sda1 does not exist.  Dropping to a shell!
</pre>

<p>
In order to remove this behavior you need to set the following boot
argument:<em>panic=0</em>.  Either add it to the kopt section of
<code>/boot/grub/menu.lst</code> and issue <code>update-grub</code> or to the
append section of <code>/etc/lilo.conf</code>.
</p>

<hr>

<h2><a name="s-kernel-root-prompt"></a>4.6 Remove root prompt on the kernel</h2>

<p>
Note: This does not apply to the kernels provided for Debian 3.1 as the timeout
for the kernel delay has been changed to 0.
</p>

<p>
Linux 2.4 kernels provide a way to access a root shell while booting which will
be presented just after loading the cramfs file system.  A message will appear
to permit the administrator to enter an executable shell with root permissions,
this shell can be used to manually load modules when autodetection fails.  This
behavior is the default for <code>initrd</code>'s <code>linuxrc</code>.  The
following message will appear:
</p>

<pre>
       Press ENTER to obtain a shell (waits 5 seconds)
</pre>

<p>
In order to remove this behavior you need to change
<code>/etc/mkinitrd/mkinitrd.conf</code> and set:
</p>

<pre>
       # DELAY  The  number  of seconds the linuxrc script should wait to
       # allow the user to interrupt it before the system is brought up
       DELAY=0
</pre>

<p>
Then regenerate your ramdisk image.  You can do this for example with:
</p>

<pre>
       # cd /boot
       # mkinitrd -o initrd.img-2.4.18-k7 /lib/modules/2.4.18-k7
</pre>

<p>
or (preferred):
</p>

<pre>
       # dpkg-reconfigure -plow kernel-image-2.4.x-yz
</pre>

<hr>

<h2><a name="s-restrict-console-login"></a>4.7 Restricting console login access</h2>

<p>
Some security policies might force administrators to log in to the system
through the console with their user/password and then become superuser (with
<code>su</code> or <code>sudo</code>).  This policy is implemented in Debian by
editing the <code>/etc/login.defs</code> file or <code>/etc/securetty</code>
when using PAM.  In:
</p>
<ul>
<li>
<p>
<code>login.defs</code>, editing the CONSOLE variable which defines a file or
list of terminals on which root logins are allowed
</p>
</li>
</ul>
<ul>
<li>
<p>
<code>securetty</code>[<a href="footnotes.en.html#f16" name="fr16">16</a>] by
adding/removing the terminals to which root access will be allowed.  If you
wish to allow only local console access then you need <em>console</em>,
<em>ttyX</em>[<a href="footnotes.en.html#f17" name="fr17">17</a>] and
<em>vc/X</em> (if using <em>devfs</em> devices), you might want to add also
<em>ttySX</em>[<a href="footnotes.en.html#f18" name="fr18">18</a>] if you are
using a serial console for local access (where X is an integer, you might want
to have multiple instances[<a href="footnotes.en.html#f19" name="fr19">19</a>]
depending on the number of virtual consoles you have enabled in
<code>/etc/inittab</code>[<a href="footnotes.en.html#f20" name="fr20">20</a>]).
For more information on terminal devices read the <code><a
href="http://tldp.org/HOWTO/Text-Terminal-HOWTO-6.html">Text-Terminal-HOWTO</a></code>.
</p>
</li>
</ul>

<p>
When using PAM, other changes to the login process, which might include
restrictions to users and groups at given times, can be configured in
<code>/etc/pam.d/login</code>.  An interesting feature that can be disabled is
the possibility to login with null (blank) passwords.  This feature can be
limited by removing <em>nullok</em> from the line:
</p>

<pre>
       auth       required   pam_unix.so nullok
</pre>

<hr>

<h2><a name="s-restrict-reboots"></a>4.8 Restricting system reboots through the console</h2>

<p>
If your system has a keyboard attached to it anyone (yes <em>anyone</em>) can
reboot the system through it without login to the system.  This might, or might
not, adhere to your security policy.  If you want to restrict this, you must
check the <code>/etc/inittab</code> so that the line that includes
<samp>ctrlaltdel</samp> calls <code>shutdown</code> with the <samp>-a</samp>
switch (remember to run <samp>init q</samp> after making any changes to this
file).  The default in Debian includes this switch:
</p>

<pre>
       ca:12345:ctrlaltdel:/sbin/shutdown -t1 -a -r now
</pre>

<p>
Now, in order to allow <em>some</em> users to shutdown the system, as the
manpage <code>shutdown(8)</code> describes, you must create the file
<code>/etc/shutdown.allow</code> and include there the name of users which can
boot the system.  When the <em>three finger salute</em> (a.k.a.
<em>ctrl+alt+del</em>) is given the program will check if any of the users
listed in the file are logged in.  If none of them is, <code>shutdown</code>
will <em>not</em> reboot the system.
</p>

<hr>

<h2><a name="s4.9"></a>4.9 Mounting partitions the right way</h2>

<p>
When mounting an <samp>ext2</samp> or <samp>ext3</samp> file system, there are
several additional options you can apply to the mount call or to
<code>/etc/fstab</code>.  For instance, this is my fstab entry for the
<code>/tmp</code> partition:
</p>

<pre>
       /dev/hda7    /tmp    ext2    defaults,nosuid,noexec,nodev    0    2
</pre>

<p>
You see the difference in the options sections.  The option <samp>nosuid</samp>
ignores the setuid and setgid bits completely, while <samp>noexec</samp>
forbids execution of any program on that mount point, and <samp>nodev</samp>
ignores device files.  This sounds great, but it:
</p>
<ul>
<li>
<p>
only applies to <samp>ext2</samp> or <samp>ext3</samp> file systems
</p>
</li>
</ul>
<ul>
<li>
<p>
can be circumvented easily
</p>
</li>
</ul>

<p>
The <samp>noexec</samp> option prevents binaries from being executed directly,
but was easily circumvented in earlier versions of the kernel:
</p>

<pre>
       alex@joker:/tmp# mount | grep tmp
       /dev/hda7 on /tmp type ext2 (rw,noexec,nosuid,nodev)
       alex@joker:/tmp# ./date
       bash: ./date: Permission denied
       alex@joker:/tmp# /lib/ld-linux.so.2 ./date
       Sun Dec  3 17:49:23 CET 2000
</pre>

<p>
Newer versions of the kernel do however handle the <samp>noexec</samp> flag
properly:
</p>

<pre>
       angrist:/tmp# mount | grep /tmp
       /dev/hda3 on /tmp type ext3 (rw,noexec,nosuid,nodev)
       angrist:/tmp# ./date
       bash: ./tmp: Permission denied 
       angrist:/tmp# /lib/ld-linux.so.2 ./date 
       ./date: error while loading shared libraries: ./date: failed to map segment 
       from shared object: Operation not permitted
</pre>

<p>
However, many script kiddies have exploits which try to create and execute
files in <code>/tmp</code>.  If they do not have a clue, they will fall into
this pit.  In other words, a user cannot be tricked into executing a trojanized
binary in <code>/tmp</code> e.g.  when he incidentally adds <code>/tmp</code>
into his PATH.
</p>

<p>
Also be forewarned, some script might depend on <code>/tmp</code> being
executable.  Most notably, Debconf has (had?) some issues regarding this, for
more information see Bug <code><a
href="http://bugs.debian.org/116448">116448</a></code>.
</p>

<p>
The following is a more thorough example.  A note, though: <code>/var</code>
could be set noexec, but some software [<a href="footnotes.en.html#f21"
name="fr21">21</a>] keeps its programs under in <code>/var</code>.  The same
applies to the nosuid option.
</p>

<pre>
     /dev/sda6   /usr          ext3    defaults,ro,nodev       0       2
     /dev/sda12  /usr/share    ext3    defaults,ro,nodev,nosuid        0       2
     /dev/sda7   /var          ext3    defaults,nodev,usrquota,grpquota 0      2
     /dev/sda8   /tmp          ext3    defaults,nodev,nosuid,noexec,usrquota,grpquota    0       2
     /dev/sda9   /var/tmp      ext3    defaults,nodev,nosuid,noexec,usrquota,grpquota    0       2
     /dev/sda10  /var/log      ext3    defaults,nodev,nosuid,noexec    0       2
     /dev/sda11  /var/account  ext3    defaults,nodev,nosuid,noexec    0       2
     /dev/sda13  /home         ext3    rw,nosuid,nodev,exec,auto,nouser,async,usrquota,grpquota                0       2
     /dev/fd0    /mnt/fd0      ext3    defaults,users,nodev,nosuid,noexec      0       0
     /dev/fd0    /mnt/floppy   vfat    defaults,users,nodev,nosuid,noexec      0       0
     /dev/hda    /mnt/cdrom    iso9660 ro,users,nodev,nosuid,noexec            0       0
</pre>

<hr>

<h3><a name="s4.9.1"></a>4.9.1 Setting <code>/tmp</code> noexec</h3>

<p>
Be careful if setting <code>/tmp</code> noexec when you want to install new
software, since some programs might use it for installation.  <code>apt</code>
is one such program (see <code><a
href="http://bugs.debian.org/116448">http://bugs.debian.org/116448</a></code>)
if not configured properly <samp>APT::ExtractTemplates::TempDir</samp> (see
<code>apt-extracttemplates(1)</code>).  You can set this variable in
<code>/etc/apt/apt.conf</code> to another directory with exec privileges other
than <code>/tmp</code>.
</p>

<hr>

<h3><a name="s4.9.2"></a>4.9.2 Setting /usr read-only</h3>

<p>
If you set <code>/usr</code> read-only you will not be able to install new
packages on your Debian GNU/Linux system.  You will have to first remount it
read-write, install the packages and then remount it read-only.
<code>apt</code> can be configured to run commands before and after installing
packages, so you might want to configure it properly.
</p>

<p>
To do this modify <code>/etc/apt/apt.conf</code> and add:
</p>

<pre>
       DPkg
       {
           Pre-Invoke  { &quot;mount /usr -o remount,rw&quot; };
           Post-Invoke { &quot;mount /usr -o remount,ro&quot; };
       };
</pre>

<p>
Note that the Post-Invoke may fail with a &quot;/usr busy&quot; error message.
This happens mainly when you are using files during the update that got
updated.  You can find these programs by running
</p>

<pre>
     # lsof +L1
</pre>

<p>
Stop or restart these programs and run the Post-Invoke manually.
<em>Beware!</em> This means you'll likely need to restart your X session (if
you're running one) every time you do a major upgrade of your system.  You
might want to reconsider whether a read-only <code>/usr</code> is suitable for
your system.  See also this <code><a
href="http://lists.debian.org/debian-devel/2001/11/threads.html#00212">discussion
on debian-devel about read-only /usr</a></code>.
</p>

<hr>

<h2><a name="s4.10"></a>4.10 Providing secure user access</h2>

<hr>

<h3><a name="s-auth-pam"></a>4.10.1 User authentication: PAM</h3>

<p>
PAM (Pluggable Authentication Modules) allows system administrators to choose
how applications authenticate users.  Note that PAM can do nothing unless an
application is compiled with support for PAM.  Most of the applications that
are shipped with Debian have this support built in (Debian did not have PAM
support before 2.2).  The current default configuration for any PAM-enabled
service is to emulate UNIX authentication (read
<code>/usr/share/doc/libpam0g/Debian-PAM-MiniPolicy.gz</code> for more
information on how PAM services <em>should</em> work in Debian).
</p>

<p>
Each application with PAM support provides a configuration file in
<code>/etc/pam.d/</code> which can be used to modify its behavior:
</p>
<ul>
<li>
<p>
what backend is used for authentication.
</p>
</li>
</ul>
<ul>
<li>
<p>
what backend is used for sessions.
</p>
</li>
</ul>
<ul>
<li>
<p>
how do password checks behave.
</p>
</li>
</ul>

<p>
The following description is far from complete, for more information you might
want to read the <code><a
href="http://www.kernel.org/pub/linux/libs/pam/Linux-PAM-html/pam.html">The
Linux-PAM System Administrator's Guide</a></code> (at the <code><a
href="http://www.kernel.org/pub/linux/libs/pam/">primary PAM distribution
site</a></code>).  This document is also provided in the
<code>libpam-doc</code> Debian package.
</p>

<p>
PAM offers you the possibility to go through several authentication steps at
once, without the user's knowledge.  You could authenticate against a Berkeley
database and against the normal <code>passwd</code> file, and the user only
logs in if he authenticates correct in both.  You can restrict a lot with PAM,
just as you can open your system doors very wide.  So be careful.  A typical
configuration line has a control field as its second element.  Generally it
should be set to <samp>requisite</samp>, which returns a login failure if one
module fails.
</p>

<p>
The first thing I like to do, is to add MD5 support to PAM applications, since
this helps protect against dictionary cracks (passwords can be longer if using
MD5).  The following two lines should be added to all files in
<code>/etc/pam.d/</code> that grant access to the machine, like
<samp>login</samp> and <samp>ssh</samp>.
</p>

<pre>
       # Be sure to install libpam-cracklib first or you will not be able to log in
       password   required     pam_cracklib.so retry=3 minlen=12 difok=3
       password   required     pam_unix.so use_authtok nullok md5
</pre>

<p>
So, what does this incantation do?  The first line loads the cracklib PAM
module, which provides password strength-checking, prompts for a new password
with a minimum length of 12 characters, a difference of at least 3 characters
from the old password, and allows 3 retries.  Cracklib depends on a wordlist
package (such as <code>wenglish</code>, <code>wspanish</code>,
<code>wbritish</code>, ...), so make sure you install one that is appropriate
for your language or cracklib might not be useful to you at all.  [<a
href="footnotes.en.html#f22" name="fr22">22</a>] The second line introduces the
standard authentication module with MD5 passwords and allows a zero length
password.  The <samp>use_authtok</samp> directive is necessary to hand over the
password from the previous module.
</p>

<p>
To make sure that the user root can only log into the system from local
terminals, the following line should be enabled in
<code>/etc/pam.d/login</code>:
</p>

<pre>
       auth     requisite  pam_securetty.so
</pre>

<p>
Then you should modify the list of terminals on which direct root login is
allowed in <code>/etc/securetty</code>.  Alternatively, you could enable the
<samp>pam_access</samp> module and modify
<code>/etc/security/access.conf</code> which allows for a more general and
fine-tuned access control, but (unfortunately) lacks decent log messages
(logging within PAM is not standardized and is particularly unrewarding problem
to deal with).  We'll return to <code>access.conf</code> a little later.
</p>

<p>
Last but not the least, the following line should be enabled in
<code>/etc/pam.d/login</code> to set up user resource limits.
</p>

<pre>
       session  required   pam_limits.so
</pre>

<p>
This restricts the system resources that users are allowed (see below in <a
href="#s-user-limits">Limiting resource usage: the <code>limits.conf</code>
file, Section 4.10.2</a>).  For example, you could restrict the number of
concurrent logins (of a given group of users, or system-wide), number of
processes, memory size etc.
</p>

<p>
Now edit <code>/etc/pam.d/passwd</code> and change the first line.  You should
add the option &quot;md5&quot; to use MD5 passwords, change the minimum length
of password from 4 to 6 (or more) and set a maximum length, if you desire.  The
resulting line will look something like:
</p>

<pre>
       password   required   pam_unix.so nullok obscure min=6 max=11 md5
</pre>

<p>
If you want to protect su, so that only some people can use it to become root
on your system, you need to add a new group &quot;wheel&quot; to your system
(that is the cleanest way, since no file has such a group permission yet).  Add
root and the other users that should be able to <code>su</code> to the root
user to this group.  Then add the following line to <code>/etc/pam.d/su</code>:
</p>

<pre>
       auth        requisite   pam_wheel.so group=wheel debug
</pre>

<p>
This makes sure that only people from the group &quot;wheel&quot; can use
<code>su</code> to become root.  Other users will not be able to become root.
In fact they will get a denied message if they try to become root.
</p>

<p>
If you want only certain users to authenticate at a PAM service, this is quite
easy to achieve by using files where the users who are allowed to login (or
not) are stored.  Imagine you only want to allow user 'ref' to log in via
<code>ssh</code>.  So you put him into <code>/etc/sshusers-allowed</code> and
write the following into <code>/etc/pam.d/ssh</code>:
</p>

<pre>
       auth        required    pam_listfile.so item=user sense=allow file=/etc/sshusers-allowed onerr=fail
</pre>

<p>
Since there have been a number of so called insecure tempfile vulnerabilities,
thttpd is one example (see <code><a
href="http://www.debian.org/security/2005/dsa-883">DSA-883-1</a></code>), the
<code>libpam-tmpdir</code> is a good package to install.  All you have to do is
add the following to <code>/etc/pam.d/common-session</code>:
</p>

<pre>
      session    optional     pam_tmpdir.so
</pre>

<p>
There has also been a discussion about adding this by default in etch.  See
<code><a
href="http://lists.debian.org/debian-devel/2005/11/msg00297.html">http://lists.debian.org/debian-devel/2005/11/msg00297.html</a></code>
for more information.
</p>

<p>
Last, but not least, create <code>/etc/pam.d/other</code> and enter the
following lines:
</p>

<pre>
       auth     required       pam_securetty.so
       auth     required       pam_unix_auth.so
       auth     required       pam_warn.so
       auth     required       pam_deny.so
       account  required       pam_unix_acct.so
       account  required       pam_warn.so
       account  required       pam_deny.so
       password required       pam_unix_passwd.so
       password required       pam_warn.so
       password required       pam_deny.so
       session  required       pam_unix_session.so
       session  required       pam_warn.so
       session  required       pam_deny.so
</pre>

<p>
These lines will provide a good default configuration for all applications that
support PAM (access is denied by default).
</p>

<hr>

<h3><a name="s-user-limits"></a>4.10.2 Limiting resource usage: the <code>limits.conf</code> file</h3>

<p>
You should really take a serious look into this file.  Here you can define user
resource limits.  In old releases this configuration file was
<code>/etc/limits.conf</code>, but in newer releases (with PAM) the
<code>/etc/security/limits.conf</code> configuration file should be used
instead.
</p>

<p>
If you do not restrict resource usage, <em>any</em> user with a valid shell in
your system (or even an intruder who compromised the system through a service
or a daemon going awry) can use up as much CPU, memory, stack, etc.  as the
system can provide.  This <em>resource exhaustion</em> problem can be fixed by
the use of PAM.
</p>

<p>
There is a way to add resource limits to some shells (for example,
<code>bash</code> has <code>ulimit</code>, see <code>bash(1)</code>), but since
not all of them provide the same limits and since the user can change shells
(see <code>chsh(1)</code>) it is better to place the limits on the PAM modules
as they will apply regardless of the shell used and will also apply to PAM
modules that are not shell-oriented.
</p>

<p>
Resource limits are imposed by the kernel, but they need to be configured
through the <code>limits.conf</code> and the PAM configuration of the different
services need to load the appropriate PAM.  You can check which services are
enforcing limits by running:
</p>

<pre>
     $ find /etc/pam.d/ \! -name &quot;*.dpkg*&quot; | xargs -- grep limits |grep -v &quot;:#&quot;
</pre>

<p>
Commonly, <code>login</code>, <code>ssh</code> and the graphic session managers
(<code>gdm</code>, <code>kdm</code> or <code>xdm</code>) should enforce user
limits but you might want to do this in other PAM configuration files, such as
<code>cron</code>, to prevent system daemons from taking over all system
resources.
</p>

<p>
The specific limits settings you might want to enforce depend on your system's
resources, that's one of the main reasons why no limits are enforced in the
default installation.
</p>

<p>
For example, the configuration example below enforces a 100 process limit for
all users (to prevent <em>fork bombs</em>) as well as a limit of 10MB of memory
per process and a limit of 10 simultaneous logins.  Users in the
<samp>adm</samp> group have higher limits and can produce core files if they
want to (there is only a <em>soft</em> limit).
</p>

<pre>
     *              soft    core            0
     *              hard    core            0
     *              hard    rss             1000
     *              hard    memlock         1000
     *              hard    nproc           100
     *              -       maxlogins       1
     *              hard    data            102400
     *              hard    fsize           2048
     @adm           hard    core            100000
     @adm           hard    rss             100000
     @adm           soft    nproc           2000
     @adm           hard    nproc           3000
     @adm           hard    fsize           100000
     @adm           -       maxlogins       10
</pre>

<p>
These would be the limits a default user (including system daemons) would have:
</p>

<pre>
     $ ulimit -a
     core file size        (blocks, -c) 0
     data seg size         (kbytes, -d) 102400
     file size             (blocks, -f) 2048
     max locked memory     (kbytes, -l) 10000
     max memory size       (kbytes, -m) 10000
     open files                    (-n) 1024
     pipe size          (512 bytes, -p) 8
     stack size            (kbytes, -s) 8192
     cpu time             (seconds, -t) unlimited
     max user processes            (-u) 100
     virtual memory        (kbytes, -v) unlimited
</pre>

<p>
And these are the limits for an administrative user:
</p>

<pre>
     $ ulimit -a
     core file size        (blocks, -c) 0
     data seg size         (kbytes, -d) 102400
     file size             (blocks, -f) 100000
     max locked memory     (kbytes, -l) 100000
     max memory size       (kbytes, -m) 100000
     open files                    (-n) 1024
     pipe size          (512 bytes, -p) 8
     stack size            (kbytes, -s) 8192
     cpu time             (seconds, -t) unlimited
     max user processes            (-u) 2000
     virtual memory        (kbytes, -v) unlimited
</pre>

<p>
For more information read:
</p>
<ul>
<li>
<p>
<code><a
href="http://www.kernel.org/pub/linux/libs/pam/Linux-PAM-html/pam-6.html">PAM
reference guide for available modules</a></code>
</p>
</li>
</ul>
<ul>
<li>
<p>
<code><a href="http://www.samag.com/documents/s=1161/sam0009a/0009a.htm">PAM
configuration article</a></code>.
</p>
</li>
</ul>
<ul>
<li>
<p>
<code><a
href="http://seifried.org/security/os/linux/20020324-securing-linux-step-by-step.html">Seifried's
Securing Linux Step by Step</a></code> on the <em>Limiting users overview</em>
section.
</p>
</li>
</ul>
<ul>
<li>
<p>
<code><a href="http://seifried.org/lasg/users/">LASG</a></code> in the
<em>Limiting and monitoring users</em> section.
</p>
</li>
</ul>

<hr>

<h3><a name="s4.10.3"></a>4.10.3 User login actions: edit <code>/etc/login.defs</code></h3>

<p>
The next step is to edit the basic configuration and action upon user login.
Note that this file is not part of the PAM configuration, it's a configuration
file honored by <samp>login</samp> and <samp>su</samp> programs, so it doesn't
make sense tuning it for cases where neither of the two programs are at least
indirectly called (the <code>getty</code> program which sits on the consoles
and offers the initial login prompt <em>does</em> invoke <code>login</code>).
</p>

<pre>
       FAIL_DELAY          10
</pre>

<p>
This variable should be set to a higher value to make it harder to use the
terminal to log in using brute force.  If a wrong password is typed in, the
possible attacker (or normal user!) has to wait for 10 seconds to get a new
login prompt, which is quite time consuming when you test passwords.  Pay
attention to the fact that this setting is useless if using program other than
<code>getty</code>, such as <code>mingetty</code> for example.
</p>

<pre>
       FAILLOG_ENAB        yes
</pre>

<p>
If you enable this variable, failed logins will be logged.  It is important to
keep track of them to catch someone who tries a brute force attack.
</p>

<pre>
       LOG_UNKFAIL_ENAB    no
</pre>

<p>
If you set this variable to 'yes' it will record unknown usernames if the login
failed.  It is best if you use 'no' (the default) since, otherwise, user
passwords might be inadvertenly logged here (if a user mistypes and they enter
their password as the username).  If you set it to 'yes', make sure the logs
have the proper permissions (640 for example, with an appropriate group setting
such as adm).
</p>

<pre>
       SYSLOG_SU_ENAB      yes
</pre>

<p>
This one enables logging of <code>su</code> attempts to <code>syslog</code>.
Quite important on serious machines but note that this can create privacy
issues as well.
</p>

<pre>
       SYSLOG_SG_ENAB      yes
</pre>

<p>
The same as <var>SYSLOG_SU_ENAB</var> but applies to the <code>sg</code>
program.
</p>

<pre>
       MD5_CRYPT_ENAB      yes
</pre>

<p>
As stated above, MD5 sum passwords greatly reduce the problem of dictionary
attacks, since you can use longer passwords.  If you are using slink, read the
docs about MD5 before enabling this option.  Otherwise this is set in PAM.
</p>

<pre>
       PASS_MAX_LEN        50
</pre>

<p>
If MD5 passwords are activated in your PAM configuration, then this variable
should be set to the same value as used there.
</p>

<hr>

<h3><a name="s4.10.4"></a>4.10.4 Restricting ftp: editing <code>/etc/ftpusers</code></h3>

<p>
The <code>/etc/ftpusers</code> file contains a list of users who are not
allowed to log into the host using ftp.  Only use this file if you really want
to allow ftp (which is not recommended in general, because it uses clear-text
passwords).  If your daemon supports PAM, you can also use that to allow and
deny users for certain services.
</p>

<p>
FIXME (BUG): Is it a bug that the default <code>ftpusers</code> in Debian does
<em>not</em> include all the administrative users (in
<code>base-passwd</code>).
</p>

<p>
A convenient way to add all system accounts to the <code>/etc/ftpusers</code>
is to run
</p>

<pre>
     $ awk -F : '{if ($3&lt;1000) print $1}' /etc/passwd &gt; /etc/ftpusers
</pre>

<hr>

<h3><a name="s4.10.5"></a>4.10.5 Using su</h3>

<p>
If you really need users to become the super user on your system, e.g.  for
installing packages or adding users, you can use the command <code>su</code> to
change your identity.  You should try to avoid any login as user root and
instead use <code>su</code>.  Actually, the best solution is to remove
<code>su</code> and switch to the <code>sudo</code> mechanism which has a
broader logic and more features than <code>su</code>.  However, <code>su</code>
is more common as it is used on many other Unices.
</p>

<hr>

<h3><a name="s4.10.6"></a>4.10.6 Using sudo</h3>

<p>
<code>sudo</code> allows the user to execute defined commands under another
user's identity, even as root.  If the user is added to
<code>/etc/sudoers</code> and authenticates himself correctly, he is able to
run commands which have been defined in <code>/etc/sudoers</code>.  Violations,
such as incorrect passwords or trying to run a program you don't have
permission for, are logged and mailed to root.
</p>

<hr>

<h3><a name="s4.10.7"></a>4.10.7 Disallow remote administrative access</h3>

<p>
You should also modify <code>/etc/security/access.conf</code> to disallow
remote logins to administrative accounts.  This way users need to invoke
<code>su</code> (or <code>sudo</code>) to use any administrative powers and the
appropriate audit trace will always be generated.
</p>

<p>
You need to add the following line to <code>/etc/security/access.conf</code>,
the default Debian configuration file has a sample line commented out:
</p>

<pre>
        -:wheel:ALL EXCEPT LOCAL
</pre>

<p>
Remember to enable the <samp>pam_access</samp> module for every service (or
default configuration) in <code>/etc/pam.d/</code> if you want your changes to
<code>/etc/security/access.conf</code> honored.
</p>

<hr>

<h3><a name="s-user-restrict"></a>4.10.8 Restricting users's access</h3>

<p>
Sometimes you might think you need to have users created in your local system
in order to provide a given service (pop3 mail service or ftp).  Before doing
so, first remember that the PAM implementation in Debian GNU/Linux allows you
to validate users with a wide variety of external directory services (radius,
ldap, etc.) provided by the libpam packages.
</p>

<p>
If users need to be created and the system can be accessed remotely take into
account that users will be able to log in to the system.  You can fix this by
giving users a null (<code>/dev/null</code>) shell (it would need to be listed
in <code>/etc/shells</code>).  If you want to allow users to access the system
but limit their movements, you can use the <code>/bin/rbash</code>, equivalent
to adding the <samp>-r</samp> option in <code>bash</code> (<em>RESTRICTED
SHELL</em> see <code>bash(1)</code>).  Please note that even with restricted
shell, a user that access an interactive program (that might allow execution of
a subshell) could be able to bypass the limits of the shell.
</p>

<p>
Debian currently provides in the unstable release (and might be included in the
next stable releases) the <code>pam_chroot</code> module (in the
<code>libpam-chroot</code>).  An alternative to it is to <code>chroot</code>
the service that provides remote logging (<code>ssh</code>,
<code>telnet</code>).  [<a href="footnotes.en.html#f23" name="fr23">23</a>]
</p>

<p>
If you wish to restrict <em>when</em> users can access the system you will have
to customize <code>/etc/security/access.conf</code> for your needs.
</p>

<p>
Information on how to <code>chroot</code> users accessing the system through
the <code>ssh</code> service is described in <a
href="ap-chroot-ssh-env.en.html"><code>Chroot</code> environment for
<code>SSH</code>, Appendix G</a>.
</p>

<hr>

<h3><a name="s4.10.9"></a>4.10.9 User auditing</h3>

<p>
If you are really paranoid you might want to add a system-wide configuration to
audit what the users are doing in your system.  This sections presents some
tips using diverse utilities you can use.
</p>

<hr>

<h4><a name="s4.10.9.1"></a>4.10.9.1 Input and output audit with script</h4>

<p>
You can use the <code>script</code> command to audit both what the users run
and what are the results of those commands.  You cannot setup
<code>script</code> as a shell (even if you add it to
<code>/etc/shells</code>).  But you can have the shell initialization file run
the following:
</p>

<pre>
     umask 077
     exec script -q -a &quot;/var/log/sessions/$USER&quot;
</pre>

<p>
Of course, if you do this system wide it means that the shell would not
continue reading personal initialization files (since the shell gets
overwritten by <code>script</code>).  An alternative is to do this in the
user's initialization files (but then the user could remove this, see the
comments about this below)
</p>

<p>
You also need to setup the files in the audit directory (in the example
<code>/var/log/sessions/</code>) so that users can write to it but cannot
remove the file.  This could be done, for example, by creating the user session
files in advance and setting them with the <em>append-only</em> flag using
<code>chattr</code>.
</p>

<p>
A useful alternative for sysadmins, which includes date information would be:
</p>

<pre>
     umask 077
     exec script -q -a &quot;/var/log/sessions/$USER-`date +%Y%m%d`&quot;
</pre>

<hr>

<h4><a name="s4.10.9.2"></a>4.10.9.2 Using the shell history file</h4>

<p>
If you want to review what does the user type in the shell (but not what the
result of that is) you can setup a system-wide <code>/etc/profile</code> that
configures the environment so that all commands are saved into a history file.
The system-wide configuration needs to be setup in such a way that users cannot
remove audit capabilities from their shell.  This is somewhat shell specific so
make sure that all users are using a shell that supports this.
</p>

<p>
For example, for bash, the <code>/etc/profile</code> could be set as follows
[<a href="footnotes.en.html#f24" name="fr24">24</a>] :
</p>

<pre>
       HISTFILE=~/.bash_history
       HISTSIZE=10000
       HISTFILESIZE=999999
       # Don't let the users enter commands that are ignored
       # in the history file
       HISTIGNORE=&quot;&quot;
       HISTCONTROL=&quot;&quot;
       readonly HISTFILE
       readonly HISTSIZE
       readonly HISTFILESIZE
       readonly HISTIGNORE
       readonly HISTCONTROL
       export HISTFILE HISTSIZE HISTFILESIZE HISTIGNORE HISTCONTROL
</pre>

<p>
For this to work, the user can only append information to
<code>.bash_history</code> file.  You need <em>also</em> to set the
<em>append-only</em> option using <code>chattr</code> program for
<code>.bash_history</code> for all users.  [<a href="footnotes.en.html#f25"
name="fr25">25</a>].
</p>

<p>
Note that you could introduce the configuration above in the user's
<code>.profile</code>.  But then you would need to setup permissions properly
in such a way that prevents the user from modifying this file.  This includes:
having the user's home directories <em>not</em> belong to the user (since he
would be able to remove the file otherwise) but at the same time enable them to
read the <code>.profile</code> configuration file and write on the
<code>.bash_history</code>.  It would be good to set the <em>immutable</em>
flag (also using <code>chattr</code>) for <code>.profile</code> too if you do
it this way.
</p>

<hr>

<h4><a name="s4.10.9.3"></a>4.10.9.3 Complete user audit with accounting utilities</h4>

<p>
The previous example is a simple way to configure user auditing but might be
not useful for complex systems or for those in which users do not run shells at
all (or exclusively).  If this is your case, you need to look at
<code>acct</code>, the accounting utilities.  These utilities will log all the
commands run by users or processes in the system, at the expense of disk space.
</p>

<p>
When activating accounting, all the information on processes and users is kept
under <code>/var/account/</code>, more specifically in the <code>pacct</code>.
The accounting package includes some tools (<code>sa</code>, <code>ac</code>
and <code>lastcomm</code>) to analyse this data.
</p>

<hr>

<h4><a name="s4.10.9.4"></a>4.10.9.4 Other user auditing methods</h4>

<p>
If you are completely paranoid and want to audit every user's command, you
could take <code>bash</code> source code, edit it and have it send all that the
user typed into another file.  Or have <code>ttysnoop</code> constantly monitor
any new ttys [<a href="footnotes.en.html#f26" name="fr26">26</a>] and dump the
output into a file.  Other useful program is <code>snoopy</code> (see also
<code><a href="http://sourceforge.net/projects/snoopylogger/">the project
page</a></code>) which is a user-transparent program that hooks in as a library
providing a wrapper around <var>execve()</var> calls, any command executed is
logged to <code>syslogd</code> using the <samp>authpriv</samp> facility
(usually stored at <code>/var/log/auth.log</code>).
</p>

<hr>

<h3><a name="s4.10.10"></a>4.10.10 Reviewing user profiles</h3>

<p>
If you want to <em>see</em> what users are actually doing when they logon to
the system you can use the <code>wtmp</code> database that includes all login
information.  This file can be processed with several utilities, amongst them
<code>sac</code> which can output a profile on each user showing in which
timeframe they usually log on to the system.
</p>

<p>
In case you have accounting activated, you can also use the tools provided by
it in order to determine when the users access the system and what do they
execute.
</p>

<hr>

<h3><a name="s4.10.11"></a>4.10.11 Setting users umasks</h3>

<p>
Depending on your user policy you might want to change how information is
shared between users, that is, what the default permissions of new files
created by users are.
</p>

<p>
Debian's default <samp>umask</samp> setting is <em>022</em> this means that
files (and directories) can be read and accessed by the user's group and by any
other users in the system.  This definition is set in the standard
configuration file <code>/etc/profile</code> which is used by all shells.
</p>

<p>
If Debian's default value is too permissive for your system you will have to
change the umask setting for all the shells.  More restrictive umask settings
include 027 (no access is allowed to new files for the <em>other</em> group,
i.e.  to other users in the system) or 077 (no access is allowed to new files
to the members the user's group).  Debian (by default[<a
href="footnotes.en.html#f27" name="fr27">27</a>]) creates one group per user so
that only the user is included in its group.  Consequently 027 and 077 are
equivalent as the user's group contains only the user himself.
</p>

<p>
This change is set by defining a proper <samp>umask</samp> setting for all
users.  You can change this by introducing an <code>umask</code> call in the
shell configuration files: <code>/etc/profile</code> (source by all
Bourne-compatible shells), <code>/etc/csh.cshrc</code>,
<code>/etc/csh.login</code>, <code>/etc/zshrc</code> and probably some others
(depending on the shells you have installed on your system).  You can also
change the <var>UMASK</var> setting in <code>/etc/login.defs</code>, Of all of
these the last one that gets loaded by the shell takes precedence.  The order
is: the default system configuration for the user's shell (i.e.
<code>/etc/profile</code> and other system-wide configuration files) and then
the user's shell (his <code>~/.profile</code>, <code>~/.bash_profile</code>,
etc...).  Some shells, however, can be executed with a <em>nologin</em> value
which might skip sourcing some of those files.  See your shell's manpage for
additional information.
</p>

<p>
For connections that make use of <code>login</code> the UMASK definition in
<code>/etc/login.defs</code> is used before any of the others.  However, that
value does not apply to user executed programs that do not use
<code>login</code> such as those run through <code>su</code>, <code>cron</code>
or <code>ssh</code>.
</p>

<p>
Don't forget to review and maybe modify the dotfiles under
<code>/etc/skel/</code> since these will be new user's defaults when created
with the <code>adduser</code> command.  Debian default dotfiles do not include
any <code>umask</code> call but if there is any in the dotfiles newly created
users might a different value.
</p>

<p>
Note, however that users can modify their own <samp>umask</samp> setting if
they want to, making it more permissive or more restricted, by changing their
own dotfiles.
</p>

<p>
The <code>libpam-umask</code> package adjusts the users' default
<samp>umask</samp> using PAM.  Add the following, after installing the package,
to <code>/etc/pam.d/common-session</code>:
</p>

<pre>
     session    optional     pam_umask.so umask=077
</pre>

<p>
Finally, you should consider changing root's default 022 umask (as defined in
<code>/root/.bashrc</code>) to a more strict umask.  That will prevent the
system administrator from inadvertenly dropping sensitive files when working as
root to world-readable directories (such as <code>/tmp</code>) and having them
available for your average user.
</p>

<hr>

<h3><a name="s4.10.12"></a>4.10.12 Limiting what users can see/access</h3>

<p>
FIXME: Content needed.  Describe the consequences of changing packages
permissions when upgrading (an admin this paranoid should <code>chroot</code>
his users BTW) if not using <code>dpkg-statoverride</code>.
</p>

<p>
If you need to grant users access to the system with a shell think about it
very carefully.  A user can, by default unless in a severely restricted
environment (like a <samp>chroot</samp> jail), retrieve quite a lot of
information from your system including:
</p>
<ul>
<li>
<p>
some configuration files in <code>/etc</code>.  However, Debian's default
permissions for some sensitive files (which might, for example, contain
passwords), will prevent access to critical information.  To see which files
are only accessible by the root user for example <samp>find /etc -type f -a
-perm 600 -a -uid 0</samp> as superuser.
</p>
</li>
</ul>
<ul>
<li>
<p>
your installed packages, either by looking at the package database, at the
<code>/usr/share/doc</code> directory or by guessing by looking at the binaries
and libraries installed in your system.
</p>
</li>
</ul>
<ul>
<li>
<p>
some log files at <code>/var/log</code>.  Note also that some log files are
only accessible to root and the <samp>adm</samp> group (try <samp>find /var/log
-type f -a -perm 640</samp>) and some are even only available to the root user
(try <samp>find /var/log -type f -a -perm 600 -a -uid 0</samp>).
</p>
</li>
</ul>

<p>
What can a user see in your system?  Probably quite a lot of things, try this
(take a deep breath):
</p>

<pre>
       find / -type f -a -perm +006 2&gt;/dev/null  
       find / -type d -a -perm +007 2&gt;/dev/null
</pre>

<p>
The output is the list of files that a user can <em>see</em> and the
directories to which he has access.
</p>

<hr>

<h4><a name="s-limit-user-perm"></a>4.10.12.1 Limiting access to other user's information</h4>

<p>
If you still grant shell access to users you might want to limit what
information they can view from other users.  Users with shell access have a
tendency to create quite a number of files under their $HOMEs: mailboxes,
personal documents, configuration of X/GNOME/KDE applications...
</p>

<p>
In Debian each user is created with one associated group, and no two users
belong to the same group.  This is the default behavior: when an user account
is created, a group of the same name is created too, and the user is assigned
to it.  This avoids the concept of a common <em>users</em> group which might
make it more difficult for users to hide information from other users.
</p>

<p>
However, users' <var>$HOME</var> directories are created with 0755 permissions
(group-readable and world-readable).  The group permissions is not an issue
since only the user belongs to the group, however the world permissions might
(or might not) be an issue depending on your local policy.
</p>

<p>
You can change this behavior so that user creation provides different
<var>$HOME</var> permissions.  To change the behavior for <em>new</em> users
when they get created, change <em>DIR_MODE</em> in the configuration file
<code>/etc/adduser.conf</code> to 0750 (no world-readable access).
</p>

<p>
Users can still share information, but not directly in their <var>$HOME</var>
directories unless they change its permissions.
</p>

<p>
Note that disabling world-readable home directories will prevent users from
creating their personal web pages in the <code>~/public_html</code> directory,
since the web server will not be able to read one component in the path -
namely their <var>$HOME</var> directory.  If you want to permit users to
publish HTML pages in their <code>~/public_html</code>, then change
<em>DIR_MODE</em> to 0751.  This will allow the web server to access the final
<code>public_html</code> directory (which itself should have a mode of 0755)
and provide the content published by users.  Of course, we are only talking
about a default configuration here; users can generally tune modes of their own
files completely to their liking, or you could keep content intended for the
web in a separate location which is not a subdirectory of user's
<var>$HOME</var> directory.
</p>

<hr>

<h3><a name="s-user-pwgen"></a>4.10.13 Generating user passwords</h3>

<p>
There are many cases when an administrator needs to create many user accounts
and provide passwords for all of them.  Of course, the administrator could
easily just set the password to be the same as the user's account name, but
that would not be very sensitive security-wise.  A better approach is to use a
password generating program.  Debian provides <code>makepasswd</code>,
<code>apg</code> and <code>pwgen</code> packages which provide programs (the
name is the same as the package) that can be used for this purpose.
<code>Makepasswd</code> will generate true random passwords with an emphasis on
security over pronounceability while <code>pwgen</code> will try to make
meaningless but pronounceable passwords (of course this might depend on your
mother language).  <code>Apg</code> has algorithms to provide for both (there
is a client/server version for this program but it is not included in the
Debian package).
</p>

<p>
<code>Passwd</code> does not allow non-interactive assignation of passwords
(since it uses direct tty access).  If you want to change passwords when
creating a large number of users you can create them using <code>adduser</code>
with the <samp>--disabled-login</samp> option and then use <code>usermod</code>
or <code>chpasswd</code> [<a href="footnotes.en.html#f28" name="fr28">28</a>]
(both from the <code>passwd</code> package so you already have them installed).
If you want to use a file with all the information to make users as a batch
process you might be better off using <code>newusers</code>.
</p>

<hr>

<h3><a name="s4.10.14"></a>4.10.14 Checking user passwords</h3>

<p>
User passwords can sometimes become the <em>weakest link</em> in the security
of a given system.  This is due to some users choosing weak passwords for their
accounts (and the more of them that have access to it the greater the chances
of this happening).  Even if you established checks with the cracklib PAM
module and password limits as described in <a href="#s-auth-pam">User
authentication: PAM, Section 4.10.1</a> users will still be able to use weak
passwords.  Since user access might include remote shell access (over
<code>ssh</code>, hopefully) it's important to make password guessing as hard
as possible for the remote attackers, especially if they were somehow able to
collect important information such as usernames or even the <code>passwd</code>
and <code>shadow</code> files themselves.
</p>

<p>
A system administrator must, given a big number of users, check if the
passwords they have are consistent with the local security policy.  How to
check?  Try to crack them as an attacker would if he had access to the hashed
passwords (the <code>/etc/shadow</code> file).
</p>

<p>
An administrator can use <code>john</code> or <code>crack</code> (both are
brute force password crackers) together with an appropriate wordlist to check
users' passwords and take appropriate action when a weak password is detected.
You can search for Debian GNU packages that contain word lists using
<code>apt-cache search wordlist</code>, or visit the classic Internet wordlist
sites such as <code><a
href="ftp://ftp.ox.ac.uk/pub/wordlists">ftp://ftp.ox.ac.uk/pub/wordlists</a></code>
or <code><a
href="ftp://ftp.cerias.purdue.edu/pub/dict">ftp://ftp.cerias.purdue.edu/pub/dict</a></code>.
</p>

<hr>

<h3><a name="s-idle-logoff"></a>4.10.15 Logging off idle users</h3>

<p>
Idle users are usually a security problem, a user might be idle maybe because
he's out to lunch or because a remote connection hung and was not
re-established.  For whatever the reason, idle users might lead to a
compromise:
</p>
<ul>
<li>
<p>
because the user's console might be unlocked and can be accessed by an
intruder.
</p>
</li>
</ul>
<ul>
<li>
<p>
because an attacker might be able to re-attach himself to a closed network
connection and send commands to the remote shell (this is fairly easy if the
remote shell is not encrypted as in the case of <code>telnet</code>).
</p>
</li>
</ul>

<p>
Some remote systems have even been compromised through an idle (and detached)
<code>screen</code>.
</p>

<p>
Automatic disconnection of idle users is usually a part of the local security
policy that must be enforced.  There are several ways to do this:
</p>
<ul>
<li>
<p>
If <code>bash</code> is the user shell, a system administrator can set a
default <samp>TMOUT</samp> value (see <code>bash(1)</code>) which will make the
shell automatically log off remote idle users.  Note that it must be set with
the <samp>-o</samp> option or users will be able to change (or unset) it.
</p>
</li>
</ul>
<ul>
<li>
<p>
Install <code>timeoutd</code> and configure <code>/etc/timeouts</code>
according to your local security policy.  The daemon will watch for idle users
and time out their shells accordingly.
</p>
</li>
</ul>
<ul>
<li>
<p>
Install <code>autolog</code> and configure it to remove idle users.
</p>
</li>
</ul>

<p>
The <code>timeoutd</code> or <code>autolog</code> daemons are the preferred
method since, after all, users can change their default shell or can, after
running their default shell, switch to another (uncontrolled) shell.
</p>

<hr>

<h2><a name="s-tcpwrappers"></a>4.11 Using tcpwrappers</h2>

<p>
TCP wrappers were developed when there were no real packet filters available
and access control was needed.  Nevertheless, they're still very interesting
and useful.  The TCP wrappers allow you to allow or deny a service for a host
or a domain and define a default allow or deny rule (all performed on the
application level).  If you want more information take a look at
<code>hosts_access(5)</code>.
</p>

<p>
Many services installed in Debian are either:
</p>
<ul>
<li>
<p>
launched through the tcpwrapper service (<code>tcpd</code>)
</p>
</li>
</ul>
<ul>
<li>
<p>
compiled with libwrapper support built-in.
</p>
</li>
</ul>

<p>
On the one hand, for services configured in <code>/etc/inetd.conf</code> (this
includes <code>telnet</code>, <code>ftp</code>, <code>netbios</code>,
<code>swat</code> and <code>finger</code>) you will see that the configuration
file executes <code>/usr/sbin/tcpd</code> first.  On the other hand, even if a
service is not launched by the <code>inetd</code> superdaemon, support for the
tcp wrappers rules can be compiled into it.  Services compiled with tcp
wrappers in Debian include <code>ssh</code>, <code>portmap</code>,
<code>in.talk</code>, <code>rpc.statd</code>, <code>rpc.mountd</code>,
<code>gdm</code>, <code>oaf</code> (the GNOME activator daemon),
<code>nessus</code> and many others.
</p>

<p>
To see which packages use tcpwrappers [<a href="footnotes.en.html#f29"
name="fr29">29</a>] try:
</p>

<pre>
       $ apt-cache rdepends libwrap0
</pre>

<p>
Take this into account when running <code>tcpdchk</code> (a very useful TCP
wrappers config file rule and syntax checker).  When you add stand-alone
services (that are directly linked with the wrapper library) into the
<code>hosts.deny</code> and <code>hosts.allow</code> files,
<code>tcpdchk</code> will warn you that it is not able to find the mentioned
services since it only looks for them in <code>/etc/inetd.conf</code> (the
manpage is not totally accurate here).
</p>

<p>
Now, here comes a small trick, and probably the smallest intrusion detection
system available.  In general, you should have a decent firewall policy as a
first line, and tcp wrappers as the second line of defense.  One little trick
is to set up a <var>SPAWN</var> [<a href="footnotes.en.html#f30"
name="fr30">30</a>] command in <code>/etc/hosts.deny</code> that sends mail to
root whenever a denied service triggers wrappers:
</p>

<pre>
       ALL: ALL: SPAWN ( \
         echo -e &quot;\n\
         TCP Wrappers\: Connection refused\n\
         By\: $(uname -n)\n\
         Process\: %d (pid %p)\n\
         User\: %u\n\
         Host\: %c\n\
         Date\: $(date)\n\
       &quot; | /usr/bin/mail -s &quot;Connection to %d blocked&quot; root) &amp;
</pre>

<p>
<em>Beware</em>: The above printed example is open to a DoS attack by making
many connections in a short period of time.  Many emails mean a lot of file I/O
by sending only a few packets.
</p>

<hr>

<h2><a name="s-log-alerts"></a>4.12 The importance of logs and alerts</h2>

<p>
It is easy to see that the treatment of logs and alerts is an important issue
in a secure system.  Suppose a system is perfectly configured and 99% secure.
If the 1% attack occurs, and there are no security measures in place to, first,
detect this and, second, raise alarms, the system is not secure at all.
</p>

<p>
Debian GNU/Linux provides some tools to perform log analysis, most notably
<code>swatch</code>, [<a href="footnotes.en.html#f31" name="fr31">31</a>]
<code>logcheck</code> or <code>log-analysis</code> (all will need some
customisation to remove unnecessary things from the report).  It might also be
useful, if the system is nearby, to have the system logs printed on a virtual
console.  This is useful since you can (from a distance) see if the system is
behaving properly.  Debian's <code>/etc/syslog.conf</code> comes with a
commented default configuration; to enable it uncomment the lines and restart
<code>syslogd</code> (<samp>/etc/init.d/syslogd restart</samp>):
</p>

<pre>
       daemon,mail.*;\
             news.=crit;news.=err;news.=notice;\
             *.=debug;*.=info;\
             *.=notice;*.=warn       /dev/tty8
</pre>

<p>
To colorize the logs, you could take a look at <code>colorize</code>,
<code>ccze</code> or <code>glark</code>.  There is a lot to log analysis that
cannot be fully covered here, so a good information resource would be books
should as <code><a
href="http://books.google.com/books?id=UyktqN6GnWEC">Security log management:
identifying patterns in the chaos</a></code>.  In any case, even automated
tools are no match for the best analysis tool: your brain.
</p>

<hr>

<h3><a name="s-custom-logcheck"></a>4.12.1 Using and customizing <code>logcheck</code></h3>

<p>
The <code>logcheck</code> package in Debian is divided into the three packages
<code>logcheck</code> (the main program), <code>logcheck-database</code> (a
database of regular expressions for the program) and <code>logtail</code>
(prints loglines that have not yet been read).  The Debian default (in
<code>/etc/cron.d/logcheck</code>) is that <code>logcheck</code> is run every
hour and after reboots.
</p>

<p>
This tool can be quite useful if properly customized to alert the administrator
of unusual system events.  <code>Logcheck</code> can be fully customized so
that it sends mails based on events found in the logs and worthy of attention.
The default installation includes profiles for ignored events and policy
violations for three different setups (workstation, server and paranoid).  The
Debian package includes a configuration file
<code>/etc/logcheck/logcheck.conf</code>, sourced by the program, that defines
which user the checks are sent to.  It also provides a way for packages that
provide services to implement new policies in the directories:
<code>/etc/logcheck/cracking.d/_packagename_</code>,
<code>/etc/logcheck/violations.d/_packagename_</code>,
<code>/etc/logcheck/violations.ignore.d/_packagename_</code>,
<code>/etc/logcheck/ignore.d.paranoid/_packagename_</code>,
<code>/etc/logcheck/ignore.d.server/_packagename_</code>, and
<code>/etc/logcheck/ignore.d.workstation/_packagename_</code>.  However, not
many packages currently do so.  If you have a policy that can be useful for
other users, please send it as a bug report for the appropriate package (as a
<em>wishlist</em> bug).  For more information read
<code>/usr/share/doc/logcheck/README.Debian</code>.
</p>

<p>
The best way to configure <code>logcheck</code> is to edit its main
configuration file <code>/etc/logcheck/logcheck.conf</code> after installation.
Change the default user (root) to whom reports should be mailed.  You should
set the reportlevel in there, too.  <code>logcheck-database</code> has three
report levels of increasing verbosity: workstation, server, paranoid.
&quot;server&quot; being the default level, paranoid is only recommended for
high-security machines running as few services as possible and workstation for
relatively sheltered, non-critical machines.  If you wish to add new log files
just add them to <code>/etc/logcheck/logcheck.logfiles</code>.  It is tuned for
default syslog install.
</p>

<p>
Once this is done you might want to check the mails that are sent, for the
first few days/weeks/months.  If you find you are sent messages you do not wish
to receive, just add the regular expressions (see <code>regex(7)</code> and
<code>egrep(1)</code>) that correspond to these messages to the
<code>/etc/logcheck/ignore.d.<var>reportlevel</var>/local</code>.  Try to match
the whole logline.  Details on howto write rules are explained in
<code>/usr/share/doc/logcheck-database/README.logcheck-database.gz</code>.
It's an ongoing tuning process; once the messages that are sent are always
relevant you can consider the tuning finished.  Note that if
<code>logcheck</code> does not find anything relevant in your system it will
not mail you even if it does run (so you might get a mail only once a week, if
you are lucky).
</p>

<hr>

<h3><a name="s4.12.2"></a>4.12.2 Configuring where alerts are sent</h3>

<p>
Debian comes with a standard <samp>syslog</samp> configuration (in
<code>/etc/syslog.conf</code>) that logs messages to the appropriate files
depending on the system facility.  You should be familiar with this; have a
look at the <code>syslog.conf</code> file and the documentation if not.  If you
intend to maintain a secure system you should be aware of where log messages
are sent so they do not go unnoticed.
</p>

<p>
For example, sending messages to the console also is an interesting setup
useful for many production-level systems.  But for many such systems it is also
important to add a new machine that will serve as loghost (i.e.  it receives
logs from all other systems).
</p>

<p>
Root's mail should be considered also, many security controls (like
<code>snort</code>) send alerts to root's mailbox.  This mailbox usually points
to the first user created in the system (check <code>/etc/aliases</code>).
Take care to send root's mail to some place where it will be read (either
locally or remotely).
</p>

<p>
There are other role accounts and aliases on your system.  On a small system,
it's probably simplest to make sure that all such aliases point to the root
account, and that mail to root is forwarded to the system administrator's
personal mailbox.
</p>

<p>
FIXME: It would be interesting to tell how a Debian system can send/receive
SNMP traps related to security problems (jfs).  Check:
<code>snmptrapfmt</code>, <code>snmp</code> and <code>snmpd</code>.
</p>

<hr>

<h3><a name="s4.12.3"></a>4.12.3 Using a loghost</h3>

<p>
A loghost is a host which collects syslog data remotely over the network.  If
one of your machines is cracked, the intruder is not able to cover his tracks,
unless he hacks the loghost as well.  So, the loghost should be especially
secure.  Making a machine a loghost is simple.  Just start the
<code>syslogd</code> with <samp>syslogd -r</samp> and a new loghost is born.
In order to do this permanently in Debian, edit
<code>/etc/default/syslogd</code> and change the line
</p>

<pre>
     SYSLOGD=&quot;&quot;
</pre>

<p>
to
</p>

<pre>
     SYSLOGD=&quot;-r&quot;
</pre>

<p>
Next, configure the other machines to send data to the loghost.  Add an entry
like the following to <code>/etc/syslog.conf</code>:
</p>

<pre>
       facility.level            @your_loghost
</pre>

<p>
See the documentation for what to use in place of <em>facility</em> and
<em>level</em> (they should not be entered verbatim like this).  If you want to
log everything remotely, just write:
</p>

<pre>
       *.*                       @your_loghost
</pre>

<p>
into your <code>syslog.conf</code>.  Logging remotely as well as locally is the
best solution (the attacker might presume to have covered his tracks after
deleting the local log files).  See the <code>syslog(3)</code>,
<code>syslogd(8)</code> and <code>syslog.conf(5)</code> manpages for additional
information.
</p>

<hr>

<h3><a name="s4.12.4"></a>4.12.4 Log file permissions</h3>

<p>
It is not only important to decide how alerts are used, but also who has
read/modify access to the log files (if not using a remote loghost).  Security
alerts which the attacker can change or disable are not worth much in the event
of an intrusion.  Also, you have to take into account that log files might
reveal quite a lot of information about your system to an intruder if he has
access to them.
</p>

<p>
Some log file permissions are not perfect after the installation (but of course
this really depends on your local security policy).  First
<code>/var/log/lastlog</code> and <code>/var/log/faillog</code> do not need to
be readable by normal users.  In the <code>lastlog</code> file you can see who
logged in recently, and in the <code>faillog</code> you see a summary of failed
logins.  The author recommends <code>chmod 660</code> for both.  Take a brief
look at your log files and decide very carefully which log files to make
readable/writable for a user with a UID other than 0 and a group other than
'adm' or 'root'.  You can easily check this in your system with:
</p>

<pre>
       #  find /var/log -type f -exec ls -l {} \; | cut -c 17-35 |sort -u
       (see to what users do files in /var/log belong)
       #  find /var/log -type f -exec ls -l {} \; | cut -c 26-34 |sort -u
       (see to what groups do files in /var/log belong)
       # find /var/log -perm +004
       (files which are readable by any user)
       #  find /var/log \! -group root \! -group adm -exec ls -ld {} \;
       (files which belong to groups not root or adm)
</pre>

<p>
To customize how log files are created you will probably have to customize the
program that generates them.  If the log file gets rotated, however, you can
customize the behavior of creation and rotation.
</p>

<hr>

<h2><a name="s-kernel-patches"></a>4.13 Adding kernel patches</h2>

<p>
Debian GNU/Linux provides some of the patches for the Linux kernel that enhance
its security.  These include:
</p>
<ul>
<li>
<p>
<code><a href="http://www.lids.org">Linux Intrusion Detection</a></code>
provided in the <code>kernel-patch-2.4-lids</code> package.  This kernel patch
makes the process of hardening your Linux system easier by allowing you to
restrict, hide and protect processes, even from root.  It implements mandatory
access control capabilities.
</p>
</li>
</ul>
<ul>
<li>
<p>
<code><a href="http://trustees.sourceforge.net/">Linux Trustees</a></code>,
provided in package <code>trustees</code>.  This patch adds a decent advanced
permissions management system to your Linux kernel.  Special objects (called
trustees) are bound to every file or directory, and are stored in kernel
memory, which allows fast lookup of all permissions.
</p>
</li>
</ul>
<ul>
<li>
<p>
NSA Enhanced Linux (in package <code>selinux</code>).  Backports of the
SElinux-enabled packages are available at <code><a
href="http://selinux.alioth.debian.org/">http://selinux.alioth.debian.org/</a></code>.
More information available at <code><a
href="http://wiki.debian.org/SELinux">SElinux in Debian Wiki page</a></code>,
at <code><a
href="http://www.golden-gryphon.com/software/security/selinux.xhtml">Manoj
Srivastava's</a></code> and <code><a
href="http://www.coker.com.au/selinux/">Russell Cookers's</a></code> SElinux
websites.
</p>
</li>
</ul>
<ul>
<li>
<p>
The <code><a href="http://people.redhat.com/mingo/exec-shield/">exec-shield
patch</a></code> provided in the <code>kernel-patch-exec-shield</code> package.
This patch provides protection against some buffer overflows (stack smashing
attacks).
</p>
</li>
</ul>
<ul>
<li>
<p>
The <code><a href="http://www.grsecurity.net/">Grsecurity patch</a></code>,
provided by the <code>kernel-patch-2.4-grsecurity</code> and
<code>kernel-patch-grsecurity2</code> packages [<a href="footnotes.en.html#f32"
name="fr32">32</a>] implements Mandatory Access Control through RBAC, provides
buffer overflow protection through PaX, ACLs, network randomness (to make OS
fingerprinting more difficult) and <code><a
href="http://www.grsecurity.net/features.php">many more features</a></code>.
</p>
</li>
</ul>
<ul>
<li>
<p>
The <code>kernel-patch-adamantix</code> provides the patches developed for
<code><a href="http://www.adamantix.org/">Adamantix</a></code>, a Debian-based
distribution.  This kernel patch for the 2.4.x kernel releases introduces some
security features such as a non-executable stack through the use of <code><a
href="http://pageexec.virtualave.net/">PaX</a></code> and mandatory access
control based on <code><a href="http://www.rsbac.org/">RSBAC</a></code>.  Other
features include: <code><a href="http://www.vanheusden.com/Linux/sp/">the
Random PID patch</a></code>, AES encrypted loop device, MPPE support and an
IPSEC v2.6 backport.
</p>
</li>
</ul>
<ul>
<li>
<p>
<code>cryptoloop-source</code>.  This patches allows you to use the functions
of the kernel crypto API to create encrypted filesystems using the loopback
device.
</p>
</li>
</ul>
<ul>
<li>
<p>
IPSEC kernel support (in package <code>linux-patch-openswan</code>).  If you
want to use the IPsec protocol with Linux, you need this patch.  You can create
VPNs with this quite easily, even to Windows machines, as IPsec is a common
standard.  IPsec capabilities have been added to the 2.5 development kernel, so
this feature will be present by default in the future Linux Kernel 2.6.
Homepage: <code><a
href="http://www.openswan.org">http://www.openswan.org</a></code>.
<em>FIXME</em>: The latest 2.4 kernels provided in Debian include a backport of
the IPSEC code from 2.5.  Comment on this.
</p>
</li>
</ul>

<p>
The following security kernel patches are only available for old kernel
versions in woody and are deprecated:
</p>
<ul>
<li>
<p>
<code><a href="http://acl.bestbits.at/">POSIX Access Control Lists</a></code>
(ACLs) for Linux provided in the package <code>kernel-patch-acl</code>.  This
kernel patch adds access control lists, an advanced method for restricting
access to files.  It allows you to control fine-grain access to files and
directory.
</p>
</li>
</ul>
<ul>
<li>
<p>
The <code><a href="http://www.openwall.com/linux/">Openwall</a></code> linux
kernel patch by Solar Designer, provided in the
<code>kernel-patch-2.2.18-openwall</code> package.  This is a useful set of
kernel restrictions, like restricted links, FIFOs in <code>/tmp</code>, a
restricted <code>/proc</code> file system, special file descriptor handling,
non-executable user stack area and other features.  Note: This package applies
to the 2.2 release, no packages are available for the 2.4 release patches
provided by Solar.
</p>
</li>
</ul>
<ul>
<li>
<p>
<code>kernel-patch-int</code>.  This patch also adds cryptographic capabilities
to the Linux kernel, and was useful with Debian releases up to Potato.  It
doesn't work with Woody, and if you are using Sarge or a newer version, you
should use a more recent kernel which includes these features already.
</p>
</li>
</ul>

<p>
However, some patches have not been provided in Debian yet.  If you feel that
some of these should be included please ask for it at the <code><a
href="http://www.debian.org/devel/wnpp/">Work Needing and Prospective
Packages</a></code>.
</p>

<hr>

<h2><a name="s4.14"></a>4.14 Protecting against buffer overflows</h2>

<p>
<em>Buffer overflow</em> is the name of a common attack to software [<a
href="footnotes.en.html#f33" name="fr33">33</a>] which makes use of
insufficient boundary checking (a programming error, most commonly in the C
language) in order to execute machine code through program inputs.  These
attacks, against server software which listen to connections remotely and
against local software which grant higher privileges to users
(<samp>setuid</samp> or <samp>setgid</samp>) can result in the compromise of
any given system.
</p>

<p>
There are mainly four methods to protect against buffer overflows:
</p>
<ul>
<li>
<p>
patch the kernel to prevent stack execution.  You can use either: Exec-shield,
OpenWall or PaX (included in the Grsecurity and Adamantix patches).
</p>
</li>
</ul>
<ul>
<li>
<p>
fix the source code by using tools to find fragments of it that might introduce
this vulnerability.
</p>
</li>
</ul>
<ul>
<li>
<p>
recompile the source code to introduce proper checks that prevent overflows,
using the <code><a
href="http://www.research.ibm.com/trl/projects/security/ssp/">Stack Smashing
Protector (SSP)</a></code> patch for GCC (which is used by <code><a
href="http://www.adamantix.org">Adamantix</a></code>)
</p>
</li>
</ul>

<p>
Debian GNU/Linux, as of the 3.0 release, provides software to introduce all of
these methods except for the protection on source code compilation (but this
has been requested in <code><a href="http://bugs.debian.org/213994">Bug
#213994</a></code>).
</p>

<p>
Notice that even if Debian provided a compiler which featured stack/buffer
overflow protection all packages would need to be recompiled in order to
introduce this feature.  This is, in fact, what the Adamantix distribution does
(among other features).  The effect of this new feature on the stability of
software is yet to be determined (some programs or some processor architectures
might break due to it).
</p>

<p>
In any case, be aware that even these workarounds might not prevent buffer
overflows since there are ways to circumvent these, as described in phrack's
magazine <code><a
href="http://packetstorm.linuxsecurity.com/mag/phrack/phrack58.tar.gz">issue
58</a></code> or in CORE's Advisory <code><a
href="http://online.securityfocus.com/archive/1/269246">Multiple
vulnerabilities in stack smashing protection technologies</a></code>.
</p>

<p>
If you want to test out your buffer overflow protection once you have
implemented it (regardless of the method) you might want to install the
<code>paxtest</code> and run the tests it provides.
</p>

<hr>

<h3><a name="s4.14.1"></a>4.14.1 Kernel patch protection for buffer overflows</h3>

<p>
Kernel patches related to buffer overflows include the Openwall patch provides
protection against buffer overflows in 2.2 linux kernels.  For 2.4 or newer
kernels, you need to use the Exec-shield implementation, or the PaX
implementation (provided in the grsecurity patch,
<code>kernel-patch-2.4-grsecurity</code>, and in the Adamantix patch,
<code>kernel-patch-adamantix</code>).  For more information on using these
patches read the the section <a href="#s-kernel-patches">Adding kernel patches,
Section 4.13</a>.
</p>

<hr>

<h3><a name="s4.14.2"></a>4.14.2 Testing programs for overflows</h3>

<p>
The use of tools to detect buffer overflows requires, in any case, of
programming experience in order to fix (and recompile) the code.  Debian
provides, for example: <code>bfbtester</code> (a buffer overflow tester that
brute-forces binaries through command line and environment overflows).  Other
packages of interest would also be <code>rats</code>, <code>pscan</code>,
<code>flawfinder</code> and <code>splint</code>.
</p>

<hr>

<h2><a name="s4.15"></a>4.15 Secure file transfers</h2>

<p>
During normal system administration one usually needs to transfer files in and
out from the installed system.  Copying files in a secure manner from a host to
another can be achieved by using the <code>ssh</code> server package.  Another
possibility is the use of <code>ftpd-ssl</code>, a ftp server which uses the
<em>Secure Socket Layer</em> to encrypt the transmissions.
</p>

<p>
Any of these methods need special clients.  Debian does provide client
software, such as <code>scp</code> from the <code>ssh</code> package, which
works like <code>rcp</code> but is encrypted completely, so the <em>bad
guys</em> cannot even find out WHAT you copy.  There is also a
<code>ftp-ssl</code> package for the equivalent server.  You can find clients
for these software even for other operating systems (non-UNIX),
<code>putty</code> and <code>winscp</code> provide secure copy implementations
for any version of Microsoft's operating system.
</p>

<p>
Note that using <code>scp</code> provides access to the users to all the file
system unless <code>chroot</code>'ed as described in <a
href="ch-sec-services.en.html#s-ssh-chroot">Chrooting ssh, Section 5.1.1</a>.
FTP access can be <code>chroot</code>'ed, probably easier depending on you
chosen daemon, as described in <a
href="ch-sec-services.en.html#s-ftp-secure">Securing FTP, Section 5.3</a>.  If
you are worried about users browsing your local files and want to have
encrypted communication you can either use an ftp daemon with SSL support or
combine clear-text ftp and a VPN setup (see <a
href="ch-sec-tools.en.html#s-vpn">Virtual Private Networks, Section 8.5</a>).
</p>

<hr>

<h2><a name="s4.16"></a>4.16 File system limits and control</h2>

<hr>

<h3><a name="s4.16.1"></a>4.16.1 Using quotas</h3>

<p>
Having a good quota policy is important, as it keeps users from filling up the
hard disk(s).
</p>

<p>
You can use two different quota systems: user quota and group quota.  As you
probably figured out, user quota limits the amount of space a user can take up,
group quota does the equivalent for groups.  Keep this in mind when you're
working out quota sizes.
</p>

<p>
There are a few important points to think about in setting up a quota system:
</p>
<ul>
<li>
<p>
Keep the quotas small enough, so users do not eat up your disk space.
</p>
</li>
</ul>
<ul>
<li>
<p>
Keep the quotas big enough, so users do not complain or their mail quota keeps
them from accepting mail over a longer period.
</p>
</li>
</ul>
<ul>
<li>
<p>
Use quotas on all user-writable areas, on <code>/home</code> as well as on
<code>/tmp</code>.
</p>
</li>
</ul>

<p>
Every partition or directory to which users have full write access should be
quota enabled.  Calculate and assign a workable quota size for those partitions
and directories which combines usability and security.
</p>

<p>
So, now you want to use quotas.  First of all you need to check whether you
enabled quota support in your kernel.  If not, you will need to recompile it.
After this, control whether the package <code>quota</code> is installed.  If
not you will need this one as well.
</p>

<p>
Enabling quota for the respective file systems is as easy as modifying the
<samp>defaults</samp> setting to <samp>defaults,usrquota</samp> in your
<code>/etc/fstab</code> file.  If you need group quota, substitute
<samp>usrquota</samp> to <samp>grpquota</samp>.  You can also use them both.
Then create empty quota.user and quota.group files in the roots of the file
systems you want to use quotas on (e.g.  <samp>touch /home/quota.user
/home/quota.group</samp> for a <code>/home</code> file system).
</p>

<p>
Restart <code>quota</code> by doing <samp>/etc/init.d/quota
stop;/etc/init.d/quota start</samp>.  Now quota should be running, and quota
sizes can be set.
</p>

<p>
Editing quotas for a specific user can be done by <samp>edquota -u
&lt;user&gt;</samp>.  Group quotas can be modified with <samp>edquota -g
&lt;group&gt;</samp>.  Then set the soft and hard quota and/or inode quotas as
needed.
</p>

<p>
For more information about quotas, read the quota man page, and the quota
mini-howto (<code>/usr/share/doc/HOWTO/en-html/mini/Quota.html</code>).  You
may also want to look at <code>pam_limits.so</code>.
</p>

<hr>

<h3><a name="s-ext2attr"></a>4.16.2 The ext2 filesystem specific attributes (chattr/lsattr)</h3>

<p>
In addition to the usual Unix permissions, the ext2 and ext3 filesystems offer
a set of specific attributes that give you more control over the files on your
system.  Unlike the basic permissions, these attributes are not displayed by
the usual <code>ls -l</code> command or changed using <code>chmod</code>, and
you need two other utilities, <code>lsattr</code> and <code>chattr</code> (in
package <code>e2fsprogs</code>) to manage them.  Note that this means that
these attributes will usually not be saved when you backup your system, so if
you change any of them, it may be worth saving the successive
<code>chattr</code> commands in a script so that you can set them again later
if you have to restore a backup.
</p>

<p>
Among all available attributes, the two that are most important for increasing
security are referenced by the letters 'i' and 'a', and they can only be set
(or removed) by the superuser:
</p>
<ul>
<li>
<p>
The 'i' attribute ('immutable'): a file with this attribute can neither be
modified nor deleted or renamed and no link can be created to it, even by the
superuser.
</p>
</li>
</ul>
<ul>
<li>
<p>
The 'a' attribute ('append'): this attribute has the same effect that the
immutable attribute, except that you can still open the file in append mode.
This means that you can still add more content to it but it is impossible to
modify previous content.  This attribute is especially useful for the log files
stored in <code>/var/log/</code>, though you should consider that they get
moved sometimes due to the log rotation scripts.
</p>
</li>
</ul>

<p>
These attributes can also be set for directories, in which case everyone is
denied the right to modify the contents of a directory list (e.g.  rename or
remove a file, ...).  When applied to a directory, the append attribute only
allows file creation.
</p>

<p>
It is easy to see how the 'a' attribute improves security, by giving to
programs that are not running as the superuser the ability to add data to a
file without modifying its previous content.  On the other hand, the 'i'
attribute seems less interesting: after all, the superuser can already use the
basic Unix permissions to restrict access to a file, and an intruder that would
get access to the superuser account could always use the <code>chattr</code>
program to remove the attribute.  Such an intruder may first be confused when
he sees that he is not able to remove a file, but you should not assume that he
is blind - after all, he got into your system!  Some manuals (including a
previous version of this document) suggest to simply remove the
<code>chattr</code> and <code>lsattr</code> programs from the system to
increase security, but this kind of strategy, also known as &quot;security by
obscurity&quot;, is to be absolutely avoided, since it provides a false sense
of security.
</p>

<p>
A secure way to solve this problem is to use the capabilities of the Linux
kernel, as described in <a href="ch10.en.html#s-proactive">Proactive defense,
Section 10.4.2.1</a>.  The capability of interest here is called
<samp>CAP_LINUX_IMMUTABLE</samp>: if you remove it from the capabilities
bounding set (using for example the command <samp>lcap
CAP_LINUX_IMMUTABLE</samp>) it won't be possible to change any 'a' or 'i'
attribute on your system anymore, even by the superuser !  A complete strategy
could be as follows:
</p>
<ol type="1" start="1" >
<li>
<p>
Set the attributes 'a' and 'i' on any file you want;
</p>
</li>
</ol>
<ol type="1" start="2" >
<li>
<p>
Add the command <samp>lcap CAP_LINUX_IMMUTABLE</samp> (as well as <samp>lcap
CAP_SYS_MODULE</samp>, as suggested in <a
href="ch10.en.html#s-proactive">Proactive defense, Section 10.4.2.1</a>) to one
of the startup scripts;
</p>
</li>
</ol>
<ol type="1" start="3" >
<li>
<p>
Set the 'i' attribute on this script and other startup files, as well as on the
<code>lcap</code> binary itself;
</p>
</li>
</ol>
<ol type="1" start="4" >
<li>
<p>
Execute the above command manually (or reboot your system to make sure
everything works as planned).
</p>
</li>
</ol>

<p>
Now that the capability has been removed from the system, an intruder cannot
change any attribute on the protected files, and thus cannot change or remove
the files.  If he forces the machine to reboot (which is the only way to
restore the capabilities bounding set), it will easily be detected, and the
capability will be removed again as soon as the system restarts anyway.  The
only way to change a protected file would be to boot the system in single-user
mode or using another bootdisk, two operations that require physical access to
the machine !
</p>

<hr>

<h3><a name="s-check-integ"></a>4.16.3 Checking file system integrity</h3>

<p>
Are you sure <code>/bin/login</code> on your hard drive is still the binary you
installed there some months ago?  What if it is a hacked version, which stores
the entered password in a hidden file or mails it in clear-text version all
over the Internet?
</p>

<p>
The only method to have some kind of protection is to check your files every
hour/day/month (I prefer daily) by comparing the actual and the old md5sum of
this file.  Two files cannot have the same md5sum (the MD5 digest is 128 bits,
so the chance that two different files will have the same md5sum is roughly one
in 3.4e3803), so you're on the safe site here, unless someone has also hacked
the algorithm that creates md5sums on that machine.  This is, well, extremely
difficult and very unlikely.  You really should consider this auditing of your
binaries as very important, since it is an easy way to recognize changes at
your binaries.
</p>

<p>
Common tools used for this are <code>sxid</code>, <code>aide</code> (Advanced
Intrusion Detection Environment), <code>tripwire</code>, <code>integrit</code>
and <code>samhain</code>.  Installing <code>debsums</code> will also help you
to check the file system integrity, by comparing the md5sums of every file
against the md5sums used in the Debian package archive.  But beware: those
files can easily be changed by an attacker and not all packages provide md5sums
listings for the binaries they provided.  For more information please read <a
href="ch10.en.html#s-periodic-integrity">Do periodic integrity checks, Section
10.2</a> and <a href="#s-snapshot">Taking a snapshot of the system, Section
4.18</a>.
</p>

<p>
You might want to use <code>locate</code> to index the whole filesystem, if so,
consider the implications of that.  The Debian <code>findutils</code> package
contains <code>locate</code> which runs as user nobody, and so it only indexes
files which are visible to everybody.  However, if you change it's behaviour
you will make all file locations visible to all users.  If you want to index
all the filesystem (not the bits that the user nobody can see) you can replace
<code>locate</code> with the package <code>slocate</code>.  slocate is labeled
as a security enhanced version of GNU locate, but it actually provides
additional file-locating functionality.  When using <code>slocate</code>, the
user only sees the files he really has access to and you can exclude any files
or directories on the system.  The <code>slocate</code> package runs its update
process with higher privledges than locate, and indexes every file.  Users are
then able to quickly search for every file which they are able to see.
<code>slocate</code> doesn't let them see new files; it filters the output
based on your UID.
</p>

<p>
You might want to use <code>bsign</code> or <code>elfsign</code>.
<code>elfsign</code> provides an utility to add a digital signature to an ELF
binary and a second utility to verify that signature.  The current
implementation uses PKI to sign the checksum of the binary.  The benefits of
doing this are that it enables one to determine if a binary has been modified
and who created it.  <code>bsign</code> uses GPG, <code>elfsign</code> uses PKI
(X.509) certificates (OpenSSL).
</p>

<hr>

<h3><a name="s4.16.4"></a>4.16.4 Setting up setuid check</h3>

<p>
The Debian <code>checksecurity</code> package provides a <code>cron</code> job
that runs daily in <code>/etc/cron.daily/checksecurity</code> [<a
href="footnotes.en.html#f34" name="fr34">34</a>].  This <code>cron</code> job
will run the <code>/usr/sbin/checksecurity</code> script that will store
information of this changes.
</p>

<p>
The default behavior does not send this information to the superuser but,
instead keeps daily copies of the changes in
<code>/var/log/setuid.changes</code>.  You should set the MAILTO variable (in
<code>/etc/checksecurity.conf</code>) to 'root' to have this information mailed
to him.  See <code>checksecurity(8)</code> for more configuration info.
</p>

<hr>

<h2><a name="s-network-secure"></a>4.17 Securing network access</h2>

<p>
FIXME: More (Debian-specific) content needed.
</p>

<hr>

<h3><a name="s-kernel-conf"></a>4.17.1 Configuring kernel network features</h3>

<p>
Many features of the kernel can be modified while running by echoing something
into the <code>/proc</code> file system or by using <code>sysctl</code>.  By
entering <samp>/sbin/sysctl -A</samp> you can see what you can configure and
what the options are, and it can be modified running <samp>/sbin/sysctl -w
variable=value</samp> (see <code>sysctl(8)</code>).  Only in rare cases do you
need to edit something here, but you can increase security that way as well.
For example:
</p>

<pre>
     net/ipv4/icmp_echo_ignore_broadcasts = 1
</pre>

<p>
This is a <em>Windows emulator</em> because it acts like Windows on broadcast
ping if this option is set to 1.  That is, ICMP echo requests sent to the
broadcast address will be ignored.  Otherwise, it does nothing.
</p>

<p>
If you want to prevent you system from answering ICMP echo requests, just
enable this configuration option:
</p>

<pre>
     net/ipv4/icmp_echo_ignore_all = 1
</pre>

<p>
To log packets with impossible addresses (due to wrong routes) on your network
use:
</p>

<pre>
     /proc/sys/net/ipv4/conf/all/log_martians = 1
</pre>

<p>
For more information on what things can be done with
<code>/proc/sys/net/ipv4/*</code> read
<code>/usr/src/linux/Documentation/filesystems/proc.txt</code>.  All the
options are described thoroughly under
<code>/usr/src/linux/Documentation/networking/ip-sysctl.txt</code> [<a
href="footnotes.en.html#f35" name="fr35">35</a>].
</p>

<hr>

<h3><a name="s-tcp-syncookies"></a>4.17.2 Configuring syncookies</h3>

<p>
This option is a double-edged sword.  On the one hand it protects your system
against syn packet flooding; on the other hand it violates defined standards
(RFCs).
</p>

<pre>
     net/ipv4/tcp_syncookies = 1
</pre>

<p>
If you want to change this option each time the kernel is working you need to
change it in <samp>/etc/network/options</samp> by setting
<samp>syncookies=yes</samp>.  This will take effect when ever
<samp>/etc/init.d/networking</samp> is run (which is typically done at boot
time) while the following will have a one-time effect until the reboot:
</p>

<pre>
     echo 1 &gt; /proc/sys/net/ipv4/tcp_syncookies
</pre>

<p>
This option will only be available if the kernel is compiled with the
<samp>CONFIG_SYNCOOKIES</samp>.  All Debian kernels are compiled with this
option builtin but you can verify it running:
</p>

<pre>
     $ sysctl -A |grep syncookies
     net/ipv4/tcp_syncookies = 1
</pre>

<p>
For more information on TCP syncookies read <code><a
href="http://cr.yp.to/syncookies.html">http://cr.yp.to/syncookies.html</a></code>.
</p>

<hr>

<h3><a name="s-net-harden"></a>4.17.3 Securing the network on boot-time</h3>

<p>
When setting configuration options for the kernel networking you need configure
it so that it's loaded every time the system is restarted.  The following
example enables many of the previous options as well as other useful options.
</p>

<p>
There are actually two ways to configure your network at boot time.  You can
configure <code>/etc/sysctl.conf</code> (see: <code>sysctl.conf(5)</code>) or
introduce a script that is called when the interface is enabled.  The first
option will be applied to all interfaces, whileas the second option allows you
to configure this on a per-interface basis.
</p>

<p>
An example of a <code>/etc/sysctl.conf</code> configuration that will secure
some network options at the kernel level is shown below.  Notice the comment in
it, <code>/etc/network/options</code> might override some values if they
contradict those in this file when the <code>/etc/init.d/networking</code> is
run (which is later than <code>procps</code> on the startup sequence).
</p>

<pre>
     #
     # /etc/sysctl.conf - Configuration file for setting system variables
     # See sysctl.conf (5) for information. Also see the files under
     # Documentation/sysctl/, Documentation/filesystems/proc.txt, and
     # Documentation/networking/ip-sysctl.txt in the kernel sources 
     # (/usr/src/kernel-$version if you have a kernel-package installed)
     # for more information of the values that can be defined here.
     
     #
     # Be warned that /etc/init.d/procps is executed to set the following
     # variables.  However, after that, /etc/init.d/networking sets some
     # network options with builtin values.  These values may be overridden
     # using /etc/network/options.
     #
     #kernel.domainname = example.com
     
     # Additional settings - adapted from the script contributed
     # by Dariusz Puchala (see below)
     # Ignore ICMP broadcasts
     net/ipv4/icmp_echo_ignore_broadcasts = 1
     #
     # Ignore bogus ICMP errors
     net/ipv4/icmp_ignore_bogus_error_responses = 1
     # 
     # Do not accept ICMP redirects (prevent MITM attacks)
     net/ipv4/conf/all/accept_redirects = 0
     # _or_
     # Accept ICMP redirects only for gateways listed in our default
     # gateway list (enabled by default)
     # net/ipv4/conf/all/secure_redirects = 1
     #
     # Do not send ICMP redirects (we are not a router)
     net/ipv4/conf/all/send_redirects = 0
     #
     # Do not forward IP packets (we are not a router)
     # Note: Make sure that /etc/network/options has 'ip_forward=no'
     net/ipv4/conf/all/forwarding = 0
     #
     # Enable TCP Syn Cookies
     # Note: Make sure that /etc/network/options has 'syncookies=yes'
     net/ipv4/tcp_syncookies = 1
     #
     # Log Martian Packets
     net/ipv4/conf/all/log_martians = 1
     #
     # Turn on Source Address Verification in all interfaces to
     # prevent some spoofing attacks
     # Note: Make sure that /etc/network/options has 'spoofprotect=yes'
     net/ipv4/conf/all/rp_filter = 1
     #
     # Do not accept IP source route packets (we are not a router)
     net/ipv4/conf/all/accept_source_route = 0
</pre>

<p>
To use the script you need to first create the script, for example, in
<code>/etc/network/interface-secure</code> (the name is given as an example)
and call it from <code>/etc/network/interfaces</code> like this:
</p>

<pre>
     auto eth0
     iface eth0 inet static
             address xxx.xxx.xxx.xxx
             netmask 255.255.255.xxx
             broadcast xxx.xxx.xxx.xxx
             gateway xxx.xxx.xxx.xxx
             pre-up /etc/network/interface-secure
</pre>

<p>
In this example, before the interface eth0 is enabled the script will be called
to secure all network interfaces as shown below.
</p>

<pre>
     #!/bin/sh -e
     # Script-name: /etc/network/interface-secure
     #
     # Modifies some default behavior in order to secure against 
     # some TCP/IP spoofing &amp; attacks for all interfaces.
     #
     # Contributed by Dariusz Puchalak.
     #
     echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts 
                                                # Broadcast echo protection enabled.
     echo 0 &gt; /proc/sys/net/ipv4/conf/all/forwarding
                                                # IP forwarding disabled.
     echo 1 &gt; /proc/sys/net/ipv4/tcp_syncookies # TCP syn cookies protection enabled.
     echo 1 &gt;/proc/sys/net/ipv4/conf/all/log_martians # Log strange packets.
     # (this includes spoofed packets, source routed packets, redirect packets)
     # but be careful with this on heavy loaded web servers.
     echo 1 &gt; /proc/sys/net/ipv4/icmp_ignore_bogus_error_responses 
                                                # Bad error message protection enabled.
     
     # IP spoofing protection.
     echo 1 &gt; /proc/sys/net/ipv4/conf/all/rp_filter
     
     # Disable ICMP redirect acceptance.
     echo 0 &gt; /proc/sys/net/ipv4/conf/all/accept_redirects
     echo 0 &gt; /proc/sys/net/ipv4/conf/all/send_redirects
     
     # Disable source routed packets.
     echo 0 &gt; /proc/sys/net/ipv4/conf/all/accept_source_route
     
     exit 0
</pre>

<p>
Notice that you can actually have per-interface scripts that will enable
different network options for different interfaces (if you have more than one),
just change the pre-up line to:
</p>

<pre>
     pre-up /etc/network/interface-secure $IFACE
</pre>

<p>
And use a script which will only apply changes to a specific interface, not to
all of the interfaces available.  Notice that some networking options can only
be enabled globally, however.  A sample script is this one:
</p>

<pre>
     #!/bin/sh -e
     # Script-name: /etc/network/interface-secure
     #
     # Modifies some default behavior in order to secure against 
     # some TCP/IP spoofing &amp; attacks for a given interface.
     #
     # Contributed by Dariusz Puchalak.
     #
     
     IFACE=$1
     if [ -z &quot;$IFACE&quot; ] ; then
        echo &quot;$0: Must give an interface name as argument!&quot;
        echo &quot;Usage: $0 &lt;interface&gt;&quot;
        exit 1
     fi
     
     if [ ! -e /proc/sys/net/ipv4/conf/$IFACE/ ]; then
        echo &quot;$0: Interface $IFACE does not exit (cannot find /proc/sys/net/ipv4/conf/)&quot;
        exit 1
     fi
     
     echo 0 &gt; /proc/sys/net/ipv4/conf/$IFACE/forwarding  # IP forwarding disabled.
     echo 1 &gt;/proc/sys/net/ipv4/conf/$IFACE/log_martians # Log strange packets.
     # (this includes spoofed packets, source routed packets, redirect packets)
     # but be careful with this on heavy loaded web servers.
     
     # IP spoofing protection.
     echo 1 &gt; /proc/sys/net/ipv4/conf/$IFACE/rp_filter
     
     # Disable ICMP redirect acceptance.
     echo 0 &gt; /proc/sys/net/ipv4/conf/$IFACE/accept_redirects
     echo 0 &gt; /proc/sys/net/ipv4/conf/$IFACE/send_redirects
     
     # Disable source routed packets.
     echo 0 &gt; /proc/sys/net/ipv4/conf/$IFACE/accept_source_route
     
     exit 0
</pre>

<p>
An alternative solution is to create an <samp>init.d</samp> script and have it
run on bootup (using <code>update-rc.d</code> to create the appropriate
<samp>rc.d</samp> links).
</p>

<hr>

<h3><a name="s-kernel-fw"></a>4.17.4 Configuring firewall features</h3>

<p>
In order to have firewall capabilities, either to protect the local system or
others <em>behind</em> it, the kernel needs to be compiled with firewall
capabilities.  The standard Debian 2.2 kernel (Linux 2.2) provides the packet
filter <code>ipchains</code> firewall, Debian 3.0 standard kernel (Linux 2.4)
provides the <em>stateful</em> packet filter <code>iptables</code> (netfilter)
firewall.
</p>

<p>
In any case, it is pretty easy to use a kernel different from the one provided
by Debian.  You can find pre-compiled kernels as packages you can easily
install in the Debian system.  You can also download the kernel sources using
the <code>kernel-source-<var>X</var></code> and build custom kernel packages
using <code>make-kpkg</code> from the <code>kernel-package</code> package.
</p>

<p>
Setting up firewalls in Debian is discussed more thoroughly in <a
href="ch-sec-services.en.html#s-firewall-setup">Adding firewall capabilities,
Section 5.14</a>.
</p>

<hr>

<h3><a name="s-limit-bindaddr"></a>4.17.5 Disabling weak-end hosts issues</h3>

<p>
Systems with more than one interface on different networks can have services
configured so that they will bind only to a given IP address.  This usually
prevents access to services when requested through any other address.  However,
this does not mean (although it is a common misconception) that the service is
bound to a given <em>hardware</em> address (interface card).  [<a
href="footnotes.en.html#f36" name="fr36">36</a>]
</p>

<p>
This is not an ARP issue and it's not an RFC violation (it's called <em>weak
end host</em> in <code><a
href="ftp://ftp.isi.edu/in-notes/rfc1122.txt">RFC1122</a></code>, section
3.3.4.2).  Remember, IP addresses have nothing to do with physical interfaces.
</p>

<p>
On 2.2 (and previous) kernels this can be fixed with:
</p>

<pre>
     # echo 1 &gt; /proc/sys/net/ipv4/conf/all/hidden
     # echo 1 &gt; /proc/sys/net/ipv4/conf/eth0/hidden
     # echo 1 &gt; /proc/sys/net/ipv4/conf/eth1/hidden
     .....
</pre>

<p>
On later kernels this can be fixed either with:
</p>
<ul>
<li>
<p>
iptables rules.
</p>
</li>
</ul>
<ul>
<li>
<p>
properly configured routing.  [<a href="footnotes.en.html#f37"
name="fr37">37</a>]
</p>
</li>
</ul>
<ul>
<li>
<p>
kernel patching.  [<a href="footnotes.en.html#f38" name="fr38">38</a>]
</p>
</li>
</ul>

<p>
Along this text there will be many occasions in which it is shown how to
configure some services (sshd server, apache, printer service...) in order to
have them listening on any given address, the reader should take into account
that, without the fixes given here, the fix would not prevent accesses from
within the same (local) network.  [<a href="footnotes.en.html#f39"
name="fr39">39</a>]
</p>

<p>
FIXME: Comments on Bugtraq indicate there is a Linux specific method to bind to
a given interface.
</p>

<p>
FIXME: Submit a bug against netbase so that the routing fix is standard
behavior in Debian?
</p>

<hr>

<h3><a name="s4.17.6"></a>4.17.6 Protecting against ARP attacks</h3>

<p>
When you don't trust the other boxes on your LAN (which should always be the
case, because it's the safest attitude) you should protect yourself from the
various existing ARP attacks.
</p>

<p>
As you know the ARP protocol is used to link IP addresses to MAC addresses (see
<code><a href="ftp://ftp.isi.edu/in-notes/rfc826.txt">RFC826</a></code> for all
the details).  Every time you send a packet to an IP address an ARP resolution
is done (first by looking into the local ARP cache then if the IP isn't present
in the cache by broadcasting an ARP query) to find the target's hardware
address.  All the ARP attacks aim to fool your box into thinking that box B's
IP address is associated to the intruder's box's MAC address; Then every packet
that you want to send to the IP associated to box B will be send to the
intruder's box...
</p>

<p>
Those attacks (ARP cache poisoning, ARP spoofing...) allow the attacker to
sniff the traffic even on switched networks, to easily hijack connections, to
disconnect any host from the network...  ARP attacks are powerful and simple to
implement, and several tools exists, such as <code>arpspoof</code> from the
<code>dsniff</code> package or <code><a
href="http://arpoison.sourceforge.net/">arpoison</a></code>.
</p>

<p>
However, there is always a solution:
</p>
<ul>
<li>
<p>
Use a static ARP cache.  You can set up &quot;static&quot; entries in your ARP
cache with:
</p>

<pre>
       arp -s host_name hdwr_addr
</pre>

<p>
By setting static entries for each important host in your network you ensure
that nobody will create/modify a (fake) entry for these hosts (static entries
don't expire and can't be modified) and spoofed ARP replies will be ignored.
</p>
</li>
</ul>
<ul>
<li>
<p>
Detect suspicious ARP traffic.  You can use <code>arpwatch</code>,
<code>karpski</code> or more general IDS that can also detect suspicious ARP
traffic (<code>snort</code>, <code><a
href="http://www.prelude-ids.org">prelude</a></code>...).
</p>
</li>
</ul>
<ul>
<li>
<p>
Implement IP traffic filtering validating the MAC address.
</p>
</li>
</ul>

<hr>

<h2><a name="s-snapshot"></a>4.18 Taking a snapshot of the system</h2>

<p>
Before putting the system into production system you could take a snapshot of
the whole system.  This snapshot could be used in the event of a compromise
(see <a href="ch-after-compromise.en.html">After the compromise (incident
response), Chapter 11</a>).  You should remake this upgrade whenever the system
is upgraded, especially if you upgrade to a new Debian release.
</p>

<p>
For this you can use a writable removable-media that can be set up read-only,
this could be a floppy disk (read protected after use), a CD on a CD-ROM unit
(you could use a rewritable CD-ROM so you could even keep backups of md5sums in
different dates), or a USB disk or MMC card (if your system can access those
and they can be write protected).
</p>

<p>
The following script creates such a snapshot:
</p>

<pre>
     #!/bin/bash
     /bin/mount /dev/fd0 /mnt/floppy
     trap &quot;/bin/umount /dev/fd0&quot; 0 1 2 3 9 13 15
     if [ ! -f /usr/bin/md5sum ] ; then
     	echo &quot;Cannot find md5sum. Aborting.&quot;
     	exit 1
     fi
     /bin/cp /usr/bin/md5sum /mnt/floppy
     echo &quot;Calculating md5 database&quot;
     &gt;/mnt/floppy/md5checksums.txt
     for dir in /bin/ /sbin/ /usr/bin/ /usr/sbin/ /lib/ /usr/lib/
     do
        find $dir -type f | xargs /usr/bin/md5sum &gt;&gt;/mnt/floppy/md5checksums-lib.txt
     done
     echo &quot;post installation md5 database calculated&quot;
     if [ ! -f /usr/bin/sha1sum ] ; then
     	echo &quot;Cannot find sha1sum&quot;
             echo &quot;WARNING: Only md5 database will be stored&quot;
     else
     	/bin/cp /usr/bin/sha1sum /mnt/floppy
     	echo &quot;Calculating SHA-1 database&quot;
     	&gt;/mnt/floppy/sha1checksums.txt
     	for dir in /bin/ /sbin/ /usr/bin/ /usr/sbin/ /lib/ /usr/lib/
     	do
     	   find $dir -type f | xargs /usr/bin/sha1sum &gt;&gt;/mnt/floppy/sha1checksums-lib.txt
     	done
     	echo &quot;post installation sha1 database calculated&quot;
     fi
     exit 0
</pre>

<p>
Note that the md5sum binary (and sha1sum, if available) is placed on the floppy
drive so it can be used later on to check the binaries of the system (just in
case it gets trojaned).  However, if you want to make sure that you are running
a legitimate binary, you might want to either compile a static copy of the
md5sum binary and use that one (to prevent a trojaned libc library from
interfering with the binary) or to use the snapshot of md5sums only from a
clean environment such as a rescue CD-ROM or a Live-CD (to prevent a trojaned
kernel from interfering).  I cannot stress this enough: if you are on a
compromised system you cannot trust its output, see <a
href="ch-after-compromise.en.html">After the compromise (incident response),
Chapter 11</a>.
</p>

<p>
The snapshot does not include the files under <code>/var/lib/dpkg/info</code>
which includes the MD5 hashes of installed packages (in files ending with
<code>.md5sums</code>).  You could copy this information along too, however you
should notice:
</p>
<ul>
<li>
<p>
the md5sums files include the md5sum of all files provided by the Debian
packages, not just system binaries.  As a consequence, that database is bigger
(5 Mb versus 600 Kb in a Debian GNU/Linux system with a graphical system and
around 2.5 Gb of software installed) and will not fit in small removable media
(like a single floppy disk, but would probably fit in a removable USB memory).
</p>
</li>
</ul>
<ul>
<li>
<p>
not all Debian packages provide md5sums for the files installed since it is not
(currently) mandated policy.  Notice, however, that you can generate the
md5sums for all packages using <code>debsums</code> after you've finished the
system installation:
</p>

<pre>
     # debsums --generate=missing,keep
</pre>
</li>
</ul>

<p>
Once the snapshot is done you should make sure to set the medium read-only.
You can then store it for backup or place it in the drive and use it to drive a
<code>cron</code> check nightly comparing the original md5sums against those on
the snapshot.
</p>

<p>
If you do not want to setup a manual check you can always use any of the
integrity systems available that will do this and more, for more information
please read <a href="ch10.en.html#s-periodic-integrity">Do periodic integrity
checks, Section 10.2</a>.
</p>

<hr>

<h2><a name="s4.19"></a>4.19 Other recommendations</h2>

<hr>

<h3><a name="s4.19.1"></a>4.19.1 Do not use software depending on svgalib</h3>

<p>
SVGAlib is very nice for console lovers like me, but in the past it has been
proven several times that it is very insecure.  Exploits against
<code>zgv</code> were released, and it was simple to become root.  Try to
prevent using SVGAlib programs wherever possible.
</p>

<hr>

<p>
[ <a href="ch3.en.html">previous</a> ]
[ <a href="index.en.html#contents">Contents</a> ]
[ <a href="ch1.en.html">1</a> ]
[ <a href="ch2.en.html">2</a> ]
[ <a href="ch3.en.html">3</a> ]
[ 4 ]
[ <a href="ch-sec-services.en.html">5</a> ]
[ <a href="ch-automatic-harden.en.html">6</a> ]
[ <a href="ch7.en.html">7</a> ]
[ <a href="ch-sec-tools.en.html">8</a> ]
[ <a href="ch9.en.html">9</a> ]
[ <a href="ch10.en.html">10</a> ]
[ <a href="ch-after-compromise.en.html">11</a> ]
[ <a href="ch12.en.html">12</a> ]
[ <a href="ap-harden-step.en.html">A</a> ]
[ <a href="ap-checklist.en.html">B</a> ]
[ <a href="ap-snort-box.en.html">C</a> ]
[ <a href="ap-bridge-fw.en.html">D</a> ]
[ <a href="ap-bind-chuser.en.html">E</a> ]
[ <a href="ap-fw-security-update.en.html">F</a> ]
[ <a href="ap-chroot-ssh-env.en.html">G</a> ]
[ <a href="ap-chroot-apache-env.en.html">H</a> ]
[ <a href="ch-sec-services.en.html">next</a> ]
</p>

<hr>

<p>
Securing Debian Manual
</p>

<address>
Version: 3.13, Sun, 08 Apr 2012 02:48:09 +0000<br>
<br>
Javier Fern&aacute;ndez-Sanguino Pe&ntilde;a <code><a href="mailto:jfs@debian.org">jfs@debian.org</a></code><br>
<a href="ch1.en.html#s-authors">Authors, Section 1.1</a><br>
<br>
</address>
<hr>

</body>

</html>

