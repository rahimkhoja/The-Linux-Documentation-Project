<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">

<html>

<head>

<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">

<title>Securing Debian Manual - Securing services running on your system</title>

<link href="index.en.html" rel="start">
<link href="ch4.en.html" rel="prev">
<link href="ch-automatic-harden.en.html" rel="next">
<link href="index.en.html#contents" rel="contents">
<link href="index.en.html#copyright" rel="copyright">
<link href="ch1.en.html" rel="chapter" title="1 Introduction">
<link href="ch2.en.html" rel="chapter" title="2 Before you begin">
<link href="ch3.en.html" rel="chapter" title="3 Before and during the installation">
<link href="ch4.en.html" rel="chapter" title="4 After installation">
<link href="ch-sec-services.en.html" rel="chapter" title="5 Securing services running on your system">
<link href="ch-automatic-harden.en.html" rel="chapter" title="6 Automatic hardening of Debian systems">
<link href="ch7.en.html" rel="chapter" title="7 Debian Security Infrastructure">
<link href="ch-sec-tools.en.html" rel="chapter" title="8 Security tools in Debian">
<link href="ch9.en.html" rel="chapter" title="9 Developer's Best Practices for OS Security">
<link href="ch10.en.html" rel="chapter" title="10 Before the compromise">
<link href="ch-after-compromise.en.html" rel="chapter" title="11 After the compromise (incident response)">
<link href="ch12.en.html" rel="chapter" title="12 Frequently asked Questions (FAQ)">
<link href="ap-harden-step.en.html" rel="appendix" title="A The hardening process step by step">
<link href="ap-checklist.en.html" rel="appendix" title="B Configuration checklist">
<link href="ap-snort-box.en.html" rel="appendix" title="C Setting up a stand-alone IDS">
<link href="ap-bridge-fw.en.html" rel="appendix" title="D Setting up a bridge firewall">
<link href="ap-bind-chuser.en.html" rel="appendix" title="E Sample script to change the default Bind installation.">
<link href="ap-fw-security-update.en.html" rel="appendix" title="F Security update protected by a firewall">
<link href="ap-chroot-ssh-env.en.html" rel="appendix" title="G <code>Chroot</code> environment for <code>SSH</code>">
<link href="ap-chroot-apache-env.en.html" rel="appendix" title="H <code>Chroot</code> environment for <code>Apache</code>">
<link href="ch1.en.html#s-authors" rel="section" title="1.1 Authors">
<link href="ch1.en.html#s1.2" rel="section" title="1.2 Where to get the manual (and available formats)">
<link href="ch1.en.html#s1.3" rel="section" title="1.3 Organizational notes/feedback">
<link href="ch1.en.html#s1.4" rel="section" title="1.4 Prior knowledge">
<link href="ch1.en.html#s1.5" rel="section" title="1.5 Things that need to be written (FIXME/TODO)">
<link href="ch1.en.html#s-changelog" rel="section" title="1.6 Changelog/History">
<link href="ch1.en.html#s-credits" rel="section" title="1.7 Credits and thanks!">
<link href="ch2.en.html#s2.1" rel="section" title="2.1 What do you want this system for?">
<link href="ch2.en.html#s-references" rel="section" title="2.2 Be aware of general security problems">
<link href="ch2.en.html#s2.3" rel="section" title="2.3 How does Debian handle security?">
<link href="ch3.en.html#s-bios-passwd" rel="section" title="3.1 Choose a BIOS password">
<link href="ch3.en.html#s3.2" rel="section" title="3.2 Partitioning the system">
<link href="ch3.en.html#s3.3" rel="section" title="3.3 Do not plug to the Internet until ready">
<link href="ch3.en.html#s3.4" rel="section" title="3.4 Set a root password">
<link href="ch3.en.html#s3.5" rel="section" title="3.5 Activate shadow passwords and MD5 passwords">
<link href="ch3.en.html#s3.6" rel="section" title="3.6 Run the minimum number of services required">
<link href="ch3.en.html#s3.7" rel="section" title="3.7 Install the minimum amount of software required">
<link href="ch3.en.html#s3.8" rel="section" title="3.8 Read the Debian security mailing lists">
<link href="ch4.en.html#s-debian-sec-announce" rel="section" title="4.1 Subscribe to the Debian Security Announce mailing list">
<link href="ch4.en.html#s-security-update" rel="section" title="4.2 Execute a security update">
<link href="ch4.en.html#s-bios-boot" rel="section" title="4.3 Change the BIOS (again)">
<link href="ch4.en.html#s-lilo-passwd" rel="section" title="4.4 Set a LILO or GRUB password">
<link href="ch4.en.html#s-kernel-initramfs-prompt" rel="section" title="4.5 Disable root prompt on the initramfs">
<link href="ch4.en.html#s-kernel-root-prompt" rel="section" title="4.6 Remove root prompt on the kernel">
<link href="ch4.en.html#s-restrict-console-login" rel="section" title="4.7 Restricting console login access">
<link href="ch4.en.html#s-restrict-reboots" rel="section" title="4.8 Restricting system reboots through the console">
<link href="ch4.en.html#s4.9" rel="section" title="4.9 Mounting partitions the right way">
<link href="ch4.en.html#s4.10" rel="section" title="4.10 Providing secure user access">
<link href="ch4.en.html#s-tcpwrappers" rel="section" title="4.11 Using tcpwrappers">
<link href="ch4.en.html#s-log-alerts" rel="section" title="4.12 The importance of logs and alerts">
<link href="ch4.en.html#s-kernel-patches" rel="section" title="4.13 Adding kernel patches">
<link href="ch4.en.html#s4.14" rel="section" title="4.14 Protecting against buffer overflows">
<link href="ch4.en.html#s4.15" rel="section" title="4.15 Secure file transfers">
<link href="ch4.en.html#s4.16" rel="section" title="4.16 File system limits and control">
<link href="ch4.en.html#s-network-secure" rel="section" title="4.17 Securing network access">
<link href="ch4.en.html#s-snapshot" rel="section" title="4.18 Taking a snapshot of the system">
<link href="ch4.en.html#s4.19" rel="section" title="4.19 Other recommendations">
<link href="ch-sec-services.en.html#s5.1" rel="section" title="5.1 Securing ssh">
<link href="ch-sec-services.en.html#s5.2" rel="section" title="5.2 Securing Squid">
<link href="ch-sec-services.en.html#s-ftp-secure" rel="section" title="5.3 Securing FTP">
<link href="ch-sec-services.en.html#s5.4" rel="section" title="5.4 Securing access to the X Window System">
<link href="ch-sec-services.en.html#s5.5" rel="section" title="5.5 Securing printing access (the lpd and lprng issue)">
<link href="ch-sec-services.en.html#s5.6" rel="section" title="5.6 Securing the mail service">
<link href="ch-sec-services.en.html#s-sec-bind" rel="section" title="5.7 Securing BIND">
<link href="ch-sec-services.en.html#s5.8" rel="section" title="5.8 Securing Apache">
<link href="ch-sec-services.en.html#s5.9" rel="section" title="5.9 Securing finger">
<link href="ch-sec-services.en.html#s-chroot" rel="section" title="5.10 General chroot and suid paranoia">
<link href="ch-sec-services.en.html#s5.11" rel="section" title="5.11 General cleartext password paranoia">
<link href="ch-sec-services.en.html#s5.12" rel="section" title="5.12 Disabling NIS">
<link href="ch-sec-services.en.html#s-rpc" rel="section" title="5.13 Securing RPC services">
<link href="ch-sec-services.en.html#s-firewall-setup" rel="section" title="5.14 Adding firewall capabilities">
<link href="ch-automatic-harden.en.html#s6.1" rel="section" title="6.1 Harden">
<link href="ch-automatic-harden.en.html#s6.2" rel="section" title="6.2 Bastille Linux">
<link href="ch7.en.html#s-debian-sec-team" rel="section" title="7.1 The Debian Security Team">
<link href="ch7.en.html#s-dsa" rel="section" title="7.2 Debian Security Advisories">
<link href="ch7.en.html#s7.3" rel="section" title="7.3 Security Tracker">
<link href="ch7.en.html#s7.4" rel="section" title="7.4 Debian Security Build Infrastructure">
<link href="ch7.en.html#s-deb-pack-sign" rel="section" title="7.5 Package signing in Debian">
<link href="ch-sec-tools.en.html#s-vuln-asses" rel="section" title="8.1 Remote vulnerability assessment tools">
<link href="ch-sec-tools.en.html#s8.2" rel="section" title="8.2 Network scanner tools">
<link href="ch-sec-tools.en.html#s8.3" rel="section" title="8.3 Internal audits">
<link href="ch-sec-tools.en.html#s8.4" rel="section" title="8.4 Auditing source code">
<link href="ch-sec-tools.en.html#s-vpn" rel="section" title="8.5 Virtual Private Networks">
<link href="ch-sec-tools.en.html#s8.6" rel="section" title="8.6 Public Key Infrastructure (PKI)">
<link href="ch-sec-tools.en.html#s8.7" rel="section" title="8.7 SSL Infrastructure">
<link href="ch-sec-tools.en.html#s8.8" rel="section" title="8.8 Antivirus tools">
<link href="ch-sec-tools.en.html#s-gpg-agent" rel="section" title="8.9 GPG agent">
<link href="ch9.en.html#s-bpp-devel-design" rel="section" title="9.1 Best practices for security review and design">
<link href="ch9.en.html#s-bpp-lower-privs" rel="section" title="9.2 Creating users and groups for software daemons">
<link href="ch10.en.html#s-keep-secure" rel="section" title="10.1 Keep your system secure">
<link href="ch10.en.html#s-periodic-integrity" rel="section" title="10.2 Do periodic integrity checks">
<link href="ch10.en.html#s-intrusion-detect" rel="section" title="10.3 Set up Intrusion Detection">
<link href="ch10.en.html#s10.4" rel="section" title="10.4 Avoiding root-kits">
<link href="ch10.en.html#s10.5" rel="section" title="10.5 Genius/Paranoia Ideas &mdash; what you could do">
<link href="ch-after-compromise.en.html#s11.1" rel="section" title="11.1 General behavior">
<link href="ch-after-compromise.en.html#s11.2" rel="section" title="11.2 Backing up the system">
<link href="ch-after-compromise.en.html#s11.3" rel="section" title="11.3 Contact your local CERT">
<link href="ch-after-compromise.en.html#s11.4" rel="section" title="11.4 Forensic analysis">
<link href="ch12.en.html#s12.1" rel="section" title="12.1 Security in the Debian operating system">
<link href="ch12.en.html#s-vulnerable-system" rel="section" title="12.2 My system is vulnerable! (Are you sure?)">
<link href="ch12.en.html#s-debian-sec-team-faq" rel="section" title="12.3 Questions regarding the Debian security team">
<link href="ap-bridge-fw.en.html#sD.1" rel="section" title="D.1 A bridge providing NAT and firewall capabilities">
<link href="ap-bridge-fw.en.html#sD.2" rel="section" title="D.2 A bridge providing firewall capabilities">
<link href="ap-bridge-fw.en.html#sD.3" rel="section" title="D.3 Basic IPtables rules">
<link href="ap-chroot-ssh-env.en.html#sG.1" rel="section" title="G.1 Chrooting the ssh users">
<link href="ap-chroot-ssh-env.en.html#sG.2" rel="section" title="G.2 Chrooting the ssh server">
<link href="ap-chroot-apache-env.en.html#sH.1" rel="section" title="H.1 Introduction">
<link href="ap-chroot-apache-env.en.html#sH.2" rel="section" title="H.2 Installing the server">
<link href="ap-chroot-apache-env.en.html#sH.3" rel="section" title="H.3 See also">
<link href="ch1.en.html#s1.6.1" rel="subsection" title="1.6.1 Version 3.16 (March 2011)">
<link href="ch1.en.html#s1.6.2" rel="subsection" title="1.6.2 Version 3.15 (December 2010)">
<link href="ch1.en.html#s1.6.3" rel="subsection" title="1.6.3 Version 3.14 (March 2009)">
<link href="ch1.en.html#s1.6.4" rel="subsection" title="1.6.4 Version 3.13 (Februrary 2008)">
<link href="ch1.en.html#s1.6.5" rel="subsection" title="1.6.5 Version 3.12 (August 2007)">
<link href="ch1.en.html#s1.6.6" rel="subsection" title="1.6.6 Version 3.11 (January 2007)">
<link href="ch1.en.html#s1.6.7" rel="subsection" title="1.6.7 Version 3.10 (November 2006)">
<link href="ch1.en.html#s1.6.8" rel="subsection" title="1.6.8 Version 3.9 (October 2006)">
<link href="ch1.en.html#s1.6.9" rel="subsection" title="1.6.9 Version 3.8 (July 2006)">
<link href="ch1.en.html#s1.6.10" rel="subsection" title="1.6.10 Version 3.7 (April 2006)">
<link href="ch1.en.html#s1.6.11" rel="subsection" title="1.6.11 Version 3.6 (March 2006)">
<link href="ch1.en.html#s1.6.12" rel="subsection" title="1.6.12 Version 3.5 (November 2005)">
<link href="ch1.en.html#s1.6.13" rel="subsection" title="1.6.13 Version 3.4 (August-September 2005)">
<link href="ch1.en.html#s1.6.14" rel="subsection" title="1.6.14 Version 3.3 (June 2005)">
<link href="ch1.en.html#s1.6.15" rel="subsection" title="1.6.15 Version 3.2 (March 2005)">
<link href="ch1.en.html#s1.6.16" rel="subsection" title="1.6.16 Version 3.1 (January 2005)">
<link href="ch1.en.html#s1.6.17" rel="subsection" title="1.6.17 Version 3.0 (December 2004)">
<link href="ch1.en.html#s1.6.18" rel="subsection" title="1.6.18 Version 2.99 (March 2004)">
<link href="ch1.en.html#s1.6.19" rel="subsection" title="1.6.19 Version 2.98 (December 2003)">
<link href="ch1.en.html#s1.6.20" rel="subsection" title="1.6.20 Version 2.97 (September 2003)">
<link href="ch1.en.html#s1.6.21" rel="subsection" title="1.6.21 Version 2.96 (August 2003)">
<link href="ch1.en.html#s1.6.22" rel="subsection" title="1.6.22 Version 2.95 (June 2003)">
<link href="ch1.en.html#s1.6.23" rel="subsection" title="1.6.23 Version 2.94 (April 2003)">
<link href="ch1.en.html#s1.6.24" rel="subsection" title="1.6.24 Version 2.93 (March 2003)">
<link href="ch1.en.html#s1.6.25" rel="subsection" title="1.6.25 Version 2.92 (February 2003)">
<link href="ch1.en.html#s1.6.26" rel="subsection" title="1.6.26 Version 2.91 (January/February 2003)">
<link href="ch1.en.html#s1.6.27" rel="subsection" title="1.6.27 Version 2.9 (December 2002)">
<link href="ch1.en.html#s1.6.28" rel="subsection" title="1.6.28 Version 2.8 (November 2002)">
<link href="ch1.en.html#s1.6.29" rel="subsection" title="1.6.29 Version 2.7 (October 2002)">
<link href="ch1.en.html#s1.6.30" rel="subsection" title="1.6.30 Version 2.6 (September 2002)">
<link href="ch1.en.html#s1.6.31" rel="subsection" title="1.6.31 Version 2.5 (September 2002)">
<link href="ch1.en.html#s1.6.32" rel="subsection" title="1.6.32 Version 2.5 (August 2002)">
<link href="ch1.en.html#s1.6.33" rel="subsection" title="1.6.33 Version 2.4">
<link href="ch1.en.html#s1.6.34" rel="subsection" title="1.6.34 Version 2.3">
<link href="ch1.en.html#s1.6.35" rel="subsection" title="1.6.35 Version 2.3">
<link href="ch1.en.html#s1.6.36" rel="subsection" title="1.6.36 Version 2.2">
<link href="ch1.en.html#s1.6.37" rel="subsection" title="1.6.37 Version 2.1">
<link href="ch1.en.html#s1.6.38" rel="subsection" title="1.6.38 Version 2.0">
<link href="ch1.en.html#s1.6.39" rel="subsection" title="1.6.39 Version 1.99">
<link href="ch1.en.html#s1.6.40" rel="subsection" title="1.6.40 Version 1.98">
<link href="ch1.en.html#s1.6.41" rel="subsection" title="1.6.41 Version 1.97">
<link href="ch1.en.html#s1.6.42" rel="subsection" title="1.6.42 Version 1.96">
<link href="ch1.en.html#s1.6.43" rel="subsection" title="1.6.43 Version 1.95">
<link href="ch1.en.html#s1.6.44" rel="subsection" title="1.6.44 Version 1.94">
<link href="ch1.en.html#s1.6.45" rel="subsection" title="1.6.45 Version 1.93">
<link href="ch1.en.html#s1.6.46" rel="subsection" title="1.6.46 Version 1.92">
<link href="ch1.en.html#s1.6.47" rel="subsection" title="1.6.47 Version 1.91">
<link href="ch1.en.html#s1.6.48" rel="subsection" title="1.6.48 Version 1.9">
<link href="ch1.en.html#s1.6.49" rel="subsection" title="1.6.49 Version 1.8">
<link href="ch1.en.html#s1.6.50" rel="subsection" title="1.6.50 Version 1.7">
<link href="ch1.en.html#s1.6.51" rel="subsection" title="1.6.51 Version 1.6">
<link href="ch1.en.html#s1.6.52" rel="subsection" title="1.6.52 Version 1.5">
<link href="ch1.en.html#s1.6.53" rel="subsection" title="1.6.53 Version 1.4">
<link href="ch1.en.html#s1.6.54" rel="subsection" title="1.6.54 Version 1.3">
<link href="ch1.en.html#s1.6.55" rel="subsection" title="1.6.55 Version 1.2">
<link href="ch1.en.html#s1.6.56" rel="subsection" title="1.6.56 Version 1.1">
<link href="ch1.en.html#s1.6.57" rel="subsection" title="1.6.57 Version 1.0">
<link href="ch3.en.html#s3.2.1" rel="subsection" title="3.2.1 Choose an intelligent partition scheme">
<link href="ch3.en.html#s3.2.1.1" rel="subsection" title="3.2.1.1 Selecting the appropriate file systems">
<link href="ch3.en.html#s-disableserv" rel="subsection" title="3.6.1 Disabling daemon services">
<link href="ch3.en.html#s-inetd" rel="subsection" title="3.6.2 Disabling <code>inetd</code> or its services">
<link href="ch3.en.html#s3.7.1" rel="subsection" title="3.7.1 Removing Perl">
<link href="ch4.en.html#s-lib-security-update" rel="subsection" title="4.2.1 Security update of libraries">
<link href="ch4.en.html#s-kernel-security-update" rel="subsection" title="4.2.2 Security update of the kernel">
<link href="ch4.en.html#s4.9.1" rel="subsection" title="4.9.1 Setting <code>/tmp</code> noexec">
<link href="ch4.en.html#s4.9.2" rel="subsection" title="4.9.2 Setting /usr read-only">
<link href="ch4.en.html#s-auth-pam" rel="subsection" title="4.10.1 User authentication: PAM">
<link href="ch4.en.html#s-user-limits" rel="subsection" title="4.10.2 Limiting resource usage: the <code>limits.conf</code> file">
<link href="ch4.en.html#s4.10.3" rel="subsection" title="4.10.3 User login actions: edit <code>/etc/login.defs</code>">
<link href="ch4.en.html#s4.10.4" rel="subsection" title="4.10.4 Restricting ftp: editing <code>/etc/ftpusers</code>">
<link href="ch4.en.html#s4.10.5" rel="subsection" title="4.10.5 Using su">
<link href="ch4.en.html#s4.10.6" rel="subsection" title="4.10.6 Using sudo">
<link href="ch4.en.html#s4.10.7" rel="subsection" title="4.10.7 Disallow remote administrative access">
<link href="ch4.en.html#s-user-restrict" rel="subsection" title="4.10.8 Restricting users's access">
<link href="ch4.en.html#s4.10.9" rel="subsection" title="4.10.9 User auditing">
<link href="ch4.en.html#s4.10.9.1" rel="subsection" title="4.10.9.1 Input and output audit with script">
<link href="ch4.en.html#s4.10.9.2" rel="subsection" title="4.10.9.2 Using the shell history file">
<link href="ch4.en.html#s4.10.9.3" rel="subsection" title="4.10.9.3 Complete user audit with accounting utilities">
<link href="ch4.en.html#s4.10.9.4" rel="subsection" title="4.10.9.4 Other user auditing methods">
<link href="ch4.en.html#s4.10.10" rel="subsection" title="4.10.10 Reviewing user profiles">
<link href="ch4.en.html#s4.10.11" rel="subsection" title="4.10.11 Setting users umasks">
<link href="ch4.en.html#s4.10.12" rel="subsection" title="4.10.12 Limiting what users can see/access">
<link href="ch4.en.html#s-limit-user-perm" rel="subsection" title="4.10.12.1 Limiting access to other user's information">
<link href="ch4.en.html#s-user-pwgen" rel="subsection" title="4.10.13 Generating user passwords">
<link href="ch4.en.html#s4.10.14" rel="subsection" title="4.10.14 Checking user passwords">
<link href="ch4.en.html#s-idle-logoff" rel="subsection" title="4.10.15 Logging off idle users">
<link href="ch4.en.html#s-custom-logcheck" rel="subsection" title="4.12.1 Using and customizing <code>logcheck</code>">
<link href="ch4.en.html#s4.12.2" rel="subsection" title="4.12.2 Configuring where alerts are sent">
<link href="ch4.en.html#s4.12.3" rel="subsection" title="4.12.3 Using a loghost">
<link href="ch4.en.html#s4.12.4" rel="subsection" title="4.12.4 Log file permissions">
<link href="ch4.en.html#s4.14.1" rel="subsection" title="4.14.1 Kernel patch protection for buffer overflows">
<link href="ch4.en.html#s4.14.2" rel="subsection" title="4.14.2 Testing programs for overflows">
<link href="ch4.en.html#s4.16.1" rel="subsection" title="4.16.1 Using quotas">
<link href="ch4.en.html#s-ext2attr" rel="subsection" title="4.16.2 The ext2 filesystem specific attributes (chattr/lsattr)">
<link href="ch4.en.html#s-check-integ" rel="subsection" title="4.16.3 Checking file system integrity">
<link href="ch4.en.html#s4.16.4" rel="subsection" title="4.16.4 Setting up setuid check">
<link href="ch4.en.html#s-kernel-conf" rel="subsection" title="4.17.1 Configuring kernel network features">
<link href="ch4.en.html#s-tcp-syncookies" rel="subsection" title="4.17.2 Configuring syncookies">
<link href="ch4.en.html#s-net-harden" rel="subsection" title="4.17.3 Securing the network on boot-time">
<link href="ch4.en.html#s-kernel-fw" rel="subsection" title="4.17.4 Configuring firewall features">
<link href="ch4.en.html#s-limit-bindaddr" rel="subsection" title="4.17.5 Disabling weak-end hosts issues">
<link href="ch4.en.html#s4.17.6" rel="subsection" title="4.17.6 Protecting against ARP attacks">
<link href="ch4.en.html#s4.19.1" rel="subsection" title="4.19.1 Do not use software depending on svgalib">
<link href="ch-sec-services.en.html#s-ssh-chroot" rel="subsection" title="5.1.1 Chrooting ssh">
<link href="ch-sec-services.en.html#s5.1.2" rel="subsection" title="5.1.2 Ssh clients">
<link href="ch-sec-services.en.html#s5.1.3" rel="subsection" title="5.1.3 Disallowing file transfers">
<link href="ch-sec-services.en.html#s-ssh-only-file" rel="subsection" title="5.1.4 Restricing access to file transfer only">
<link href="ch-sec-services.en.html#s5.4.1" rel="subsection" title="5.4.1 Check your display manager">
<link href="ch-sec-services.en.html#s5.6.1" rel="subsection" title="5.6.1 Configuring a Nullmailer">
<link href="ch-sec-services.en.html#s5.6.2" rel="subsection" title="5.6.2 Providing secure access to mailboxes">
<link href="ch-sec-services.en.html#s5.6.3" rel="subsection" title="5.6.3 Receiving mail securely">
<link href="ch-sec-services.en.html#s-configure-bind" rel="subsection" title="5.7.1 Bind configuration to avoid misuse">
<link href="ch-sec-services.en.html#s-user-bind" rel="subsection" title="5.7.2 Changing BIND's user">
<link href="ch-sec-services.en.html#s-chroot-bind" rel="subsection" title="5.7.3 Chrooting the name server">
<link href="ch-sec-services.en.html#s5.8.1" rel="subsection" title="5.8.1 Disabling users from publishing web contents">
<link href="ch-sec-services.en.html#s5.8.2" rel="subsection" title="5.8.2 Logfiles permissions">
<link href="ch-sec-services.en.html#s5.8.3" rel="subsection" title="5.8.3 Published web files">
<link href="ch-sec-services.en.html#s-auto-chroot" rel="subsection" title="5.10.1 Making chrooted environments automatically">
<link href="ch-sec-services.en.html#s5.13.1" rel="subsection" title="5.13.1 Disabling RPC services completely">
<link href="ch-sec-services.en.html#s5.13.2" rel="subsection" title="5.13.2 Limiting access to RPC services">
<link href="ch-sec-services.en.html#s5.14.1" rel="subsection" title="5.14.1 Firewalling the local system">
<link href="ch-sec-services.en.html#s5.14.2" rel="subsection" title="5.14.2 Using a firewall to protect other systems">
<link href="ch-sec-services.en.html#s5.14.3" rel="subsection" title="5.14.3 Setting up a firewall">
<link href="ch-sec-services.en.html#s-firewall-pack" rel="subsection" title="5.14.3.1 Using firewall packages">
<link href="ch-sec-services.en.html#s5.14.3.2" rel="subsection" title="5.14.3.2 Manual init.d configuration">
<link href="ch-sec-services.en.html#s5.14.3.3" rel="subsection" title="5.14.3.3 Configuring firewall rules through <code>ifup</code>">
<link href="ch-sec-services.en.html#s5.14.3.4" rel="subsection" title="5.14.3.4 Testing your firewall configuration">
<link href="ch7.en.html#s-crossreference" rel="subsection" title="7.2.1 Vulnerability cross references">
<link href="ch7.en.html#s-cve-compatible" rel="subsection" title="7.2.2 CVE compatibility">
<link href="ch7.en.html#s7.4.1" rel="subsection" title="7.4.1 Developer's guide to security updates">
<link href="ch7.en.html#s7.5.1" rel="subsection" title="7.5.1 The current scheme for package signature checks">
<link href="ch7.en.html#s-apt-0.6" rel="subsection" title="7.5.2 Secure apt">
<link href="ch7.en.html#s-check-releases" rel="subsection" title="7.5.3 Per distribution release check">
<link href="ch7.en.html#s7.5.3.1" rel="subsection" title="7.5.3.1 Basic concepts">
<link href="ch7.en.html#s7.5.3.2" rel="subsection" title="7.5.3.2 <code>Release</code> checksums">
<link href="ch7.en.html#s7.5.3.3" rel="subsection" title="7.5.3.3 Verification of the <code>Release</code> file">
<link href="ch7.en.html#s7.5.3.4" rel="subsection" title="7.5.3.4 Check of <code>Release.gpg</code> by <code>apt</code>">
<link href="ch7.en.html#s7.5.3.5" rel="subsection" title="7.5.3.5 How to tell apt what to trust">
<link href="ch7.en.html#s7.5.3.6" rel="subsection" title="7.5.3.6 Finding the key for a repository">
<link href="ch7.en.html#s-secure-apt-add-key" rel="subsection" title="7.5.3.7 Safely adding a key">
<link href="ch7.en.html#s7.5.3.8" rel="subsection" title="7.5.3.8 Verifying key integrity">
<link href="ch7.en.html#s7.5.3.9" rel="subsection" title="7.5.3.9 Debian archive key yearly rotation">
<link href="ch7.en.html#s7.5.3.10" rel="subsection" title="7.5.3.10 Known release checking problems">
<link href="ch7.en.html#s-manual-check-releases" rel="subsection" title="7.5.3.11 Manual per distribution release check">
<link href="ch7.en.html#s-check-non-debian-releases" rel="subsection" title="7.5.4 Release check of non Debian sources">
<link href="ch7.en.html#s-check-pkg-sign" rel="subsection" title="7.5.5 Alternative per-package signing scheme">
<link href="ch-sec-tools.en.html#s8.5.1" rel="subsection" title="8.5.1 Point to Point tunneling">
<link href="ch10.en.html#s-track-vulns" rel="subsection" title="10.1.1 Tracking security vulnerabilities">
<link href="ch10.en.html#s-keep-up-to-date" rel="subsection" title="10.1.2 Continuously update the system">
<link href="ch10.en.html#s10.1.2.1" rel="subsection" title="10.1.2.1 Manually checking which security updates are available">
<link href="ch10.en.html#s-update-desktop" rel="subsection" title="10.1.2.2 Checking for updates at the Desktop">
<link href="ch10.en.html#s-cron-apt" rel="subsection" title="10.1.2.3 Automatically checking for updates with cron-apt">
<link href="ch10.en.html#s-debsecan" rel="subsection" title="10.1.2.4 Automatically checking for security issues with debsecan">
<link href="ch10.en.html#s10.1.2.5" rel="subsection" title="10.1.2.5 Other methods for security updates">
<link href="ch10.en.html#s10.1.3" rel="subsection" title="10.1.3 Avoid using the unstable branch">
<link href="ch10.en.html#s-security-support-testing" rel="subsection" title="10.1.4 Security support for the testing branch">
<link href="ch10.en.html#s10.1.5" rel="subsection" title="10.1.5 Automatic updates in a Debian GNU/Linux system">
<link href="ch10.en.html#s10.3.1" rel="subsection" title="10.3.1 Network based intrusion detection">
<link href="ch10.en.html#s10.3.2" rel="subsection" title="10.3.2 Host based intrusion detection">
<link href="ch10.en.html#s-LKM" rel="subsection" title="10.4.1 Loadable Kernel Modules (LKM)">
<link href="ch10.en.html#s10.4.2" rel="subsection" title="10.4.2 Detecting root-kits">
<link href="ch10.en.html#s-proactive" rel="subsection" title="10.4.2.1 Proactive defense">
<link href="ch10.en.html#s10.4.2.2" rel="subsection" title="10.4.2.2 Reactive defense">
<link href="ch10.en.html#s10.5.1" rel="subsection" title="10.5.1 Building a honeypot">
<link href="ch-after-compromise.en.html#s11.4.1" rel="subsection" title="11.4.1 Analysis of malware">
<link href="ch12.en.html#s12.1.1" rel="subsection" title="12.1.1 Is Debian more secure than X?">
<link href="ch12.en.html#s12.1.1.1" rel="subsection" title="12.1.1.1 Is Debian more secure than other Linux distributions (such as Red Hat, SuSE...)?">
<link href="ch12.en.html#s12.1.2" rel="subsection" title="12.1.2 There are many Debian bugs in Bugtraq. Does this mean that it is very vulnerable?">
<link href="ch12.en.html#s12.1.3" rel="subsection" title="12.1.3 Does Debian have any certification related to security?">
<link href="ch12.en.html#s12.1.4" rel="subsection" title="12.1.4 Are there any hardening programs for Debian?">
<link href="ch12.en.html#s12.1.5" rel="subsection" title="12.1.5 I want to run XYZ service, which one should I choose?">
<link href="ch12.en.html#s12.1.6" rel="subsection" title="12.1.6 How can I make service XYZ more secure in Debian?">
<link href="ch12.en.html#s12.1.7" rel="subsection" title="12.1.7 How can I remove all the banners for services?">
<link href="ch12.en.html#s12.1.8" rel="subsection" title="12.1.8 Are all Debian packages safe?">
<link href="ch12.en.html#s12.1.9" rel="subsection" title="12.1.9 Why are some log files/configuration files world-readable, isn't this insecure?">
<link href="ch12.en.html#s12.1.10" rel="subsection" title="12.1.10 Why does /root/ (or UserX) have 755 permissions?">
<link href="ch12.en.html#s12.1.11" rel="subsection" title="12.1.11 After installing a grsec/firewall, I started receiving many console messages! How do I remove them?">
<link href="ch12.en.html#s-faq-os-users" rel="subsection" title="12.1.12 Operating system users and groups">
<link href="ch12.en.html#s12.1.12.1" rel="subsection" title="12.1.12.1 Are all system users necessary?">
<link href="ch12.en.html#s12.1.12.2" rel="subsection" title="12.1.12.2 I removed a system user! How can I recover?">
<link href="ch12.en.html#s12.1.12.3" rel="subsection" title="12.1.12.3 What is the difference between the adm and the staff group?">
<link href="ch12.en.html#s12.1.13" rel="subsection" title="12.1.13 Why is there a new group when I add a new user? (or Why does Debian give each user one group?)">
<link href="ch12.en.html#s12.1.14" rel="subsection" title="12.1.14 Questions regarding services and open ports">
<link href="ch12.en.html#s12.1.14.1" rel="subsection" title="12.1.14.1 Why are all services activated upon installation?">
<link href="ch12.en.html#s12.1.14.2" rel="subsection" title="12.1.14.2 Can I remove <code>inetd</code>?">
<link href="ch12.en.html#s12.1.14.3" rel="subsection" title="12.1.14.3 Why do I have port 111 open?">
<link href="ch12.en.html#s12.1.14.4" rel="subsection" title="12.1.14.4 What use is <code>identd</code> (port 113) for?">
<link href="ch12.en.html#s12.1.14.5" rel="subsection" title="12.1.14.5 I have services using port 1 and 6, what are they and how can I remove them?">
<link href="ch12.en.html#s12.1.14.6" rel="subsection" title="12.1.14.6 I found the port XYZ open, can I close it?">
<link href="ch12.en.html#s12.1.14.7" rel="subsection" title="12.1.14.7 Will removing services from <code>/etc/services</code> help secure my box?">
<link href="ch12.en.html#s12.1.15" rel="subsection" title="12.1.15 Common security issues">
<link href="ch12.en.html#s12.1.15.1" rel="subsection" title="12.1.15.1 I have lost my password and cannot access the system!">
<link href="ch12.en.html#s12.1.16" rel="subsection" title="12.1.16 How do I accomplish setting up a service for my users without giving out shell accounts?">
<link href="ch12.en.html#s-vulnasses-false-positive" rel="subsection" title="12.2.1 Vulnerability assessment scanner X says my Debian system is vulnerable!">
<link href="ch12.en.html#s12.2.2" rel="subsection" title="12.2.2 I've seen an attack in my system's logs. Is my system compromised?">
<link href="ch12.en.html#s12.2.3" rel="subsection" title="12.2.3 I have found strange 'MARK' lines in my logs: Am I compromised?">
<link href="ch12.en.html#s12.2.4" rel="subsection" title="12.2.4 I found users using 'su' in my logs: Am I compromised?">
<link href="ch12.en.html#s12.2.5" rel="subsection" title="12.2.5 I have found 'possible SYN flooding' in my logs: Am I under attack?">
<link href="ch12.en.html#s12.2.6" rel="subsection" title="12.2.6 I have found strange root sessions in my logs: Am I compromised?">
<link href="ch12.en.html#s12.2.7" rel="subsection" title="12.2.7 I have suffered a break-in, what do I do?">
<link href="ch12.en.html#s12.2.8" rel="subsection" title="12.2.8 How can I trace an attack?">
<link href="ch12.en.html#s12.2.9" rel="subsection" title="12.2.9 Program X in Debian is vulnerable, what do I do?">
<link href="ch12.en.html#s-version-backport" rel="subsection" title="12.2.10 The version number for a package indicates that I am still running a vulnerable version!">
<link href="ch12.en.html#s12.2.11" rel="subsection" title="12.2.11 Specific software">
<link href="ch12.en.html#s12.2.11.1" rel="subsection" title="12.2.11.1 <code>proftpd</code> is vulnerable to a Denial of Service attack.">
<link href="ch12.en.html#s12.2.11.2" rel="subsection" title="12.2.11.2 After installing <code>portsentry</code>, there are a lot of ports open.">
<link href="ch12.en.html#s12.3.1" rel="subsection" title="12.3.1 What is a Debian Security Advisory (DSA)?">
<link href="ch12.en.html#s12.3.2" rel="subsection" title="12.3.2 The signature on Debian advisories does not verify correctly!">
<link href="ch12.en.html#s12.3.3" rel="subsection" title="12.3.3 How is security handled in Debian?">
<link href="ch12.en.html#s12.3.4" rel="subsection" title="12.3.4 Why are you fiddling with an old version of that package?">
<link href="ch12.en.html#s12.3.5" rel="subsection" title="12.3.5 What is the policy for a fixed package to appear in security.debian.org?">
<link href="ch12.en.html#s12.3.6" rel="subsection" title="12.3.6 What does &quot;local (remote)&quot; mean?">
<link href="ch12.en.html#s12.3.7" rel="subsection" title="12.3.7 The version number for a package indicates that I am still running a vulnerable version!">
<link href="ch12.en.html#s-sec-unstable" rel="subsection" title="12.3.8 How is security handled for <samp>testing</samp> and <samp>unstable</samp>?">
<link href="ch12.en.html#s-sec-older" rel="subsection" title="12.3.9 I use an older version of Debian, is it supported by the Debian Security Team?">
<link href="ch12.en.html#s12.3.10" rel="subsection" title="12.3.10 How does <em>testing</em> get security updates?">
<link href="ch12.en.html#s12.3.11" rel="subsection" title="12.3.11 How is security handled for contrib and non-free?">
<link href="ch12.en.html#s12.3.12" rel="subsection" title="12.3.12 Why are there no official mirrors for security.debian.org?">
<link href="ch12.en.html#s12.3.13" rel="subsection" title="12.3.13 I've seen DSA 100 and DSA 102, now where is DSA 101?">
<link href="ch12.en.html#s12.3.14" rel="subsection" title="12.3.14 I tried to download a package listed in one of the security advisories, but I got a `file not found' error.">
<link href="ch12.en.html#s12.3.15" rel="subsection" title="12.3.15 How can I reach the security team?">
<link href="ch12.en.html#s12.3.16" rel="subsection" title="12.3.16 What difference is there between security@debian.org and debian-security@lists.debian.org?">
<link href="ch12.en.html#s12.3.17" rel="subsection" title="12.3.17 I guess I found a security problem, what should I do?">
<link href="ch12.en.html#s12.3.18" rel="subsection" title="12.3.18 How can I contribute to the Debian security team?">
<link href="ch12.en.html#s12.3.19" rel="subsection" title="12.3.19 Who is the Security Team composed of?">
<link href="ch12.en.html#s12.3.20" rel="subsection" title="12.3.20 Does the Debian Security team check every new package in Debian?">
<link href="ch12.en.html#s12.3.21" rel="subsection" title="12.3.21 How much time will it take Debian to fix vulnerability XXXX?">
<link href="ch12.en.html#s12.3.22" rel="subsection" title="12.3.22 How long will security updates be provided?">
<link href="ch12.en.html#s12.3.23" rel="subsection" title="12.3.23 How can I check the integrity of packages?">
<link href="ch12.en.html#s12.3.24" rel="subsection" title="12.3.24 What to do if a random package breaks after a security update?">
<link href="ap-chroot-ssh-env.en.html#sG.1.1" rel="subsection" title="G.1.1 Using <code>libpam-chroot</code>">
<link href="ap-chroot-ssh-env.en.html#sG.1.2" rel="subsection" title="G.1.2 Patching the <code>ssh</code> server">
<link href="ap-chroot-ssh-env.en.html#sG.2.1" rel="subsection" title="G.2.1 Setup a minimal system (the really easy way)">
<link href="ap-chroot-ssh-env.en.html#sG.2.2" rel="subsection" title="G.2.2 Automatically making the environment (the easy way)">
<link href="ap-chroot-ssh-env.en.html#sG.2.3" rel="subsection" title="G.2.3 Manually creating the environment (the hard way)">
<link href="ap-chroot-apache-env.en.html#sH.1.1" rel="subsection" title="H.1.1 Licensing">

</head>

<body>

<p><a name="ch-sec-services"></a></p>
<hr>

<p>
[ <a href="ch4.en.html">previous</a> ]
[ <a href="index.en.html#contents">Contents</a> ]
[ <a href="ch1.en.html">1</a> ]
[ <a href="ch2.en.html">2</a> ]
[ <a href="ch3.en.html">3</a> ]
[ <a href="ch4.en.html">4</a> ]
[ 5 ]
[ <a href="ch-automatic-harden.en.html">6</a> ]
[ <a href="ch7.en.html">7</a> ]
[ <a href="ch-sec-tools.en.html">8</a> ]
[ <a href="ch9.en.html">9</a> ]
[ <a href="ch10.en.html">10</a> ]
[ <a href="ch-after-compromise.en.html">11</a> ]
[ <a href="ch12.en.html">12</a> ]
[ <a href="ap-harden-step.en.html">A</a> ]
[ <a href="ap-checklist.en.html">B</a> ]
[ <a href="ap-snort-box.en.html">C</a> ]
[ <a href="ap-bridge-fw.en.html">D</a> ]
[ <a href="ap-bind-chuser.en.html">E</a> ]
[ <a href="ap-fw-security-update.en.html">F</a> ]
[ <a href="ap-chroot-ssh-env.en.html">G</a> ]
[ <a href="ap-chroot-apache-env.en.html">H</a> ]
[ <a href="ch-automatic-harden.en.html">next</a> ]
</p>

<hr>

<h1>
Securing Debian Manual
<br>Chapter 5 - Securing services running on your system
</h1>

<hr>

<p>
Services can be secured in a running system in two ways:
</p>
<ul>
<li>
<p>
Making them only accessible at the access points (interfaces) they need to be
in.
</p>
</li>
</ul>
<ul>
<li>
<p>
Configuring them properly so that they can only be used by legitimate users in
an authorized manner.
</p>
</li>
</ul>

<p>
Restricting services so that they can only be accessed from a given place can
be done by restricting access to them at the kernel (i.e.  firewall) level,
configure them to listen only on a given interface (some services might not
provide this feature) or using some other methods, for example the Linux
vserver patch (for 2.4.16) can be used to force processes to use only one
interface.
</p>

<p>
Regarding the services running from <code>inetd</code> (<code>telnet</code>,
<code>ftp</code>, <code>finger</code>, <code>pop3</code>...) it is worth noting
that <code>inetd</code> can be configured so that services only listen on a
given interface (using <samp>service@ip</samp> syntax) but that's an
undocumented feature.  One of its substitutes, the <code>xinetd</code>
meta-daemon includes a <samp>bind</samp> option just for this matter.  See
<code>xinetd.conf(5)</code>.
</p>

<pre>
     service nntp
     {
             socket_type     = stream
             protocol        = tcp
             wait            = no
             user            = news
             group           = news
             server          = /usr/bin/env
             server_args     = POSTING_OK=1 PATH=/usr/sbin/:/usr/bin:/sbin/:/bin
     +/usr/sbin/snntpd logger -p news.info
             bind            = 127.0.0.1
     }
</pre>

<p>
The following sections detail how specific individual services can be
configured properly depending on their intended use.
</p>

<hr>

<h2><a name="s5.1"></a>5.1 Securing ssh</h2>

<p>
If you are still running telnet instead of ssh, you should take a break from
this manual and change this.  Ssh should be used for all remote logins instead
of telnet.  In an age where it is easy to sniff Internet traffic and get
clear-text passwords, you should use only protocols which use cryptography.
So, perform an <samp>apt-get install ssh</samp> on your system now.
</p>

<p>
Encourage all the users on your system to use ssh instead of telnet, or even
better, uninstall telnet/telnetd.  In addition you should avoid logging into
the system using ssh as root and use alternative methods to become root
instead, like <code>su</code> or <code>sudo</code>.  Finally, the
<code>sshd_config</code> file, in <code>/etc/ssh</code>, should be modified to
increase security as well:
</p>
<ul>
<li>
<p>
<samp>ListenAddress 192.168.0.1</samp>
</p>

<p>
Have ssh listen only on a given interface, just in case you have more than one
(and do not want ssh available on it) or in the future add a new network card
(and don't want ssh connections from it).
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>PermitRootLogin no</samp>
</p>

<p>
Try not to permit Root Login wherever possible.  If anyone wants to become root
via ssh, now two logins are needed and the root password cannot be brute forced
via SSH.
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>Port 666</samp> or <samp>ListenAddress 192.168.0.1:666</samp>
</p>

<p>
Change the listen port, so the intruder cannot be completely sure whether a
sshd daemon runs (be forewarned, this is security by obscurity).
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>PermitEmptyPasswords no</samp>
</p>

<p>
Empty passwords make a mockery of system security.
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>AllowUsers alex ref me@somewhere</samp>
</p>

<p>
Allow only certain users to have access via ssh to this machine.
<samp>user@host</samp> can also be used to restrict a given user from accessing
only at a given host.
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>AllowGroups wheel admin</samp>
</p>

<p>
Allow only certain group members to have access via ssh to this machine.
AllowGroups and AllowUsers have equivalent directives for denying access to a
machine.  Not surprisingly they are called &quot;DenyUsers&quot; and
&quot;DenyGroups&quot;.
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>PasswordAuthentication yes</samp>
</p>

<p>
It is completely your choice what you want to do.  It is more secure to only
allow access to the machine from users with ssh-keys placed in the
<code>~/.ssh/authorized_keys</code> file.  If you want so, set this one to
&quot;no&quot;.
</p>
</li>
</ul>
<ul>
<li>
<p>
Disable any form of authentication you do not really need, if you do not use,
for example <samp>RhostsRSAAuthentication</samp>,
<samp>HostbasedAuthentication</samp>, <samp>KerberosAuthentication</samp> or
<samp>RhostsAuthentication</samp> you should disable them, even if they are
already by default (see the manpage <code>sshd_config(5)</code>).
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>Protocol 2</samp>
</p>

<p>
Disable the protocol version 1, since it has some design flaws that make it
easier to crack passwords.  For more information read <code><a
href="http://earthops.net/ssh-timing.pdf">a paper regarding ssh protocol
problems</a></code> or the <code><a
href="http://xforce.iss.net/static/6449.php">Xforce advisory</a></code>.
</p>
</li>
</ul>
<ul>
<li>
<p>
<samp>Banner <code>/etc/<var>some_file</var></code></samp>
</p>

<p>
Add a banner (it will be retrieved from the file) to users connecting to the
ssh server.  In some countries sending a warning before access to a given
system about unauthorized access or user monitoring should be added to have
legal protection.
</p>
</li>
</ul>

<p>
You can also restrict access to the ssh server using <samp>pam_listfile</samp>
or <samp>pam_wheel</samp> in the PAM control file.  For example, you could keep
anyone not listed in <code>/etc/loginusers</code> away by adding this line to
<code>/etc/pam.d/ssh</code>:
</p>

<pre>
     auth       required     pam_listfile.so sense=allow onerr=fail item=user file=/etc/loginusers
</pre>

<p>
As a final note, be aware that these directives are from a OpenSSH
configuration file.  Right now, there are three commonly used SSH daemons,
ssh1, ssh2, and OpenSSH by the OpenBSD people.  Ssh1 was the first ssh daemon
available and it is still the most commonly used (there are rumors that there
is even a Windows port).  Ssh2 has many advantages over ssh1 except it is
released under a closed-source license.  OpenSSH is completely free ssh daemon,
which supports both ssh1 and ssh2.  OpenSSH is the version installed on Debian
when the package <code>ssh</code> is chosen.
</p>

<p>
You can read more information on how to set up SSH with PAM support in the
<code><a
href="http://lists.debian.org/debian-security/2001/debian-security-200111/msg00395.html">security
mailing list archives</a></code>.
</p>

<hr>

<h3><a name="s-ssh-chroot"></a>5.1.1 Chrooting ssh</h3>

<p>
Currently OpenSSH does not provide a way to chroot automatically users upon
connection (the commercial version does provide this functionality).  However
there is a project to provide this functionality for OpenSSH too, see <code><a
href="http://chrootssh.sourceforge.net">http://chrootssh.sourceforge.net</a></code>,
it is not currently packaged for Debian, though.  You could use, however, the
<code>pam_chroot</code> module as described in <a
href="ch4.en.html#s-user-restrict">Restricting users's access, Section
4.10.8</a>.
</p>

<p>
In <a href="ap-chroot-ssh-env.en.html"><code>Chroot</code> environment for
<code>SSH</code>, Appendix G</a> you can find several options to make a chroot
environment for SSH.
</p>

<hr>

<h3><a name="s5.1.2"></a>5.1.2 Ssh clients</h3>

<p>
If you are using an SSH client against the SSH server you must make sure that
it supports the same protocols that are enforced on the server.  For example,
if you use the <code>mindterm</code> package, it only supports protocol version
1.  However, the sshd server is, by default, configured to only accept version
2 (for security reasons).
</p>

<hr>

<h3><a name="s5.1.3"></a>5.1.3 Disallowing file transfers</h3>

<p>
If you do <em>not</em> want users to transfer files to and from the ssh server
you need to restrict access to the <code>sftp-server</code> <em>and</em> the
<code>scp</code> access.  You can restrict <code>sftp-server</code> by
configuring the proper <samp>Subsystem</samp> in the
<code>/etc/ssh/sshd_config</code>.
</p>

<p>
You can also chroot users (using <code>libpam-chroot</code> so that, even if
file transfer is allowed, they are limited to an environment which does not
include any system files.
</p>

<hr>

<h3><a name="s-ssh-only-file"></a>5.1.4 Restricing access to file transfer only</h3>

<p>
You might want to restrict access to users so that they can only do file
transfers and cannot have interactive shells.  In order to do this you can
either:
</p>
<ul>
<li>
<p>
disallow users from login to the ssh server (as described above either through
the configuration file or PAM configuration).
</p>
</li>
</ul>
<ul>
<li>
<p>
give users a restricted shell such as <code>scponly</code> or
<code>rssh</code>.  These shells restrict the commands available to the users
so that they are not provided any remote execution priviledges.
</p>
</li>
</ul>

<hr>

<h2><a name="s5.2"></a>5.2 Securing Squid</h2>

<p>
Squid is one of the most popular proxy/cache server, and there are some
security issues that should be taken into account.  Squid's default
configuration file denies all users requests.  However the Debian package
allows access from 'localhost', you just need to configure your browser
properly.  You should configure Squid to allow access to trusted users, hosts
or networks defining an Access Control List on
<code>/etc/squid/squid.conf</code>, see the <code><a
href="http://www.deckle.co.za/squid-users-guide/Main_Page">Squid User's
Guide</a></code> for more information about defining ACLs rules.  Notice that
Debian provides a minimum configuration for Squid that will prevent anything,
except from <em>localhost</em> to connect to your proxy server (which will run
in the default port 3128).  You will need to customize your
<code>/etc/squid/squid.conf</code> as needed.  The recommended minimum
configuration (provided with the package) is shown below:
</p>

<pre>
     acl all src 0.0.0.0/0.0.0.0
     acl manager proto cache_object
     acl localhost src 127.0.0.1/255.255.255.255
     acl SSL_ports port 443 563
     acl Safe_ports port 80          # http
     acl Safe_ports port 21          # ftp
     acl Safe_ports port 443 563     # https, snews
     acl Safe_ports port 70          # gopher
     acl Safe_ports port 210         # wais
     acl Safe_ports port 1025-65535  # unregistered ports
     acl Safe_ports port 280         # http-mgmt
     acl Safe_ports port 488         # gss-http
     acl Safe_ports port 591         # filemaker
     acl Safe_ports port 777         # multiling http
     acl Safe_ports port 901         # SWAT
     acl purge method PURGE
     acl CONNECT method CONNECT
     (...)
     # Only allow cachemgr access from localhost
     http_access allow manager localhost
     http_access deny manager
     # Only allow purge requests from localhost
     http_access allow purge localhost
     http_access deny purge
     # Deny requests to unknown ports
     http_access deny !Safe_ports
     # Deny CONNECT to other than SSL ports
     http_access deny CONNECT !SSL_ports
     #
     # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
     #
     http_access allow localhost
     # And finally deny all other access to this proxy
     http_access deny all
     #Default:
     # icp_access deny all
     #
     #Allow ICP queries from everyone
     icp_access allow all
</pre>

<p>
You should also configure Squid based on your system resources, including cache
memory (option <samp>cache_mem</samp>), location of the cached files and the
amount of space they will take up on disk (option <samp>cache_dir</samp>).
</p>

<p>
Notice that, if not properly configured, someone may relay a mail message
through Squid, since the HTTP and SMTP protocols are designed similarly.
Squid's default configuration file denies access to port 25.  If you wish to
allow connections to port 25 just add it to Safe_ports lists.  However, this is
<em>NOT</em> recommended.
</p>

<p>
Setting and configuring the proxy/cache server properly is only part of keeping
your site secure.  Another necessary task is to analyze Squid's logs to assure
that all things are working as they should be working.  There are some packages
in Debian GNU/Linux that can help an administrator to do this.  The following
packages are available in Debian 3.0 and Debian 3.1 (sarge):
</p>
<ul>
<li>
<p>
<code>calamaris</code> - Log analyzer for Squid or Oops proxy log files.
</p>
</li>
</ul>
<ul>
<li>
<p>
<code>modlogan</code> - A modular logfile analyzer.
</p>
</li>
</ul>
<ul>
<li>
<p>
<code>sarg</code> - Squid Analysis Report Generator.
</p>
</li>
</ul>
<ul>
<li>
<p>
<code>squidtaild</code> - Squid log monitoring program.
</p>
</li>
</ul>

<p>
When using Squid in Accelerator Mode it acts as a web server too.  Turning on
this option increases code complexity, making it less reliable.  By default
Squid is not configured to act as a web server, so you don't need to worry
about this.  Note that if you want to use this feature be sure that it is
really necessary.  To find more information about Accelerator Mode on Squid see
the <code><a
href="http://www.deckle.co.za/squid-users-guide/Accelerator_Mode">Squid User's
Guide - Accelerator Mode</a></code>
</p>

<hr>

<h2><a name="s-ftp-secure"></a>5.3 Securing FTP</h2>

<p>
If you really have to use FTP (without wrapping it with sslwrap or inside a SSL
or SSH tunnel), you should chroot ftp into the ftp users' home directory, so
that the user is unable to see anything else than their own directory.
Otherwise they could traverse your root file system just like if they had a
shell in it.  You can add the following line in your <code>proftpd.conf</code>
in your global section to enable this chroot feature:
</p>

<pre>
     DefaultRoot ~
</pre>

<p>
Restart ProFTPd by <samp>/etc/init.d/proftpd restart</samp> and check whether
you can escape from your homedir now.
</p>

<p>
To prevent ProFTPd DoS attacks using ../../.., add the following line in
<code>/etc/proftpd.conf</code>: <samp>DenyFilter \*.*/</samp>
</p>

<p>
Always remember that FTP sends login and authentication passwords in clear text
(this is not an issue if you are providing an anonymous public service) and
there are better alternatives in Debian for this.  For example,
<code>sftp</code> (provided by <code>ssh</code>).  There are also free
implementations of SSH for other operating systems: <code><a
href="http://www.chiark.greenend.org.uk/~sgtatham/putty/">putty</a></code> and
<code><a href="http://www.cygwin.com">cygwin</a></code> for example.
</p>

<p>
However, if you still maintain the FTP server while making users access through
SSH you might encounter a typical problem.  Users accessing anonymous FTP
servers inside SSH-secured systems might try to log in the <em>FTP server</em>.
While the access will be refused, the password will nevertheless be sent
through the net in clear form.  To avoid that, ProFTPd developer TJ Saunders
has created a patch that prevents users feeding the anonymous FTP server with
valid SSH accounts.  More information and patch available at: <code><a
href="http://www.castaglia.org/proftpd/#Patches">ProFTPD Patches</a></code>.
This patch has been reported to Debian too, see <code><a
href="http://bugs.debian.org/145669">Bug #145669</a></code>.
</p>

<hr>

<h2><a name="s5.4"></a>5.4 Securing access to the X Window System</h2>

<p>
Today, X terminals are used by more and more companies where one server is
needed for a lot of workstations.  This can be dangerous, because you need to
allow the file server to connect to the clients (X server from the X point of
view.  X switches the definition of client and server).  If you follow the
(very bad) suggestion of many docs, you type <samp>xhost +</samp> on your
machine.  This allows any X client to connect to your system.  For slightly
better security, you can use the command <samp>xhost +hostname</samp> instead
to only allow access from specific hosts.
</p>

<p>
A much more secure solution, though, is to use ssh to tunnel X and encrypt the
whole session.  This is done automatically when you ssh to another machine.
For this to work, you have to configure both the ssh client and the ssh server.
On the ssh client, <samp>ForwardX11</samp> should be set to <samp>yes</samp> in
<code>/etc/ssh/ssh_config</code>.  On the ssh server,
<samp>X11Forwarding</samp> should be set to <samp>yes</samp> in
<code>/etc/ssh/sshd_config</code> and the package <code>xbase-clients</code>
should be installed because the ssh server uses
<code>/usr/X11R6/bin/xauth</code> (<code>/usr/bin/xauth</code> on Debian
unstable) when setting up the pseudo X display.  In times of SSH, you should
drop the xhost based access control completely.
</p>

<p>
For best security, if you do not need X access from other machines, switch off
the binding on TCP port 6000 simply by typing:
</p>

<pre>
     $ startx -- -nolisten tcp
</pre>

<p>
This is the default behavior in Xfree 4.1.0 (the Xserver provided in Debian 3.0
and 3.1).  If you are running Xfree 3.3.6 (i.e.  you have Debian 2.2 installed)
you can edit <code>/etc/X11/xinit/xserverrc</code> to have it something along
the lines of:
</p>

<pre>
     #!/bin/sh
     exec /usr/bin/X11/X -dpi 100 -nolisten tcp
</pre>

<p>
If you are using XDM set <code>/etc/X11/xdm/Xservers</code> to: <samp>:0 local
/usr/bin/X11/X vt7 -dpi 100 -nolisten tcp</samp>.  If you are using Gdm make
sure that the <samp>DisallowTCP=true</samp> option is set in the
<code>/etc/gdm/gdm.conf</code> (which is the default in Debian).  This will
basically append <samp>-nolisten tcp</samp> to every X command line [<a
href="footnotes.en.html#f40" name="fr40">40</a>].
</p>

<p>
You can also set the default's system timeout for <code>xscreensaver</code>
locks.  Even if the user can override it, you should edit the
<code>/etc/X11/app-defaults/XScreenSaver</code> configuration file and change
the lock line:
</p>

<pre>
     *lock:                  False
</pre>

<p>
(which is the default in Debian) to:
</p>

<pre>
     *lock:                  True
</pre>

<p>
FIXME: Add information on how to disable the screensavers which show the user
desktop (which might have sensitive information).
</p>

<p>
Read more on X Window security in <code><a
href="http://www.tldp.org/HOWTO/XWindow-User-HOWTO.html">XWindow-User-HOWTO</a></code>
(<code>/usr/share/doc/HOWTO/en-txt/XWindow-User-HOWTO.txt.gz</code>).
</p>

<p>
FIXME: Add info on thread of debian-security on how to change config files of
XFree 3.3.6 to do this.
</p>

<hr>

<h3><a name="s5.4.1"></a>5.4.1 Check your display manager</h3>

<p>
If you only want to have a display manager installed for local usage (having a
nice graphical login, that is), make sure the XDMCP (X Display Manager Control
Protocol) stuff is disabled.  In XDM you can do this with this line in
<samp>/etc/X11/xdm/xdm-config</samp>:
</p>

<pre>
     DisplayManager.requestPort:     0
</pre>

<p>
For GDM there should be in your gdm.conf:
</p>

<pre>
     [xdmcp]
     Enable=false
</pre>

<p>
Normally, all display managers are configured not to start XDMCP services per
default in Debian.
</p>

<hr>

<h2><a name="s5.5"></a>5.5 Securing printing access (the lpd and lprng issue)</h2>

<p>
Imagine, you arrive at work, and the printer is spitting out endless amounts of
paper because someone is DoSing your line printer daemon.  Nasty, isn't it?
</p>

<p>
In any UNIX printing architecture, there has to be a way to get the client's
data to the host's print server.  In traditional <code>lpr</code> and
<code>lp</code>, the client command copies or symlinks the data into the spool
directory (which is why these programs are usually SUID or SGID).
</p>

<p>
In order to avoid any issues you should keep your printer servers especially
secure.  This means you need to configure your printer service so it will only
allow connections from a set of trusted servers.  In order to do this, add the
servers you want to allow printing to your <code>/etc/hosts.lpd</code>.
</p>

<p>
However, even if you do this, the <code>lpr</code> daemon accepts incoming
connections on port 515 of any interface.  You should consider firewalling
connections from networks/hosts which are not allowed printing (the
<code>lpr</code> daemon cannot be limited to listen only on a given IP
address).
</p>

<p>
<code>Lprng</code> should be preferred over <code>lpr</code> since it can be
configured to do IP access control.  And you can specify which interface to
bind to (although somewhat weirdly).
</p>

<p>
If you are using a printer in your system, but only locally, you will not want
to share this service over a network.  You can consider using other printing
systems, like the one provided by <code>cups</code> or <code><a
href="http://pdq.sourceforge.net/">PDQ</a></code> which is based on user
permissions of the <code>/dev/lp0</code> device.
</p>

<p>
In <code>cups</code>, the print data is transferred to the server via the HTTP
protocol.  This means the client program doesn't need any special privileges,
but does require that the server is listening on a port somewhere.
</p>

<p>
However, if you want to use <code>cups</code>, but only locally, you can
configure it to bind to the loopback interface by changing
<code>/etc/cups/cupsd.conf</code>:
</p>

<pre>
     Listen 127.0.0.1:631
</pre>

<p>
There are many other security options like allowing or denying networks and
hosts in this config file.  However, if you do not need them you might be
better off just limiting the listening port.  <code>Cups</code> also serves
documentation through the HTTP port, if you do not want to disclose potential
useful information to outside attackers (and the port is open) add also:
</p>

<pre>
     &lt;Location /&gt;
      Order Deny,Allow
      Deny From All
      Allow From 127.0.0.1
     &lt;/Location&gt;
</pre>

<p>
This configuration file can be modified to add some more features including
SSL/TLS certificates and crypto.  The manuals are available at
http://localhost:631/ or at <code><a href="cups.org">cups.org</a></code>.
</p>

<p>
FIXME: Add more content (the article on <code><a
href="http://www.rootprompt.org">Amateur Fortress Building</a></code> provides
some very interesting views).
</p>

<p>
FIXME: Check if PDG is available in Debian, and if so, suggest this as the
preferred printing system.
</p>

<p>
FIXME: Check if Farmer/Wietse has a replacement for printer daemon and if it's
available in Debian.
</p>

<hr>

<h2><a name="s5.6"></a>5.6 Securing the mail service</h2>

<p>
If your server is not a mailing system, you do not really need to have a mail
daemon listening for incoming connections, but you might want local mail
delivered in order, for example, to receive mail for the root user from any
alert systems you have in place.
</p>

<p>
If you have <code>exim</code> you do not need the daemon to be working in order
to do this since the standard <code>cron</code> job flushes the mail queue.
See <a href="ch3.en.html#s-disableserv">Disabling daemon services, Section
3.6.1</a> on how to do this.
</p>

<hr>

<h3><a name="s5.6.1"></a>5.6.1 Configuring a Nullmailer</h3>

<p>
You might want to have a local mailer daemon so that it can relay the mails
sent locally to another system.  This is common when you have to administer a
number of systems and do not want to connect to each of them to read the mail
sent locally.  Just as all logging of each individual system can be centralized
by using a central syslog server, mail can be sent to a central mailserver.
</p>

<p>
Such a <em>relay-only</em> system should be configured properly for this.  The
daemon could, as well, be configured to only listen on the loopback address.
</p>

<p>
The following configuration steps only need to be taken to configure the
<code>exim</code> package in the Debian 3.0 release.  If you are using a later
release (such as 3.1 which uses <code>exim4</code>) the installation system has
been improved so that if the mail transport agent is configured to only deliver
local mail it will automatically only allow connections from the local host and
will not permit remote connections.
</p>

<p>
In a Debian 3.0 system using <code>exim</code>, you will have to remove the
SMTP daemon from <code>inetd</code>:
</p>

<pre>
     $ update-inetd --disable smtp
</pre>

<p>
and configure the mailer daemon to only listen on the loopback interface.  In
<code>exim</code> (the default MTA) you can do this by editing the file
<code>/etc/exim.conf</code> and adding the following line:
</p>

<pre>
     local_interfaces = &quot;127.0.0.1&quot;
</pre>

<p>
Restart both daemons (inetd and exim) and you will have exim listening on the
127.0.0.1:25 socket only.  Be careful, and first disable inetd, otherwise, exim
will not start since the inetd daemon is already handling incoming connections.
</p>

<p>
For <code>postfix</code> edit <code>/etc/postfix/main.conf</code>:
</p>

<pre>
     inet_interfaces = localhost
</pre>

<p>
If you only want local mail, this approach is better than tcp-wrapping the
mailer daemon or adding firewalling rules to limit anybody accessing it.
However, if you do need it to listen on other interfaces, you might consider
launching it from inetd and adding a tcp wrapper so incoming connections are
checked against <code>/etc/hosts.allow</code> and <code>/etc/hosts.deny</code>.
Also, you will be aware of when an unauthorized access is attempted against
your mailer daemon, if you set up proper logging for any of the methods above.
</p>

<p>
In any case, to reject mail relay attempts at the SMTP level, you can change
<code>/etc/exim/exim.conf</code> to include:
</p>

<pre>
     receiver_verify = true
</pre>

<p>
Even if your mail server will not relay the message, this kind of configuration
is needed for the relay tester at <code><a
href="http://www.abuse.net/relay.html">http://www.abuse.net/relay.html</a></code>
to determine that your server is <em>not</em> relay capable.
</p>

<p>
If you want a relay-only setup, however, you can consider changing the mailer
daemon to programs that can <em>only</em> be configured to forward the mail to
a remote mail server.  Debian provides currently both <code>ssmtp</code> and
<code>nullmailer</code> for this purpose.  In any case, you can evaluate for
yourself any of the mail transport agents [<a href="footnotes.en.html#f41"
name="fr41">41</a>] provided by Debian and see which one suits best to the
system's purposes.
</p>

<hr>

<h3><a name="s5.6.2"></a>5.6.2 Providing secure access to mailboxes</h3>

<p>
If you want to give remote access to mailboxes there are a number of POP3 and
IMAP daemons available.[<a href="footnotes.en.html#f42" name="fr42">42</a>]
However, if you provide IMAP access note that it is a general file access
protocol, it can become the equivalent of a shell access because users might be
able to retrieve any file that they can through it.
</p>

<p>
Try, for example, to configure as your inbox path
<samp>{server.com}/etc/passwd</samp> if it succeeds your IMAP daemon is not
properly configured to prevent this kind of access.
</p>

<p>
Of the IMAP servers in Debian the <code>cyrus</code> server (in the
<code>cyrus-imapd</code> package) gets around this by having all access to a
database in a restricted part of the file system.  Also, <code>uw-imapd</code>
(either install the <code>uw-imapd</code> or better, if your IMAP clients
support it, <code>uw-imapd-ssl</code>) can be configured to chroot the users
mail directory but this is not enabled by default.  The documentation provided
gives more information on how to configure it.
</p>

<p>
Also, you might want to run an IMAP server that does not need valid users to be
created on the local system (which would grant shell access too),
<code>courier-imap</code> (for IMAP) and <code>courier-pop</code>,
<code>teapop</code> (for POP3) and <code>cyrus-imapd</code> (for both POP3 and
IMAP) provide servers with authentication methods beside the local user
accounts.  <code>cyrus</code> can use any authentication method that can be
configured through PAM while <code>teapop</code> might use databases (such as
<code>postgresql</code> and <code>mysql</code>) for user authentication.
</p>

<p>
FIXME: Check: <code>uw-imapd</code> might be configured with user
authentication through PAM too.
</p>

<hr>

<h3><a name="s5.6.3"></a>5.6.3 Receiving mail securely</h3>

<p>
Reading/receiving mail is the most common clear-text protocol.  If you use
either POP3 or IMAP to get your mail, you send your clear-text password across
the net, so almost anyone can read your mail from now on.  Instead, use SSL
(Secure Sockets Layer) to receive your mail.  The other alternative is SSH, if
you have a shell account on the box which acts as your POP or IMAP server.
Here is a basic <code>fetchmailrc</code> to demonstrate this:
</p>

<pre>
     poll my-imap-mailserver.org via &quot;localhost&quot;
       with proto IMAP port 1236
           user &quot;ref&quot; there with password &quot;hackme&quot; is alex here warnings 3600
         folders
           .Mail/debian
         preconnect 'ssh -f -P -C -L 1236:my-imap-mailserver.org:143 -l ref
          my-imap-mailserver.org sleep 15 &lt;/dev/null &gt; /dev/null'
</pre>

<p>
The preconnect is the important line.  It fires up an ssh session and creates
the necessary tunnel, which automatically forwards connections to localhost
port 1236 to the IMAP mail server, but encrypted.  Another possibility would be
to use <code>fetchmail</code> with the SSL feature.
</p>

<p>
If you want to provide encrypted mail services like POP and IMAP, <samp>apt-get
install stunnel</samp> and start your daemons this way:
</p>

<pre>
     stunnel -p /etc/ssl/certs/stunnel.pem -d pop3s -l /usr/sbin/popd
</pre>

<p>
This command wraps the provided daemon (-l) to the port (-d) and uses the
specified SSL certificate (-p).
</p>

<hr>

<h2><a name="s-sec-bind"></a>5.7 Securing BIND</h2>

<p>
There are different issues that can be tackled in order to secure the Domain
server daemon, which are similar to the ones considered when securing any given
service:
</p>
<ul>
<li>
<p>
configuring the daemon itself properly so it cannot be misused from the outside
(see <a href="#s-configure-bind">Bind configuration to avoid misuse, Section
5.7.1</a>).  This includes limiting possible queries from clients: zone
transfers and recursive queries.
</p>
</li>
</ul>
<ul>
<li>
<p>
limit the access of the daemon to the server itself so if it is used to break
in, the damage to the system is limited.  This includes running the daemon as a
non-privileged user (see <a href="#s-user-bind">Changing BIND's user, Section
5.7.2</a>) and chrooting it (see <a href="#s-chroot-bind">Chrooting the name
server, Section 5.7.3</a>).
</p>
</li>
</ul>

<hr>

<h3><a name="s-configure-bind"></a>5.7.1 Bind configuration to avoid misuse</h3>

<p>
You should restrict some of the information that is served from the DNS server
to outside clients so that it cannot be used to retrieve valuable information
from your organization that you do not want to give away.  This includes adding
the following options: <em>allow-transfer</em>, <em>allow-query</em>,
<em>allow-recursion</em> and <em>version</em>.  You can either limit this on
the global section (so it applies to all the zones served) or on a per-zone
basis.  This information is documented in the <code>bind-doc</code> package,
read more on this on <code>/usr/share/doc/bind/html/index.html</code> once the
package is installed.
</p>

<p>
Imagine that your server is connected to the Internet and to your internal
(your internal IP is 192.168.1.2) network (a basic multi-homed server), you do
not want to give any service to the Internet and you just want to enable DNS
lookups from your internal hosts.  You could restrict it by including in
<code>/etc/bind/named.conf</code>:
</p>

<pre>
     options {
                 allow-query { 192.168.1/24; } ;
                 allow-transfer { none; } ; 
                 allow-recursion { 192.168.1/24; } ;
                 listen-on { 192.168.1.2; } ;
                 forward { only; } ;
                 forwarders { A.B.C.D; } ;
     };
</pre>

<p>
The <em>listen-on</em> option makes the DNS bind to only the interface that has
the internal address, but, even if this interface is the same as the interface
that connects to the Internet (if you are using NAT, for example), queries will
only be accepted if coming from your internal hosts.  If the system has
multiple interfaces and the <em>listen-on</em> is not present, only internal
users could query, but, since the port would be accessible to outside
attackers, they could try to crash (or exploit buffer overflow attacks) on the
DNS server.  You could even make it listen only on 127.0.0.1 if you are not
giving DNS service for any other systems than yourself.
</p>

<p>
The version.bind record in the chaos class contains the version of the
currently running bind process.  This information is often used by automated
scanners and malicious individuals who wish to determine if one's
<code>bind</code> is vulnerable to a specific attack.  By providing false or no
information in the version.bind record, one limits the probability that one's
server will be attacked based on its published version.  To provide your own
version, use the <em>version</em> directive in the following manner:
</p>

<pre>
      options { ... various options here ...
     version &quot;Not available.&quot;; };
</pre>

<p>
Changing the version.bind record does not provide actual protection against
attacks, but it might be considered a useful safeguard.
</p>

<p>
A sample <code>named.conf</code> configuration file might be the following:
</p>

<pre>
     acl internal {
             127.0.0.1/32;           // localhost
             10.0.0.0/8;             // internal
             aa.bb.cc.dd;            // eth0 IP
     };
     
     acl friendly {
             ee.ff.gg.hh;            // slave DNS
             aa.bb.cc.dd;            // eth0 IP
             127.0.0.1/32;           // localhost
             10.0.0.0/8;             // internal
     };
     
     options {
             directory &quot;/var/cache/bind&quot;;
             allow-query { internal; };
             allow-recursion { internal; };
             allow-transfer { none; };
     };
     // From here to the mysite.bogus zone 
     // is basically unmodified from the debian default
     logging {
             category lame-servers { null; };
             category cname { null; };   
     };
     
     zone &quot;.&quot; {
             type hint;
             file &quot;/etc/bind/db.root&quot;;
     };
     
     zone &quot;localhost&quot; {
             type master;
             file &quot;/etc/bind/db.local&quot;;
     };
     
     zone &quot;127.in-addr.arpa&quot; {
             type master;
             file &quot;/etc/bind/db.127&quot;;
     };
     
     zone &quot;0.in-addr.arpa&quot; {
             type master;
             file &quot;/etc/bind/db.0&quot;;
     };
     
     zone &quot;255.in-addr.arpa&quot; {
             type master;
             file &quot;/etc/bind/db.255&quot;;
     };
     
     // zones I added myself
     zone &quot;mysite.bogus&quot; {
             type master;
             file &quot;/etc/bind/named.mysite&quot;;
             allow-query { any; };
             allow-transfer { friendly; };
     };
</pre>

<p>
Please (again) check the Bug Tracking System regarding Bind, specifically
<code><a href="http://bugs.debian.org/94760">Bug #94760 (regarding ACLs on zone
transfers)</a></code>.  Feel free to contribute to the bug report if you think
you can add useful information.
</p>

<hr>

<h3><a name="s-user-bind"></a>5.7.2 Changing BIND's user</h3>

<p>
Regarding limiting BIND's privileges you must be aware that if a non-root user
runs BIND, then BIND cannot detect new interfaces automatically, for example
when you put a PCMCIA card into your laptop.  Check the
<code>README.Debian</code> file in your named documentation
(<code>/usr/share/doc/bind/README.Debian</code>) directory for more information
about this issue.  There have been many recent security problems concerning
BIND, so switching the user is useful when possible.  We will detail here the
steps needed in order to do this, however, if you want to do this in an
automatic way you might try the script provided in <a
href="ap-bind-chuser.en.html">Sample script to change the default Bind
installation., Appendix E</a>.
</p>

<p>
Notice, in any case, that this only applies to BIND version 8.  In the Debian
packages for BIND version 9 (since the 9.2.1-5 version, available since
<em>sarge</em>) the <em>bind</em> user is created and used by setting the
OPTIONS variable in <code>/etc/default/bind9</code>.  If you are using BIND
version 9 and your name server daemon is not running as the <em>bind</em> user
verify the settings on that file.
</p>

<p>
To run BIND under a different user, first create a separate user and group for
it (it is <em>not</em> a good idea to use nobody or nogroup for every service
not running as root).  In this example, the user and group <samp>named</samp>
will be used.  You can do this by entering:
</p>

<pre>
     addgroup named
     adduser --system --home /home/named --no-create-home --ingroup named \
           --disabled-password --disabled-login named
</pre>

<p>
Notice that the user <samp>named</samp> will be quite restricted.  If you want,
for whatever reason, to have a less restrictive setup use:
</p>

<pre>
     adduser --system --ingroup named named
</pre>

<p>
Now you can either edit <code>/etc/init.d/bind</code> with your favorite editor
and change the line beginning with
</p>

<pre>
     start-stop-daemon --start
</pre>

<p>
to[<a href="footnotes.en.html#f43" name="fr43">43</a>]
</p>

<pre>
     start-stop-daemon --start --quiet --exec /usr/sbin/named -- -g named -u named
</pre>

<p>
Or you can change (create it if it does not exit) the default configuration
file (<code>/etc/default/bind</code> for BIND version 8) and introduce the
following:
</p>

<pre>
     OPTIONS=&quot;-u named -g named&quot;
</pre>

<p>
Change the permissions of files that are used by Bind, including
<code>/etc/bind/rndc.key</code>:
</p>

<pre>
     -rw-r-----    1 root     named          77 Jan  4 01:02 rndc.key
</pre>

<p>
and where bind creates its pidfile, using, for example,
<code>/var/run/named</code> instead of <code>/var/run</code>:
</p>

<pre>
     $ mkdir /var/run/named
     $ chown named.named /var/run/named
     $ vi /etc/named.conf
     [ ... update the configuration file to use this new location ...]
     options { ...
             pid-file &quot;/var/run/named/named.pid&quot;;
     };
     [ ... ]
</pre>

<p>
Also, in order to avoid running anything as root, change the
<samp>reload</samp> line in the init.d script by substituting:
</p>

<pre>
     reload)
            /usr/sbin/ndc reload
</pre>

<p>
to:
</p>

<pre>
     reload)
             $0 stop
             sleep 1
             $0 start
</pre>

<p>
Note: Depending on your Debian version you might have to change the
<samp>restart</samp> line too.  This was fixed in Debian's bind version
<samp>1:8.3.1-2</samp>.
</p>

<p>
All you need to do now is to restart bind via <samp>/etc/init.d/bind
restart</samp>, and then check your syslog for two entries like this:
</p>

<pre>
     Sep  4 15:11:08 nexus named[13439]: group = named
     Sep  4 15:11:08 nexus named[13439]: user = named
</pre>

<p>
Voil!  Your named now <em>does not</em> run as root.  If you want to read more
information on why BIND does not run as non-root user on Debian systems, please
check the Bug Tracking System regarding Bind, specifically <code><a
href="http://bugs.debian.org/50013">Bug #50013: bind should not run as
root</a></code> and <code><a href="http://bugs.debian.org/132582">Bug #132582:
Default install is potentially insecure</a></code>, <code><a
href="http://bugs.debian.org/53550">Bug #53550</a></code>, <code><a
href="http://bugs.debian.org/52745">Bug #52745</a></code>, and <code><a
href="http://bugs.debian.org/128129">Bug #128129</a></code>.  Feel free to
contribute to the bug reports if you think you can add useful information.
</p>

<hr>

<h3><a name="s-chroot-bind"></a>5.7.3 Chrooting the name server</h3>

<p>
To achieve maximum BIND security, now build a chroot jail (see <a
href="#s-chroot">General chroot and suid paranoia, Section 5.10</a>) around
your daemon.  There is an easy way to do this: the <samp>-t</samp> option (see
the <code>named(8)</code> manpage or page 100 of <code><a
href="http://www.nominum.com/content/documents/bind9arm.pdf">Bind's 9
documentation (PDF)</a></code>).  This will make Bind chroot itself into the
given directory without you needing to set up a chroot jail and worry about
dynamic libraries.  The only files that need to be in the chroot jail are:
</p>

<pre>
     dev/null
     etc/bind/       - should hold named.conf and all the server zones
     sbin/named-xfer - if you do name transfers
     var/run/named/  - should hold the PID and the name server cache (if
                       any) this directory needs to be writable by named user
     var/log/named   - if you set up logging to a file, needs to be writable
                       for the named user
     dev/log         - syslogd should be listening here if named is configured to
                       log through it
</pre>

<p>
In order for your Bind daemon to work properly it needs permission in the named
files.  This is an easy task since the configuration files are always at
<samp>/etc/named/</samp>.  Take into account that it only needs read-only
access to the zone files, unless it is a secondary or cache name server.  If
this is your case you will have to give read-write permissions to the necessary
zones (so that zone transfers from the primary server work).
</p>

<p>
Also, you can find more information regarding Bind chrooting in the <code><a
href="http://www.tldp.org/HOWTO/Chroot-BIND-HOWTO.html">Chroot-BIND-HOWTO</a></code>
(regarding Bind 9) and <code><a
href="http://www.tldp.org/HOWTO/Chroot-BIND8-HOWTO.html">Chroot-BIND8-HOWTO</a></code>
(regarding Bind 8).  This same documents should be available through the
installation of the <code>doc-linux-text</code> (text version) or
<code>doc-linux-html</code> (HTML version).  Another useful document is
<code><a
href="http://web.archive.org/web/20011024064030/http://www.psionic.com/papers/dns/dns-linux">http://web.archive.org/web/20011024064030/http://www.psionic.com/papers/dns/dns-linux</a></code>.
</p>

<p>
If you are setting up a full chroot jail (i.e.  not just <samp>-t</samp>) for
Bind in Debian, make sure you have the following files in it[<a
href="footnotes.en.html#f44" name="fr44">44</a>]:
</p>

<pre>
     dev/log - syslogd should be listening here
     dev/null
     etc/bind/named.conf 
     etc/localtime
     etc/group - with only a single line: &quot;named:x:GID:&quot;
     etc/ld.so.cache - generated with ldconfig 
     lib/ld-2.3.6.so
     lib/libc-2.3.6.so
     lib/ld-linux.so.2 - symlinked to ld-2.3.6.so
     lib/libc.so.6 - symlinked to libc-2.3.6.so
     sbin/ldconfig - may be deleted after setting up the chroot
     sbin/named-xfer - if you do name transfers
     var/run/
</pre>

<p>
And modify also <code>syslogd</code> listen on <samp>$CHROOT/dev/log</samp> so
the named server can write syslog entries into the local system log.
</p>

<p>
If you want to avoid problems with dynamic libraries, you can compile bind
statically.  You can use <code>apt-get</code> for this, with the
<samp>source</samp> option.  It can even download the packages you need to
properly compile it.  You would need to do something similar to:
</p>

<pre>
     $ apt-get source bind
     # apt-get build-dep bind
     $ cd bind-8.2.5-2
       (edit src/port/linux/Makefile so CFLAGS includes the '-static'
        option)
     $ dpkg-buildpackage -rfakeroot -uc -us
     $ cd ..
     # dpkg -i bind-8.2.5-2*deb
</pre>

<p>
After installation, you will need to move around the files to the chroot
jail[<a href="footnotes.en.html#f45" name="fr45">45</a>] you can keep the
<samp>init.d</samp> scripts in <code>/etc/init.d</code> so that the system will
automatically start the name server, but edit them to add <samp>--chroot
/location_of_chroot</samp> in the calls to <code>start-stop-daemon</code> in
those scripts or use the <em>-t</em> option for BIND by setting it in the
OPTIONS argument at the <code>/etc/default/bind</code> (for version 8) or
<code>/etc/default/bind9</code> (for version 9) configuration file.
</p>

<p>
For more information on how to set up chroots see <a href="#s-chroot">General
chroot and suid paranoia, Section 5.10</a>.
</p>

<p>
FIXME: Merge info from <code><a
href="http://people.debian.org/~pzn/howto/chroot-bind.sh.txt">http://people.debian.org/~pzn/howto/chroot-bind.sh.txt</a></code>,
<code><a
href="http://www.cryptio.net/~ferlatte/config/">http://www.cryptio.net/~ferlatte/config/</a></code>
(Debian-specific), <code><a
href="http://web.archive.org/web/20021216104548/http://www.psionic.com/papers/whitep01.html">http://web.archive.org/web/20021216104548/http://www.psionic.com/papers/whitep01.html</a></code>
and <code><a
href="http://csrc.nist.gov/fasp/FASPDocs/NISTSecuringDNS.htm">http://csrc.nist.gov/fasp/FASPDocs/NISTSecuringDNS.htm</a></code>.
</p>

<hr>

<h2><a name="s5.8"></a>5.8 Securing Apache</h2>

<p>
FIXME: Add content: modules provided with the normal Apache installation (under
/usr/lib/apache/X.X/mod_*) and modules that can be installed separately in
libapache-mod-XXX packages.
</p>

<p>
You can limit access to the Apache server if you only want to use it internally
(for testing purposes, to access the <code>doc-central</code> archive, etc.)
and do not want outsiders to access it.  To do this use the <samp>Listen</samp>
or <samp>BindAddress</samp> directives in <code>/etc/apache/http.conf</code>.
</p>

<p>
Using Listen:
</p>

<pre>
     Listen 127.0.0.1:80
</pre>

<p>
Using BindAddress:
</p>

<pre>
     BindAddress 127.0.0.1
</pre>

<p>
Then restart apache with <samp>/etc/init.d/apache restart</samp> and you will
see that it is only listening on the loopback interface.
</p>

<p>
In any case, if you are not using all the functionality provided by Apache, you
might want to take a look at other web servers provided in Debian like
<code>dhttpd</code>.
</p>

<p>
The <code><a href="http://httpd.apache.org/docs/misc/security_tips.html">Apache
Documentation</a></code> provides information regarding security measures to be
taken on Apache web server (this same information is provided in Debian by the
<code>apache-doc</code> package).
</p>

<p>
More information on further restricting Apache by setting up a chroot jail is
provided in <a href="ap-chroot-apache-env.en.html"><code>Chroot</code>
environment for <code>Apache</code>, Appendix H</a>.
</p>

<hr>

<h3><a name="s5.8.1"></a>5.8.1 Disabling users from publishing web contents</h3>

<p>
The default Apache installation in Debian permits users to publish content
under the <code>$HOME/public_html</code>.  This content can be retrieved
remotely using an URL such as: http://your_apache_server/~user.
</p>

<p>
If you do not want to permit this you must change the
<code>/etc/apache/http.conf</code> configuration file commenting out (in Apache
1.3) the following module:
</p>

<pre>
     LoadModule userdir_module /usr/lib/apache/1.3/mod_userdir.so
</pre>

<p>
If you are using Apache 2.0 you must remove the file
<code>/etc/apache2/mods-enabled/userdir.load</code> or restrict the default
configuration by modifying <code>/etc/apache2/mods-enabled/userdir.conf</code>.
</p>

<p>
However, if the module was linked statically (you can list the modules that are
compiled in running <samp>apache -l</samp>) you must add the following to the
Apache configuration file:
</p>

<pre>
     Userdir disabled
</pre>

<p>
An attacker might still do user enumeration, since the answer of the web server
will be a <em>403 Permission Denied</em> and not a <em>404 Not available</em>.
You can avoid this if you use the Rewrite module.
</p>

<hr>

<h3><a name="s5.8.2"></a>5.8.2 Logfiles permissions</h3>

<p>
Apache logfiles, since 1.3.22-1, are owned by user 'root' and group 'adm' with
permissions 640.  These permissions are changed after rotation.  An intruder
that accessed the system through the web server would not be able (without
privilege escalation) to remove old log file entries.
</p>

<hr>

<h3><a name="s5.8.3"></a>5.8.3 Published web files</h3>

<p>
Apache files are located under <code>/var/www</code>.  Just after installation
the default file provides some information on the system (mainly that it's a
Debian system running Apache).  The default webpages are owned by user root and
group root by default, while the Apache process runs as user www-data and group
www-data.  This should make attackers that compromise the system through the
web server harder to deface the site.  You should, of course, substitute the
default web pages (which might provide information you do not want to show to
outsiders) with your own.
</p>

<hr>

<h2><a name="s5.9"></a>5.9 Securing finger</h2>

<p>
If you want to run the finger service first ask yourself if you need to do so.
If you do, you will find out that Debian provides many finger daemons (output
from <code>apt-cache search fingerd</code>):
</p>
<ul>
<li>
<p>
cfingerd - Configurable finger daemon
</p>
</li>
</ul>
<ul>
<li>
<p>
efingerd - Another finger daemon for unix, capable of fine-tuning your output.
</p>
</li>
</ul>
<ul>
<li>
<p>
ffingerd - a secure finger daemon
</p>
</li>
</ul>
<ul>
<li>
<p>
fingerd - Remote user information server.
</p>
</li>
</ul>
<ul>
<li>
<p>
xfingerd - BSD-like finger daemon with qmail support.
</p>
</li>
</ul>

<p>
<code>ffingerd</code> is the recommended finger daemon if you are going to use
it for a public service.  In any case, you are encouraged to, when setting it
up through inetd, xinetd or tcpserver to: limit the number of processes that
will be running at the same time, limit access to the finger daemon from a
given number of hosts (using tcp wrappers) and having it only listening to the
interface you need it to be in.
</p>

<hr>

<h2><a name="s-chroot"></a>5.10 General chroot and suid paranoia</h2>

<p>
<code>chroot</code> is one of the most powerful possibilities to restrict a
daemon or a user or another service.  Just imagine a jail around your target,
which the target cannot escape from (normally, but there are still a lot of
conditions that allow one to escape out of such a jail).  If you do not trust a
user or a service, you can create a modified root environment for him.  This
can use quite a bit of disk space as you need to copy all needed executables,
as well as libraries, into the jail.  But then, even if the user does something
malicious, the scope of the damage is limited to the jail.
</p>

<p>
Many services running as daemons could benefit from this sort of arrangement.
The daemons that you install with your Debian distribution will not come,
however, chrooted[<a href="footnotes.en.html#f46" name="fr46">46</a>] per
default.
</p>

<p>
This includes: name servers (such as <code>bind</code>), web servers (such as
<code>apache</code>), mail servers (such as <code>sendmail</code>) and ftp
servers (such as <code>wu-ftpd</code>).  It is probably fair to say that the
complexity of BIND is the reason why it has been exposed to a lot of attacks in
recent years (see <a href="#s-sec-bind">Securing BIND, Section 5.7</a>).
</p>

<p>
However, Debian does provide some software that can help set up
<code>chroot</code> environments.  See <a href="#s-auto-chroot">Making chrooted
environments automatically, Section 5.10.1</a>.
</p>

<p>
Anyway, if you run any service on your system, you should consider running them
as secure as possible.  This includes: revoking root privileges, running in a
restricted environment (such as a chroot jail) or replacing them with a more
secure equivalent.
</p>

<p>
However, be forewarned that a <code>chroot</code> jail can be broken if the
user running in it is the superuser.  So, you need to make the service run as a
non-privileged user.  By limiting its environment you are limiting the world
readable/executable files the service can access, thus, you limit the
possibilities of a privilege escalation by use of local system security
vulnerabilities.  Even in this situation you cannot be completely sure that
there is no way for a clever attacker to somehow break out of the jail.  Using
only server programs which have a reputation for being secure is a good
additional safety measure.  Even minuscule holes like open file handles can be
used by a skilled attacker for breaking into the system.  After all,
<code>chroot</code> was not designed as a security tool but as a testing tool.
</p>

<hr>

<h3><a name="s-auto-chroot"></a>5.10.1 Making chrooted environments automatically</h3>

<p>
There are several programs to chroot automatically servers and services.
Debian currently (accepted in May 2002) provides Wietse Venema's
<code>chrootuid</code> in the <code>chrootuid</code> package, as well as
<code>compartment</code> and <code>makejail</code>.  These programs can be used
to set up a restricted environment for executing any program
(<code>chrootuid</code> enables you to even run it as a restricted user).
</p>

<p>
Some of these tools can be used to set up the chroot environment easily.  The
<code>makejail</code> program for example, can create and update a chroot jail
with short configuration files (it provides sample configuration files for
<code>bind</code>, <code>apache</code>, <code>postgresql</code> and
<code>mysql</code>).  It attempts to guess and install into the jail all files
required by the daemon using <code>strace</code>, <code>stat</code> and
Debian's package dependencies.  More information at <code><a
href="http://www.floc.net/makejail/">http://www.floc.net/makejail/</a></code>.
<code>Jailer</code> is a similar tool which can be retrieved from <code><a
href="http://www.balabit.hu/downloads/jailer/">http://www.balabit.hu/downloads/jailer/</a></code>
and is also available as a Debian package.
</p>

<hr>

<h2><a name="s5.11"></a>5.11 General cleartext password paranoia</h2>

<p>
You should try to avoid any network service which sends and receives passwords
in cleartext over a net like FTP/Telnet/NIS/RPC.  The author recommends the use
of ssh instead of telnet and ftp to everybody.
</p>

<p>
Keep in mind that migrating from telnet to ssh, but using other cleartext
protocols does not increase your security in ANY way!  Best would be to remove
ftp, telnet, pop, imap, http and to supersede them with their respective
encrypted services.  You should consider moving from these services to their
SSL versions, ftp-ssl, telnet-ssl, pop-ssl, https ...
</p>

<p>
Most of these above listed hints apply to every Unix system (you will find them
if reading any other hardening-related document related to Linux and other
Unices).
</p>

<hr>

<h2><a name="s5.12"></a>5.12 Disabling NIS</h2>

<p>
You should not use NIS, the Network Information Service, if possible, because
it allows password sharing.  This can be highly insecure if your setup is
broken.
</p>

<p>
If you need password sharing between machines, you might want to consider using
other alternatives.  For example, you can setup an LDAP server and configure
PAM on your system in order to contact the LDAP server for user authentication.
You can find a detailed setup in the <code><a
href="http://www.tldp.org/HOWTO/LDAP-HOWTO.html">LDAP-HOWTO</a></code>
(<code>/usr/share/doc/HOWTO/en-txt/LDAP-HOWTO.txt.gz</code>).
</p>

<p>
You can read more about NIS security in the <code><a
href="http://www.tldp.org/HOWTO/NIS-HOWTO.html">NIS-HOWTO</a></code>
(<code>/usr/share/doc/HOWTO/en-txt/NIS-HOWTO.txt.gz</code>).
</p>

<p>
FIXME (jfs): Add info on how to set this up in Debian.
</p>

<hr>

<h2><a name="s-rpc"></a>5.13 Securing RPC services</h2>

<p>
You should disable RPC if you do not need it.
</p>

<p>
Remote Procedure Call (RPC) is a protocol that programs can use to request
services from other programs located on different computers.  The
<code>portmap</code> service controls RPC services by mapping RPC program
numbers into DARPA protocol port numbers; it must be running in order to make
RPC calls.
</p>

<p>
RPC-based services have had a bad record of security holes, although the
portmapper itself hasn't (but still provides information to a remote attacker).
Notice that some of the DDoS (distributed denial of service) attacks use RPC
exploits to get into the system and act as a so called agent/handler.
</p>

<p>
You only need RPC if you are using an RPC-based service.  The most common
RPC-based services are NFS (Network File System) and NIS (Network Information
System).  See the previous section for more information about NIS.  The File
Alteration Monitor (FAM) provided by the package <code>fam</code> is also an
RPC service, and thus depends on <code>portmap</code>.
</p>

<p>
NFS services are quite important in some networks.  If that is the case for
you, then you will need to find a balance of security and usability for your
network (you can read more about NFS security in the <code><a
href="http://www.tldp.org/HOWTO/NFS-HOWTO.html">NFS-HOWTO</a></code>
(<code>/usr/share/doc/HOWTO/en-txt/NFS-HOWTO.txt.gz</code>)).
</p>

<hr>

<h3><a name="s5.13.1"></a>5.13.1 Disabling RPC services completely</h3>

<p>
Disabling portmap is quite simple.  There are several different methods.  The
simplest one in a Debian 3.0 system and later releases is to uninstall the
<code>portmap</code> package.  If you are running an older Debian version you
will have to disable the service as seen in <a
href="ch3.en.html#s-disableserv">Disabling daemon services, Section 3.6.1</a>,
because the program is part of the <code>netbase</code> package (which cannot
be de-installed without breaking the system).
</p>

<p>
Notice that some desktop environments (notably, GNOME) use RPC services and
need the portmapper for some of the file management features.  If this is your
case, you can limit the access to RPC services as described below.
</p>

<hr>

<h3><a name="s5.13.2"></a>5.13.2 Limiting access to RPC services</h3>

<p>
Unfortunately, in some cases removing RPC services from the system is not an
option.  Some local desktop services (notably SGI's <code>fam</code>) are RPC
based and thus need a local portmapper.  This means that under some situations,
users installing a desktop environment (like GNOME) will install the portmapper
too.
</p>

<p>
There are several ways to limit access to the portmapper and to RPC services:
</p>
<ul>
<li>
<p>
Block access to the ports used by these services with a local firewall (see <a
href="#s-firewall-setup">Adding firewall capabilities, Section 5.14</a>).
</p>
</li>
</ul>
<ul>
<li>
<p>
Block access to these services using tcp wrappers, since the portmapper (and
some RPC services) are compiled with <code>libwrap</code> (see <a
href="ch4.en.html#s-tcpwrappers">Using tcpwrappers, Section 4.11</a>).  This
means that you can block access to them through the <code>hosts.allow</code>
and <code>hosts.deny</code> tcp wrappers configuration.
</p>
</li>
</ul>
<ul>
<li>
<p>
Since version 5-5, the <code>portmap</code> package can be configured to listen
only on the loopback interface.  To do this, modify
<code>/etc/default/portmap</code>, uncomment the following line:
<samp>#OPTIONS=&quot;-i 127.0.0.1&quot;</samp> and restart the portmapper.
This is sufficient to allow local RPC services to work while at the same time
prevents remote systems from accessing them (see, however, <a
href="ch4.en.html#s-limit-bindaddr">Disabling weak-end hosts issues, Section
4.17.5</a>).
</p>
</li>
</ul>

<hr>

<h2><a name="s-firewall-setup"></a>5.14 Adding firewall capabilities</h2>

<p>
The Debian GNU/Linux operating system has the built-in capabilities provided by
the Linux kernel .  If you install a recent Debian release (default kernel
installed is 2.6) you will have <code>iptables</code> (netfilter) firewalling
available[<a href="footnotes.en.html#f47" name="fr47">47</a>].
</p>

<hr>

<h3><a name="s5.14.1"></a>5.14.1 Firewalling the local system</h3>

<p>
You can use firewall rules as a way to secure the access to your local system
and, even, to limit the outbound communications made by it.  Firewall rules can
also be used to protect processes that cannot be properly configured
<em>not</em> to provide services to some networks, IP addresses, etc.
</p>

<p>
However, this step is presented last in this manual basically because it is
<em>much</em> better not to depend solely on firewalling capabilities in order
to protect a given system.  Security in a system is made up of layers,
firewalling should be the last to include, once all services have been
hardened.  You can easily imagine a setup in which the system is solely
protected by a built-in firewall and an administrator blissfully removes the
firewall rules for whatever reason (problems with the setup, annoyance, human
error...), this system would be wide open to an attack if there were no other
hardening in the system to protect from it.
</p>

<p>
On the other hand, having firewall rules on the local system also prevents some
bad things from happening.  Even if the services provided are configured
securely, a firewall can protect from misconfigurations or from fresh installed
services that have not yet been properly configured.  Also, a tight
configuration will prevent trojans <em>calling home</em> from working unless
the firewalling code is removed.  Note that an intruder does <em>not</em> need
superuser access to install a trojan locally that could be remotely controlled
(since binding on ports is allowed if they are not priviledged ports and
capabilities have not been removed).
</p>

<p>
Thus, a proper firewall setup would be one with a default deny policy, that is:
</p>
<ul>
<li>
<p>
incoming connections are allowed only to local services by allowed machines.
</p>
</li>
</ul>
<ul>
<li>
<p>
outgoing connections are only allowed to services used by your system (DNS, web
browsing, POP, email...).[<a href="footnotes.en.html#f48" name="fr48">48</a>]
</p>
</li>
</ul>
<ul>
<li>
<p>
the forward rule denies everything (unless you are protecting other systems,
see below).
</p>
</li>
</ul>
<ul>
<li>
<p>
all other incoming or outgoing connections are denied.
</p>
</li>
</ul>

<hr>

<h3><a name="s5.14.2"></a>5.14.2 Using a firewall to protect other systems</h3>

<p>
A Debian firewall can also be installed in order to protect, with filtering
rules, access to systems <em>behind</em> it, limiting their exposure to the
Internet.  A firewall can be configured to prevent access from systems outside
of the local network to internal services (ports) that are not public.  For
example, on a mail server, only port 25 (where the mail service is being given)
needs to be accessible from the outside.  A firewall can be configured to, even
if there are other network services besides the public ones running in the mail
server, throw away packets (this is known as <em>filtering</em>) directed
towards them.
</p>

<p>
You can even set up a Debian GNU/Linux box as a bridge firewall, i.e.  a
filtering firewall completely transparent to the network that lacks an IP
address and thus cannot be attacked directly.  Depending on the kernel you have
installed, you might need to install the bridge firewall patch and then go to
<em>802.1d Ethernet Bridging</em> when configuring the kernel and a new option
<em>netfilter ( firewalling ) support</em>.  See the <a
href="ap-bridge-fw.en.html">Setting up a bridge firewall, Appendix D</a> for
more information on how to set this up in a Debian GNU/Linux system.
</p>

<hr>

<h3><a name="s5.14.3"></a>5.14.3 Setting up a firewall</h3>

<p>
The default Debian installation, unlike other Linux distributions, does not yet
provide a way for the administrator to setup a firewall configuration
throughout the default installation but you can install a number of firewall
configuration packages (see <a href="#s-firewall-pack">Using firewall packages,
Section 5.14.3.1</a>).
</p>

<p>
Of course, the configuration of the firewall is always system and network
dependant.  An administrator must know beforehand what is the network layout
and the systems he wants to protect, the services that need to be accessed, and
whether or not other network considerations (like NAT or routing) need to be
taken into account.  Be careful when configuring your firewall, as Laurence J.
Lane says in the <code>iptables</code> package:
</p>

<p>
<em>The tools can easily be misused, causing enormous amounts of grief by
completely crippling network access to a system.  It is not terribly uncommon
for a remote system administrator to accidentally lock himself out of a system
hundreds or thousands of miles away.  One can even manage to lock himself out
of a computer who's keyboard is under his fingers.  Please, use due
caution.</em>
</p>

<p>
Remember this: just installing the <code>iptables</code> (or the older
firewalling code) does not give you any protection, just provides the software.
In order to have a firewall you need to <em>configure</em> it!
</p>

<p>
If you do not have a clue on how to set up your firewall rules manually consult
the <em>Packet Filtering HOWTO</em> and <em>NAT HOWTO</em> provided by
<code>iptables</code> for offline reading at
<code>/usr/share/doc/iptables/html/</code>.
</p>

<p>
If you do not know much about firewalling you should start by reading the
<code><a href="http://www.tldp.org/HOWTO/Firewall-HOWTO.html">Firewalling and
Proxy Server HOWTO</a></code>, install the <code>doc-linux-text</code> package
if you want to read it offline.  If you want to ask questions or need help
setting up a firewall you can use the debian-firewall mailing list, see
<code><a
href="http://lists.debian.org/debian-firewall">http://lists.debian.org/debian-firewall</a></code>.
Also see <a href="ch2.en.html#s-references">Be aware of general security
problems, Section 2.2</a> for more (general) pointers on firewalls.  Another
good iptables tutorial is <code><a
href="http://iptables-tutorial.frozentux.net/iptables-tutorial.html">http://iptables-tutorial.frozentux.net/iptables-tutorial.html</a></code>.
</p>

<hr>

<h4><a name="s-firewall-pack"></a>5.14.3.1 Using firewall packages</h4>

<p>
Setting up manually a firewall can be complicated for novice (and sometimes
even expert) administrators.  However, the free software community has created
a number of tools that can be used to easily configure a local firewall.  Be
forewarned that some of these tools are oriented more towards local-only
protection (also known as <em>personal firewall</em>) and some are more
versatile and can be used to configure complex rules to protect whole networks.
</p>

<p>
Some software that can be used to set up firewall rules in a Debian system is:
</p>
<ul>
<li>
<p>
For desktop systems:
</p>
<ul>
<li>
<p>
<code>firestarter</code>, a GNOME application oriented towards end-users that
includes a wizard useful to quickly setup firewall rules.  The application
includes a GUI to be able to monitor when a firewall rule blocks traffic.
</p>
</li>
</ul>
<ul>
<li>
<p>
<code>guarddog</code>, a KDE based firewall configuration package oriented both
to novice and advanced users.
</p>
</li>
</ul>
<ul>
<li>
<p>
<code>knetfilter</code>, a KDE GUI to manage firewall and NAT rules for
iptables (alternative/competitor to the guarddog tool although slightly
oriented towards advanced users).
</p>
</li>
</ul>
<ul>
<li>
<p>
fireflier, an interactive tool to create iptables rules based on traffic seen
on the system and applications.  It has a server-client model so you have to
install both the server (<code>fireflier-server</code>) and one of the
available clients, with one client available for different desktop
environments: <code>fireflier-client-gtk</code> (Gtk+ client),
<code>fireflier-client-kde</code> (KDE client) and
<code>fireflier-client-qt</code> (QT client).
</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>
For servers (headless) systems:
</p>
<ul>
<li>
<p>
<code>fwbuilder</code>, an object oriented GUI which includes policy compilers
for various firewall platforms including Linux' netfilter, BSD's pf (used in
OpenBSD, NetBSD, FreeBSD and MacOS X) as well as router's access-lists.  It is
similar to enterprise firewall management software.  Complete fwbuilder's
functionality is also available from the command line.
</p>
</li>
</ul>
<ul>
<li>
<p>
<code>shorewall</code>, a firewall configuration tool which provides support
for IPsec as well as limited support for traffic shaping as well as the
definition of the firewall rules.  Configuration is done through a simple set
of files that are used to generate the iptables rules.
</p>
</li>
</ul>
<ul>
<li>
<p>
<code>bastille</code>, this hardening application is described in <a
href="ch-automatic-harden.en.html">Automatic hardening of Debian systems,
Chapter 6</a>.  One of the hardening steps that the administrator can configure
is a definition of the allowed and disallowed network traffic that is used to
generate a set of firewall rules that the system will execute on startup.
</p>
</li>
</ul>
</li>
</ul>

<p>
Lots of other iptables frontends come with Debian; an extensive list comparing
the different packages in Debian is maintained at the <code><a
href="http://wiki.debian.org/Firewalls">Firewalls page on the Debian
wiki</a></code>.
</p>

<p>
Notice that some of the packages outlined previously will introduce firewalling
scripts to be run when the system boots.  Test them extensively before
rebooting or you might find yourself locked from the box.  If you mix different
firewalling packages you can have undesired effects, usually, the firewalling
script that runs last will be the one that configures the system (which might
not be what you intend).  Consult the package documentation and use either one
of these setups.
</p>

<p>
As mentioned before, some programs, like <code>firestarter</code>,
<code>guarddog</code> and <code>knetfilter</code>, are administration GUIs
using either GNOME or KDE (last two).  These applications are much more
user-oriented (i.e.  for home users) than some of the other packages in the
list which might be more administrator-oriented.  Some of the programs
mentioned before (like <code>bastille</code>) are focused at setting up
firewall rules to protect the host they run in but are not necessarily designed
to setup firewall rules for firewall hosts that protect a network (like
<code>shorewall</code> or <code>fwbuilder</code>).
</p>

<p>
There is yet another type of firewall application: application proxies.  If you
are looking into setting up an enterprise-level firewall that does packet
filtering and provides a number of transparent proxies that can do fine-grain
traffic analysis you should consider using <code>zorp</code>, which provides
this in a single program.  You can also manually setup this type of firewall
host using the proxies available in Debian for different services like for DNS
using <code>bind</code> (properly configured), <code>dnsmasq</code>,
<code>pdnsd</code> or <code>totd</code> for FTP using <code>frox</code> or
<code>ftp-proxy</code>, for X11 using <code>xfwp</code>, for IMAP using
<code>imapproxy</code>, for mail using <code>smtpd</code>, or for POP3 using
<code>p3scan</code>.  For other protocols you can either use a generic TCP
proxy like <code>simpleproxy</code> or a generic SOCKS proxy like
<code>dante-server</code>, <code>tsocks</code> or <code>socks4-server</code>.
Typically, you will also use a web caching system (like <code>squid</code>) and
a web filtering system (like <code>squidguard</code> or
<code>dansguardian</code>).
</p>

<hr>

<h4><a name="s5.14.3.2"></a>5.14.3.2 Manual init.d configuration</h4>

<p>
Another possibility is to manually configure your firewall rules through an
init.d script that will run all the <code>iptables</code> commands.  Take the
following steps:
</p>
<ul>
<li>
<p>
Review the script below and adapt it to your needs.
</p>
</li>
</ul>
<ul>
<li>
<p>
Test the script and review the syslog messages to see which traffic is being
dropped.  If you are testing from the network you will want to either run the
sample shell snippet to remove the firewall (if you don't type anything in 20
seconds) or you might want to comment out the <em>default deny</em> policy
definitions (<em>-P INPUT DROP</em> and <em>-P OUTPUT DROP</em>) and check that
the system will not drop any legitimate traffic.
</p>
</li>
</ul>
<ul>
<li>
<p>
Move the script to <code>/etc/init.d/myfirewall</code>
</p>
</li>
</ul>
<ul>
<li>
<p>
Configure the system to run the script before any network is configured:
</p>

<pre>
     #update-rc.d myfirewall start 40 S . stop 89 0 6 .
</pre>
</li>
</ul>

<p>
This is the sample firewall script:
</p>

<pre>
     #!/bin/sh
     # Simple example firewall configuration.
     #
     # Caveats:
     # - This configuration applies to all network interfaces
     #   if you want to restrict this to only a given interface use
     #   '-i INTERFACE' in the iptables calls.
     # - Remote access for TCP/UDP services is granted to any host, 
     #   you probably will want to restrict this using '--source'.
     #
     # chkconfig: 2345 9 91
     # description: Activates/Deactivates the firewall at boot time
     #
     # You can test this script before applying with the following shell
     # snippet, if you do not type anything in 10 seconds the firewall
     # rules will be cleared.
     #---------------------------------------------------------------
     #  while true; do test=&quot;&quot;; read  -t 20 -p &quot;OK? &quot; test ; \
     #  [ -z &quot;$test&quot; ] &amp;&amp; /etc/init.d/myfirewall clear ; done
     #---------------------------------------------------------------
     
     PATH=/bin:/sbin:/usr/bin:/usr/sbin
     
     # Services that the system will offer to the network
     TCP_SERVICES=&quot;22&quot; # SSH only
     UDP_SERVICES=&quot;&quot;
     # Services the system will use from the network
     REMOTE_TCP_SERVICES=&quot;80&quot; # web browsing
     REMOTE_UDP_SERVICES=&quot;53&quot; # DNS
     # Network that will be used for remote mgmt
     # (if undefined, no rules will be setup)
     # NETWORK_MGMT=192.168.0.0/24
     # Port used for the SSH service, define this is you have setup a
     # management network but remove it from TCP_SERVICES
     # SSH_PORT=&quot;22&quot;
     
     if ! [ -x /sbin/iptables ]; then  
         exit 0
     fi
     
     fw_start () {
     
       # Input traffic:
       /sbin/iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
       # Services
       if [ -n &quot;$TCP_SERVICES&quot; ] ; then
       for PORT in $TCP_SERVICES; do
         /sbin/iptables -A INPUT -p tcp --dport ${PORT} -j ACCEPT
       done
       fi
       if [ -n &quot;$UDP_SERVICES&quot; ] ; then
       for PORT in $UDP_SERVICES; do
         /sbin/iptables -A INPUT -p udp --dport ${PORT} -j ACCEPT
       done
       fi
       # Remote management
       if [ -n &quot;$NETWORK_MGMT&quot; ] ; then
         /sbin/iptables -A INPUT -p tcp --src ${NETWORK_MGMT} --dport ${SSH_PORT} -j ACCEPT
       else 
         /sbin/iptables -A INPUT -p tcp --dport ${SSH_PORT}  -j ACCEPT
       fi
       # Remote testing
       /sbin/iptables -A INPUT -p icmp -j ACCEPT
       /sbin/iptables -A INPUT -i lo -j ACCEPT
       /sbin/iptables -P INPUT DROP
       /sbin/iptables -A INPUT -j LOG
     
       # Output:
       /sbin/iptables -A OUTPUT -j ACCEPT -o lo 
       /sbin/iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
       # ICMP is permitted:
       /sbin/iptables -A OUTPUT -p icmp -j ACCEPT
       # So are security package updates:
       # Note: You can hardcode the IP address here to prevent DNS spoofing
       # and to setup the rules even if DNS does not work but then you 
       # will not &quot;see&quot; IP changes for this service:
       /sbin/iptables -A OUTPUT -p tcp -d security.debian.org --dport 80 -j ACCEPT 
       # As well as the services we have defined:
       if [ -n &quot;$REMOTE_TCP_SERVICES&quot; ] ; then
       for PORT in $REMOTE_TCP_SERVICES; do
         /sbin/iptables -A OUTPUT -p tcp --dport ${PORT} -j ACCEPT
       done
       fi
       if [ -n &quot;$REMOTE_UDP_SERVICES&quot; ] ; then
       for PORT in $REMOTE_UDP_SERVICES; do
         /sbin/iptables -A OUTPUT -p udp --dport ${PORT} -j ACCEPT
       done
       fi
       # All other connections are registered in syslog
       /sbin/iptables -A OUTPUT -j LOG
       /sbin/iptables -A OUTPUT -j REJECT 
       /sbin/iptables -P OUTPUT DROP
       # Other network protections
       # (some will only work with some kernel versions)
       echo 1 &gt; /proc/sys/net/ipv4/tcp_syncookies
       echo 0 &gt; /proc/sys/net/ipv4/ip_forward 
       echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts 
       echo 1 &gt; /proc/sys/net/ipv4/conf/all/log_martians 
       echo 1 &gt; /proc/sys/net/ipv4/ip_always_defrag
       echo 1 &gt; /proc/sys/net/ipv4/icmp_ignore_bogus_error_responses
       echo 1 &gt; /proc/sys/net/ipv4/conf/all/rp_filter
       echo 0 &gt; /proc/sys/net/ipv4/conf/all/send_redirects
       echo 0 &gt; /proc/sys/net/ipv4/conf/all/accept_source_route
     
     }
     
     fw_stop () {
       /sbin/iptables -F
       /sbin/iptables -t nat -F
       /sbin/iptables -t mangle -F
       /sbin/iptables -P INPUT DROP
       /sbin/iptables -P FORWARD DROP
       /sbin/iptables -P OUTPUT ACCEPT
     }
     
     fw_clear () {
       /sbin/iptables -F
       /sbin/iptables -t nat -F
       /sbin/iptables -t mangle -F
       /sbin/iptables -P INPUT ACCEPT
       /sbin/iptables -P FORWARD ACCEPT
       /sbin/iptables -P OUTPUT ACCEPT
     }
     
     
     case &quot;$1&quot; in
       start|restart)
         echo -n &quot;Starting firewall..&quot;
         fw_stop 
         fw_start
         echo &quot;done.&quot;
         ;;
       stop)
         echo -n &quot;Stopping firewall..&quot;
         fw_stop
         echo &quot;done.&quot;
         ;;
       clear)
         echo -n &quot;Clearing firewall rules..&quot;
         fw_clear
         echo &quot;done.&quot;
         ;;
       *)
         echo &quot;Usage: $0 {start|stop|restart|clear}&quot;
         exit 1
         ;;
       esac
     exit 0
</pre>

<p>
Instead of including all of the iptables rules in the init.d script you can use
the <code>iptables-restore</code> program to restore the rules saved using
<code>iptables-save</code>.  In order to do this you need to setup your rules,
save the ruleset under a static location (such as
<code>/etc/default/firewall</code>)
</p>

<hr>

<h4><a name="s5.14.3.3"></a>5.14.3.3 Configuring firewall rules through <code>ifup</code></h4>

<p>
You can use also the network configuration in
<code>/etc/network/interfaces</code> to setup your firewall rules.  For this
you will need to:
</p>
<ul>
<li>
<p>
Create your firewalling ruleset for when the interface is active.
</p>
</li>
</ul>
<ul>
<li>
<p>
Save your ruleset with <code>iptables-save</code> to a file in
<code>/etc</code>, for example <code>/etc/iptables.up.rules</code>
</p>
</li>
</ul>
<ul>
<li>
<p>
Configure <code>/etc/network/interfaces</code> to use the configured ruleset:
</p>

<pre>
     iface eth0 inet static
             address x.x.x.x
             [.. interface configuration ..]
             pre-up iptables-restore &lt; /etc/iptables.up.rules
</pre>
</li>
</ul>

<p>
You can optionally also setup a set of rules to be applied when the network
interface is <em>down</em> creating a set of rules, saving it in
<code>/etc/iptables.down.rules</code> and adding this directive to the
interface configuration:
</p>

<pre>
         post-down iptables-restore &lt; /etc/iptables.down.rules
</pre>

<p>
For more advanced firewall configuration scripts through <code>ifupdown</code>
you can use the hooks available to each interface as in the <code>*.d/</code>
directories called with <code>run-parts</code> (see <code>run-parts(8)</code>).
</p>

<hr>

<h4><a name="s5.14.3.4"></a>5.14.3.4 Testing your firewall configuration</h4>

<p>
Testing your firewall configuration is as easy, and as dangerous, as just
running your firewall script (or enabling the configuration you defined in your
firewall configuration application).  However, if you are not careful enough
and you are configuring your firewall remotely (like through an SSH connection)
you could lock yourself out.
</p>

<p>
There are several ways to prevent this.  One is running a script in a separate
terminal that will remove the firewall configuration if you don't feed it
input.  An example of this is:
</p>

<pre>
     $  while true; do test=&quot;&quot;; read  -t 20 -p &quot;OK? &quot; test ; \
       [ -z &quot;$test&quot; ] &amp;&amp; /etc/init.d/firewall clear ; done
</pre>

<p>
Another one is to introduce a backdoor in your system through an alternate
mechanism that allows you to either clear the firewall system or punch a hole
in it if something goes awry.  For this you can use <code>knockd</code> and
configure it so that a certain port connection attempt sequence will clear the
firewall (or add a temporary rule).  Even though the packets will be dropped by
the firewall, since <code>knockd</code> binds to the interface and
<em>sees</em> you will be able to work around the problem.
</p>

<p>
Testing a firewall that is protecting an internal network is a different issue,
you will want to look at some of the tools used for remote vulnerability
assessment (see <a href="ch-sec-tools.en.html#s-vuln-asses">Remote
vulnerability assessment tools, Section 8.1</a>) to probe the network from the
outside in (or from any other direction) to test the effectiveness of the
firewall configuation.
</p>

<hr>

<p>
[ <a href="ch4.en.html">previous</a> ]
[ <a href="index.en.html#contents">Contents</a> ]
[ <a href="ch1.en.html">1</a> ]
[ <a href="ch2.en.html">2</a> ]
[ <a href="ch3.en.html">3</a> ]
[ <a href="ch4.en.html">4</a> ]
[ 5 ]
[ <a href="ch-automatic-harden.en.html">6</a> ]
[ <a href="ch7.en.html">7</a> ]
[ <a href="ch-sec-tools.en.html">8</a> ]
[ <a href="ch9.en.html">9</a> ]
[ <a href="ch10.en.html">10</a> ]
[ <a href="ch-after-compromise.en.html">11</a> ]
[ <a href="ch12.en.html">12</a> ]
[ <a href="ap-harden-step.en.html">A</a> ]
[ <a href="ap-checklist.en.html">B</a> ]
[ <a href="ap-snort-box.en.html">C</a> ]
[ <a href="ap-bridge-fw.en.html">D</a> ]
[ <a href="ap-bind-chuser.en.html">E</a> ]
[ <a href="ap-fw-security-update.en.html">F</a> ]
[ <a href="ap-chroot-ssh-env.en.html">G</a> ]
[ <a href="ap-chroot-apache-env.en.html">H</a> ]
[ <a href="ch-automatic-harden.en.html">next</a> ]
</p>

<hr>

<p>
Securing Debian Manual
</p>

<address>
Version: 3.13, Sun, 08 Apr 2012 02:48:09 +0000<br>
<br>
Javier Fern&aacute;ndez-Sanguino Pe&ntilde;a <code><a href="mailto:jfs@debian.org">jfs@debian.org</a></code><br>
<a href="ch1.en.html#s-authors">Authors, Section 1.1</a><br>
<br>
</address>
<hr>

</body>

</html>

