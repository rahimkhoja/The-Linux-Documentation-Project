<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML
><HEAD
><TITLE
>Construction</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
TITLE="Pocket Linux Guide"
HREF="index.html"><LINK
REL="UP"
TITLE="Enabling Multiple Users"
HREF="phase6.html"><LINK
REL="PREVIOUS"
TITLE="Design"
HREF="x1265.html"><LINK
REL="NEXT"
TITLE="Implementation"
HREF="x1517.html"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Pocket Linux Guide</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x1265.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 7. Enabling Multiple Users</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x1517.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="AEN1378"
></A
>7.3. Construction</H1
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1380"
></A
>7.3.1. Verify presence of getty and login</H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> ls ~/staging/sbin/getty
<TT
CLASS="prompt"
>bash#</TT
> ls ~/staging/bin/login</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1386"
></A
>7.3.2. Modify inittab for multi-user mode</H2
><P
>Modify <TT
CLASS="filename"
>~/staging/etc/inittab</TT
> by changing the
      default runlevel and adding <B
CLASS="command"
>getty</B
> entries as shown
      below.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
># /etc/inittab - init daemon configuration file
#
# Default runlevel
id:2:initdefault:
#
# System initialization
si:S:sysinit:/etc/init.d/rc S
#
# Runlevel scripts
r0:0:wait:/etc/init.d/rc 0
r1:1:respawn:/bin/sh
r2:2:wait:/etc/init.d/rc 2
r3:3:wait:/etc/init.d/rc 3
r4:4:wait:/etc/init.d/rc 4
r5:5:wait:/etc/init.d/rc 5
r6:6:wait:/etc/init.d/rc 6
#
# Spawn virtual terminals
1:235:respawn:/sbin/getty 38400 tty1 linux
2:235:respawn:/sbin/getty 38400 tty2 linux
3:235:respawn:/sbin/getty 38400 tty3 linux
4:235:respawn:/sbin/getty 38400 tty4 linux
5:235:respawn:/sbin/getty 38400 tty5 linux
6:2345:respawn:/sbin/getty 38400 tty6 linux
#
# end of /etc/inittab</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1393"
></A
>7.3.3. Create tty devices</H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> cd ~/staging/dev
<TT
CLASS="prompt"
>bash#</TT
> mknod ~/staging/dev/tty0 c 4 0
<TT
CLASS="prompt"
>bash#</TT
> mknod ~/staging/dev/tty1 c 4 1
<TT
CLASS="prompt"
>bash#</TT
> mknod ~/staging/dev/tty2 c 4 2
<TT
CLASS="prompt"
>bash#</TT
> mknod ~/staging/dev/tty3 c 4 3
<TT
CLASS="prompt"
>bash#</TT
> mknod ~/staging/dev/tty4 c 4 4
<TT
CLASS="prompt"
>bash#</TT
> mknod ~/staging/dev/tty5 c 4 5
<TT
CLASS="prompt"
>bash#</TT
> mknod ~/staging/dev/tty6 c 4 6
<TT
CLASS="prompt"
>bash#</TT
> mknod ~/staging/dev/tty c 5 0</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1406"
></A
>7.3.4. Create support files in /etc</H2
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1408"
></A
>7.3.4.1. /etc/issue</H3
><P
>Create the file <TT
CLASS="filename"
>~/staging/etc/issue</TT
> using
        the example below or design a customized message.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
>Connected to \l at \b bps.</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Be sure that "\l" is a lowercase letter L and not the number
        one.</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1415"
></A
>7.3.4.2. /etc/passwd</H3
><P
>Use a text editor to create a minimal passwd file conforming to
        the Linux Standards Base (LSB) document. Save the file as
        <TT
CLASS="filename"
>~/staging/etc/passwd</TT
></P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
>root::0:0:Super User:/root:/bin/sh
bin:x:1:1:Legacy UID:/bin:/bin/false
daemon:x:2:2:Legacy UID:/sbin:/bin/false</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1421"
></A
>7.3.4.3. /etc/group</H3
><P
>Use a text editor to create an LSB conforming group file and
        save it as <TT
CLASS="filename"
>~/staging/etc/group</TT
></P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
>root::0:root
bin:x:1:root,bin,daemon
daemon:x:2:root,bin,daemon</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1427"
></A
>7.3.4.4. /etc/nsswitch.conf</H3
><P
>Create the following file and save it as
        <TT
CLASS="filename"
>~/staging/etc/nsswitch.conf</TT
></P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
>passwd: files
group:  files</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1433"
></A
>7.3.5. Copy required libraries</H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> cp /lib/libnss_files.so.2 ~/staging/lib
bash# strip --strip-unneeded ~/staging/lib/*</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1438"
></A
>7.3.6. Set directory and file permissions</H2
><P
>Set minimal privileges on all files and directories under
      <TT
CLASS="filename"
>~/staging</TT
>. Everything is owned by the root user and
      the root group. Permissions are read-write for the owner and read-only
      for the group. Exceptions to the blanket permissions are handled case by
      case.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> cd ~/staging
<TT
CLASS="prompt"
>bash#</TT
> chown -R 0:0 ~/staging/*
<TT
CLASS="prompt"
>bash#</TT
> chmod -R 640 ~/staging/*</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Set execute permission on all directories. (Note the capital
      "X")</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> chmod -R +X ~/staging/*</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Files in <TT
CLASS="filename"
>/bin</TT
> are read and execute for all,
      but <TT
CLASS="filename"
>su</TT
> is an exception.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> chmod 755 ~/staging/bin/*
<TT
CLASS="prompt"
>bash#</TT
> chmod 4750 ~/staging/bin/su</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Files in <TT
CLASS="filename"
>/dev</TT
> have various permissions. Disk
      devices should be accessible to administrators only. Other files like
      <TT
CLASS="filename"
>/dev/null</TT
> should have full privileges granted to
      everyone.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> chmod 660 ~/staging/dev/fd0 dev/ram0
<TT
CLASS="prompt"
>bash#</TT
> chmod 666 ~/staging/dev/null
<TT
CLASS="prompt"
>bash#</TT
> chmod 622 ~/staging/dev/console
<TT
CLASS="prompt"
>bash#</TT
> chmod 600 ~/staging/dev/initctl
<TT
CLASS="prompt"
>bash#</TT
> chmod 622 ~/staging/dev/tty
<TT
CLASS="prompt"
>bash#</TT
> chmod 622 ~/staging/dev/tty?</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The <TT
CLASS="filename"
>passwd</TT
> and <TT
CLASS="filename"
>group</TT
>
      files must be world readable.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> chmod 644 ~/staging/etc/passwd
<TT
CLASS="prompt"
>bash#</TT
> chmod 644 ~/staging/etc/group</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The scripts in <TT
CLASS="filename"
>/etc/init.d</TT
> are read and
      execute for administrators.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> chmod 750 ~/staging/etc/init.d/*</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Libraries need read and execute permissions for everyone.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> chmod 755 ~/staging/lib/*</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Only root should have access to the <TT
CLASS="filename"
>/root</TT
>
      directory.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> chmod 700 ~/staging/root</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Make files in <TT
CLASS="filename"
>/sbin</TT
> read and execute for
      administrators.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> chmod 750 ~/staging/sbin/*</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>Temp should be read-write for all with the sticky bit set.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> chmod 1777 ~/staging/tmp</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1499"
></A
>7.3.7. Create the root disk image</H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> cd /
<TT
CLASS="prompt"
>bash#</TT
> dd if=/dev/zero of=/dev/ram7 bs=1k count=4096
<TT
CLASS="prompt"
>bash#</TT
> mke2fs -m0 /dev/ram7 4096
<TT
CLASS="prompt"
>bash#</TT
> mount /dev/ram7 /mnt
<TT
CLASS="prompt"
>bash#</TT
> cp -dpR ~/staging/* /mnt
<TT
CLASS="prompt"
>bash#</TT
> umount /dev/ram7
<TT
CLASS="prompt"
>bash#</TT
> dd if=/dev/ram7 of=~/phase6-image bs=1k count=4096
<TT
CLASS="prompt"
>bash#</TT
> gzip -9 ~/phase6-image</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1511"
></A
>7.3.8. Copy the image to diskette</H2
><P
>Insert the diskette labeled "root disk" into drive fd0.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> dd if=~/phase6-image.gz of=/dev/fd0 bs=1k</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x1265.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x1517.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Design</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="phase6.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Implementation</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>