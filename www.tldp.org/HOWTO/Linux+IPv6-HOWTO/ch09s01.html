<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>1. Types of tunnels</title><link rel="stylesheet" type="text/css" href="style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Linux IPv6 HOWTO (en)"><link rel="up" href="ch09.html" title="Chapter 9. Configuring IPv6-in-IPv4 tunnels"><link rel="prev" href="ch09.html" title="Chapter 9. Configuring IPv6-in-IPv4 tunnels"><link rel="next" href="ch09s02.html" title="2. Displaying existing tunnels"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1. Types of tunnels</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch09.html">Prev</a> </td><th width="60%" align="center">Chapter 9. Configuring IPv6-in-IPv4 tunnels</th><td width="20%" align="right"> <a accesskey="n" href="ch09s02.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp50793600"></a>1. Types of tunnels</h2></div></div></div><p>There are more than one possibility to tunnel IPv6 packets over IPv4-only links.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp50794592"></a>1.1. Static point-to-point tunneling</h3></div></div></div><p>A point-to-point tunnel is a dedicated tunnel to an endpoint, which knows about your IPv6 network (for backward routing) and the IPv4 address of your tunnel endpoint and defined in <a class="ulink" href="http://www.faqs.org/rfcs/rfc4213.html" target="_top">RFC 4213 / Basic Transition Mechanisms for IPv6 Hosts and Routers</a>. Requirements:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>IPv4 address of your local tunnel endpoint must be static, global unique and reachable from the foreign tunnel endpoint
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>If no static IPv4 address is available, the tunnel provider must support authentication of the dynamic IPv4 address, like <a class="ulink" href="http://www.sixxs.net/" target="_top">SixXS / AICCU</a> (3740/udp) or <a class="ulink" href="http://gogo6.com/" target="_top">gogo6</a> (3653/udp).</p></li></ul></div></li><li class="listitem"><p>A global IPv6 prefix assigned to you
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>It is also possible that additional IPv6 networks are routed through this tunnel.</p></li></ul></div></li><li class="listitem"><p>A foreign tunnel endpoint which is capable to route your IPv6 prefix to your local tunnel endpoint (mostly remote manual configuration required)</p></li></ul></div><p>Tunnel provider for static point-to-point tunneling:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="ulink" href="http://he.com/" target="_top">Hurricane Electric</a></p></li><li class="listitem"><p><a class="ulink" href="http://www.sixxs.net/" target="_top">SixXS</a></p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp50802880"></a>1.2. Automatically tunneling</h3></div></div></div><p>Automatic tunneling occurs, when a node directly connects another node gotten the IPv4 address of the other node before.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="tunneling-6to4."></a>1.3. 6to4-Tunneling</h3></div></div></div><p>6to4 tunneling (<a class="ulink" href="http://www.faqs.org/rfcs/rfc3056.html" target="_top">RFC 3056 / Connection of IPv6 Domains via IPv4 Clouds</a>) uses a simple mechanism to create automatic tunnels. Each node with a global unique IPv4 address is able to be a 6to4 tunnel endpoint (if no IPv4 firewall prohibits traffic). 6to4 tunneling is mostly not a one-to-one tunnel. This case of tunneling can be divided into upstream and downstream tunneling. Also, a special IPv6 address indicates that this node will use 6to4 tunneling for connecting the world-wide IPv6 network</p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idp50806272"></a>1.3.1. Generation of 6to4 prefix</h4></div></div></div><p>The 6to4 address is defined like following (schema is taken from <a class="ulink" href="http://www.faqs.org/rfcs/rfc3056.html" target="_top">RFC 3056 / Connection of IPv6 Domains via IPv4 Clouds</a>):</p><pre class="screen">
|   3+13   |    32     |    16  |            64 bits             | 
+---+------+-----------+--------+--------------------------------+ 
|  FP+TLA  |  V4ADDR   | SLA ID |           Interface ID         | 
|  0x2002  |           |        |                                | 
+---+------+-----------+--------+--------------------------------+
</pre><p>FP and TLA together (16 bits) have the value 0x2002. V4ADDR is the node's global unique IPv4 address (in hexadecimal notation). SLA is the subnet identifier (65536 local subnets possible) and are usable to represent your local network structure.</p><p>For gateways, such prefix is generated by normally using SLA &#8221;0000&#8221; and suffix &#8221;::1&#8221; (not a must, can be an arbitrary one with local-scope) and assigned to the 6to4 tunnel interface. Note that Microsoft Windows uses V4ADDR also for suffix.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idp50810512"></a>1.3.2. 6to4 upstream tunneling</h4></div></div></div><p>The node has to know to which foreign tunnel endpoint its in IPv4 packed IPv6 packets should be send to. In &#8221;early&#8221; days of 6to4 tunneling, dedicated upstream accepting routers were defined. See  <a class="ulink" href="http://www.kfu.com/~nsayer/6to4/" target="_top">NSayer's 6to4 information</a> for a list of routers.</p><p>Nowadays, 6to4 upstream routers can be found auto-magically using the anycast address 192.88.99.1. In the background routing protocols handle this, see <a class="ulink" href="http://www.faqs.org/rfcs/rfc3068.html" target="_top">RFC 3068 / An Anycast Prefix for 6to4 Relay Routers</a> for details. </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idp50813632"></a>1.3.3. 6to4 downstream tunneling</h4></div></div></div><p>The downstream (IPv6 backbone -&gt; your 6to4 enabled node) is not really fix and can vary from foreign host which originated packets were send to. There exist two possibilities:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Foreign host uses 6to4 and sends packet direct back to your node (see below)</p></li><li class="listitem"><p>Foreign host sends packets back to the world-wide IPv6 network and depending on the dynamic routing a relay router of an ISP which announces 2002::/16 via BGP will create a automatic tunnel back to your node.</p></li></ul></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idp50816304"></a>1.3.4. Possible 6to4 traffic</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>from 6to4 to 6to4: is normally directly tunneled between the both 6to4 enabled hosts</p></li><li class="listitem"><p>from 6to4 to non-6to4: is sent via upstream tunneling</p></li><li class="listitem"><p>non-6to4 to 6to4: is sent via downstream tunneling</p></li></ul></div><p>Note, that because of possible asymmetric routing problems with a broken 6to4 relay can be hard to troubleshoot.</p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idp50818832"></a>1.4. UDP encapsulated IPv6 tunneling</h3></div></div></div><p>UDP encapsulated IPv6 tunneling is usally used if no global IPv4 address is available on the internal endpoint, but using Network Adress Translation (NAT) it can still reach related endpoints using UDP ports described below.</p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idp50819968"></a>1.4.1. Teredo Tunnel</h4></div></div></div><p><a class="ulink" href="http://www.faqs.org/rfcs/rfc4380.html" target="_top">RFC 4380 / Teredo: Tunneling IPv6 over UDP through Network Address Translations</a>describes tunneling of IPv6 packets via IPv4 UDP bubbles, see also <a class="ulink" href="http://de.wikipedia.org/wiki/Teredo" target="_top">Wikipedia / Teredo</a>. It uses usually 3544/udp. Linux client is named <a class="ulink" href="http://www.remlab.net/miredo/" target="_top">miredo</a> and usable out-of-the-box. This tunnel method can only connect a single client to the global IPv6 network..</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idp50822912"></a>1.4.2. AYIYA Tunnel</h4></div></div></div><p>Tunnel provider <a class="ulink" href="http://www.sixxs.net/" target="_top">SixXS</a> has also IPv6-in-UDP-in-IPv4 (5072/udp) capability, for using it, the AYIYA mode must be enabled.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idp50824544"></a>1.4.3. gogo6 Tunnel</h4></div></div></div><p>Tunnel provider <a class="ulink" href="http://gogo6.com/" target="_top">gogo6</a> has also IPv6-in-UDP-in-IPv4 (3653/udp) capability, for using it, the v6udpv4 mode must be enabled.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch09.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch09.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch09s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 9. Configuring IPv6-in-IPv4 tunnels </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 2. Displaying existing tunnels</td></tr></table></div></body></html>
