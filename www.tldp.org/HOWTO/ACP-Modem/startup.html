<HTML
><HEAD
><TITLE
>Compilation, Installation, and Startup</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"><LINK
REL="HOME"
TITLE="Linux ACP Modem (Mwave) mini-HOWTO"
HREF="index.html"><LINK
REL="PREVIOUS"
TITLE="General Information and Hardware Requirements"
HREF="generalinfo.html"><LINK
REL="NEXT"
TITLE="Resolving Installation and Configuration Problems"
HREF="problems.html"></HEAD
><BODY
CLASS="SECT1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Linux ACP Modem (Mwave) mini-HOWTO</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="generalinfo.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="problems.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="STARTUP">2. Compilation, Installation, and Startup</H1
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="PREREQUISITES">2.1. Prerequisites</H2
><P
></P
><UL
><LI
><P
>A 2.2.16 series (or later) Linux kernel source tree</P
></LI
><LI
><P
>An appropriate set of module utilities</P
></LI
><LI
><P
>gcc version 2.7.x or later</P
></LI
></UL
><P
>If you are building the ACP Modem driver along with the user space application,

        you need to have a complete Linux source tree for your

        kernel, not just an up-to-date kernel image.</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="BUILDING">2.2. Building and Installing Source</H2
><P
></P
><OL
TYPE="1"
><LI
><P
>Use <B
CLASS="COMMAND"
>tar xzvf</B
> <TT
CLASS="FILENAME"
>mwavem-yyyymmdd.tar.gz</TT
> to unpack the distribution.</P
></LI
><LI
><P
>Change directories with <B
CLASS="COMMAND"
>cd <TT
CLASS="FILENAME"
>mwavem-yyyymmdd</TT
></B
></P
></LI
><LI
><P
>Use the <B
CLASS="COMMAND"
>./configure</B
> command to configure the build options.  Issue <B
CLASS="COMMAND"
>./configure --help</B
> to view all of the options.  The defaults are probably okay though.</P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>NOTE</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>As of mwavem-1.0.3 you must give ./configure the --enable-mwavedd argument in order to build the driver with the user space application.</P
></TD
></TR
></TABLE
></DIV
></LI
><LI
><P
>Use the <B
CLASS="COMMAND"
>make</B
> command to build all of the ACP Modem binaries.</P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>NOTE</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Your gcc package should be at least at the 2.7.x level.

              Check your <TT
CLASS="FILENAME"
>/usr/src/linux/Documentation/Changes</TT
> file for

              the minimum version information.</P
></TD
></TR
></TABLE
></DIV
></LI
><LI
><P
>Use <B
CLASS="COMMAND"
>make install</B
> to install the <TT
CLASS="FILENAME"
>mwavem</TT
> binary, <TT
CLASS="FILENAME"
>mwavem.conf</TT
> configuration, the extra binary (mostly .dsp) files, and module device driver

        (if you specified that it must be built) and to create the <TT
CLASS="FILENAME"
>/dev/modems/mwave</TT
> device node. </P
></LI
></OL
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="SETUP">2.3. Setting Things Up</H2
><P
>In the [WORLDTRADE] section of your <TT
CLASS="FILENAME"
>mwavem.conf</TT
> file, set the Country=

   	parameter to your country access code.</P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>NOTE</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>The <TT
CLASS="FILENAME"
>mwavem.conf</TT
> file is installed in the <TT
CLASS="FILENAME"
>/usr/local/etc</TT
> directory unless you specified otherwise during the build process</P
></TD
></TR
></TABLE
></DIV
><P
>Country information (including access codes) are listed in the 

	<TT
CLASS="FILENAME"
>mwavem.conf</TT
> file. For example, for France the following section is present:</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="PROGRAMLISTING"
>&#13;[Telephony\Country List\33]

CountryCode=00000021

Name=France

SameAreaRule=0FG

LongDistanceRule=0FG

InternationsalRule=00EFG</PRE
></FONT
></TD
></TR
></TABLE
><P
>To set France to be your configured country in the [WORLDTRADE] section of

   	<TT
CLASS="FILENAME"
>mwavem.conf</TT
>, <TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>set Country=33</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="RUNTIME">2.4. Runtime</H2
><P
>An initialization script has been provided which may be used to 

			to start, stop, or check the status of the ACP Modem driver and application. It has been successfully run on the Debian, Slackware, SuSE, and Red Hat distributions and should run on any of their derivitives.  If you are using

			the runtime script, it will load the mwave device driver module, configure the serial port, and start the mwave manager for you.

			All of the options which can be passed to the device driver module, along with some options for the script itself,

			can be configured by uncommenting and editing the appropriate

			variables at the beginning of the script.

			</P
><P
>The <B
CLASS="COMMAND"
>mwaved</B
> startup script can be found in the <TT
CLASS="FILENAME"
>src/mwavem</TT
> directory of the source distribution.  If you are running the Red Hat distribution, you can copy the script to your <TT
CLASS="FILENAME"
>/etc/rc.d/init.d</TT
> directory and issue the <B
CLASS="COMMAND"
>ntsysv</B
> command in order to enable it at boot time.

			If not using Red Hat, see the documentation for your distribution for information on how to set this up to run at boot time.

			</P
><P
>It is recommended that you use the provided <B
CLASS="COMMAND"
>mwaved</B
> script.  If you are not using 

			the script, however, the following sections will describe how to manually start the device driver and application.</P
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="LOAD">2.4.1. Loading the ACP device driver</H3
><P
>To load the mwave device driver use 

					<TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>insmod mwave</PRE
></FONT
></TD
></TR
></TABLE
> or 

                <TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>modprobe mwave</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>The following arguments may be supplied with the <B
CLASS="COMMAND"
>insmod</B
> command:</P
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>NOTE</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
> The following arguments are not persistent from boot to boot 

				(i.e. We are not saving them in the BIOS).</P
></TD
></TR
></TABLE
></DIV
><P
></P
><UL
><LI
><P
>mwave_3780i_irq=5/7/10/11/15</P
><P
>This parameter allows you to configure the IRQ used by the DSP if the DSP IRQ was not set 

						and stored in BIOS by the Thinkpad&#8482; configuration utility.</P
></LI
><LI
><P
>mwave_3780i_io=0x130/0x350/0x0070/0xDB0</P
><P
>This parameter allows you to configure the I/O range used by the DSP if the DSP I/O range was not set

						and stored in the BIOS by the Thinkpad&#8482; configuration utility. </P
></LI
><LI
><P
>mwave_uart_irq=3/4</P
><P
>This parameter allows you to configure the IRQ used by the ACP UART if the Mwave's UART

						IRQ was not set and stored in BIOS by the Thinkpad&#8482; configuration utility.</P
></LI
><LI
><P
>mwave_uart_io=0x3f8/0x2f8/0x3E8/0x2E8</P
><P
>This parameter allows you to configure the I/O range used by the ACP UART if the UART I/O 

						range was not set and stored in BIOS by the Thinkpad&#8482; configuration utility.</P
></LI
></UL
><P
>The following code is an example of how to run DSP using ttyS1 resources:</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>insmod mwave mwave_3780i_irq=10 mwave_3780i_io=0x0130 mwave_uart_irq=3 mwave_uart_io=0x2f8</PRE
></FONT
></TD
></TR
></TABLE
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>NOTE</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>The <B
CLASS="COMMAND"
>mwave</B
> is unable to check for resource conflicts. It is

					your responsibility to ensure that none of the resources specified conflict with other (commonly PCMCIA) devices.</P
></TD
></TR
></TABLE
></DIV
><P
>You can use the tpctl package on Linux or the Thinkpad&#8482; configuration utility on Windows NT or DOS

					to manage the configuration of Thinkpad&#8482; related resources.</P
></DIV
><DIV
CLASS="SECT3"
><H3
CLASS="SECT3"
><A
NAME="EXECUTE">2.4.2. Running ACP Modem Application</H3
><P
></P
><OL
TYPE="1"
><LI
><P
>Once the ACP device driver is loaded successfully, use the

							<B
CLASS="COMMAND"
>mwavem</B
> command to execute the application.

							<DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>NOTE</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>The location of the <TT
CLASS="FILENAME"
>mwavem.conf</TT
> file 

								can be specified as an argument to the mwavem application. If not specified the

								default location is assumed to be <TT
CLASS="FILENAME"
>/usr/local/etc/mwavem.conf</TT
> unless otherwise changed during the build process.</P
></TD
></TR
></TABLE
></DIV
></P
></LI
><LI
><P
>Setup the serial driver to recognize the UART provided by the

								ACP driver.</P
><TABLE
BORDER="1"
BGCOLOR="#E0E0E0"
WIDTH="90%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="SCREEN"
>setserial /dev/ttyS0 autoconfig</PRE
></FONT
></TD
></TR
></TABLE
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>NOTE</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Substitute /dev/ttyS0 to match the serial port you have

								configured the DSP to use.</P
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="90%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TH
ALIGN="LEFT"
VALIGN="CENTER"
><B
>NOTE</B
></TH
></TR
><TR
><TD
>&nbsp;</TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>You may wish to create a symbolic link from your modem device to your serial device for convenience.  Example:  <B
CLASS="COMMAND"
>ln -s /dev/ttyS0 /dev/modem</B
></P
></TD
></TR
></TABLE
></DIV
></LI
></OL
><P
>The ACP Modem is now available for use by your favorite dialing application.</P
></DIV
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="generalinfo.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="problems.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>General Information and Hardware Requirements</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Resolving Installation and Configuration Problems</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>