<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
 <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <META NAME="GENERATOR" CONTENT="lfparser_2.52">
 <META NAME="LFCATEGORY" CONTENT="Hardware">
 <link rel="icon" href="../../common/images/lf-16.png" type="image/png">
 <TITLE>lf389, Hardware: A digital DC power supply -- part 3: command control from the PC</TITLE>
<style type="text/css">
<!--
 td.top {font-family: Arial,Geneva,Verdana,Helvetica,sans-serif; font-size:12 }
 pre { font-family:monospace,Courier }
 pre.code { font-family:monospace,Courier;background-color:#aedbe8; }
 p.cl { color:#EE9500 }
 table.left { margin-right:0.3cm }
 a.nodec { text-decoration:none }
 p.trans { font-size:8pt; text-align:right }
 p.clbox { width:50%; alignment:center; background-color:#FFD700; 
           border-style:none; border-width:medium; border-color:#FFD700; 
           padding:0.5cm;  text-align:center }
 p.code { width:80%; alignment:center; background-color:#aedbe8; 
          border-style:none; border-width:medium; border-color:#aedbe8; 
          padding:0.1cm;  text-align:left }
 p.foot { background-color:#AAAAAA; color:#FFFFFF; border-style:none; 
          border-width:medium; border-color:#AAAAAA; padding:0.5cm ; 
          margin-top:0.1cm; margin-right:1cm; margin-left:1cm; 
          text-align:center }
 div.tbbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   margin: 2px 5px 2px 5px;
   text-align: center;
   width: 20em;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
 div.bbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   float: left;
   margin: 2px 5px 2px 5px;
   text-align: center;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
-->
</style>
 
</HEAD>
<BODY bgcolor="#ffffff" text="#000000">
 <!-- this is generated html code. NEVER use this file for your
 translation work. Instead get the file with the same article number
 and .meta.shtml in its name. Translate this meta file and then
 use lfparser program to generate the final article -->
 <!-- lfparser can be obtained from http://main.linuxfocus.org/~guido/dev/lfparser.html -->

<!-- this is used by a number of tools:
 =LF=AUTHOR: Guido     Socher
 =LF=CAT___: Hardware
 =LF=TITLE_: A digital DC power supply -- part 3: command control from the PC
 =LF=NUMBER: 389
 =LF=ANAME_: article389.shtml
 =LF=PARSER: 2.52
 -->

<!-- 2pdaIgnoreStart -->

<!-- start navegation bar, current, style=2 -->
 <!-- top navegation bar -->
 <TABLE summary="topbar_1" cellspacing="0" cellpadding="0" border="0" align="center" width="90%">
   <TR bgcolor="#2e2292">
     <TD class="top"><TABLE summary="topbar_1_logo" cellspacing="0" cellpadding="0" border="0" width=
       "100%">
         <TR><TD width="319"><a href="../../index.shtml"><IMG src="../../common/images/logolftop_319x45.gif"
           alt="[LinuxFocus-icon]" width="319" height="45" align="left" 
           border="0"></a></TD>

           <TD class="top">
             <TABLE summary="topbar_1_links" width="100%">
               <TR align="right">
                 <TD class="top">
                 
                 <A class="nodec" href="../../index.shtml"><FONT color=
                 "#DDDDDD" size="2">&lt;--</FONT></A> &nbsp;| 
                 <A class="nodec" href="../map.html"><FONT color=
                 "#DDDDDD" size="2">Map</FONT></A> &nbsp;| 
                 <A class="nodec" href="../indice.html"><FONT color=
                 "#DDDDDD" size="2">Index</FONT></A> &nbsp;| 
                 <A class="nodec" href="../Search/index.html"><FONT color=
                 "#DDDDDD" size="2">Search</FONT></A> </TD>
                 
               </TR>

               <TR align="right">
                 <TD class="top">
                   <HR width="100%" noshade size="1">
                 </TD>
               </TR>
             </TABLE>
           </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end top navegation bar -->
 <!-- blue bar -->
 <TABLE summary="topbar_2" cellspacing="0" cellpadding="0" border="0" align="center"
 width="90%">
   <TR bgcolor="#00ffff">
     <TD><IMG src="../../common/images/transpix.gif" width="1" height=
     "2" alt=""></TD>
   </TR>
 </TABLE>
 <!-- end blue bar -->
 <!-- bottom navegation bar -->
 <TABLE summary="topbar_3" cellspacing="0" cellpadding="0" border="0" align="center"
 width="94%">
   <TR bgcolor="#000000">
     <TD>
       <TABLE summary="topbar_3_links" cellspacing="0" cellpadding="1" border="0" width=
       "100%">
         <TR align="center">
           <TD WIDTH="20%"><A class="nodec" href="../News/index.html"><FONT color=
           "#FFFFFF">News</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Archives/index.html"><FONT color=
           "#FFFFFF">Archives</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Links/index.html"><FONT color=
           "#FFFFFF">Links</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../aboutus.html"><FONT color=
           "#FFFFFF">About LF</FONT></A> </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end bottom navegation bar -->
<!-- stop navegation bar -->

<!-- SSI_INFO -->

<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfdynahead ver 1.5 --><TABLE ALIGN="right" border=0><TR><TD ALIGN="right"><FONT SIZE="-1" FACE="Arial,Helvetica">This document is available in: <A href="../../English/September2005/article389.shtml">English</a> &nbsp;</FONT></TD></TR></TABLE><br>
 


<!-- SSI_INFO STOP -->
<!-- 2pdaIgnoreStop -->

<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_START -->
<TABLE ALIGN="LEFT" BORDER="0" WIDTH="195" summary="about the author" class="left">
<TR>
<TD>

<img src="../../common/images/Guido-S.gif" alt=
    "[Photo of the Author]" height="164" width="173">
<BR>by  Guido Socher <a href="http://linuxfocus.org/~guido/"><font size="1">(homepage)</font></a>
<BR><BR>
<I>About the author:</I><BR>
<!-- aboutauthor_start -->
<p>Guido likes Linux because it is a really good system to
    develop your own hardware.</p>
<!-- aboutauthor_stop -->
<!-- TRANSLATED_TO en -->
<!-- TRANSLATED_TO_STOP -->
<!-- INDEX_START -->
<BR><i>Content</i>:
<UL>
  <LI><A HREF="#389lfindex0">Introduction</A></LI>
  <LI><A HREF="#389lfindex1">How it works</A></LI>
  <LI><A HREF="#389lfindex2">The electrical part</A></LI>
  <LI><A HREF="#389lfindex3">Conclusion</A></LI>
  <LI><A HREF="#389lfindex4">References/Download</A></LI>
  <LI><A HREF="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=389">Talkback form for this article</A></LI>
</UL>

</TD></TR></TABLE>
<!-- INDEX_STOP -->
<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_STOP -->
<!-- HEAD_OF_THE_ARTICLE_START -->
<br>&nbsp;
<table border="0"><tr><td>
<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfPdf ver 0.1 -->
<TABLE style="border-style:outset; border-width:1px" align="right" bgcolor="#ff9616" cellspacing="1"><TR><TD bgcolor="#ff9616">
        <a href="../Archives/lf-2005_09-0389.pdf"><small>PDF</small></a>
        </TD></TR></TABLE>
         

<H2>A digital DC power supply -- part 3: command control from the PC</H2>
 <img src="../../common/images2/article384_title.jpg" alt=
    "[Illustration]" hspace="10" width="370" height="152">
<!-- ABSTRACT OF THE ARTICLE -->
<P><i>Abstract</i>:
<P>
<!-- articleabstract_start -->

    This is the third part in the series about the digital power
    supply. You might want to read the <a href=
    "../June2005/article379.shtml">first part</a> and also the <a
    href="../July2005/article384.shtml">second part</a>. <br><br>
     A kit with the board and parts for this article is available
    from <a href=
    "http://shop.tuxgraphics.org/electronic/microcontroller.html">shop.tuxgraphics.org</a>.


    
<!-- articleabstract_stop -->

<br><!-- HR divider --><center><font color="#8282e0"><b>_________________ _________________ _________________</b></font></center><br>
</td></tr></table>
<!-- HEAD_OF_THE_ARTICLE_STOP -->
<!-- BODY_OF_THE_ARTICLE_START -->


    <A NAME="389lfindex0">&nbsp;</A>
<H2>Introduction</H2>

    The power supply circuit and software as described in the last
    two articles (part I and part II) was a stand alone power
    supply operated with a few push buttons on the front. <br>
     <br>
    In this article we will add a feature which is normally only
    available in really expensive high-end devices: You can control
    the power supply not only locally via the push buttons but also
    via commands from your computer. <br>
     <br>
    All this is possible with software updates only since the
    hardware was already prepared for this "command control"
    feature. <br>
     <br>
    To remotely control the power supply via commands we will use
    again I2C communication (see also <a href=
    "../March2005/article369.shtml">A digital thermometer or talk I2C
    to your atmel microcontroller</a>). I2C communication is a bit
    slow but we do not send long commands anyhow. A command to set the
    voltage could e.g be as short as "u=12". This is still human
    readable and understandable but only a few bytes long. <br>
     <br>
    The software to do this remote control has by now been ported
    to <b>Linux, Windows, Mac OS X and Solaris</b>. It is probably
    quite easy to port this code to even more operating systems.

    <A NAME="389lfindex1">&nbsp;</A>
<H2>How it works</H2>

    I2C is a protocol over a two wire bus. One line on the bus
    carries the clock (SCL) and the other the data (SDA). This has the big
    advantage that you do not need a precise synchronous clock
    signal. The timing is not so important for I2C therefore it is very
    easy to implement in a simple user space program (no special
    kernel module). For the physical interface we use again the
    rs232 modem control lines. USB is also possible to use via a
    USB to serial converter. The new Apple Macs have e.g no rs232
    but because I2C is not sensitive to timing it is
    possible to use adapter cables such as the Prolific PL-2303
    (there are some links to USB adapters in the software for this
    article under other_OS/macOSX/README.txt, see download at the
    end of this article). <br>
    <br>
    The program to send commands to our DC power supply is a
    simple command line based program called i2ctalk. It is
    available in source code and as precompiled binary for Linux, Solaris,
    Mac OSX and Windows. You use it like this:
<pre class="code">
I2C commands for the DC power supply:
=====================================

# set Imax to 0.20A:
i2ctalk i=20
# get current I value:
i2ctalk i
# store current settings
i2ctalk s
# set Umax to 2.1V:
i2ctalk u=21
# get current voltage value:
i2ctalk u

</pre>
    You can enhance the program and build a fancy graphical
    application if you want. I have just tired to keep it as simple
    as possible to make it easy to understand.

    <A NAME="389lfindex2">&nbsp;</A>
<H2>The electrical part</H2>

    The voltage levels on the physical rs232 interface are +/- 10V.
    The atmega8 works with 0-5V. One could use a Z-diode to limit
    the voltage levels but it turns out that this is actually not
    needed. The atmega8 has internally already over and under
    voltage protection. We just need to make sure that the current is low
    enough to not "burn" this protection. All that is needed hardware wise are two 4.7K
    resistors. Very easy, very convenient. <br>

    <center>
      <a href=
      "../../common/src2/article389/powersupply_upd3.gif"><img src=
      "../../common/src2/article389/powersupply_upd3_th.gif" alt=
      "[circuit]" hspace="10"></a>
    </center>
    <br>
    I have decided that an electrical insulation (via opto-couples)
    to the PC is not needed for me (you can add them if you want). This has however some
    implication for some special cases and you should be aware of
    those limitations. Most desktop computers (and some laptops) have their GND
    lines (0V) connected to earth. This means that the DC power
    supply is no longer earth free on the output when connected to
    the PC. This is because GND of the PC is connected to GND of
    our power supply. <br>
    <br>
    In most cases this will not be a problem. However you have to
    be careful if the circuit to which you connect the power supply
    to has also some connection to earth. Specifically the circuit
    must not have a direct earth connection on the wire which you
    intend to connect to the positive output of the power supply.
    This would cause a short circuit via earth of your PC. It can
    e.g happen if you cascade two power supplies in order to have
    positive and negative voltages. In other words you can not use
    the remote control feature if you plan to cascade several power
    supplies.

    <A NAME="389lfindex3">&nbsp;</A>
<H2>Conclusion</H2>

    There is not much more to say here. The main purpose of
    this article is to make the new software available. The tar file is caleld
digitaldcpower-0.4.X.
    I will use the X for any corrections. The
    technology, I2C communication, is nothing new as it was already
    used for the digital thermometer. <br>
    <br>
    I and many others have now been using this power supply for
    several month without any problem. It is very ridged, easy to
    use and I really enjoy using it.

    <A NAME="389lfindex4">&nbsp;</A>
<H2>References/Download</H2>


    <ul>
      <li><a href="../../common/src2/article389/index.html">Download page</a>
      for this article (updates and corrections will also be
      available from here).</li>

      <li><a href=
      "http://www.tuxgraphics.org/electronics/">Tuxgraphics
      electronics section</a>, a collection of all articles in this
      series.</li>

      <li><a href=
      "http://shop.tuxgraphics.org/electronic/microcontroller.html">
      shop.tuxgraphics.org , microcontroller section</a>, You can
      order all parts (transistors, passive components, LCD
      display, PCB, microcontroller, ...) from here.</li>
    </ul>
    <!-- vim: set sw=2 ts=2 et tw=80: -->
  



<!-- BODY_OF_THE_ARTICLE_STOP -->
<!-- 2pdaIgnoreStart -->
<A NAME="talkback">&nbsp;</a>
<h2>Talkback form for this article</h2>
Every article has its own talkback page. On this page you can submit a comment or look at comments from other readers:
<center>
    <table width="250" border=0><tr><td>
    <div class="tbbutton"><A class="nodec" href="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=389">&nbsp;talkback page&nbsp;</a></div>
    </td></tr></table>
</center>

<br clear="all">
<HR size="2" noshade>
<table width="250" border=0><tr><td>
<div class="bbutton"><a class="nodec" href="../../index.shtml">&lt;--, LF Home</a></div>
</td><td>
<div class="bbutton"><a class="nodec" href="index.shtml">Go to the index of this issue</a></div>
</td></tr></table>
<br clear="all">
<HR size="2" noshade>
<!-- ARTICLE FOOT -->
<CENTER><TABLE WIDTH="98%" summary="footer">
<TR><TD ALIGN=CENTER BGCOLOR="#bdc6d5" WIDTH="50%">
<A HREF="../../common/lfteam.html">Webpages maintained by the LinuxFocus Editor team</A>
<BR><FONT COLOR="#1111aa"><a href="../../common/copy.html">&copy; Guido     Socher</a><br>&quot;some rights reserved&quot; see <a href="../../license/index.shtml">linuxfocus.org/license/</a><br><a href="http://www.linuxfocus.org">http://www.LinuxFocus.org</a></FONT>
</TD>
<TD BGCOLOR="#bdc6d5">
<!-- TRANSLATION INFO -->
<font size=2>Translation information:</font>
<TABLE summary="translators">
  <tr><td><font size="2">en --&gt; -- : Guido Socher (<a href="http://linuxfocus.org/~guido/"><font size="1">homepage</font></a>)</font></td></tr>
</TABLE>
</TD>
</TR></TABLE></CENTER>
<p><font size=1>2005-09-29, generated by lfparser version 2.52</font></p>
<!-- 2pdaIgnoreStop -->
</BODY>
</HTML>
