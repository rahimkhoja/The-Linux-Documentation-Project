<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
 <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <META NAME="GENERATOR" CONTENT="lfparser_2.52">
 <META NAME="LFCATEGORY" CONTENT="SoftwareDevelopment">
 <link rel="icon" href="../../common/images/lf-16.png" type="image/png">
 <TITLE>lf354, SoftwareDevelopment: An introduction to SPF</TITLE>
<style type="text/css">
<!--
 td.top {font-family: Arial,Geneva,Verdana,Helvetica,sans-serif; font-size:12 }
 pre { font-family:monospace,Courier }
 pre.code { font-family:monospace,Courier;background-color:#aedbe8; }
 p.cl { color:#EE9500 }
 table.left { margin-right:0.3cm }
 a.nodec { text-decoration:none }
 p.trans { font-size:8pt; text-align:right }
 p.clbox { width:50%; alignment:center; background-color:#FFD700; 
           border-style:none; border-width:medium; border-color:#FFD700; 
           padding:0.5cm;  text-align:center }
 p.code { width:80%; alignment:center; background-color:#aedbe8; 
          border-style:none; border-width:medium; border-color:#aedbe8; 
          padding:0.1cm;  text-align:left }
 p.foot { background-color:#AAAAAA; color:#FFFFFF; border-style:none; 
          border-width:medium; border-color:#AAAAAA; padding:0.5cm ; 
          margin-top:0.1cm; margin-right:1cm; margin-left:1cm; 
          text-align:center }
 div.tbbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   margin: 2px 5px 2px 5px;
   text-align: center;
   width: 20em;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
 div.bbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   float: left;
   margin: 2px 5px 2px 5px;
   text-align: center;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
-->
</style>
 
</HEAD>
<BODY bgcolor="#ffffff" text="#000000">
 <!-- this is generated html code. NEVER use this file for your
 translation work. Instead get the file with the same article number
 and .meta.shtml in its name. Translate this meta file and then
 use lfparser program to generate the final article -->
 <!-- lfparser can be obtained from http://main.linuxfocus.org/~guido/dev/lfparser.html -->

<!-- this is used by a number of tools:
 =LF=AUTHOR: Bruno     Sousa
 =LF=CAT___: SoftwareDevelopment
 =LF=TITLE_: An introduction to SPF
 =LF=NUMBER: 354
 =LF=ANAME_: article354.shtml
 =LF=PARSER: 2.52
 -->

<!-- 2pdaIgnoreStart -->

<!-- start navegation bar, current, style=2 -->
 <!-- top navegation bar -->
 <TABLE summary="topbar_1" cellspacing="0" cellpadding="0" border="0" align="center" width="90%">
   <TR bgcolor="#2e2292">
     <TD class="top"><TABLE summary="topbar_1_logo" cellspacing="0" cellpadding="0" border="0" width=
       "100%">
         <TR><TD width="319"><a href="../../index.shtml"><IMG src="../../common/images/logolftop_319x45.gif"
           alt="[LinuxFocus-icon]" width="319" height="45" align="left" 
           border="0"></a></TD>

           <TD class="top">
             <TABLE summary="topbar_1_links" width="100%">
               <TR align="right">
                 <TD class="top">
                 
                 <A class="nodec" href="../../index.shtml"><FONT color=
                 "#DDDDDD" size="2">&lt;--</FONT></A> &nbsp;| 
                 <A class="nodec" href="../map.html"><FONT color=
                 "#DDDDDD" size="2">Map</FONT></A> &nbsp;| 
                 <A class="nodec" href="../indice.html"><FONT color=
                 "#DDDDDD" size="2">Index</FONT></A> &nbsp;| 
                 <A class="nodec" href="../Search/index.html"><FONT color=
                 "#DDDDDD" size="2">Search</FONT></A> </TD>
                 
               </TR>

               <TR align="right">
                 <TD class="top">
                   <HR width="100%" noshade size="1">
                 </TD>
               </TR>
             </TABLE>
           </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end top navegation bar -->
 <!-- blue bar -->
 <TABLE summary="topbar_2" cellspacing="0" cellpadding="0" border="0" align="center"
 width="90%">
   <TR bgcolor="#00ffff">
     <TD><IMG src="../../common/images/transpix.gif" width="1" height=
     "2" alt=""></TD>
   </TR>
 </TABLE>
 <!-- end blue bar -->
 <!-- bottom navegation bar -->
 <TABLE summary="topbar_3" cellspacing="0" cellpadding="0" border="0" align="center"
 width="94%">
   <TR bgcolor="#000000">
     <TD>
       <TABLE summary="topbar_3_links" cellspacing="0" cellpadding="1" border="0" width=
       "100%">
         <TR align="center">
           <TD WIDTH="20%"><A class="nodec" href="../News/index.html"><FONT color=
           "#FFFFFF">News</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Archives/index.html"><FONT color=
           "#FFFFFF">Archives</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Links/index.html"><FONT color=
           "#FFFFFF">Links</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../aboutus.html"><FONT color=
           "#FFFFFF">About LF</FONT></A> </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end bottom navegation bar -->
<!-- stop navegation bar -->

<!-- SSI_INFO -->

<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfdynahead ver 1.5 --><TABLE ALIGN="right" border=0><TR><TD ALIGN="right"><FONT SIZE="-1" FACE="Arial,Helvetica">This document is available in: <A href="../../English/December2004/article354.shtml">English</a> &nbsp;<A href="../../ChineseGB/December2004/article354.shtml">ChineseGB</a> &nbsp;<A href="../../Deutsch/December2004/article354.shtml">Deutsch</a> &nbsp;<A href="../../Francais/December2004/article354.shtml">Francais</a> &nbsp;<A href="../../Italiano/December2004/article354.shtml">Italiano</a> &nbsp;<A href="../../Nederlands/December2004/article354.shtml">Nederlands</a> &nbsp;<A href="../../Portugues/December2004/article354.shtml">Portugues</a> &nbsp;<A href="../../Polish/December2004/article354.shtml">Polish</a> &nbsp;</FONT></TD></TR></TABLE><br>
 


<!-- SSI_INFO STOP -->
<!-- 2pdaIgnoreStop -->

<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_START -->
<TABLE ALIGN="LEFT" BORDER="0" WIDTH="195" summary="about the author" class="left">
<TR>
<TD>

<img src="../../common/images/BrunoSousa.jpg" alt="[Photo of the Author]" width="100" height="142">
<BR>by  Bruno Sousa <br> <small>&lt;bruno/at/linuxfocus.org&gt;</small>
<BR><BR>
<I>About the author:</I><BR>
<!-- aboutauthor_start -->
<p>Bruno is a student in Portugal.
He dedicates his spare time to Linux and photography.<br></p>
<!-- aboutauthor_stop -->
<!-- TRANSLATED_TO en -->
<!-- TRANSLATED_TO_STOP -->
<!-- INDEX_START -->
<BR><i>Content</i>:
<UL>
  <LI><A HREF="#354lfindex0">What SPF needs to work?</A></LI>
  <LI><A HREF="#354lfindex1">The TXT Record of SPF</A></LI>
  <LI><A HREF="#354lfindex2">Hey, I'm an ISP</A></LI>
  <LI><A HREF="#354lfindex3">What are the things to watch out for?</A></LI>
  <LI><A HREF="#354lfindex4">Conclusion</A></LI>
  <LI><A HREF="#354lfindex5">References</A></LI>
  <LI><A HREF="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=354">Talkback form for this article</A></LI>
</UL>

</TD></TR></TABLE>
<!-- INDEX_STOP -->
<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_STOP -->
<!-- HEAD_OF_THE_ARTICLE_START -->
<br>&nbsp;
<table border="0"><tr><td>
<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfPdf ver 0.1 -->
<TABLE style="border-style:outset; border-width:1px" align="right" bgcolor="#ff9616" cellspacing="1"><TR><TD bgcolor="#ff9616">
        <a href="../Archives/lf-2004_12-0354.pdf"><small>PDF</small></a>
        </TD></TR></TABLE>
         

<H2>An introduction to SPF</H2>
 <img hspace="10" alt="[Illustration]" src="../../common/images2/article354.gif" width="171" height="98">
<!-- ABSTRACT OF THE ARTICLE -->
<P><i>Abstract</i>:
<P>
<!-- articleabstract_start -->

		SPF stands for Sender Policy Framework and it aims to be an
antiforgery standard to prevent the forging of e-mail addresses. This
article gives a short introduction to SPF, its advantages and
disavantages.
    <br>
<!-- articleabstract_stop -->

<br><!-- HR divider --><center><font color="#8282e0"><b>_________________ _________________ _________________</b></font></center><br>
</td></tr></table>
<!-- HEAD_OF_THE_ARTICLE_STOP -->
<!-- BODY_OF_THE_ARTICLE_START -->

		<p>SPF was born on the year 2003, his mentor, Meng Weng Wong picked up
the best features of Reverse MX and DMP (Designated Mailer Protocol) to
bring SPF to life.</p>

		<p>SPF uses the return-path (or MAIL FROM) present on the email message header, since
all MTAs work with these fields. However there is a new notion proposed by
Microsoft: The PRA, which means the Purported Responsible Address. The PRA
corresponds to the address of the end-user that a MUA uses (like thunderbird).</p>

		<p>So when we put together the SPF and the PRA we can obtain the so-called Sender
ID, which allows an user who receives email to perform the
check of the MAIL FROM (SPF check) and the PRA check. Somehow it's said
that MTAs will check the MAIL FROM and the MUAs will do the PRA check.</p>

		<p>Actually SPF needs DNS to work properly. This means that the "reverse
MX" records must be published, these records tell what machines <em>send</em> email
from a given domain. It is different from the MX records, used nowadays,
 that specify the machines that <em>receive</em> email for a given domain.</p>


    <A NAME="354lfindex0">&nbsp;</A>
<H2>What SPF needs to work?</H2>

    In order to protect your system with SPF you must:
<ol>
 	<li>Configure your DNS to add the TXT record where is introduced the
information that SPF queries. </li>
	<li>Configure your email system (qmail, sendmail) to use SPF, this
means to perform the verification on each message received on your server.</li>
</ol>

		The first step will be accomplished on the DNS server where the domain is.
In the next section we will discuss the details of the record. One thing
that you must have present is the syntax that your DNS server uses (bind
or djbdns). But don't be afraid, the official site of SPF provides an
 excellent wizard that will instruct you.

    <A NAME="354lfindex1">&nbsp;</A>
<H2>The TXT Record of SPF</H2>

		The SPF record is contained on a TXT record and its format is as
follows:
<pre>
		v=spf1 [[pre] type [ext] ] ... [mod]
</pre>

<br>
		The meaning of each parameter is the following:
	<table border="1">
 		<tr><td><b><font size="4">Parameter</font></b></td>
			  <td> <b><font size="4">Description</font></b> </td>
    </tr>
		<tr><td> v=spf1 </td> <td> Version of SPF. When using SenderID you
might see v=spf2</td> </tr>
		<tr><td> pre    </td> <td> Defines a return code when a match occurs.<br> <br>
			The possible values are:
			<table>
			<tr><td><b>Value</b></td> <td> <b>Description</b> </td></tr>
			<tr><td><b>+</b> </td> <td> Default. Means pass when a test is conclusive.
</td></tr>
			<tr><td> <b>-</b> </td> <td> Means fail a test. This value normally
is applied on -all to tell that there are no previous matches.</td></tr>
			<tr><td> <b>~</b> </td> <td> Means a soft fail. This value normally
is applied when a test is not conclusive.</td></tr>
			<tr><td> <b>?</b> </td> <td> Means neutral. This value normally
is applied when a test is not conclusive.</td></tr>
			</table>
		</td> </tr>

		<tr><td> type </td> <td> Defines the type to use for verification.
<br><br> The possible values are:
			<table colspan="2">
			<tr><td><b>Value</b></td> <td> <b>Description</b> </td></tr>
			<tr><td>include </td> <td> to include the tests of a supplied domain.<br>
It is written in the form of include:domain </td> </tr>
			<tr><td>all</td> <td> to terminate the sequence of the tests. <br>
For instance if it is -all then if all the tests have not been met
until here than fail. But if there is uncertainty it can be used on the form
of ?all whih means the test will be accepted.
			</td> </tr>
			<tr><td>ip4</td> <td> Use a IP version 4 for verification. <br>
This can be used on the form of ip4:ipv4 or ip4:ipv4/cidr to define a
range. This type is the most recommended since incurs least load on the
DNS servers.
			</td> </tr>

			<tr><td>ip6</td> <td> Use a IP version 6 for verification.</td> </tr>

			<tr><td>a</td> <td> Use a domain-name for verification.<br>
It will make a look-up on the DNS for an A RR. <br>
It can be used in the form of a:domain, a:domain/cidr or a/cidr.
			</td> </tr>

			<tr><td>mx</td> <td> Use the DNS MX RR for verification.<br>
The MX RR defines the receiving MTA, for instance if it is not the same as
the sending MTA, the tests based on the mx will fail. <br>
It can be used in the form of mx:domain, mx:domain/cidr or mx/cidr.
			</td> </tr>

			<tr><td>ptr</td> <td> Use DNS PTR RR for verification.<br>
In this case it is used a PTR RR and a reverse map query. If the returned
host name lies in the same domain the communication is verified. <br>
It can be used in the form of ptr:domain
			</td></tr>

			<tr><td>exist</td> <td> Test for the existance of a domain.<br>
It can be written in the form of exist:domain. </td> </tr>

			</table>
		</td> </tr>

		<tr><td> ext </td> <td> Defines an optional extension to the type. If
it is omitted then it is used only a single record type for
interrogation. </td></tr>

		<tr><td> mod </td> <td> It is the last type directive and acts as a
record modifier. <br><br>

			<table>
		    <tr><td><b> modifier</b> </td> <td> <b>Description</b> </td> </tr>
		    <tr><td> redirect </td> <td> Redirects the verification to use the
SPF records of the defined domain. <br> It is used in the form of redirect=domain.</td> </tr>
		    <tr><td> exp</td> <td> This record must be the last and it allows
to customize a failure message. <br>
<pre>
<small>
IN TXT "v=spf1 mx -all exp=getlost.example.com"

getlost IN TXT "You are not authorized to send mail for the domain"
</small>
</pre>
<br>
				</td></tr>

			</table>
  </table>

    <A NAME="354lfindex2">&nbsp;</A>
<H2>Hey, I'm an ISP</H2>


	<p>ISPs will have some "trouble" with their roaming users if they
are using mechanisms like POP-before-Relay instead of SASL SMTP.</p>

	<p>Well, if you are an ISP worried about spam and about forgeries you must
consider your politics about email and start using SPF. </p>

	Here are some steps you might consider.
<ol>
	<li>First configure your MTA to use SASL, for instance you can enable it on
ports 25 and 587.</li>
	<li>Warn your users about the politics you are implementing (The
spf.pobox.com provides you an example, see references). </li>
	<li>Give your users a grace period, this means you will publish your SPF
records into DNS, but with softfail (~all) instead of the fail (-all)
tests. </li>
</ol>

	<p>And with this you are protecting your servers, your clients and the
world from spam...</p>

	<p>There's a lot of information on the official site of SPF for you,
what are you waiting for? </p>


    <A NAME="354lfindex3">&nbsp;</A>
<H2>What are the things to watch out for?</H2>

SPF is a perfect solution to protect against fraud. It has however
one limitation: Traditional e-mail forwarding will no longer work.
You can not just receive mail in your MTA and re-send it. You must
rewrite the sender address. Patches for common MTAs  are provided on the
<a href="http://spf.pobox.com/downloads.html">SPF side</a>. In other words if you start to publish SPF DNS records
you should also update your MTA to do sender address rewriting even
if you do not yet check for SPF records.

    <A NAME="354lfindex4">&nbsp;</A>
<H2>Conclusion</H2>

<p>You may think that the implementation about SPF might be somehow
confusing. Well indeed it is not complicated, and by the way you have a
great wizard that help you out to accomplish your mission (see the
references section). </p>

<p>If are you worried about spam then SPF will help you, protecting your
domain from forgeries, and all you have to do is to add a text line on
your DNS server and configure your email server.</p>

<p>The advantages that SPF brings are big. However, like I said to
someone, it is not a difference between the day and the night. The
benefits of SPF will come with the time, when others adhere to it.</p>

<p>I have referred the Sender ID and its relation to SPF, but I didn't
extend myself on any explanation about it. Probably you know already the
reason, the politics of Microsoft is always the same, patents of
software. On the references you can see the position of the openspf.org
about SenderID.</p>

<p>On a next article we will talk about the configuration of the MTA, see
you then.</p>

<p>I hope to give you a short introduction to SPF. If you are interested
in learning more about it, just use the references that were used to make
this article. </p>

    <A NAME="354lfindex5">&nbsp;</A>
<H2>References</H2>

	 <a href="http://spf.pobox.com">The official site of SPF.</a>
<br>
	 <a href="http://spf.pobox.com/faq.html">The official FAQ of SPF.</a>
<br>
	 <a href="http://spf.pobox.com/wizard.html">The official wizard of SPF.</a>
<br>
	 <a href="http://www.openspf.org/OpenSPF_community_position_v101.html">
The position of the openspf.org about SenderID.</a>
<br>
	 <a href="http://trends.newsforge.com/article.pl?sid=04/08/26/1326244&amp;tid=29">An
excellent article about SenderId and SPF.</a>
<br>
	 <a href="http://spf.pobox.com/saslconversion.html">warn your users
about the SASL convertion</a>
<br>
		<a href="http://www.zytrax.com/books/dns/ch9/spf.html">HOWTO - Define
an SPF Record</a>
<br>
     <!-- vim: set sw=2 ts=2 et tw=74: -->
  



<!-- BODY_OF_THE_ARTICLE_STOP -->
<!-- 2pdaIgnoreStart -->
<A NAME="talkback">&nbsp;</a>
<h2>Talkback form for this article</h2>
Every article has its own talkback page. On this page you can submit a comment or look at comments from other readers:
<center>
    <table width="250" border=0><tr><td>
    <div class="tbbutton"><A class="nodec" href="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=354">&nbsp;talkback page&nbsp;</a></div>
    </td></tr></table>
</center>

<br clear="all">
<HR size="2" noshade>
<table width="250" border=0><tr><td>
<div class="bbutton"><a class="nodec" href="../../index.shtml">&lt;--, LF Home</a></div>
</td><td>
<div class="bbutton"><a class="nodec" href="index.shtml">Go to the index of this issue</a></div>
</td></tr></table>
<br clear="all">
<HR size="2" noshade>
<!-- ARTICLE FOOT -->
<CENTER><TABLE WIDTH="98%" summary="footer">
<TR><TD ALIGN=CENTER BGCOLOR="#bdc6d5" WIDTH="50%">
<A HREF="../../common/lfteam.html">Webpages maintained by the LinuxFocus Editor team</A>
<BR><FONT COLOR="#1111aa"><a href="../../common/copy.html">&copy; Bruno     Sousa</a><br>&quot;some rights reserved&quot; see <a href="../../license/index.shtml">linuxfocus.org/license/</a><br><a href="http://www.linuxfocus.org">http://www.LinuxFocus.org</a></FONT>
</TD>
<TD BGCOLOR="#bdc6d5">
<!-- TRANSLATION INFO -->
<font size=2>Translation information:</font>
<TABLE summary="translators">
  <tr><td><font size="2">en --&gt; -- : Bruno Sousa <small>&lt;bruno/at/linuxfocus.org&gt;</small></font></td></tr>
</TABLE>
</TD>
</TR></TABLE></CENTER>
<p><font size=1>2005-01-14, generated by lfparser version 2.52</font></p>
<!-- 2pdaIgnoreStop -->
</BODY>
</HTML>
