<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
 <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <META NAME="GENERATOR" CONTENT="lfparser_2.52">
 <META NAME="LFCATEGORY" CONTENT="Hardware">
 <link rel="icon" href="../../common/images/lf-16.png" type="image/png">
 <TITLE>lf359, Hardware: Fn-F12: Hibernate an IBM Thinkpad T20 laptop</TITLE>
<style type="text/css">
<!--
 td.top {font-family: Arial,Geneva,Verdana,Helvetica,sans-serif; font-size:12 }
 pre { font-family:monospace,Courier }
 pre.code { font-family:monospace,Courier;background-color:#aedbe8; }
 p.cl { color:#EE9500 }
 table.left { margin-right:0.3cm }
 a.nodec { text-decoration:none }
 p.trans { font-size:8pt; text-align:right }
 p.clbox { width:50%; alignment:center; background-color:#FFD700; 
           border-style:none; border-width:medium; border-color:#FFD700; 
           padding:0.5cm;  text-align:center }
 p.code { width:80%; alignment:center; background-color:#aedbe8; 
          border-style:none; border-width:medium; border-color:#aedbe8; 
          padding:0.1cm;  text-align:left }
 p.foot { background-color:#AAAAAA; color:#FFFFFF; border-style:none; 
          border-width:medium; border-color:#AAAAAA; padding:0.5cm ; 
          margin-top:0.1cm; margin-right:1cm; margin-left:1cm; 
          text-align:center }
 div.tbbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   margin: 2px 5px 2px 5px;
   text-align: center;
   width: 20em;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
 div.bbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   float: left;
   margin: 2px 5px 2px 5px;
   text-align: center;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
-->
</style>
 
</HEAD>
<BODY bgcolor="#ffffff" text="#000000">
 <!-- this is generated html code. NEVER use this file for your
 translation work. Instead get the file with the same article number
 and .meta.shtml in its name. Translate this meta file and then
 use lfparser program to generate the final article -->
 <!-- lfparser can be obtained from http://main.linuxfocus.org/~guido/dev/lfparser.html -->

<!-- this is used by a number of tools:
 =LF=AUTHOR: Jan Alonzo
 =LF=CAT___: Hardware
 =LF=TITLE_: Fn-F12: Hibernate an IBM Thinkpad T20 laptop
 =LF=NUMBER: 359
 =LF=ANAME_: article359.shtml
 =LF=PARSER: 2.52
 -->

<!-- 2pdaIgnoreStart -->

<!-- start navegation bar, current, style=2 -->
 <!-- top navegation bar -->
 <TABLE summary="topbar_1" cellspacing="0" cellpadding="0" border="0" align="center" width="90%">
   <TR bgcolor="#2e2292">
     <TD class="top"><TABLE summary="topbar_1_logo" cellspacing="0" cellpadding="0" border="0" width=
       "100%">
         <TR><TD width="319"><a href="../../index.shtml"><IMG src="../../common/images/logolftop_319x45.gif"
           alt="[LinuxFocus-icon]" width="319" height="45" align="left" 
           border="0"></a></TD>

           <TD class="top">
             <TABLE summary="topbar_1_links" width="100%">
               <TR align="right">
                 <TD class="top">
                 
                 <A class="nodec" href="../../index.shtml"><FONT color=
                 "#DDDDDD" size="2">&lt;--</FONT></A> &nbsp;| 
                 <A class="nodec" href="../map.html"><FONT color=
                 "#DDDDDD" size="2">Map</FONT></A> &nbsp;| 
                 <A class="nodec" href="../indice.html"><FONT color=
                 "#DDDDDD" size="2">Index</FONT></A> &nbsp;| 
                 <A class="nodec" href="../Search/index.html"><FONT color=
                 "#DDDDDD" size="2">Search</FONT></A> </TD>
                 
               </TR>

               <TR align="right">
                 <TD class="top">
                   <HR width="100%" noshade size="1">
                 </TD>
               </TR>
             </TABLE>
           </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end top navegation bar -->
 <!-- blue bar -->
 <TABLE summary="topbar_2" cellspacing="0" cellpadding="0" border="0" align="center"
 width="90%">
   <TR bgcolor="#00ffff">
     <TD><IMG src="../../common/images/transpix.gif" width="1" height=
     "2" alt=""></TD>
   </TR>
 </TABLE>
 <!-- end blue bar -->
 <!-- bottom navegation bar -->
 <TABLE summary="topbar_3" cellspacing="0" cellpadding="0" border="0" align="center"
 width="94%">
   <TR bgcolor="#000000">
     <TD>
       <TABLE summary="topbar_3_links" cellspacing="0" cellpadding="1" border="0" width=
       "100%">
         <TR align="center">
           <TD WIDTH="20%"><A class="nodec" href="../News/index.html"><FONT color=
           "#FFFFFF">News</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Archives/index.html"><FONT color=
           "#FFFFFF">Archives</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Links/index.html"><FONT color=
           "#FFFFFF">Links</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../aboutus.html"><FONT color=
           "#FFFFFF">About LF</FONT></A> </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end bottom navegation bar -->
<!-- stop navegation bar -->

<!-- SSI_INFO -->

<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfdynahead ver 1.5 --><TABLE ALIGN="right" border=0><TR><TD ALIGN="right"><FONT SIZE="-1" FACE="Arial,Helvetica">This document is available in: <A href="../../English/December2004/article359.shtml">English</a> &nbsp;<A href="../../ChineseGB/December2004/article359.shtml">ChineseGB</a> &nbsp;<A href="../../Deutsch/December2004/article359.shtml">Deutsch</a> &nbsp;<A href="../../Francais/December2004/article359.shtml">Francais</a> &nbsp;<A href="../../Polish/December2004/article359.shtml">Polish</a> &nbsp;</FONT></TD></TR></TABLE><br>
 


<!-- SSI_INFO STOP -->
<!-- 2pdaIgnoreStop -->

<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_START -->
<TABLE ALIGN="LEFT" BORDER="0" WIDTH="195" summary="about the author" class="left">
<TR>
<TD>

<img src="../../common/images2/JanAlonzo.jpg" alt="[Photo of the Author]" width="150" height="155">
<BR>by  Jan Alonzo <a href="http://www.unpluggable.com/"><font size="1">(homepage)</font></a>
<BR><BR>
<I>About the author:</I><BR>
<!-- aboutauthor_start -->
<p>Jan runs Debian Linux on his IBM T20</p>
<!-- aboutauthor_stop -->
<!-- TRANSLATED_TO en -->
<!-- TRANSLATED_TO_STOP -->
<!-- INDEX_START -->
<BR><i>Content</i>:
<UL>
  <LI><A HREF="#359lfindex0">Software Requirements</A></LI>
  <LI><A HREF="#359lfindex1">Creating the DOS Partition</A></LI>
  <LI><A HREF="#359lfindex2">Formatting the partition</A></LI>
  <LI><A HREF="#359lfindex3">Creating the hibernation file</A></LI>
  <LI><A HREF="#359lfindex4">Sound</A></LI>
  <LI><A HREF="#359lfindex5">Testing</A></LI>
  <LI><A HREF="#359lfindex6">Troubleshooting</A></LI>
  <LI><A HREF="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=359">Talkback form for this article</A></LI>
</UL>

</TD></TR></TABLE>
<!-- INDEX_STOP -->
<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_STOP -->
<!-- HEAD_OF_THE_ARTICLE_START -->
<br>&nbsp;
<table border="0"><tr><td>
<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfPdf ver 0.1 -->
<TABLE style="border-style:outset; border-width:1px" align="right" bgcolor="#ff9616" cellspacing="1"><TR><TD bgcolor="#ff9616">
        <a href="../Archives/lf-2004_12-0359.pdf"><small>PDF</small></a>
        </TD></TR></TABLE>
         

<H2>Fn-F12: Hibernate an IBM Thinkpad T20 laptop</H2>
 <img src="../../common/images2/article359/t20.jpg" alt="t20" hspace="10" width="200" height="111">
<!-- ABSTRACT OF THE ARTICLE -->
<P><i>Abstract</i>:
<P>
<!-- articleabstract_start -->

    This article explains how to make Hibernate (suspend-to-disk) work on a IBM Thinkpad T20
    with no windows installed. The solution presented here may also
    work for other Thinkpads with a Phoenix BIOS but I have
    tested it only on a T20.

    
<!-- articleabstract_stop -->

<br><!-- HR divider --><center><font color="#8282e0"><b>_________________ _________________ _________________</b></font></center><br>
</td></tr></table>
<!-- HEAD_OF_THE_ARTICLE_STOP -->
<!-- BODY_OF_THE_ARTICLE_START -->


    <A NAME="359lfindex0">&nbsp;</A>
<H2>Software Requirements</H2>


    <p>You need the following programs installed for hibernate to
    work:</p>

<table><tr><td>
    <ul>
      <li>fdisk or cfdisk for partitioning your hard drive.</li>

      <li>dosfstools for creating the FAT16 filesystem.</li>

      <li><a href=
      "http://samba.org/ftp/unpacked/junkcode/tphdisk.c">tphdisk.c
      (from samba.org)</a> for creating the <em>hibernate</em> file
      (local copy: <a href=
      "../../common/src2/article359/tphdisk.tar.gz">tphdisk.tar.gz</a>)</li>
    </ul>
</td></tr></table>

    <p>fdisk usually comes with your default Linux install. cfdisk
    usually comes with a <a href="http://www.debian.org">Debian</a>
    default install. tphdisk was written by Andrew Tridgell for his
    Thinkpad T20.</p>

    <A NAME="359lfindex1">&nbsp;</A>
<H2>Creating the DOS Partition</H2>


    <p>First you have to make sure that you have a spare
    <em>PRIMARY</em> block in your device. This is important as
    Thinkpads only hibernate on PRIMARY partitions, not on extended
    partitions. Been there, done that.</p>

    <p>The rule of thumb is: "size of RAM + size of graphic
    adapter's RAM + extra MBs for safety". If you are planning to
    upgrade your RAM soon, make sure you take into consideration
    the size of your future RAM, or else you have to recreate the
    partition again.</p>

    <p>Once you have created the partition, set it to type "Hidden
    Win95 (FAT16) LBA". The partition code is "1E".</p>
<pre class="code">
RAM:     128 MB
VGA RAM:   8 MB

Hibernation partion: 150 MB (for safety)
</pre>

    <p>It is up to you how much extra you want to put in the
    partition. If you're having problems, kindly refer to the
    <strong>Troubleshooting</strong> section.</p>

    <p>Now Reboot your laptop.</p>

    <A NAME="359lfindex2">&nbsp;</A>
<H2>Formatting the partition</H2>


    <p>mkdosfs is part of the dosfstools package.</p>
<pre class="code">
As root:

$ mkdosfs /dev/hdaX
</pre>

    <p>... where hdaX is the partition you just created above
    (<em>Creating the DOS Partition section</em>).</p>

    <p>Now mount the partition:</p>
<pre class="code">
$ mount /dev/hdaX /mnt/hibernate
</pre>

    <A NAME="359lfindex3">&nbsp;</A>
<H2>Creating the hibernation file</H2>


    <ol>
      <li>Get tphdisk at <a href=
      "http://samba.org/ftp/unpacked/junkcode/tphdisk.c">http://samba.org/ftp/unpacked/junkcode/tphdisk.c</a>
      or local copy: <a href=
      "../../common/src2/article359/tphdisk.tar.gz">tphdisk.tar.gz</a></li>

      <li>Compile tphdisk.</li>

      <li>Create the file "save2dsk.bin".
      <strong>save2dsk.bin</strong> is the filename of the
      hibernation file. No, it's not an optional filename.</li>
    </ol>
<pre class="code">
$ gcc -o tphdisk tphdisk.c
$ ./tphdisk N &gt; /mnt/hibernate/save2dsk.bin

</pre>

    <p>... where:</p>

    <p><strong>N</strong> = size of the file. See rule of thumb
    above.</p>

    <p>Reboot your laptop.</p>

    <A NAME="359lfindex4">&nbsp;</A>
<H2>Sound</H2>

    It is a known problem that the cs46xx sound card driver of the
    T20 does not re-initialize the hardware registers after a
    suspend or hibernate operation. In other words Linux will be
    fully operational but you will not hear any sound after a
    suspend to ram or suspend to disk. A work around is to run
    manually "/etc/init.d/alsasound restart" if you care about
    sound. <br>
    See also <a href=
    "http://panopticon.csustan.edu/thood/tp600lnx.htm#secsnd">http://panopticon.csustan.edu/thood/tp600lnx.htm#secsnd</a>
    for more suggestions on how to solve this "sound silent
    problem".

    <A NAME="359lfindex5">&nbsp;</A>
<H2>Testing</H2>


    <ul>
      <li>Press <strong>Fn-F12</strong>.</li>
    </ul>

    <p>Your screen should blank and after a couple of seconds, the
    Phoenix BIOS hibernate utility should come up and start dumping
    the contents of your RAM to your newly created hibernation
    file:<br>
    </p>

    <center>
      <img src="../../common/images2/article359/t20-hibernate.jpg" alt="Phoenix BIOS hibernate" width="320" height="299">
    </center>
    <br>
    <br>


    <A NAME="359lfindex6">&nbsp;</A>
<H2>Troubleshooting</H2>


    <ol>
      <li>While creating the hibernation file, I received an error
      says "Write Failed"!</li>
    </ol>

    <ul>
      <li>Make sure you put enough space in your partition. Try to
      make it bigger and see if that works.</li>

      <li>Your thinkpad should be using Phoenix BIOS.<br>
      </li>
    </ul>

    <ol>
      <li>When I tried to hibernate, the system just hangs!</li>
    </ol>

    <ul>
      <li>Make sure your hibernate partition is mounted</li>

      <li>Your did something wrong! Backtrack and make sure you got
      everything alright.</li>
    </ul>

    <ol>
      <li>"System is invalid"!</li>
    </ol>

    <ul>
      <li>You formatted the partition with the wrong filesystem.
      (See <em>Creating the DOS Partition</em> above)</li>

      <li>The partition is an extended (logical) partition. I told
      you it has to be PRIMARY.</li>
    </ul>
  



<!-- BODY_OF_THE_ARTICLE_STOP -->
<!-- 2pdaIgnoreStart -->
<A NAME="talkback">&nbsp;</a>
<h2>Talkback form for this article</h2>
Every article has its own talkback page. On this page you can submit a comment or look at comments from other readers:
<center>
    <table width="250" border=0><tr><td>
    <div class="tbbutton"><A class="nodec" href="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=359">&nbsp;talkback page&nbsp;</a></div>
    </td></tr></table>
</center>

<br clear="all">
<HR size="2" noshade>
<table width="250" border=0><tr><td>
<div class="bbutton"><a class="nodec" href="../../index.shtml">&lt;--, LF Home</a></div>
</td><td>
<div class="bbutton"><a class="nodec" href="index.shtml">Go to the index of this issue</a></div>
</td></tr></table>
<br clear="all">
<HR size="2" noshade>
<!-- ARTICLE FOOT -->
<CENTER><TABLE WIDTH="98%" summary="footer">
<TR><TD ALIGN=CENTER BGCOLOR="#bdc6d5" WIDTH="50%">
<A HREF="../../common/lfteam.html">Webpages maintained by the LinuxFocus Editor team</A>
<BR><FONT COLOR="#1111aa"><a href="../../common/copy.html">&copy; Jan Alonzo</a><br>&quot;some rights reserved&quot; see <a href="../../license/index.shtml">linuxfocus.org/license/</a><br><a href="http://www.linuxfocus.org">http://www.LinuxFocus.org</a></FONT>
</TD>
<TD BGCOLOR="#bdc6d5">
<!-- TRANSLATION INFO -->
<font size=2>Translation information:</font>
<TABLE summary="translators">
  <tr><td><font size="2">en --&gt; -- : Jan Alonzo (<a href="http://www.unpluggable.com/"><font size="1">homepage</font></a>)</font></td></tr>
</TABLE>
</TD>
</TR></TABLE></CENTER>
<p><font size=1>2005-01-14, generated by lfparser version 2.52</font></p>
<!-- 2pdaIgnoreStop -->
</BODY>
</HTML>
