<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
 <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
 <META NAME="GENERATOR" CONTENT="lfparser_2.52">
 <META NAME="LFCATEGORY" CONTENT="UNIXBasics">
 <link rel="icon" href="../../common/images/lf-16.png" type="image/png">
 <TITLE>lf370, UNIXBasics: LF Tip: Clonando PCs completos por la red</TITLE>
<style type="text/css">
<!--
 td.top {font-family: Arial,Geneva,Verdana,Helvetica,sans-serif; font-size:12 }
 pre { font-family:monospace,Courier }
 pre.code { font-family:monospace,Courier;background-color:#aedbe8; }
 p.cl { color:#EE9500 }
 table.left { margin-right:0.3cm }
 a.nodec { text-decoration:none }
 p.trans { font-size:8pt; text-align:right }
 p.clbox { width:50%; alignment:center; background-color:#FFD700; 
           border-style:none; border-width:medium; border-color:#FFD700; 
           padding:0.5cm;  text-align:center }
 p.code { width:80%; alignment:center; background-color:#aedbe8; 
          border-style:none; border-width:medium; border-color:#aedbe8; 
          padding:0.1cm;  text-align:left }
 p.foot { background-color:#AAAAAA; color:#FFFFFF; border-style:none; 
          border-width:medium; border-color:#AAAAAA; padding:0.5cm ; 
          margin-top:0.1cm; margin-right:1cm; margin-left:1cm; 
          text-align:center }
 div.tbbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   margin: 2px 5px 2px 5px;
   text-align: center;
   width: 20em;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
 div.bbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   float: left;
   margin: 2px 5px 2px 5px;
   text-align: center;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
-->
</style>
 
</HEAD>
<BODY bgcolor="#ffffff" text="#000000">
 <!-- this is generated html code. NEVER use this file for your
 translation work. Instead get the file with the same article number
 and .meta.shtml in its name. Translate this meta file and then
 use lfparser program to generate the final article -->
 <!-- lfparser can be obtained from http://main.linuxfocus.org/~guido/dev/lfparser.html -->

<!-- this is used by a number of tools:
 =LF=AUTHOR: Gerrit Renker
 =LF=CAT___: UNIXBasics
 =LF=TITLE_: LF Tip: Clonando PCs completos por la red
 =LF=NUMBER: 370
 =LF=ANAME_: article370.shtml
 =LF=PARSER: 2.52
 -->

<!-- 2pdaIgnoreStart -->

<!-- start navegation bar, current, style=2 -->
 <!-- top navegation bar -->
 <TABLE summary="topbar_1" cellspacing="0" cellpadding="0" border="0" align="center" width="90%">
   <TR bgcolor="#2e2292">
     <TD class="top"><TABLE summary="topbar_1_logo" cellspacing="0" cellpadding="0" border="0" width=
       "100%">
         <TR><TD width="319"><a href="../../index.shtml"><IMG src="../../common/images/logolftop_319x45.gif"
           alt="[LinuxFocus-icon]" width="319" height="45" align="left" 
           border="0"></a></TD>

           <TD class="top">
             <TABLE summary="topbar_1_links" width="100%">
               <TR align="right">
                 <TD class="top">
                 
                 <A class="nodec" href="../../index.shtml"><FONT color=
                 "#DDDDDD" size="2">&lt;--</FONT></A> &nbsp;| 
                 <A class="nodec" href="../map.html"><FONT color=
                 "#DDDDDD" size="2">Mapa</FONT></A> &nbsp;| 
                 <A class="nodec" href="../indice.html"><FONT color=
                 "#DDDDDD" size="2">Indice</FONT></A> &nbsp;| 
                 <A class="nodec" href="../Search/index.html"><FONT color=
                 "#DDDDDD" size="2">Busqueda</FONT></A> </TD>
                 
               </TR>

               <TR align="right">
                 <TD class="top">
                   <HR width="100%" noshade size="1">
                 </TD>
               </TR>
             </TABLE>
           </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end top navegation bar -->
 <!-- blue bar -->
 <TABLE summary="topbar_2" cellspacing="0" cellpadding="0" border="0" align="center"
 width="90%">
   <TR bgcolor="#00ffff">
     <TD><IMG src="../../common/images/transpix.gif" width="1" height=
     "2" alt=""></TD>
   </TR>
 </TABLE>
 <!-- end blue bar -->
 <!-- bottom navegation bar -->
 <TABLE summary="topbar_3" cellspacing="0" cellpadding="0" border="0" align="center"
 width="94%">
   <TR bgcolor="#000000">
     <TD>
       <TABLE summary="topbar_3_links" cellspacing="0" cellpadding="1" border="0" width=
       "100%">
         <TR align="center">
           <TD WIDTH="20%"><A class="nodec" href="../News/index.shtml"><FONT color=
           "#FFFFFF">Noticias</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Archives/index.html"><FONT color=
           "#FFFFFF">Arca</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Links/index.html"><FONT color=
           "#FFFFFF">Enlaces</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../aboutus.html"><FONT color=
           "#FFFFFF">Sobre LF</FONT></A> </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end bottom navegation bar -->
<!-- stop navegation bar -->

<!-- SSI_INFO -->

<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfdynahead ver 1.5 --><TABLE ALIGN="right" border=0><TR><TD ALIGN="right"><FONT SIZE="-1" FACE="Arial,Helvetica">Este documento est&aacute; disponible en los siguientes idiomas: <A href="../../English/March2005/article370.shtml">English</a> &nbsp;<A href="../../Castellano/March2005/article370.shtml">Castellano</a> &nbsp;<A href="../../ChineseGB/March2005/article370.shtml">ChineseGB</a> &nbsp;<A href="../../Francais/March2005/article370.shtml">Francais</a> &nbsp;<A href="../../Indonesian/March2005/article370.shtml">Indonesian</a> &nbsp;<A href="../../Turkce/March2005/article370.shtml">Turkce</a> &nbsp;</FONT></TD></TR></TABLE><br>
 


<!-- SSI_INFO STOP -->
<!-- 2pdaIgnoreStop -->

<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_START -->
<TABLE ALIGN="LEFT" BORDER="0" WIDTH="195" summary="about the author" class="left">
<TR>
<TD>

<img alt="this is me" src="../../common/images2/GerritRenker.jpg" width="175" height="213">
<BR>por  Gerrit Renker <br> <small>&lt;gerrit.renker(at)gmx.de&gt;</small>
<BR><BR>
<I>Sobre el autor:</I><BR>
<!-- aboutauthor_start -->

Obtuvo su titulaci&oacute;n en inform&aacute;tica en el a&ntilde;o 2.001.


<!-- aboutauthor_stop -->
<!-- TRANSLATED_TO es -->
<BR><BR><I>Traducido al espa&ntilde;ol por:</I><BR>
guadapeich (<a href="http://guadapeich.bitacoras.com/"><font size="1">homepage</font></a>)
<br>
<!--
 =LF=TRANSTO=es: guadapeich
-->
<!-- TRANSLATED_TO_STOP -->
<!-- INDEX_START -->
<BR><i>Contenidos</i>:
<UL>
  <LI><A HREF="#370lfindex0">Escenario</A></LI>
  <LI><A HREF="#370lfindex1">M&eacute;todos posibles </A></LI>
  <LI><A HREF="#370lfindex2">Configurando ssh</A></LI>
  <LI><A HREF="#370lfindex3"> Creando un sistema de ficheros en el PC destino </A></LI>
  <LI><A HREF="#370lfindex4">Otros sistemas</A></LI>
  <LI><A HREF="#370lfindex5">Referencias </A></LI>
  <LI><A HREF="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=370">Formulario de "talkback" para este art&iacute;culo</A></LI>
</UL>

</TD></TR></TABLE>
<!-- INDEX_STOP -->
<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_STOP -->
<!-- HEAD_OF_THE_ARTICLE_START -->
<br>&nbsp;
<table border="0"><tr><td>
<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfPdf ver 0.1 -->
<TABLE style="border-style:outset; border-width:1px" align="right" bgcolor="#ff9616" cellspacing="1"><TR><TD bgcolor="#ff9616">
        <a href="../Archives/lf-2005_03-0370.pdf"><small>PDF</small></a>
        </TD></TR></TABLE>
         

<H2>LF Tip: Clonando PCs completos por la red</H2>
 <img src="../../common/images2/article370.png" alt="[Illustration]" hspace="10"  width="136" height="150">
<!-- ABSTRACT OF THE ARTICLE -->
<P><i>Resumen</i>:
<P>
<!-- articleabstract_start -->


Es frecuente encontrarse con la necesidad de replicar los datos desde un ordenador a otro. Un m&eacute;todo seguro, sencillo y efectivo es utilizar un clonado por la red como se describe en este C&oacute;mo.


<!-- articleabstract_stop -->

<br><!-- HR divider --><center><font color="#8282e0"><b>_________________ _________________ _________________</b></font></center><br>
</td></tr></table>
<!-- HEAD_OF_THE_ARTICLE_STOP -->
<!-- BODY_OF_THE_ARTICLE_START -->



<A NAME="370lfindex0">&nbsp;</A>
<H2>Escenario</H2>


Mientras que el clonado de animales ("la oveja Dolly") y de embriones humanos es un &aacute;rea de investigaci&oacute;n muy discutida y dudosa, no hay duda que alg&uacute;n conocimiento en el clonado de ordenadores es menos peligroso (si est&aacute; hecho correctamente) y m&aacute;s &uacute;til para quien escribe cuidadosamente scripts de configuraci&oacute;n y opciones. Debido a la Ley de Moore y el r&aacute;pido progreso en la fabricaci&oacute;n de ordenadores, es casi seguro que uno se encontrar&aacute; un escenario de replicado durante el uso de una distribuci&oacute;n - puede ser que cambies el PC casero por un port&aacute;til o que un nuevo procesador m&aacute;s r&aacute;pido sale a la venta y tienes bastante dinero para comprar un nuevo ordenador. La tarea es <i>tomar el sistema de archivos completo</i> del ordenador A y ponerlo a funcionar en el ordenador B. Hay dos maneras de hacerlo; una que no est&aacute; explicada en este C&oacute;mo es abrir la carcasa, conectar f&iacute;sicamente los discos duros y hacer la copia localmente sobre un mismo ordenador. Esto frecuentemente no es posible - abrir la carcasa puede implicar la p&eacute;rdida de la garant&iacute;a - y tambi&eacute;n tiene riesgos ya que una persona inexperta puede da&ntilde;ar f&iacute;sica y el&eacute;ctricamente el equipo. Y m&aacute;s que eso, una vez perd&iacute; los datos de un disco de esta forma por culpa de un mal programa de bajo nivel. La otra aproximaci&oacute;n, que requiere que ambos PCs tengan tarjetas de red (lo que es un caso frecuente en equipos caseros), es mucho m&aacute;s segura y se explica aqu&iacute;.


<p>
La idea com&uacute;n subyacente a todos los m&eacute;todos descritos a continuaci&oacute;n es establecer una conexi&oacute;n de red entre el ordenador "<i>origen</i>" (el que va a ser clonado) y el ordenador "<i>destino</i>" (el clon). Esto es simple si ambos est&aacute;n conectados a un hub, en otro caso puedes conectar las tarjetas de red mediante un <i>cable cruzado</i> (los cables rectos normales no se pueden utilizar).

Para el PC destino, un Live-CD (como Knoppix o LNX-BBC) o una instalaci&oacute;n minimalista es necesaria de tal forma que la tarjeta de red est&eacute; operativa y <tt>ssh</tt> y/o <tt>netcat</tt> puedan ser usados. Hay tambi&eacute;n algunas distribuciones en disquete que te lo permitir&aacute;n (en mi equipo <tt>tomsrtb</tt> no levant&oacute; la tarjeta de red al inicio). Si quieres instalar una nueva distribuci&oacute;n, esa es tambi&eacute;n una alternativa f&aacute;cil. Ambos ordenadores necesitan ser configurados con direcciones IP en la misma red de forma que puedan "hablar" uno con otro, como se muestra en la ilustraci&oacute;n superior.

</p>


<A NAME="370lfindex1">&nbsp;</A>
<H2>M&eacute;todos posibles </H2>




<p>
Con la configuraci&oacute;n b&aacute;sica descrita hay varias formas de realizar el clonado:

</p>


<ul>
<li>copia binaria con <tt>dd</tt></li>
<li>tuber&iacute;a con <tt>tar / cpio</tt></li>
<li><tt>rsync </tt> </li>
<li><tt>dump</tt> y <tt>restore</tt></li>
</ul>


Lo primero es complicado, si no imposible, si tus discos duros no son del mismo tipo y con la misma geometr&iacute;a. Es grandioso para cosas como copiar im&aacute;genes iso (<tt>dd if=/dev/cdrom of=the.iso</tt>), o disquetes - <a href="../../common/src2/article370/diskcopy.txt">este (script de copia de disquete)</a> es un ejemplo de un script <tt>diskcopy</tt>
 utilizando <tt>dd</tt>. El otro inconveniente del m&eacute;todo basado en <tt>dd</tt> es que el espacio vac&iacute;o tambi&eacute;n ser&aacute; copiado, ocupando tiempo innecesariamente.
La tuber&iacute;a de <tt>tar</tt> y <tt>cpio</tt> toma mucho tiempo (incluso horas) y tiene varios problemas. Por ejemplo, hay restricciones en el nombre de los ficheros y uso de los enlaces, perdi&eacute;ndolos en los archivos en <tt>/dev</tt>, y similares. Yo no recomendar&iacute;a esta soluci&oacute;n para el replicado. Si tienes diferentes sistemas de ficheros en el origen y destino, <b><tt>rsync(1)</tt></b> es probablemente la mejor elecci&oacute;n. S&oacute;lo necesita que <tt>ssh</tt> est&eacute; corriendo y transmitir&aacute; archivos eficazmente entre ambos mediante un eficiente protocolo incorporado.
Incluso tiene una opci&oacute;n <tt>-D</tt>  para los archivos de dispositivos, as&iacute; como muchas otras opciones para utilizar en la mayor&iacute;a de las situaciones posibles. Es una herramienta muy &uacute;til para las copias de seguridad diarias, copias espejo y cosas as&iacute;, la p&aacute;gina de manual con sus muchos ejemplos merece la pena estudiarla. Un ejemplo de clonado v&iacute;a <tt>rsync</tt> se explica en  [<a href="#key-2">1</a>].<br><br> Aqu&iacute;, nosotros usamos el m&eacute;todo mediante <tt>dump</tt> y <tt>restore</tt> el cual significa replicar el sistema de ficheros completo. Es r&aacute;pido, efectivo y obtiene el resultado deseado con el m&iacute;nimo esfuerzo, por lo tanto ideal para la replicaci&oacute;n completa.
Tuve que hacer realmente el procedimiento entero de clonado dos veces, puesto que el PC destino fue devuelto y sustituido. En ambos casos no se encontraron problemas y se obtuvo una copia arrancable funcional en el plazo de aproximadamente una hora de copiado de gigabytes.
Este enfoque requiere que tanto el PC origen como el destino tengan el mismo tipo de sistema de ficheros. Asumimos que &eacute;ste es <tt>ext2</tt> o <tt>ext3</tt>, puesto que son los tipos actualmente m&aacute;s usados (vea las notas <a href="#sec:Other-systems">abajo</a>).


<A NAME="370lfindex2">&nbsp;</A>
<H2>Configurando ssh</H2>


Una vez que  hayas configurado un sistema con una instalaci&oacute;n m&iacute;nima o tengas en funcionamiento un Live-CD, el paso siguiente es instalar <tt>ssh</tt> (si no estas utilizando <tt>netcat</tt> para la transferencia seg&uacute;n se explica m&aacute;s abajo). Esto requiere que el PC origen tenga <tt>sshd</tt> (the secure shell daemon) corriendo. Comprueba <tt>/etc/init.d/</tt> si dudas. En el PC destino, teclea como root:

<pre class="code">ssh-keygen -t rsa</pre>

Para mantener las cosas simples, no entres una clave. La llave p&uacute;blica est&aacute; en el archivo <tt>/root/.ssh/id_rsa.pub</tt>. Copia este archivo al PC origen mediante

<pre class="code">scp /root/.ssh/id_rsa   SourcePC:/tmp</pre>


donde <tt>SourcePC</tt> es la direcci&oacute;n IP del PC origen. Cuando pregunte si estas seguro, teclea un completo ''<tt>yes</tt>'' (solamente "<tt>y</tt>'' algunas veces no funciona). Estas todav&iacute;a siendo preguntado por la contrase&ntilde;a de root en el PC origen. Ahora agrega el PC destino como un nodo de la red confiable mediante


<pre class="code">cat /tmp/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys</pre>



en el PC origen. Para comprobar si todo est&aacute; correcto, repite el anterior comando de copia en el PC destino. No ser&aacute;s preguntado mas por la contrase&ntilde;a.


<A NAME="370lfindex3">&nbsp;</A>
<H2> Creando un sistema de ficheros en el PC destino </H2>




<p>
El primer paso es siempre particionar el disco duro en el ordenador destino y entonces crear el sistema de ficheros
<tt>ext2/ext3</tt>. El &uacute;ltimo es activar la variante preferida de journalling simplemente colocando la opci&oacute;n <tt>-j</tt> (journalling) en <tt>mke2fs</tt> (requiere tener soporte <tt>ext3</tt> en el kernel). Puedes incluso convertir un sistema <tt>ext2</tt> a <tt>ext3</tt>, mira <b><tt>tune2fs(8</tt>)</b>.
Digamos que en el ordenador origen tenemos la configuraci&oacute;n siguiente:

</p>

<table align="center" bgcolor="#000000" border="0" cellpadding="2" cellspacing="2" width="56%">
  <tbody>
    <tr>
      <th bgcolor="#ffffff" valign="top">Partici&oacute;n</th>
      <th bgcolor="#ffffff" valign="top">Tama&ntilde;o</th>
      <th bgcolor="#ffffff" valign="top">Usada</th>
      <th bgcolor="#ffffff" valign="top">%Usada</th>
      <th bgcolor="#ffffff" valign="top">Montada en</th>

    </tr>
    <tr>
      <td bgcolor="#ffffff" valign="top">/dev/hda3
      </td>
      <td bgcolor="#ffffff" valign="top">2.7G</td>
      <td bgcolor="#ffffff" valign="top">552M</td>
      <td bgcolor="#ffffff" valign="top">22%</td>
      <td bgcolor="#ffffff" valign="top">/</td>
    </tr>
    <tr>
      <td bgcolor="#ffffff" valign="top">/dev/hda5
      </td>
      <td bgcolor="#ffffff" valign="top">7.8G <br>
      </td>
      <td bgcolor="#ffffff" valign="top">1.6G</td>
      <td bgcolor="#ffffff" valign="top">22%</td>
      <td bgcolor="#ffffff" valign="top">/usr</td>
    </tr>
    <tr>
      <td bgcolor="#ffffff" valign="top">/dev/hda7
      </td>
      <td bgcolor="#ffffff" valign="top">6.3G</td>
      <td bgcolor="#ffffff" valign="top">1.7G</td>
      <td bgcolor="#ffffff" valign="top">28%</td>
      <td bgcolor="#ffffff" valign="top">/usr/share</td>
    </tr>
    <tr>
      <td bgcolor="#ffffff" valign="top">/dev/hda8
      </td>
      <td bgcolor="#ffffff" valign="top">3.4G</td>
      <td bgcolor="#ffffff" valign="top">601M</td>
      <td bgcolor="#ffffff" valign="top">19%</td>
      <td bgcolor="#ffffff" valign="top">/home</td>
    </tr>
    <tr>
      <td bgcolor="#ffffff" valign="top">/dev/hda12
      </td>
      <td bgcolor="#ffffff" valign="top">5.3G</td>
      <td bgcolor="#ffffff" valign="top">1.9G</td>
      <td bgcolor="#ffffff" valign="top">37%</td>
      <td bgcolor="#ffffff" valign="top"> /opt</td>
    </tr>
    <tr>
      <td bgcolor="#ffffff" valign="top">/dev/hda1
      </td>
      <td bgcolor="#ffffff" valign="top">587M</td>
      <td bgcolor="#ffffff" valign="top">70M</td>
      <td bgcolor="#ffffff" valign="top">13% <br>
      </td>
      <td bgcolor="#ffffff" valign="top">/var/backup</td>
    </tr>
  </tbody>
</table>


<p>
Recomiendo hacer siempre alguna clase de partici&oacute;n. Si no en caso de fallo en el sistema de ficheros o corrupci&oacute;n de algunos sectores del disco duro se pueden destruir <em>todos</em> tus datos. Y de acuerdo a la Ley de Murphy, es seguro que suceder&aacute; si no tomas precauciones usando particiones diferentes en vez de usar una &uacute;nica. Tuve un caso recientemente con un kernel gracioso y no hab&iacute;a particionado el disco, perd&iacute; todos mis datos sobre el sistema de ficheros corrupto. Arriba se muestra que <tt>/usr</tt> se hizo demasiado grande, por eso <tt>/usr/share</tt> ha sido a&ntilde;adido. Es el momento para conseguir un disco duro mayor.

</p>

En el PC destino lanza <tt>parted</tt> (recomendado) o tu particionador favorito (Qtparted es una bonita variante en modo gr&aacute;fico, que dice ser un clon de Partition Magic). Crea particiones al menos tan grandes como las del PC origen. No olvides la partici&oacute;n swap. Despu&eacute;s de salvar la tabla de particiones, instala un sistema de ficheros en todas la particiones recientemente creadas, usando

<pre class="code">mke2fs -j -L &lt;label&gt; /dev/xxx</pre>


donde <tt>xxx</tt> es el nombre de la partici&oacute;n y <tt>&lt;label&gt;</tt> una etiqueta. Normalmente uso cosas como  ''<tt>/usr</tt>'' como etiquetas (las ver&aacute;s en el arranque). Puedes configurar varias cosas mediante <tt><b>tune2fs(8)</b></tt>, como la revisi&oacute;n del sistema de ficheros de forma regular.

<h1>Transferir el sistema de ficheros </h1>

Primero necesitas montar todas las particiones nuevas. Comenzamos con la ra&iacute;z del sistema ("/") y montamos el resto de directorios. Es perfectamente posible unir dos particiones del PC origen en una sola en el destino, es lo que haremos con <tt>/usr/</tt> y <tt>/usr/share</tt> en el ejemplo anterior. As&iacute; monta tu futuro sistema ra&iacute;z con
<pre class="code">mount /dev/xxx   /mnt</pre>
Al clonar es necesario cambiar al directorio destino
<pre class="code">cd /mnt</pre>
Ahora la red, teclea en el PC destino
<pre class="code">ssh targetPC 'dump -0 -f - /' | restore -r -f -</pre>
donde <tt>targetPC</tt> es la direcci&oacute;n IP del ordenador destino. Las opciones significan ''<tt>-0</tt>'' para una copia de seguridad completa, ''<tt>-f -</tt>'' le dice que use <tt>stdin</tt>/<tt>stdout</tt>
como descriptor de archivo y ''<tt>-r</tt>'' indica a restore que recree el sistema de ficheros mediante volcado por la red en el PC destino. Para m&aacute;s opciones mira <b><tt>dump(8)</tt></b> y <b><tt>restore(8)</tt></b>.
Abajo puedes ver la salida para transferir el sistema de ficheros ra&iacute;z.<br>



<pre class="code">$ ssh 10.42.3.42 'dump -0 -f - /' | restore -r -f -
DUMP: Date of this level 0 dump: Tue Feb 22 15:50:12 2005
DUMP: Dumping /dev/hda3 (/) to standard output
DUMP: Label: debian
DUMP: Writing 10 Kilobyte records
DUMP: mapping (Pass I) [regular files]
DUMP: mapping (Pass II) [directories]
DUMP: estimated 547312 blocks.
DUMP: Volume 1 started with block 1 at: Tue Feb 22 15:50:14 2005
DUMP: dumping (Pass III) [directories]
DUMP: dumping (Pass IV) [regular files]
DUMP: Volume 1 completed at: Tue Feb 22 15:51:43 2005
DUMP: Volume 1 546590 blocks (533.78MB)
DUMP: Volume 1 took 0:01:29
DUMP: Volume 1 transfer rate: 6141 kB/s
DUMP: 546590 blocks (533.78MB)
DUMP: finished in 89 seconds, throughput 6141 kBytes/sec
DUMP: Date of this level 0 dump: Tue Feb 22 15:50:12 2005
DUMP: Date this dump completed: Tue Feb 22 15:51:43 2005
DUMP: Average transfer rate: 6141 kB/s
DUMP: DUMP IS DONE
</pre>
Restore siempre crea un archivo <tt>restoresymtable</tt> el cual puede ser borrado una vez que estas convencido de que no se han producido errores durante la reconstrucci&oacute;n del sistema de ficheros.


Finalizado el sistema de ficheros ra&iacute;z, ahora procedemos con cada partici&oacute;n, comenzando con  <tt>/usr</tt> (asumiendo que tu actual directorio de trabajo es la ra&iacute;z del futuro sistema de ficheros).


<pre class="code">mount /dev/xxx  ./usr

cd ./usr

ssh targetPC 'dump -0 -f - /usr' | restore -r -f -
</pre>

El ciclo mount-cd-dump/restore se repite para todos los directorios que tengas. Con miras a <tt>/usr/share</tt> (el cual en el PC origen tiene su propia partici&oacute;n) puedes, despu&eacute;s del paso anterior, simplemente cambiar al directorio <tt>./usr/share</tt> (f&iacute;jate en el ".") y entonces repetir


<pre class="code">ssh targetPC 'dump -0 -f - /usr/share' | restore -r -f -</pre>


Restore solo se queja si los archivos existen en el sistema de ficheros que est&aacute; siendo restaurado, as&iacute; cuando ponemos dos particiones diferentes del PC origen en el PC destino no hay problema. Clonar un PC completo tom&oacute; sobre una hora con ssh y tarjetas de red de 100MB (con cable cruzado algo m&aacute;s).


<p>
<strong>Nota: </strong>Para volcar un sistema de ficheros, no es necesario que est&eacute; montado.
Puedes tambi&eacute;n pasar un <i>nombre de partici&oacute;n</i>, como <big><tt>/dev/hda6</tt></big>,
en vez del nombre del directorio donde se monta la partici&oacute;n.
</p>



<h1>Alternativa: &nbsp;<tt>netcat</tt> </h1>

<p>
Una alternativa, en vez de usar ssh, es <tt>netcat(1)</tt> que se abrevia como nc. Netcat es la navaja suiza de los TCP/IP cliente-servidor y permite crear una tuber&iacute;a sobre la red. El ejemplo anterior es entonces modificado como sigue. Asumimos que la partici&oacute;n montada bajo <big><tt>/var/backup</tt></big> va a ser transferida mediante
<big><tt>dump/restore</tt></big> desde el PC origen a el PC destino.

</p>

En el punto de llegada (<em>PC destino</em>) crea una sesi&oacute;n de escucha de <tt>netcat</tt> v&iacute;a
<tt>-l</tt> que vuelque su salida a <tt>restore</tt>.


<pre class="code">nc -l -p 2000 -q 1 | restore -r -f -</pre>


En el <em>PC origen</em> crea otra sesi&oacute;n de <tt>netcat</tt> que tome su entrada desde una tuber&iacute;a donde  <tt>target-IP</tt> es la direcci&oacute;n IP del PC destino.

<pre class="code">dump -0 -f - /var/backup | nc &lt;target-ip&gt;   2000</pre>

La opci&oacute;n <tt>-q</tt> es para parar <tt>nc</tt> despu&eacute;s de recibir el final del fichero, pero yo tengo que terminarlo manualmente en mi caso. Recomiendo usar <tt>ssh</tt> de todas formas.




<h1> Limpiando </h1>


Felicidades, si lo conseguiste b&aacute;sicamente has clonado un sistema. Ahora queda convertir esta copia en un PC usable. Lo primero es actualizar <tt>/etc/fstab</tt> con los nuevos datos, o no ser&aacute;s capaz de usar las particiones clonadas. Si la direcci&oacute;n IP cambia, tambi&eacute;n necesitas actualizarla (<tt>/etc/hosts</tt>,
<tt>/etc/network/interfaces</tt> en debian). La siguiente cosa importante es la <i>configuraci&oacute;n de arranque</i> que en la mayor&iacute;a de los casos debe ser actualizada. Con <tt>lilo</tt>, edita <tt>/etc/lilo.conf</tt>
(en particular la opci&oacute;n <tt>root=...</tt> ) y entonces corre <tt>lilo -v</tt>. Con grub, edita <tt>/boot/grub/menu.lst</tt>
(o <tt>/boot/grub/grub.conf</tt> dependiendo sobre cual est&eacute; el enlace)
y entonces teclea <tt>grub</tt>,

<pre class="code">grub&gt; root (hd0,xxx)

... filesystem is ...

grub&gt; setup (hd0)

... lots of output here

grub&gt; quit
</pre>

o corre <tt>grub-install /dev/xxx</tt> donde <tt>xxx</tt>
es tu disco duro. Aqu&iacute; comprueba ambos, <tt>root (hdn,xxx)</tt>
y la configuraci&oacute;n a&ntilde;adida a <tt>root=/dev/xxx</tt>.

<p>
En el caso com&uacute;n de que ahora tengas mejor hardware en el PC clonado nuevo, querr&aacute;s actualizar la <i>configuraci&oacute;n de tu kernel a medida.</i> Si estas usando un sistema que viene con montones de m&oacute;dulos preconfigurados (como RedHat, SuSe, Mandrake, Fedora ...) no te preocupes, es bastante posible que exista un m&oacute;dulo utilizable.
En caso contrario, <tt>lspci -vv</tt>
y compilar el kernel es algo com&uacute;n y est&aacute; descrito en muchos sitios. Si tu tarjeta gr&aacute;fica es diferente ahora, actualiza <tt>/etc/X11/XF86Config-4</tt>
(o <tt>xorg.conf</tt> en RH/Fedora) para reflejarlo, o no tendr&aacute;s salida gr&aacute;fica. Es posible usar las herramientas de gr&aacute;ficos para configurar X arrancando en el nivel 3 si tienes esas herramientas. En debian,
alguna investigaci&oacute;n es necesaria, yo fui afortunado al encontrar que el controlador cambi&oacute; de <tt>r128</tt> a
<tt>radeon</tt>
y eso fue lo que hice.

</p>

<a name="sec:Other-systems"></a>
<A NAME="370lfindex4">&nbsp;</A>
<H2>Otros sistemas</H2>



<p>
Este c&oacute;mo explica el procedimiento de clonado para sistemas de ficheros<tt>ext2/ext3</tt>. &Oacute;rdenes muy similares se pueden encontrar en muchos otros sistemas.
Por ejemplo, varios Unices como FreeBSD, HP-UX, IRIX tambi&eacute;n suministran las &oacute;rdenes
<tt>dump/restore</tt>; en Solaris se llama <tt>ufsdump/ufsrestore</tt>.
Hay sistemas de ficheros que no ofrecen la utilidad de volcado, por ejemplo ReiserFS. En este caso recomendar&iacute;a usar <tt>rsync.</tt> Mira [<a href="#key-2">1</a>]
para un informe de clonado de un sistema Linux con &eacute;xito.

</p>


<A NAME="370lfindex5">&nbsp;</A>
<H2>Referencias </H2>


<dl compact="compact">
<dt><a name="key-2">[1]</a>
<i>''<a href="http://www.linuxgazette.com/issue83/okopnik.html">Replicating a Linux System - Yet Another Method</a></i>.'' Ben Okopnik, Linux Gazette Issue 83, October 2002.
</dt>
</dl>


<!-- vim: set sw=2 ts=2 et tw=74: -->


<!-- BODY_OF_THE_ARTICLE_STOP -->
<!-- 2pdaIgnoreStart -->
<A NAME="talkback">&nbsp;</a>
<h2>Formulario de "talkback" para este art&iacute;culo</h2>
Cada art&iacute;culo tiene su propia p&aacute;gina de "talkback". A trav&eacute;s de esa p&aacute;gina puedes enviar un comentario o consultar los comentarios de otros lectores
<center>
    <table width="250" border=0><tr><td>
    <div class="tbbutton"><A class="nodec" href="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=370">&nbsp;Ir a la p&aacute;gina de "talkback"&nbsp;</a></div>
    </td></tr></table>
</center>

<br clear="all">
<HR size="2" noshade>
<table width="250" border=0><tr><td>
<div class="bbutton"><a class="nodec" href="../../index.shtml">&lt;--, LF Hogar</a></div>
</td><td>
<div class="bbutton"><a class="nodec" href="index.shtml">&Iacute;ndice de este n&uacute;mero</a></div>
</td></tr></table>
<br clear="all">
<HR size="2" noshade>
<!-- ARTICLE FOOT -->
<CENTER><TABLE WIDTH="98%" summary="footer">
<TR><TD ALIGN=CENTER BGCOLOR="#bdc6d5" WIDTH="50%">
<A HREF="../../common/lfteam.html">Contactar con el equipo de LinuFocus</A>
<BR><FONT COLOR="#1111aa"><a href="../../common/copy.html">&copy; Gerrit Renker</a><br>&quot;some rights reserved&quot; see <a href="../../license/index.shtml">linuxfocus.org/license/</a><br><a href="http://www.linuxfocus.org">http://www.LinuxFocus.org</a></FONT>
</TD>
<TD BGCOLOR="#bdc6d5">
<!-- TRANSLATION INFO -->
<font size=2>Informaci&oacute;n sobre la traducci&oacute;n:</font>
<TABLE summary="translators">
  <tr><td><font size="2">en --&gt; -- : Gerrit Renker <small>&lt;gerrit.renker(at)gmx.de&gt;</small></font></td></tr>
  <tr><td><font size="2">en --&gt; es: guadapeich (<a href="http://guadapeich.bitacoras.com/"><font size="1">homepage</font></a>)</font></td></tr>
</TABLE>
</TD>
</TR></TABLE></CENTER>
<p><font size=1>2005-05-18, generated by lfparser version 2.52</font></p>
<!-- 2pdaIgnoreStop -->
</BODY>
</HTML>
