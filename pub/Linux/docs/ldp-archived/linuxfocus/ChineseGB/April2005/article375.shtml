<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
 <META http-equiv="Content-Type" content="text/html; charset=gb2312">
 <META NAME="GENERATOR" CONTENT="lfparser_2.52">
 <META NAME="LFCATEGORY" CONTENT="Hardware">
 <link rel="icon" href="../../common/images/lf-16.png" type="image/png">
 <TITLE>lf375, Hardware: lcdproc -- 使LCD显示屏容易使用和制作</TITLE>
<style type="text/css">
<!--
 td.top {font-family: Arial,Geneva,Verdana,Helvetica,sans-serif; font-size:12 }
 pre { font-family:monospace,Courier }
 pre.code { font-family:monospace,Courier;background-color:#aedbe8; }
 p.cl { color:#EE9500 }
 table.left { margin-right:0.3cm }
 a.nodec { text-decoration:none }
 p.trans { font-size:8pt; text-align:right }
 p.clbox { width:50%; alignment:center; background-color:#FFD700; 
           border-style:none; border-width:medium; border-color:#FFD700; 
           padding:0.5cm;  text-align:center }
 p.code { width:80%; alignment:center; background-color:#aedbe8; 
          border-style:none; border-width:medium; border-color:#aedbe8; 
          padding:0.1cm;  text-align:left }
 p.foot { background-color:#AAAAAA; color:#FFFFFF; border-style:none; 
          border-width:medium; border-color:#AAAAAA; padding:0.5cm ; 
          margin-top:0.1cm; margin-right:1cm; margin-left:1cm; 
          text-align:center }
 div.tbbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   margin: 2px 5px 2px 5px;
   text-align: center;
   width: 20em;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
 div.bbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   float: left;
   margin: 2px 5px 2px 5px;
   text-align: center;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
-->
</style>
 
</HEAD>
<BODY bgcolor="#ffffff" text="#000000">
 <!-- this is generated html code. NEVER use this file for your
 translation work. Instead get the file with the same article number
 and .meta.shtml in its name. Translate this meta file and then
 use lfparser program to generate the final article -->
 <!-- lfparser can be obtained from http://main.linuxfocus.org/~guido/dev/lfparser.html -->

<!-- this is used by a number of tools:
 =LF=AUTHOR: Guido     Socher
 =LF=CAT___: Hardware
 =LF=TITLE_: lcdproc -- 使LCD显示屏容易使用和制作
 =LF=NUMBER: 375
 =LF=ANAME_: article375.shtml
 =LF=PARSER: 2.52
 -->

<!-- 2pdaIgnoreStart -->

<!-- start navegation bar, current, style=2 -->
 <!-- top navegation bar -->
 <TABLE summary="topbar_1" cellspacing="0" cellpadding="0" border="0" align="center" width="90%">
   <TR bgcolor="#2e2292">
     <TD class="top"><TABLE summary="topbar_1_logo" cellspacing="0" cellpadding="0" border="0" width=
       "100%">
         <TR><TD width="319"><a href="../../index.shtml"><IMG src="../../common/images/logolftop_319x45.gif"
           alt="[LinuxFocus-icon]" width="319" height="45" align="left" 
           border="0"></a></TD>

           <TD class="top">
             <TABLE summary="topbar_1_links" width="100%">
               <TR align="right">
                 <TD class="top">
                 
                 <A class="nodec" href="../../index.shtml"><FONT color=
                 "#DDDDDD" size="2">&lt;--</FONT></A> &nbsp;| 
                 <A class="nodec" href="../map.html"><FONT color=
                 "#DDDDDD" size="2">站点地图</FONT></A> &nbsp;| 
                 <A class="nodec" href="../indice.html"><FONT color=
                 "#DDDDDD" size="2">索引</FONT></A> &nbsp;| 
                 <A class="nodec" href="../Search/index.shtml"><FONT color=
                 "#DDDDDD" size="2">搜索</FONT></A> </TD>
                 
               </TR>

               <TR align="right">
                 <TD class="top">
                   <HR width="100%" noshade size="1">
                 </TD>
               </TR>
             </TABLE>
           </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end top navegation bar -->
 <!-- blue bar -->
 <TABLE summary="topbar_2" cellspacing="0" cellpadding="0" border="0" align="center"
 width="90%">
   <TR bgcolor="#00ffff">
     <TD><IMG src="../../common/images/transpix.gif" width="1" height=
     "2" alt=""></TD>
   </TR>
 </TABLE>
 <!-- end blue bar -->
 <!-- bottom navegation bar -->
 <TABLE summary="topbar_3" cellspacing="0" cellpadding="0" border="0" align="center"
 width="94%">
   <TR bgcolor="#000000">
     <TD>
       <TABLE summary="topbar_3_links" cellspacing="0" cellpadding="1" border="0" width=
       "100%">
         <TR align="center">
           <TD WIDTH="20%"><A class="nodec" href="../News/index.shtml"><FONT color=
           "#FFFFFF">新闻</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Archives/"><FONT color=
           "#FFFFFF">过往期刊</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Links/index.shtml"><FONT color=
           "#FFFFFF">链接</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../aboutus.html"><FONT color=
           "#FFFFFF">关于LF</FONT></A> </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end bottom navegation bar -->
<!-- stop navegation bar -->

<!-- SSI_INFO -->

<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfdynahead ver 1.5 --><TABLE ALIGN="right" border=0><TR><TD ALIGN="right"><FONT SIZE="-1" FACE="Arial,Helvetica">This document is available in: <A href="../../English/April2005/article375.shtml">English</a> &nbsp;<A href="../../ChineseGB/April2005/article375.shtml">ChineseGB</a> &nbsp;<A href="../../Francais/April2005/article375.shtml">Francais</a> &nbsp;</FONT></TD></TR></TABLE><br>
 


<!-- SSI_INFO STOP -->
<!-- 2pdaIgnoreStop -->

<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_START -->
<TABLE ALIGN="LEFT" BORDER="0" WIDTH="195" summary="about the author" class="left">
<TR>
<TD>

<img src="../../common/images/Guido-S.gif" alt=
    "[Photo of the Author]" height="164" width="173">
<BR>by  Guido Socher <a href="http://linuxfocus.org/~guido/"><font size="1">(homepage)</font></a>
<BR><BR>
<I>关于作者:</I><BR>
<!-- aboutauthor_start -->
<p>
    Guido喜欢Linux，因为对于开发自己的硬件来说，Linux确实是一个很好的系统。
    </p>
<!-- aboutauthor_stop -->
<!-- TRANSLATED_TO gb -->
<!-- TRANSLATED_TO_STOP -->
<!-- INDEX_START -->
<BR><i>目录</i>:
<UL>
  <LI><A HREF="#375lfindex0">lcdprod是什么？</A></LI>
  <LI><A HREF="#375lfindex1">硬件</A></LI>
  <LI><A HREF="#375lfindex2">电路图</A></LI>
  <LI><A HREF="#375lfindex3">lcdproc并口电源补丁</A></LI>
  <LI><A HREF="#375lfindex4">LCDd.conf文件</A></LI>
  <LI><A HREF="#375lfindex5">我们自己的应用程序</A></LI>
  <LI><A HREF="#375lfindex6">参考资料</A></LI>
  <LI><A HREF="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=375">对这篇文章发表评论</A></LI>
</UL>

</TD></TR></TABLE>
<!-- INDEX_STOP -->
<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_STOP -->
<!-- HEAD_OF_THE_ARTICLE_START -->
<br>&nbsp;
<table border="0"><tr><td>
<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfPdf ver 0.1 -->
 

<H2>lcdproc -- 使LCD显示屏容易使用和制作</H2>
 <img src="../../common/images2/article375/title.jpg" alt="[Illustration]" hspace="10" width="350" height="163">
<!-- ABSTRACT OF THE ARTICLE -->
<P><i>摘要</i>:
<P>
<!-- articleabstract_start -->


    期望能读到关于微控制器的文章的读者应该不用担心。我一定会继续写的。
    我的下一篇文章将还是关于微控制器的，同时我也做了一个网页，
    你可以在下面地址找到所有最近电子方面的文章：
    <a href=
    "http://www.tuxgraphics.org/electronics/">http://www.tuxgraphics.org/electronics/</a><br>

    我希望能在上面提供一个总览并使下面的链接容易访问。
    <br><br>

    这么长时间了，linuxfocus的读者可能还记得我的旧文章：<a href=
    "../March2003/article286.shtml">March 2003: Linux USB LCD
    display with watchdog and buttons</a>和<a href=
    "../May2002/article236.shtml">A LCD control panel for your
    Linux server</a>。那些都是关于昂贵的LCD面板，还有监视狗、ADC等等。
    很久以前我就注意到所有那些额外的功能我们并不常用。

    <br><br>

    现在，这篇文章仅提供最基本的模型：LCD显示屏和2个按钮。对每个人来说都很容易制作。

    
<!-- articleabstract_stop -->

<br><!-- HR divider --><center><font color="#8282e0"><b>_________________ _________________ _________________</b></font></center><br>
</td></tr></table>
<!-- HEAD_OF_THE_ARTICLE_STOP -->
<!-- BODY_OF_THE_ARTICLE_START -->


    <A NAME="375lfindex0">&nbsp;</A>
<H2>lcdprod是什么？</H2>

    <img src="../../common/images2/article375/firsttests.jpg" align="right" alt="LCDd" width="270" height="100">
    Lcdproc最初仅仅是一个程序，用它来往一个外部的LCD显示屏上显示诸如CPU
    LOAD、UPTIME、TIME等一些统计信息。经过很长时间的变化它成了一个通用的解决方案。
    现在lcdproc软件包包括LCDd（一个通用的服务器的LCD驱动）和许多客户端程序。
    其中的一个可执行的客户端程序仍然叫做lcdproc，它仍然用来显示一些服务器统计信息，
    当然也还有其它一些客户端。这一客户机－服务器结构具有很大的优势：
    你不需要使用特定的语言来写客户端，而只需在客户机和服务器之间使用简单的ASCII协议。
    下面的例子实现了一个<a href=
    "../../common/src2/article375/lcddate_pl.html">clock in just 36
    lines of perl code</a>。它能显示日期和时间，并且在最右上角显示一个叫做“心跳”的图标，
    这一图标是由LCDd服务器程序加上的，它会定时闪烁表明显示屏是活动的。
    <br>
    <br>


    在lcdproc中你还可以使用除字符串以外的其他东西： 比如柱状图、
    滚动条、标题栏以及文本串等。在程序的开始你要首先定义那些对象（他们称作widgets），
    然后使用数据填充这些对象。在<a href=
    "../../common/src2/article375/lcdproc-0.5-dev-guide.pdf">LCDproc
    Developer's Guide</a>中从第7页开始解释了如何使用它们。
    <br>
    <br>
    例子<a href=
    "../../common/src2/article375/lcddate_pl.html">little LCD
    clock</a>的主要部分如下：

    <pre class="code">
#!/usr/bin/perl -w
....
# initiate the communication:
print $remote "hello\n";
....
# set our name and define a text string widget
print $remote "client_set name lcdtime\n";
print $remote "screen_add scr1\n";
print $remote "widget_add scr1 str1 string\n";
....
while(1)
{
    ....
    $date = scalar localtime;
    # now write to the LCD:
    print $remote "widget_set scr1 str1 1 1 \"$date\"\n";
    sleep 10;
}
</pre>

    非常简单是吧？那么接下来让我们来做一些更有用的东西。

    <A NAME="375lfindex1">&nbsp;</A>
<H2>硬件</H2>


    按照规范PC机的并行口使用5V的电压。现在，如果你看一下当今的LCD数据表
    （e.g from tuxgraphics: <a href=
    "http://shop.tuxgraphics.org/electronic/lcd.html">http://shop.tuxgraphics.org/electronic/lcd.html</a>）就可以发现，即使现在的显示屏比较大，它们却需要极少的电源－仅仅2mA的电流！
    既然只需这么小的电流，那么仅仅使用并行口就可能直接驱动。
    这一做法的优点是你不需要任何额外的电源控制器。仅仅是一个LCD显示屏和一个接在并行口上的并行接头。
    非常方便使用。

    <br>

    <br>


    使用一个并口提供5V的电源是可能的，问题是有一些并不是完全符合规范。
    那么，如何判断你的并口能够足够支持在这种“电源自给”方案呢？
    下面是一些测试：

    <ol>
      <li>
      安装lcdproc和“并口电源”补丁（见参考资料）。
      </li>

      <li>
       照下面的描述配置/dec/LCDd.conf文件。
      </li>

      <li>
      以root用户启动LCDd程序。
      </li>

      <li>
      用一个数字伏特表测量针脚一个电压。它应该是4.90V或更高（从针脚1和针脚18=GND间测量）。
      </li>

      <li>

      现在在并口的针脚1和针脚18间接一个33K的电阻，电压将会降到4.25伏。
      如果你能得到更高的电压，你的并口就是好的，如果小于4.25伏，那么这一“电源自给”方案就无法使用。
      </li>
    </ol>

    如果你通过这一测试，那么你就可以使用这种“并口电源“方案，并使用tuxgraphics 20x2显示屏，
    它已经经过测试，能正常工作。
    <br>
    <br>
    <img src="../../common/images2/article375/conn_usba.gif" align="right" alt="usb A connector pinout" width="246" height="120">

    如果你的并口不能胜任，也不要太担心。你可以使用PC内部的5V电源（为此你可能需要打开机箱），
    或者使用USB接口提供的5V电源。
    <br clear="all">

    <A NAME="375lfindex2">&nbsp;</A>
<H2>电路图</H2>


    第一张电路图显示了使用“并口电源”方案的LCD显示屏和两个按钮间的连接。
    <br>

    <center>
      <a href=
      "../../common/src2/article375/lcdproc-selfpower.png"><img src="../../common/src2/article375/lcdproc-selfpower_th.gif" alt="parallel port powered LCD display" width="400" height="300"></a>
    </center>
    <br>
<pre class="code">
Parallel port
pin 1 , strobe  = 220, supply voltage
pin 2 , D0      = LCD pin D4
pin 3 , D1      = LCD pin D5
pin 4 , D2      = LCD pin D6
pin 5 , D3      = LCD pin D7

pin 6 , D4      = LCD pin RS
pin 7 , D5      = LCD pin RW
pin 8 , D6      = LCD pin EN

pin 10, ACK     = button A, upper red button
pin 12, PE      = button C, lower black button

pin 14, strobe  = 220, supply voltage
pin 16, strobe  = 220, supply voltage
pin 17, strobe  = 220, supply voltage

pin 18, ground  = 0V, GND
</pre>
    <br>
    <br>

    第二幅图显示了使用外接电源的LCD与两个按钮的连接方法：

    <center>
      <a href=
      "../../common/src2/article375/lcdproc-seppower.png"><img src="../../common/src2/article375/lcdproc-seppower_th.gif" alt="parallel port powered LCD display" width="400" height="300"></a>
    </center>
    <br>
    <br>

    像所有新的电子类文章一样，你还可以从<a href=
    "http://shop.tuxgraphics.org">shop.tuxgraphics.org</a>
    获得一个包含所有组件的工具箱。
    <br>
    <br>

    我把LCD显示屏装在一个黑色的塑料框内：

    <center>
      <img src="../../common/images2/article375/tuxgraphics20x2LCD_back.jpg" alt="my display, back" width="340" height="165"><br>
      <br>
      <img src="../../common/images2/article375/tuxgraphics20x2LCD_front.jpg" alt="my display, front" width="340" height="167">
    </center>

    <A NAME="375lfindex3">&nbsp;</A>
<H2>lcdproc并口电源补丁</H2>


    LCDd总是给显示屏发送一些数据。所以你可以使用一些二极管从信号线上获取电源。
    问题是即使工作在很小的电流的情况下，二极管也会造成至少0.5伏的电压下降。
    我们不能承担这一问题。不过，如果你只使用一个显示屏的话，倒是有好多空闲的输出线。
    没有比给LCDd程序打个补丁更容易的事了，使用这一补丁可以令所有的空闲输出线永远保持“1”。
    我们仍然插入一些电阻来做一些最小的短路保护（或者可能是愚蠢的错误的保护 ;-)）。
    lcdproc-0.4.5的补丁可以从下载区找到，你可以这样使用它：
<pre class="code">
tar zxvf lcdproc-0.4.5.tar.gz
cd lcdproc-0.4.5
patch -p 1 &lt; lcdproc-0.4.5-pp-powerpatch-v1.txt
./configure --enable-drivers=hd44780
make

make install

（或者你只需要将LCDd.conf拷贝到/etc，并将sever/LCDd拷贝到/usr/bin）
</pre>

    <A NAME="375lfindex4">&nbsp;</A>
<H2>LCDd.conf文件</H2>

    /etc/LCDd.conf 文件是我们的LCD驱动和服务器（LCDd进程）的配置文件。
    为了使用本文中所讲的HD44780兼容的显示屏，我们需要在/etc/LCDd.conf文件中去掉相关的注释。


<pre class="code">
[server]
Driver=HD44780

[HD44780]
# Hitachi HD44780 driver

Port=0x3BC
# Port where the LPT is. Usual values are 0x278, 0x378 and 0x3BC

ConnectionType=4bit
Keypad=yes
Backlight=no

Size=20x2
# Specifies the size of the LCD.

DelayMult=4
DelayBus=true
</pre>

    比较困难的部分是端口地址（0x278, 0x378和0x3BC)。如何才能知道你并口的IO地址呢？
    最简单的办法是装入parport内核模块（modprobe parport），然后查看/proc/ioports
<pre class="code">
modprobe parport
modprobe parport_pc

cat /proc/ioports

...
0388-0389 : OPL2/3 (left)
038a-038b : OPL2/3 (right)
<b>03bc-03be : parport0</b>
03c0-03df : vga+
03f6-03f6 : ide0
...

在这个例子中你可以使用: 0x3bc
</pre>

    <A NAME="375lfindex5">&nbsp;</A>
<H2>我们自己的应用程序</H2>


    在本文的开始你已经看到给LCD发送一个字符串是多么简单，但如果你想要一个交互的LCD
    （使用两个按钮）的话，事情就变得复杂一些了。在这个例子中我们需要避免使用sleep语句，
   否则的话在休眠期间程序不会对按钮做出响应。同时，我们需要一个阻塞语句来停止循环。
   我们所需要的就是系统调用“select”。它将在运行超时或显示屏上按下一个按钮后使程序停止运行。
    <br>
    <br>

    我们的程序将提供一些状态信息（比方说mem，swap，cpu，time等），你也可以使用这些按钮来关机。
    <br>
    <br>

    脚本的名字叫servermenu_pl，你可以从下载区找到。
    <br>
    <br>

    在这里我只提供这么一个基本的应用程序，因为就以前文章的经验来讲，
    大部分读者只是想知道如何做一些事情，然后用他们自己的程序来实现它。
    我收到好多邮件，有各种各样的点子：CD烧制工作站、气象站PC、告警系统等等，
    只需要稍稍修改一下代码，所有这些都可以做。<br>
    使用lcdproc和这些LCD显示屏会非常酷，并且会享受到无穷的乐趣。

    <center>
      <img src="../../common/images2/article375/sm-all.jpg" alt="servermenu in operation" width="320" height="366"><br>
    </center>

    <A NAME="375lfindex6">&nbsp;</A>
<H2>参考资料</H2>


    <ul>
      <li>本文<a href="../../common/src2/article375/index.html"><b>下载区</b>
      </a></li>

      <li>lcdproc主页： <a href=
      "http://www.lcdproc.org">http://www.lcdproc.org</a></li>

      <li>The <a href="http://shop.tuxgraphics.org">tuxgraphics
      online shop</a>. 你可以在此定购所有所需的元器件 (<a href="http://shop.tuxgraphics.org">http://shop.tuxgraphics.org</a>).</li>
    </ul>
    <!-- vim: set sw=2 ts=2 et tw=80: -->
  



<!-- BODY_OF_THE_ARTICLE_STOP -->
<!-- 2pdaIgnoreStart -->
<A NAME="talkback">&nbsp;</a>
<h2>对这篇文章发表评论</h2>
每篇文章都有各自的反馈页面。在这个页面里，您可以提交评论，也可以查看其他读者的评论：
<center>
    <table width="250" border=0><tr><td>
    <div class="tbbutton"><A class="nodec" href="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=375">&nbsp;反馈页面&nbsp;</a></div>
    </td></tr></table>
</center>

<br clear="all">
<HR size="2" noshade>
<table width="250" border=0><tr><td>
<div class="bbutton"><a class="nodec" href="../../index.shtml">&lt;--, LF 首页</a></div>
</td><td>
<div class="bbutton"><a class="nodec" href="index.shtml">Go to the index of this issue</a></div>
</td></tr></table>
<br clear="all">
<HR size="2" noshade>
<!-- ARTICLE FOOT -->
<CENTER><TABLE WIDTH="98%" summary="footer">
<TR><TD ALIGN=CENTER BGCOLOR="#bdc6d5" WIDTH="50%">
<A HREF="../../common/lfteam.html">主页由LinuxFocus编辑组维护</A>
<BR><FONT COLOR="#1111aa"><a href="../../common/copy.html">&copy; Guido     Socher</a><br>&quot;some rights reserved&quot; see <a href="../../license/index.shtml">linuxfocus.org/license/</a><br><a href="http://www.linuxfocus.org">http://www.LinuxFocus.org</a></FONT>
</TD>
<TD BGCOLOR="#bdc6d5">
<!-- TRANSLATION INFO -->
<font size=2>翻译信息:</font>
<TABLE summary="translators">
  <tr><td><font size="2">en --&gt; -- : Guido Socher (<a href="http://linuxfocus.org/~guido/"><font size="1">homepage</font></a>)</font></td></tr>
  <tr><td><font size="2">en --&gt; zh_CN: SEVEN &lt;seven1240(at)163.com&gt;</font></td></tr>
</TABLE>
</TD>
</TR></TABLE></CENTER>
<p><font size=1>2005-04-28, generated by lfparser version 2.52</font></p>
<!-- 2pdaIgnoreStop -->
</BODY>
</HTML>
