<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
 <META http-equiv="Content-Type" content="text/html; charset=gb2312">
 <META NAME="GENERATOR" CONTENT="lfparser_2.51">
 <META NAME="LFCATEGORY" CONTENT="UNIXBasics">
 <link rel="icon" href="../../common/images/lf-16.png" type="image/png">
 <TITLE>lf349, UNIXBasics: 加载点揭密</TITLE>
<style type="text/css">
<!--
 td.top {font-family: Arial,Geneva,Verdana,Helvetica,sans-serif; font-size:12 }
 pre { font-family:monospace,Courier }
 pre.code { font-family:monospace,Courier;background-color:#aedbe8; }
 p.cl { color:#EE9500 }
 table.left { margin-right:0.3cm }
 a.nodec { text-decoration:none }
 p.trans { font-size:8pt; text-align:right }
 p.clbox { width:50%; alignment:center; background-color:#FFD700; 
           border-style:none; border-width:medium; border-color:#FFD700; 
           padding:0.5cm;  text-align:center }
 p.code { width:80%; alignment:center; background-color:#aedbe8; 
          border-style:none; border-width:medium; border-color:#aedbe8; 
          padding:0.1cm;  text-align:left }
 p.foot { background-color:#AAAAAA; color:#FFFFFF; border-style:none; 
          border-width:medium; border-color:#AAAAAA; padding:0.5cm ; 
          margin-top:0.1cm; margin-right:1cm; margin-left:1cm; 
          text-align:center }
 div.tbbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   margin: 2px 5px 2px 5px;
   text-align: center;
   width: 20em;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
 div.bbutton {
   background: #ddd;
   border-right: 1px solid #aaa;
   border-bottom: 1px solid #aaa;
   float: left;
   margin: 2px 5px 2px 5px;
   text-align: center;
   line-height: 1.2em;
   padding: 2px;
   font-size: 12px;
   white-space: nowrap;
   color: #555;
 }
-->
</style>
 
</HEAD>
<BODY bgcolor="#ffffff" text="#000000">
 <!-- this is generated html code. NEVER use this file for your
 translation work. Instead get the file with the same article number
 and .meta.shtml in its name. Translate this meta file and then
 use lfparser program to generate the final article -->
 <!-- lfparser can be obtained from http://main.linuxfocus.org/~guido/dev/lfparser.html -->

<!-- this is used by a number of tools:
 =LF=AUTHOR: Guido Socher
 =LF=CAT___: UNIXBasics
 =LF=TITLE_: 加载点揭密
 =LF=NUMBER: 349
 =LF=ANAME_: article349.shtml
 =LF=PARSER: 2.51
 -->

<!-- 2pdaIgnoreStart -->

<!-- start navegation bar, current, style=2 -->
 <!-- top navegation bar -->
 <TABLE summary="topbar_1" cellspacing="0" cellpadding="0" border="0" align="center" width="90%">
   <TR bgcolor="#2e2292">
     <TD class="top"><TABLE summary="topbar_1_logo" cellspacing="0" cellpadding="0" border="0" width=
       "100%">
         <TR><TD width="319"><a href="../../index.shtml"><IMG src="../../common/images/logolftop_319x45.gif"
           alt="[LinuxFocus-icon]" width="319" height="45" align="left" 
           border="0"></a></TD>

           <TD class="top">
             <TABLE summary="topbar_1_links" width="100%">
               <TR align="right">
                 <TD class="top">
                 
                 <A class="nodec" href="../../index.shtml"><FONT color=
                 "#DDDDDD" size="2">&lt;--</FONT></A> &nbsp;| 
                 <A class="nodec" href="../map.html"><FONT color=
                 "#DDDDDD" size="2">站点地图</FONT></A> &nbsp;| 
                 <A class="nodec" href="../indice.html"><FONT color=
                 "#DDDDDD" size="2">索引</FONT></A> &nbsp;| 
                 <A class="nodec" href="../Search/index.shtml"><FONT color=
                 "#DDDDDD" size="2">搜索</FONT></A> </TD>
                 
               </TR>

               <TR align="right">
                 <TD class="top">
                   <HR width="100%" noshade size="1">
                 </TD>
               </TR>
             </TABLE>
           </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end top navegation bar -->
 <!-- blue bar -->
 <TABLE summary="topbar_2" cellspacing="0" cellpadding="0" border="0" align="center"
 width="90%">
   <TR bgcolor="#00ffff">
     <TD><IMG src="../../common/images/transpix.gif" width="1" height=
     "2" alt=""></TD>
   </TR>
 </TABLE>
 <!-- end blue bar -->
 <!-- bottom navegation bar -->
 <TABLE summary="topbar_3" cellspacing="0" cellpadding="0" border="0" align="center"
 width="94%">
   <TR bgcolor="#000000">
     <TD>
       <TABLE summary="topbar_3_links" cellspacing="0" cellpadding="1" border="0" width=
       "100%">
         <TR align="center">
           <TD WIDTH="20%"><A class="nodec" href="../News/index.shtml"><FONT color=
           "#FFFFFF">新闻</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Archives/"><FONT color=
           "#FFFFFF">过往期刊</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../Links/index.shtml"><FONT color=
           "#FFFFFF">链接</FONT></A> </TD>
           <TD WIDTH="5%"><FONT color="#FFFFFF">|</FONT> </TD>
           <TD WIDTH="20%"><A class="nodec" href="../aboutus.html"><FONT color=
           "#FFFFFF">关于LF</FONT></A> </TD>
         </TR>
       </TABLE>
     </TD>
   </TR>
 </TABLE>
 <!-- end bottom navegation bar -->
<!-- stop navegation bar -->

<!-- SSI_INFO -->

<!-- tr_staticssi include virtual -->
<!-- tr_staticssi exec cmd -->
<!-- addedByLfdynahead ver 1.5 --><TABLE ALIGN="right" border=0><TR><TD ALIGN="right"><FONT SIZE="-1" FACE="Arial,Helvetica">This document is available in: <A href="../../English/September2004/article349.shtml">English</a> &nbsp;<A href="../../Castellano/September2004/article349.shtml">Castellano</a> &nbsp;<A href="../../ChineseGB/September2004/article349.shtml">ChineseGB</a> &nbsp;<A href="../../Deutsch/September2004/article349.shtml">Deutsch</a> &nbsp;<A href="../../Francais/September2004/article349.shtml">Francais</a> &nbsp;<A href="../../Italiano/September2004/article349.shtml">Italiano</a> &nbsp;<A href="../../Indonesian/September2004/article349.shtml">Indonesian</a> &nbsp;<A href="../../Russian/September2004/article349.shtml">Russian</a> &nbsp;<A href="../../Turkce/September2004/article349.shtml">Turkce</a> &nbsp;<A href="../../Polish/September2004/article349.shtml">Polish</a> &nbsp;</FONT></TD></TR></TABLE><br>
 


<!-- SSI_INFO STOP -->
<!-- 2pdaIgnoreStop -->

<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_START -->
<TABLE ALIGN="LEFT" BORDER="0" WIDTH="195" summary="about the author" class="left">
<TR>
<TD>

<img src="../../common/images/Guido-S.gif" alt=
    "[Photo of the Author]" height="164" width="173">
<BR>by  Guido Socher <a href="http://main.linuxfocus.org/%7Eguido/"><font size="1">(homepage)</font></a>
<BR><BR>
<I>关于作者:</I><BR>
<!-- aboutauthor_start -->
<p>Guido 因为这个社区而喜欢 Linux。这是一个实实在在的大项目，而项目中全世界各种各样的人们相着同一个目标工作：让它每天变得都更好。<br>
    不幸的是，Linux 现在太大了，同样吸引了全世界的坏蛋只想得到利润而不想贡献任何东西。看看！从外面好象是小型 "pro-linux" 商务，其实就是机会主义。</p>
<!-- aboutauthor_stop -->
<!-- TRANSLATED_TO gb -->
<!-- TRANSLATED_TO_STOP -->
<!-- INDEX_START -->
<BR><i>目录</i>:
<UL>
  <LI><A HREF="#349lfindex0">简介</A></LI>
  <LI><A HREF="#349lfindex1">加载如何工作</A></LI>
  <LI><A HREF="#349lfindex2">文件系统繁忙问题</A></LI>
  <LI><A HREF="#349lfindex3">但 Windows 不需要这样？！</A></LI>
  <LI><A HREF="#349lfindex4">Linux 也可以！</A></LI>
  <LI><A HREF="#349lfindex5">允许所有用户加载文件系统</A></LI>
  <LI><A HREF="#349lfindex6">笔记本和 NFS</A></LI>
  <LI><A HREF="#349lfindex7">结论</A></LI>
  <LI><A HREF="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=349">对这篇文章发表评论</A></LI>
</UL>

</TD></TR></TABLE>
<!-- INDEX_STOP -->
<!-- SHORT_BIO_ABOUT_THE_AUTHOR_AND_INDEX_STOP -->
<!-- HEAD_OF_THE_ARTICLE_START -->
<br>&nbsp;
<table border="0"><tr><td>
<H2>加载点揭密</H2>
 <img src="../../common/images2/illustration349.jpg" alt="mount"
    hspace="10">
<!-- ABSTRACT OF THE ARTICLE -->
<P><i>摘要</i>:
<P>
<!-- articleabstract_start -->

    这篇文章解释了加载点的概念，但我认为，其中的部分内容即使对于一些不是新手的读者也有点意思。

    
<!-- articleabstract_stop -->

<br><!-- HR divider --><center><font color="#8282e0"><b>_________________ _________________ _________________</b></font></center><br>
</td></tr></table>
<!-- HEAD_OF_THE_ARTICLE_STOP -->
<!-- BODY_OF_THE_ARTICLE_START -->


    <A NAME="349lfindex0">&nbsp;</A>
<H2>简介</H2>

    我将首先解释加载文件系统的概念，然后介绍一些高级特性。如果你觉得你已经是 Linux 专家了，那你可以从后面一点开始阅读。

    <A NAME="349lfindex1">&nbsp;</A>
<H2>加载如何工作</H2>

    在 windows 下，直到今天仍有这样的问题：当你加上一个磁盘的时候，分区的编号就变得混乱了。原来是 D:盘的分区现在成了 E:盘，不论是用户还是程序都被搞得很茫然。
    <br>
    <br>
    而在 Unix 下，你永远不会遇到这种问题，因为所有的物理分区都被加入到一个目录树中了。你可以通过命令"mount"或"df"来看到这些分区：

    <table>
      <tr>
        <td>
<pre class="code">
# df
Filesystem 1K-blocks    Used Available Use% Mounted on
/dev/hda1    9070728 4701180   3908768  55% /
/dev/hda3   24950428  683412  22999584   3% /home
none          257236       0    257236   0% /dev/shm

# mount
/dev/hda1 on / type ext3 (rw)
none on /proc type proc (rw)
none on /dev/shm type tmpfs (rw)
/dev/hda3 on /home type ext3 (rw)
</pre>
        </td>
      </tr>
    </table>
    这里，我们有两个磁盘分区，一个包括 /home 以外的所有内容。这就是根分区"/"，它物理上是 hda1。hda1 是第一个 IDE 硬盘 (hda) 的第一个分区 (1)。同一块硬盘的第三个分区(hda3)被加载到了 /home。这样，如果你进入目录 /home，实际上你在访问 hda3 上的文件。你永远不用担心哪个是 D: 哪个是 E:。永远只有一个不变的目录树。

    <A NAME="349lfindex2">&nbsp;</A>
<H2>文件系统繁忙问题</H2>

    <br>
    Linux缓冲文件系统的读写操作---如果你有 USB 1.1 的 U 盘，并访问上面的一个大文件，你能注意到：第一次读写很慢，但以后就变快了很多，而 U 盘上的读写指示灯根本就不闪。
    <br>
    <br>
    因为缓冲这个特点，你不能直接拔下一个正在使用的盘，相反，你需要卸载它。对于内置的硬盘来说，这根本就不是什么问题，但对于光盘和 U 盘就要注意了。
    <br>
    <br>
    比如，如果你把一个 U 盘加载到了 /mnt/usb，然后"cd /mnt/usb"，这时，bash 就在使用这个文件系统了。如果这时想要从另一个 shell 去 umount 它，你将得到"file system busy" (文件系统繁忙) 的提示，umount 不会成功。这时，你只要"cd"一下，离开 /mnt/usb，就可以成功 umount 了。而有时，你忘了谁在用它，或者你有很多程序正在打开 U 盘，这就可能很难找到导致卸载失败的原因。
    <br>
    <br>
    问你的计算机好了！
<pre class="code">
# fuser -m -u /mnt/usb
/mnt/usb:   1347c(root)  1348c(guido)  1349c(guido)
</pre>
    你从 fuser 命令得到的是使用文件系统的进程的列表。现在你可以使用"ps auxw"检查它们到底是什么，也可以直接 kill 它们。现在 umount 可以正常工作了。

    <A NAME="349lfindex3">&nbsp;</A>
<H2>但 Windows 不需要这样？！</H2>

    为什么不直接拔下U盘呢？好，老的 dos/win3.1 计算机直接切断电源就行，不需要关机。那时，我的朋友总报怨为什么在 Linux 下必须 shutdown 呢。后来，Win95 出来了，这些报怨也就没了，因为谁都要先关机了。

    <A NAME="349lfindex4">&nbsp;</A>
<H2>Linux 也可以！</H2>

    Linux 下也有方法可以直接拔掉磁盘(比如 U 盘)的。Mandrake Linux 有一个叫做 supermount 的特征，确实可以达到和 windows 一样的结果。但我不建议你这样做，因为这会导致不稳定和丢失文件。
    <br>
    <br>
    最好使用 mtools (http://mtools.linux.lu/)。mtools 是一组访问软驱、U 盘这些使用 FAT 文件系统的可移动存储介质的命令，而且不需要加载文件系统。
    <br>
    <br>
    这是使用方法：

    <ol>
      <li>
	编辑 /etc/mtools.conf，加上这么几行：<br>
<pre>
drive u: file="/dev/sda1" # 或 sda4; 有些 U 盘缺省使用分区4.
</pre>
        <br>
        <br>
      </li>

      <li>
      现在你不用 mount /dev/sda1，而是输入<br>
      mdir u:<br>
      来看 U 盘上有什么。<br>
      <br>
      mcopy * u:<br>
      来拷贝当前目录的所有文件到 U 盘上面。<br>
      <br>
      mcopy u:\* .<br>
      拷贝 U 盘上的所有文件到当前目录(注意通配符前面的'\'。)。<br>
      <br>
      </li>
    </ol>
    非常容易使用。

    <A NAME="349lfindex5">&nbsp;</A>
<H2>允许所有用户加载文件系统</H2>

    通常只有root可以加载文件系统。对于像 U 盘或是光盘这样的设备，你可能希望每个用户都可以加载它们。处理这个问题，只要修改一下 /etc/fstab 就可以了：
<pre class="code">
# dev     mount point    fs type   flags
/dev/sda1  /mnt/usb      auto      noauto,user 0 0
</pre>
    这行表示 sda1( 第一个 scsi 硬盘的第一个分区，USB 存储设备被映射成 scsi 磁盘)应该在启动的时候不被自动加载 (noauto)，并且可以被任何用户加载/卸载 (user)。文件类型域设置成 auto，这样你可以加载任何文件系统的 U 盘，比如 vfat 或是 ext2,文件系统的类型会被自动地识别。

    <A NAME="349lfindex6">&nbsp;</A>
<H2>笔记本和 NFS</H2>

    网络文件系统 NFS 对于想要集中备份 home 目录的多个用户很有效。你要做的所有事情就是从中心服务器上加载 home 目录，所有用户的个人 home 目录都对于所有网络中的计算机是可用的。只要在网络中，用户就可以得到同样的设置、同样的偏好、同样的数据。真的很理想。
    <br>
    <br>
    But how do we handle mobile users with Laptops? (no backups?)
    但如何处理使用笔记本的移动用户呢？(不是备份？)
    <br>
    <br>
    你一旦离开网络，home 目录就消失了。一个解决方法是始终复制所有数据(rsync)，但如果不是非常严格同步的话，很容易导致不一致。而且你也不一定需要你的完整 home 目录。我发现一个不错的解决方案是使用一个小的 home 目录，里面只有设置和一些我在旅游的时候需要的数据。
    <br>
    <br>
    当你在一个非空目录的位置加载一个文件系统(任何文件系统/磁盘，包括 NFS)的时候，原来目录里面的内容就都不可见了，取而代之的是加载上的文件系统。
    <br>
    <br>
    这就是解决方案：为 home 目录建立一个加载点(/home)，当计算机在网络上的时候自动加载不同的 home 目录。而当你加载任何东西之前，建立一个笔记本电脑的用户的离线 home 目录的符号链接：
<pre class="code">
/home/guido -&gt; ../home_nonet/guido
</pre>
    当用户 guido 在网络上的时候，他将看到一个通常的 home 目录，因为符号链接完全被掩盖了。而当他在公诉上的时候，他将看到 /home_nonet/guido 成为了他的 home 目录 (/home/guido)。
    <br>
    <br>
    一个很漂亮的解决方案。

    <A NAME="349lfindex7">&nbsp;</A>
<H2>结论</H2>

    建立一个硬件之上的抽象层是 UNIX 的一贯目标之一。加载/卸载文件系统/磁盘正是这一目标的一个实现方案。这的确是一个先进的现代的设计，尽管 UNIX 比其他现代 PC 操作系统老很多。
  



<!-- BODY_OF_THE_ARTICLE_STOP -->
<!-- 2pdaIgnoreStart -->
<A NAME="talkback">&nbsp;</a>
<h2>对这篇文章发表评论</h2>
每篇文章都有各自的反馈页面。在这个页面里，您可以提交评论，也可以查看其他读者的评论：
<center>
    <table width="250" border=0><tr><td>
    <div class="tbbutton"><A class="nodec" href="http://cgi.linuxfocus.org/cgi-bin/lftalkback?anum=349">&nbsp;反馈页面&nbsp;</a></div>
    </td></tr></table>
</center>

<br clear="all">
<HR size="2" noshade>
<table width="250" border=0><tr><td>
<div class="bbutton"><a class="nodec" href="../../index.shtml">&lt;--, LF 首页</a></div>
</td><td>
<div class="bbutton"><a class="nodec" href="index.shtml">Go to the index of this issue</a></div>
</td></tr></table>
<br clear="all">
<HR size="2" noshade>
<!-- ARTICLE FOOT -->
<CENTER><TABLE WIDTH="98%" summary="footer">
<TR><TD ALIGN=CENTER BGCOLOR="#bdc6d5" WIDTH="50%">
<A HREF="../../common/lfteam.html">主页由LinuxFocus编辑组维护</A>
<BR><FONT COLOR="#1111aa"><a href="../../common/copy.html">&copy; Guido Socher</a>, FDL<br><a href="http://www.linuxfocus.org">http://www.LinuxFocus.org</a></FONT>
</TD>
<TD BGCOLOR="#bdc6d5">
<!-- TRANSLATION INFO -->
<font size=2>翻译信息:</font>
<TABLE summary="translators">
  <tr><td><font size="2">en --&gt; -- : Guido Socher (<a href="http://main.linuxfocus.org/%7Eguido/"><font size="1">homepage</font></a>)</font></td></tr>
  <tr><td><font size="2">en --&gt; cn: 王旭 &lt;wangxu(at)linuxfocus.org&gt;</font></td></tr>
</TABLE>
</TD>
</TR></TABLE></CENTER>
<p><font size=1>2005-01-21, generated by lfparser version 2.51</font></p>
<!-- 2pdaIgnoreStop -->
</BODY>
</HTML>
