<!-- MHonArc v2.5.0b2 -->
<!--X-Subject: List formatting in Docbook &#45;> PDF/PS -->
<!--X-From-R13: Rna Epbgg <qna.fpbggNnpz.bet> -->
<!--X-Date: Sun, 15 Oct 2000 18:49:43 &#45;0400 (EDT) -->
<!--X-Message-Id: Pine.LNX.4.21.0010151537120.13567&#45;200000@RAPD144.torolab.ibm.com -->
<!--X-Content-Type: multipart/mixed -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML//EN">
<html>
<head>
<title>List formatting in Docbook -&gt; PDF/PS</title>
<link rev="made" href="mailto:dan.scott@acm.org">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg04088.html">Date Prev</a>][<a href="msg04090.html">Date Next</a>][<a href="msg04088.html">Thread Prev</a>][<a href="msg04148.html">Thread Next</a>][<a href="maillist.html#04089">Date Index</a>][<a href="threads.html#04089">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>List formatting in Docbook -&gt; PDF/PS</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: <A HREF="mailto:ldp-discuss@lists.linuxdoc.org">ldp-discuss@lists.linuxdoc.org</A></li>
<li><em>Subject</em>: List formatting in Docbook -&gt; PDF/PS</li>
<li><em>From</em>: Dan Scott &lt;<A HREF="mailto:dan.scott@acm.org">dan.scott@acm.org</A>&gt;</li>
<li><em>Date</em>: Sun, 15 Oct 2000 18:45:11 -0400 (EDT)</li>
<li><em>Resent-date</em>: Sun, 15 Oct 2000 18:49:43 -0400 (EDT)</li>
<li><em>Resent-from</em>: <A HREF="mailto:ldp-discuss@lists.debian.org">ldp-discuss@lists.debian.org</A></li>
<li><em>Resent-message-id</em>: &lt;isL3m.A.jvB._Tj65@murphy&gt;</li>
<li><em>Resent-sender</em>: <A HREF="mailto:ldp-discuss-request@lists.debian.org">ldp-discuss-request@lists.debian.org</A></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>
Hello, just dropping in to chat about the formatting of lists through the
Docbook -&gt; PDF/PS transform. IIRC, we use jade to go from Docbook to HTML,
then use htmldoc to go from HTML to PS and PDF. Unfortunately, there's a
bug in this chain that ends up with list items having entirely too much
vertical whitespace in the PDF and PS output.

The root of the problem is that jade takes the Docbook source for a list as
follows:

&lt;orderedlist&gt;
&lt;listitem&gt;
&lt;para&gt;
...content...
&lt;/para&gt;
&lt;/listitem&gt;
&lt;/orderedlist&gt;

and does the simplest possible transform to get to HTML, like:

&lt;OL
&gt;&lt;LI
&gt;&lt;P
&gt;...content...&lt;/P
&gt;&lt;/LI
&gt;&lt;/OL

See the &lt;P&gt;&lt;/P&gt; tag enclosing the listitem content? I think that's valid
HTML; browsers ignore the first &lt;P&gt; tag within listitem content. The
problem is that htmldoc doesn't. It sees &lt;P&gt;, says &quot;Okay, insert
linefeed.&quot;, and we ugly list formatting in our PDF and PS, like:

 o 

   ...content...

I will send a note to the htmldoc support email address, explaining the
problem. Their web site states that they offer support for $99, so I don't
know if we will get anywhere with that. It's worth a shot.

I've taken a look at the htmldoc source but things get rather complicated
quickly; I don't think I've got the coding skills needed to put together a
good patch. If anyone else with C++ knowledge wants to try, the source is
available at <A  HREF="http://www.easysw.com">http://www.easysw.com</A>.

So, assuming that we won't get a fix for the problem at the right place in
a timely fashion, I sat down and crafted / threw together a Perl script to
preprocess the HTML before we feed it to htmldoc. You'll find it attached;
it's pretty simple, but it does the job, and I think you'll find the
results worthwhile. Feedback and more testing (I've only tested it on my
own DB2-HOWTO), of course, is welcome.

-- 
Dan Scott,
Friend of the abnormal.
</pre>
<pre>
#!/usr/bin/perl -w

use strict;

sub checkPath($);
sub processHTML($);

my $manpage = '
SYNOPSIS 
   prehtml [SOURCE DIRECTORY] [DESTINATION DIRECTORY]

DESCRIPTION 
   Pre-processes HTML files from a specified directory and
   copies the output to a specified directory. This script
   only considers files with a &quot;.html&quot; extension to be HTML
   files; to changes this, you currently have to change the
   value of the $extension variable in the Perl source.

   Run this script before running htmldoc.

   Removes first set of paragraph tags from list items
   in HTML generated from Docbook by jade to improve
   the formatting of PostScript and PDF produced by htmldoc.

   To make a long story short, jade uses absolutely correct HTML and
   wraps the content of each list item in a &lt;P&gt;&lt;/P&gt; tag. htmldoc
   dumbly treats this first &lt;P&gt;&lt;/P&gt; tag generically and inserts a
   linefeed into the Postscript and PDF versions of the documents.
   This script makes htmldoc work better.

   --help
      Display this help and exit.

AUTHOR
   Written by Dan Scott.

TODO
   Make stdout / stdin valid streams.

   Improve argument handling (add switches for source and
   destination directories).
  
   Let the user specify the $extension variable.

REPORTING BUGS
   Report bugs to &lt;dan.scott@acm.org&gt;. I will try to fix them,
   but I do have a real job...

COPYRIGHT
   Copyright @ 2000 Dan Scott.
   This is free software. There is NO warranty; not even for
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
';

my $extension;
my $sourcePath;
my $outPath;

$extension = &quot;.html&quot;;

if (@ARGV != 2 || $ARGV[0] eq &quot;--help&quot; || $ARGV[1] eq &quot;--help&quot;)
{
  print $manpage;
  exit(0);
}
else 
{
  $sourcePath = checkPath($ARGV[0]);
  $outPath = checkPath($ARGV[1]);
}

opendir SOURCEDIR, &quot;$sourcePath&quot;;
my @files = readdir SOURCEDIR;
closedir SOURCEDIR;

foreach my $sourceFile (@files)
{
  next if ($sourceFile =~ /^\.+$/ ); # Skip any string that is just dots
  next if ($sourceFile !~ /$extension/ ); # Skip any file that doesn't match $extension
  open INFILE, (&quot;&lt;$sourcePath$sourceFile&quot;) || die (&quot;Error: could not open $sourceFile for input: $!\n&quot;);
  undef $/; # Enable slurp mode -- read every line at once
  my $htmlsource = &lt;INFILE&gt;;
  close INFILE;

  processHTML($htmlsource);

  open OUTFILE, (&quot;&gt;$outPath$sourceFile&quot;) || die (&quot;Error: could not open $sourceFile for output: $!\n&quot;);
  print OUTFILE $htmlsource;
  close OUTFILE;
}
exit(0);

sub checkPath($)
{
# checkPath ensures that a given path has a trailing &quot;/&quot; character.
  my $path = shift(@_);
  if (substr($path, -1, 1 ne &quot;/&quot;)) 
  {
    $path = $path . &quot;/&quot;;
  }
  return $path;
}

sub processHTML($)
# processHTML does the real work. It removes the first
# &lt;P&gt;&lt;/P&gt; tag in every list item element.
{
  for (@_) { s/(&gt;&lt;LI\n)&gt;&lt;P\n(.*?)&lt;\/P\n&gt;/$1$2\n/gms}
}
</pre>

<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg04088.html">Re: Visual editing</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg04090.html">Re: Cataloging LDP White Paper: Document Reorganization</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg04088.html">Re: Visual editing</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg04148.html">Re: List formatting in Docbook -&gt; PDF/PS</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#04089"><strong>Date</strong></a></li>
<li><a href="threads.html#04089"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
