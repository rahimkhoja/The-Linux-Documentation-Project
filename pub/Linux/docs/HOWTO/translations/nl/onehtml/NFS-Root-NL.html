<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>NFS-Root Mini-Howto</TITLE>


</HEAD>
<BODY>
<H1>NFS-Root Mini-Howto</H1>

<H2>Andreas Kostyrka, andreas@ag.or.at,<BR>
Vertaald door: Ellen Bokhorst, bokkie@nl.linux.org</H2>V8, 8 augustus 1997
<P><HR>
<EM>In deze Mini-HOWTO zal worden geprobeerd een uitleg te geven hoe een Linux werkstation zonder harddisk in te stellen, welke zijn rootbestandssysteem
via NFS mount. De nieuwste versie van deze Mini-Howto is altijd te vinden in
<CODE>ftp://sunsite.unc.edu/pub/Linux/docs/HOWTO/mini/NFS-Root</CODE> of
op een sunsite mirror in de buurt.</EM>
<HR>
<H2><A NAME="s1">1. Copyright</A></H2>

<P>(c) 1996 Andreas Kostyrka (e9207884@student.tuwien.ac.at of 
andreas@ag.or.at) 
<P>Tenzij anders aangegeven, vallen HOWTO-documenten onder het copyright van
hun respectieve auteurs. Linux HOWTO documenten mogen geheel of gedeeltelijk
worden gereproduceerd en gedistribueerd, via elk fysiek of elektronisch
medium, zolang deze copyright-melding op alle kopie&euml;n behouden blijft.
Commerci&euml;le herdistributie is toegestaan en wordt aangemoedigd; de
auteur zou echter graag van dergelijk distributies op de hoogte worden
gebracht.
<P>Alle vertalingen, afgeleide werken, of verzamelde werken aangaande
enige Linux HOWTO-documenten moeten zijn voorzien van deze 
copyright-melding. Dat wil zeggen dat je geen afgeleide werken van 
een HOWTO mag produceren en aanvullende beperkingen op de distributie
ervan mag opleggen. Uitzonderingen op deze regels kunnen onder bepaalde
voorwaarden worden toegestaan; neem alsjeblieft contact op met de Linux
HOWTO co&ouml;rdinator via het hieronder aangegeven adres.
<P>In 't kort, we willen verspreiding van deze informatie via zoveel mogelijk
kanalen bevorderen. We willen echter dat het copyright op de HOWTO-documenten
behouden blijft, en zouden graag op de hoogte worden gesteld van alle
plannen om de HOWTO's te herdistribueren.
<P>Als je vragen hebt, neem dan alsjeblieft contact op met Andreas Kostyrka
&lt;<CODE>mailto:andreas@ag.or.at</CODE>&gt;, de auteur van deze mini-HOWTO, of
Tim Bynum, de Linux HOWTO co&ouml;rdinator, via email 
&lt;<CODE>mailto:linux-howto@sunsite.unc.edu</CODE>&gt;.
<H2>1.1 Contributors</H2>

<P>
<UL>
<LI>Avery Pennarun &lt;<CODE>apenwarr@foxnet.net</CODE>&gt; (hoe zonder <B>LILO</B>
te booten)</LI>
<LI> 
Ofer Maor <CODE>&lt;ofer@hadar.co.il&gt;</CODE> 
(een betere mini-howto over het instellen van een werkstation zonder disk
geleverd).</LI>
<LI>Christian Leutloff <CODE>&lt;leutloff@sundancer.tng.oche.de&gt;</CODE> 
(info over netboot geleverd).</LI>
</UL>
<H2><A NAME="s2">2. Algemeen overzicht</A></H2>

<P>Over het algemeen gesproken komen de volgende problemen bij een
werkstation om de hoek kijken:
<UL>
<LI>Het moet achter zijn eigen IP-adres en zonodig ook
de rest van de Ethernet configuratie zien te komen.</LI>
<LI>Het moet bekend zijn met de <EM>NFS</EM>-server en het mount path naar
het rootbestandssysteem.</LI>
</UL>
<P>De huidige implementatie van <EM>NFSROOT</EM> in de Linux kernel
(op 't moment 1.3.7x) geeft de volgende mogelijke ``oplossingen'':
<UL>
<LI>Het IP-adres kan worden achterhaald met <EM>RARP</EM>, of de volledige
ethernet-configuratie kan aan de kernel worden doorgegeven via kernelparameters
in <B>LILO</B> of <B>LOADLIN</B>.</LI>
<LI>Het te mounten <EM>NFS</EM>-path kan via kernelparameters worden
doorgegeven.
Als dit niet wordt gedaan, gaat de kernel zowel uit van een
<EM>RARP</EM>-server als ook een <EM>NFS</EM>-server, en maakt het voor wat betreft
het path gebruik van de meegecompileerde standaardwaarden.
(huidige standaardwaarde in de kernel:
<CODE>/tftpboot/&lt;<EM>IP-adres van de machine</EM>&gt;</CODE>).</LI>
<LI>De client configuratie kan worden achterhaald met <EM>BOOTP</EM>.</LI>
</UL>
<P>Voor je begint met het instellen van een omgeving zonder disk, zal
je een beslissing moeten nemen of je via <B>LILO</B> &oacute;f
<B>LOADLIN</B> zal gaan booten. Het voordeel hiervan is flexibliteit,
het nadeel is snelheid.
Een Linux kernel zonder <B>LILO</B> booten is sneller. Dit 
kan wel of geen overweging zijn.
<H2><A NAME="s3">3. Setup van de server</A></H2>

<H2>3.1 De kernels compileren</H2>

<P><EM>RARP</EM> ondersteuning in de kernel van de server zal vermoedelijk wel
een goed idee zijn. Je moet het hebben als je zonder kernelparameters wilt
booten. Aan de andere kant helpt het je niet als de client zich niet op
hetzelfde subnet bevindt als de server.
<P>De kernel voor het werkstation heeft minimaal het volgende meegecompileerd
nodig:
<UL>
<LI> <EM>NFS</EM>-bestandssysteem meegecompileerd. (Er hoeft geen
ondersteuning voor <EM>ext2</EM> mee te hoeven gecompileerd, een module
volstaat).</LI>
<LI> ``Root on NFS'' moet worden geactiveerd.</LI>
<LI> De Ethernet driver voor de netwerkkaart van het werkstation
moet mee worden gecompileerd.</LI>
<LI> Afhankelijk van wat je nodig hebt, kun je ondersteuning voor
<EM>RARP</EM> of <EM>BOOTBP</EM> voor NFS-Root insluiten. 
(Hiermee bedoel ik de vragen die worden gesteld na de vraag over NFS in 
make config).</LI>
</UL>
<P>Als het werkstation zonder kernelparameters zal worden geboot, moet je
ook het rootdevice instellen op 0:255. Doe dit door het aanmaken van een
dummy apparaatbestand met <CODE>mknod /dev/nfsroot b 0 255</CODE>. Nadat je
een dergelijk apparaatbestand hebt aangemaakt, kun je het rootdevice van de
kernel-image instellen met <CODE>rdev &lt;<EM>kernel-image</EM>&gt; /dev/nfsroot</CODE>.
<H2>3.2 Aanmaak van het rootbestandssysteem</H2>

<H3>Kopi&euml;ren van het bestandssysteem</H3>

<P><EM>Waarschuwing: ondanks dat deze instructies voor je zouden kunnen werken,
zijn ze in geen enkele betekenis zinvol in een produktie-omgeving.
Zie de NSF-Root-Client mini-howto van Ofer Maor
<CODE>&lt;ofer@hadar.co.il&gt;</CODE> 
voor een betere manier om een rootbestandssysteem voor de clients in te stellen.</EM>
<P>Nadat je hebt besloten waar de root-structuur te plaatsen, maak je het aan
met (b.v.) <CODE>mkdir -p &lt;<EM>directory</EM>&gt;</CODE> en 
<CODE>tar cClf / - | tar xpCf &lt;<EM>directory</EM>&gt; -</CODE>.
<P>Als je de kernel zonder LILO boot, dan moet de rootdir
<CODE>/tftpboot/&lt;<EM>IP-adres</EM>&gt;</CODE> zijn. Als je dit niet prettig vindt,
kun je het wijzigen in de Makefile in de kernel-sources, zoek naar een
regel als:
<CODE>NFS_ROOT = -DNFS_ROOT="\"/tftpboot/%s\""</CODE>
Als je dit wijzigt, moet je de kernel opnieuw compileren.
<H3>Wijzigingen aan het rootbestandssysteem</H3>

<P>Trim nu de niet benodigde bestanden, en controleer de /etc/rc.d scripts. 
Een aantal belangrijke punten:
<UL>
<LI> &Eacute;&eacute;n van de belangrijke zaken is de eth0 setup.
Het werkstation bereikt op z'n minst gedeeltelijk een eth0 setup.
In instellen van het IP-adres van het werkstation naar het IP-adres van
de server wordt niet als slim aangemerkt.
(Aangezien het de auteur gebeurde bij &eacute;&eacute;n van zijn eerste
pogingen).</LI>
<LI>Een ander punt is /etc/fstab van het werkstation. Het zou moeten zijn 
ingesteld voor nfs bestandssystemen.</LI>
<LI><B>WAARSCHUWING</B>: Verwar het rootbestandssysteem van de server niet
met het rootbestandssysteem van het werkstation.
(Ik heb reeds eerder een rc.inet1 op de server slordig ingesteld en ik 
vroeg me af waarom het werkstation nog steeds niet werkte).</LI>
</UL>
<H3>Exporteren van het bestandssysteem</H3>

<P>Exporteer de rootdir naar het werkstation. Zie <CODE>exports(5)</CODE>. Zeer
waarschijnlijk moet je de nfsd/mountd na deze wijziging opnieuw starten.
Onder RedHat kan dit eenvoudig worden bewerkstelligd door het typen van
<CODE>/etc/rc.d/init.d/nfs stop ; /etc/rc.d/init.d/nfs start </CODE>.
<H3>RARP setup</H3>

<P>Stel <EM>RARP</EM> ergens op het net in. Als je zonder nfsroot parameter boot,
moet de <EM>RARP</EM>-server de <EM>NFS</EM>-server zijn.
Gewoonlijk zal dit de <EM>NFS</EM>-server worden. Om dit te kunnen doen, moet
je een kernel draaien met ondersteuning voor <EM>RARP</EM>.
<P>Voer het uit (en installeer het ergens in <CODE>/etc/rc.d</CODE> op de
server!):
<P><CODE>/sbin/rarp -s &lt;<EM>ip-addr</EM>&gt; &lt;<EM>hardware-addr</EM>&gt;</CODE>
<P>hier is
<P>
<DL>
<DT><B>ip-addr</B><DD><P>het IP-adres van het werkstation en
</DL>
<P>
<DL>
<DT><B>hardware-addr</B><DD><P>het Ethernet-adres van de netwerkkaart van het
werkstation.
</DL>
<P>voorbeeld: <CODE>/sbin/rarp -s 131.131.90.200 00:00:c0:47:10:12</CODE>
<P>Je kunt in plaats van het IP-adres ook een symbolische naam gebruiken, zolang
de server maar achter het IP-adres kan komen.
(/etc/hosts of <EM>DNS</EM> lookups)
<H3>BOOTP setup</H3>

<P>Voor een <EM>BOOTP</EM> setup moet je <CODE>/etc/bootptab</CODE> wijzigen. Raadpleeg
alsjeblieft de manpages van <EM>bootpd(8)</EM> en <EM>bootptab(5)</EM>.
<H3>Het hardware-adres achterhalen</H3>

<P>Ik weet het hardware-adres niet! Hoe kom ik daar achter?
<UL>
<LI>Boot de gemaakte kerneldisk, en kijk naar een regel waar de
netwerkkaart wordt herkend. Het bevat gewoonlijk 6 hex bytes, dat het
adres van de kaart zou moeten zijn.</LI>
<LI>Boot het werkstation met een OS met waarbij TCP/IP networking
is geactiveerd. Ping dan het werkstation vanaf de server. Kijk in de
ARP-cache door het opstarten van:
<CODE>/sbin/arp -a</CODE></LI>
</UL>
<H2><A NAME="s4">4. Het werkstation booten</A></H2>

<H2>4.1 Gebruiken van een bootrom</H2>

<P>Aangezien ik iets dergelijks zelf nog niet hebt gebruikt, kan ik je
slechts de volgende tips geven
(Christian Leutloff <CODE>&lt;leutloff@sundancer.tng.oche.de&gt;</CODE> was zo
vriendelijk): 
<UL>
<LI>Je kunt geen gebruik maken van de ``gewone'' bootroms.</LI>
<LI>Er is een <CODE>netboot</CODE> packet van Gero Kuhlmann, dat voorziet
in bootroms voor Linux en verdere informatie.
<CODE>netboot</CODE> is beschikbaar vanaf de lokale Linux mirror, of als het
Debian package (<CODE>netboot-0.4</CODE>).</LI>
<LI>Lees de documentatie die met je bootrom wordt geleverd zorgvuldig door.</LI>
<LI>Je zal waarschijnlijk de tftpd op de server moeten activeren, maar
dit is afhankelijk van de wijze waarop de bootrom de kernel laadt.</LI>
<LI><I>Alle informatie over bootrom verkopers van deze Linux vari&euml;teit,hiervoor genoemd, aangezien niet iedereen toegang heeft tot een prom brander :(
(vooral in Europa, alwaar ik me bevind) is welkom, ik zal het hieraan
toevoegen.</I></LI>
</UL>
<H2>4.2 Een raw kerneldisk gebruiken</H2>

<P>Als je het rootbestandssysteem met de juiste naam gezien de standaard
benaming hebt ge&euml;xporteerd en je <EM>NFS</EM>-server ook de
<EM>RARP</EM>-server is,
(wat impliceert dat de boxen zich op hetzelfde subnet bevinden),
dan kun je de kernel gewoon booten door een <CODE>cat</CODE> naar een disk.
(Je moet het rootdevice in de kernel op 0:255 instelen).
Hierbij wordt verondersteld dat de rootdirectory op de server
<CODE>/tftpboot/</CODE><I>IP-adres</I> is
(deze waarde kan bij het compileren van de kernel worden gewijzigd).
<H2>4.3 Gebruik van een bootloader &amp; <EM>RARP</EM></H2>

<P>Geef de kernel bij het booten alle benodigde parameters en voeg toe
<CODE>nfsroot=&lt;<EM>server-ip-addr</EM>&gt;:&lt;<EM>/path/to/mount</EM>&gt;</CODE>;
hier is <EM>server-ip-addr</EM> het IP-adres van je NFS-server, en
<EM>/path/to/mount</EM> het path naar de rootdirectory.
<P>Tips:
<UL>
<LI> Overweeg bij gebruik van <B>LILO</B> gebruik te maken van de ``<CODE>lock</CODE>''
feature: Tik gewoonweg &eacute;&eacute;nmaal de juiste parameters in en
voeg er ``<CODE>lock</CODE>'' aan toe. Laat de volgende keer bij het booten de tijd
van LILO verstrijken.</LI>
<LI>Bij het genereren van een bootdisk specifiek voor een werkstation kun
je ook de <CODE>append=</CODE> feature in <CODE>lilo.conf</CODE> gebruiken.</LI>
</UL>
<H2>4.4 Een bootloader met <EM>RARP</EM> gebruiken</H2>

<P>Geef in aanvulling op <CODE>nfsroot</CODE> een 
<CODE>nfsaddrs=&lt;<EM>wst-IP</EM>&gt;:&lt;<EM>srv-IP</EM>&gt;:&lt;<EM>gw-IP</EM>&gt;:&lt;<EM>netm-IP</EM>&gt;:&lt;<EM>hostname</EM>&gt;</CODE>
commandoregelargument voor de kernel. De kernel zal <CODE>eth0</CODE>
met de opgegeven parameters instellen:
<DL>
<DT><B>wst-IP</B><DD><P>IP-adres van de computer
</DL>

<DL>
<DT><B>srv-IP</B><DD><P>IP-adres van de NFS-server
</DL>

<DL>
<DT><B>gw-IP</B><DD><P>gateway
</DL>

<DL>
<DT><B>netm-IP</B><DD><P>netmask
</DL>

<DL>
<DT><B>hostname</B><DD><P>computernaam
</DL>
<H2><A NAME="s5">5. Bekende problemen</A></H2>

<H2>5.1 /sbin/init start niet</H2>

<P>Een bekend probleem met /sbin/init, dat bij (tenminste) een aantal
huidige distributies wordt geleverd, is dat
/sbin/init dynamisch is gelinkt. Dus je moet voor de client in een juiste /lib
setup voorzien. Wat eenvoudig is te doen is /sbin/init (voor de client)
proberen te vervangen door een statisch gelinkt
``Hello World'' programma.
Op deze manier weet je of het iets fundamenteels is, of ``gewoon'' een probleem
dat te maken heeft met het dynamische linken.
<H2>5.2 /dev problemen</H2>

<P>
<P>Als je bij het booten een aantal onjuist weergegeven meldingen krijgt over
tty's, dan zou je vanaf de client in de /dev directory MAKEDEV uit kunnen
voeren.
Er gaan geruchten dat dit met bepaalde server os'sen die gebruik maken
van 64-bit dev nummers niet werkt. Mocht dit je overkomen, mail me dan
alsjeblieft met welk os je problemen ervaart.
Een mogelijke oplossing is het aanmaken van een kleine /dev ramdisk
aan het begin van het bootproces en het iedere keer herinstalleren van de device
nodes.
<H2><A NAME="s6">6. Andere onderwerpen</A></H2>

<P>
<UL>
<LI>Er is een BOOTP client:
<CODE>ftp://sunsite.unc.edu/system/Network/admin/bootpc.v045.tgz</CODE>
Met initrd (welk in Linux 2.0 is opgenomen), zou het mogelijk moeten
zijn het voor stations zonder harddisk heel aardig werkend te krijgen.
initrd is eigenlijk altijd een geavanceerde optie voor meer aangepaste setups.</LI>
<LI>Voor gewone op bootpd gebaseerde boots is dit in feite waarschijnlijk
niet nodig aangezien Linux 2.0 ook de optie bevat om BOOTP te gebruiken in
plaats van RARP. (Wat nauwkeuriger, je kunt beiden in de kernel compileren, en
de snellere response wint).</LI>
<LI>In de directory Documentation van de kerelsource komt een bestand
voor dat NFS-Root systemen bedocumenteert.</LI>
<LI>Er is een patch in omloop, waarmee swappen via NFS mogelijk is.
Het werd me toegezonden, maar ik
kreeg het op &eacute;&eacute;n of andere manier voor elkaar de mail kwijt
te raken. :( 
Je kunt er waarschijnlijk aan komen vanaf
http://www.linuxhq.com/ in de onoffici&euml;le sectie met patches.</LI>
<LI> Mijn PGP public key kan worden afgevangen door het commando
finger te geven met als adres andreas@ag.or.at.
De fingerprint is: F1 F7 43 D5 07 C4 6C 87  BF 6B 33 A2 2C EE 5A F9.</LI>
</UL>
</BODY>
</HTML>
