<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>VMailMgr HOWTO</TITLE>


</HEAD>
<BODY>
<H1>VMailMgr HOWTO</H1>

<H2>Bruce Guenter &lt;bruceg@em.ca&gt;,
Dan Kuykendall &lt;dan@kuykendall.org&gt;,<BR>
Vertaald door: Ellen Bokhorst &lt;bokkie@nl.linux.org&gt;</H2>v1.1, 23 april 2000
<P><HR>
<EM>In dit document wordt uitgelegd hoe ondersteuning voor VMailMgr pop3 virtuele
domein services in combinatie met Qmail in te stellen.</EM>
<HR>
<H2><A NAME="s1">1. Introductie</A></H2>

<P>VMailMgr (afkorting van Virtuele MAIL ManaGeR) is een pakket met programma's
ontworpen om meerdere domeinen mailadressen en mailboxen op een enkele host
te beheren. Het werkt samen met qmail voor het bezorgen van de mail en
beheer van het programma.
<H2>1.1 Wat is VMailMgr en waarom zou ik het gebruiken?</H2>

<P>VMailMgr is:
<P>Een serie utility's voor het beheren van virtuele domeinen inclusief een 
wachtwoordcontrole interface voor qmail welke het gebruikelijke 
checkpassword vervangt, en een authenticatie module voor
Courier IMAP, dat voorziet in toegang tot de virtuele mailboxen middels
&eacute;&eacute;n van de drie volgende methoden:
<UL>
<LI> 
Op IP gebaseerde virtuele servertoegang (onzichtbaar voor de POP3 gebruiker) </LI>
<LI> toegang gebaseerd op de gebruikersnaam (gebruikersnaam-virtuele
gebruiker) </LI>
<LI> Op de hostnaam gebaseerde toegang (virtuelegebruiker@virtuele.host of virtuelegebruiker:virtuele.host) </LI>
</UL>
<P>Je zou het kunnen gebruiken als:
<P>Je er de voorkeur aangeeft ieder domein via een aparte gebruikersnaam te
beheren, wat je de mogelijkheid geeft gebruik te maken van systeemquota's
wat tevens veiliger is.
<H2>1.2 Nieuwe versies</H2>

<P>De nieuwste versie van dit document is te vinden op mijn homepage 
<A HREF="http://www.clearrivertech.com/linux/HOWTO">http://www.clearrivertech.com/linux/HOWTO</A>
als SGML source, als HTML en als TEKST.
Andere versies in verschillende formaten zijn te vinden bij de LDP homepage 
<A HREF="http://www.linuxdoc.org/">http://www.linuxdoc.org/</A>.
Een kopie is ook te vinden op de VMailMgr homepage 
<A HREF="http://em.ca/~bruceg/vmailmgr/">http://em.ca/~bruceg/vmailmgr/</A> 
als een HTML-versie als ook in het VMailMgr source package in zowel
SGML-sourceformaat als HTML.
<H2>1.3 Opmerkingen</H2>

<P>Opmerkingen over deze HOWTO kunnen worden doorgestuurd naar de
VMailMgr mailinglist.
Stuur voor een aanmelding op deze lijst een email naar 
<A HREF="mailto:vmailmgr@lists.em.ca">vmailmgr@lists.em.ca</A>.
<H2>1.4 Historie</H2>

<P>Aan dit document werd begonnen door Bruce Guenter en het werd
omgewerkt door Dan Kuykendall.
<H2>1.5 Versie historie</H2>

<P>Oude versie
<P>
<UL>
<LI>Gecre&euml;erd door Bruce, stond niet in het SGML-formaat.</LI>
</UL>
<P>v1.0 (20 april 2000)
<P>
<UL>
<LI>Nette SGML-versie samengesteld.</LI>
<LI>De FAQ opgenomen.</LI>
<LI>Andere kleine aanvullingen.</LI>
</UL>
<P>v1.1 (23 april 2000)
<P>
<UL>
<LI>De FAQ in een apart bestand geplaatst, maar wat belangrijke info
vanuit de FAQ ingesloten.</LI>
<LI>De sectie Courier-IMAP ondersteuning bijgewerkt.</LI>
<LI>Overgeschakeld naar de GNU FDL licentie.</LI>
<LI>Andere kleine aanvullingen.</LI>
</UL>
<H2>1.6 Copyrights en handelsmerken</H2>

<P>Copyright (c)  Dan Kuykendall.
Het is toegestaan dit document onder voorwaarden van de GNU Free
Documentatie Licentie, versie 1.1 of enige latere versie gepubliceerd
door de Free Software Foundation te kopi&euml;ren en/of aan te passen.
<P>Een kopie van deze licentie is beschikbaar vanaf
<A HREF="http://www.gnu.org/copyleft/fdl.txt">GNU Free Documentation License</A>.
<H2>1.7 Erkenningen en dankbetuigingen</H2>

<P>Met dank aan Bruce Guenter voor VMailMgr en de kern van deze HOWTO.  Met dank
aan Mike Bell, die altijd de antwoorden op mijn vragen schijnt te hebben. Als
laatste, dank aan allen op de
<A HREF="mailto:vmailmgr@lists.em.ca">vmailmgr@lists.em.ca</A>
mailinglist die me hebben geholpen of zovaak hetzelfde vroegen dat ik
ik dit moest schrijven om de steeds weer terugkomende vragen te stoppen.
<H2><A NAME="s2">2. Installatie</A></H2>

<H2>2.1 Haal de bestanden op</H2>

<P>Breng een bezoek aan de VMailMgr website 
<A HREF="http://em.ca/~bruceg/vmailmgr/">http://em.ca/~bruceg/vmailmgr/</A>
voor het ophalen van het package.
<P>Als je de binaire RPM's ophaalt, heb je op z'n minst de packages
vmailmgr en vmailmgr-daemon nodig.
<H2>2.2 Installatie met RPM'S</H2>

<H3>Compileren van de SRC.RPM's</H3>

<P>Compileer eenvoudigweg het src.rpm bestand  met de
opdracht `<CODE>rpm --rebuild</CODE>`.
-Voorbeeld-
<HR>
<PRE>
rpm -ivh vmailmgr-0.96.6-1.src.rpm
</PRE>
<HR>
<H3>Installatie van de RPM's</H3>

<P>Na het compileren van de source rpm's, zijn de binary's te vinden in
`<CODE>/usr/src/redhat/RPMS/i386/</CODE>` of ergens daaromtrent.
<P>Start gewoon voor ieder package de volgende opdracht op:
<PRE>
rpm -ivh &lt;locatie>/&lt;package.i386.rpm>
</PRE>

-Voorbeeld-
<HR>
<PRE>
rpm -ivh /usr/src/redhat/RPMS/i386/vmailmgr-0.96.6-1.i386.rpm
rpm -ivh /usr/src/redhat/RPMS/i386/VMailMgr-daemon-0.96.6-1.i386.rpm
</PRE>
<HR>
<H2>2.3 Installeren vanuit de source</H2>

<P>Als je geen gebruik van RPM's wilt maken, kun je het vanuit de source
installeren.
Geef de volgende opdrachten:
<PRE>
(Als niet-root gebruiker)
tar zxf &lt;package.tar.gz&gt;
cd &lt;nieuw aangemaakt dir&gt;
./configure
make
(Als root)
make install
</PRE>

-Voorbeeld-
<HR>
<PRE>
(Als niet-root gebruiker)
tar zxf vmailmgr-0.96.6.tar.gz
cd vmailmgr-0.96.6
./configure
make
(Als root)
make install
</PRE>
<HR>

Daarmee zou het moeten lukken.
<H2><A NAME="s3">3. Setup</A></H2>

<H2>3.1 Instellen van een Virtueel domein</H2>

<P>De volgende stappen zijn nodig voor het met vmailmgr instellen van een
virtueel domein (ervan uitgaande dat vmailmgr is gecompileerd en
ge&iuml;nstalleerd). Als voorbeeld zullen we een virtuele gebruiker
`<CODE>ik@mijndomain.org</CODE>` instellen, met de aliassen `<CODE>mijzelf@mijndomain.org</CODE>` 
en `<CODE>mijnnaam@mijndomein.org</CODE>`. 
<P>
<OL>
<LI>Zet een DNS entry op voor het domein. Ik zal dat hierin niet behandelen
aangezien dat van veel te veel dingen afhangt. Wat ik wel aan kan geven is
dat een PTR record dat overeenkomt met een entry in virtualdomains nodig is
om een op IP gebaseerd virtueel domein te laten werken. Als nslookup
bijvoorbeeld 10.56.33.122 <CODE>mail.mijndomein.com</CODE> retourneert, dan is er 
in <CODE>virtualdomains</CODE> een entry nodig als
`<CODE>mail.mijndomein.com:mijngebruiker</CODE>`
Als voorbeeld, gaan we ervan uit dat de mail exchanger voor
mijndomein.org reeds zo is ingesteld dat het naar je computer verwijst.</LI>
<LI>Stel een basisgebruiker in voor het domein. Maak een gebruiker
aan met een naam naar keuze. Aangezien de maildirs voor alle
gebruikers in het virtuele domein onder de homedirectory van
deze gebruiker zal worden opgeslagen, moet je ervoor zorgen
dat deze partitie of disk geschikt is voor een dergelijke opslag.
De tools die je hiervoor kunt gebruiken, vari&euml;ren nogal per
systeem. Ik zal omwille van ons voorbeeld een gebruiker `<CODE>mijngebruiker</CODE>'
toevoegen.</LI>
<LI>Configureer qmail zo dat het 't domein herkent. 
Hiervoor moet je twee van qmail's configuratiebestanden in
<CODE>/var/qmail/control</CODE> aanpassen:` `<CODE>rcpthosts</CODE>` en 
`<CODE>virtualdomains</CODE>`. </LI>
<LI>Voeg aan `<CODE>rcpthosts</CODE>` 
de regel `<CODE>mijndomein.org</CODE>` toe. </LI>
<LI>Voeg aan `<CODE>virtualdomains</CODE>` 
de regel `<CODE>mijndomein.org:mijngebruiker</CODE>` toe.</LI>
</OL>
<P>Als je wilt dat mail aan `<CODE>watdanook.mijndomein.org</CODE>`
op dezelfde manier wordt bezorgd, voeg je de volgende gegevens toe:
<P>
<UL>
<LI>Aan `<CODE>rcpthosts</CODE>` :
de regel `<CODE>.mijndomein.org</CODE>`. </LI>
<LI>Aan `<CODE>virtualdomains</CODE>` :
de regel `<CODE>.mijndomein.org:mijngebruiker</CODE>`.</LI>
<LI>Configureer qmail-popup/qmail-pop3d zo dat het gebruik maakt 
van `<CODE>checkvpw</CODE>`  voor de wachtwoordcontrole. Deze stap
is afhankelijk van hoe je qmail installeerde.</LI>
<LI>Vervang `<CODE>checkpassword</CODE>` in de door jouw gebruikte opdracht
om qmail-popup/qmail-pop3d aan te roepen
(of in `<CODE>/etc/inet.conf</CODE>` of in een `<CODE>tcpserver</CODE>` opdracht)
door `<CODE>checkvpw</CODE>`.</LI>
<LI>En/of achter de prompt typ je: 
`<CODE>echo checkvpw > /var/qmail/control/checkpassword</CODE>`</LI>
<LI>Voeg gebruikers of aliassen aan het domein toe. Wijzig user in
de gebruiker die je zojuist hebt aangemaakt 
(typ bijvoorbeeld `<CODE>su - myuser</CODE>`) of log in (met telnet of
onder de console) als de nieuwe gebruiker, en gebruik de ingesloten
programma's om gebruikers en aliassen toe te voegen.
Voor ons voorbeeld:

<OL>
<LI>typ: `<CODE>vadduser me</CODE>` (welke vraagt om een wachtwoord)</LI>
<LI>typ: `<CODE>vaddalias me mijzelf</CODE>`</LI>
<LI>en typ: `<CODE>vaddalias me mijnnaam</CODE>`</LI>
</OL>
</LI>
</UL>
<P>Nadat je met deze stappen klaar bent, zal je 
`&lt;qmail-send&gt;` moeten killen en herstarten om ervoor te zorgen
dat het de nieuwe `<CODE>virtualdomains</CODE>` tabel inleest.
Als je `<CODE>inetd</CODE>` gebruikt om `<CODE>qmail-popup</CODE>` op te starten,
`<CODE>kill -HUP</CODE>` het `<CODE>inetd</CODE>` proces dan ook. 
<H2>3.2 Gebruik van &eacute;&eacute;n IP-adres voor meerdere domeinen</H2>

<H3>Inloggen als een virtuele gebruiker?</H3>

<P>Er zijn twee manieren om zonder gebruik van meerdere IP-adressen in te
loggen.
<P>
<OL>
<LI>De eerste manier is als `<CODE>userSEPvirtual.domein.org</CODE>` in te loggen,
waar `<CODE>user</CODE>` de naam is van de mailbox van de virtuele gebruiker,
SEP staat voor `<CODE>@</CODE>` of `<CODE>:</CODE>` (dit is de standaardwaarde, 
en is te configureren in de directory) `<CODE>/etc/vmailmgr/</CODE>'), en 
`<CODE>virtual.domein.org</CODE>' is de naam van het virtuele domein, zoals
opgesomd in `<CODE>/var/qmail/control/virtualdomains</CODE>'. </LI>
<LI>De tweede manier is de interne vorm van de mailbox naam te gebruiken,
dat wil zeggen, `<CODE>baseuser-user</CODE>', waar `<CODE>user</CODE>' dezelfde naam
is als hierboven, en `<CODE>baseuser</CODE>' de gebruikersnaam is van de
beherende gebruiker.</LI>
</OL>
<P>Voorbeeld: `<CODE>/var/qmail/control/virtualdomains</CODE>' bevat 
<PRE>
testdomein.org:testuser
</PRE>

Gebruiker `<CODE>mijngebruiker</CODE>' komt voor, en daarvoor is een virtuele
mailbox ingesteld met de naam `<CODE>me</CODE>'. De `<CODE>scheidingsteken</CODE>' 
variabele in `<CODE>/etc/vmailmgr/</CODE>' bevat
`<CODE>@:</CODE>'. Deze virtuele gebruiker zou in kunnen loggen als
`<CODE>me@mijndomein.com</CODE>', `<CODE>me:mijndomein.cm</CODE>', of
`<CODE>mijngebruiker-me</CODE>'. 
<H2>3.3 Alle onjuist verstuurde mail opvangen?</H2>

<P>In de `<CODE>vmailmgr/</CODE>' configuratiedirectory, komt een entry voor
genaamd `<CODE>default-username</CODE>'. Als mail naar een virtueel domein
niet overeenkomt met &eacute;&eacute;n van de gebruikers of aliassen in
dat domein, wordt het bezorgd bij degene waarvan de naam is opgegeven in
dit configuratie-item als het bestaat (standaard naar
`<CODE>+</CODE>'). Om te zorgen dat het bij jou bezorgd wordt, typ je gewoon:
<PRE>
vaddalias me +
</PRE>
<H2>3.4 Setup VMailMgr IMAP ondersteuning?</H2>

<P>VMailMgr ondersteunt Courier-IMAP, maar Courier-IMAP detecteert VMailMgr
niet automatisch. Dit betekent dat er nog wat werk verzet moet worden om
die twee samen te laten werken.
<P>
<UL>
<LI>Je moet `<CODE>/usr/local/bin/authvmailmgr</CODE>` naar
`<CODE>/usr/lib/courier-imap/libexec/authlib/authvmailmgr</CODE>`
kopi&euml;ren.</LI>
<LI>Vervolgens het statement `<CODE>AUTHMODULES</CODE>` aanpassen in
`<CODE>/usr/lib/courier-imap/etc/imapd.config</CODE>` en
`<CODE>authvmailmgr</CODE>` als de eerste authenticatie module
toevoegen.</LI>
</UL>
<P>
</BODY>
</HTML>
