<HTML
><HEAD
><TITLE
>Modem Sharing mini-HOWTO</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><META
NAME="KEYWORD"
CONTENT="modem"><META
NAME="KEYWORD"
CONTENT="share"><META
NAME="KEYWORD"
CONTENT="dialup"><META
NAME="KEYWORD"
CONTENT="ppp"><META
NAME="KEYWORD"
CONTENT="masquerade"><META
NAME="KEYWORD"
CONTENT="Masqdialer"></HEAD
><BODY
CLASS="ARTICLE"
BACKGROUND="../IMAGES/back.gif"
LINK="#000099"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
></A
>Modem Sharing mini-HOWTO</H1
><H3
CLASS="AUTHOR"
><A
NAME="AEN4"
>Friedemann Baitinger</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:fb@baiti.net"
>fb@baiti.net</A
>&#62;</TT
><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P
></DIV
></DIV
><H3
CLASS="AUTHOR"
><A
NAME="AEN17"
>Vertaald door: Ellen Bokhorst</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:bokkie@nl.linux.org"
>bokkie@nl.linux.org</A
>&#62;</TT
><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</P
></DIV
></DIV
><P
CLASS="PUBDATE"
>22-08-2001<BR></P
><DIV
CLASS="REVHISTORY"
><TABLE
WIDTH="100%"
BORDER="0"
><TR
><TH
ALIGN="LEFT"
VALIGN="TOP"
COLSPAN="3"
><B
>Wijzigingen</B
></TH
></TR
><TR
><TD
ALIGN="LEFT"
>Herziening v1.12</TD
><TD
ALIGN="LEFT"
>22-08-2001</TD
><TD
ALIGN="LEFT"
>Herzien door: gjf</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>E-mail van de auteur gecorrigeerd</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Herziening v1.11</TD
><TD
ALIGN="LEFT"
>12-07-2001</TD
><TD
ALIGN="LEFT"
>Herzien door: aeg</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Naar DocBook SGML geconverteerd</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Herziening v1.10</TD
><TD
ALIGN="LEFT"
>11-09-1999</TD
><TD
ALIGN="LEFT"
>Herzien door: fb</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Sectie "Feedback van Gebruikers" toegevoegd</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Herziening v1.01</TD
><TD
ALIGN="LEFT"
>12-06-1997</TD
><TD
ALIGN="LEFT"
>Herzien door: fb</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Source naar HTML geconverteerd</TD
></TR
></TABLE
></DIV
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN45"
></A
><P
></P
><P
>Hierin wordt beschreven hoe een Linux systeem zodanig in te
    stellen dat een modem kan worden gedeeld met anderen systemen over
    een TPC/IP netwerk.</P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Inhoudsopgave</B
></DT
><DT
><A
HREF="#LEGALNOTICE"
>Legal Notice</A
></DT
><DT
><A
HREF="#THE-SERVER-SIDE"
>De Server Side</A
></DT
><DT
><A
HREF="#THE-CLIENT-SIDE"
>De Client Side</A
></DT
><DT
><A
HREF="#SECURITY-CONSIDERATIONS"
>Beveiligingsoverwegingen</A
></DT
><DT
><A
HREF="#EXAMPLES"
>Voorbeelden</A
></DT
><DT
><A
HREF="#FEEDBACK-FROM-USERS"
>Feedback van gebruikers</A
></DT
></DL
></DIV
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="LEGALNOTICE"
></A
>Legal Notice</H2
><P
>     Copyright &copy; 1997 Friedemann Baitinger. Dit document mag alleen
     worden gedistribueerd onder de voorwaarden en condities uiteengezet
     in de GNU Free Documentation License te vinden op
     &lt;<A
HREF="http://www.gnu.org/copyleft/fdl.html"
TARGET="_top"
>     http://www.gnu.org/copyleft/fdl.html</A
>&gt;. 
    </P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="THE-SERVER-SIDE"
></A
>De Server Side</H2
><P
>Er wordt verondersteld dat de server een Linux systeem is met:</P
><P
></P
><UL
><LI
><P
>een modem gekoppeld aan een <TT
CLASS="FILENAME"
>/dev/ttySx</TT
> device</P
></LI
><LI
><P
>of een ge&euml;muleerd 'isdn4linux' modem ingedeeld als een
    <TT
CLASS="FILENAME"
>/dev/ttyIx</TT
> device</P
></LI
></UL
><P
>De makkelijkste setup die ik kan bedenken maakt gebruik van een 
vijfregelig perlscript om een modem daemon in
<TT
CLASS="FILENAME"
>/usr/sbin/modemd</TT
> te implementeren:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>   
#!/usr/bin/perl
select((select(STDOUT), $| = 1)[$[]);
select((select(STDIN), $| = 1)[$[]);
exec 'cu -s 115200 -l /dev/ttyS1';
die '$0: Cant exec cu: $!\n';</PRE
></TD
></TR
></TABLE
><P
>De modem daemon wordt gestart door het <B
CLASS="COMMAND"
>inetd</B
> proces 
als een client een verbinding maakt met de van toepassing zijnde poort zoals
hieronder beschreven. De <B
CLASS="COMMAND"
>modemd</B
> verbindt simpelweg
de socket handle met STDIN en STDOUT van de opdracht
<B
CLASS="COMMAND"
>cu</B
> en laat <B
CLASS="COMMAND"
>cu</B
> het feitelijke
modemdevice afhandelen.</P
><P
>Het bestaan van de modemdaemon moet bekend worden gemaakt aan
het <B
CLASS="COMMAND"
>inetd</B
> proces door zijn configuratiebestand bij te
werken, gewoonlijk <TT
CLASS="FILENAME"
>/etc/inetd.conf</TT
>:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>#
# modem daemon
#
modem stream tcp nowait root /usr/sbin/tcpd /usr/sbin/modemd /dev/ttyS1</PRE
></TD
></TR
></TABLE
><P
>Om dit werkend te krijgen, moet in <TT
CLASS="FILENAME"
>/etc/services</TT
>
een regel toegevoegd worden:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>   
modem           2006/tcp        modemd</PRE
></TD
></TR
></TABLE
><P
>Dit verbindt een symbolische naam aan een expliciete poort, in dit
voorbeeld 2006. Het poortnummer kan elk nummer zijn zolang het nog niet is 
toegekend aan een bestaande service. Nadat deze wijzigingen zijn aangebracht,
moet een signaal naar het inetd proces worden gezonden waardoor
<B
CLASS="COMMAND"
>inetd</B
> zijn configuratiebestand opnieuw inleest en
het verwerkt:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>   
<TT
CLASS="PROMPT"
>bash#</TT
> ps | grep inetd
194  ?  S     0:00 /usr/sbin/inetd

<TT
CLASS="PROMPT"
>bash#</TT
> kill -HUP 194</PRE
></TD
></TR
></TABLE
><P
>Nu is de server zover dat het verzoeken van clients accepteert.
Het correcte functioneren kan worden geverifieerd met:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
><TT
CLASS="PROMPT"
>bash$</TT
> telnet localhost modem

Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.</PRE
></TD
></TR
></TABLE
><P
>Je hebt nu een verbinding met de modem tot stand gebracht. Je kunt
nu <B
CLASS="COMMAND"
>AT</B
> opdrachten uitvoeren om de setup te verifi&uml;ren:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>   
atz
atz
OK

ati1
ati1
Linux ISDN
OK

^]
telnet&gt;quit
<TT
CLASS="PROMPT"
>bash$</TT
></PRE
></TD
></TR
></TABLE
><P
>Als vervanging van het Perlscript als modemserver, kan ook een
programma genaamd <SPAN
CLASS="PRODUCTNAME"
>Masqdialer</SPAN
> worden gebruikt,
wat beschikbaar is op
<A
HREF="http://w3.cpwright.com/mserver/"
TARGET="_top"
>http://w3.cpwright.com/mserver/</A
>.</P
><P
>Met <SPAN
CLASS="PRODUCTNAME"
>Masqdialer</SPAN
> kun je elk aantal
modems verbonden met je server exporteren naar elke host die een verbinding
met de server kan maken via TCP/IP op een gegeven poort met een binaire
gegevensstroom.</P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MASQDIALER-INSTALLATION"
></A
>Masqdialer installatie</H3
><P
>Controleer voor de compilatie de opties in config.h:</P
><P
></P
><UL
><LI
><P
>stel naar wens het pad in voor het configuratiebestand
  </P
></LI
><LI
><P
>stel naar wens het pad in voor het lockbestand
  </P
></LI
></UL
><P
>Voer uit: <B
CLASS="COMMAND"
>make all</B
>.</P
><P
>Kopieer de binaire bestanden (<TT
CLASS="FILENAME"
>mserver</TT
> en 
<TT
CLASS="FILENAME"
>tcpconn</TT
>) naar een geschikte directory, zoals
<SPAN
CLASS="SYSTEMITEM"
>/usr/local/sbin/</SPAN
>. Kopieer 
<TT
CLASS="FILENAME"
>mserver.conf</TT
> naar de lokatie die je hebt opgegeven in
<TT
CLASS="FILENAME"
>config.h</TT
>.</P
><P
><SPAN
CLASS="PRODUCTNAME"
>Masqdialer</SPAN
> zou kunnen worden opgestart
vanuit &eacute;&eacute;n van de systeemopstartscripts.
Een eenvoudig
<B
CLASS="COMMAND"
>/usr/local/sbin/mserver</B
> zal het als een daemon
uitvoeren.</P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MASQDIALER-CONFIGURATION"
></A
>Masqdialer configuratie</H3
><P
>Een regel in <TT
CLASS="FILENAME"
>mserver.conf</TT
> zou er zo uit
kunnen zien:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>5800 /dev/ttyS1      115200,8,N,1    *.foo.org,192.168.2.1</PRE
></TD
></TR
></TABLE
><P
>wat zou betekenen dat een moden aangesloten op
<TT
CLASS="FILENAME"
>/dev/ttyS1</TT
> via poort 5800 overal vandaan in het
domein foo.org en vanaf host 192.168.2.1 een verbinding kan maken.
Alle andere hosts worden geweigerd. Valkuil: Als je geen hosts opgeeft dan
zal <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>ELKE</I
></SPAN
> host een verbinding tot stand kunnen
brengen. De instellingen van de seri&euml;le lijn zijn vast en deze
kunnen vanaf de client niet worden gewijzigd. Je kunt op een enkele poort
verscheidene modems exporteren. <SPAN
CLASS="PRODUCTNAME"
>Masqdialer</SPAN
> 
plaats alleen een lock op modemdevices via lockbestanden in de stijl
van UUCP wanneer ze werkelijk in gebruik zijn, dus andere programma's
de mogelijkheid bieden er gebruik van te maken.</P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="THE-CLIENT-SIDE"
></A
>De Client Side</H2
><P
>Thans wordt hier alleen de setup van Windows clients beschreven.
Op de client PC, is een COM-poort redirector voor TCP/IP nodig.
Het beste programma dat ik vond voor dit doel is
<SPAN
CLASS="PRODUCTNAME"
>DialOut/IP</SPAN
> van Tactical Software voor 
<SPAN
CLASS="PRODUCTNAME"
>Windows 3.1</SPAN
> en 
<SPAN
CLASS="PRODUCTNAME"
>Windows 95</SPAN
>.  (De <SPAN
CLASS="PRODUCTNAME"
>Windows 
3.1</SPAN
> versie kan onder <SPAN
CLASS="PRODUCTNAME"
>Windows NT</SPAN
>
alleen voor 16-bit applicaties worden gebruikt.
Een 32-bit versie voor <SPAN
CLASS="PRODUCTNAME"
>Windows NT</SPAN
> is eind van
de zomer van 1997 te verwachten.)</P
><P
><SPAN
CLASS="PRODUCTNAME"
>DialOut/IP</SPAN
> presenteert de gedeelde modem
op een nieuwe virtuele COM-poort dat het toevoegt aan
<SPAN
CLASS="PRODUCTNAME"
>Windows</SPAN
>.  
Deze virtuele COM-poort kan worden gebruikt door 
<SPAN
CLASS="PRODUCTNAME"
>Windows</SPAN
>  programma's alsof de gedeelde modem
direct is verbonden. De meeste client
applicaties (waaronder <SPAN
CLASS="PRODUCTNAME"
>Windows 95</SPAN
> dial-up 
networking) accepteren dit en werken alsof er een echte COM-poort en
modem aanwezig is, met als uitzondering de fax applicaties of enige andere
programma's die toegang tot de UART control lines nodig hebben.
<SPAN
CLASS="PRODUCTNAME"
>DialOut/IP</SPAN
> kan zo worden geconfigureerd
dat het voorziet in verwerking van het telnetprotocol, maar die feature
is van toepassing op bepaalde modem poolproducten, en niet op de Linux
setup die in dit bestand wordt beschreven.
<SPAN
CLASS="PRODUCTNAME"
>DialOut/IP</SPAN
> kan, ondanks zijn naam, ook worden 
gebruikt door applicaties die op inkomende aanroepen wachten.</P
><P
>Op 
<A
HREF="http://www.tactical-sw.com/"
TARGET="_top"
>http://www.tactical-sw.com/</A
> 
bevindt zich een pagina voor het downloaden van een volledig functionele
evaluatieversie welke na 1-2 weken verloopt. De installatie en configuratie
wordt door een setupprogramma afgehandeld en de installatiedetails
zijn te vinden in het <TT
CLASS="FILENAME"
>README.TXT</TT
> bestand.  
Wanneer je <SPAN
CLASS="PRODUCTNAME"
>DialOut/IP</SPAN
> opstart, 
geef je het IP-adres en het poortnummer van de gedeelde modem op.</P
><P
><SPAN
CLASS="PRODUCTNAME"
>DialOut/IP</SPAN
> is een commercieel product dat
is gelicentieerd op een per-modem basis, dat wil zeggen dat de prijs
afhankelijk is van het aantal modems dat je deelt. In de licentie staat
dat je de software op elk willekeurig aantal PC's kunt installeren die
de gedeelde modems benaderen.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="SECURITY-CONSIDERATIONS"
></A
>Beveiligingsoverwegingen</H2
><P
>Als je slechts &eacute;&eacute;n modem hebt in je local area
network, dan is er waarschijnlijk geen reden je zorgen te maken om
de beveiliging. Als er echter &eacute;&eacute;n of meer hosts in je LAN
met het Internet zijn verbonden via andere middelen dan de modem die we
zojuist hebben ingesteld als modemserver, dan moet enige mate van
beveiliging worden overwogen, anders kan iedereen een
<B
CLASS="COMMAND"
>telnet je_host modem</B
> uitvoeren en naar wens
lange afstands of zelfs internationale aanroepen uitvoeren.</P
><P
>Ik raad je aan tcp-wrappers te installeren en configureren om 
de modemserver tegen ongeautoriseerde toegang te beschermen.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="EXAMPLES"
></A
>Voorbeelden</H2
><P
>Ik gebruik de setup zoals beschreven in
<A
HREF="#THE-SERVER-SIDE"
>De Server Side</A
> en 
<A
HREF="#THE-CLIENT-SIDE"
>De Client Side</A
> om op
mijn <SPAN
CLASS="PRODUCTNAME"
>Windows 95</SPAN
> <SPAN
CLASS="PRODUCTNAME"
>ThinkPad</SPAN
>
<SPAN
CLASS="PRODUCTNAME"
>Quicken</SPAN
> uit te voeren en thuis te bankieren
met de modem aangesloten op mijn Linux machine. De "modem" in mijn geval
is zelfs geen echt modem, het is een ge&euml;muleerd modem op een ISDN-So
kaart. <SPAN
CLASS="PRODUCTNAME"
>Quicken</SPAN
> ziet slechts een COM-poort,
het weet niet dat het device aangesloten op de COM-poort zich in werkelijkheid
aan het andere einde van mijn Ethernet LAN bevindt, noch weet het niet dat
het geen standaard analoog modem is, maar een ISDN-device welk
<B
CLASS="COMMAND"
>AT</B
> opdrachten begrijpt.</P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="FEEDBACK-FROM-USERS"
></A
>Feedback van gebruikers</H2
><P
>Sinds de eerste uitgave van dit document in juni 1997 heb ik
heel wat e-mailberichten gerelateerd aan dit onderwerp ontvangen.
In de meeste berichten waren mensen op zoek naar meer hulp om 
het delen van de modem geconfigureerd en draaiend te krijgen.</P
><P
>Onlangs ontving ik een interessante feedback van
<A
HREF="mailto:Karsten%20Hilbert%20%3CKarsten.Hilbert@gmx.net%3E?subject=Masqdialer%20client"
TARGET="_top"
>Karsten.Hilbert@gmx.net</A
>. Karsten wees me erop dat
ondanks dat <SPAN
CLASS="PRODUCTNAME"
>DialOut/IP</SPAN
> dan een goede clientprogramma
kan zijn, hij graag een client onder 
<A
HREF="http://www.gnu.org/"
TARGET="_top"
>GPL</A
> zou willen hebben.
Karsten vermeldde de Software Bazaar 
&lt;<A
HREF="http://visar.csustan.edu/bazaar/"
TARGET="_top"
>http://visar.csustan.edu/bazaar/</A
>&gt; 
deed vrijwillig een schenking. Karsen schreef het volgende:</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>     Date: Fri, 27 Aug 1999 17:46:39 +0200 (CEST)
     From: Karsten Hilbert &lt;med94ecz@studserv.uni-leipzig.de&gt;
     Reply-To: Karsten Hilbert &lt;Karsten.Hilbert@gmx.net&gt;
     To: fb@baiti.net
     Subject: Windows-Modemsharing-Howto

     Hi !

     De howto benoemd DialOut/IP als een goed hulpmiddel om Windows clients
     te verbinden met een linux server door het delen van een modem.

     Ik ben het daarmee eens. Het zou echter aantrekkelijker zijn als
     er een client onder GPL zou zijn, nietwaar? Hier dacht ik aan en
     ik besloot wat geld te schenken voor de implementatie van een
     dergelijke client op de Software Bazaar. Als iemand het project
     oppakt zal ik hem een bepaald bedrag betalen als het voltooid
     is en functioneel. Daarna zou de client onder de GPL vallen.

     Nu kan ik slechts een beetje geld schenken :) Maar andere mensen
     zouden mee kunnen doen en ook wat kunnen schenken, om meer te motiveren.
     Zou je howto geen perfecte plaats zijn om deze mogelijkheid
     te noemen?

     De Bazaar is te vinden op:

      http://visar.csustan.edu/bazaar/

     Dit is wat ik je wilde melden.

     Karsten</PRE
></TD
></TR
></TABLE
></DIV
></DIV
></BODY
></HTML
>