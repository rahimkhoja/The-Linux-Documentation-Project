<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>sendmail address rewriting mini-HOWTO</TITLE>


</HEAD>
<BODY>
<H1>sendmail address rewriting mini-HOWTO</H1>

<H2>Thomas Roessler, roessler@guug.de,<BR>
Vertaald door: Ellen Bokhorst, bokkie@nl.linux.org</H2>v0.0, 6 mei 1998
<P><HR>
<EM> Dit document is een beknopte beschrijving van hoe
het configuratiebestand van sendmail voor dial-up toegang
kan worden ingesteld voor de thuisgebruiker.</EM>
<HR>
<H2><A NAME="s1">1. Introductie</A></H2>

<P>We gaan ervan uit dat je het soort Internet toegang
hebt welke tegenwoordig op universiteiten en online
services het meest gebruikelijk schijnt te zijn: je
belt in op het netwerk van je provider met PPP over
een seri&euml;le verbinding. Je inkomende mail wordt
gespoold op de POP- of IMAP-server van je ISP, terwijl
uitgaande berichten via SMTP worden verzonden. Je hebt geen
eigen domeinnaam, dus voor alles moet je gebruik maken van
<EM>&eacute;&eacute;n</EM> adres.
<P>We gaan ervan uit dat je reeds een tamelijk recente versie
van Eric Allman's sendmail (tijdens dit schrijven is de
huidige versie 8.8.8 en deze voldoet prima) hebt ge&iuml;nstalleerd.
<P>In dit document wordt voor een deel naar specifieke eigenschappen
van een Debian GNU/Linux systeem verwezen; gebruikers van andere
distributies zullen dit in de gaten moeten houden.
<P>Zorg dat je de volgende informatie bij de hand hebt:
<P>
<P>
<UL>
<LI>De mailserver van je ISP</LI>
<LI>Je Internet mail-adres</LI>
</UL>
<P>De te plannen configuratie dient twee hoofddoelen:
<P>
<OL>
<LI>Het versturen van mail tussen diverse lokale gebruikers
moet mogelijk zijn.</LI>
<LI>De buitenwereld moet voor de lokale gebruikers het ISP mailadres
laten zien, en niet de lokale adressen.</LI>
</OL>
<P>Om dit te bereiken, zullen we gebruik maken van 
de <CODE>genericstable</CODE> feature van sendmail.
<H2><A NAME="s2">2. Bestandsoverzicht</A></H2>

<P>We zullen alle configuratiebestanden van sendmail in een
aparte directory onder <CODE>/etc</CODE> plaatsen:
<CODE>/etc/mail</CODE>.  Gewoonlijk verwacht sendmail dat deze
bestanden direct onder <CODE>/etc</CODE> voorkomen. Om problemen te
voorkomen, moet <CODE>/etc/sendmail.cf</CODE> een symbolische link
zijn naar <CODE>/etc/mail/sendmail.cf</CODE>.
<P>De volgende bestanden zullen in <CODE>/etc/mail</CODE> worden geplaatst:
<UL>
<LI><CODE>aliases</CODE> - bevat extra lokale adressen</LI>
<LI><CODE>genericsdomain</CODE> - bevat wat informatie over de configuratie
van je lokale host</LI>
<LI><CODE>genericstable</CODE> - bevat de feitelijke rewriting regels.</LI>
<LI><CODE>sendmail.cf</CODE> - configuratiebestand van sendmail</LI>
<LI><CODE>sendmail.mc</CODE> - de bron van <CODE>sendmail.cf</CODE>.</LI>
</UL>
<P>Een aantal van deze bestanden zullen worden vergezeld door <CODE>.db</CODE> bestanden.
Deze bevatten hashed databases voor direct gebruik door sendmail.
<P>We gaan ervan uit dat het <CODE>cf</CODE> deel van sendmail's directorystructuur
onder een directory genaamd
<CODE>/usr/lib/sendmail.cf</CODE> voorkomt. Dit is het geval op
Debian GNU/Linux systemen.
Andere distributies plaatsen dit op verschillende lokaties. Raadpleeg
alsjeblieft de met je distributie meegeleverde documentatie voor details.
<H2><A NAME="s3">3. Sendmail configureren</A></H2>

<H2>3.1 Het hoofdconfiguratiebestand</H2>

<P>Sendmail maakt gebruik van een zeer complex regelsysteem voor z'n
configuratie. Ondanks dat je hier heel veel handige truuks mee uit kunt
halen, is het ongebruikelijk en het kost nogal wat tijd om een
<CODE>sendmail.cf</CODE> bestand vanaf begin af aan te schrijven. Als je hierin
bent ge&iuml;nteresseerd, zou je dit document nu niet verder moeten lezen,
maar in plaats daarvan het "Bat Book" van O'Reilly moeten lezen.
<P>In plaats van deze regels met de hand aan te gaan passen, zullen
we vertrouwen op de <CODE>m4</CODE> macro processor om ons configuratiebestand
vanuit kant-en-klare delen, die met sendmail worden gedistribueerd,
samen te stellen.
<P>Laten we eens kijken naar de eerste regels van het <CODE>sendmail.mc</CODE> bestand:
<P>
<HR>
<PRE>
include(/usr/lib/sendmail.cf/m4/cf.m4)
VERSIONID(`sendmail.mc - roessler@guug.de')
OSTYPE(debian)
define(`ALIAS_FILE',`/etc/mail/aliases')
</PRE>
<HR>
<P>Aan het begin is <CODE>cf.m4</CODE> ingesloten. Dit m4 macro
bestand bevat heel veel macrodefinities voor de rest van het bestand.
Zorg dat het pad dat je hier opgeeft correct is -
het pad dat we in ons voorbeeld weergeven is kenmerkend voor
Debian GNU/Linux. De <CODE>OSTYPE</CODE> macro wordt gebruikt om een aantal nuttige
standaardwaarden voor bepaalde configuratiewaarden te geven.
Als je geen Debian systeem gebruikt, zou je hier het woord "debian" door
"linux" moeten vervangen.
<CODE>ALIAS_FILE</CODE> vertelt sendmail waar het moet zoeken naar de lijst met
aliassen.
<P>De volgende regels vertellen sendmail gebruik te maken van
de <CODE>genericstable</CODE> feature, en waar het de benodigde configuratiebestanden
kan vinden:
<P>
<HR>
<PRE>
FEATURE(masquerade_envelope) FEATURE(genericstable, `hash
-o /etc/mail/genericstable')
GENERICS_DOMAIN_FILE(`/etc/mail/genericsdomain') 
</PRE>
<HR>
<P>De <CODE>masquerade_envelope</CODE> feature vertelt sendmail header rewriting
toe te passen op de <EM>envelope</EM> zender van een bericht. Dit is het mailadres
waarnaar externe mailbezorg subsystemen
hun foutverslagen met betrekking tot de bezorging van mail en 
waarschuwingsberichten zullen doorsturen.
De <CODE>generics*</CODE> bestanden zullen hierna worden uitgelegd.
<P>Nu moeten we een zogenoemde smart host defini&euml;ren, dat is een
computer die uitgaande mail voor je systeem afhandelt. Dit kan een
andere computer zijn dan je ISP's POP en IMAP-servers.
Neem contact op met de helpdesk als je twijfelt.
De code in het hoofdconfiguratiebestand:
<HR>
<PRE>
define(`SMART_HOST',`mail-out.je.provider')
</PRE>
<HR>

Vervang <EM>mail-out.je.provider</EM> alsjeblieft door de fully
qualified hostname van je internet service provider.
<P>De laatste twee regels bestaan uit de "mailer" definities
die sendmail nodig heeft om erachter te komen hoe diverse typen mail
moeten worden afgehandeld:
<HR>
<PRE>
MAILER(local)
MAILER(smtp)
</PRE>
<HR>
<P>Om een <CODE>sendmail.cf</CODE> bestand van dit
<CODE>sendmail.mc</CODE> bestand te genereren, typ je (als root) de volgende
opdrachten:
<HR>
<PRE>
# m4 sendmail.mc > _sendmail.cf
# mv -f _sendmail.cf sendmail.cf
</PRE>
<HR>

Let op de techniek waarbij <CODE>m4</CODE>'s uitvoer naar een tijdelijk bestand
wordt weggeschreven die daarna naar de juiste lokatie wordt verplaatst.
Dit helpt ons te voorkomen dat sendmail deels geschreven
configuratiebestanden inleest.
<H2>3.2 Adres rewriting</H2>

<P>Ten eerste moeten we aan sendmail opgeven welke adressen als
lokaal moeten worden aangemerkt (en dus zijn onderworpen aan rewriting). 
Dit is heel simpel: plaats gewoon de fully qualified hostname van
je computer in het bestand <CODE>/etc/mail/genericsdomain</CODE>.
Om achter de fully qualified name van je host te komen, typ je de
volgende opdracht:
<P>
<HR>
<PRE>
 $ hostname -f 
</PRE>
<HR>
<P>Laten we ons nu gaan bezig houden met de rewriting tabel:
<CODE>/etc/mail/genericstable</CODE>. Dit bestand bestaat uit
door twee spaties gescheiden kolommen. In de eerste kolom staat het
lokale adres, in de tweede kolom het email-adres dat daarvoor in de
plaats moet worden gebruikt.
Het bestand zou er ongeveer zo uit kunnen zien:
<P>
<HR>
<PRE>
harry   harryx@je.isp
maude   maudey@haar.isp
root    fredx@je.isp
news    fredx@je.isp
</PRE>
<HR>
<P>Voor <EM>iedere</EM> account op de lokale computer moet
&eacute;&eacute;n regel voorkomen, zodat automatisch gegenereerde mail
die het lokale systeem uitlekt, de correcte header informatie bevat.
<P>Om redenen van performance, maakt sendmail niet direkt gebruik van dit
tekstbestand, maar verwacht in plaats daarvan een "hashed" versie.
Typ de volgende opdracht om het te genereren:
<P>
<HR>
<PRE>
# makemap -r hash genericstable.db &lt; genericstable
</PRE>
<HR>
<P>
<P>De rewriting regels uit
<CODE>genericstable</CODE> zijn <EM>niet</EM> van toepassing op lokale mail of
berichten die je van buitenaf ontvangt - de indeling wordt alleen
gebruikt als een bericht je lokale systeem verlaat voor je 
ISP's smart host.
<H2>3.3 Aliassen</H2>

<P>Het aliassenbestad bevat aanvullende lokale namen die
alleen geldig zijn voor lokale berichten.
Dit is handig voor administratieve accounts zoals
<CODE>root</CODE> die automatisch gegenereerde berichten van je
systeem ontvangen.
<P>Een redelijk begin voor 
<CODE>/etc/mail/aliases</CODE> zou er als het volgende
bestand uit kunnen zien:
<P>
<HR>
<PRE>
root: fred
news: root
postmaster: root
mail: root
www: root

nobody: /dev/null
MAILER-DAEMON: nobody
</PRE>
<HR>
<P>Dit voorbeeld zal lokale mail voor de <CODE>root</CODE>,
<CODE>news</CODE>, <CODE>postmaster</CODE>, <CODE>mail</CODE>, en <CODE>www</CODE> gebruikers forwarden
naar <CODE>fred</CODE>, en de berichten voor <CODE>nobody</CODE> en
<CODE>MAILER-DAEMON</CODE> zullen worden doorgestuurd naar
<CODE>/dev/null</CODE>.
<P>Net als de <CODE>genericstable</CODE>, kunnen er in <CODE>aliases</CODE> heel veel
regels voorkomen. Dus wederom zou het niet effici&euml;nt voor sendmail
zijn als we het tekstbestand dat we juist hebben beschreven zouden gebruiken.
Hetzelfde mechanisme als voor <CODE>genericstable</CODE> wordt gebruikt voor
<CODE>aliases</CODE>: er wordt een "hashed" database gegenereerd.
In plaats van <CODE>makemap</CODE> direct te gebruiken, kun je deze keer de opdracht
<CODE>newaliases</CODE> typen. Het zal automatisch voor alles zorgdragen wat nodig
is.
<H2><A NAME="s4">4. Meer leesstof</A></H2>

<P>De sendmail source-distributie bevat heel wat documentatie.
Lees het, in het bijzonder het bestand <CODE>cf/README</CODE>.
<P>Als je ge&iuml;nteresseerd bent je in de configuratie-opties
van sendmail te verdiepen, koop dan het "Bat Book" van
O'Reilly: Bryan Costales, Eric Allman, en Neil Rickert:
"sendmail".  O'Reilly, 1993.
</BODY>
</HTML>
