<HTML
><HEAD
><TITLE
>Virtual Web mini-HOWTO</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"></HEAD
><BODY
CLASS="ARTICLE"
BACKGROUND="../IMAGES/back.gif"
LINK="#000099"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
></A
>Virtual Web mini-HOWTO</H1
><H3
CLASS="AUTHOR"
><A
NAME="AEN4"
>Dan Pancamo</A
></H3
><H3
CLASS="AUTHOR"
><A
NAME="AEN7"
>Parag Mehta</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
><TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:pm@gnuos.org"
>pm@gnuos.org</A
>&#62;</TT
></P
></DIV
></DIV
><H3
CLASS="AUTHOR"
><A
NAME="AEN13"
>Vertaald door: Ellen Bokhorst</A
></H3
><DIV
CLASS="REVHISTORY"
><TABLE
WIDTH="100%"
BORDER="0"
><TR
><TH
ALIGN="LEFT"
VALIGN="TOP"
COLSPAN="3"
><B
>Wijzigingen</B
></TH
></TR
><TR
><TD
ALIGN="LEFT"
>Herziening 1.1</TD
><TD
ALIGN="LEFT"
>2001-06-03</TD
><TD
ALIGN="LEFT"
></TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Nieuwe beheerder, geconverteerd naar DocBook (SGML), 
	gelicentieerd onder GFDL.</TD
></TR
><TR
><TD
ALIGN="LEFT"
>Herziening 1.0</TD
><TD
ALIGN="LEFT"
>1995-11-24</TD
><TD
ALIGN="LEFT"
></TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Initi&euml;le release.</TD
></TR
></TABLE
></DIV
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN29"
></A
><P
></P
><P
>In deze HOWTO wordt het opzetten van een Virtuele Web Site onder Linux
besproken.
      </P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Inhoudsopgave</B
></DT
><DT
><A
HREF="#LICENSE"
>Licentie</A
></DT
><DT
><A
HREF="#WHATIS"
>Wat is een Virtuele Web Site?</A
></DT
><DT
><A
HREF="#PATCHES"
>Welke software en softwarepatches heb ik nodig?</A
></DT
><DT
><A
HREF="#SETUP"
>Hoe stel ik het in?</A
></DT
><DT
><A
HREF="#LINKS"
>Links naar meer informatie over Virtueel Web</A
></DT
></DL
></DIV
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="LICENSE"
></A
>Licentie</H2
><P
>      Dit document is beschikbaar onder de
      <A
HREF="http://www.gnu.org/copyleft/fdl.html"
TARGET="_top"
><I
CLASS="CITETITLE"
>GNU Free Documentation License.</I
></A
>
    </P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="WHATIS"
></A
>Wat is een Virtuele Web Site?</H2
><P
>    Een World Wide Web (WWW) Server is normaal gesproken een enkele machine
    bestemd voor het verwerken van HTTP verzoeken voor een enkele WWW-site.
    Eenvoudig gesteld, &eacute;&eacute;n WWW-site per machine.
    Aangezien de computerbronnen voor het verwerken van httpd verzoeken
    voor de meeste WWW-sites laag zijn, blijft de meerderheid van 
    computerbronnen onbenut. Een virtuele WWW-site staat simpelweg meer 
    dan &eacute;&eacute;n
    WWW-site waarbij een enkele processor wordt gedeeld.
    In plaats van www.domain1.com en www.domain2.com waarvoor twee fysieke
    computerapparaten nodig zijn, kunnen www.domain1.com en www.domain2.com
    op een enkel computerapparaat worden gelokaliseerd en kunnen zijn algemene
    bronnen delen.
  </P
><P
>    Normaal gesproken hebben kleine computerfaciliteiten en 
    ondernemingen geen bronnen om een toegewezen webserver en Internet
    verbinding te onderhouden. De kosten hiervan beginnen bij
    $10K per setup, en maandelijks $500-2500 voor het onderhoud.
    Kleine computerfaciliteiten en ondernemingen kunnen nu
    WWW ruimte "huren" van virtuele WWW providers.
    De klant kan de WWW "pagina's" dan onderhouden via een lokale telnet
    en/of FTP-verbinding.
  </P
><P
>    WWW providers zoals InfoCom Networks http://www.infocom.net/
    leveren WWW ruimte voor slechts $75 per maand.  Dus de kosten om een WWW-site op te zetten
    zijn veelbetekenend lager dan voor het opzetten van een toegekende
    server en verbinding. De Virtuele Site heeft een belangrijk voordeel 
    boven andere WWW adresseringsschema's zoals 
    "www.jeprovider.com/~businessname".  De Virtuele WWW server als zodanig
    heeft de mogelijkheid naar een nieuwe lokatie te verhuizen of een
    toegewezen WWW server op te zetten zonder de adressen te wijzigen.
    Het wijzigen van WWW URL's kan resulteren in een aanzienlijk verlies
    aan verkeer op je site, en voor veel ondernemingen publicatie updates.
  </P
><P
>    Bij de meeste websites leveren www.domain1.com en www.domain2.com 
    afzonderlijke IP's op. De virtuele host moet verzoeken voor beide
    sites af kunnen handelen om meerdere verzoeken van een enkele host
    te kunnen accepteren. De methode die wordt gebruikt om dit probleem
    op te lossen wordt IP-aliasing genoemd. Door het gebruik van IP-aliasing
    kan een enkele host verzoeken voor meerdere IP's accepteren. De virtuele
    Web Server moet de mogelijkheid hebben aliassen voor een IP te 
    defini&euml;ren.
  </P
><P
>    IP-aliasing is slechts een deel van de virtuele oplossing. Het Domain
    Name System (DNS) moet ook worden geconfigureerd dat het zowel
    www.domain1.com als www.domain2.com kan omzetten. Als domain1.com en
    domain2.com nieuwe domeinen zijn, dan moeten beiden bij het Internic
    worden geregistreerd. Thans brengt Internic $50 per jaar in rekening
    voor het onderhouden van je domein.
  </P
><P
>    De meeste virtuele WWW-sites moeten ook in virtuele mail voorzien,
    of de mogelijkheid om alle mail door te sturen naar het virtuele
    domain naar een andere gebruiker of gebruikers.
  </P
><P
>    Virtuele FTP of de mogelijkheid FTP te gebruiken met de standaard
    hostnaam "ftp.domain1.com" zou ook kunnen zijn geconfigureerd door
    de WWW provider.
  </P
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="PATCHES"
></A
>Welke software en softwarepatches heb ik nodig?</H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="KERNEL"
></A
>Linux Kernel</H3
><P
>        Voor Linux versies 1.2.X zijn de IPalias patch alias-patch-1.2.1-v1
	en alias-net-tools.tar nodig. Ik ben er niet zeker van of 1.3.X
	deze patch nog ondersteunt. Zie voor meer informaite over de 
	IPalias ftp://ftp.mindspring.com/users/rsanders/ipalias/.
      </P
><P
>        In plaats van de IPalias oplossing wordt het gebruik van meerdere
	dummy interfaces geopperd. Ondanks dat de dummy oplossing wellicht
	wel zal werken, schijnt het niet zo zuiver te zijn als de
	IPalias oplossing.
        Zie voor meer informatie over het gebruik van Apache met de
	dummy oplossing de virtuele hosting informatie van Aram 
	Mirzadeh op http://www.qosina.com/apache/virtual.html.
      </P
><P
>        Het enige dat moet gebeuren om een alias volgens de IPalias methode
	toe te voegen is:
        &gt; /sbin/ifconfig eth0 alias www.domainX.com
      </P
><P
>        De IPalias oplossing wordt bovendien op verscheidene andere platforms
	ondersteund.
      </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="HTTP-PATCHES"
></A
>HTTP Servers</H3
><P
>        NCSA 1.5, Apache, en Spinner ondersteunen Virtuele hosting.
        http://hoohoo.ncsa.uiuc.edu/docs/Overview.html
        http://www.apache.org/
        http://spinner.infovav.se/
      </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="SETUP"
></A
>Hoe stel ik het in?</H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="NEW-ACCOUNT"
></A
>Maak het nieuwe account aan</H3
><P
>        Maak voor de virtuele klant een regulier Linux account aan
	met homedirectory en mail.
      </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="HTTP-SETUP"
></A
>NCSA 1.5 of Apache Config Files</H3
><P
>        Virtuele Host implementaties veranderen nog steeds. Er bestaan
	een paar patches om een Virtuele host te ondersteunen.
	Bekijk de release notes van de server voor meer details.
	NCSA 1.5 en Apache hebben nu Virtuele patches opgenomen en
	ik heb me laten vertellen dat Spinner ook virtuele hosts ondersteunt.
      </P
><P
>        Een virtuele patch ondersteunt de volgende srm.conf syntax,
	de tweede NCSA 1.5 methode echter voor het defini&euml;ren van
	een Virtuele host biedt meer flexibiliteit:
      </P
><P
>        <TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>SubDocumentRoot www.domain1.com /usr/local/etc/httpd/docs/domain1
SubDocumentRoot www.domain2.com /usr/local/etc/httpd/docs/domain2</PRE
></TD
></TR
></TABLE
>
      </P
><P
>        NCSA en Apache ondersteunen de volgende httpd.conf syntax:
      </P
><P
>        <TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>ServerAdmin webmaster@domain1.com
DocumentRoot /usr/local/etc/httpda/docs/domain1
ServerName www.domain1.com
ErrorLog logs/errors.domain1.com
TransferLog logs/access_log.domain1.com</PRE
></TD
></TR
></TABLE
>
      </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INTERFACE"
></A
>De interface configureren</H3
><P
>        Zodra de IPalias patches zijn ge&iuml;nstalleerd, voeg je het
	volgende toe aan het bestand /etc/rc.d/rc.local op je lokale
	webserver.
      </P
><P
>        <TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>/sbin/ifconfig eth0 alias www.domain1.com
/sbin/ifconfig eth0 alias www.domain2.com
/sbin/ifconfig eth0 alias www.domainN.com</PRE
></TD
></TR
></TABLE
>
      </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="INTERNIC"
></A
>Registratie bij Internic</H3
><P
>        Als je een nieuw domein opzet of het huidige domein wijzigt, dan
	moet je het domain registreren bij Internic. Het sjabloon is
	te vinden in ftp://rs.internic.net/templates/domain-template.txt
      </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="NAMED"
></A
>Named configureren</H3
><P
>        Named moet zo worden geconfigureerd dat je virtuele domain
	zichtbaar zal zijn voor de buitenwereld. Ik beweer geen expert
	te zijn als het gaat om DNS. Suggesties zijn altijd welkom.
      </P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="NAMED-EX-1"
></A
>Voorbeeld /etc/named.boot</H4
><P
>          <TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>directory /etc/named.data
primary           realdomain.com                  db.realdomain.com
primary           xxx.xxx.xxx.IN-ADDR.ARPA        db.xxx.xxx.xxx
primary           0.0.127.IN-ADDR.ARPA            db.local

primary           domain1.com                     db.domain1.com
primary           domain2.com                     db.domain2.com
cache             .                               named.root</PRE
></TD
></TR
></TABLE
>
        </P
><P
>          <DIV
CLASS="NOTE"
><P
></P
><TABLE
CLASS="NOTE"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="/IMAGES//note.gif"
HSPACE="5"
ALT="Opmerking"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Vervang x door je IP.
            </P
></TD
></TR
></TABLE
></DIV
>
        </P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="NAMED-EX-2"
></A
>Voorbeeld /etc/named.data/db.domain1.com</H4
><P
>          <TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>$ORIGIN com.
  domain1    IN      SOA     domain1.com. hostmaster.domain1.com. (
             10134 43200 3600 604800 86400 )
             IN      NS      ns1.realdomain.com.
             IN      MX      10 mail.realdomain.com.
             IN      MX      0 domain1.com.
domain1.com. IN      A       xxx.xxx.xxx.xxx    ;www.domain1.com IP

  $ORIGIN domain1.com.
  ftp        IN      CNAME   domain1.com.
  www        IN      CNAME   domain1.com.
  mail       IN      CNAME   domain1.com.</PRE
></TD
></TR
></TABLE
>
        </P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="NAMED-EX-3"
></A
>Voorbeeld /etc/named.data/db.xxx.xxx.xxx</H4
><P
>           Als het goed is, heb je reeds een db.xxx.xxx.xxx voor je huidige
	   site.
	   Werk het zo bij dat het de nieuwe virtuele domeinen bevat voor
	   reverse lookups.
        </P
><P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>xx              IN      PTR     www.domain1.com.
                xx              IN      PTR     www.domain2.com.</PRE
></TD
></TR
></TABLE
>
        </P
></DIV
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="NAMED-RESTART"
></A
>Herstart named</H4
><P
>          Zodra je klaar bent met het wijzigen van config bestanden, moet
	  je de daemon named herstarten.
        </P
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="MAIL"
></A
>Virtuele Mail</H3
><P
>        Je virtuele klanten zullen hoogstwaarschijnlijk de mogelijkheid
	willen dat mail gezonden naar hun domein wordt doorgestuurd naar
	een ander domein. Een paar wijzigingen in sendmail.cf zijn hiervoor
	nodig. Een paar maanden verschillende wijzigingen aan sendmail
	te hebben uitgeprobeerd, vond ik als eerste de volgende methode
	die werkt en waarvoor slechts &eacute;&eacute;n wijziging nodig
	is per virtuele site in sendmail.cf.
      </P
><DIV
CLASS="SECT3"
><HR><H4
CLASS="SECT3"
><A
NAME="SENDMAIL"
></A
>Sendmail Configuratie</H4
><P
></P
><OL
TYPE="1"
><LI
><P
>           Haal de huidige versie van sendmail op met makemap btree
	   ondersteuning.
            </P
></LI
><LI
><P
>            Maak een bestand aan met de naam /etc/domainalias met de volgende
	    indeling:
            </P
><P
>              <TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>*@domain1.com           localnet@realdomain.com
*@domain2.com           townplaz@realdomain.com
*@domainN.com           soracomp@realdomain.net

webmaster@domain1.com   somuser@anotherhost.com
jamison@domain2.com     anotheruser@somehost.com</PRE
></TD
></TR
></TABLE
>
            </P
></LI
><LI
><P
>              Maak een DB bestand aan
            </P
><P
>              <TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="SCREEN"
>makemap btree /etc/domainalias.db  &#60; /etc/domainalias</PRE
></TD
></TR
></TABLE
>
            </P
></LI
><LI
><P
>              /etc/sendmail.cf wijzigingen:
            </P
><P
></P
><OL
TYPE="a"
><LI
><P
>                  Voeg voor elke nieuwe virtuele host een Cw record toe
                </P
><P
>                  <TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>Cwdomain1.com
Cwdomain2.com</PRE
></TD
></TR
></TABLE
>
                </P
></LI
><LI
><P
>                  Voeg de domainalias mapping slechts eenmaal toe.
                </P
><P
>                  <TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>Kdomainalias btree /etc/domainalias.db</PRE
></TD
></TR
></TABLE
>
                </P
></LI
><LI
><P
>                  Toevoegen/wijzigen van Ruleset 98
                </P
><P
>                  <TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>###################################################################
###  Ruleset 98 -- local part of ruleset zero (can be null)     ###
###################################################################

S98

R$+ &#60; $+ . &#62;          $1 &#60; $2 &#62;                         remove trailing dots
R$+ &#60; $+ &#62;            $: &#60; &#62; $(domainalias $1$2 $)      match user@address
R&#60; &#62; $+ @ $*          $: &#60; $1 &#62; $(domainalias * @ $2 $) match *@address
R&#60; $+ &#62; * $*          $: &#60; &#62; $1 $2                      replace * with userid
R &#60; $+ &#62; $+           $: &#60; &#62; $2                         bugfix
R&#60; &#62; $*               $: $&#62;3 $1                         and rewrite using S3</PRE
></TD
></TR
></TABLE
>
                </P
></LI
></OL
></LI
><LI
><P
>              Sendmail testen
            </P
><P
>              Test de sendmailconfiguratie om de wijzigingen in sendmail.cf
	      te verifi&euml;ren
            </P
><P
>              <TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="90%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
>sendmail -v -bv info@domain1.com</PRE
></TD
></TR
></TABLE
>
            </P
><P
>              De uiteindelijke bestemming zou moeten worden weergegeven.
            </P
></LI
></OL
></DIV
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="FTP"
></A
>Virtuele FTP</H3
><P
>        Tot nu toe is het me niet gelukt om Virtuele FTP werkend te krijgen.
        Er bestaan een paar patches, en ik ben er zeker van dat er een
	werkende patch bestaat. We maken gewoon een werkdirectory
        /home/ftp/business/domain1 aan, maar een werkelijke Virtuele
	FTP zou fijn zijn.
      </P
><P
>        Als iemand een oplossing zou willen aandragen, dan zou ik meer
	dan gelukkig zijn het hier toe te voegen.
      </P
><P
>        Arnt Gulbrandsen heeft ftpd herschreven en er ondersteuning
	voor onafhankelijke FTP services in opgenomen.
        De Troll Tech FTP Daemon
      </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="LINKS"
></A
>Links naar meer informatie over Virtueel Web</H2
><P
><A
HREF="http://hoohoo.ncsa.uiuc.edu/docs/Overview.html"
TARGET="_top"
><I
CLASS="CITETITLE"
>http://hoohoo.ncsa.uiuc.edu/docs/Overview.html</I
></A
></P
><P
><A
HREF="http://www.apache.org/"
TARGET="_top"
><I
CLASS="CITETITLE"
>http://www.apache.org/</I
></A
></P
><P
><A
HREF="http://www.qosina.com/apache/virtual.html"
TARGET="_top"
><I
CLASS="CITETITLE"
>http://www.qosina.com/apache/virtual.html</I
></A
></P
><P
><A
HREF="http://spinner.infovav.se/"
TARGET="_top"
><I
CLASS="CITETITLE"
>http://spinner.infovav.se/</I
></A
></P
><P
><A
HREF="ftp://ftp.mindspring.com/users/rsanders/ipalias/"
TARGET="_top"
><I
CLASS="CITETITLE"
>ftp://ftp.mindspring.com/users/rsanders/ipalias/</I
></A
></P
><P
><A
HREF="http://www.thesphere.com/~dlp/TwoServers/"
TARGET="_top"
><I
CLASS="CITETITLE"
>http://www.thesphere.com/~dlp/TwoServers/</I
></A
></P
><P
><A
HREF="http://hoohoo.ncsa.uiuc.edu/docs/setup/httpd/VirtualHost.html"
TARGET="_top"
><I
CLASS="CITETITLE"
>http://hoohoo.ncsa.uiuc.edu/docs/setup/httpd/VirtualHost.html</I
></A
></P
><P
><A
HREF="ftp://ftp.dhp.com:/pub/linux/virtual-hosting"
TARGET="_top"
><I
CLASS="CITETITLE"
>ftp://ftp.dhp.com:/pub/linux/virtual-hosting</I
></A
></P
></DIV
></DIV
></BODY
></HTML
>