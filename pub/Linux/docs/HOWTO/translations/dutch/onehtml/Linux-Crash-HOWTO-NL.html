<HTML
><HEAD
><TITLE
>Linux Crash HOWTO</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"></HEAD
><BODY
CLASS="ARTICLE"
BACKGROUND="../IMAGES/back.gif"
LINK="#000099"
><DIV
CLASS="ARTICLE"
><DIV
CLASS="TITLEPAGE"
><H1
CLASS="TITLE"
><A
NAME="AEN2"
></A
>Linux Crash HOWTO</H1
><DIV
CLASS="AUTHORGROUP"
><A
NAME="AEN4"
></A
><H3
CLASS="AUTHOR"
><A
NAME="AEN5"
>Norman Patten</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
><TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:nepatten@us.ibm.com"
>nepatten@us.ibm.com</A
>&#62;</TT
></P
></DIV
></DIV
><H3
CLASS="AUTHOR"
><A
NAME="AEN11"
>Vertaald door: Ellen Bokhorst Bokhorst</A
></H3
><DIV
CLASS="AFFILIATION"
><DIV
CLASS="ADDRESS"
><P
CLASS="ADDRESS"
><TT
CLASS="EMAIL"
>&#60;<A
HREF="mailto:bokkie@nl.linux.org"
>bokkie@nl.linux.org</A
>&#62;</TT
></P
></DIV
></DIV
></DIV
><P
CLASS="PUBDATE"
>30-01-2002<BR></P
><DIV
CLASS="REVHISTORY"
><TABLE
WIDTH="100%"
BORDER="0"
><TR
><TH
ALIGN="LEFT"
VALIGN="TOP"
COLSPAN="3"
><B
>Wijzigingen</B
></TH
></TR
><TR
><TD
ALIGN="LEFT"
>Herziening 1.0</TD
><TD
ALIGN="LEFT"
>30-01-2002</TD
><TD
ALIGN="LEFT"
>Herzien door: NM</TD
></TR
><TR
><TD
ALIGN="LEFT"
COLSPAN="3"
>Initi&euml;le release.</TD
></TR
></TABLE
></DIV
><DIV
><DIV
CLASS="ABSTRACT"
><A
NAME="AEN18"
></A
><P
></P
><P
>In dit document wordt de installatie en het gebruik
    van het LKCD (Linux Kernel Crash Dump) package beschreven. </P
><P
></P
></DIV
></DIV
><HR></DIV
><DIV
CLASS="TOC"
><DL
><DT
><B
>Inhoudsopgave</B
></DT
><DT
><A
HREF="#INTRO"
>Introductie</A
></DT
><DT
><A
HREF="#HOWITWORKS"
>Hoe LKCD werkt</A
></DT
><DT
><A
HREF="#INSTALL"
>Installatie van lkcd</A
></DT
><DT
><A
HREF="#SETUP"
>Setup, test, en het uitvoeren van crash</A
></DT
></DL
></DIV
><DIV
CLASS="SECT1"
><H2
CLASS="SECT1"
><A
NAME="INTRO"
></A
>Introductie</H2
><P
>    Het <SPAN
CLASS="strong"
><B
CLASS="EMPHASIS"
>LKCD (Linux Kernel Crash Dump)</B
></SPAN
>
    project bestaat uit een set kernelpatches en utility's om kernelgeheugen
    te kunnen kopi&euml;ren om het op te slaan in geval van een kernel panic.
    Het opgeslagen kernelimage maakt onderzoek op de kernelpanic mogelijk
    met utility's die in het package zijn opgenomen. De meeste commerci&euml;le
    Unix besturingssystemen worden met vergelijkbare crash utility's
    geleverd, maar dit package is tamelijk nieuw voor Linux en het moet
    handmatig worden toegevoegd. Het LKCD utility is niet ontworpen
    voor het verzamelen van behulpzame informatie in geval van een
    door de hardware veroorzaakte panic of een segment violation.
    Het volledige LKCD package is beschikbaar voor download vanaf
    <A
HREF="http://lkcd.sourceforge.net/"
TARGET="_top"
>http://lkcd.sourceforge.net/</A
>.
    </P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="COPYRIGHT"
></A
>Copyright en licentie</H3
><P
>Dit document is auteursrechtelijk beschermd (c) 2002 door 
      Norman Patten. Het is toegestaan dit document te kopi&euml;ren,
      distribueren en/of aan te passen onder de voorwaarden
      van de GNU Free Documentation Licence, versie 1.1 of enige latere
      versie gepubliceerd door de Free Software Foundation;
      zonder Invariant secties, zonder Front-Cover
      teksten, en zonder Back-Cover teksten. Een kopie van de licentie is
      beschikbaar op <A
HREF="http://www.gnu.org/copyleft/fdl.html"
TARGET="_top"
>      http://www.gnu.org/copyleft/fdl.html</A
>. </P
><P
>Linux is een geregistreerd handelsmerk van Linus Torvalds .
      lkcd is gedistribueerd onder het copyright van Silicon Graphics Inc. </P
><P
>Stuur feedback naar
      <A
HREF="mailto:nepatten@us.ibm.com"
TARGET="_top"
><I
CLASS="CITETITLE"
>nepatten@us.ibm.com</I
></A
>.
      </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="HOWITWORKS"
></A
>Hoe LKCD werkt</H2
><P
>    Wanneer een kernel bepaalde fouten tegenkomt, roept het de
    &quot;panic&quot; functie aan wat resulteert in een onherstelbare
    fout. Deze panic geeft als resultaat dat LKCD een kerneldump initieert
    waarbij kernelgeheugen wordt gekopieerd naar een vooraf toegekend 
    dumpgebied. Het dump device wordt standaard als primair swap geconfigureerd.
    De kernel is nu niet volledig functioneel, maar er is
    voldoende functionaliteit over voor het kopi&euml;ren van het
    geheugen naar disk. Nadat dump het kopi&uml;ren van geheugen naar disk
    heeft voltooid, wordt het systeem opnieuw opgestart.
    Tijdens de nieuwe systeemstart
    controleert het op een nieuwe crash dump. Wanneer een
    nieuwe crash dump wordt aangetroffen, wordt het vanuit de dump lokatie
    gekopieerd naar het bestandssysteem
    standaard de &quot;<TT
CLASS="FILENAME"
>/var/log/dump</TT
>&quot; directory.
    Na het kopi&euml;ren van het image, gaat het systeem normaal verder 
    met het bootproces en kan onderzoek op een later tijdstip plaatsvinden.
    </P
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="WHATYOUNEED"
></A
>Wat je nodig hebt</H3
><P
>      Het bestand <TT
CLASS="FILENAME"
>lkcd-kernelxxx.diff</TT
> voor het
      patchen van de kernel. De ondersteunde kernelversie zal
      volgens vaste regel wijzigen.
      <TT
CLASS="FILENAME"
>lkcdutils-xx.src.rpm</TT
> - dit is de broncode
      van de utility's en de scripts die je nodig hebt om een crash
      in te stellen en te lezen. Op moment van schrijven
      is een rpm binary voor de i386'r beschikbaar vanaf
      <A
HREF="http://lkcd.sourceforge.net/"
TARGET="_top"
>lkcd.sourceforge.net</A
>, 
      maar je zult nog steeds de patches nodig hebben voor de opstartscripts
      vanuit de rpm broncode.
      </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="INSTALL"
></A
>Installatie van lkcd</H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="AEN51"
></A
>Installeren vanuit broncode</H3
><P
>      Haal het bestand <TT
CLASS="FILENAME"
>lkcdutils-xxx.src.rpm</TT
> op en
      installeer het met <B
CLASS="COMMAND"
>rpm -i kcdutils-xxx.src.rpm</B
> .
      Een bestand met de naam <TT
CLASS="FILENAME"
>lkcdutils-xxx.tar.gz</TT
> zal
      worden geplaatst in de directory
      <TT
CLASS="FILENAME"
>/usr/src/redhat/SOURCES</TT
>. Dit
      bestand is een gecomprimeerd tar image van de lkcd broncodestructuur.
      Pak de broncode uit in een directory naar keuzen zoals
      &quot;<TT
CLASS="FILENAME"
>/usr/src</TT
>&quot; met 
      <B
CLASS="COMMAND"
>tar -zxvf kcdutils-xxx.src.rpm</B
> . 
      Er zal nu een directory genaamd
      &quot;<TT
CLASS="FILENAME"
>kcdutils-xxx</TT
>&quot; worden aangemaakt
      met de broncode van de LKCD utility's.
      </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN61"
></A
>Bouwen en installeren van de LKCD utility's</H3
><P
>      LKCD gebruikte de standaard GCC compiler en make files. Voor
      het bouwen van de suite, cd je naar de LKCD src directory en
      start <B
CLASS="COMMAND"
>./configure</B
> om de configuratiebestanden
      te configureren. De volgende stap bestaat uit de uitvoering van
      <B
CLASS="COMMAND"
>make</B
> om de utility's te compileren
      en tenslotten uit het opstarten van <B
CLASS="COMMAND"
>make install</B
>
      om de utility's en de manpages te installeren.
      </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN67"
></A
>Wat wordt er ge&iuml;nstalleerd</H3
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>  /etc/sysconfig/dump             # Configuratiebestand voor dump
  /sbin/lcrash                    # Het crash utility
  /sbin/lkcd                      # Script om een crash te configureren en
                                  # op te slaan
  /sbin/lkcd_config               # Configuratie-utility voor dump
  /sbin/lkcd_ksyms                # Utility voor het reconstrueren van 
                                  # kernel symbolen 
  /usr/include/sial_api.h         # Header file voor de SIAL API
  /usr/lib/libsial.a              # Simple Image Access Language library
  /usr/man/man1/lcrash.1          # man page voor lcrash
  /usr/man/man1/lkcd_config.1     # man page voor lkcd_config
  /usr/man/man1/lkcd_ksyms.1      # man page voor lkcd_ksyms
  /usr/share/sial/lcrash/ps.sial  # ps opdracht implementatie van SIAL
      </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN70"
></A
>Installeren van de LKCD utility's vanuit een RPM</H3
><P
>      Je kunt voorgecompileerde utility's van rpm installeren met
      <B
CLASS="COMMAND"
>rpm -i kcdutils-xxx.rpm</B
> . Je zult nog steeds de
      kernel moeten patchen en de patches voor de opstartscripts moeten
      installeren. Je kunt echter het compileren van de utility's overslaan.
      </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN74"
></A
>Patchen van de kernel</H3
><P
>      De volgende stap bestaat uit het patchen en hercompileren van de kernel.
      Je zult de broncode van de kernel moeten patchen met het
      <TT
CLASS="FILENAME"
>lkcd-xxx.diff</TT
> bestand dat je downloadde vanaf
      <A
HREF="http://lkcd.sourceforge.net/"
TARGET="_top"
>http://lkcd.sourceforge.net/</A
>.
      Kopieer de patch naar dezelfde directory als je kernel en geef de opdracht
      <B
CLASS="COMMAND"
>patch -p0 &lt; lkcd-kernelxxx.diff</B
>. Zorg dat
      de patch dezelfde versie heeft als de kernel die je gaat patchen.
      Vervolgens zul je de kernel moeten configureren om de crash dump
      ondersteuning te activeren. Standaard is de crash ondersteuning uitgezet
      na toepassing van de patch. Als je <B
CLASS="COMMAND"
>make menuconfig</B
>
      of <B
CLASS="COMMAND"
>make xconfig</B
> gebruikt, is de optie
      &quot;LKCD support&quot; te vinden onder kernel hacking.
      Wellicht dat je ook nog andere
      kernelfeatures moet activeren die je nodig hebt. Zie de 
      <A
HREF="http://linuxdoc.org/HOWTO/Kernel-HOWTO.html"
TARGET="_top"
>Linux 
      Kernel HOWTO</A
> voor meer details. </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN83"
></A
>Compileer en installeer de kernel</H3
><P
>      De volgende stap bestaat uit het compileren en installeren van
      de met crash geactiveerde kernel. Start in onderstaande volgorde
      de volgende opdrachten op vanuit de directory met kernel bronbestanden.
      </P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
> 
  make depend 
  make install 
  make modules
  make modules_install
      </PRE
></TD
></TR
></TABLE
><P
>      Hiermee zal de nieuwe kernel worden gecompileerd en ge&iuml;nstalleerd.
      Je moet ook het bestand <TT
CLASS="FILENAME"
>Kerntypes</TT
> vanuit de
      directory met kernbroncode kopi&euml;ren naar de 
      <TT
CLASS="FILENAME"
>/boot</TT
> directory. Wellicht dat je ook
      nog het bestand <TT
CLASS="FILENAME"
>lilo.conf</TT
> moet wijzigen zodat er
      in wordt verwezen naar je nieuwe kernel. Zie
<A
HREF="http://linuxdoc.org/HOWTO/Kernel-HOWTO.html"
TARGET="_top"
>http://www.linuxdoc.org/HOWTO/Kernel-HOWTO.html</A
>
      voor meer informatie over het compileren en installeren van een kernel.
     </P
></DIV
></DIV
><DIV
CLASS="SECT1"
><HR><H2
CLASS="SECT1"
><A
NAME="SETUP"
></A
>Setup, test, en het uitvoeren van crash</H2
><DIV
CLASS="SECT2"
><H3
CLASS="SECT2"
><A
NAME="AEN94"
></A
>Instellen van crash dump</H3
><P
>      Om een core image te kunnen bewaren dat naar swap is geschreven,
      moet het image worden opgeslagen voordat de swap tijden het
      booten wordt gemount. Hiervoor moet het opstartbestand
      <TT
CLASS="FILENAME"
>sysinit</TT
> worden gewijzigd.
      In de broncode van lkcd is een
      <TT
CLASS="FILENAME"
>scripts</TT
> directory opgenomen waarin de patches
      staan voor diverse sysinit opstartscripts. Deze patches voegen de
      <B
CLASS="COMMAND"
>lkcd config</B
> en <B
CLASS="COMMAND"
>lkcd save</B
>
      opdrachten toe om crash dumps te activeren en een eventuele
      bestaande crash dump bij het opstarten op te slaan.
      </P
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN101"
></A
>Testen van crash</H3
><P
>      Om een panic te forceren zodat je de nieuwe crash setup kunt testen,
      compileer je de volgende code met
      <B
CLASS="COMMAND"
>cc -c -I/usr/src/linux/include panic.c</B
> . 
      Na het bouwen van de <TT
CLASS="FILENAME"
>panic.o</TT
> module geef je de
      opdracht <B
CLASS="COMMAND"
>insmod panic.o</B
> om een kernel panic
      te activeren.</P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>  ### panic.c ###########################

  #define __KERNEL__
  # MODULE 

  # include init_module(void)

  int init_module (void)
  {
      panic(" panic has been called");
      return 0;
  }
      </PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="SECT2"
><HR><H3
CLASS="SECT2"
><A
NAME="AEN108"
></A
>Uitvoeren van crash</H3
><P
>      Om je kernel core file te kunnen bekijken moet <B
CLASS="COMMAND"
>lcrash</B
> 
      worden aangeroepen met een paar parameters:
      </P
><TABLE
BORDER="1"
BGCOLOR="#d3dce3"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="SCREEN"
>  <B
CLASS="COMMAND"
>lcrash [ System.map file ] [ dump image ] [ Kerntypes ]</B
>

  Voorbeeld:

  <B
CLASS="COMMAND"
>lcrash /boot/System.map ./dump.1 /boot/Kerntypes</B
>
      </PRE
></TD
></TR
></TABLE
><P
>Het zal even duren eer het kernelimage in het geheugen is geladen
      en het je dropt in de crash shell. Achter de crash shellprompt kun je
      een <TT
CLASS="USERINPUT"
><B
>?</B
></TT
> intikken voor een overzicht met de 
      beschikbare opdrachten.</P
></DIV
></DIV
></DIV
></BODY
></HTML
>