<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.21">
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-2">

 <TITLE>DNS HOGYAN</TITLE>
</HEAD>
<BODY>
<H1>DNS HOGYAN</H1>

<H2>Nicolai Langfeldt (<CODE>dns-howto[at]langfeldt.net</CODE>), Jamie Norrish és mások</H2>v9.0, 2001.12.20
<HR>
<EM>HOGYAN legyünk rövid idõ alatt DNS-adminisztrátorok.</EM>
<HR>
<H2><A NAME="s1">1. Elõszó</A></H2>

<P>Kulcsszavak: DNS, BIND, BIND 4, BIND 8, BIND 9, named, dialup, PPP,
slip, ISDN, Internet, domain, name, resolution, hosts, caching.</P>

<P>Ez a dokumentum a Linux Dokumentációs Projekt része.</P>

<H2><A NAME="ss1.1">1.1 Szerzõi jog</A>
</H2>

<P>(C)opyright 1995-2001 Nicolai Langfeldt, Jamie Norrish &amp; Co. Ne
változtasd a szerzõi jogi rész helyesbítése nélkül, terjeszd szabadon, de
tartsd meg a szerzõi jogi megjegyzést.</P>

<H2><A NAME="ss1.2">1.2 Köszönetnyilvánítások és segítségkérés</A>
</H2>

<P>Meg szeretném köszönni mindenkinek, akit zavartam e HOGYAN olvasásával
(õk tudják), és az összes olvasónak, akik javaslataikat és megjegyzéseiket elküldték levélben.</P>

<P>Ez soha nem lesz egy végleges dokumentum; kérlek, küldj egy levelet
problémáidról és sikereidrõl. Ezzel jobbá teheted ezt a HOGYANt.
Kérlek, a megjegyzéseidet és/vagy kérdéseidet vagy a pénzt küldd
a janl@langfeldt.net &lt;janl@langfeldt.net&gt; címre. Vagy vedd meg a
DNS könyvemet (a címe "The Concise Guide to DNS and BIND", az
irodalomjegyzékben megtalálhatók az ISBN számok). Ha levelet küldesz, és
szeretnél választ rá, kérlek, mutass egy kis udvariasságot azzal, hogy
megbizonyosodsz róla, hogy a válaszcím helyes és mûködik. <B>Kérlek</B>,
olvasd el a 
<A HREF="#qanda">Kérdések és válaszok</A> fejezetet, mielõtt írsz
nekem. Egy másik dolog, hogy csak norvégül és angolul értek.</P>

<P>Ez egy HOGYAN. 1995 óta tartottam karban, az LDP részeként. 2000
folyamán megírtam egy könyvet hasonló tárggyal. Szeretném elmondani,
hogy bár ez a HOGYAN sok tekintetben olyan, mint egy könyv, ez <EM>nem</EM> a
letisztázott, piacra készített könyvváltozat. Ezen HOGYAN olvasói
segítettek annak felismerésében, hogy mi az, amit nehéz megérteni a DNS-rõl.
Ez segített a könyv megírásában, de a könyv szintén segített többet
gondolkodnom azon, hogy ennek a HOGYANnak mire van szüksége. A HOGYAN hozta
létre a könyvet. A könyv hozta létre e HOGYAN 3-as változatát. Köszönetem
a könyvkiadónak, Que-nak, aki adott egy esélyt :-)</P>

<H2><A NAME="ss1.3">1.3 Ajánlás</A>
</H2>

<P>Ajánlom ezt a HOGYANt Anne Line Norheim Langfeldt-nek. Bár õ valószínûleg
soha sem fogja elolvasni, mert nem az a fajta lány.</P>

<H2><A NAME="ss1.4">1.4 Frissített változatok</A>
</H2>

<P>Eme HOGYAN frissített változatait megtalálhatod a 
<A HREF="http://langfeldt.net/DNS-HOWTO/">http://langfeldt.net/DNS-HOWTO/</A>
és a 
<A HREF="http://www.tldp.org/">http://www.tldp.org/</A> oldalon is. Olvasd el azokat is, ha ez a dokumentum 9 hónapnál öregebb.</P>

<H2><A NAME="ss1.5">1.5 Magyar fordítás</A>
</H2>

<P>A magyar fordítást 
<A HREF="mailto:zfuri@avaya.com_NO_SPAM">Füri Zoltán</A> készítette (2003.05.06).
A lektorálást 
<A HREF="mailto:laca@janus.gimsz.sulinet.hu_NO_SPAM">Szíjjártó László</A> végezte el (2003.07.01).
Bármilyen fordítással kapcsolatos észrevételt a 
<A HREF="mailto:linuxhowto@sch.bme.hu_NO_SPAM">linuxhowto@sch.bme.hu</A> címre küldjetek.
Eme dokumentum legfrissebb változata megtalálható a 
<A HREF="http://tldp.fsf.hu/index.html">Magyar Linux Dokumentációs Projekt</A> honlapján.</P>

<H2><A NAME="intro"></A> <A NAME="s2">2. Bevezetés</A></H2>

<P><B>Mi ez, és mi nem</B></P>

<P>A DNS a Domain Name Server (Domain Név Szerver). A DNS átalakítja a gépneveket IP címekké,
amellyel minden hálózati gép rendelkezik. A nevet címmé, és a címet
névvé fordítja (vagy "mappeli", ahogy a zsargon hívja), és még egyéb
feladatokat is ellát. Ez a HOGYAN azt dokumentálja, hogyan definiáljunk
ilyen megfeleltetéseket Unix rendszer használatával, pár
Linux-specifikus dologgal együtt.</P>

<P>A mappelés egy egyszerû megfeleltetés két dolog között, ez esetben egy
gépnév, például <CODE>/ftp.linux.org/</CODE>, és a gép IP száma (vagy címe), 1<CODE>99.249.150.4</CODE> között.
A DNS szintúgy tartalmazza a másik irányú megfeleltetést is
IP számból gépnévvé; ennek neve "fordított megfeleltetés" (reverse mapping).</P>

<P>A DNS, a beavatatlanok számára (ez vagy te ;-), a hálózati
adminisztráció egyik legködösebb területe. Szerencsére a DNS valójában
nem ilyen nehéz. Ez a HOGYAN megpróbál egy pár dolgot világosabbá tenni.
Leírja egy <EM>egyszerû</EM> DNS névszerver felállítását, kezdve egy csak
gyorsítótáras szerverrel, és folytatva egy tartomány számára egy
elsõdleges DNS szerver felállításával. Bonyolultabb beállításokhoz
átnézheted ezen dokumentum 
<A HREF="#qanda">Kérdések és válaszok</A> fejezetét. Ha
az nincs leírva ott, el kell <EM>olvasnod</EM> a Valódi Dokumentációt. Az
<A HREF="#bigger">utolsó fejezetben</A> visszatérek rá, mit is
tartalmaz ez a Valódi Dokumentáció.</P>

<P>Mielõtt belekezdesz, be kell állítanod a gépedet, hogy be tudj rá, és ki
tudj róla telnetelni, és sikerüljön mindenféle hálózati kapcsolatokat
létrehozni, valamint különösen fontos, hogy képes legyél a <CODE>telnet 127.0.0.1</CODE>
parancsot kiadni, és a saját gépedet elérni (próbáld ki most!).
Kiindulásként szükséged lesz még jó, mûködõ <CODE>/etc/nsswitch.conf/</CODE>,
<CODE>/etc/resolv.conf/</CODE> és <CODE>/etc/hosts/</CODE> állományokra is, bár funkciójukat nem
fogom itt elmagyarázni. Ha még nincs mindez beállítva és nem mûködik, a
Networking-HOWTO (Hálózatok-HOGYAN) és/vagy a Networking-Overview-HOWTO
(Hálózatok-Áttekintés-HOGYAN) elmagyarázza,
hogyan kell ezeket beállítani. Olvasd el õket.</P>

<P>Amikor azt mondom "a te géped", arra a gépre gondolok, amelyiken a DNS-t
próbálod beállítani, és nem akármelyik másik gépet, amely a hálózati
környezetedben megtalálható.</P>

<P>Feltételezem, hogy nem vagy olyan tûzfal mögött, amely blokkolja a
névlekérdezéseket. Ha mégis, különleges beállításokra lesz szükséged -
lásd a 
<A HREF="#qanda">Kérdések és válaszok</A> fejezetet.</P>

<P>A névszolgáltatást UNIX alatt a <CODE>named</CODE> program végzi. Ez része a "BIND"
csomagnak, mely fejlesztését a <EM>The Internet Software Consortium</EM> koordinálja. A
<CODE>named</CODE> programot tartalmazza a legtöbb Linux disztribúció, és általában
<CODE>/usr/sbin/named</CODE> programként van telepítve, a csomag készítõjének
hóbortjától függõ kis- vagy nagybetûs <CODE>BIND</CODE> csomagból.</P>

<P>Ha van egy named programod, valószínûleg használhatod; ha nincs,
beszerezhetsz egyet a Linux ftp oldalról, vagy letöltheted a legutolsó
és legnagyszerûbb forráskódot az 
<A HREF="ftp://ftp.isc.org/isc/bind9/">ftp://ftp.isc.org/isc/bind9/</A> webhelyrõl.
Ez a HOGYAN a 9-es verziójú BIND-rõl szól. A HOGYAN régebbi változatai, a
4-es és 8-as verziójú BIND-rõl, még mindig elérhetõk a
<A HREF="http://langfeldt.net/DNS-HOWTO/">http://langfeldt.net/DNS-HOWTO/</A> honlapon, abban az esetben, ha 4-es vagy
8-as verziójú BIND-et használsz (mellékesen, ezt a HOGYANt is
megtalálhatod ott). Ha a named kézikönyv oldala (man page) a <CODE>named.conf</CODE> állományról beszél (a
legeslegvégén, a FILES (ÁLLOMÁNYOK) fejezetben), 8-as BIND-ed van; ha
<CODE>named.boot</CODE> állományról van szó, 4-es BIND-ed van. Ha 4-esed van, és tudatosan
a biztonságra törekszel, tényleg frissítened kell a 8-as BIND
legfrissebb változatára. Most.</P>

<P>A DNS egy hálózati szintû adatbázis. Vigyázz, mit raksz bele. Ha
szemetet raksz bele, te és mások is szemetet fognak kinyerni belõle.
Tartsd DNS-ed rendben és konzisztensen, és egy jó szolgáltatást fogsz
kapni. Tanuld meg használni, adminisztrálni, megkeresni hibáit, és egy
újabb jó rendszergazda leszel, aki megvédi a hálózatot attól, hogy "megfeküdjön" a félremenedzselés miatt.</P>

<P><B>Tipp:</B> Készíts biztonsági másolatot az összes állományról, amelynek
megváltoztatására utasítalak, ha már megvannak, így ha esetleg semmi sem
mûködik, visszajuthatsz a régi, mûködõ állapotba.</P>

<H2><A NAME="ss2.1">2.1 Más névszerver megvalósítások</A>
</H2>

<P>Ezt a fejezetet Joost van Baal írta.</P>

<P>Különbözõ csomagok léteznek DNS szerver telepítéshez a gépedre. Van a
BIND csomag (
<A HREF="http://www.isc.org/products/BIND/">http://www.isc.org/products/BIND/</A>); a megvalósítás, amirõl
ez a HOGYAN szól. Ez a legnépszerûbb névszerver mindenfelé, és szerte az
Interneten a névszolgáltató gépeinek döntõ többségén ezt használják, és
az 1980-as évek óta fejlesztik. A BSD licenc feltételei szerint használható. Mivel ez
a legnépszerûbb programcsomag, egy csomó dokumentáció és tudásanyag
található a BIND-rõl mindenfelé. Azonban biztonsági problémák voltak
vele.</P>

<P>Aztán van a djbdns (
<A HREF="http://djbdns.org/">http://djbdns.org/</A>), egy viszonylag új DNS csomag, amelyet Daniel J. Bernstein készített, aki a qmail programot is írta. Ez egy nagyon
moduláris készlet: különbözõ kis programok gondoskodnak a különbözõ
feladatokról, amit egy névszervernek kezelnie kell. A biztonság
szempontjának figyelembe vételével tervezték. Egy egyszerûbb
zóna-állomány formátumot használ, és általánosságban egyszerûbb
beállítani. Azonban, mivel kevésbé ismert, a helyi guru nem biztos, hogy
segíthet vele kapcsolatban. Sajnos ez a szoftver nem nyílt forráskódú. A
szerzõ hirdetése a 
<A HREF="http://cr.yp.to/djbdns/ad.html">http://cr.yp.to/djbdns/ad.html</A> honlapon található.</P>

<P>Hogy DJB szoftvere tényleg fejlõdés-e a régi alternatívákkal szemben,
sok vita tárgyát képezi. Az ISC csapata otthont ad egy beszélgetésnek
(vagy inkább anyázásnak?) a BIND kontra djbdns-rõl a
<A HREF="http://www.isc.org/ml-archives/bind-users/2000/08/msg01075.html">http://www.isc.org/ml-archives/bind-users/2000/08/msg01075.html</A> honlapon.</P>

<H2><A NAME="caching"></A> <A NAME="s3">3. A feloldó, gyorsítótáras névszerver</A></H2>

<P><B>Az elsõ ugrás a DNS beállításhoz. Nagyon hasznos betárcsázós,
kábel-modemes, ADSL és hasonló felhasználók számára.</B></P>

<P>A Red Hat és a Red Hat-hoz kapcsolódó disztribúciók esetén ezen HOGYAN
elsõ fejezetéhez hasonló gyakorlati eredmény érhetõ el a <CODE>bind</CODE>,
<CODE>bind-utils</CODE> és <CODE>caching-nameserver</CODE> csomagok telepítésével. Ha Debiant
használsz, egyszerûen csak telepítsd a <CODE>bind</CODE> (vagy a <CODE>bind9</CODE> csomagot, mivel
jelenleg a BIND 9-est nem támogatja a Debian Stable (potato)) és a
<CODE>bind-doc</CODE> csomagot. Persze csak ezen csomagok telepítésével nem tanulsz annyit,
mint e HOGYAN olvasásával. Szóval telepítsd a csomagokat, azután
olvass tovább, és ellenõrizd az általuk telepített állományokat.</P>

<P>A gyorsítótáras névszerver megtalálja a választ a névlekérdezésekre, és
megjegyzi a választ a legközelebbi alkalomig, amikor szükséged lesz rá.
Ez jelentõsen le fogja rövidíteni a várakozási idõt a következõ
alkalommal, különösen ha lassú a kapcsolatod.</P>

<P>Elõször szükséged lesz egy <CODE>/etc/named.conf</CODE> nevû állományra (Debianban:
<CODE>/etc/bind/named.conf</CODE>). Ez betöltõdik amikor a named elindul. Egyelõre
csak ezt kell tartalmaznia:</P>
<P>
<HR>
<PRE>
// Konfigurációs állomány kizárólag gyorsítótáras névszerver számára
//
// A HOGYAN ezen változata tartalmazhat a sor elején szóközöket
// tartalmazó sorokat ebben és más állományokban. El kell távolítanod
// a szóközöket, hogy bizonyos dolgok mûködjenek.
//
// Figyelem, az állománynevek és a könyvtárak nevei különbözhetnek, ám
// a lényegi tartalmuknak hasonlónak kell lenniük.

options {
        directory "/var/named";
        // E sor engedélyezése segíthet, ha tûzfalon keresztül kell
        // átmenned, és a dolog nem mûködik. De valószínûleg beszélned
        // kell a tûzfal adminisztrátorával.
        // query-source port 53;
};

controls {
        inet 127.0.0.1 allow { localhost; } keys { rndc_key; };
};

key "rndc_key" {
        algorithm hmac-md5;
        secret "c3Ryb25nIGVub3VnaCBmb3IgYSBtYW4gYnV0IG1hZGUgZm9yIGEgd29tYW4K";
};

zone "." {
        type hint;
        file "root.hints";
};

zone "0.0.127.in-addr.arpa" {
        type master;
        file "pz/127.0.0";
};
</PRE>
<HR>
</P>

<P>A Linux disztribúciós csomagok eltérõ állományneveket használhatnak
minden egyes, itt említett állománytípusra; azonban közel ugyanazt
fogják tartalmazni.</P>

<P>A "<CODE>directory</CODE>" sor megmondja a named programnak, hol keresse az állományokat.
Minden ezután megnevezett állomány ehhez lesz viszonyítva. Tehát a <CODE>pz</CODE>
egy könyvtár a <CODE>/var/named</CODE> alatt, azaz megegyezik a <CODE>/var/named/pz</CODE> könyvtárral. A
<CODE>/var/named</CODE> a helyes könyvtár, a <EM>Linux Fájlrendszer Szabvány</EM> alapján.</P>

<P>A <CODE>/var/named/root.hints</CODE> állomány is megemlítõdik benne. A
<CODE>/var/named/root.hints</CODE> állománynak ezt kell tartalmaznia:</P>
<P>
<HR>
<PRE>

;
; Nyitó megjegyzések lehetnek itt, ha már megvan ez az állományod.
; Ha nem, ne aggódj.
;
; A kezdõ szóközökrõl a sorok elején: távolítsd el õket!
; A sornak egy ;-vel, .-tal vagy betûvel kell kezdõdniük, nem szóközzel.
;
.                       6D  IN      NS      A.ROOT-SERVERS.NET.
.                       6D  IN      NS      B.ROOT-SERVERS.NET.
.                       6D  IN      NS      C.ROOT-SERVERS.NET.
.                       6D  IN      NS      D.ROOT-SERVERS.NET.
.                       6D  IN      NS      E.ROOT-SERVERS.NET.
.                       6D  IN      NS      F.ROOT-SERVERS.NET.
.                       6D  IN      NS      G.ROOT-SERVERS.NET.
.                       6D  IN      NS      H.ROOT-SERVERS.NET.
.                       6D  IN      NS      I.ROOT-SERVERS.NET.
.                       6D  IN      NS      J.ROOT-SERVERS.NET.
.                       6D  IN      NS      K.ROOT-SERVERS.NET.
.                       6D  IN      NS      L.ROOT-SERVERS.NET.
.                       6D  IN      NS      M.ROOT-SERVERS.NET.
A.ROOT-SERVERS.NET.     6D  IN      A       198.41.0.4
B.ROOT-SERVERS.NET.     6D  IN      A       128.9.0.107
C.ROOT-SERVERS.NET.     6D  IN      A       192.33.4.12
D.ROOT-SERVERS.NET.     6D  IN      A       128.8.10.90
E.ROOT-SERVERS.NET.     6D  IN      A       192.203.230.10
F.ROOT-SERVERS.NET.     6D  IN      A       192.5.5.241
G.ROOT-SERVERS.NET.     6D  IN      A       192.112.36.4
H.ROOT-SERVERS.NET.     6D  IN      A       128.63.2.53
I.ROOT-SERVERS.NET.     6D  IN      A       192.36.148.17
J.ROOT-SERVERS.NET.     6D  IN      A       198.41.0.10
K.ROOT-SERVERS.NET.     6D  IN      A       193.0.14.129
L.ROOT-SERVERS.NET.     6D  IN      A       198.32.64.12
M.ROOT-SERVERS.NET.     6D  IN      A       202.12.27.33
</PRE>
<HR>
</P>

<P>Ez az állomány írja le a fõ névszervereket a világban. A szerverek
idõrõl idõre változnak, és frissíteni kell õket most és késõbb is. A 
<A HREF="#maint">Karbantartás</A> fejezetben olvashatsz ezek naprakészen tartásáról.</P>

<P>A következõ rész a <CODE>named.conf</CODE> állományban a <CODE>zone</CODE> (zóna). Használatát
egy késõbbi fejezetben fogom elmagyarázni; most csak nevezzük el ezt az
állományt <CODE>127.0.0</CODE>-nak a <CODE>pz</CODE> alkönyvtárban. <EM>(Újfent, kérlek távolítsd el
a sor eleji szóközöket, ha kivágod és beilleszted ezt.)</EM>
<HR>
<PRE>

$TTL 3D
@               IN      SOA     ns.linux.bogus. hostmaster.linux.bogus. (
                                1       ; Serial
                                8H      ; Refresh
                                2H      ; Retry
                                4W      ; Expire
                                1D)     ; Minimum TTL
                        NS      ns.linux.bogus.
1                       PTR     localhost.
</PRE>
<HR>
</P>

<P>A <CODE>key</CODE> és a <CODE>control</CODE> részek azt határozzák meg, hogy a named programod
távolról irányítható az <CODE>rndc</CODE> programmal ha egy helyi állomásról
kapcsolódik, ekkor egy kódolt titkos kulccsal azonosítja magát. Ez a kulcs
olyan, mint egy jelszó. Az rndc mûködéséhez az <CODE>/etc/rndc.conf</CODE> állománynak meg
kell egyeznie ezzel:</P>
<P>
<HR>
<PRE>
key rndc_key {
    algorithm "hmac-md5";
    secret "c3Ryb25nIGVub3VnaCBmb3IgYSBtYW4gYnV0IG1hZGUgZm9yIGEgd29tYW4K";
};

options {
    default-server localhost;
    default-key    rndc_key;
};
</PRE>
<HR>
</P>

<P>Amint látod, a secret bejegyzések megegyeznek. Ha az <CODE>rndc</CODE> programot egy másik géprõl
szeretnéd használni, a két gép egymáshoz viszonyított rendszeridejének 5 percen belül kell
lennie. Ehhez ajánlom az ntp (<CODE>xntpd</CODE> és <CODE>ntpdate</CODE>) szoftvert.</P>

<P>És most, szükséged lesz egy ehhez hasonló <CODE>/etc/resolv.conf</CODE> állományra: <EM>(Újfent:
Távolítsd el a szóközöket!)</EM></P>
<P>
<HR>
<PRE>
search altartomány.a-te-tartományod.edu a-te-tartományod.edu
nameserver 127.0.0.1
</PRE>
<HR>
</P>

<P>A "<CODE>search</CODE>" sor határozza meg, milyen tartományban történjen a keresés az
állomások után, amelyekhez kapcsolódni akarsz. A "<CODE>nameserver</CODE>" sor
határozza meg a névszervered címét, ebben az esetben a saját gépedet,
mert ez az, ahol a named programod fut (a 127.0.0.1 cím helyes, nem számít, ha
a gépednek van egy másik címe is). Ha több névszervert akarsz
felsorolni, rakd mindegyiket egy-egy "<CODE>nameserver</CODE>" sorba. (Megjegyzés: A
named soha nem olvassa el ezt az állományt, a named programot használó feloldó
teszi ezt. Megjegyzés 2: Néhány resolv.conf állományban a
"domain" sort találod. Ez helyes, de ne használd a "search" és a
"domain" kulcsszót is egyszerre, csak az egyikük fog mûködni.)</P>

<P>Annak bemutatására, hogy ez az állomány mit csinál: Ha az ügyfél
megpróbálja kikeresni a <CODE>foo</CODE>-t, akkor a
<CODE>foo.altartomány.a-te-tartományod.edu</CODE>-t próbálja elõször, majd a
<CODE>foo.a-te-tartományod.edu</CODE>-t, és végül a <CODE>foo</CODE>-t. Ne akarj túl sok
tartományt rakni a keresõsorba, mivel mindet végigkeresni idõt vesz igénybe.</P>

<P>A példa feltételezi, hogy az <CODE>altartomány.a-te-tartományod.edu</CODE> tartományba
tartozol. A keresõsornak nem szabad tartalmaznia a legfelsõ
tartományodat (TLD - Top Level Domain), ebben az esetben az "<CODE>edu</CODE>"-t. Ha
gyakran kell kapcsolódnod másik tartományban levõ állomásokhoz,
hozzáadhatod azt a tartományt a keresõsorhoz, így: <EM>(Ne felejtsd el
eltávolítani a szóközöket a sor elején, ha vannak)</EM></P>
<P>
<HR>
<PRE>
search altartomány.a-te-tartományod.edu a-te-tartományod.edu másik-tartomány.com
</PRE>
<HR>
</P>
<P>és így tovább. Nyilvánvalóan valódi tartományneveket kell helyettük
beraknod. Kérlek figyeld meg a tartománynevek végén a pontok hiányát. 
Ez fontos!</P>

<H2><A NAME="starting"></A> <A NAME="ss3.1">3.1 A named indítása</A>
</H2>

<P>Mindezek után itt az idõ a named indítására. Ha betárcsázós kapcsolatot
használsz, elõször csatlakozz. Most indítsd a named-et, vagy a boot
szkript futtatásával: <CODE>/etc/init.d/named start</CODE>, vagy a named-et
közvetlenül: <CODE>/usr/sbin/named</CODE>. Ha kipróbáltad a BIND elõzõ verzióit,
valószínûleg az ndc-t használtad. A BIND 9-ben ezt az <CODE>rndc</CODE> program váltotta fel,
ami távolról vezérelheti a named-et, de már nem tudja a named-et
indítani. Ha megnézed a rendszerüzenetek naplóállományát (általában
<CODE>/var/log/messages</CODE>, a Debianban <CODE>/var/log/daemon</CODE>, meg lehet még keresni a
<CODE>/var/log</CODE> egy másik állományában is), mialatt indítod a named-et (ezt a
<CODE>tail -f /var/log/messages</CODE>-el teheted meg), valami ilyesmit kell látnod:</P>

<P>(a \-el végzõdõ sorok a következõ sorban folytatódnak)</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
Dec 23 02:21:12 lookfar named[11031]: starting BIND 9.1.3
Dec 23 02:21:12 lookfar named[11031]: using 1 CPU
Dec 23 02:21:12 lookfar named[11034]: loading configuration from \
    '/etc/named.conf'
Dec 23 02:21:12 lookfar named[11034]: the default for the \
    'auth-nxdomain' option is now 'no'
Dec 23 02:21:12 lookfar named[11034]: no IPv6 interfaces found
Dec 23 02:21:12 lookfar named[11034]: listening on IPv4 interface lo, \
    127.0.0.1#53
Dec 23 02:21:12 lookfar named[11034]: listening on IPv4 interface eth0, \
    10.0.0.129#53
Dec 23 02:21:12 lookfar named[11034]: command channel listening on \
    127.0.0.1#953
Dec 23 02:21:13 lookfar named[11034]: running
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Ha bármilyen hibaüzenet megjelenik, akkor ott hiba van. A named
megnevezi az állományt, amit épp olvas. Menj vissza, és ellenõrizd le az
állományt. Indítsd újból a named-et, ha megjavítottad.</P>

<P>Most letesztelheted a beállításodat. Hagyományosan az <CODE>nslookup</CODE>
használatos erre. Napjainkban azonban már a <CODE>dig</CODE> ajánlott:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
$ dig -x 127.0.0.1
;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 26669
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 0

;; QUESTION SECTION:
;1.0.0.127.in-addr.arpa.                IN      PTR

;; ANSWER SECTION:
1.0.0.127.in-addr.arpa. 259200  IN      PTR     localhost.

;; AUTHORITY SECTION:
0.0.127.in-addr.arpa.   259200  IN      NS      ns.linux.bogus.

;; Query time: 3 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Sun Dec 23 02:26:17 2001
;; MSG SIZE  rcvd: 91
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Ha ilyen üzeneteket kaptál, akkor mûködik. Reméljük. Ha bármi teljesen eltérõt kapsz,
menj vissza, és ellenõrizz le mindent. Minden alkalommal, amikor
megváltoztatsz egy állományt, futtasd az <CODE>rndc reload</CODE> parancsot.</P>

<P>Most már beadhatsz egy lekérdezést. Próbálj meg valami hozzád közeli
gépet. A <CODE>pat.uio.no</CODE> közel van hozzám, az Oslói Egyetemen:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
$ dig pat.uio.no
; &lt;&lt;>> DiG 9.1.3 &lt;&lt;>> pat.uio.no
;; global options:  printcmd
;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 15574
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 3, ADDITIONAL: 0

;; QUESTION SECTION:
;pat.uio.no.                    IN      A

;; ANSWER SECTION:
pat.uio.no.             86400   IN      A       129.240.130.16

;; AUTHORITY SECTION:
uio.no.                 86400   IN      NS      nissen.uio.no.
uio.no.                 86400   IN      NS      nn.uninett.no.
uio.no.                 86400   IN      NS      ifi.uio.no.

;; Query time: 651 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Sun Dec 23 02:28:35 2001
;; MSG SIZE  rcvd: 108
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Ezúttal a <CODE>dig</CODE> megkérte a named-et, hogy keresse meg a <CODE>pat.uio.no</CODE>
gépet. Az pedig kapcsolódott a <CODE>root.hints</CODE> állományodban levõ
egyik névszerver géphez, és lekérdezte az útvonalát onnan. Eltarthat egy
röpke pillanatig, míg megkapod az eredményt, mivel végig kell keresnie
az összes tartományt, amit a <CODE>/etc/resolv.conf</CODE>-ban megneveztél.</P>

<P>Ha még egyszer lekérdezed ugyanazt, ezt kapod:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
$ dig pat.uio.no

; &lt;&lt;>> DiG 8.2 &lt;&lt;>> pat.uio.no
;; res options: init recurs defnam dnsrch
;; got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 4
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 3, ADDITIONAL: 3
;; QUERY SECTION:
;;      pat.uio.no, type = A, class = IN

;; ANSWER SECTION:
pat.uio.no.             23h59m58s IN A  129.240.130.16

;; AUTHORITY SECTION:
UIO.NO.                 23h59m58s IN NS  nissen.UIO.NO.
UIO.NO.                 23h59m58s IN NS  ifi.UIO.NO.
UIO.NO.                 23h59m58s IN NS  nn.uninett.NO.

;; ADDITIONAL SECTION:
nissen.UIO.NO.          23h59m58s IN A  129.240.2.3
ifi.UIO.NO.             1d23h59m58s IN A  129.240.64.2
nn.uninett.NO.          1d23h59m58s IN A  158.38.0.181

;; Total query time: 4 msec
;; FROM: lookfar to SERVER: default -- 127.0.0.1
;; WHEN: Sat Dec 16 00:23:09 2000
;; MSG SIZE  sent: 28  rcvd: 162
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Ahogy azt nyilvánvalóan láthatod, ezúttal ez sokkal gyorsabb volt, 4 ms
a korábbi több, mint fél másodperccel ellentétben. A válasz benne volt
a gyorsítótárban. A gyorsítótárban lévõ eredményeknél esély van arra, hogy 
már elavult, de az eredeti szerverek befolyásolhatják azt az idõt,
amíg a letárolt válaszok érvényesként lesznek nyilvántartva. Végül is nagy a valószínûség arra,
hogy a kapott válasz <EM>érvényes</EM>.</P>

<H2><A NAME="ss3.2">3.2 Névfeloldás</A>
</H2>

<P>Minden operációs rendszer, ami a C API szabványt alkalmazza, rendelkezik
a gethostbyname és a gethostbyaddr hívásokkal. Ezek különbözõ
forrásokból szerezhetik be az információt. Hogy melyik forrásból szerzik
ezt be, az Linux (és egyes Unix) rendszereken az <CODE>/etc/nsswitch.conf</CODE> állományban van
beállítva. Ez egy hosszú állomány, amely megadja mely állományokból
vagy adatbázisokból szerezhetõk be különbözõ adattípusok. Általában
hasznos megjegyzéseket tartalmaz a fejlécében, melyeket körültekintõen
olvass el. Ezután keresd meg a "<CODE>hosts:</CODE>" kulcsszóval kezdõdõ sort; így kell kinéznie:</P>
<P>
<HR>
<PRE>
hosts:      files dns
</PRE>
<HR>
</P>
<P>(<EM>Emlékszel még a szóközökre a sor elején? Nem akarom újra megemlíteni.</EM>)</P>

<P>Ha nincs "<CODE>hosts:</CODE>" kulcsszóval kezdõdõ sor, szúrd be a fentieket. Ezek a sorok azt jelentik,
hogy a programoknak elõször a <CODE>/etc/hosts</CODE> állományban kell keresniük,
majd leellenõrzik a DNS-t a <CODE>resolv.conf</CODE> állomány alapján.</P>

<H2><A NAME="ss3.3">3.3 Gratulálok</A>
</H2>

<P>Most már tudod, hogyan kell beállítani a gyorsítótáras named-et. Bonts
egy sört, tejet, vagy bármit, amivel ünnepelni szeretsz.</P>

<H2><A NAME="s4">4. Továbbítás (forwarding)</A></H2>

<P> Nagy, jól szervezett, egyetemi vagy Internet szolgáltatói (ISP)
hálózatokban néha megfigyelheted, hogy a hálózati szakemberek a DNS
szerverek továbbítói hierarchiáját hozták létre, ami segít a
belsõ hálózati terhelés csökkentésében, és a külsõ szerverekén úgyszintén.
Nem könnyû megtudni, hogy egy ilyen hálózatban vagy-e. De ha a
hálózati szolgáltatód DNS szerverét "továbbítóként" használod, a
lekérdezésekre adott reakciókat gyorsabbá teheted, és csökkentheted a
forgalmat a hálózatodon. Ez a te névszervered lekérdezéseinek az ISP
névszervere felé történõ továbbításával mûködik. Minden egyes
alkalommal, amikor ilyen történik, az ISP névszerverének nagy
gyorsítótárába nyúlsz bele, így felgyorsítva a lekérdezéseket,
névszerverednek pedig nem kell mindent magának végeznie. Ha modemet használsz
ez nagy elõny lehet. A példa kedvéért tételezzük fel, hogy a hálózati
szolgáltatódnak két névszervere van amiket használni akarsz, <CODE>10.0.0.1</CODE> és
<CODE>10.1.0.1</CODE> IP címekkel. Ebben az esetben a <CODE>named.conf</CODE> állományodba, az
"<CODE>options</CODE>" kulcsszóval kezdõdõ részbe szúrd be ezeket a sorokat:</P>
<P>
<HR>
<PRE>
           forward first;
           forwarders {
                10.0.0.1;
                10.1.0.1;
            };
</PRE>
<HR>
</P>

<P> Van még egy szép trükk a továbbítókat használó betárcsázós gépek
számára, amely a 
<A HREF="#qanda">Kérdések és válaszok</A> fejezetben van leírva.</P>

<P> Indítsd újra a névszerveredet, és teszteld a <CODE>dig</CODE>-el. Még mindig rendben
kell mûködnie.</P>

<H2><A NAME="simple"></A> <A NAME="s5">5. Egy <EM>egyszerû</EM> tartomány</A></H2>

<P> <B>Hogyan kell felállítani a saját tartományodat?</B></P>

<H2><A NAME="ss5.1">5.1 De elõször egy kis száraz elmélet</A>
</H2>

<P> Mindenekelõtt: elolvastad az összes cuccot ez elõtt, ugye? Erre szükség van.</P>

<P> Mielõtt <EM>tényleg</EM> elkezdjük ezt a fejezetet, közzéteszek egy kis
elméletet, és egy példát, hogyan mûködik a DNS. És te el fogod olvasni,
mert az jó neked. Ha nem akarod, legalább fusd át nagyon gyorsan. Fejezd
be a futást, ha oda érsz, hogy minek kell a <CODE>named.conf</CODE> állományodba
kerülnie.</P>

<P>A DNS egy hierarchikus, fa struktúrájú rendszer. A tetejét "."-nak írják
és "gyökér"-nek (root) ejtik, ahogy az megszokott a fa-típusú
adatstruktúráknál. A . alatt számos legfelsõbb szintû tartomány (TLD -
Top Level Domain) van; a legismertebbek az <CODE>ORG</CODE>, <CODE>COM</CODE>, <CODE>EDU</CODE> és a <CODE>NET</CODE>, de
még sok más is van. Éppúgy mint a fának, ennek is van gyökere és
elágazik. Ha van egy kis számítástechnikai háttered, a DNS-t, mint egy
keresõfát azonosíthatod, és megtalálhatod a csomópontokat, az ágakat és
a csúcsokat. A pontok a csomópontok, a csúcsok a neveken vannak.</P>

<P> Egy gép keresésekor a lekérdezés rekurzív módon halad a hierarchiában, a
gyökértõl kiindulva. Ha a <CODE>prep.ai.mit.edu</CODE> címét akarod megtalálni, a
névszerverednek el kell kezdenie valahol. A gyorsítótárban való
kereséssel kezdi. Ha ebben megvan a válasz mert korábban eltárolta,
azonnal válaszolni fog, ahogy ezt a legutóbbi fejezetben láttuk. Ha nem
tudja, megnézi milyen közeli választ tud adni a keresett névhez, és
felhasznál bármilyen információt, amit már eltárolt. A legrosszabb
esetben nincs más találata, csak a név "."-ja (gyökere), és a
fõszerverekhez kell fordulni. El fogja távolítani a baloldali részeket,
egyenként ellenõrizve, hogy tud-e valamit az <CODE>ai.mit.edu.</CODE> tartományról, utána a
<CODE>mit.edu.</CODE>-ról, utána az <CODE>edu.</CODE>-ról, és ha nem, utána a .-ról, mert ez volt
a hints állományban. Ezután megkérdezi a . szervert a
<CODE>prep.ai.mit.edu</CODE> tartományról. Ez a . szerver nem fogja tudni a választ, de
segíteni fog a szerverednek a saját módján egy hivatkozás megadásával,
amellyel megmondja, hol keressen inkább. Ezek a hivatkozások a
szerveredet végül ahhoz a névszerverhez vezetik, amelyik tudja a
választ. Most ezt fogom bemutatni. A <CODE>+norec</CODE> azt jelenti, hogy a dig egy
nem-rekurzív lekérdezést végez, így a rekurziót magunknak kell elvégeznünk.
A többi opció a dig folyamat csökkentésére vannak, így ez nem fog több
oldalon át futni:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
$ ;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 980
;; flags: qr ra; QUERY: 1, ANSWER: 0, AUTHORITY: 13, ADDITIONAL: 0

;; AUTHORITY SECTION:
.                       518400  IN      NS      J.ROOT-SERVERS.NET.
.                       518400  IN      NS      K.ROOT-SERVERS.NET.
.                       518400  IN      NS      L.ROOT-SERVERS.NET.
.                       518400  IN      NS      M.ROOT-SERVERS.NET.

.                       518400  IN      NS      A.ROOT-SERVERS.NET.
.                       518400  IN      NS      B.ROOT-SERVERS.NET.
.                       518400  IN      NS      C.ROOT-SERVERS.NET.
.                       518400  IN      NS      D.ROOT-SERVERS.NET.
.                       518400  IN      NS      E.ROOT-SERVERS.NET.
.                       518400  IN      NS      F.ROOT-SERVERS.NET.
.                       518400  IN      NS      G.ROOT-SERVERS.NET.
.                       518400  IN      NS      H.ROOT-SERVERS.NET.
.                       518400  IN      NS      I.ROOT-SERVERS.NET.
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P> Ez egy hivatkozás. Ez csak egy felügyeleti részt ("Authority section")
hoz létre nekünk, válasz részt ("Answer section") pedig nem. A saját
névszerverünk egy névszerverhez küld tovább. Válasszunk ki
véletlenszerûen egyet:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
$ dig +norec +noques +nostats +nocmd prep.ai.mit.edu. @D.ROOT-SERVERS.NET.
;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 58260
;; flags: qr; QUERY: 1, ANSWER: 0, AUTHORITY: 3, ADDITIONAL: 3

;; AUTHORITY SECTION:
mit.edu.                172800  IN      NS      BITSY.mit.edu.
mit.edu.                172800  IN      NS      STRAWB.mit.edu.
mit.edu.                172800  IN      NS      W20NS.mit.edu.

;; ADDITIONAL SECTION:
BITSY.mit.edu.          172800  IN      A       18.72.0.3
STRAWB.mit.edu.         172800  IN      A       18.71.0.151
W20NS.mit.edu.          172800  IN      A       18.70.0.160
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P> Ez azonnal a MIT.EDU szerverhez küld minket. Újra válasszuk ki egyet
véletlenszerûen:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
$ dig +norec +noques +nostats +nocmd prep.ai.mit.edu. @BITSY.mit.edu.
;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 29227
;; flags: qr ra; QUERY: 1, ANSWER: 1, AUTHORITY: 4, ADDITIONAL: 4

;; ANSWER SECTION:
prep.ai.mit.edu.        10562   IN      A       198.186.203.77

;; AUTHORITY SECTION:
ai.mit.edu.             21600   IN      NS      FEDEX.ai.mit.edu.
ai.mit.edu.             21600   IN      NS      LIFE.ai.mit.edu.
ai.mit.edu.             21600   IN      NS      ALPHA-BITS.ai.mit.edu.
ai.mit.edu.             21600   IN      NS      BEET-CHEX.ai.mit.edu.

;; ADDITIONAL SECTION:
FEDEX.ai.mit.edu.       21600   IN      A       192.148.252.43
LIFE.ai.mit.edu.        21600   IN      A       128.52.32.80
ALPHA-BITS.ai.mit.edu.  21600   IN      A       128.52.32.5
BEET-CHEX.ai.mit.edu.   21600   IN      A       128.52.32.22
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P> Ezúttal kapunk egy "ANSWER SECTION"-t, és választ a kérdésünkre. Az
"AUTHORITY SECTION" azt az információt tartalmazza, hogy mely
szervereket kérdezzük legközelebb az <CODE>ai.mit.edu</CODE>-ról. Így, következõ
alkalommal amikor az <CODE>ai.mit.edu</CODE> nevekrõl kíváncsiskodsz, közvetlenül
õket kérdezheted. A named információt gyûjtött a <CODE>mit.edu</CODE>-ról is, így
legközelebb ha a <CODE>www.mit.edu</CODE> lekérdezése fordul elõ, sokkal könnyebb
lesz majd megválaszolni a kérdést.</P>

<P> Így a .-tól kezdõdõen a hivatkozások alapján megtaláltuk az egymás
utáni névszervereket, a tartománynév minden egyes szintjéhez. Ha a saját
DNS szerveredet használtad volna mindezen szerverek helyett, a named-ed
természetesen eltárolta volna mindezt az információt amit a kutakodás
során talált, és egy ideig nem kellene újra lekérdeznie.</P>

<P> A fa-analógiában minden "." a névben egy elágazási pont, és minden rész
a "."-ok között az egyes ágak nevei a fán. A fa bejárásakor fogjuk a
nevet amit keresünk (prep.ai.mit.edu), megkérdezve a gyökeret (.) vagy
bármelyik szervert a gyökértõl a <CODE>prep.ai.mit.edu</CODE> felé, amelyikrõl van
információnk a gyorsítótárban. Ha a gyorsítótár eléri kapacitásának
határait, a rekurzív feloldó a külsõ szervereket kérdezi le, követve a
hivatkozásokat (éleket) tovább a névben.</P>

<P> Valamivel kevesebbet beszéltünk róla, de éppoly fontos az
<CODE>in-addr.arpa</CODE> tartomány. Ez is épp úgy szervezett, mint a "közönséges"
tartományok. Az <CODE>in-addr.arpa</CODE> lehetõvé teszi számunkra, hogy megkapjuk az
állomás nevét, ha megvan a címe. Egy fontos dolog, amit meg kell
jegyezni, hogy az IP címek fordított sorrendben vannak írva az
<CODE>in-addr.arpa</CODE> tartományban. Ha egy gépnek a címe: <CODE>198.186.203.77</CODE>, a named
a keresést a <CODE>77.203.168.198.in-addr.arpa</CODE>-ra végzi, éppúgy, ahogy azt a
<CODE>prep.ai.mi.edu</CODE>-ra tette. Példa: Ha nem találsz egyetlen találati
bejegyzést a gyorsítótárban csak a "."-ot, kérdezz le egy fõszervert, az
<CODE>m.root-servers.net</CODE> valamelyik másik fõszerverhez irányít. A
<CODE>b.root-servers.net</CODE> közvetlenül a <CODE>bitsy.mit.edu</CODE> tartományhoz irányít. Onnan már
képes leszel leszedni.</P>

<H2><A NAME="ss5.2">5.2 A saját tartományunk</A>
</H2>

<P> Most  következik a saját tartományunk meghatározása. A <CODE>linux.bogus</CODE> tartományt fogjuk
létrehozni, és megadjuk a gépeket benne. Egy teljesen hamis
tartománynevet használok, hogy biztos ne zavarjunk senkit Ott Kint.</P>

<P> Még egy dolog, mielõtt elkezdjük: Nem minden karakter megengedett a
gépnevekben. Az angol ábécé betûire vagyunk korlátozva: a-z, és a 0-9
számok és a "-" (kötõjel) karakter. Tartsd magad ezekhez a karakterekhez
(a 9-es BIND nem fog hibásan mûködni, ha megszeged ezt a szabályt, de a
8-as BIND igen). A kis- és nagybetûk egyformák a DNS számára, tehát a
<CODE>pat.uio.no</CODE> megegyezik a <CODE>Pat.UiO.No</CODE>-val.</P>

<P> Már elkezdtük ezt a részt a named.conf-ban ezzel a sorral:</P>
<P>
<HR>
<PRE>
zone "0.0.127.in-addr.arpa" {
        type master;
        file "pz/127.0.0";
};
</PRE>
<HR>
</P>

<P> Kérlek, vedd észre a "." hiányát a tartománynevek végén ebben az
állományban. Azt jelenti, hogy mi most a <CODE>0.0.127.in-addr.arpa</CODE> zónát
fogjuk megadni, hogy mi vagyunk a mesterszerver számára, és hogy a
<CODE>pz/127.0.0</CODE> állományban van tárolva. Már beállítottuk ezt az állományt:</P>
<P>
<HR>
<PRE>
$TTL 3D
@               IN      SOA     ns.linux.bogus. hostmaster.linux.bogus. (
                                1       ; Serial
                                8H      ; Refresh
                                2H      ; Retry
                                4W      ; Expire
                                1D)     ; Minimum TTL
                        NS      ns.linux.bogus.
1                       PTR     localhost.
</PRE>
<HR>
</P>

<P> Kérlek, vedd észre a "."-ot a teljes tartománynevek végén ebben az
állományban, ellentétben a fenti <CODE>named.conf</CODE> állománnyal. Egyesek
szeretnek minden zónaállományt az <CODE>//$ORIGIN</CODE> direktívával kezdeni, de ez
felesleges. Egy zónaállomány eredete (ahová a DNS hierarchiában
tartozik) a <CODE>named.conf</CODE> állomány zóna fejezetében van meghatározva; ebben
az esetben ez a <CODE>0.0.127.in-addr.arpa</CODE>.</P>

<P> Ez a "zónaállomány" 3 "erõforrásbejegyzést" (RR - resource record)
tartalmaz: egy SOA RR-t, egy NS RR-t és egy PTR RR-t. A SOA a
Jogosultság Kezdetének a rövidítése (SOA - Start Of Authority). A "@"
egy speciális jel ami az eredetet jelenti, és mivel a "tartomány" oszlop
ezen állomány esetén az 0.0.127.in-addr-arpa-t tartalmazza, az elsõ sor
valójában ezt jelenti:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
0.0.127.in-addr.arpa.   IN      SOA ...
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P> Az NS a Névszerver RR. Itt nincs "@" a sor elején; magától értetõdõ,
mivel az elõzõ sor egy "@"-el kezdõdött. Ez megtakarít egy kis gépelést.
Tehát az NS sort így is lehet írni:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
0.0.127.in-addr.arpa.   IN      NS      ns.linux.bogus
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P> Ez megmondja a DNS-nek, melyik gép a <CODE>0.0.127.in-addr.arpa</CODE> tartomány
névszervere, ez az <CODE>ns.linux.bogus</CODE>. Az "ns" egy szokványos név a
névszerverek számára, éppúgy, mint a web szerverek esetében, amiknek
szokványosan <CODE>www.</CODE><EM>valami</EM> a nevük. A név bármi lehet.</P>

<P> Végül a PTR (Tartomány Név Mutató) bejegyzés megmondja, hogy a
<CODE>0.0.127.in-addr.arpa</CODE> alhálózat 1-es címén, azaz a 127.0.0.1 címen
található gép neve <CODE>localhost</CODE>.</P>

<P>A SOA bejegyzés a bevezetõ az <EM>összes</EM> zónaállományhoz, és pontosan
egynek kell lennie minden egyes zónaállományban, a tetején (de a $TTL
direktíva után). Ez leírja a zónát, honnan származik (egy <CODE>ns.linux.bogus</CODE>
nevû géprõl), ki felelõs annak tartalmáért (<CODE>hostmaster@linux.bogus</CODE>, a
saját e-mail címedet kell ideírnod), melyik változatú zónaállomány ez
(serial: 1), és egyéb, a gyorsítótárazással és a másodlagos DNS
szerverekkel kapcsolatos dolgokat. A maradék mezõk (refresh - frissítés,
retry - újrapróbálkozás, expire - lejárat és minimum) tekintetében
használd az ebben a HOGYANban használt számokat, és nem lesz baj. A SOA
elé jön egy kötelezõ sor, a <CODE>$TTL 3D</CODE>. Rakd bele az összes
zónaállományodba.</P>

<P> Most indítsd újra a named-et (<CODE>rndc stop; named</CODE>) és használd a <CODE>dig</CODE>-et
ügyeskedésed megvizsgálásához. A <CODE> -x</CODE> fordított lekérdezést kér:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
$ dig -x 127.0.0.1
;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 30944
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 0

;; QUESTION SECTION:
;1.0.0.127.in-addr.arpa.                IN      PTR

;; ANSWER SECTION:
1.0.0.127.in-addr.arpa. 259200  IN      PTR     localhost.

;; AUTHORITY SECTION:
0.0.127.in-addr.arpa.   259200  IN      NS      ns.linux.bogus.

;; Query time: 3 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Sun Dec 23 03:02:39 2001
;; MSG SIZE  rcvd: 91
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P> Szóval ez gondoskodik arról, hogy a 127.0.0.1-bõl <CODE>localhost</CODE>-ot kapjunk;
rendben. Most a fõ célunk, a linux.bogus tartomány érdekében, szúrjunk
be egy új "zone" részt a <CODE>named.conf</CODE> állományba:</P>
<P>
<HR>
<PRE>
zone "linux.bogus" {
        type master;
        notify no;
        file "pz/linux.bogus";
};
</PRE>
<HR>
</P>

<P> Figyeld meg újból a <CODE>named.conf</CODE> állományban a tartománynév végén a "." hiányát.</P>

<P> A <CODE>linux.bogus</CODE> zónaállománya berakunk némi teljesen valótlan adatot:</P>
<P>
<HR>
<PRE>
;
; Zone file for linux.bogus
;
; The full zone file
;
$TTL 3D
@       IN      SOA     ns.linux.bogus. hostmaster.linux.bogus. (
                        199802151       ; serial, todays date + todays serial #

                        8H              ; refresh, seconds
                        2H              ; retry, seconds
                        4W              ; expire, seconds
                        1D )            ; minimum, seconds
;
                NS      ns              ; Inet Address of name server
                MX      10 mail.linux.bogus     ; Primary Mail Exchanger
                MX      20 mail.friend.bogus.   ; Secondary Mail Exchanger
;
localhost       A       127.0.0.1
ns              A       192.168.196.2
mail            A       192.168.196.4
</PRE>
<HR>
</P>

<P> Két dolgot meg kell jegyezni a SOA bejegyzésrõl. Az <CODE>ns.linux.bogus</CODE>-nak
egy "A" bejegyzéssel rendelkezõ valódi gépnek <EM>kell</EM> lennie. Nem
megengedett az SOA bejegyzésben említett géphez CNAME bejegyzést
rendelni. A nevének nem kell "ns"-nek lennie, bármely valós gép neve
lehet. Az ezt követõ <CODE>hostmaster.linux.bogus</CODE>-t hostmaster@linux.bogus-nak
kell olvasni. Ennek egy olyan levélcímnek kell lennie, amelyet a DNS-t
karbantartó személy, vagy személyek gyakran olvasnak. Bármely, a
tartománnyal kapcsolatos levél az itt megadott címre lesz
elküldve. A névnek nem kell "hostmaster"-nek lennie, lehet ez a rendes
e-mail címed, de a "hostmaster" e-mail cím létezése sokszor szintén elvárás.</P>

<P> Egy új RR típus található ebben az állományban, az MX, vagy a Mail
eXchanger (levélkiszolgáló) RR. Ez megmondja a levelezõrendszereknek,
hova legyen küldve a <CODE>valaki@linux.bogus</CODE>-nak címzett levél, név szerint a
<CODE>mail.linux.bogus</CODE>-nak, vagy a <CODE>mail.friend.bogus</CODE>-nak. A szám minden gép
neve elõtt az adott MX RR prioritása. A legkisebb számmal (10)
rendelkezõ RR az, amelyik, ha lehetséges a levelet kapni fogja. Ha ez
nem sikerül, a levelet el lehet küldeni egy magasabb számmal
rendelkezõnek, egy másodlagos levélkezelõnek, azaz a
<CODE>mail.friend.bogus</CODE>-nak, amelynek a prioritása itt 20.</P>

<P> Töltsük be a tartományokat újból az <CODE>rndc reload</CODE> futtatásával. Vizsgáljuk
meg az eredményeket a <CODE>dig</CODE>-el:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>

$ dig any linux.bogus
; &lt;&lt;>> DiG 9.1.3 &lt;&lt;>> any linux.bogus
;; global options:  printcmd
;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 55239
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 1, ADDITIONAL: 1

;; QUESTION SECTION:
;linux.bogus.               IN      ANY

;; ANSWER SECTION:
linux.bogus.        259200  IN      SOA     ns.linux.bogus. \
      hostmaster.linux.bogus. 199802151 28800 7200 2419200 86400
linux.bogus.        259200  IN      NS      ns.linux.bogus.
linux.bogus.        259200  IN      MX      20 mail.friend.bogus.
linux.bogus.        259200  IN      MX      10 mail.linux.bogus.linux.bogus.

;; AUTHORITY SECTION:
linux.bogus.        259200  IN      NS      ns.linux.bogus.

;; ADDITIONAL SECTION:
ns.linux.bogus.     259200  IN      A       192.168.196.2

;; Query time: 4 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Sun Dec 23 03:06:45 2001
;; MSG SIZE  rcvd: 184
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P> Alapos vizsgálat után egy hibát fogsz találni. A</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
linux.bogus.        259200  IN MX        10 mail.linux.bogus.linux.bogus.
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P> sor teljesen rossz. Ennek így kellene kinéznie:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
linux.bogus.        259200  IN MX        10 mail.linux.bogus.
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P> Szándékosan hibát vétettem, úgyhogy tanulhatsz belõle :-) Beletekintve a
zónaállományba ezt a sort találjuk:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
               MX      10 mail.linux.bogus     ; Primary Mail Exchanger
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P> Hiányzik egy pont. Vagy a "linux.bogus"-ban túl sok van. Ha egy gépnév
a zónaállományban nem végzõdik pontra, az eredete hozzáadódik a végéhez,
a megduplázott <CODE>linux.bogus.linux.bogus</CODE>-t eredményezve. Szóval vagy</P>
<P>
<HR>
<PRE>
                MX      10 mail.linux.bogus.    ; Primary Mail Exchanger
</PRE>
<HR>
</P>
<P>vagy</P>
<P>
<HR>
<PRE>
                MX      10 mail                 ; Primary Mail Exchanger
</PRE>
<HR>
</P>
<P>a helyes. Én az utóbbi változatot preferálom, kevesebbet kell gépelni.
Vannak olyan BIND szakértõk, akik nem értenek egyet ezzel, és vannak
olyanok akik igen. Egy zónaállmányban a tartományt vagy ki kell írni,
és "."-al lezárni, vagy egyáltalán nem kell meghatározni, mely
esetben az eredet lesz az alapértelmezés.</P>

<P> Ki kell hangsúlyoznom, hogy a named.conf állományban <EM>nem</EM> kell "."-nak
lennie a tartománynevek után. El sem bírod képzelni, hány esetben
kavarta össze a dolgokat a túl sok vagy túl kevés pont, és hozta ki az
ördögöt az emberekbõl.</P>

<P> Szóval, kifejtve érveimet itt van az új zónaállomány, némi extra
információval kiegészítve:</P>
<P>
<HR>
<PRE>
;
; Zone file for linux.bogus
;
; The full zone file
;
$TTL 3D
@       IN      SOA     ns.linux.bogus. hostmaster.linux.bogus. (
                        199802151       ; serial, todays date + todays serial #
                        8H              ; refresh, seconds
                        2H              ; retry, seconds
                        4W              ; expire, seconds
                        1D )            ; minimum, seconds
;
                TXT     "Linux.Bogus, your DNS consultants"
                NS      ns              ; Inet Address of name server
                NS      ns.friend.bogus.
                MX      10 mail         ; Primary Mail Exchanger
                MX      20 mail.friend.bogus. ; Secondary Mail Exchanger

localhost       A       127.0.0.1

gw              A       192.168.196.1
                TXT     "The router"

ns              A       192.168.196.2
                MX      10 mail
                MX      20 mail.friend.bogus.
www             CNAME   ns

donald          A       192.168.196.3
                MX      10 mail
                MX      20 mail.friend.bogus.
                TXT     "DEK"

mail            A       192.168.196.4
                MX      10 mail
                MX      20 mail.friend.bogus.

ftp             A       192.168.196.5
                MX      10 mail
                MX      20 mail.friend.bogus.
</PRE>
<HR>
</P>

<P> A CNAME (Canonical NAME - kanonikus NÉV) egy módszer több név megadására egy
gép számára. Így a www egy álnév az ns számára. A CNAME bejegyzés
használata egy kicsit kétértelmû. A legbiztosabb azt a
szabályt követni, hogy egy MX, CNAME vagy SOA bejegyzés <EM>soha</EM> nem hivatkozhat
egy CNAME bejegyzésre, csak egy "A" bejegyzéssel rendelkezõ valamire
hivatkozhatnak, tehát megengedhetetlen a</P>
<P>
<HR>
<PRE>
foobar          CNAME   www                     ; NEM!
</PRE>
<HR>
</P>
<P>de helyes a</P>
<P>
<HR>
<PRE>

foobar          CNAME   ns                      ; IGEN!
</PRE>
<HR>
</P>

<P> Töltsük be az új adatbázist az <CODE>rndc reload</CODE> futtatásával, amely a named
állományainak újbóli beolvasását eredményezi.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>

$ dig linux.bogus axfr

; &lt;&lt;>> DiG 9.1.3 &lt;&lt;>> linux.bogus axfr
;; global options:  printcmd
linux.bogus.            259200  IN      SOA     ns.linux.bogus. hostmaster.linux.bogus. 199802151 28800 7200 2419200 86400
linux.bogus.            259200  IN      NS      ns.linux.bogus.
linux.bogus.            259200  IN      MX      10 mail.linux.bogus.
linux.bogus.            259200  IN      MX      20 mail.friend.bogus.

donald.linux.bogus.     259200  IN      A       192.168.196.3
donald.linux.bogus.     259200  IN      MX      10 mail.linux.bogus.
donald.linux.bogus.     259200  IN      MX      20 mail.friend.bogus.
donald.linux.bogus.     259200  IN      TXT     "DEK"
ftp.linux.bogus.        259200  IN      A       192.168.196.5
ftp.linux.bogus.        259200  IN      MX      10 mail.linux.bogus.

ftp.linux.bogus.        259200  IN      MX      20 mail.friend.bogus.
gw.linux.bogus.         259200  IN      A       192.168.196.1
gw.linux.bogus.         259200  IN      TXT     "The router"
localhost.linux.bogus.  259200  IN      A       127.0.0.1
mail.linux.bogus.       259200  IN      A       192.168.196.4
mail.linux.bogus.       259200  IN      MX      10 mail.linux.bogus.
mail.linux.bogus.       259200  IN      MX      20 mail.friend.bogus.
ns.linux.bogus.         259200  IN      MX      10 mail.linux.bogus.
ns.linux.bogus.         259200  IN      MX      20 mail.friend.bogus.
ns.linux.bogus.         259200  IN      A       192.168.196.2
www.linux.bogus.        259200  IN      CNAME   ns.linux.bogus.
linux.bogus.            259200  IN      SOA     ns.linux.bogus. hostmaster.linux.bogus. 199802151 28800 7200 2419200 86400
;; Query time: 41 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Sun Dec 23 03:12:31 2001
;; XFR size: 23 records
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P> Ez jó. Amint látod, egy kicsit úgy néz ki, mint a zónaállomány maga.
Ellenõrizzük, mit mond egyedül a <CODE>www</CODE>-re:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
$ dig www.linux.bogus

; &lt;&lt;>> DiG 9.1.3 &lt;&lt;>> www.linux.bogus
;; global options:  printcmd
;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 16633
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 0

;; QUESTION SECTION:
;www.linux.bogus.               IN      A

;; ANSWER SECTION:
www.linux.bogus.        259200  IN      CNAME   ns.linux.bogus.
ns.linux.bogus.         259200  IN      A       192.168.196.2

;; AUTHORITY SECTION:
linux.bogus.            259200  IN      NS      ns.linux.bogus.

;; Query time: 5 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Sun Dec 23 03:14:14 2001
;; MSG SIZE  rcvd: 80
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Más szóval a <CODE>www.linux.bogus</CODE> valódi neve <CODE>ns.linux.bogus</CODE>, és 
további információt is ad neked amivel rendelkezik az ns-rõl, elegendõt a
hozzá való csatlakozáshoz, ha egy program lennél.</P>

<P> Most vagyunk félúton</P>

<H2><A NAME="ss5.3">5.3 A fordított zóna</A>
</H2>

<P> Most már a programok át tudják alakítani a linux.bogus-ban a neveket
címekké, amelyekhez csatlakozni tudnak. De szükség van egy fordított
zónára is, olyanra, amely lehetõvé teszi a DNS számára a címek
átalakítását nevekké. Ezt a nevet rengeteg különbözõ típusú szerver
(FTP, IRC, WWW és mások) használja annak eldöntésére, hogy akar-e veled
kommunikálni vagy nem, és ha igen, talán még arra is, hogy milyen
prioritást kapjál. Az Internet összes szolgáltatásának teljes eléréséhez
a fordított zóna szükséges.</P>

<P> Rakd be ezt a <CODE>named.conf</CODE> állományba:</P>
<P>
<HR>
<PRE>
zone "196.168.192.in-addr.arpa" {
        type master;
        notify no;
        file "pz/192.168.196";
};
</PRE>
<HR>
</P>

<P> Ez pontosan ugyanaz, mint a <CODE>0.0.127.in-arpa</CODE>-val, és a tartalmuk is hasonló:</P>
<P>
<HR>
<PRE>
$TTL 3D
@       IN      SOA     ns.linux.bogus. hostmaster.linux.bogus. (
                        199802151 ; Serial, todays date + todays serial
                        8H      ; Refresh
                        2H      ; Retry
                        4W      ; Expire
                        1D)     ; Minimum TTL
                NS      ns.linux.bogus.

1               PTR     gw.linux.bogus.
2               PTR     ns.linux.bogus.
3               PTR     donald.linux.bogus.
4               PTR     mail.linux.bogus.
5               PTR     ftp.linux.bogus.
</PRE>
<HR>
</P>

<P> Most újra töltsd be a named-et (<CODE>rndc reload</CODE>), és vizsgáld meg a munkádat
a <CODE>dig</CODE>-el újra:</P>
<P>
<HR>
<PRE>

$ dig -x 192.168.196.4

;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 58451
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1

;; QUESTION SECTION:
;4.196.168.192.in-addr.arpa.    IN      PTR

;; ANSWER SECTION:
4.196.168.192.in-addr.arpa. 259200 IN   PTR     mail.linux.bogus.

;; AUTHORITY SECTION:
196.168.192.in-addr.arpa. 259200 IN     NS      ns.linux.bogus.

;; ADDITIONAL SECTION:
ns.linux.bogus.         259200  IN      A       192.168.196.2

;; Query time: 4 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Sun Dec 23 03:16:05 2001
;; MSG SIZE  rcvd: 107
</PRE>
<HR>
</P>

<P> tehát jónak néz ki, szedjük ki az egészet, hogy azt is megvizsgáljuk:</P>
<P>
<HR>
<PRE>
$ dig 196.168.192.in-addr.arpa. AXFR

; &lt;&lt;>> DiG 9.1.3 &lt;&lt;>> 196.168.192.in-addr.arpa. AXFR
;; global options:  printcmd
196.168.192.in-addr.arpa. 259200 IN     SOA     ns.linux.bogus. \

        hostmaster.linux.bogus. 199802151 28800 7200 2419200 86400
196.168.192.in-addr.arpa. 259200 IN     NS      ns.linux.bogus.
1.196.168.192.in-addr.arpa. 259200 IN   PTR     gw.linux.bogus.
2.196.168.192.in-addr.arpa. 259200 IN   PTR     ns.linux.bogus.
3.196.168.192.in-addr.arpa. 259200 IN   PTR     donald.linux.bogus.
4.196.168.192.in-addr.arpa. 259200 IN   PTR     mail.linux.bogus.
5.196.168.192.in-addr.arpa. 259200 IN   PTR     ftp.linux.bogus.
196.168.192.in-addr.arpa. 259200 IN     SOA     ns.linux.bogus. \
        hostmaster.linux.bogus. 199802151 28800 7200 2419200 86400
;; Query time: 6 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Sun Dec 23 03:16:58 2001
;; XFR size: 9 records
</PRE>
<HR>
</P>

<P> Jól néz ki! Ha kimeneted nem ilyen, akkor keresd a hibaüzeneteket a
syslog-ban, az elsõ fejezetben, 
<A HREF="#starting">A named indítása</A>
fejezetben elmagyaráztam, hogyan tedd ezt.</P>

<H2><A NAME="ss5.4">5.4 Intõ szavak</A>
</H2>

<P> Van pár dolog, amit itt közre kell adnom. A fenti példában használt IP
számok a "magánhálózatok" egyik blokkjából lettek véve, azaz nyilvános
használatuk az Interneten nem megengedett. Így hát biztonságos a
használatuk egy HOGYAN egy példájában. A másik dolog a <CODE>notify no;</CODE> sor.
Ez megmondja a named-nek, hogy ne értesítse a másodlagos (slave)
szerverét, amikor az egyik zónaállománya frissült. A 8-as és késõbbi
BIND-ben a named értesítheti a zónaállományban az NS bekezdésben
felsorolt többi szervert, amikor a zóna frissült. Ez ügyes dolog rendes
mûködéskor. De kísérletezések esetén  ennek a lehetõségnek kikapcsolva
kell lennie - nem akarjuk, hogy a kísérlet megkavarja az
Internetet, ugye?</P>

<P> És persze, ez a tartomány erõsen hamis, és éppígy a címek benne. Egy
valódi tartomány valós példájáért nézd meg a következõ fõfejezetet.</P>

<H2><A NAME="ss5.5">5.5 Miért nem mûködnek a fordított lekérdezések?</A>
</H2>

<P> Van egy pár normális körülmények között névlekérdezésekkel elkerülhetõ
"csapda", amellyel gyakran találkozni fordított zónák beállításánál.
Mielõtt folytatod, szükséged lesz a fordított lekérdezések mûködésére a
saját névszervereden. Ha ez nincs így, menj vissza, és javítsd ki
mielõtt folytatod.</P>

<P> A fordított lekérdezések két hibájáról fogok szólni, ahogy azok a
hálózaton kívülrõl látszódnak:</P>

<H3>A fordított zóna nincs delegálva</H3>

<P> Ha egy hálózati szolgáltatótól egy hálózati címtartományt és egy
tartománynevet kérsz, a tartománynév rendes esetben delegálva van, mint
egy magától értetõdõ dolog. A delegálás az az összeragasztó NS
bejegyzés, amely segít eljutnod az egyik névszervertõl a másikig, ahogy
ez a száraz elméleti fejezetben el lett magyarázva. Elolvastad, ugye? Ha
a fordított zónád nem mûködik, menj vissza, és olvasd el. Most.</P>

<P> A fordított zónának szintén delegálva kell lennie. Ha a <CODE>192.168.196</CODE>-os
hálózatot kapod a <CODE>linux.bogus</CODE> tartománnyal a szolgáltatódtól, be kell
rakniuk az NS bejegyzést a fordított zónád számára éppúgy, mint a
továbbító zónád számára. Ha követed a láncolatot az <CODE>in-addr.arpa</CODE>-tól
felfelé a hálózatodig, valószínûleg szakadást találsz majd a láncban,
a leginkább valószínû, hogy a szolgáltatódnál. Miután megtaláltad a szakadást
a láncolatban, vedd fel a kapcsolatot a szolgáltatóddal, és kérd meg
õket a hiba kijavítására.</P>

<H3>Egy osztályon kívüli alhálózatod van</H3>

<P> Ez egy kissé bonyolultabb téma, de az osztályon kívüli alhálózatok
nagyon elterjedtek manapság, és valószínûleg egy ilyened van, ha egy kis
cég vagy.</P>

<P> Az osztályon kívüli alhálózatok azok, amik az Internetet manapság
éltetik. Néhány évvel ezelõtt sok volt a hûhó az IP címek fogyatkozása
miatt. A bölcs emberek az IETF-nél (Internet Engineering Task Force, õk
tartják mûködésben az Internetet) összedugták a fejüket, és megoldották
a problémát. Bizonyos áron. Az ár ott mutatkozik, hogy egy "C"
alhálózatnál kisebbet kapsz, és bizonyos dolgok nem mûködhetnek. Kérlek
nézd át az 
<A HREF="http://www.acmebw.com/askmrdns/00007.htm">Ask Mr. DNS</A> (Kérdezd DNS urat) cikket
egy jó magyarázatért, és hogy hogyan kezeld ezt.</P>

<P> Elolvastad? Nem fogom elmagyarázni, szóval kérlek olvasd el.</P>

<P> A probléma elsõ része az, hogy az ISP-dnek értenie kell a Mr. DNS által
leírt technikát. Nem minden kis ISP-nek van hozzáértõ dolgozója ehhez.
Ha így van, lehet, hogy el kell nekik magyaráznod, és kitartónak kell
lenned. De elõször légy biztos benne, hogy te érted ;-). Ezután be
fognak állítani egy rendes fordított zónát a szerverükön, melynek
helyességét megvizsgálhatod a dig-el.</P>

<P> A probléma második és egyben utolsó része az, hogy meg kell értened a
technikát. Ha nem vagy biztos benne, menj vissza, és olvass róla ismét.
Ezután beállíthatod a saját osztályon kívüli fordított zónádat úgy, ahogy
azt az Ask Mr. DNS leírja.</P>

<P> Lapul egy másik csapda is itt. A (nagyon) régi feloldók <EM>nem</EM> lesznek
képesek követni a CNAME trükköt a feloldási láncban, és nem lesznek
képesek fordítva feloldani a gépedet. Ez egy szolgáltatás esetében
helytelen hozzáférési osztály hozzárendelését, a hozzáférés megtagadását
vagy ezekhez hasonlót eredményezhet. Ha egy ilyen szolgáltatásba
ütközöl, az egyetlen megoldás (amirõl én tudok) az ISP-d számára az,
hogy belerakja a PTR bejegyzésedet közvetlenül az õ trükkös osztályon
kívüli zónaállományukba a trükkös CNAME bejegyzés helyett.</P>

<P> Bizonyos ISP-k más módokat fognak ajánlani ennek kezelésére, úgymint
Web-alapú ûrlapokat a fordított hozzárendelés megadásához, vagy más
automágikus rendszereket.</P>

<H2><A NAME="ss5.6">5.6 Másodlagos (slave) szerverek</A>
</H2>

<P> Amint helyesen beállítottad a zónáidat az elsõdleges (master) szerveren,
fel kell állítanod legalább egy másodlagos (slave) szervert. A másodlagos
szerverek a robusztusság miatt szükségesek. Ha az elsõdleges leáll, az
emberek ott kint a hálón még mindig képesek lesznek információt kapni a
tartományodról a szolgától. A másodlagosnak olyan messze kell lennie tõled,
amennyire csak lehetséges. Az alábbi dolgok közül az elsõdlegesnek és a
másodlagosnak minél kevesebben kellene osztozniuk: áramellátás, LAN, ISP,
város és ország. Ha ez mind más az elsõdleges és a másodlagos esetében, egy
tényleg jó másodlagos szervert találtál.</P>

<P> A másodlagos szerver egyszerûen egy olyan névszerver, amely a zónaállományokat
lemásolja az elsõdlegesrõl. Ekképp állíthatod be:</P>
<P>
<HR>
<PRE>
zone "linux.bogus" {
        type slave;
        file "sz/linux.bogus";
        masters { 192.168.196.2; };
};
</PRE>
<HR>
</P>

<P> Az adatok másolására a zónaátvitel nevû mechanizmust használják. A
zónaátvitelt az SOA bejegyzésed irányítja:</P>
<P>
<HR>
<PRE>
@       IN      SOA     ns.linux.bogus. hostmaster.linux.bogus. (
                        199802151       ; serial, todays date + todays serial #
                        8H              ; refresh, seconds
                        2H              ; retry, seconds
                        4W              ; expire, seconds
                        1D )            ; minimum, seconds
</PRE>
<HR>
</P>

<P> Egy zóna csak akkor kerül átvitelre, ha a sorozatszáma (serial) az
elsõdleges szerveren nagyobb, mint a másodlagoson. Frissítési intervallumonként (refresh)
a másodlagos szerver le fogja ellenõrizni, hogy az elsõdleges frissült-e. Ha az
ellenõrzés nem hoz eredményt (mert az elsõdleges nem elérhetõ), újrapróbálja
a megadott intervallumonként (retry). Ha az ellenõrzések a lejárati
idõszak (expire) alatt sem hoznak eredményt, a másodlagos szerver el fogja
távolítani a zónát az állományrendszerébõl, és nem lesz többé szerver
számára.</P>

<H2><A NAME="security"></A> <A NAME="s6">6. Alapvetõ biztonsági beállítások</A></H2>

<P> <EM>Jamie Norrish</EM></P>

<P> <B>A konfigurációs opciók beállítása a problémák valószínûségének
csökkentése érdekében.</B></P>

<P> Van néhány egyszerû lépés amelyet megtehetsz, ezek biztonságosabbá
teszik a szerveredet, és esetlegesen csökkentik a terhelését is. Az itt
bemutatott anyag nem több, mint egy kiindulási pont; ha érdekelt vagy a
biztonságban (és így kellene lennie), kérlek tanulmányozz át más
forrásmunkákat is a hálózaton (lásd az 
<A HREF="#bigger">utolsó fejezetet</A>).</P>

<P> A következõ beállítási direktívák fordulnak elõ a <CODE>named.conf</CODE> állományban. Az options részben található direktívák az összes zónára vonatkoznak. Ha a <CODE>zone</CODE>
bejegyzésben fordul elõ, csak arra a zónára vonatkozik. Egy <CODE>zone</CODE>
bejegyzés felülírja az <CODE>options</CODE> bejegyzést.</P>

<H2><A NAME="ss6.1">6.1 A zónaátvitelek korlátozása</A>
</H2>

<P> Annak érdekében, hogy a másodlagos szervere(i)d képes legyen válaszolni a
tartományodra vonatkozó lekérdezésekre, képeseknek kell lenniük 
áthozni a zónainformációt az elsõdleges szerveredrõl. Nagyon sokan
szeretnének szintén így cselekedni. Ezért korlátozd a zónaátvitelt az
<CODE>allow-transfer</CODE> opció használatával, feltételezve, hogy 192.168.1.4 az
ns.friend.bogus címe, és hozzáadva saját magadat hibakeresési célból:</P>
<P>
<HR>
<PRE>
zone "linux.bogus" {
      allow-transfer { 192.168.1.4; localhost; };
};
</PRE>
<HR>
</P>

<P> A zónaátvitelek korlátozásával biztosítod, hogy az egyetlen elérhetõ
információ az, amit az emberek közvetlenül kérdeznek - senki sem
kérdezheti le csak úgy beállításod összes részletét.</P>

<H2><A NAME="ss6.2">6.2 Védekezés az "átejtés" ellen</A>
</H2>

<P> Legelõször kapcsolj ki minden lekérdezést, ami nem az általad birtokolt
tartományokra irányul, kivéve a belsõ/helyi gépeidrõl indulókat. Ez nem csak a
DNS szervered rosszindulatú kihasználását elõzi meg, de csökkenti
szervered felesleges használatát is.</P>
<P>
<HR>
<PRE>
options {
      allow-query { 192.168.196.0/24; localhost; };
};

zone "linux.bogus" {
      allow-query { any; };
};

zone "196.168.192.in-addr.arpa" {
      allow-query { any; };
};
</PRE>
<HR>
</P>

<P> Továbbá kapcsold ki a rekurzív lekérdezéseket, kivéve a belsõ/helyi
gépektõl. Ez csökkenti a gyorsítótár-mérgezéses támadások esélyét
(amikor hamis adatokkal tömik a szerveredet).</P>
<P>
<HR>
<PRE>
options {
        allow-recursion { 192.168.196.0/24; localhost; };
};
</PRE>
<HR>
</P>

<H2><A NAME="ss6.3">6.3 A named futtatása nem-root-ként</A>
</H2>

<P> Egy jó ötlet a named-et a root-tól különbözõ felhasználóként
futtatni, így ha feltörik a cracker által szerzett jogok a lehetõ
legkorlátozottabbak. Elõször létre kell hoznod egy felhasználót ami
alatt a named fusson, majd módosítani bármely általad használt, a
named-et indító init szkriptet. Az új felhasználónevet és csoportot a
named-nek az -u és -g kapcsolók segítségével add meg.</P>

<P> Például: Debian GNU/Linux 2.2-ben módosítanod kell a <CODE>/etc/init.d/bind</CODE>
szkriptet, hogy tartalmazza a következõ sort (ahol a <CODE>named</CODE> felhasználó
már létre lett hozva):</P>
<P>
<HR>
<PRE>
start-stop-daemon --start --quiet --exec /usr/sbin/named -- -u named
</PRE>
<HR>
</P>

<P> Ugyanez megtehetõ a Red Hat-al és más disztribúciókkal is.</P>

<P> Dave Lugo leírt egy biztonságos kettõs chroot beállítást, amely a
<A HREF="http://www.etherboy.com/dns/chrootdns.html">http://www.etherboy.com/dns/chrootdns.html</A> honlapon található, 
ez még biztonságosabbá teheti a gépet, amelyen a named-et futtatod.</P>

<H2><A NAME="real-example"></A> <A NAME="s7">7. Egy valódi tartomány-példa</A></H2>

<P> <B>Ahol bemutatunk néhány <EM>igazi</EM> zónaállományt</B></P>

<P> A felhasználók javasolták, hogy illesszem be egy mûködõ tartomány valós
példáját is, mint szemléltetõ példát.</P>

<P> E példát David Bullock engedélyével a LAND-5-tõl használom. Ezek az
állományok 1996. szeptember 24.-én voltak aktuálisak, és ezután
szerkesztettem át õket, hogy megfeleljenek a 8-as BIND megkötéseinek és
kiterjesztés-használatának. Szóval az amit látsz, különbözik egy kicsit
attól, amit a LAND-5 névszerverek lekérdezésekor találsz.</P>

<H2><A NAME="ss7.1">7.1 /etc/named.conf (vagy /var/named/named.conf)</A>
</H2>

<P> Itt találhatók az elsõdleges szerver zónafejezetei a két szükséges fordított zóna
számára: a 127.0.0 hálózat éppúgy, mint a LAND-5 <CODE>206.6.177</CODE>-es
alhálózata, és az elsõdleges sor a land-5 <CODE>land5.com</CODE> továbbító zónája
számára. Figyeld meg, hogy az állományok <CODE>pz</CODE> nevû könyvtárba való
pakolása helyett, ahogy én ezt ebben a HOGYANban teszem, õ a <CODE>zone</CODE> nevû
könyvtárba rakja õket.</P>
<P>
<HR>
<PRE>
// Boot file for LAND-5 name server

options {
        directory "/var/named";
};

controls {
        inet 127.0.0.1 allow { localhost; } keys { rndc_key; };
};

key "rndc_key" {
        algorithm hmac-md5;
        secret "c3Ryb25nIGVub3VnaCBmb3IgYSBtYW4gYnV0IG1hZGUgZm9yIGEgd29tYW4K";
};

zone "." {
        type hint;
        file "root.hints";
};

zone "0.0.127.in-addr.arpa" {
        type master;
        file "zone/127.0.0";
};

zone "land-5.com" {
        type master;
        file "zone/land-5.com";
};

zone "177.6.206.in-addr.arpa" {
        type master;
        file "zone/206.6.177";
};
</PRE>
<HR>
</P>

<P> Ha ezt berakod a named.conf állományodba kísérletezés céljából, <B>KÉRLEK</B> 
rakd be a "<CODE>notify no;</CODE>"-t a két <CODE>land-5</CODE> zóna zone fejezetébe, hogy
elkerüljük az ütközéseket.</P>

<H2><A NAME="ss7.2">7.2 /var/named/root.hints</A>
</H2>

<P> Tartsd szem elõtt, hogy ez az állomány dinamikus, és az itt közzétett
változat régi. Jobban teszed ha egy újabbat használsz, amint
azt már korábban elmagyaráztam.</P>
<P>
<HR>
<PRE>
; &lt;&lt;>> DiG 8.1 &lt;&lt;>> @A.ROOT-SERVERS.NET.
; (1 server found)
;; res options: init recurs defnam dnsrch
;; got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 10
;; flags: qr aa rd; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 13
;; QUERY SECTION:
;;      ., type = NS, class = IN

;; ANSWER SECTION:
.                       6D IN NS        G.ROOT-SERVERS.NET.
.                       6D IN NS        J.ROOT-SERVERS.NET.
.                       6D IN NS        K.ROOT-SERVERS.NET.
.                       6D IN NS        L.ROOT-SERVERS.NET.
.                       6D IN NS        M.ROOT-SERVERS.NET.
.                       6D IN NS        A.ROOT-SERVERS.NET.
.                       6D IN NS        H.ROOT-SERVERS.NET.
.                       6D IN NS        B.ROOT-SERVERS.NET.
.                       6D IN NS        C.ROOT-SERVERS.NET.
.                       6D IN NS        D.ROOT-SERVERS.NET.
.                       6D IN NS        E.ROOT-SERVERS.NET.
.                       6D IN NS        I.ROOT-SERVERS.NET.
.                       6D IN NS        F.ROOT-SERVERS.NET.

;; ADDITIONAL SECTION:
G.ROOT-SERVERS.NET.     5w6d16h IN A    192.112.36.4
J.ROOT-SERVERS.NET.     5w6d16h IN A    198.41.0.10
K.ROOT-SERVERS.NET.     5w6d16h IN A    193.0.14.129
L.ROOT-SERVERS.NET.     5w6d16h IN A    198.32.64.12
M.ROOT-SERVERS.NET.     5w6d16h IN A    202.12.27.33
A.ROOT-SERVERS.NET.     5w6d16h IN A    198.41.0.4
H.ROOT-SERVERS.NET.     5w6d16h IN A    128.63.2.53
B.ROOT-SERVERS.NET.     5w6d16h IN A    128.9.0.107
C.ROOT-SERVERS.NET.     5w6d16h IN A    192.33.4.12
D.ROOT-SERVERS.NET.     5w6d16h IN A    128.8.10.90
E.ROOT-SERVERS.NET.     5w6d16h IN A    192.203.230.10
I.ROOT-SERVERS.NET.     5w6d16h IN A    192.36.148.17
F.ROOT-SERVERS.NET.     5w6d16h IN A    192.5.5.241

;; Total query time: 215 msec
;; FROM: roke.uio.no to SERVER: A.ROOT-SERVERS.NET.  198.41.0.4
;; WHEN: Sun Feb 15 01:22:51 1998
;; MSG SIZE  sent: 17  rcvd: 436
</PRE>
<HR>
</P>

<H2><A NAME="ss7.3">7.3 /var/named/zone/127.0.0</A>
</H2>

<P> Csak az alapok, a kötelezõ SOA bejegyzés, és a bejegyzés, mely a
127.0.0.1-et a <CODE>localhost</CODE>-hoz rendeli. Mindkettõ szükséges. Semmi másnak
nem kell lennie ebben az állományban. Valószínûleg soha nem lesz
frissítve, hacsak a névszervered vagy a rendszergazda címe nem változik
meg.</P>
<P>
<HR>
<PRE>
$TTL 3D
@               IN      SOA     land-5.com. root.land-5.com. (
                                199609203       ; Serial
                                28800   ; Refresh
                                7200    ; Retry
                                604800  ; Expire
                                86400)  ; Minimum TTL
                        NS      land-5.com.

1                       PTR     localhost.
</PRE>
<HR>
</P>

<P>Ha egy véletlenszerûen kiválasztott BIND telepítésre ránézel, azt fogod
találni, hogy a <CODE>$TTL</CODE> sor hiányzik. Ezt azelõtt nem használták, és csak a
8.2-es BIND kezdett el figyelmeztetni a hiányára. A 9-es BIND-hez
<EM>szükséges</EM> a <CODE>$TTL</CODE>.</P>

<H2><A NAME="ss7.4">7.4 /var/named/zone/land-5.com</A>
</H2>

<P> Itt látjuk a kötelezõ SOA bejegyzést, a szükséges NS bejegyzéseket.
Láthatjuk, hogy van egy másodlagos névszervere az <CODE>ns2.psi.net</CODE>-en. Ez az
ahogy lennie kell, mindig legyen egy telephelyen kívüli másodlagos
szervered tartalékként. Láthatjuk azt is, hogy van neki egy <CODE>land-5</CODE> nevû
elsõdleges gépe is, amely gondoskodik sok különbözõ Internet
szolgáltatásról, és azt, hogy ezt CNAME-ekkel csinálta (egy másik
lehetõség az "A" bejegyzések használata).</P>

<P> Amint azt a SOA bejegyzésbõl láthatod, a zónaállomány eredete a
<CODE>land-5.com</CODE>, a kapcsolattartó személy a <CODE>root@land-5.com</CODE>. 
A <CODE>hostmaster</CODE> egy másik gyakran használt cím a kapcsolattartó
személy számára. A sorozatszám a szokásos ééééhhnn formátumban van, a
mai sorozatszám hozzáadásával; ez valószínûleg a zónaállomány hatodik
változata 1996. szeptember 20.-án. Jegyezd meg, hogy a sorozatszámnak
monoton növekvõnek <EM>kell</EM> lennie, itt csak <EM>egy</EM> számjegy jelzi a mai
sorozatszámot, így 9 szerkesztés után várnia kell holnapig, mielõtt újra
szerkesztheti az állományt. Szokd meg a két számjegy használatát.</P>
<P>
<HR>
<PRE>
$TTL 3D
@       IN      SOA     land-5.com. root.land-5.com. (
                        199609206       ; serial, todays date + todays serial #
                        8H              ; refresh, seconds
                        2H              ; retry, seconds
                        4W              ; expire, seconds
                        1D )            ; minimum, seconds
                NS      land-5.com.
                NS      ns2.psi.net.
                MX      10 land-5.com.  ; Primary Mail Exchanger
                TXT     "LAND-5 Corporation"

localhost       A       127.0.0.1
router          A       206.6.177.1
land-5.com.     A       206.6.177.2
ns              A       206.6.177.3
www             A       207.159.141.192
ftp             CNAME   land-5.com.
mail            CNAME   land-5.com.
news            CNAME   land-5.com.
funn            A       206.6.177.2

;
;       Workstations
;
ws-177200       A       206.6.177.200
                MX      10 land-5.com.   ; Primary Mail Host
ws-177201       A       206.6.177.201
                MX      10 land-5.com.   ; Primary Mail Host
ws-177202       A       206.6.177.202
                MX      10 land-5.com.   ; Primary Mail Host
ws-177203       A       206.6.177.203
                MX      10 land-5.com.   ; Primary Mail Host
ws-177204       A       206.6.177.204
                MX      10 land-5.com.   ; Primary Mail Host
ws-177205       A       206.6.177.205
                MX      10 land-5.com.   ; Primary Mail Host
; {Many repetitive definitions deleted - SNIP}
ws-177250       A       206.6.177.250
                MX      10 land-5.com.   ; Primary Mail Host
ws-177251       A       206.6.177.251
                MX      10 land-5.com.   ; Primary Mail Host
ws-177252       A       206.6.177.252
                MX      10 land-5.com.   ; Primary Mail Host
ws-177253       A       206.6.177.253
                MX      10 land-5.com.   ; Primary Mail Host
ws-177254       A       206.6.177.254
                MX      10 land-5.com.   ; Primary Mail Host
</PRE>
<HR>
</P>

<P> Ha megvizsgálod a land-5 névszerverét, azt találod, hogy a gépnevek
<CODE>ws_</CODE><EM>szám</EM> alakúak. A 4-es BIND-tõl kezdõdõen a named elkezdte
szigorítani a megkötéseket, hogy milyen karakterek szerepelhetnek a
gépnevekben. Így ez a 8-as BIND-el egyáltalán nem mûködik, és én
kicseréltem a "-"-re (kötõjel) a "_"-t (aláhúzás) ebben a HOGYANban.
De ahogy azt korábban említettem, a 9-es BIND nem erõlteti már ezt a
megkötést.</P>

<P> A másik figyelemre méltó dolog az, hogy a munkaállomásoknak nincs egyedi
nevük, hanem csak egy elõtagot követ az IP utolsó két része. Egy ilyen
megszokás használata jelentõsen leegyszerûsítheti a karbantartást, de
egy kicsit személytelennek tûnhet, és lényegében bosszúság forrása lehet az
ügyfeleid számára.</P>

<P> Látjuk azt is, hogy a <CODE>funn.land-5.com</CODE> egy álnév a <CODE>land-5.com</CODE> számára, de
egy "A", és nem egy CNAME bejegyzés használatával.</P>

<H2><A NAME="ss7.5">7.5 /var/named/zone/206.6.177</A>
</H2>

<P> Megjegyzéseket ezen állományra lentebb teszek.</P>
<P>
<HR>
<PRE>
$TTL 3D
@               IN      SOA     land-5.com. root.land-5.com. (
                                199609206       ; Serial
                                28800   ; Refresh
                                7200    ; Retry
                                604800  ; Expire
                                86400)  ; Minimum TTL
                        NS      land-5.com.
                        NS      ns2.psi.net.

;       Servers
;
1       PTR     router.land-5.com.
2       PTR     land-5.com.
2       PTR     funn.land-5.com.
;
;       Workstations
;
200     PTR     ws-177200.land-5.com.
201     PTR     ws-177201.land-5.com.
202     PTR     ws-177202.land-5.com.
203     PTR     ws-177203.land-5.com.
204     PTR     ws-177204.land-5.com.
205     PTR     ws-177205.land-5.com.
; {Many repetitive definitions deleted - SNIP}
250     PTR     ws-177250.land-5.com.
251     PTR     ws-177251.land-5.com.
252     PTR     ws-177252.land-5.com.
253     PTR     ws-177253.land-5.com.
254     PTR     ws-177254.land-5.com.
</PRE>
<HR>
</P>

<P> A fordított zóna a beállítás azon része, mely a legtöbb fejtörést
okozhatja. Ezt arra használjuk, hogy megtaláljuk a gépnevet, ha megvan a
gép címe. Példa: te egy FTP szerver vagy és kapcsolatokat fogadsz el FTP
kliensektõl. Mivel te egy norvég FTP szerver vagy, több kapcsolatot
szeretnél fogadni norvégiai és más skandináv államokbeli kliensektõl, és
kevesebbet a világ többi részérõl. Ha kapcsolat érkezik egy klienstõl, a
C függvénykönyvtár képes neked megmondani a csatlakozó gép IP címét,
mert a kliens IP számát tartalmazza az összes csomag, amely átjött a
hálózaton. Most meghívhatsz egy gethostbyaddr nevû függvényt, mely
kikeresi az adott IP számú kliens nevét. A gethostbyaddr meg fogja
kérdezni a DNS szervert, amely ezután keresztülmegy a DNS-en a gépet
keresve. Tételezzük fel, hogy a klienskapcsolat a
ws-177200.land-5.com-tól jön. Az IP szám, amit a C könyvtár átad az FTP
szervernek, a 206.6.177.200. A gép nevének kitalálásához meg kell
találnunk a <CODE>200.177.6.206.in-addr-arpa</CODE>-t. A DNS szerver elõször meg
fogja találni az <CODE>arpa.</CODE> szervereket, majd megtalálja az <CODE>in-addr.arpa</CODE>
szervereket, követve a fordított sorrendet a 206-on, majd a 6-on
keresztül, végül legutoljára megtalálva a LAND-5-nél a szervert a
<CODE>177.6.206.in-addr-arpa</CODE> zóna számára. Amelytõl végül megkapja a választ,
hogy a <CODE>200.177.6.206.in-addr.arpa</CODE> számára a "<CODE>PTR ws-177200.land-5.com</CODE>"
bejegyzésünk van, ami azt jelenti, hogy a <CODE>/ 206.6.177.200</CODE>-hoz tartozó név
a <CODE>ws-177200.land.com</CODE>.</P>

<P> Az FTP szerver elõnyben részesíti a skandináv országok, azaz a <CODE> *.no</CODE>,
<CODE>*.se</CODE>, <CODE>*.dk</CODE> felõl érkezõ kapcsolatokat, a <CODE>ws-177200.land-5.com</CODE>
egyértelmûen nem tartozik közéjük, és a szerver a kapcsolatot egy
alacsonyabb sávszélességgel és kevesebb klienskapcsolati lehetõséggel
rendelkezõ kapcsolati osztályba sorolja. Ha <EM>nem</EM> lenne fordított
megfeleltetése a <CODE>206.2.177.200</CODE>-nak az <CODE>in-addr.arpa</CODE> zóna által, a szerver
képtelen lenne megtalálni a nevet, és a <CODE>206.2.177.200</CODE>-nek a <CODE>*.no</CODE>,
<CODE>*.se</CODE> és <CODE>*.dk</CODE>-val való összehasonlítása alapján kell döntenie, melyek közül
egyik sem fog egyezni, sõt még meg is tagadhatja a kapcsolatot a
besorolás hiánya miatt.</P>

<P> Páran azt fogják mondani neked, hogy a fordított lekérdezések
hozzárendelése csak szerverek esetén fontos, vagy egyáltalán nem fontos.
Nem így van: sok ftp, news, IRC, sõt még néhány http (WWW) szerver <EM>nem</EM>
fognak kapcsolatot fogadni olyan gépektõl, melyek nevét képtelenek
megtalálni. Így hát a fordított hozzárendelés valójában <EM>kötelezõ</EM>.</P>

<H2><A NAME="maint"></A> <A NAME="s8">8. Karbantartás</A></H2>

<P> <B>Üzemben tartás.</B></P>

<P> Van egy karbantartási feladat, melyet meg kell tenned a named-eken - a
futtatáson kívül. Ez pedig a <CODE>root.hints</CODE> állomány naprakészen tartása.
A legegyszerûbb mód a <CODE>dig</CODE> használata. Elõször futtasd a <CODE>dig</CODE>-et
argumentumok nélkül, akkor megkapod a <CODE>root.hints</CODE>-et a saját szervered
alapján. Ezután kérdezd le a felsorolt fõszerverek egyikét a <CODE>dig
@rootserver</CODE> paranccsal. Észre fogod venni, hogy a kimenet szörnyen
hasonló a root.hints állományhoz. Mentsd el egy állományba (<CODE>dig
@e.root-servers.net . ns &gt; root.hints.new</CODE>), és cseréld le a régi
<CODE>root.hints</CODE> állományt vele.</P>

<P> Ne felejtsd el újra betölteni a named-et a gyorsítótár-állomány cseréje
után.</P>

<P> Al Longyear elküldte nekem ezt a szkriptet, mely automatikusan
futtatható a <CODE>root.hints</CODE> frissítése érdekében. Telepíts egy crontab
bejegyzést, hogy havonta egyszer lefusson, és el is felejtheted. A
szkript feltételezi, hogy a levelezésed mûködik, és hogy a "hostmaster"
cím meg van adva. Meg kell hackelned, hogy illeszkedjen a beállításaidhoz.</P>
<P>
<HR>
<PRE>
#!/bin/sh
#
# Update the nameserver cache information file once per month.
# This is run automatically by a cron entry.
#
# Original by Al Longyear
# Updated for BIND 8 by Nicolai Langfeldt
# Miscelanious error-conditions reported by David A. Ranch
# Ping test suggested by Martin Foster
# named up-test suggested by Erik Bryer.
#
(
 echo "To: hostmaster &lt;hostmaster>"
 echo "From: system &lt;root>"

 # Is named up? Check the status of named.
 case `rndc status 2>&amp;1` in
    *refused*)
        echo "named is DOWN. root.hints was NOT updated"
        echo
        exit 0
        ;;
 esac

 PATH=/sbin:/usr/sbin:/bin:/usr/bin:
 export PATH
 # NOTE: /var/named must be writable only by trusted users or this script
 # will cause root compromise/denial of service opportunities.
 cd /var/named 2>/dev/null || {
    echo "Subject: Cannot cd to /var/named, error $?"
    echo
    echo "The subject says it all"
    exit 1
 }

 # Are we online?  Ping a server at your ISP
 case `ping -qnc 1 some.machine.net 2>&amp;1` in
   *'100% packet loss'*)
        echo "Subject: root.hints NOT updated.  The network is DOWN."
        echo
        echo "The subject says it all"
        exit 1
        ;;
 esac

 dig @e.root-servers.net . ns >root.hints.new 2> errors

 case `cat root.hints.new` in
   *NOERROR*)
        # It worked
        :;;
   *)
        echo "Subject: The root.hints file update has FAILED."
        echo
        echo "The root.hints update has failed"
        echo "This is the dig output reported:"
        echo
        cat root.hints.new errors
        exit 1
        ;;
 esac

 echo "Subject: The root.hints file has been updated"

 echo
 echo "The root.hints file has been updated to contain the following
information:"
 echo
 cat root.hints.new

 chown root.root root.hints.new
 chmod 444 root.hints.new
 rm -f root.hints.old errors
 mv root.hints root.hints.old
 mv root.hints.new root.hints
 rndc restart
 echo
 echo "The nameserver has been restarted to ensure that the update is complete."
 echo "The previous root.hints file is now called
/var/named/root.hints.old."
) 2>&amp;1 | /usr/lib/sendmail -t
exit 0
</PRE>
<HR>
</P>

<P> Néhányan közületek felfigyelhettek rá, hogy a <CODE>root.hints</CODE> állomány
elérhetõ ftp-vel az Internic-rõl is. Kérlek, ne használd az ftp-t a
<CODE>root.hints</CODE> frissítéséhez, a fentebb említett módszer sokkal
barátságosabb a hálózat és az Internic számára.</P>

<H2><A NAME="s9">9. Átállás 9-es BIND-re</A></H2>

<P> A 9-es BIND terjesztés - és az elõre elkészített változatok szintén -
tartalmaz egy <CODE>migration</CODE> nevû dokumentumot, amely megjegyzéseket
tartalmaz azt illetõen, hogy hogyan álljunk át 8-as BIND-rõl 9-es
BIND-re. A dokumentum nagyon lényegre törõ. Ha bináris csomagokat
telepítettél, feltehetõen valahol a <CODE>/usr/share/doc/bind*</CODE>-ban vagy a
<CODE>/usr/doc/bind*</CODE>-ban van tárolva.</P>

<P> Ha 4-es BIND-et futtatsz, a <CODE>migration-4to9</CODE> dokumentumot ugyanazon a
helyen találhatod.</P>

<H2><A NAME="qanda"></A> <A NAME="s10">10. Kérdések és válaszok</A></H2>

<P> Kérlek olvasd át ezt a fejezetet, mielõtt írsz nekem.
<OL>
<LI>  A named-em egy named.boot állományt akar

<P> Rossz HOGYANt olvasol. Kérlek nézd meg ezen HOGYAN régebbi
változatát, amely a 4-es BIND-rõl szól, a 
<A HREF="       http://langfeldt.net/DNS-HOWTO/">       http://langfeldt.net/DNS-HOWTO/</A> címen.</P>

</LI>
<LI>  Hogy használhatom egy tûzfal mögül?

<P> Segítség: <CODE>forward only;</CODE>. Szükséged lehet még a</P>
<P>
<HR>
<PRE>
  query-source port 53;
</PRE>
<HR>
</P>
<P>sorra a <CODE>named.conf</CODE> állomány "options" részén belül, ahogy az a
példának bemutatott 
<A HREF="#caching">A feloldó, gyorsítótáras névszerver </A> fejezetben javasoltam.</P>

</LI>
<LI>  Mit tegyek, hogy a DNS körbeforogjon egy szolgáltatás elérhetõ
címein, mondjuk a www.busy.site-on, hogy terheléselosztó vagy
valami hasonló hatást érjek el?

<P> Csinálj több <B>A</B> bejegyzést a <CODE>www.busy.site</CODE> számára, és 4.9.3-as
vagy késõbbi BIND-et használj. Ekkor a BIND round-robin rendszer
alapján fogja szolgáltatni a válaszokat. Ez <EM>nem</EM> fog mûködni a
BIND korábbi változataival.</P>

</LI>
<LI>  DNS-t akarok beállítani egy (zárt) belsõ hálózaton. Mit csináljak?

<P> Kihagyod a <CODE>root.hints</CODE> állományt, és csak a zónaállományokat
készíted el. Ez azt is jelenti, hogy nem kell állandóan
útbaigazító állományokat letöltened.</P>

</LI>
<LI>  Hogyan kell beállítani egy másodlagos (slave) névszervert?

<P> Ha az elsõdleges szerver címe 127.0.0.1, egy ehhez hasonló
sort szúrsz be a másodlagos szervered named.conf állományába:</P>
<P>
<HR>
<PRE>
  zone "linux.bogus" {
        type slave;
        file "sz/linux.bogus";
        masters { 127.0.0.1; };
  };
</PRE>
<HR>
</P>
<P>Több különbözõ elsõdleges szervert is felsorolhatsz a masters listán
belül, ";"-vel (pontosvesszõ) elválasztva, melyekrõl a zóna
lemásolható.</P>

</LI>
<LI>  Futtatni akarom a BIND-et, amikor nem vagyok kapcsolódva a hálózathoz.

<P> Négy lehetõség van:</P>
<P>
<UL>
<LI>A 8/9-es BIND-re vonatkozóan, Adam L.Rice ezt a levelet
küldte nekem arról, hogyan futtassuk fájdalommentesen a
DNS-t egy betárcsázós gépen:

<BLOCKQUOTE><CODE>
<PRE>

A BIND újabb változatainál felfedeztem, hogy ez a kavarás az
állományokkal többé nem szükséges. Van egy "forward" (továbbítás) direktíva
a "forwarders" (továbbítók) direktíva mellett, amely a használatukat ellenõrzi.
Az alap beállítás a "forward first" (elõször továbbítsd), amely
legelõször megkérdezi a továbbítók mindegyikét, és ezután próbálja
a rendes megközelítést, azaz a munka saját kezû elvégzését, ha ez nem sikerül.
Ezzel a gethostbyname() normál viselkedésése szokatlanul hosszú idõt
vesz igénybe, amikor a kapcsolat nincs meg. De ha a "forward only" (csak
továbbítsd) van beállítva, akkor a BIND feladja ha nem kap választ a
továbbítóktól, és a gethostbyname() azonnal visszatér. Ennélfogva nincs
szükség bûvészmutatványokra az /etc könyvtárban levõ állományokkal, és a szerver újraindítására.

Az én esetemben, csak hozzáadtam a

forward only;
forwarders { 193.133.58.5; };

sorokat a named.conf állományom options { } fejezetéhez. Nagyon szépen
mûködik. Ennek egyetlen hátránya az, hogy degradálja a DNS szoftver
egy hihetetlenül szofisztikált részét egy buta gyorsítótárrá. Bizonyos
mértékben, én csak egy buta gyorsítótárat szeretnék futtatni a DNS
helyett, de úgy tûnik, nincs egy ilyen fajta elérhetõ szoftver Linuxra.
</PRE>
</CODE></BLOCKQUOTE>

</LI>
<LI>  Ezt a levelet Ian Clark-tól &lt;ic@deakin.edu.au&gt; kaptam,
amiben az õ módszerét magyarázza erre:

<BLOCKQUOTE><CODE>
<PRE>
Named-et futtatok itt a "Masquerading" gépemen. Van két root.hints
állományom, az egyik neve root.hints.real, amely a valódi fõszerver-
neveket tartalmazza, a másiké root.hints.fake, amely ezt tartalmazza:

----
; root.hints.fake
; this file contains no information
----

Ha kapcsolat nélküli üzemmódba megyek át, átmásolom a root.hints.fake
állományt a root.hints-be, és újraindítom a named-et.

Ha kapcsolódom, átmásolom a root.hints.real-t a root.hints-be, és
újraindítom a named-et.

Illetve ezt az ip-down és az ip-up teszi meg.
Amikor elõször végzek egy lekérdezést kapcsolat nélkül egy olyan
tartománynévre, amelyrõl a named nem tudja a részleteket, egy ilyen bejegyzést rak a messages-be:

Jan 28 20:10:11 hazchem named[10147]: No root nameserver for class IN

amivel együtt tudok élni.

Ez biztosan mûködik számomra. Használhatom a névszervert a helyi
gépek esetében, amikor a Net áll, a külsõ tartománynevekhez tartozó
idõtúllépési késleltetés nélkül, és mikor a Hálón vagyok, a külsõ
tartománynevekre vonatkozó lekérdezések rendben mûködnek
</PRE>
</CODE></BLOCKQUOTE>


<P>  Peter Denison azonban úgy vélte, Ian nem ment el elég
messzire. Ezt írja:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
Kapcsolódva)    szolgáltatja az eltárolt (és helyi hálózati) bejegyzéseket azonnal
a nem gyorsítótárazott bejegyzések esetén, továbbítja az ISP névszerverem felé
Kapcsolat nélkül) kiszolgálja a helyi hálózati lekérdezéseket azonnal
más lekérdezések esetén **azonnal** hibát ad

A fõ gyorsítótáras állomány cseréjének és a lekérdezések továbbításának
kombinációja nem mûködik.

Így hát, (a helyi Linux Felhasználók Csoportjával való némi konzultáció után)
két named-et állítottam be a következõ módon:

named-online:   továbbít az ISP névszervere felé
                mester a helyi hálózati zóna számára
                mester a helyi hálózati fordított zóna számára (1.168.192.in-addr.arpa)
                mester a 0.0.127.in-addr.arpa számára
                a 60053-as porton figyel

named-offline:  nincs továbbítás
                "ál" fõ gyorsítótáras állomány
                szolga a 3 helyi zóna számára (a mester a 127.0.0.1:60053)
                a 61053-as porton figyel

És kombináltam ezt a port-továbbítással, hogy az 53-as portot elküldje a 61053-ra, ha
kapcsolat nélkül vagyok, és a 60053-ra, ha csatlakoztam. (Az új netfilter csomagot
használom 2.3.18 alatt, de a régi (ipchains) módszernek is mûködnie kell.)

Figyelem, ez nem fog pikk-pakk mûködni, mivel van egy apró hiba a 8.2-es
BIND-ben, melyet már jelentettem a fejlesztõknek, hogy megakadályozza egy másodlagos szerver
létrehozását az elsõdlegessel megegyezõ IP címen (még ha külön porton is). Ez egy
egyszerû foltozás, és remélem, nemsokára belekerül.
</PRE>
</CODE></BLOCKQUOTE>
</P>

</LI>
<LI>  Kaptam információt arról is Karl-Max Wanger-tõl, hogyan hat
egymásra a BIND az NFS-el és a portmapper-rel egy
nagyobbrészt kapcsolat nélküli gépen:

<BLOCKQUOTE><CODE>
<PRE>

Futtatni szoktam a saját named-emet az összes gépemen, melyek csak
alkalmilag csatlakoznak az Internetre modemen keresztül. A névszerver
csak gyorsítótárként mûködik, nincs jogosultsági területe, és mindenért
a root.cache állományban levõ névszervereket kérdezi vissza. Ahogy az a
Slackware-nél megszokott, az nfsd és a mountd elõtt van indítva.

Egyik gépemmel (egy Libretto 30-as notebookal) az volt a problémám,
hogy néha fel tudtam csatolni egy másik, a helyi LAN-omra csatlakozott
rendszerrõl, de nagyobbrészt ez nem mûködött. Ugyanez volt a jelenség,
függetlenül attól, hogy PLIP-et, egy PCMCIA ethernet kártyát vagy soros
eszközön keresztüli PPP-t használtam.

Némi találgatás és kísérletezés után azt fedeztem fel, hogy
a named minden bizonnyal belerondít az nfsd és mountd regisztrációs folyamatába,
amit induláskor a portmapper-rel kell elvégezniük (Ezeket a démonokat
szokás szerint bootoláskor indítom). A named indítása az nfsd és a mountd
után teljesen semlegesítette ezt a problémát.

Mivel nincsenek várható hátrányai az ilyen módosított boot szekvenciának,
ajánlom, hogy mindenki tegyen így az esetleges gondok elkerülése végett.
</PRE>
</CODE></BLOCKQUOTE>

</LI>
</UL>
</P>

</LI>
<LI>  Hol tárolja a gyorsítótáras névszerver a gyorsítótárát? Van rá
bármi mód, hogy ellenõrizzem a gyorsítótár méretét?

<P> A gyorsítótár teljes mértékben a memóriában van tárolva, soha <EM>nem</EM>
kerül kiírásra a lemezre. Valamennyiszer lelövöd a named-et, a
gyorsítótár elveszik. A gyorsítótár semmilyen módon <EM>nem</EM>
ellenõrizhetõ, a named gondozza néhány egyszerû szabály alapján,
és ennyi. Nem ellenõrizheted a gyorsítótárat, vagy annak méretét
semmilyen módon és semmiképp. Ha akarod, "kijavíthatod" ezt a
named hackelésével. Ez azonban nem ajánlott.</P>

</LI>
<LI>  Lementi a named a gyorsítótárat az újraindítások között?
Megcsinálhatom, hogy így legyen?

<P> Nem, a named <EM>nem</EM> menti le, ha meghal. Ez azt jelenti, hogy a
gyorsítótárat újra fel kell építeni minden alkalommal, amikor
lelövöd és újraindítod a named-et. <EM>Nincs</EM> mód rá, hogy rávedd a
named-et, hogy lementse gyorsítótárát egy állományba. Ha akarod,
"kijavíthatod" ezt a named hackelésével. Ez azonban nem ajánlott.</P>

</LI>
<LI>  Hogyan szerezhetek be egy tartományt? Fel akarom állítani
(például) a <CODE>linux-rules.net</CODE> nevû tartományomat. Hogyan tehetem
meg, hogy az általam kívánt tartományt hozzám rendeljék?

<P> Kérlek lépj kapcsolatba a hálózati szolgáltatóddal. Õk képesek
lesznek segíteni neked. Kérlek vedd figyelembe, hogy a világ
legtöbb részén pénzt kell fizetned egy tartományért.</P>

</LI>
<LI>  Hogyan tehetem biztonságossá a DNS szerveremet? Hogyan állíthatok
be felosztott DNS-t?

<P> Mindkettõ haladó téma. A 
<A HREF="http://www.etherboy.com/dns/chrootdns.html">http://www.etherboy.com/dns/chrootdns.html</A> honlap szól róluk. Nem fogom
ezeket a témákat tovább magyarázni itt.</P>

</LI>
</OL>
</P>

<H2><A NAME="bigger"></A> <A NAME="s11">11. Hogyan válhatok képzettebb DNS adminná?</A></H2>

<P> <B>Dokumentáció és eszközök.</B></P>

<P> Létezik Valódi Dokumentáció. Azonnal olvasható (online) és nyomtatott. Ezek közül néhány
elolvasása követelmény a kezdõ DNS adminból egy haladó adminná váláshoz.</P>

<P> Megírtam a <EM>The Concise Guide to DNS and BIND</EM> (Nicolai Langfeldt, én)
könyvet, kiadta a Que (ISBN 0-7897-2273-9). A könyv hasonlatos ehhez a
HOGYANhoz, csak részletesebb, és mindenbõl sokkal több van benne. Le
van fordítva lengyelre is, és <EM>DNS i BIND</EM> kiadva a Helion által
( 
<A HREF="http://helion.pl/ksiazki/dnsbin.htm">http://helion.pl/ksiazki/dnsbin.htm</A>, ISBN 83-7197-446-9). Most van
negyedik kiadásban a <EM>DNS and BIND</EM> Cricket Liu-tól és P. Albitz-tõl az
O'Reilly &amp; Associates gondozásában (ISBN 0-937175-82-X, elõszeretettel
nevezve a Cricket könyvnek). Egy másik könyv a <EM>Linux DNS Server
Administration</EM>, Craig Hunt-tól, a Sybex kiadásában (ISBN 0782127363),
még nem olvastam el. Egy másik követelmény a képzett DNS adminisztrátor
számára a <EM>Zen and the Art of Motorcycle Maintenance</EM> Robert M. Pirsig-tõl.</P>

<P> Megtalálhatod a könyvemet azonnal olvasható formában (online), más könyvek tonnáival együtt, amelyek
elektronikusan elérhetõk mint elõfizetéses szolgáltatás a
<A HREF="http://safari.informit.com/">http://safari.informit.com/</A> honlapon. Van még anyag a
<A HREF="http://www.dns.net/dnsrd/">http://www.dns.net/dnsrd/</A> (DNS Resources Directory),
<A HREF="http://www.isc.org/bind.html">http://www.isc.org/bind.html</A> címen; Egy GYIK, egy referencia kézikönyv
(az ARM-nak szintén benne kell lennie a BIND disztribúcióban) éppúgy,
mint papírok és protokoll definíciók, és DNS hackek (ezeket, és a
legtöbb, ha nem az összes, lentebb említett RFC-t, szintén tartalmazza a
DNS disztribúció). Többségét nem olvastam. A
<A HREF="news:comp.protocols.tcp-ip.domains">news:comp.protocols.tcp-ip.domains</A> hírcsoport a DNS-rõl szól. Ezekhez
adódóan van egy pár RFC a DNS-rõl, a legfontosabbak valószínûleg az
itt felsoroltak. Azok, melyeknek van BCP (Best Current Practice -
Legjobb Jelenlegi Gyakorlat) száma, <EM>erõsen ajánlottak</EM>.</P>
<P>
<DL>
<DT><B>/RFC 2671/
P. Vixie, <EM>Extension Mechanisms for DNS (EDNS0)</EM> 1999 augusztus. (DNS
kiterjesztési mechanizmusok)</B><DD>
<DT><B>/RFC 2317/</B><DD><P>BCP 20, H. Eidnes et. al. <EM>Classless IN-ADDR.ARPA delegation</EM>, 
1998 március. (Osztályon kívüli IN-ADDR.ARPA delegálás) Ez a CIDR-rõl
szól, vagy az osztályon kívüli alhálózatok fordított lekérdezésérõl.</P>

<DT><B>/RFC 2308/</B><DD><P>M. Andrews, <EM>Negative Caching of DNS Queries</EM>, 1998 március. (A DNS
lekérdezések negatív gyorsítótárazása) A negatív gyorsítótárazásról
és a $TTL zónaállomány direktíváról.</P>

<DT><B>/RFC 2219/</B><DD><P>BCP 17, M. Hamilton and R. Wright, <EM>Use of DNS Aliases for Network
Services</EM>, 1997 október. (A DNS álnevek használata hálózati
szolgáltatások céljára) A CNAME használatáról.</P>

<DT><B>/RFC 2182/</B><DD><P>BCP 16, R. Elz et. al., <EM>Selection and Operation of Secondary DNS
Servers</EM>, 1997 július. (A másodlagos DNS szerverek kiválasztása és
mûködtetése)</P>

<DT><B>/RFC 2052/</B><DD><P>A. Gulbrandsen, P. Vixie, <EM>A DNS RR for specifying the location of
services (DNS SRV)</EM>, October 1996 (Egy DNS RR a szolgáltatások
helymeghatározására)</P>

<DT><B>/RFC 1918/</B><DD><P>Y. Rekhter, R. Moskowitz, D. Karrenberg, G. de Groot, E. Lear,
<EM>Address Allocation for Private Internets</EM>, 1996.02.29.
(Címlefoglalás magán Internetek számára)</P>

<DT><B>/RFC 1912/</B><DD><P>D. Barr, <EM>Common DNS Operational and Configuration Errors</EM>,
1996.02.28. (Gyakori üzemeltetési és beállítási DNS hibák)</P>

<DT><B>/RFC 1912 Errors/</B><DD><P>B. Barr <EM>/Errors in RFC 1912</EM>. (Hibák az RFC 1912-ben/ Csak a
<A HREF="http://www.cis.ohio-state.edu/~barr/rfc1912-errors.html">http://www.cis.ohio-state.edu/~barr/rfc1912-errors.html</A> címen érhetõ el.</P>

<DT><B>/RFC 1713/</B><DD><P>A. Romao, <EM>Tools for DNS debugging</EM>, 1994.11.03. (A DNS hibakeresés
eszközei)</P>

<DT><B>/RFC 1712/</B><DD><P>C. Farrell, M. Schulze, S. Pleitner, D. Baldoni, <EM>DNS Encoding of
Geographical Location</EM>, 1994.11.01. (A földrajzi helyek DNS-be
kódolása)</P>

<DT><B>/RFC 1183/</B><DD><P>R. Ullmann, P. Mockapetris, L. Mamakos, C. Everhart, <EM>New DNS RR
Definitions</EM>, 1990.10.08. (Új DNS RR meghatározások)</P>

<DT><B>/RFC 1035/</B><DD><P>P. Mockapetris, <EM>Domain names - implementation and specification</EM>,
1987.11.01. (Tartománynevek - implementáció és specifikáció)</P>

<DT><B>/RFC 1034/</B><DD><P>P. Mockapetris, <EM>Domain names - concepts and facilities</EM>,
1987.11.01. (Tartománynevek - fogalmak és lehetõségek)</P>

<DT><B>/RFC 1033/</B><DD><P>M. Lottor, <EM>Domain administrators operations guide</EM>, 1987.1.01.
(Tartomány-adminisztrátorok üzemeltetõi útmutatója)</P>

<DT><B>/RFC 1032/</B><DD><P>M. Stahl, <EM>Domain administrators guide</EM>, 1987.11.01.</P>
<P>(Tartomány-adminisztrátorok útmutatója)</P>

<DT><B>/RFC 974/</B><DD><P>C. Partridge, <EM>Mail routing and the domain system</EM>, 1986.01.01.
(Levéltovábbítás és a tartományrendszer)</P>

</DL>
</P>

</BODY>
</HTML>
