<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
  "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
<!ENTITY howto      "http://www.traduc.org/docs/howto/lecture/">
<!ENTITY guide      "http://www.traduc.org/docs/guides/lecture/">
]>

<book id="Glibc-Install-Mini-Howto" lang="fr">

<bookinfo>
 <title>Petit guide pratique d'installation de la Glibc</title>
 <subtitle>Adaptation française du
 <foreignphrase>Glibc-Install-HOWTO</foreignphrase></subtitle>

 <authorgroup>
 <author>
      <firstname>Kai</firstname>
      <surname>Schlachter</surname>
      <email>linux CHEZ murphyslantech POINT de</email>
 </author>
</authorgroup>

      <othercredit role="traduction" class="translator">
	<firstname>Nicolas</firstname>
	<surname>Jadot</surname>
	<contrib>Adaptation française</contrib>
        <email>0673346726 CHEZ orange POINT fr</email>
      </othercredit>

<!-- À décommenter et à compléter par le relecteur

    <othercredit role="relecture" class="translator">
      <firstname>Jean</firstname>
      <surname>Dupont</surname>
      <contrib>Relecture de la version française</contrib>
      <email>jeanr CHEZ dupont POINT org</email>
    </othercredit>
-->

    <othercredit role="publication" class="copyeditor">
      <firstname>Jean-Philippe</firstname>
      <surname>Guérard</surname>
      <contrib>Préparation de la publication de la v.f.</contrib>
      <email>fevrier CHEZ tigreraye POINT org</email>
    </othercredit>


   <releaseinfo>Version&nbsp;:1.01.fr.1.0</releaseinfo>

   <pubdate>25 janvier 2005</pubdate> 

   <revhistory>

    <revision>
      <revnumber>1.01.fr.1.0</revnumber>
      <date>2005-01-25</date>
      <authorinitials>NJ</authorinitials>
      <revremark>Première traduction française</revremark>
    </revision>

    <revision>
      <revnumber>1.01</revnumber>
      <date>2004-03-19</date>
      <authorinitials>KC</authorinitials>
      <revremark>
      
      Première édition, revue par le projet de documentation Linux
      (<emphasis lang="en">Initial Release, reviewed by LDP</emphasis>)
      
      </revremark>
      
    </revision>
    
   </revhistory>

</bookinfo>

<chapter id="preface">
<title>Préface</title>

<sect1 id="copyright">
<title>Copyright</title>
<para>Le texte ci-dessous est la licence de ce document. Ce texte fait
foi. Il est composé de la licence en anglais du document original,
suivi de la licence en français de sa traduction.</para>

<para>Copyright (c) 2004 by Kai Schlachter</para>

<para>Permission is granted to copy, distribute and/or modify this document
      under the terms of the GNU Free Documentation License, Version 1.2
      or any later version published by the Free Software Foundation;
      with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
      Texts.  A copy of the license is located at <ulink url="http://www.gnu.org/licenses/fdl.html" />.</para>

<para>La version française de ce document a été réalisée par Nicolas
Jadot (<emphasis>Relecteur, ajoute ton nom ;-)</emphasis>). La version
française de ce guide pratique est publiée en accord avec les termes
de la licence de documentation libre GNU (GFDL)&nbsp;; sans section
invariante, sans texte de première de couverture ni texte de quatrième
de couverture. Une copie de la licence est disponible sur <ulink
url="http://www.gnu.org/copyleft/fdl.html">http://www.gnu.org/copyleft/fdl.html</ulink>.</para>
</sect1>

<sect1 id="history">
<title>Historique</title>
<para>
<itemizedlist>
<listitem><para>v1.01&nbsp;: Correction de citations <!-- NDT : quotation -->
<!-- mark --> mal placées</para></listitem>
</itemizedlist>
</para>
</sect1> 

<sect1 id="thanks">
<title>Remerciements</title>
<para>Je tiens à remercier tout spécialement Nico Schmoigl qui m'a
aidé à remonter mon système après un crash dû à l'utilisation de
la commande <command>make install</command> pour glibc alors que mon
système était en plein fonctionnement. C'est la raison principale qui
m'a conduit à écrire ce petit guide pratique.</para>
<para>Je remercie également toutes les personnes qui m'ont aidé tout
du long de ce travail&nbsp;; utiliser le bon format de guide, trouver
les bonnes typographies, etc.</para>
</sect1>
</chapter>

<chapter id="introduction">
<title>Introduction</title>
<para>J'expliquerai dans ce guide pratique comment installer une
nouvelle version de la bibliothèque <productname>glibc</productname>
sur votre système.</para>
<para>J'ai écris ce manuel afin de protéger les autres utilisateurs
des problèmes que j'ai rencontrés.</para>
<para>Ce document est une sorte de ligne de vie, faite des
paramétrages et des méthodes qui ont fonctionné dans mon cas. L'auteur
décline toute responsabilité quant au contenu de ce document. Utilisez
les concepts, exemples et autres à vos risques et périls. 
Je vous recommande cependant vivement de sauvegarder
l'intégralité de votre système avant toute installation majeure et de
faire des sauvegardes régulières.</para>
<para>Si vous avez la moindre suggestion, ou si vous trouvez une autre
erreur dans une distribution, avec le moyen de la <emphasis>fixer</emphasis>,
faites le moi savoir, en m'écrivant à&nbsp;:

<email>linux CHEZ murphyslantech POINT de</email>.

</para>

<sect1 id="why">
<title>Pourquoi&nbsp;?</title>
<para>C'est effectivement une bonne question. Pour quelles raisons
peut-on avoir à installer une nouvelle version de glibc&nbsp;? Pour
plusieurs raisons&nbsp;:
<itemizedlist>
<listitem><para>Vous êtes développeur et avez besoin des
nouvelles fonctions de la bibliothèque&nbsp;;</para></listitem>
<listitem><para>Vous voulez compiler un programme qui nécessite la
nouvelle bibliothèque&nbsp;;</para></listitem>
<listitem><para>Vous aimez le frisson des erreurs et bugs <!-- NDT : -->
<!-- je n'aime pas "bogue"&nbsp;;-) --> des nouvelles versions
;-).</para></listitem>
</itemizedlist>
</para>
</sect1>

<sect1 id="what">
<title>Quoi&nbsp;?</title>
<para>Si vous ne savez pas ce qu'est vraiment glibc, ne vous inquiétez
pas&nbsp;! Quand j'ai eu mes premiers soucis avec un nouveau programme que
je voulais compiler, je savais simplement que ma version de glibc
n'était pas suffisante pour la compilation. Maintenant que j'en sais
davantage, je vais essayer d'expliquer de manière simple ce à quoi
sert glibc.</para>
<para>Le paquetage glibc contient une bibliothèque écrite en langage
C. Les bibliothèques sont des composants très utiles en programmation&nbsp;;
plut&ocirc;t que de réinventer la roue à partir du néant pour des
opérations comme le calcul de la racine carrée d'un nombre, ce type de
fonction est stocké dans des fichiers séparés &mdash; les bibliothèques.
Quand une nouvelle version d'une bibliothèque est publiée, elle
contient souvent de nouvelles fonctions, utilise des algorithmes plus
performants pour celles déjà existantes, et ainsi de suite.</para>
<para>C'est pourquoi certains programmes se plaignent de versions trop
anciennes de glibc&nbsp;: la version courante ne contient tout simplement
pas la fonction dont le programme a besoin pour son exécution.</para>
<para>Je sais que cette explication n'est pas techniquement correcte
dans tous les détails, mais elle donne une explication simple de
l'architecture sous-jacente.</para>
</sect1>
</chapter>

<chapter id="preparation">

<title>Préparatifs</title>

<para>L'installation de glibc n'est pas une tâche facile. Il
vous faudra effectuer un certain nombre d'opérations préalables,
spécialement pour le cas où quelque chose tournerait mal. C'est
ce qui m'est arrivé lors de ma première installation de glibc, et je
n'avais fait aucun de ces préparatifs.</para>

<sect1 id="stuff-you-will-need">

<title>Ce qu'il vous faut</title>

<para>Schématiquement, il vous faut deux choses&nbsp;: les logiciels dont
fonctionnent déjà sur votre machine (soit, les paquetages de votre
distribution) et les paquetages source de différents
programmes.</para>

<sect2 id="software-you-will-need">

<title>Les logiciels dont vous aurez besoin</title>

<itemizedlist>

<listitem><para>

un compilateur <productname>gcc</productname>
opérationnel&nbsp;;

</para></listitem>

<listitem><para>

une ancienne version de
<productname>glibc</productname>&nbsp;;-)&nbsp;;

</para></listitem>

<listitem><para>

les <productname>binutils GNU</productname>&nbsp;;

</para></listitem>

<listitem><para>

le programme <productname>GNU make</productname>&nbsp;;

</para></listitem>
<listitem><para>

le <productname>core-utils GNU</productname>&nbsp;;

</para></listitem>
<listitem><para>

le programme  <productname>GNU tar</productname>&nbsp;;

</para></listitem>
<listitem><para>

le shell<productname>bash</productname> ou tout autre
de votre choix&nbsp;;

</para></listitem>
<listitem><para>

très pratique mais pas le mieux&nbsp;:
<productname>Midnight Commander</productname>&nbsp;;

</para></listitem>

<listitem><para>

votre éditeur favori (<productname>vi</productname>,
<productname>jed</productname>, et cætera).

</para></listitem>

</itemizedlist>

</sect2>

<sect2 id="sources-you-will-need">

<title>Les codes sources qu'il vous faut</title>

<itemizedlist>

<listitem><para><productname>bash</productname> ou celui de votre
shell&nbsp;;</para></listitem>
<listitem><para><productname>GNU tar</productname>&nbsp;;</para></listitem>
<listitem><para><productname>GNU core-utils</productname>&nbsp;;</para></listitem>
<listitem><para><productname>GNU make</productname>&nbsp;;</para></listitem>
<listitem><para>bien entendu&nbsp;: <productname>glibc</productname>&nbsp;;</para></listitem>
<listitem><para>éventuellement&nbsp;: <productname>gcc</productname>.</para></listitem>
</itemizedlist>

</sect2>

</sect1>

<sect1 id="special-things-you-need-to-do">
<title>Choses spéciales à faire</title>
<para>Comme vous vous préparez à remplacer la bibliothèque de base sur
laquelle de nombreux programmes reposent, vous pouvez aisément
imaginer que divers problèmes peuvent survenir.</para>
<para>Dans mon cas, tout fonctionnait jusqu'au moment où j'ai
tapé <command>make install</command>. A la moitié du processus
d'installation, j'ai reçu un message d'erreur m'indiquant que la
commande <command>rm</command> ne pouvait fonctionner, et j'ai
découvert que toutes les commandes comme <command>cp</command>,
<command>ls</command>, <command>mv</command>, <command>ln</command>,
<command>tar</command>, etc ne fonctionnaient plus&nbsp;; toutes me
répondaient qu'elles ne trouvaient plus les parties de la bibliothèque
qui leur étaient nécessaires (NDT&nbsp;: j'ai eu aussi ce <emphasis>petit</emphasis>
soucis, toutefois dans un cas plus trivial ;-)).</para>
<para>Mais il existe une solution. Vous pouvez, lors de la compilation
d'un programme, forcer l'inclusion des fonctions de la bibliothèque à
l'intérieur du programme, de telle sorte qu'il n'ait plus à les
rechercher à l'intérieur.</para>
<para>Pour cette raison, dans ce chapitre, nous allons compiler des
versions statiques de tous les utilitaires dont nous avons
besoin.</para>

<sect2 id="things-you-definitely-need">
<title>Les choses indispensables</title>

<sect3 id="the-gnu-binutils">
<title>GNU binutils</title>
<para>
<orderedlist>
<listitem><para>Chargez la toute dernière version depuis <ulink
url="ftp.gnu.org/gnu/binutils">ftp.gnu.org/gnu/binutils</ulink>&nbsp;; à la
date de rédaction de ce guide, le numéro de la version la plus récente
était 2.14.</para></listitem>
<listitem><para>Ouvrez le paquetage&nbsp;: <screen>tar xIvf
binutils-2.14.tar.bz2</screen>.</para></listitem>
<listitem><para>Changez de répertoire&nbsp;: <screen>cd binutils-2.14</screen>.</para></listitem>
<listitem><para>Configurez les <emphasis>makefiles</emphasis>&nbsp;: <screen>./configure</screen>.</para></listitem>
<listitem><para>Compilez&nbsp;: <screen>make</screen>.</para></listitem>
<listitem><para>Installez avec&nbsp;: <screen>make install</screen>.</para></listitem>
</orderedlist>
</para>
<para>Si quelque chose se déroule mal durant la compilation de
binutils, en rapport avec gettext (indiqué par des erreurs comme&nbsp;:
<quote>référence à lib_intl non déclarée</quote> ou quelque chose
d'approchant) installez la nouvelle version, disponible à <ulink
url="ftp.gnu.org/gnu/gettext">ftp.gnu.org/gnu/gettext</ulink>.</para>
<para>Si cela ne suffit pas, essayez de désactiver le support du
langage natif en utilisant&nbsp;: <screen>./configure
--no-nls</screen>.</para>
<para>Il n'est pas nécessaire de compiler une version statique de
binutils, bien que cela ne cause aucun problème, mais j'ai rencontré
de nombreux systèmes fonctionnant avec de très vieilles versions et eu
des erreurs presque à chaque fois <!-- NDT : but I encountered many -->
<!-- systems running with very old versions and ran into errors almost -->
<!-- every time, --> aussi je pense qu'il est utile de le mentionner
ici.</para>
</sect3>

<sect3 id="gnu-make">
<title>GNU make</title>
<para>La commande <command>make</command> règle l'ensemble de la
compilation des sources, appelant gcc et tous les autres programmes
nécessaire à la compilation. Comme il est possible que vous soyez
contraint à compiler quelque chose si une erreur survient avec votre
nouvelle glibc, c'est une bonne idée que <command>make</command> soit
compilé de manière statique&nbsp;; dans le cas contraire, il pourrait ne
pas fonctionner si une erreur survient.</para>
<para>

<orderedlist>
<listitem><para>Téléchargez les sources depuis&nbsp;: <ulink
url="ftp.gnu.org/gnu/make/">ftp.gnu.org/gnu/make/</ulink>&nbsp;; à la date
de rédaction, la version est 3.80.</para></listitem> 
<listitem><para>Déballez <!-- NDT : unpack --> les sources&nbsp;: <screen>tar xIvf make-3.80.tar.bz2</screen>.</para></listitem>
<listitem><para>Changez de répertoire&nbsp;: <screen>cd make-3.80</screen>.</para></listitem>
<listitem><para>Prenez garde à compiler de manière statique&nbsp;: <screen>export CFLAGS="-static -O2 -g"</screen>.</para></listitem>
<listitem><para>Lancez le script de configuration&nbsp;: <screen>./configure</screen></para></listitem>
<listitem><para>Compilez&nbsp;: <screen>make</screen>.</para></listitem>
<listitem><para>Installez les binaires: <screen>make install</screen>.</para></listitem>
<listitem><para>Vérifiez&nbsp;: <screen>make -v</screen> Vous devez
maintenant voir la dernière version installée. Sinon, recherchez les
anciens fichiers binaires et remplacez les par des liens symboliques
vers les nouvelles versions.</para></listitem>
</orderedlist>
</para>
<para>Félicitations&nbsp;! Vous avez compilé un autre programme
statique.</para>
</sect3>

<sect3 id="gnu-core-utils">
<title>GNU core-utils</title>

<para>core-utils contient des commandes comme&nbsp;: <command>cp</command>,
<command>rm</command>, <command>ln</command>, <command>mv</command>,
etc. En cas d'erreur durant l'installation, c'est une nécessité
absolue pour pouvoir espérer remonter le système, aussi des binaires
statiques sont vraiment nécessaires ici.</para>
<para>
<orderedlist>
<listitem><para>De nouveau, téléchargez les sources depuis <ulink
url="ftp.gnu.org/gnu/coreutils/">ftp.gnu.org/gnu/coreutils/</ulink>&nbsp;;
au moment de la rédaction, la version courante est la
5.0.</para></listitem>
<listitem><para>Dépaquetez les sources&nbsp;: <screen>tar xIvf
coreutils-5.0.tar.bz2</screen></para></listitem>
<listitem><para>Changez de répertoire&nbsp;: <screen>cd
coreutils-5.0</screen></para></listitem>
<listitem><para>Prenez garde au fait que les binaires doivent être liés statiquement
: <screen>export CFLAGS="-static -O2 -g"</screen></para></listitem>
<listitem><para>Configurez le paquetage&nbsp;:
<screen>./configure</screen></para></listitem>
<listitem><para>Compilez les binaires&nbsp;:
<screen>make</screen></para></listitem>
<listitem><para>Et installez les&nbsp;: <screen>make
install</screen></para></listitem>
<listitem><para>Vérifiez que la bonne version de core-utils est
utilisée&nbsp;: <screen>cp --version</screen>. Vous devez obtenir un numéro
de version correct, dans le cas contraire, supprimez les anciens
binaires et remplacez les par des liens symboliques vers les
nouveaux.</para></listitem>
</orderedlist>
</para>
<para>
Maintenant que les binaires de ces outils de base sont des versions
statiques, vous êtes sûr qu'il fonctionneront en cas de
besoin.
</para>
</sect3>

<sect3 id="gnu-tar">
<title>GNU tar</title>
<para>Vous avez déjà utilisé GNU tar pour dépaqueter les programmes
compilés et installés. Mais vous avez besoin de
compiler un programme requis par glibc après un crash et, dans cette
situation (expérience vécue) il est particulièrement utile de disposer
d'un <command>tar</command> opérationnel pour dépaqueter les
programmes manquants. Il nous faut également, avec tar, prendre garde
à la compression bz2, qui n'est pas incluse dans la distribution
normale des sources de tar.</para>
<para>
<orderedlist>
<listitem><para>Récupérez les sources de GNU tar sur <ulink
url="ftp.gnu.org/gnu/tar">ftp.gnu.org/gnu/tar</ulink>&nbsp;; à la date de
rédaction, la dernière version est la 1.13.</para></listitem>
<listitem><para>Comme de multiples archives tar sont compressées avec
bzip2, nous préférerons disposer du support intégré, plut&ocirc;t que
de devoir travailler avec des <emphasis>pipes</emphasis>&nbsp;; il nous faut donc
récupérer le patch à <ulink url="ftp://infogroep.be/pub/linux/lfs/lfs-packages/4.1/tar-1.13.patch">ftp://infogroep.be/pub/linux/lfs/lfs-packages/4.1/tar-1.13.patch</ulink>.
    </para></listitem>
<listitem><para>Dépaquetez les sources&nbsp;: <screen>tar xzvf tar-1.13.tar.gz</screen></para></listitem>
<listitem><para>Copiez le patch dans le répertoire contenant les
sources de tar <screen>cp tar-1.13.patch tar-1.13/</screen></para></listitem>
<listitem><para>Appliquez le&nbsp;: <screen>patch -Np1 -i tar-1.13.patch</screen></para></listitem>
<listitem><para>Posez les options du compilateur pour obtenir un
binaire statique&nbsp;: <screen>export CFLAGS="-static -O2 -g"</screen></para></listitem>
<listitem><para>Nous sommes maintenant prêt pour la
configuration&nbsp;: <screen>./configure</screen></para></listitem>
<listitem><para>La compilation&nbsp;:
<screen>make</screen></para></listitem>
<listitem><para>Et enfin l'installation&nbsp;: <screen>make
install</screen></para></listitem>
<listitem><para>Faites une dernière vérification pour vous assurer que
la nouvelle version sera utilisée à partir de maintenant&nbsp;: <screen>tar
--version</screen>. La version que vous venez d'installer doit
appara&icirc;tre, sinon, remplacez les anciens binaires par des liens
symboliques vers les nouveaux.</para></listitem>
</orderedlist></para>
<para>Si vous avez des problèmes dans l'exécution de la commande
<command>make</command>, essayez de désactiver le support du langage
natif (<emphasis>nls&nbsp;: native-language support</emphasis>). Pour ce faire,
utilisez la commande configure avec l'option <screen>--disable-nls</screen></para>

<para><emphasis>Note&nbsp;: </emphasis> dans la nouvelle version de tar,
vous devez utiliser l'option <option>-j</option> pour décompresser les
fichiers .bzip2, aussi plut&ocirc;t que <screen>tar xIvf
anyfile.tar.bz2</screen> vous devez maintenant utiliser <screen>tar
xjvf anyfile.tar.bz2</screen>. J'ignore les raisons de ce changement,
mais ça fonctionne bien.</para>
</sect3>

<sect3 id="the-bash">
<title>Le shell bash</title>
<para>Je préfère utiliser le shell bash&nbsp;; si vous en utilisez un
différent, assurez-vous d'avoir installé une version statique de
celui-ci avant d'installer glibc.</para>
<para>
<orderedlist>
<listitem><para>Récupérez bash à&nbsp;: <ulink
url="ftp.gnu.org/gnu/bash/">ftp.gnu.org/gnu/bash/</ulink>. Téléchargez
la version la plus récente que vous trouverez&nbsp;; à la date de
rédaction, celle-ci est la 2.05b.</para></listitem>
<listitem><para>Dépaquetez les sources&nbsp;: <screen>tar xzvf
bash-2.05b.tar.gz</screen> créera un répertoire nommé
<filename>bash-2.05b</filename> contenant toutes les
sources.</para></listitem>
<listitem><para>Déplacez-vous dans ce répertoire&nbsp;: <screen>cd
bash-2.05a</screen></para></listitem>
<listitem><para>Configurez pour obtenir une version statique&nbsp;:
<screen>export CFLAGS="-static -O2 -g"</screen></para></listitem>
<listitem><para>Configurez le makefile&nbsp;:
<screen>./configure</screen>. Si vous désirez que votre bash possède
certaine fonctionnalités spéciales, reportez-vous à la commande
<screen>./configure --help</screen> pour la liste des options.</para></listitem>
<listitem><para>Compilez le tout&nbsp;:
<screen>make</screen></para></listitem>
<listitem><para>Installez les binaires&nbsp;: <screen>make
install</screen>. Ils seront installés dans le répertoire
<filename>/usr/local/bin/</filename>.</para></listitem>
<listitem><para>Vérifiez qu'une autre version ne reste pas tapie
quelque part (comme dans ma Suse&nbsp;: <filename>/bin/</filename>), en
copiant le fichier&nbsp;: <screen>cp /usr/local/bin/bash
/bin/</screen>. Nous n'utilisons pas ici de lien symbolique car, tant
lors du démarrage de la machine qu'au lancement de bash, des problèmes
peuvent survenir avec les liens symboliques.</para></listitem>
</orderedlist>
</para>
<para>Vous avez maintenant installé une version statique de
bash. C'est pour cette raison que le binaire est beaucoup plus
volumineux qu'à l'accoutumée, mais il fonctionnera quelles que soient
les circonstances.</para>

<para>Si vous préférez utiliser un autre shell, vous êtes libre
de le faire, mais assurez-vous qu'il s'agit d'une version liée
statiquement. N'hésitez pas à me communiquer la méthode pour
construire une version statique du shell de votre choix&nbsp;; il y a de
grandes chances qu'elle soit reprise dans la prochaine révision de ce
document.</para>
</sect3>
</sect2>

<sect2 id="software-that-may-come-in-handy">
<title>Logiciels divers</title>

<sect3 id="midnight-commander">
<title>Midnight Commander</title>
<para>Midnight Commander est un gestionnaire de fichiers très utile,
apportant de nombreuses fonctionnalités intéressantes, comme la
décompression directe des fichiers compressés, la copie, le
déplacement de fichiers et d'autres commandes intégrées, ainsi qu'un
éditeur.</para>
<para>Pour compiler ce logiciel, glib doit être installé&nbsp;; cela
est le cas dans certaines distributions. Si vous rencontrez une erreur
lors de l'exécution de la commande <command>make</command> vous
indiquant que ld ne peut pas trouver glib, vous devrez installer cette
bibliothèque avant tout autre chose. Vous pouvez en trouver les
sources à&nbsp;: <ulink
url="ftp.gnome.org/pub/gnome/sources/glib/2.2/">ftp.gnome.org/pub/gnome/sources/glib/2.2/</ulink>,
et l'installation est directe <!-- NDT&nbsp;: straight-forward ? -->.</para>

<para>Les étapes de la construction de Midnight Commander 
sont&nbsp;:</para>

<orderedlist>

<listitem><para>

Récupérer les sources depuis <ulink
url="http://www.ibiblio.org/pub/Linux/utils/file/managers/mc/"/>&nbsp;;
à la date de rédaction, la version la plus récente est la 4.6.0.

</para></listitem>
<listitem><para>

Dépaqueter les sources&nbsp;:

</para>
<screen>
tar xzvf mc-4.6.0.tar.gz
</screen>

</listitem>

<listitem><para>
Se déplacer dans le répertoire nouvellement créé&nbsp;:

</para>
<screen>
cd mc-4.6.0
</screen>
</listitem>

<listitem><para>

Configurer&nbsp;:

</para>

<screen>
./configure
</screen>

</listitem>

<listitem><para>

Compiler&nbsp;:

</para>
<screen>make</screen>

</listitem>

<listitem><para>

Tout installer&nbsp;:

</para>

<screen>
make install
</screen>

</listitem>

</orderedlist>

</sect3>
</sect2>
</sect1>
</chapter>

<chapter id="the-install-of-glibc-itself">

<title>Installation de glibc en soi</title>

<para>Maintenant nous atteignons le point crucial&nbsp;: l'installation de
glibc.</para>

<sect1 id="obtaining-and-compiling-the-source"> 

<title>Récupérer et installer les sources</title>

<para>Plusieurs versions de glibc sont disponibles, mais les nouvelles
versions ne sont pas préférables aux plus anciennes dans tous les
cas. La meilleure chose à faire pour savoir lesquelles fonctionnent et
lesquelles vous ne devez pas utiliser est de se renseigner sur les
différents groupes de discussion sur Internet. Si vous connaissez
quelqu'un à qui demander, parlez lui en. Peut-être a-t'il déjà
installé la nouvelle version et peut il vous dire que la version x.y.z
est une PITA <!-- NDT : certainement un acronyme anglo-saxon interdit -->
<!-- aux moins de 18 ans ;-), un peu comme SNACBAR -->, mais que la
version a.b.c fonctionne vraiment bien&nbsp;!</para>

<para>J'ai décidé d'installer la glibc-2.2.4, puisque l'on m'avait dit
qu'elle fonctionne bien, mais le choix de la version demeure de votre
ressort.</para>
<para>Bien, maintenant, au travail&nbsp;: </para>
<para><orderedlist>
<listitem><para>Récupérez les sources sur <ulink
url="ftp.gnu.org/gnu/glibc/">ftp.gnu.org/gnu/glibc/</ulink>&nbsp;; comme
dit plus haut, j'ai utilisé la version 2.2.4.</para></listitem>
<listitem><para>Dépaquetez les sources&nbsp;: <screen>tar -xzvf
glibc-2.2.4.tar.gz</screen></para></listitem>
<listitem><para>Vous aurez besoin, en plus, du paquetage
<quote>linuxthreads</quote> que l'on peut trouver dans le répertoire
<filename>linuxthreads</filename> sur <ulink
url="ftp.gnu.org">ftp.gnu.org</ulink>. Le fichier est&nbsp;:
<screen>glibc-linuxthreads-2.2.4.tar.gz</screen>. Assurez-vous que le
numéro de version correspond à celui de votre arborescence des sources
de glibc.</para></listitem>
<listitem><para>Copiez le paquetage linuxthreads dans le répertoire
contenant les sources de glibc&nbsp;: <screen>cp
glibc-linuxthreads-2.2.4.tar.gz glibc-2.2.4</screen></para></listitem>
<listitem><para>Déplacez vous dans ce répertoire&nbsp;: <screen>cd
glibc-2.2.4</screen></para></listitem>
<listitem><para>Dépaquetez linuxthreads&nbsp;: <screen>tar xzvf
linux-threads-2.2.4.tar.gz</screen></para></listitem>
<listitem><para>Configurez le paquetage&nbsp;: <screen>./configure
--enable-add-ons=linuxthreads</screen>. Cela configurera le paquetage
de telle sorte que linuxthreads soit inclus dans la compilation&nbsp;; ceci
est nécessaire pour la compatibilité <!-- NDT : compliance ?! --> avec
d'autres systèmes Linux. Par exemple, les programmes que vous
compilerez sur votre machine ne fonctionneront probablement pas sur
d'autres machines si vous omettez d'inclure ce
paquetage.</para></listitem>
<listitem><para>Enfin, lancez la compilation de glibc&nbsp;:
<screen>make</screen>. Cela peut prendre un certain temps (à peu près
une demi-heure sur le Duron XP 1,5&nbsp;GHz de
l'auteur).</para></listitem>
</orderedlist>
</para>
<para>Maintenant que la bibliothèque est compilée, tout est prêt
pour l'installation, mais les choses ne seront pas si simple cette
fois.
</para>
</sect1>

<sect1 id="the-installation">

<title>Installation</title>

<para>

Pour installer glibc, il vous faut un système où rien ne s'exécute, car
de nombreux processus (par exemple sendmail) utilisent continuellement
les services de la bibliothèque et donc, interdisent le remplacement du
fichier. Il vous faut donc un système <quote>nu</quote>, n'exécutant 
rien
d'autre que le strict nécessaire. Vous pouvez atteindre cet objectif en
passant l'option de démarrage <literal>init=/bin/bash</literal> au
noyau. En fonction de votre gestionnaire d'amorçage, il vous faudra
peut-être faire d'autres choses. Ci-après, nous expliquerons ce qu'il
vous faut faire en prenant comme exemples les deux gestionnaires
d'amorçage les plus courants, LILO (LInux-LOader) et GNU grub.

</para>

<sect2 id="lilo">
<title>LILO</title>
<para>Pour lancer un système <quote>minimum</quote>, relancez
l'ordinateur et, à l'invite de LILO, entrez le nom du noyau que vous
désirez lancez et, à la suite, ajoutez <screen>init=/bin/bash</screen>
avant de presser la touche <keycap>Entrée</keycap>.
Si vous envisagez de remplacer souvent votre glibc, ce peut être
une bonne idée d'inclure une configuration spécifique dans votre
fichier <filename>/etc/lilo.conf</filename>. Pour plus de détails,
reportez-vous à la page de manuel de LILO.</para>
</sect2>

<sect2 id="grub">
<title>Grub</title>
<para>Grub est un gestionnaire d'amorçage plus récent, avec un support
étendu de différents systèmes d'exploitation et systèmes de fichiers
(par exemple, il supporte le démarrage depuis des partitions
reiserfs). Si vous désirez en savoir plus, reportez vous à <ulink
url="http://www.gnu.org/software/grub/">http://www.gnu.org/software/grub/</ulink>,
où vous trouverez tout le nécessaire.</para>
<para>Si grub est déjà installé chez vous, vous utilisez probablement
l'interface en mode texte pour sélectionner le noyau que vous voulez
lancer. Grub dispose d'une intéressante fonctionnalité &mdash; au lieu
de tout refaire à la main, vous pouvez simplement sélectionner
l'entrée qui vous intéresse et, alors, taper <keycap>e</keycap>, ce
qui provoquera l'affichage d'un menu optionnel. Dans ce menu, vous
verrez la commande exécutée par grub avant le lancement du
noyau. Sélectionnez la ligne indiquant
<screen>kernel="/où/est-le-noyau-et-quelles-sont-les-options"</screen>
et tapez <keycap>e</keycap> de nouveau. Maintenant, vous pouvez éditer
cette ligne. Vous ajoutez simplement <screen>init=/bin/bash</screen>
et tapez <keycap>Entrée</keycap> pour rendre les modifications
effectives, tapez <keycap>b</keycap> pour démarrer.</para>
</sect2>
</sect1>
<sect1 id="afeter-the-kernel-is-booted">
<title>Après le démarrage du noyau&hellip; </title>
<para>&hellip;  Vous allez vous retrouver dans un environnement shell
absolument minimal.</para>
<para>Il ne vous sera même pas demandé de mot de passe&nbsp;! A ce
moment, vous êtes le super-utilisateur absolu&nbsp;; personne ne peut
se connecter car le système est en mode mono-utilisateur, aussi faites
très attention à ce que vous faites. Aucun droit n'est posé sur les
fichiers ni rien d'autre&nbsp;!</para>
<para>L'invite ressemblera sûrement à <screen>init-x.y#</screen>. La
racine (/) ayant été montée en lecture seule, il vous sera impossible
d'enregistrer la nouvelle librairie sur le disque dur. Pour rendre la
racine accessible en lecture/écriture, entrez la commande&nbsp;:
<screen>mount -o remount,rw /</screen>. Si les sources se trouvent sur
une autre partition, vous devez également la monter (dans le cas de
l'auteur, cela signifie monter son système raid)&nbsp;: <screen>mount -t
reiserfs /dev/md0 /usr/src</screen>. Comme vous le voyez, on définit
également le type du système de fichier car <command>mount</command>
n'ira rien chercher dans dans <filename>/etc/fstab</filename>.</para>
<para>Maintenant, vous pouvez aller dans le répertoire contenant les
sources et taper&nbsp;: <screen>make install</screen>.</para>
<para>Si vous le désirez, c'est maintenant le bon moment pour prier
pour que tout se passe bien&hellip;  ;-)</para>
<para>Si tout se passe parfaitement, vous retrouverez l'invite de
commande après l'installation sans aucun message d'erreur. Dans tous
les autres cas, reportez vous à <xref linkend="troubleshooting"
/>.</para>
<para>Si tout s'est bien passé, lancez <screen>ldconfig -v</screen>
pour mettre à jour le cache des bibliothèques.</para>
<para>Félicitations&nbsp;! La bibliothèque est installée avec
succès. Maintenant, tapez&nbsp;: <command>mount -o remount,ro /</command>
pour être sûr que toutes les données sont écrites sur le
disque dur.</para>
<para>Lancez la procédure de redémarrage&nbsp;: <screen>exit</screen>. Cela
provoquera un message d'erreur indiquant que vous avez causé un
kernel-panic. Si possible, relancez l'ordinateur par
<keycombo><keycap>CTRL</keycap><keycap>ALT</keycap><keycap>DEL</keycap></keycombo>,
sinon utilisez le bouton reset.</para>
<para>Essayez de lancer votre noyau habituel. Si tout se passe bien,
vous êtes prêt à utiliser votre nouvelle
bibliothèque.</para>
</sect1>
</chapter>

<chapter id="troubleshooting">
<title>En cas de problème &mdash; si quelque chose a mal
tourné&hellip;  </title>
<para>Si vous arrivez à cette section en ayant suivi toutes les
instructions fournies plus haut, vous avez probablement été confronté
au problème inhérent à la multiplicité des distributions Linux,
certaines ne placent pas les choses où elles devraient
être mais ailleurs. Les distributions Suse sont les plus fameuses de
celles-là, mais d'autres peuvent avoir ce problème. Si vous rencontrez
ce problème et trouvez la cause de l'erreur  &mdash; et j'espère la
solution &mdash;  soyez gentil de me le faire savoir, afin que je
l'ajoute à ce document.</para>
<para>Je pense que cette section ne sera jamais vraiment complète,
mais je vais tenter de lister un certain nombre d'erreurs possibles et
les solutions pour s'en sortir.</para> 

<sect1 id="errors-with-configure-or-make-while-trying-to-compile-the-glibc">
<title>Erreurs avec les commandes <command>configure</command> ou
<command>make</command> durant la compilation de glibc</title>
<para>Vous pouvez parfois obtenir des messages d'erreur durant la
configuration vous indiquant que, par exemple, une dépendance n'est
pas satisfaite, typiquement en ce qui concerne les logiciels ou les
paquetages de bibliothèques trop anciens. J'ai rencontré ce type de
problème avec une série de programmes, tout spécialement durant la
compilation des versions statiques des différents outils
nécessaires. La solution devrait normalement être très simple&nbsp;:
récupérer les versions à jour des programmes ou des bibliothèques
incriminées et les compiler en se conformant ou instructions fournies
(habituellement dans le fichier <filename>README</filename>,
<filename>INSTALL</filename> ou tout autre approchant).</para>
<para>Mais il est quelques cas où cela ne voudra pas
fonctionner. Par exemple, j'ai eu des soucis pour compiler une
nouvelle version de binutils (c'est une des raisons pour lesquelles je
le mentionne dans les pré-requis), alors que j'en avais besoin pour
compiler glibc. 
Le script configure me retournait une erreur m'indiquant <quote>Votre
glibc est trop ancienne&nbsp;!</quote> Aussi j'ai pensé, <emphasis>Ici, 
le
serpent commence à se mordre la queue</emphasis>. Il existe
heureusement une solution à ce problème&nbsp;: si vous ne pouvez pas faire
un grand pas en avant, essayer d'en faire plusieurs petits, mais
davantage.</para>
<para>Dans ma distribution, je disposais de la glibc version
2.1.1. Pour remédier à l'erreur, j'ai tenté la compilation de la
version 2.1.3, sans problème. Après avoir installé cette version, j'ai
retenté la compilation de binutils, et toutes les dépendances ont été,
cette fois, résolues.</para>
<para>Si vous rencontrez cette sorte de <quote>boucle</quote> essayez
de rechercher la version minimal du logiciel requises, et téléchargez
la (je pense que c'est une des raisons pour laquelle autant d'anciennes
versions demeurent sur les serveurs ftp). Après avoir mené à bien la
compilation et l'installation, essayez de construire le logiciel
réticent&nbsp;; dans la plupart des cas cela devrait aboutir. Il sera
peut-être nécessaire d'utiliser de nouveau cette méthode pour
compiler des logiciels anciens ou manquants.
C'est ce que j'appelle <quote>la longue queue du rat <!-- NDT : rat ?! -->
</quote> ou <quote>l'effet domino</quote>. Vous ne vouliez faire
qu'une chose, mais vous êtes contraints d'en effectuer plusieurs
autres avant de pouvoir faire aboutir la première. Cela peut
être ennuyeux, mais il y a un point positif à cela&nbsp;: après, vous
êtes à peu près certains que beaucoup des logiciels réellement
anciens seront remplacés quand vous terminerez l'installation.</para>
</sect1>
 
<sect1 id="something-goes-wrong-during-make-install">
<title>Quelque chose se passe mal durant l'installation (<command>make
install</command>)</title>
<para>L'erreur la plus commune est de ne pas disposer de l'ensemble
des outils en version statique&nbsp; dans ce cas, vous ne pouvez
utiliser que la commande <command>cd</command> et rien d'autre. C'est
pour cette raison que j'ai décrit en détail, dans ce guide pratique,
comment recréer des versions statiques de tous les outils
nécessaires.</para>
<para>Le seul outil non statique est <command>mount</command> et, pour
de bonnes raisons à mon avis, il est inclus dans le paquetage
linux-utils, qui contient également <command>login</command>,
<command>passwd</command>, etc. De même que vous ne pouvez
utiliser de version compilée statiquement en association avec PAM ou
d'autres logiciels de sécurité, ce serait une erreur de les recompiler
de manière statique quelles que soient les circonstances. Vous
êtes bien entendu libre de le faire si vous êtes certain
de ce que vous faites.</para>

<sect2 id="going-back-to-a-working-configuration">
<title>Retrouver une configuration opérationnelle</title>
<para>La méthode permettant de retrouver une configuration en état de
marche est très simple si vous utilisez des outils compilés de manière
statique&nbsp;: allez dans le répertoire
<filename>/usr/local/lib/</filename> et déplacez les fichiers
nouvellement installés dans un autre répertoire (par exemple,
<filename>/usr/local/lib/deplace/</filename>). Vous pourrez les
identifier grâce à leurs numéros de versions, qui devrait
être identique que celui de la glibc (dans mon cas, les noms de
fichiers répondaient tous au schéma lib*-2.2.4), et bien entendu par
les dates et heures de création. Il est assez rare que deux
bibliothèques différentes aient le même numéro de version au
même moment &mdash; je ne l'ai moi-même jamais
vécu &mdash; mais pour vous assurer quand même de ne rien détruire
d'important pour votre système vérifiez les date et heure de
création. S'il est installé, Midnight Commander est très utile pour
cel.</para>
<para>Vous pouvez essayer d'effacer les fichiers
<filename>ld-2.2.4.so</filename> et <filename>libc-2.2.4.so</filename>
et de lancer <command>ldconfig -v</command> ensuite, avant de détruire
tous les fichiers endommagés. Cela vous permettra au moins d'utiliser
la plupart des programmes et, dans tous les cas, vous pourrez utiliser
Midnight Commander.</para>
<para>N'oubliez pas non plus de lancer au moins une fois
<command>ldconfig -v</command> après avoir détruit les fichiers
incriminés.</para>

<sect3 id="removing-the-causes-for-the-crashing-of-the-installation">
<title>Remédier aux causes du plantage système</title>
<para>Une source courante de problème est que votre distribution
stocke les fichiers des bibliothèques à un emplacement différent que
celui utilisé par les routines d'installation que vous avez lancées,
donc il arrive souvent que deux versions différentes soient
simultanément en fonction, se perturbant l'une l'autre. Dans mon cas,
j'ai eu beaucoup de soucis à cause d'une seconde copie de
<filename>libc6.so</filename> dans le répertoire
<filename>/lib</filename>, un lien symbolique entre ce fichier et son
pendant contenu dans le répertoire <filename>/usr/local/lib</filename>
a remédié au problème.</para>
</sect3>
</sect2>
</sect1>
</chapter>
</book>










