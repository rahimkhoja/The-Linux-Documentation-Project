<!doctype linuxdoc system>

<!--  Traduction du Mini-HOWTO Fax-Server -->

<article>

<!-- Title information -->

<title>Mini-HOWTO Fax-server
<author> Erez Strauss <tt/erez@newplaces.com/
Version v1.0
<date>8 November 1997
<abstract>
Traduit par Frédéric Gacquer <tt/gacquer@neuronnexion.fr/
Mercredi 14 janvier 1998.
</abstract>

<!-- Table of contents -->
<toc>

<!-- Begin the document -->

<p>

Aucune garantie. Les commentaires sont les bienvenus. Ce document décrit
en détail une des façons les plus simples d'installer un serveur de fax
sur votre système linux. Le fax est disponible pour les utilisateurs sur 
le poste local et aux utilisateurs sur le réseau.

<sect>Introduction

<p> 

Pour faire fonctionner une imprimante/fax sur une machine linux vous  
devez avoir quelques logiciels et un modem fax.

<p>
Les logiciels pour l'Imprimante utiliseront le logiciel fax comme un 
filtre d'impression. Efax trouvera le numéro de fax à
partir du numéro de la tâche d'impression et enverra le fax. Le logiciel 
efax a été écrit par Ed Casas 
<tt><htmlurl url="mailto://edc@cce.com" name="edc@cce.com"></tt>.

<p>
Le reste du document est construit autour de Question/Réponses.


<sect> Questions et réponses
<p>

  <sect1> Qu'est-ce qu'un serveur d'impression de fax
      <p>
     Un serveur d'impression de fax est une installation de quelques 
     programmes: efax, et le serveur d'impression, de telle manière
     qu'envoyer un fax à partir de l'ordinateur est aussi simple 
     qu'envoyer une impression à l'imprimante.

   <sect1> Comment l'installer ?
      <p>
     Installer efax comme serveur d'impression de fax comporte peu
     de problème. Comme j'ai travaillé dessus quelque fois, j'ai décidé 
     de réunir ces connaissances dans ce petit mini-HOWTO, les commentaires
     sont les bienvenus à <tt><htmlurl url="erez@newplaces.com" name="erez@newplaces.com">.
     </tt>Je les décrits ici ainsi que les solutions, et toutes les instructions en quelques étapes:

    <sect2> Le logiciel efax
      <p>
    Assurez-vous que vous avez le progiciel efax.
    <p> 
    Sur les systèmes qui reposent sur RPM utilisez la commande <tt>'rpm -qv efax'</tt>.

    Vous pouvez obtenir les sources d'efax en format tar.gz chez sunsite:
    <tt>ftp://sunsite.unc.edu/pub/Linux/apps/serialcomm/fax/efax08a.tar.gz</tt>
    ou le progiciel binaire en rpm:
    <tt>ftp://ftp.redhat.com/pub/redhat/redhat-4.2/i386/RedHat/RPMS/efax-0.8a-3.i386.rpm</tt>.

     <sect2> L'entrée printcap
      <p>
     Le documentation d'efax a oublié le : à la fin de l'entrée printcap.
      <p> 
     Solution: ajouter ce qui suit à l'entrée  <tt>/etc/printcap</tt>:
     <tscreen><verb>  
       fax:\
               :lp=/dev/null:\
               :sd=/var/spool/fax:\
               :if=/usr/bin/faxlpr:
     </verb></tscreen>

   <sect2> La command <tt>fax</tt>
      <p>
     Uilisez des liens physique et non des liens symboliques à la commande
     fax.
      <p>
     Exécuter la commande:
     
     <tscreen><verb>  
            ln /usr/bin/fax /usr/bin/faxlpr
     </verb></tscreen>

     <sect2> Le fichier <tt>/usr/bin/fax</tt>.
      <p>
     Editez <tt>/usr/bin/fax</tt> à votre convenance.
      <p>
     Choisir la bonne classe de votre modem:

     <tscreen><verb>  
       CLASS=2.0
     </verb></tscreen>

     <p>
     Positionner le champ FROM="votre numéro de téléphone international"

     <tscreen><verb>  
       NAME="votre nom"
     </verb></tscreen>

     <p>
     Ajouter la ligne de conversion du numéro de téléphone international en 
     local, par exemple pour Israël vous pourriez utiliser:

     <tscreen><verb>  
          TELCVT='sed -e s/+972/0/ -e s/+/00/'  # Israel
     </verb></tscreen>

     <p>
     Il y a un problème dans le fichier à la ligne 586, changer le cfile=...
     avec les deux lignes suivantes:

     <tscreen><verb>  
       cfile=`/usr/bin/tail -1 lock`
       cfile=`cat $cfile`
     </verb></tscreen>

     <p>
    Aux lignes 586,587 il ne devriez pas y avoir le signe '-', les lignes sont

     <tscreen><verb>  
       0) echo "$l" | mail -s "fax to $num succeeded" $user@$host ;;
       *) echo "$l" | mail -s "fax to $num failed   " $user@$host ;;
     </verb></tscreen>

     <sect2> Le répertoire <tt>/var/spool/fax</tt>
     <p>
    Créer le répertoire <tt>/var/spool/fax</tt>

     <tscreen><verb>  
       mkdir /var/spool/fax
       chmod 777 /var/spool/fax
     </verb></tscreen>

      <sect2> Le fichier <tt>lock</tt>.
     <p>
     Le fichier lock (<tt>/var/spool/fax/lock</tt>) est créé avec des permissions
     incorrectes, utiliser les commandes suivantes pour les positionner
     correctement:

     <tscreen><verb>  
        touch /var/spool/fax/lock ; chmod 644 /var/spool/fax/lock
     </verb></tscreen>

    <sect2> le fichier spécial <tt>/dev/modem</tt>
     <p>
     Le programme efax s'attend à un fichier device <tt>/dev/modem</tt> réél et
     ne fonctionnera pas avec des liens symobliques, donc créer un fichier
     device avec le même nombre majeur et le même mineur que <tt>/dev/cua?</tt>
     qui est connecté au modem. Le fichier devra avoir les permissions
     <tt>rw-rw-rw-</tt> pour autoriser n'importe quel utilisateur à utiliser le 
     logiciel de fax.

     <tscreen><verb>  
       ls -lL /dev/modem
       rm /dev/modem
       mknod /dev/modem c Mj Mi
       chmod 666 /dev/modem
     </verb></tscreen>

     <p>
     Mj est 5, et Mi est 64 pour cua0, 65 pour cua1 et ainsi de suite.
     Par exemple (pour cua1) :

     <tscreen><verb>  
        mknod /dev/modem c 5 65
     </verb></tscreen>

     <sect2> Le répertoire <tt>/var/lock</tt>.
     <p>

     <tscreen><verb>  
        chmod 1777 /var/lock
     </verb></tscreen>

      <sect1> Comment l'utiliser, avec le serveur ?
        <p>
      Vous devez utiliser l'imprimante fax en utilisant l'option -P
      et l'option -J avec le numéro de fax.

        <p>
      Utiliser une des commandes lpr suivantes :


     <tscreen><verb>  
        lpr -Pfax -J &lt;Numéro-De-Fax&gt; [nom-de-fichiers]
        toute commande | lpr -Pfax -J &lt;Numéro-De-Fax&gt;
     </verb></tscreen>

       <sect1> Où indique t on le numéro de fax destinataire ?
        <p>
       Après l'option -J.

        <sect1> Comment l'utiliser à partir d'autres unix ?
        <p>
       Ajouter les entrées suivantes dans le fichier <tt>/etc/printcap</tt> et
       le système client Linux, créer le répertoire de spool, et ainsi
       de suite...

     <tscreen><verb>  
         fax:\
                   :sd=/var/spool/fax:\
                   :mx#0:\
                   :sh:\
                   :rm=host.domain:\
                   :rp=fax:
     </verb></tscreen>

       <p>
       ajouter le nom de l'hôte client dans <tt>/etc/hosts.lpd</tt> sur la 
       machine serveur de fax.

       <p>
       Utiliser comme précédemment.

       <p>
       Note:
       <p>
       La chaîne de caractère d'entête qu'efax ajoute aux pages des fax
       n'est pas effectué par l'utilisateur qui envoi le fax. (peut être 
       mis à jour).


      <sect2> Utilisateurs de Caldera, LPRng
      <p>
      Le logiciel de contrôle d'impression LPRng utilise une méthode 
      différente pour prendre en charge le fichier de contrôle.

      <p>
      Merci à Luca Montecchiani 
      <tt><htmlurl url="mailto://m.luca@usa.net" name="m.luca@usa.net"></tt>, 
      qui a trouvé le problème et la solution. Voici une mise à jour du fichier
      <tt>/usr/bin/fax</tt>. Les lignes suivantes remplacent les deux simples 
      lignes de cfile=... aux lignes 586,587


     <tscreen><verb>  

  # Modified to work also with the LPRng package
  # Luca Montecchiani (08/11/97 m.luca@usa.net)
  if [ !-z "$CONTROL_FILE" ]
      then
          cfile=`cat tail -1 lock`
          cfile=`cat $cfile`
      else
          cfile=$CONTROL_FILE
  fi
     </verb></tscreen>

<sect> Dernière version, Contacter l'auteur.
 <p> 
La dernière version de ce fichier peut être trouvé à travers le
world wide web en utilisant les URLs
<itemize>
     <item><url url="http://www.newplaces.com/linux/faxsrv/faxsrv-mini-HOWTO.sgml">
     <item><url url="http://www.newplaces.com/linux/faxsrv/faxsrv-mini-HOWTO.html">
     <item><url url="http://www.newplaces.com/linux/faxsrv/faxsrv-mini-HOWTO.txt">
     <item><url url="http://www.newplaces.com/linux/faxsrv/faxsrv-mini-HOWTO.info">
</itemize>
<p>
Vous pouvez me contacter :

       Erez Strauss
<itemize>
      <item> <tt><htmlurl url="mailto://erez@newplaces.com" name="erez@newplaces.com"></tt>
      <item> <tt><url url="http://www.newplaces.com/linux/"></tt>
      <item> <tt><url url="http://www.newplaces.com/"></tt>
</itemize>
<p>

       Phone: +972 52 739737
       Fax:  +972 9 954 3034
</article>
