<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
  "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
<!ENTITY howto      "http://www.traduc.org/docs/howto/lecture/">
]>

<article lang="fr">

<articleinfo>

<title>

  Petit guide sur l'installation de MMBase sur un système Debian Woody

</title>

<subtitle>

  Version française du <foreignphrase lang="en">MMBase Mini-HOWTO:
  Installation on Debian Woody</foreignphrase>

</subtitle>

  <author>
     <firstname>Casper Joost</firstname>
     <surname>Eyckelhof</surname>
     <affiliation>
       <address><email>joost CHEZ dnd POINT utwente POINT nl</email></address>
     </affiliation>
  </author>

  <othercredit role="traduction" class="translator">
     <firstname>Simon</firstname>
     <surname>Depiets</surname>
     <contrib>Adaptation française</contrib>
     <email>2df CHEZ tuxfamily POINT org</email>
  </othercredit>

  <othercredit role="relecture" class="translator">
     <firstname>Guillaume</firstname>
     <surname>Lelarge</surname>
     <contrib>Relecture de la version française</contrib>
     <email>gleu CHEZ wanadoo POINT fr</email>
  </othercredit>

  <othercredit role="publication" class="copyeditor">
     <firstname>Jean-Philippe</firstname>
     <surname>Guérard</surname>
     <contrib>Préparation de la publication de la v.f.</contrib>
     <email>fevrier CHEZ tigreraye POINT org</email>
  </othercredit>

  <releaseinfo>0.2.fr.1.0</releaseinfo>
  <pubdate>2004-12-05</pubdate>

  <revhistory>
    <revision>
      <revnumber>0.2.fr.1.0</revnumber>
      <date>2004-12-05</date>
      <authorinitials>SD, GL, JPG</authorinitials>
      <revremark>Première adaptation française</revremark>
    </revision>
    
    <revision>
      <revnumber>0.2</revnumber>
      <date>2002-05-28</date>
      <authorinitials>CJE</authorinitials>
      <revremark>

          Mise à jour pour MMBase 1.5, perte du support de l'interface
          apache (<emphasis lang="en">Updated for MMBase 1.5; lost
          support for apache frontend</emphasis>)

      </revremark>
    </revision>
    <revision>
      <revnumber>0.1</revnumber>
      <date>2001-10-04</date>
      <authorinitials>CJE</authorinitials>
      <revremark>

          Version initiale &mdash; Installer MMBase 1.4 sur Woody
          &mdash; <emphasis lang="en">Initial version - Installing
          MMBase 1.4; on Woody</emphasis>

      </revremark>

      </revision>
    </revhistory>
    <abstract><para>
    
        Ce document explique brièvement la mise en place de MMBase sur
        un système GNU/Linux Debian (Woody) en utilisant autant que
        possible les paquets inclus dans la distribution.
    
    </para></abstract>

</articleinfo>

<section>

<title>Introduction</title>

<section>

<title>Page web</title>

<para>
  
Vous trouverez la plus récente version française de ce document à
l'adresse&nbsp;: <ulink url="&howto;MMBase.html"/>.
              
</para>

<para>

Si vous avez obtenu ce document depuis un site miroir contenant des 
Guides pratiques ou un CD-ROM, vous devriez vérifier sur <ulink
url="http://www.dnd.utwente.nl/~joost/mmbase-mini/MMBase-Mini-HOWTO.html">la
page web du Petit guide de MMBase (en anglais)</ulink> pour voir si
une nouvelle version est parue.

</para>



<para>

Ce document ne couvre qu'une toute petite portion de l'installation de
MMBase. Pour la documentation officielle, visitez la <ulink
url="http://www.mmbase.org">Page web de MMBase</ulink>.

</para>

</section>

<section>

<title>Avertissement</title>

<para>

Nous ne pouvons accepter aucune responsabilité quant au contenu de ces
documents. Vous utilisez à vos risques et périls les concepts, exemples 
et autres informations contenues dans ce document.

</para>

<para>

Tous les noms déposés sont propriétés de leurs détenteurs respectifs à
moins d'une indication spécifique du contraire. L'utilisation d'un terme
dans ce document ne peut être vue comme affectant la validité d'un nom
déposé.

</para>

<para>

Ceci est mon premier guide pratique, ma première expérience avec
linuxdoc et je ne suis pas non plus un expert de MMBase. J'essaie juste
de partager mes solutions aux problèmes que j'ai rencontré en installant
MMBase sur une système Debian.

</para>

</section>

<section>

<title>Droits d'auteurs</title>

<para>

Copyright &copy; 2001-2002 Casper Joost Eyckelhof, Tous droits réservés.
Ceci est une documentation livre, vous pouvez la redistribuer et/ou la
modifier sous les termes de la version 2 ou ultérieure de la <ulink
url="http://www.gnu.org/copyleft/gpl.html">GNU General Public
License</ulink>.

</para>

</section>

<section>

<title>Remerciements</title>

<para>

Je voudrais remercier un bon nombre de personnes pour m'avoir aidé lors
de mon installation. Même si je ne connais pas leurs noms, leurs
pseudonymes irc sont&nbsp;: <emphasis>keesj, jdg, flax, scb2</emphasis>. 
J'espère qu'ils me pardonneront de ne pas avoir cherché leurs vrais
noms.

</para>

<para>

Je voudrais aussi remercier mon employeur, l'<emphasis>Université de
Twente</emphasis> pour m'avoir autorisé à écrire ce document durant mes
heures de travail.

</para>

</section>

</section>

<section>

<title>Qu'est-ce que MMBase&nbsp;?</title>

<para>

Sur leur site Web, les auteurs disent que&nbsp;:

</para>

<itemizedlist>

<listitem><para>

MMBase est un système de publication opensource. MMBase peut être
utilisé pour créer de gros sites web pouvant être maintenus facilement.

</para></listitem>

<listitem><para>

MMBase sépare le contenu de la présentation, pour que l'information
puisse être réutilisée facilement.

</para></listitem>

<listitem><para>

MMBase est unique car il crée un objet qui est la représentation de vos
centres d'intérêts dans le monde <quote>réel</quote>.

</para></listitem>

</itemizedlist>

<para>

Dans ce document, je décrirais comment faire fonctionner MMBase sur un
système Debian Woody en utilisant au possible les packages inclus dans
la distribution. Même si il est très facile de lancer MMBase avec ses
outils d'installation automatique, vous aurez à la fin leur version de
serveur web, lanceur de servlets et base de données.

</para>

<para>

Après quelques jours d'utilisation de ma propre installation, j'ai pensé
que je pourrais aider les autres en décrivant les choix que j'ai fait
pour que çà marche. Je ne dis pas que c'est le seul moyen, ou le
meilleur&nbsp;! Mais çà à marché pour moi :)

</para>

<para>

La version de MMBase utilisée est la 1.5. Bien sur tout peut être
différent d'une version à l'autre.

</para>

<para>

MMBase peut fonctionner avec différents serveurs, bases de données,
lanceurs de servlets et Environnements Java. Les
programmes/packages/versions que j'ai choisi sont&nbsp;:

</para>

<itemizedlist>
<listitem><para>MySQL-Server (3.23.49-8)</para></listitem>
<listitem><para>Tomcat4 (4.0.3-3)</para></listitem>
<listitem><para>j2sdk1.3 (1.3.1-1) (Java)</para></listitem>
<listitem><para>imagemagick (4:5.4.4.5-1)</para></listitem>
</itemizedlist>

<para>

Attention&nbsp;: Les numéros de version sont ceux disponibles dans la
distribution Woody au moment de l'écriture. Excepté pour Java qui vient
d'ailleurs. Voir <link linkend="java">Paquets non inclus"</link>.

</para>

<para>

Quelques autres options pour les bases de données et les serveurs Web
sont décrites dans les notes d'installation de MMBase 1.5

</para>

</section>

<section>

<title>Pré-requis</title>

<para>

Vous aurez besoin d'une installation Debian Woody incluant apt et vous
devrez vous assurer que vous possédez les packages suivants installés et
fonctionnant correctement.

</para>

<section>

<title>Standard packages</title>

<itemizedlist>
<listitem><para>tomcat4</para></listitem>
<listitem><para>mysql-server</para></listitem>
<listitem><para>imagemagick</para></listitem>
</itemizedlist>

<para>

Si ces packages ne sont pas installés, vous pouvez le faire en saisissant

</para>

<screen>
apt-get install foo
</screen>

<para>

où foo est l'un des noms ci-dessus.

</para>

<para>

Note&nbsp;: naturellement, vous aurez aussi besoin des dépendances, mais
apt prendra soin de cela automatiquement.

</para>

</section>

<section id="java">

<title>Paquets non inclus</title>

<para>

Au moment où j'écris ce document, Woody ne contient que java 1.1, mais
pour MMBase, la v1.2 au minimum est nécessaire. J'ai installé les
packages depuis Blackdown. Une liste des miroirs Blackdown est
disponible sur <ulink
url="http://www.blackdown.org/java-linux/mirrors.html"/>.
  
</para>

<para>

J'ai ajouté ce qui suit à mon fichier /etc/apt/sources.list , mais le
chemin peut être différent selon le miroir&nbsp;:

</para>

<screen>
deb ftp://ftp.nluug.nl/pub/os/Linux/java/jdk/debian woody non-free
</screen>

<para>

Après cela vous pouvez simplement saisir

</para>

<screen>
apt-get install j2sdk1.3
</screen>

<para>

Note&nbsp;: même si il doit être possible d'avoir plus d'un
Environnement Java installé, je ne vous le recommande pas sauf si c'est
absolument nécessaire.

</para>

</section>

</section>

<section>

<title>Obtenir MMBase et mettre en place certains éléments</title>

<section>

<title>Obtenir MMBase</title>

<para>

Maintenant que vous avez tous les packages installés et fonctionnant
(vous <emphasis>avez</emphasis> suivi les instruction dans la section
précédente n'est-ce pas&nbsp;?), obtenez une copie de MMBase de 
version&nbsp;1.4.

</para>

<para>

Téléchargez MMBase depuis <ulink
url="http://www.mmbase.org/releases/mmbase-1.5.zip"/> avec un navigateur
ou plus facilement avec&nbsp;:

</para>

<screen>
wget http://www.mmbase.org/releases/mmbase-1.5.zip
</screen>

<para>

Depuis sa version 1.5, MMBase peut être utilisé comme application web
dans Tomcat. Je recommande donc de décompresser le package dans un
répertoire temporaire et de copier le dossier mmbase-webapp/ dans
/var/lib/tomcat4/webapps/. Si MMBase et votre seule (ou principale)
application dans Tomcat, vous pouvez aussi l'installer avec les droits
super-utilisateur depuis mmbase-webapp/ vers
/var/lib/tomcat4/webapps/ROOT/.

</para>

<para>

Dans ce document, j'estime que MMBase est décompressé dans
/var/lib/tomcat4/webapps/mmbase-webapp/

</para>

</section>

<section>

<title>Obtenir mm.mysql</title>

<para>

Vous aurez aussi besoin de mysql.jar (pilote JDBC pour MySQL) qui peut
être téléchargé depuis <ulink url="http://mmmysql.sourceforge.net/"/>. 

</para>

<para>

Assurez-vous d'avoir le fichier jar binaire, ce qui signifie que vous
pourrez avoir à décompresser le package complet tout d'abord, puis à
localiser le fichier mm.mysql-2.0.14-bin.jar (la version 2.0.14 est la
plus récente au moment ou j'écris ce guide). Mettez le fichier dans
/var/lib/tomcat4/webapps/mmbase-webapp/WEB-INF/lib/.

</para>

</section>

<section>

<title>Créer une base de données pour MMBase</title>

<para>

MMbase a besoin d'une base de données et d'un utilisateur ayant tous les
droits sur cette base de données. Cet utilisateur semble avoir besoin
des droits via l'hôte local et le vrai nom d'hôte. Ce n'est pas très
clair pour moi.

</para>

<para>

Lancez les commandes suivantes à l'invite de MySQL. J'ai choisi une base
de données appelée MMBase, un utilisateur appelé mmbaseuser et un mot de
passe <quote>secret</quote>.

</para>

<screen>
CREATE DATABASE MMBase
USE MMBase
GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP ON MMBase.* TO mmbaseuser@'%' IDENTIFIED BY 'secret';
GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP ON MMBase.* TO mmbaseuser@localhost IDENTIFIED BY 'secret'
GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP ON MMBase.* TO mmbaseuser@realhostname IDENTIFIED BY 'secret'
flush privileges;
</screen>

</section>

<section>

<title>Sécurisation via Tomcat</title>

<para>

L'agent de sécurisation java de Tomcat peut interférer avec MMBase. Je
n'ai pas trouvé la configuration pour lancer MMBase avec cet agent de
sécurité actif. Pour le moment, j'ai désactivé l'agent de sécurité, ce
que vous ne devriez jamais faire. (Gros avertissement&nbsp;!)

</para>

<para>

Dans /etc/default/tomcat4 changez la ligne sécurité en&nbsp;:

</para>

<programlisting>
TOMCAT4_SECURITY="no"
</programlisting>

</section>

<section>

<title>Copier xml-apis</title>

<para>

Pour une raison inconnue, Tomcat veut trouver le fichier
WEB-INF/lib/xml-apis.jar également dans
/usr/share/tomcat/common/lib/xml-apis.jar, vous aurez donc à le
copier.

</para>

</section>

</section>

<section>

<title>Fichier de configuration</title>

<para>

Il y a quelques fichiers de configuration qui ont besoin d'être crées ou
ajustés.

</para>

<section>

<title>apache</title>

<para>

Dans mon installation, j'ai créé un hôte virtuel pour s'occuper de
toutes les requêtes MMBase. Mais il n'est pas très difficile d'inclure
MMBase dans votre arborescence web normale.

</para>

<para>

Ce fut pour ma dernière installation (Guide version 0.1, couvrant
MMBase&nbsp;1.4).

</para>

<para>

En utilisant la dernière version de Tomcat et Apache, j'ai eu des
problèmes pour faire fonctionner les deux ensembles. Dès que j'aurais
trouvé comment utiliser libapache-mod-webapp ou libapache-mod-jk avec
tomcat4, je mettrais à jour ce Guide.

</para>

<para>

Une des solutions possibles est de compiler mod-webapp vous-mêmes, car
la version fournie dans Debian ne semble pas être la version standard.
Mais cela dépasse la portée et l'intention de ce Guide.

</para>

<para>

Cela signifie aussi que par défaut, MMBase fonctionnera sur le port 8180
(directement depuis le serveur Tomcat. Vous pouvez changer ce port dans
/etc/tomcat4/server.xml

</para>

</section>

<section>

<title>MMBase</title>

<para>

Bien que beaucoup de choses doivent être configurées sur MMBase
lui-même, j'ai ajouté quelques éléments à ce petit Guide.

</para>

<para>

L'accès à la base de données doit être configuré dans
WEB-INF/config/modules/jdbc.xml&nbsp;:

</para>

<programlisting>
&lt;property name="url"&gt;jdbc:mysql://$HOST:$PORT/$DBM?user=mmbaseuser&amp;password=secret&lt;//property&gt;
&lt;property name="user"&gt;url&lt;//property&gt;
&lt;property name="password"&gt;url&lt;//property&gt;
&lt;property name="database"&gt;MMBase&lt;//property&gt;
&lt;property name="driver"&gt;org.gjt.mm.mysql.Driver&lt;//property&gt;
</programlisting>

<para>

Il y a de plus une ligne à changer pour faire fonctionner la connexion
à mysql. Dans WEB-INF/config/modules/mmbaseroot.xml Assurez-vous d'avoir
cette option&nbsp;:

</para>

<programlisting>
&lt;property name="database"&gt;mysql&lt;//property&gt;
</programlisting>

<para>

Le compilateur d'images contient un chemin à convertir qui n'est pas
conforme Debian. Changez WEB-INF/config/builders/images.xml comme cela

</para>

<programlisting>
&lt;properties&gt;
  &lt;property name="ImageConvert.ConverterCommand"&gt;bin/convert&lt;/property&gt;
  &lt;property name="ImageConvert.ConverterRoot"&gt;/usr/&lt;/property&gt;
  &lt;property name="ImageConvertClass"&gt;org.mmbase.module.builders.ConvertImageMagick&lt;/property&gt;
&lt;/properties&gt;
</programlisting>

</section>

</section>

<section>

<title>Obtenir plus d'aide</title>

<para>

Il y a plusieurs sources pour obtenir plus d'aide sur la plupart des
sujets traités dans ce petit Guide. Tous les packages ont leur propre
documentation. Certains liens qui m'ont vraiment aidé sont listés
ci-dessous&nbsp;:

</para>

<itemizedlist>

<listitem><para>

pour Apache&nbsp;: <ulink url="http://httpd.apache.org/docs/"/>&nbsp;;

</para></listitem>

<listitem><para>

pour Tomcat&nbsp;: <ulink
url="http://jakarta.apache.org/tomcat/tomcat-4.0-doc/index.html"/>&nbsp;;

</para></listitem>

<listitem><para>

pour MMBase&nbsp;: cliquez sur Documentation dans <ulink
url="http://www.mmbase.org/"/>&nbsp;;

</para></listitem>

<listitem><para>

pour Java&nbsp;: <ulink url="http://java.sun.com/"/>&nbsp;;

</para></listitem>

</itemizedlist>

<para>

Une autre grande source d'aide est le canal #mmbase sur ircnet,
normalement vous y trouverez quelques développeurs.

</para>

</section>

</article>
