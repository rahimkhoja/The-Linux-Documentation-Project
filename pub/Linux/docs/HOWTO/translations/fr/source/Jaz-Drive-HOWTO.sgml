<!DOCTYPE LINUXDOC SYSTEM>

<!-- Ce fichier a été tapé avec mes petits doigts dans Emacs -HSD -->
<!-- pas la traduction :-) - NdT -->
<!-- plein de mélanges HTML / LinuxDoc ! -->

<ARTICLE>
<TITLE>Le Jaz-drive HOWTO</TITLE>
<AUTHOR>Herbert S. DaSilva
<newline>
Traduit par Carine Bournez, <tt><url url="mailto:cbournez@if.insa-lyon.fr" 
name="cbournez@if.insa-lyon.fr"></tt> 
et Olivier Tharan, <tt><url
url="mailto:olive@oban.frmug.org"
name="olive@oban.frmug.org"></tt> (jusqu'à sa version 1.6).

<date>v1.8, 12 Janvier 2000

<ABSTRACT>Voici la traduction française du Jaz-Drive HOWTO, 
elle décrit la configuration et l'utilisation des lecteurs Iomega Jaz de 1 Go et 2 Go sous Linux. 
</ABSTRACT>

<TOC>

<sect>Introduction
<p>

Le lecteur Jaz d'Iomega est un lecteur de disques amovibles d'une capacité de
1 ou 2 Go. À la différence du lecteur Zip, le Jaz n'est disponible qu'en
version SCSI (interne ou externe), et une interface SCSI et un pilote sont
donc nécessaires pour utiliser ces lecteurs.

<SECT1>Historique<label id="History" >
<p>

Une grande partie de ce HOWTO est l'oeuvre créée par le premier auteur, 
Bob Willmot, (que l'on peut maintenant joindre à
 <url url="mailto:bob@willmot.com" name="bob@willmot.com">), qui a maintenu
 le HOWTO jusqu'à la version 1.6, avec les contributions et informations données 
 par les personnes suivantes~:

<ITEMIZE>
 <ITEM>Grant Gunther, grant@torque.net
 <ITEM>Tom Poindexter, tpoindex@nyx.net
 <ITEM>Todd Woods, woods@cs.uiowa.edu
 <ITEM>Richard B. Melrose, rbm@math.mit.edu
 <ITEM>Phil Howard, phil@charon.milepost.com
 <ITEM>Rick Niess, rniess@ocean.st.usm.edu
</ITEMIZE>


<SECT1>Dernière Version
<p>

La dernière version de ce document se trouve sur ma page web 
 <url url="http://www.ultranet.com/~hsd/HOWTO/" name="http://www.ultranet.com/~hsd/HOWTO/">,
 où vous pourrez trouver la version HTML, qui convient à la navigation, la version PostScript,
 pour l'impression, et le source SGML.
 D'autres versions peuvent se trouver en différents formats sur la page du LDP 
 <url url="http://www.linuxdoc.org/" name="http://www.linuxdoc.org/">.


<SECT2>Historique des Versions
<p>

v1.8, 12 Janvier 2000
<ITEMIZE>
 <ITEM>Correction d'un lien HTTP incorrect
 <ITEM>Ajout d'éclaircissements pour le code jaztool des lecteurs 2 Go
</ITEMIZE>

v1.7, 18 Novembre 1999
<ITEMIZE>
 <ITEM>Conversion en SGML
 <ITEM>Ajout d'infos pour les lecteurs 2 Go
 <ITEM>Ajout d'exemples d'entrées fstab
 <ITEM>Rafraîchissement général
</ITEMIZE>

Si vous avez des commentaires, des suggestions, des corrections, veuillez
les envoyer à~:
 Herb DaSilva <url url="mailto:hsd@ma.ultranet.com" name="à la maison"> ou
 (si vous avez <EM>vraiment</EM> besoin d'une réponse rapide)
 <url url="mailto:herb@aoainc.com" name="au travail">.


<SECT1>Copyrights et marques déposées
<p>

Copyright &copy; 2000, 1999 Herbert S. DaSilva

Ce manuel peut être reproduit intégralement ou partiellement, sans droits, 
avec les restrictions suivantes~:

<ITEMIZE>
 <ITEM>La mention du copyright ci-dessus et de la présente autorisation doit
 être conservée intacte sur toute copie intégrale ou partielle.
 <ITEM>Toute traduction ou travail dérivé doit être approuvé par l'auteur avant 
 sa distribution.
 <ITEM>Si vous distribuez ce travail partiellement, des instructions pour se procurer
 la version complète de ce manuel doivent être incluses et un moyen de se procurer 
 la version complète mis à disposition.
 <ITEM>Des petites parties peuvent être reproduites à titre d'illustrations pour
 des revues ou citations dans d'autres travaux sans la mention de l'autorisation,
 si une référence correcte est donnée.
</ITEMIZE>

À des fins pédagogiques, des exceptions à ces règles peuvent être accordées~:
écrivez à l'auteur et demandez. Ces restrictions sont là pour protéger les auteurs,
pas pour restreindre ceux qui apprennent et ceux qui enseignent. Tout code source
de ce document est placé sous la GNU General Public License, disponible via ftp
anonyme à
 <url url="ftp://prep.ai.mit.edu/pub/GNU/COPYING" name="le site d'archives GNU">.


<SECT1>Remerciements
<p>

Merci à Stephan Burlot, stephan.burlot@edicom.ch, qui a repéré l'erreur (ou le
manque de clarté) dans le patch 2 Go pour jaztool, qui a été corrigé dans la version 1.8.

Mes remerciements vont à Mark F. Komarinski pour son "HOWTO-HOWTO" - Ce guide
m'a bien aidé Mark, tu as fait ton boulot.  ;-)
 
<SECT>Le matériel Jaz
<p>

<SECT1>Les lecteurs Jaz
<p>

Les lecteurs Jaz sont des périphériques SCSI disponibles en lecteurs externes
avec une interface SCSI-2 à 50 broches avec bouchon intégré ou bien en lecteur 
interne format 3,5" avec une interface frontale 50 broches.

Les lecteurs externe et interne sont tous deux disponibles en
capacité de 1 ou 2 gigaoctets, il existe donc 4 types de lecteurs Jaz.


<SECT1>Les « disques » Jaz
<p>

Les disques Jaz sont des supports amovibles, genre cartouches, contenant
un empilement de trois plateaux de 3,5". À partir de maintenant, nous utiliserons 
les termes « cartouche » ou « disque » indifféremment.

Les cartouches 1 Go et 2 Go ont la même allure, mais en fait il y a une subtile
différence dans leur forme, qui empêche de mettre une cartouche 2 Go dans un lecteur
de cartouches 1 Go. Visiblement, cela signifie qu'on ne peut pas utiliser de cartouche
2 Go dans un lecteur 1 Go.

Les lecteurs Jaz pour 2 Go peuvent lire, écrire et formater aussi bien des 
cartouches 2 Go que 1 Go.

<sect1>L'adaptateur Jaz Jet
<p>

Iomega commercialise un adaptateur SCSI sous le nom de Jaz Jet.
Cependant, au moins deux chipsets SCSI différents sont utilisés. 
Pour cette raison, le Jaz Jet n'est pas forcément le meilleur adaptateur SCSI
à acheter si vous en avez besoin pour votre lecteur Jaz. C'est aussi bien 
d'acheter une carte que vous <EM>savez</EM> supportée par votre distribution Linux
(voir la section suivante). 

L'une des cartes Jaz Jet est basée sur la famille d'adaptateurs Adaptec 7800.
Le noyau Linux 2.0 supporte cet adaptateur avec le pilote aic7xxx. Ce pilote est
inclus dans la plupart des noyaux standards 2.x avec SCSI fournis avec la plupart
des distributions Linux.

L'autre adaptateur est basé sur le chipset Advanced Systems. Au démarrage,
la carte donne un message ainsi~:

<tscreen><verb>
Jaz Jet PCI SCSI adapter Copyright Advanced Systems 1996
</verb></tscreen>

Selon votre distribution Linux, vous devrez peut-être recompiler un noyau 
(avec la variable CONFIG_SCSI_ADVANSYS positionnée) pour utiliser cet adaptateur.


Personnellement, je n'aime pas les suprises, donc si j'allais acheter une carte
adaptatrice, je prendrais une carte de marque, avec un connecteur 50 broches, pour être 
sûr que ce que je prends soit supporté.


<SECT1>Autres adaptateurs SCSI
<p>

Si vous utilisez une carte SCSI Ultra-Wide avec un connecteur à 68 broches,
vous devrez trouver un adaptateur ou un autre câble. Les adaptateurs fonctionnent vraiment
bien avec les lecteurs Jaz, mais sont assez chers, donc si vous achetez une carte
SCSI principalement pour connecter le lecteur Jaz, vous feriez mieux d'en prendre une qui possède
un connecteur 50 broches.

Si vous cherchez une suggestion, j'aime bien l'Adaptec AHA-2930U - Elle est
bon marché, rapide, et le lecteur Jaz se branche juste bien en utilisant le 
câble fourni, sans embêtements d'adaptateur. Malheureusement, le support de 
cette carte est relativement nouveau, donc à moins d'avoir une distribution Linux
bien récente (noyau 2.2.x), elle n'est probablement pas supportée directement.
Il existe des patchs au pilote aic7xxx pour les noyaux 2.0.36, cependant. L'AHA-2940U
est un excellent choix également et a été supportée depuis beaucoup plus longtemps,
elle est juste un peu plus chère.

<SECT1>Problèmes de pilote et noyaux
<p>

Comme toujours, assurez-vous que votre noyau Linux supporte EXPLICITEMENT 
une carte donnée avant un achat. De nombreux fabricants, tels qu'Adaptec, ont des
modèles de cartes identifiées par des chiffres et des lettres <EM>semblables</EM> entre
eux mais utilisant en fait des chipsets <EM>complètement différents</EM>, et fonctionnent
donc avec des <EM>pilotes complètement différents</EM>.
 
La configuration d'un noyau pour une carte SCSI est un sujet pour un document entier
à lui seul, donc je ne vais pas détailler cela ici.

Les informations pour construire le noyau se trouvent dans le fichier
<tt>/usr/src/linux/README</tt>, ou dans le répertoire
<tt>/usr/src/linux/Documentation/</tt>
pour les noyaux 2.x.
 Si ces fichiers n'existent pas, assurez-vous d'avoir installé le paquetage des sources du noyau
 de votre distribution.

Allez aussi faire un tour sur le Kernel-HOWTO de Brian Ward (traduit par
Eric Dumas)~:

<itemize>
<item><url url="http://metalab.unc.edu/mdw/HOWTO/Kernel-HOWTO.html" name="Le Kernel-HOWTO"> (ou <url url="http://www.linuxdoc.org/HOWTO/Kernel-HOWTO.html" name="Kernel-HOWTO sur le site linuxdoc du LDP">, ou encore <url url="http://www.freenix.org/unix/linux/HOWTO/Kernel-HOWTO.html" name="Le Kernel-HOWTO traduit en français"> )

<item><url url="http://www.freenix.fr/linux/HOWTO/Kernel-HOWTO.html" name="Sa traduction française">
</itemize>

<SECT>Identifier le lecteur Jaz
<p>

<SECT1>Pendant le test de mise sous tension
<p>

Lorsque la machine est mise sous tension ou réinitialisée, le contrôleur SCSI
va scanner le bus SCSI pour trouver les périphériques attachés, avant que le système
d'exploitation ne démarre.

Si votre carte SCSI est installée correctement et que votre lecteur Jaz 
est attaché et alimenté, vous devriez voir le lecteur listé comme quelquechose
ressemblant à « Iomega Jaz 1GB » ou « Iomega Jaz 2GB » à ce moment.

Si le lecteur n'apparaît pas, ce n'est pas la peine de démarrer Linux. Arrêtez
le PC et le lecteur Jaz et revérifiez tout. En particulier, débranchez les câbles
et assurez-vous qu'aucune broche n'est tordue, puis rebranchez-les et vérifiez qu'ils sont
bien placés contre le connecteur. Si vous avez plusieurs périphériques SCSI, assurez-vous 
qu'ils ont tous des numéros ID différents et que le dernier périphérique SCSI de
la chaîne a un terminateur.

Lorsque le lecteur apparaît dans le test d'allumage, vous avez fait la moitié
du travail.

<SECT1>Pendant le démarrage
<p>

Quand votre Linux démarre, le pilote SCSI devrait afficher des informations sur votre
adaptateur et sur tous les périphériques attachés au bus.

Les messages de démarrage varient selon votre adaptateur SCSI et sont aussi
ajoutés au fichier <tt>/var/log/messages</tt> (ou
<tt>/var/adm/messages</tt>). Vous pouvez
aussi « revoir » ces messages à partir de la ligne de commande avec la
commande <tt/dmesg/.

Voici la sortie écran d'un démarrage du noyau sur un noyau 2.0.36 avec un
contrôleur Adaptec 2940 (en utilisant le pilote aic7xxx)~:

<tscreen><verb>
    (scsi0) <Adaptec AHA-2940A Ultra SCSI host adapter> found at PCI 14/0
    (scsi0) Narrow Channel, SCSI ID=7, 3/255 SCBs
    (scsi0) Warning - detected auto-termination
    (scsi0) Please verify driver detected settings are correct.
    (scsi0) If not, then please properly set the device termination
    (scsi0) in the Adaptec SCSI BIOS by hitting CTRL-A when prompted
    (scsi0) during machine bootup.
    (scsi0) Cables present (Int-50 NO, Ext-50 YES)
    (scsi0) Downloading sequencer code... 419 instructions downloaded
    scsi0 : Adaptec AHA274x/284x/294x (EISA/VLB/PCI-Fast SCSI) 5.1.2/3.2.4
           <Adaptec AHA-2940A Ultra SCSI host adapter>
    scsi : 1 host.
      Vendor: iomega    Model: jaz 2GB           Rev: E.17
      Type:   Direct-Access                      ANSI SCSI revision: 02
    Detected scsi removable disk sda at scsi0, channel 0, id 4, lun 0
    scsi : detected 1 SCSI disks total.
    (scsi0:0:4:0) Synchronous at 10.0 Mbyte/sec, offset 15.
    sda : READ CAPACITY failed.
    sda : status = 1, message = 00, host = 0, driver = 28 
    sda : extended sense code = 2 
    sda : block size assumed to be 512 bytes, disk size 1GB.  
</verb></tscreen>

Si ces lignes n'apparaissent pas, c'est que quelque chose est mal configuré
(ou bien vous avez pris un mauvais noyau pré-compilé).

Si la ligne <tt/scsi0:/ n'apparait pas, c'est que vous n'avez pas configuré
votre adaptateur et son pilote correctement. Certains pilotes vous
donneront un indice sur ce qui ne va pas. Si un nom de lecteur
n'est pas donné, vous avez probablement oublié d'inclure le support pour
disque SCSI quand vous avez construit le noyau.

Notez le <TT>READ CAPACITY failed</TT>. La plupart des pilotes SCSI (tels que
celui-ci) détecteront que le lecteur est un support amovible et ne seront pas 
complètement paumés s'ils n'arrivent pas à lire une table de partitions. Cependant,
certaines cartes SCSI ne sont pas aussi futées. Si votre PC se bloque au démarrage,
essayez de démarrer avec une cartouche dans le lecteur.

Vérifiez les fichiers <tt/README/ dans <tt>/usr/src/linux/drivers/scsi</tt> et le 
Kernel-HOWTO pour d'autres indices de débogage.

<SECT1>Nom du lecteur
<p>

Dans la sortie de log de la section précédente, notez la terminaison du nom du périphérique
SCSI, qui dans ce cas précis est « sda », le nom complet étant /dev/sda.
Si le lecteur Jaz est le seul disque SCSI sur votre système, ce sera typiquement 
/dev/sda. Si votre disque dur primaire est SCSI, ou bien si vous avez un lecteur
CD-ROM SCSI, cela peut être sdb, sdc, etc.
 
Quel que soit le nom du lecteur, vous en aurez besoin pour accéder au disque,
comme l'expliquent les sections suivantes.

<SECT>Utiliser un disque Jaz
<p>

<SECT1>Disques formatés pour DOS
<p>

Les disques formatés en usine chez Iomega sont partitionnés avec une seule
partition utilisant le système de fichiers DOS FAT16. Cette unique partition est en
général la 4ème du disque (pour compatibilité avec le Mac - le Mac réclame que les 
données soient sur la 4ème partition, mais cela n'a pas d'importance pour le PC).

Linux est parfaitement content de lire et écrire sur un système de fichiers FAT16,
donc vous pouvez utiliser le disque tel quel. Pour cela, vous devez le monter,
la première chose à faire est donc de créer un point de montage. Dans ce document,
nous monterons tous les disques Jaz DOS sur <tt>/dos_jaz</tt>, créons donc ce point 
(il faut être root pour cela). Il n'est nécessaire de faire ceci qu'une seule fois~:

<tscreen><verb>
mkdir /dos_jaz
</verb></tscreen>

Dans une section précédente, j'ai mentionné qu'il fallait se rappeler le nom
du périphérique SCSI. Vous en avez besoin maintenant. Si votre lecteur 
est <tt>/dev/sda</tt> alors tous ces exemples fonctionneront pour vous. Sinon, vous
devrez remplacer « sda » par le périphérique de votre lecteur Jaz. Puisque ces commandes
sont exécutées par root, soyez sûr(e) d'avoir le nom correct.

Si vous avez un noyau 2.0, ou si vous avez ajouté le support VFAT, vous pouvez
monter le disque Jaz de cette manière pour avoir les noms longs avec la FAT16~:

<tscreen><verb>
mount -t vfat /dev/sda4 /dos_jaz
</verb></tscreen>

Notez que bien que la VFAT permette d'utiliser les noms longs, ces noms de fichiers
sont toujours <EM>in</EM>-sensibles à la casse, et bien que 'ls' liste les permissions,
vous ne pouvez en fait pas changer les permissions d'aucun des fichiers.

Si le format « vfat » n'est pas reconnu par la commande mount, utilisez la commande
suivante pour monter le disque Jaz~:

<tscreen><verb>
mount -t msdos /dev/sda4 /dos_jaz
</verb></tscreen>

Une fois qu'une de ces commandes est exécutée, les fichiers du disque
apparaîtront dans le répertoire <TT>/dos_jaz</TT>. Pendant que le disque est
monté, vous ne pouvez pas l'éjecter.

Quand vous en avez fini avec le disque, vous pouvez le démonter avec la 
commande~:

<tscreen><verb>
umount /dos_jaz
</verb></tscreen>

Une fois démonté, vous pouvez presser sur le bouton à l'avant du lecteur
pour éjecter la cartouche.

<SECT1>Repartitionner les disques Jaz DOS
<p>

Puisqu'un disque Jaz est un simple disque, on peut le repartitionner et reformater
comme un disque fixe. Si le disque a été repartitionné, il faut se souvenir des numéros
des nouvelles partitions pour pouvoir monter le disque.

Par exemple, si la table de partitions a été balayée et qu'une seule nouvelle partition
a été créée comme première partition, les deux commandes mount de la section précédentes 
seront~:

<tscreen><verb>
mount -t vfat /dev/sda1 /dos_jaz
</verb></tscreen>

et

<tscreen><verb>
mount -t msdos /dev/sda1 /dos_jaz
</verb></tscreen>


<SECT1>Disques Jaz pour Linux
<p>

Les disques Jaz en natif pour Linux permettent de stocker des fichiers avec les
permissions standard Unix et les noms de fichiers sensibles à la casse. Le seul inconvénient
aux disques Linux est qu'on ne peut plus les utiliser sur les machines DOS/Windows.

Un disque Jaz est pour Linux semblable à un disque dur, donc pour ceux qui sont familiers
avec les outils d'administration de disques de Linux, la suite ne sera pas une surprise.

Si vous voulez effacer un disque Jaz et mettre un système de fichiers natif pour Linux
dessus, utilisez fdisk sur le disque entier. S'il vous plaît faites attention en utilisant 
fdisk, spécialement si vous avez un disque dur SCSI, nous ne voudrions pas avoir d'« accidents ». :-)
En particulier assurez-vous d'opérer sur le bon périphérique avant de faire des changements.
Dans la plupart des cas, vous utiliserez~:

<tscreen><verb>
fdisk /dev/sda
</verb></tscreen>

et effacerez les partitions existantes (avec la commande <tt>d</tt>). Créez alors
une nouvelle partition avec la commande <tt>n</tt>, faites-en la partition
primaire numéro 1, utilisez <tt>w</tt> pour écrire la table de partitions sur
le disque, et quittez avec <tt>q</tt>.

Une fois la partition créée, formatez-la avec~:

<tscreen><verb>
mke2fs /dev/sda1
</verb></tscreen>

(Le 1 est le numéro que vous avez donné à cette partition dans <tt>fdisk</tt>).
Je préfère créer un point de montage séparé pour les disques Jaz natifs Linux,
et vous verrez pourquoi par la suite quand on parlera de la <tt>fstab</tt>.
Créons donc ce point de montage maintenant et montons le disque~:

<tscreen><verb>
mkdir /jaz
mount -t ext2 /dev/sda1 /jaz
</verb></tscreen>

Comme d'habitude, lorsque le disque Jaz est monté, on ne peut pas l'éjecter.
Quand vous en avez fini avec le disque Jaz, démontez-le avec~:

<tscreen><verb>
umount /jaz
</verb></tscreen>

Une fois démonté, vous pouvez appuyer sur le bouton à l'avant du lecteur pour
éjecter la cartouche.

<SECT1>Vérifier un disque Jaz Linux
<p>

Tout comme les autres disques, une fois qu'un disque Jaz a été monté et 
démonté un certain nombre de fois, le système le marquera comme « sale ». 
Lorsque ceci se produit, vous aurez un message ressemblant à~:

<tscreen><verb>
Mounting unchecked filesystem, /dev/sda1.  Recommend running e2fsck.
</verb></tscreen>

Si vous voyez ce message, c'est une bonne idée de continuer et vérifier le 
disque. Le disque doit être <em>démonté</em> pour le vérifier. Malheureusement,
le message « sale » ne s'affiche qu'au montage, donc vous pouvez soit vérifier le 
disque après avoir fini de l'utiliser, soit le démonter, le vérifier, et ensuite le remonter.
Utilisez la commande suivante pour vérifier le disque (en supposant que la partition 
à vérifier est la première)~:

<tscreen><verb>
e2fsck /dev/sda1
</verb></tscreen>


<SECT1>Utiliser la fstab pour faciliter les choses
<p>

Jusqu'à maintenant, nous avons eu besoin d'être root pour monter et démonter
les disques Jaz et de taper des choses pour le montage. En ajoutant quelques entrées
dans le fichier <tt>/etc/fstab</tt>, on peut rendre l'utilisation du lecteur Jaz <em>beaucoup</em>
plus simple.

<SECT2>Les disques au format DOS
<p>

Si vous avez des disques préformatés DOS et que vous avez créé le point de
montage <tt>/dos_jaz</tt>, vous pouvez ajouter cette ligne au fichier <tt>/etc/fstab</tt>~:

<tscreen><verb>
/dev/sda4 /dos_jaz vfat defaults,user,nosuid,noauto 0 0
</verb></tscreen>

Avec cette ligne dans la fstab, <em>n'importe quel utilisateur</em> peut monter et démonter
une cartouche Jaz avec les commandes suivantes~:

<tscreen><verb>
mount /dos_jaz
umount /dos_jaz
</verb></tscreen>

Ceci parce que nous avons indiqué à Linux dans la fstab le périphérique Jaz et le type de
support, plus l'option <tt>user</tt> pour permettre à n'importe quel utilisateur de monter
et démonter le disque. Naturellement, si votre lecteur Jaz n'est pas <tt>sda</tt>, vous 
devrez changer ça, et cela ne marchera pas pour les cartouches DOS qui auront été repartitionnées
sans mettre une autre entrée dans la fstab qui utilisera un <em>autre</em> point de montage
(par exemple /dos_jaz2).

<SECT2>Formats de disques
<p>

Si vous avez des disques formatés Linux et que vous avez créé le point de montage
<tt>/jaz</tt>, vous pouvez ajouter cette ligne à la <tt>fstab</tt>:

<tscreen><verb>
/dev/sda1 /jaz ext2 defaults,user,exec,nosuid,noauto 0 0
</verb></tscreen>

Avec cette ligne dans la fstab, <em>n'importe quel utilisateur</em> peut monter et démonter
une cartouche Jaz avec les commandes suivantes~:

<tscreen><verb>
mount /jaz
umount /jaz
</verb></tscreen>

Une fois encore, nous avons indiqué à Linux dans la fstab le périphérique Jaz et le type de
support, plus l'option <tt>user</tt> pour permettre à n'importe quel utilisateur de monter
et démonter le disque. Certains administrateurs système préfèreront ne pas mettre l'option
<tt>exec</tt>, puisqu'il y a des risques de problèmes de sécurité à laisser n'importe quel
utilisateur exécuter une commande venue de n'importe quel disque, mais avec l'option
<tt>nosuid</tt>, ces risques sont minimaux.

<SECT2>Montage automatique au démarrage
<p>

Les deux exemples <tt>fstab</tt> ci-dessus ont l'option <tt>noauto</tt> pour empêcher
le disque d'être monté automatiquement au moment du démarrage.
En général, c'est une bonne idée parce que s'il n'y a pas de disque dans le lecteur
lorsque l'ordinateur démarre ou si le lecteur n'est pas sous tension, cela peut causer
beaucoup d'ennuis, selon le pilote SCSI utilisé.

Si vous êtes <em>sûr(e)</em> de vouloir monter le disque Jaz au démarrage, enlevez juste
l'option <tt>noauto</tt>, et assurez-vous que le lecteur est sous tension et qu'une cartouche
est insérée avant le démarrage. Notez que vous ne pouvez avoir qu'une seule entrée en
montage automatique pour le lecteur Jaz, ou bien vous aurez le même problème que s'il n'y 
avait pas de cartouche dans le lecteur.

<SECT1>Le disque Jaz Tools
<p>

Avec certains lecteurs Jaz, le logiciel pour faire fonctionner le lecteur est fourni
sur une cartouche Jaz au lieu d'un CD-ROM. Le « problème » avec ces disques est la protection
logicielle contre l'écriture sur ce disque, pour qu'aucun utilisateur ne puisse effacer 
le disque jusqu'à ce que les outils soient installés au moins une fois.

Il y a plusieurs moyens de débloquer le disque Jaz Tools~:

<ITEMIZE>
 <ITEM>Installer les outils Jaz Tools sur un ordinateur DOS/Windows.
 <ITEM>Utiliser un ordinateur DOS/Windows avec les outils Jaz Tools déjà installés pour
 retirer la protection par mot de passe.
 <ITEM>Utiliser un des utilitaires Linux mentionnés plus loin pour retirer la protection
 par mot de passe.
</ITEMIZE>

Si vous avez accès à un des programmes de retrait de mot de passe, tout ce dont vous
avez besoin est le mot de passe d'Iomega, qui est~:

<tscreen><verb>
APlaceForYourStuff
</verb></tscreen>

Notez que les majuscules sont importantes.

<SECT>Outils Linux pour lecteurs Jaz
<p>

<SECT1>jaztool
<p>

jaztool est un outil Linux écrit par Bob Willmot pour supporter certaines 
caractéristiques des lecteurs Jaz (incluant l'éjection contrôlée par logiciel 
et la protection en écriture). J'aime bien jaztool parce que ses commandes peuvent être
encapsulées dans des commandes et des scripts. C'est aussi facile à compiler et installer.

Le code source d'origine pour jaztool se trouve à
 <url url="http://www.willmot.com/jaztool/" name="http://www.willmot.com/jaztool/"> 
 et est aussi en miroir sur mon site à 
 <url url="http://www.ultranet.com/~hsd/HOWTO/index.shtml#jaztool" name="http://www.ultranet.com/~hsd/HOWTO/index.shtml#jaztool">

Notez que pour utiliser jaztool avec un lecteur 2 Go, vous devez changez UNE ligne de code.
Modifiez la ligne 188 comme ceci~:

<tscreen><verb>
return(!strncasecmp(id,"IOMEGA  JAZ 1GB",15));
</verb></tscreen>

en ceci :

<tscreen><verb>
return(!strncasecmp(id,"IOMEGA  JAZ",11));
</verb></tscreen>

<BF>NOTE :</BF> Il y a <BF>deux espaces</BF> entre IOMEGA et JAZ 
dans les deux lignes de code précédentes. SGML (ou peut-être juste HTML)
efface apparemment le deuxième espace.

Après la compilation et l'installation de jaztool, il faut le mettre suid root 
ou l'exécuter en tant que root, sinon il ne fonctionnera pas.

J'utilise jaztool régulièrement, donc si vous avez une question à ce propos, je serai
ravi de tenter d'y répondre.

<SECT2>Ejecter une cartouche
<p>

Pour éjecter une cartouche, tapez la commande~:

<tscreen><verb>
jaztool /dev/sda eject
</verb></tscreen>

Cela peut paraître trop de choses à taper, mais c'est facile de faire un
petit alias comme~:

<tscreen><verb>
alias jazej 'umount /jaz; jaztool /dev/sda eject'
</verb></tscreen>

<SECT2>Protection par mot de passe
<p>

Il y a deux modes de protection par mode de passe sur un Jaz, et tous les deux
sont contrôlés par logiciel. Le premier est une protection en écriture et l'autre est
une protection en lecture/écriture. jaztool vous permettra de déverrouiller un disque 
protégé en écriture, mais sous Linux un périphérique qui ne peut pas être lu ne peut pas
être monté donc la protection en lecture/écriture n'est pas supportée.

Si la cartouche est protégée en écriture (un disque Jaz Tools par exemple), tapez la
commande suivante pour le débloquer (le disque ne doit pas être monté)~:

<tscreen><verb>
jaztool /dev/sda rw
</verb></tscreen>

jaztool demande un mot de passe et si celui-ci est correct le disque est déverrouillé
et éjecté. Ceci est nécessaire pour provoquer le changement de mode du pilote SCSI quand
la cartouche est réinsérée.

Pour protéger à nouveau le disque en écriture, utilisez la commande~:

<tscreen><verb>jaztool /dev/sda ro
</verb></tscreen>

jaztool demande à nouveau un mot de passe puis le disque est verrouillé et éjecté.

Notez que jaztool ne supporte pas la caractéristique "Unprotect until Eject" que l'on
trouve dans le monde Windows. Si vous supprimez la protection par mot de passe, elle sera supprimée
jusqu'à ce que vous la remettiez.

<SECT1>jaZip
<p>

Si vous préférez une interface graphique simple et jolie pour contrôler
votre lecteur Jaz (et Zip !), il existe l'utilitaire jaZip.
Jetez un oeil là~:
 <url url="http://www.scripps.edu/~jsmith/jazip/" name="http://www.scripps.edu/~jsmith/jazip/">

Je n'ai jamais utilisé jaZip moi-même donc contactez l'auteur directement pour les questions
sur jaZip. L'information sur les contacts sont sur le site sus-cité.

<SECT>Démarrer à partir d'une cartouche Jaz
<p>

<SECT1>Problèmes de BIOS
<p>

Si le lecteur Jaz cohabite avec d'autres disques SCSI, la plupart des BIOS voudront démarrer
sur le disque qui a le plus petit identifiant SCSI. Le lecteur Jaz peut avoir un Id entre 0 et 6
et prendra typiquement le 5 par défaut. 
Certains BIOS détectent et sautent les périphériques amovibles tels que le Jaz. Si votre BIOS
est capable de démarrer sur un Jaz, vous pouvez alors mettre le disque dur SCSI principal sur l'Id SCSI 1
et changer le Jaz de l'Id 5 à 0 quand vous souhaitez démarrer sur le Jaz.

Plus typiquement, le lecteur Jaz cohabite avec un disque dur IDE. Presque tous les BIOS
veulent démarrer sur le premier disque IDE. Certains BIOS autorisent à modifier un réglage de
manière à démarrer sur un périphérique SCSI en premier. D'autres nécessitent de désactiver les 
disques IDE dans les réglages. D'autres encore nécessitent de déconnecter physiquement les 
disques IDE ou désactiver l'interface IDE.

<SECT1>Installer Linux sur une cartouche Jaz
<p>

Bien que faire fonctionner Linux à partir d'une cartouche Jaz soit <em>beaucoup</em>
plus lent que le fonctionnement à partir d'un disque dur, le lecteur Jaz fait un très
bon DRU (Emergency Repair Disk (ERD) = Disque de Réparation d'Urgence (DRU)).
C'est aussi amusant de pouvoir ajouter un nouveau Linux ou essayer Linux sur la machine 
de quelqu'un d'autre équipé d'un Jaz.

L'installation de Linux de loin la plus facile sur une cartouche Jaz
est simplement de suivre la procédure d'installation de votre
distribution favorite avec le disque Jaz comme unique disque sur votre
système. Je l'ai fait avec une RedHat 5.2 et cela marche parfaitement.
Si vous n'êtes pas très à l'aise pour les trucs étranges et sauvages avec LILO,
c'est la seule manière de procéder.

Si vous voulez faire une installation à partir de votre système
qui tourne, vous pouvez souvent y arriver en construisant un système
auto-démarrable sur une cartouche Jaz.

<ITEMIZE>
<item>partitionnez le disque et fabriquez les systèmes de fichiers. Vous
aurez probablement aussi besoin d'une partition de swap, mais peut-être
pas si vous avez beaucoup de RAM. Montez la nouvelle racine sur
<tt>/jaz</tt> et toute partition supplémentaire dans ce répertoire comme
il le faut.

<item>copiez tous les fichiers à leur emplacement. Assurez-vous que tous
les fichiers de <tt>/dev</tt> soient copiés. Assurez-vous que toutes les
permissions, propriétés et numéros de groupes soient maintenues.

<item>modifiez les fichiers sur la cartouche Jaz pour s'accorder avec le
fait qu'on démarre dessus. En particulier, assurez-vous de changer
<tt>/jaz/etc/fstab</tt> pour monter les partitions de la cartouche Jaz
comme prévu. Changez aussi <tt>/jaz/etc/lilo.conf</tt> pour faire de même.

<item>il y a deux possibilités pour installer le chargeur de démarrage LILO :
<itemize>
<item>fabriquez une disquette pour stocker le noyau et utilisez <tt/rdev/
pour lui faire monter la cartouche Jaz à la racine. Démarrez sur la
disquette quand vous êtes prêt pour la première fois puis lancez <tt/lilo/
pour rendre le MBR du Jaz démarrable.
<item>vous pouvez lancer <tt/lilo/ à partir de votre système en cours (qui
n'est pas sur le Jaz) pour installer le MBR démarrable sur la cartouche
Jaz. Pour plus d'informations sur cette option, allez voir 
<url url="http://metalab.unc.edu/mdw/HOWTO/mini/LILO.html" 
name="Le LILO mini-HOWTO d'Alessandro Rubini"> (ou <url url="http://metalab.unc.edu/mdw/HOWTO/mini/LILO.html" 
name="sur le site du LDP">, ou encore <url url="http://www.freenix.org/unix/linux/HOWTO/mini/LILO.html" name="la traduction française">).

 </ITEMIZE>
</ITEMIZE>

</ARTICLE>
