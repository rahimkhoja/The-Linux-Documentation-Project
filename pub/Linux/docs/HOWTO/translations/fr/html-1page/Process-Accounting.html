<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.21">
 <TITLE>Comment activer la comptabilité des processus sous Linux</TITLE>
</HEAD>
<BODY>
<H1>Comment activer la comptabilité des processus sous Linux</H1>

<H2>Albert M. C. Tam,
<CODE>
<A HREF="mailto:bertie@scn.org">bertie@scn.org</A></CODE><BR>
Adaptation française par
<A HREF="mailto:miodrag@ifrance.com">Miodrag Vallat</A>.</H2>8 Août 1997
<HR>
<EM>Décrit comment activer la comptabilité des processus sur un système Linux, et
l'emploi des diverses commandes de comptabilité des processus.</EM>
<HR>
<H2><A NAME="s1">1. Introduction</A></H2>

<P>Ce document décrit comment activer la comptabilité des processus sur un système
Linux, et l'emploi des diverses commandes de comptabilité des processus. Il
s'adresse aux utilisateurs des noyaux de version 1.3.73 ou ultérieure (testé
récemment avec un système RedHat 4.1 de noyau 2.0.27). Les noyaux plus anciens
que le 1.3.73 nécessitent une rustine afin de pouvoir disposer de la
comptabilité des processus.</P>
<P>Ce document est placé en «copyleft» par Albert M. C. Tam,
<CODE>
<A HREF="mailto:bertio@scn.org">bertie@scn.org</A></CODE>.
Vous êtes autorisé à utiliser, copier et distribuer ce document à des fins non
commerciales, tant que le nom de l'auteur et ce copyright est préservé dans
chaque copie, et que le document n'est pas modifié. Ce document est distribué
car potentiellement utile, mais <B>sans aucune garantie</B>, ni explicite, ni
implicite.
Bien qu'un grand soin ait été apporté pour s'assurer de la justesse de ce
document, l'auteur et le traducteur ne pourront être tenus responsables de
toute erreur ou dommage causés par l'utilisation des informations contenues
dans ce document.</P>
<P>N'hésitez pas à envoyer vos remarques et suggestions à l'auteur,
<CODE>
<A HREF="mailto:bertie@scn.org">bertie@scn.org</A></CODE>
si vous découvrez des erreurs ou s'il manque des informations. J'en serai ravi.</P>

<H2><A NAME="s2">2. Qu'est-ce que la comptabilité des processus&nbsp;?</A></H2>

<P>La comptabilité des processus est l'opération d'enregistrement et de
récapitulation des commandes exécutées sous Linux. Les noyaux Linux récents
sont capables de maintenir des informations sur les commandes exécutées,
l'utilisateur les ayant exécutées, le temps CPU consacré, et bien plus encore.</P>
<P>La comptabilité des processus vous permet de conserver des informations
détaillées sur les ressources système utilisées, leur répartition entre les
utilisateurs, et de surveiller le système.</P>

<H2><A NAME="s3">3. Où en est la comptabilité des processus sous Linux&nbsp;?</A></H2>

<P>Le support de comptabilité des processus a été intégré dans les noyaux récents
à partir de la version 1.3.73. Si vous utilisez un noyau plus ancien, il vous
faudra des rustines. Celles-ci sont disponibles en
<A HREF="ftp://iguana.hut.fi/pub/linux/Kernel/process_accounting">ftp://iguana.hut.fi/pub/linux/Kernel/process_accounting</A></P>

<H2><A NAME="s4">4. Besoins de la comptabilité des processus sous Linux</A></H2>


<H2><A NAME="ss4.1">4.1 Noyau</A>
</H2>

<P>Un noyau Linux de version 1.3.73 ou ultérieure&nbsp;; je recommande une version 2.x.
Les sources du noyau sont disponibles en
<A HREF="http://metalab.unc.edu/pub/Linux/kernel/v2.0">http://metalab.unc.edu/pub/Linux/kernel/v2.0</A></P>

<H2><A NAME="ss4.2">4.2 Logiciels de comptabilité</A>
</H2>

<P>Selon votre distribution Linux, les logiciels de comptabilité seront ou ne
seront pas installés sur votre système. S'ils ne le sont pas, essayez de les
télécharger en
<A HREF="http://metalab.unc.edu/pub/Linux/system/admin/quota-acct-modified.tgz">http://metalab.unc.edu/pub/Linux/system/admin/quota-acct-modified.tgz</A></P>

<H2><A NAME="s5">5. Mise en place de la comptabilité des processus sous Linux</A></H2>


<H2><A NAME="ss5.1">5.1 Compiler et installer les logiciels de comptabilité</A>
</H2>

<P>Les logiciels de comptabilité sont disponibles en
<A HREF="http://metalab.unc.edu/pub/Linux/system/admin/quota-acct-modified.tgz">http://metalab.unc.edu/pub/Linux/system/admin/quota-acct-modified.tgz</A></P>
<H2><A NAME="ss5.2">5.2 Modifier les scripts d'initialisation du système pour lancer la</A>
comptabilité des processus au démarrage</H2>

<P>Voici un exemple&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
        # Activer la comptabilité des processus.
        if [ -x /sbin/accton ]
        then
                /sbin/accton /var/log/pacct
                        echo "Comptabilité des processus activée."
        fi
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="ss5.3">5.3 Créer le fichier de statistiques «pacct»</A>
</H2>

<P>Vos logiciels de comptabilité exécuteront leurs commandes sur le fichier
/var/log/pacct par défaut.</P>
<P>Pour créer le fichier de statistiques&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
        touch /var/log/pacct
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Ce fichier de statistiques doit être la propriété de <CODE>root</CODE>, avec
permission de lecture et d'écriture pour <CODE>root</CODE>, et permission de
lecture pour le reste du monde&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
        chown root /var/log/pacct
        chmod 0644 /var/log/pacct
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="ss5.4">5.4 Redémarrer</A>
</H2>

<P>Redémarrer le système pour que les modifications prennent effet.</P>

<H2><A NAME="s6">6. Commandes de comptabilité diverses</A></H2>

<H2><A NAME="ss6.1">6.1 ac</A>
</H2>

<P>ac affiche des statistiques sur le temps de connexion des
utilisateurs en heures, en fonction des logins et des logout du fichier
/var/log/wtmp. ac est également capable d'afficher les
temps totaux par jour (option <CODE>-d</CODE>), et par utilisateur (option
<CODE>-p</CODE>).</P>

<H2><A NAME="ss6.2">6.2 accton</A>
</H2>

<P>accton est utilisé pour activer ou désactiver la comptabilité des
processus. Cette commande est généralement exécutée au démarrage ou à l'arrêt
du système via les scripts d'initialisation.</P>

<H2><A NAME="ss6.3">6.3 last</A>
</H2>

<P>last parcourt le fichier /var/log/wtmp et affiche des
informations sur le temps de connexion des utilisateurs.</P>

<H2><A NAME="ss6.4">6.4 sa</A>
</H2>

<P>sa résume les statistiques de comptabilité de la commande
précédente, triées par temps d'entrées/sorties, temps processeur, depuis le
fichier /var/account/pacct.</P>

<H2><A NAME="ss6.5">6.5 lastcomm</A>
</H2>

<P>lastcomm affiche la liste de toutes les commandes précédemment
exécutées, depuis le fichier /var/account/pacct.</P>

</BODY>
</HTML>
