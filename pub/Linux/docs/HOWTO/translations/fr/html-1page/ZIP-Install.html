<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.21">
 <TITLE>Mini-HOWTO : installation de Linux sur un lecteur ZIP sur port parall&egrave;le.</TITLE>
</HEAD>
<BODY>
<H1>Mini-HOWTO : installation de Linux sur un lecteur ZIP sur port parall&egrave;le.</H1>

<H2>John Higgins,
<CODE>
<A HREF="mailto:jwiggins@comp.uark.edu">jwiggins@comp.uark.edu</A></CODE><BR>
Traduit par Fran&ccedil;ois Jeanmougin
<CODE>
<A HREF="mailto:pingouin@crystal.u-strasbg.fr">pingouin@crystal.u-strasbg.fr</A></CODE><BR> La section consacrée à la debian à été traduite par cristofe le
13,4 floréal 2456.<BR></H2>v0.7, 26 Janvier 1998 (version Fran&ccedil;aise&nbsp;: 01 Février 1998)
<HR>
<EM>Ce document n'est destin&eacute; qu'&agrave; ceux qui disposent
d'un lecteur ZIP sur port parall&egrave;le et qui veulent avoir un système
Linux portable ou de sauvegarde.</EM>
<HR>
<H2><A NAME="s1">1. Mise en garde</A></H2>

<P>NOTE&nbsp;: Je n'ai aucune idée si le lecteur IDE fonctionne de la même 
manière que la version sur port parallèle, puisque je n'en ai pas, donc
merci de ne pas me le demander.</P>

<P>La partie consacrée à la Debian a juste été recopiée avec pas ou peu de
modification par l'auteur. En conséquence, il peut y avoir des redondaces
dans les instructions.</P>
<P>Pr&eacute;-requis :
<UL>
<LI> Vous avez un lecteur ZIP pour port parallèle (comme le ZIP Plus a
les deux, je pense qu'il va fonctionner aussi bien).</LI>
<LI> Vous avez d&eacute;j&agrave; Linux install&eacute; et qui marche&nbsp;;
nous n'allons pas parler d'une premi&egrave;re installation
de Linux.</LI>
<LI> Le pilote ppa du port parall&egrave;le est pr&eacute;sent dans
le noyau ou le module correspondant a &eacute;t&eacute; charg&eacute;.</LI>
<LI>Le disque ZIP est mont&eacute; sur le répertoire /iomega.</LI>
</UL>
</P>

<H2><A NAME="s2">2. Introduction</A></H2>

<P>Ce document est d&eacute;coup&eacute; en quatres parties qui d&eacute;crivent 
chacune
l'installation d'un syst&egrave;me Linux minimal sur un disque ZIP de 100Mo utilisant
le lecteur ZIP sur port parall&egrave;le. La premi&egrave;re partie 
décrit comment préparer le disque ZIP, elle
est commune aux distributions Slackware et Red Hat.
Les deuxi&egrave;me, troisi&egrave;me et quatrièmes parties
d&eacute;crivent respectivement l'installation des distributions RedHat 4.2, 
Slackware 2.2 et Debian 1.2 sur le disque ZIP.</P>
<P>NOTE&nbsp;: J'ai bien vu que la Red Hat 5.0 était enfin sortie, mais entre
les cours et le travail, bref, disons que je ne pourrai pas travailler
dessus avant la fin mai. J'espère pouvoir aussi tester les autres 
distributions.</P>

<H2><A NAME="ss2.1">2.1 Nouveautés</A>
</H2>

<P>J'ai finalement trouvé assez de temps (il faut dire que je préparais un concours
de sociologie...) pour mettre à jour ce document. Merci à tous ceux qui m'ont
envoyé des commentaires.<BR></P>
<P>Nouveautés pour ce document&nbsp;
<UL>
<LI> La distribution Debian</LI>
<LI> Lilo sur disquette</LI>
<LI> Red Hat nouvelle version (4.2 Biltmore)</LI>
<LI> Configuration réseau (non-testé pour la Red Hat)</LI>
</UL>
</P>

<H2><A NAME="ss2.2">2.2 Conventions</A>
</H2>

<P>Le sigle <B>==></B> indique que le texte qui suit est une commande.<BR>
Ceci indique une remarque importante&nbsp;:
<BLOCKQUOTE><CODE>
<HR>
<PRE>
  NOTE:
</PRE>
<HR>
</CODE></BLOCKQUOTE>

Ceci indique une "capture d'écran"
<BLOCKQUOTE><CODE>
<HR>
<PRE>
  Texte visible à l'écran
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="ss2.3">2.3 Mises &agrave; jour </A>
</H2>

<P>Pour les mises &agrave; jour, aussi rares qu'elles puissent être, consulter l'URL
<CODE>
<A HREF="http://comp.uark.edu/~jwiggins/linuxZIP/">http://comp.uark.edu/~jwiggins/linuxZIP/</A></CODE></P>


<H2><A NAME="ss2.4">2.4 Autres lectures utiles</A>
</H2>

<P>
<UL>
<LI> Installation-HOWTO</LI>
<LI> SCSI-HOWTO</LI>
<LI> NET-3-HOWTO (pour sa section 4.3.3)</LI>
<LI> ZIP-Drive (mini-HOWTO)</LI>
<LI> la patch noyau ParPort (permet d'accéder au port imprimante)
<CODE>
<A HREF="http://www.cyberelk.demon.co.uk/parport/">http://www.cyberelk.demon.co.uk/parport/</A></CODE></LI>
</UL>
</P>
<H3>Remerciements, contributeurs</H3>

<P>La section Slackware 2.2 m'a été confiée par Michael Littlejohn
<CODE>
<A HREF="mike@mesa7.mesa.colorado.edu">mike@mesa7.mesa.colorado.edu</A></CODE></P>

<P>La section Debian 1.2 m'a été confiée par John D. Blair
<CODE>
<A HREF="jdblair@uad.edu">jdblair@uad.edu</A></CODE></P>

<P>Les informations concernant LILO et beaucoup d'autres informations précises
m'ont été confiées par Barcy Boese
<CODE>
<A HREF="possum@niagara.com">possum@niagara.com</A></CODE> et Javier Rodriguez
<CODE>
<A HREF="jrodrigu@nextgeninter.net.mx">jrodriguez@nextgeninter.net.mx</A></CODE></P>

<H2><A NAME="s3">3. Pr&eacute;paration du disque ZIP (commune aux distributions Slackware et Red Hat)</A></H2>

<P>Avant de démarrer, assurez-vous d'avoir accès au lecteur ZIP; soit en ayant le pilote ppa
du port parallèle dans le noyau ou en faisant charger le module correspondant. Un moyen facile
de le vérifier est d'interroger dmesg&nbsp;:</P>
<P><B>==> dmesg</B></P>
<P>On peut rediriger la sortie vers less vu que dmesg a tendance à être un peu long.
Voici un extrait du mien&nbsp;:
<BLOCKQUOTE><CODE>
<HR>
<PRE>
  scsi0 : PPA driver version 0.26 using 4-bit mode on port 0x3bc.
  scsi : 1 host.
    Vendor: IOMEGA    Model: ZIP 100           Rev: D.08
    Type:   Direct-Access                      ANSI SCSI revision: 02
  Detected scsi removable disk sda at scsi0, channel 0, id 6, lun 0
  SCSI device sda: hdwr sector= 512 bytes. Sectors= 196608 [96 MB] [0.1 GB]
   sda: Write Protect is off
   sda: sda1 sda2
</PRE>
<HR>
</CODE></BLOCKQUOTE>

Si vous voyez seulement quelque-chose du genre&nbsp;:
<BLOCKQUOTE><CODE>
<HR>
<PRE>
          scsi : 0 hosts.
          scsi : detected total.
</PRE>
<HR>
</CODE></BLOCKQUOTE>

Alors vous avez le support SCSI mais le lecteur ZIP n'a pas été détecté.</P>

<H2><A NAME="ss3.1">3.1 Partitionnement du disque ZIP</A>
</H2>

<P>Pour partitionner le disque ZIP, lancer fdisk</P>
<P><B>==> fdisk /dev/sda</B></P>
<P>Voici un aperçu de la table de partition que j'ai faite&nbsp;:
<BLOCKQUOTE><CODE>
<HR>
<PRE>
        Disk /dev/sda: 64 heads, 32 sectors, 96 cylinders
        Units = cylinders of 2048 * 512 bytes

           Device Boot   Begin    Start      End   Blocks   Id  System
        /dev/sda1            1        1       81    82928   83  Linux native
        /dev/sda2           82       82       96    15360   82  Linux swap
</PRE>
<HR>
</CODE></BLOCKQUOTE>

J'ai d&eacute;cid&eacute; d'utiliser une partition de swap afin de
pouvoir l'utiliser sur n'importe quelle machine (syst&egrave;me portable).</P>

<H2><A NAME="ss3.2">3.2 Formater et monter le disque ZIP</A>
</H2>

<P>Apr&eacute;s avoir utilis&eacute; fdisk, formater la nouvelle partition&nbsp;:</P>
<P><B>==> mke2fs -c /dev/sda1</B></P>
<P>Ensuite, cr&eacute;er la partition de swap&nbsp; (15360 blocs comme le montre fdisk)</P>
<P><B>==> mkswap -c 15360 /dev/sda2</B></P>
<P>Finalement, monter le disque ZIP</P>
<P><B>==> mount /dev/sda1 /iomega -t ext2</B></P>


<H2><A NAME="ss3.3">3.3 Cr&eacute;er une disquette de d&eacute;marrage (boot)</A>
</H2>

<P>&Eacute;tant donn&eacute; que le lecteur ZIP sur port parall&egrave;le
n'est pas un vrai p&eacute;riph&eacute;rique SCSI, ce n'est pas un 
p&eacute;riph&eacute;rique bootable, et donc, il n&eacute;cessite une 
disquette de d&eacute;marrage qui possède le pilote ppa dans le noyau et
non sous forme de module.</P>

<H3>Configurer et compiler le noyau</H3>

<P>D'abord, il faut configurer et compiler un noyau qui a le
pilote ppa du port parall&egrave;le actif et pas comme un module chargeable.
Afin d'obtenir l'option port parall&egrave;le, s&eacute;lectionner le support
des périphériques SCSI&nbsp;:</P>
<P><I> SCSI support (CONFIG_SCSI) [Y/m/n/?] </I></P>
<P>Puis, le support des disques SCSI:</P>
<P><I> SCSI disk support (CONFIG_BLK_DEV_SD) [Y/m/n/?]</I></P>
<P>Et finalement, sous la rubrique des pilotes SCSI de bas niveau (SCSI low-level 
drivers), on trouve le pilote ppa pour port parall&egrave;le.</P>
<P><I> IOMEGA Parallel Port ZIP drive SCSI support (CONFIG_SCSI_PPA) [Y/m/n/?]</I></P>
<P>Encore une fois, il ne faut pas utiliser le pilote pour port parall&egrave;le
en module, mais bien inclus dans le noyau. Jusqu'ici, sans le patch noyau 
PortPar (voir 1.4), le pilote du port parallèle ne permettra pas d'utiliser 
le port passif du lecteur ZIP pour une imprimante, donc il est alors 
préférable de d&eacute;sactiver le support pour imprimante sur port 
parall&egrave;le&nbsp;:</P>
<P><I>Parallel printer support (CONFIG_PRINTER) [N/y/m/?]</I></P>
<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
  NOTE/&nbsp;: Pour plus d'informations sur le pilote du port parall&egrave;le,
               pri&egrave;re de se reporter au ZIP-Drive mini-HOWTO.&lt;newline>
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>
<P>Une fois le noyau configur&eacute;, le compiler ainsi&nbsp;:</P>
<P><B>==> make dep; make clean; make zImage</B></P>
<P>Le nouveau noyau devrait se trouver dans arch/i386/boot/zImage.</P>

<H3>Installer le noyau sur une disquette</H3>

<P>Après avoir du me coltiner 4 disquetes différentes, en raison de
différents noyaux nécessitant différents paramètres, (ainsi qu'après avoir lu
le magnifique e-mail m'expliquant comment le faire), j'ai inclus une
section sur LILO comme étant un des moyens de créer un disque de 
démarrage.</P>
<H3>Installation via LILO</H3>

<P>Pour ceux qui ont besoin, ou pour ceux que ça intéresserait, d'avoir
plusieurs noyaux sur une disquette (ces derniers temps, les miens sont
trop gros) ou qui veulent juste pouvoir passer des arguments (comme le
mode utilisateur unique (single)), j'ai reçu un email détaillant 
comment installer LILO sur une disquette.</P>

<H3>Créer un système de fichier ext2</H3>

<P>Pour créer un système de fichier ext2 sur une disquette, utiliser juste la même
commande que pour e disque ZIP</P>
<P><B>==> mke2fs -t /dev/fd0 </B></P>

<H3>Copier les fichiers essentiels</H3>

<P>D'abord, s'assurer qu'il y ait un dossier cible pour le montage,
et monter la disquette (j'utilise /dev/floppy)&nbsp;:</P>
<P><B>==> mount /dev/fd0 /mnt/floppy -t ext2 </B></P>
<P>Pour démarrer correctement, vous avez besoin des mêmes fichiers
que ceux que LILO utilise sur votre installation de Linux actuelle.
<BLOCKQUOTE><CODE>
<HR>
<PRE>
NOTE&nbsp;: Les chemins de fichiers donnés ici sont ceux 
            de ma machine et peuvent ne pas être les mêmes pour tout 
            le monde
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>
<P><B>==> cp /boot/boot.b /mnt/floppy</B></P>
<P><B>==> cp /boot/map /mnt/floppy</B></P>
<P><B>==> cp /usr/src/linux/arch/i386/boot/zImage /dev/fd0 /mnt/floppy/vmlinuzDESK</B></P>

<P>Maintenant, pour créer le fichier de configuration pour LILO, à ce point,
j'ignore le programme liloconfig... (merci à Javier Rodriguez pour cette
information). Premièrement, créer le fichier de configuration de LILO,
/mnt/floppy/lilo.conf, pour le(s) noyau(x) pour le lecteur ZIP. Voici ce que
j'ai utilisé et qui m'a permis d'avoir plusieurs noyaux à tester&nbsp;:
<BLOCKQUOTE><CODE>
<HR>
<PRE>
boot=/dev/fd0
map=/mnt/floppy/map
install=/mnt/floppy/boot.b
prompt
compact
timeout=50
image=/mnt/floppy/vmlinuzLAP
   label=Laptop
   root=/dev/sda1
   read-only
image=/mnt/floppy/vmlinuzDESK
   label=Desktop
   root=/dev/sda1
   read-only
image=/mnt/floppy/vmlinuzDESK
   label=rescue
   root=/dev/hdc1
   read-only
</PRE>
<HR>
</CODE></BLOCKQUOTE>

J'ai ainsi deux noyaux. Un pour mon portable 486 qui a besoin de l'émulation
du co-processeur mathématique dans le noyau, et l'autre pour mon ordinateur de bureau. Le "rescue" 
me permet de faire un démarrage dde secours sur le disque dur.</P>
<P>Enfin et surtout, lancer LILO pour
l'installer sur la disquette grace à la commande&nbsp;:</P>
<P><B>==> lilo -C /mnt/floppy/lilo.conf</B></P>
<P>Une fois LILO installé sur la disquette, sauter les deux étapes suivantes,
sauf si vous avez envie de tout recommencer :).</P>

<H3>Installation du noyau seulement</H3>


<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
NOTE : Ceci n'a rien à voir avec l'installation
       via LILO.
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>

<P>Copier le nouveau noyau sur une disquette&nbsp;:</P>
<P><B>==> cp arch/i386/boot/zImage /dev/fd0</B></P>
<P>ou</P>
<P><B>==> cat arch/i386/boot/zImage > /dev/fd0</B></P>

<P>Bien sur, il existe pl&eacute;thore de mani&egrave;res de copier un noyau
sur une disquette, mais la derni&egrave;re, ma favorite, est un peu plus
cryptique. Essayez de ne pas oublier le > sauf si vous adorez voir des 
fichiers binaires.</P>

<H3>Localiser la racine et le swap sur la disquette</H3>

<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
NOTE : Ceci n'a rien à voir avec l'installation
       via LILO.
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>
<P>Une fois que le noyau est sur la disquette, il faut d&eacute;finir le 
répertoire racine comme &eacute;tant sur le disque ZIP&nbsp;:</P>
<P><B>==> rdev /dev/fd0 /dev/sda1</B></P>
<P>Je ne suis pas sur que l'option suivante soit n&eacute;cessaire, 
quoiqu'il en soit, je le fais. Pour d&eacute;finir le swap&nbsp;:</P>
<P><B>==> rdev -s /dev/fd0 /dev/sda2</B></P>

<H2><A NAME="s4">4. Installation de la RedHat 4.2</A>Dans l'univers de l'informatique, tout ce qui a plus de 3 mois estconsidéré comme obsolète et nécessite une mise à jour. Comme je n'aurai pas le temps de retoucher ce document à chaque mise à jour, je feraide mon mieux pour le faire à chaque nouvelle version majeure. Commepour les autres distributions, à moins que les auteurs désirent envoyerdes corrections, celà restera en l'état.</H2>

<H2><A NAME="ss4.1">4.1 Ma configuration</A>
</H2>

<P>Pour mon installation, j'ai utilis&eacute;&nbsp;:
<UL>
<LI> noyau 2.0.30</LI>
<LI> Lecteur ZIP Iomega sur port parall&egrave;le</LI>
<LI> RedHat 4.2</LI>
</UL>
</P>

<H2><A NAME="ss4.2">4.2 Installation des paquetages</A>
</H2>

<P>La première fois que j'ai tenté d'installer la Red Hat sur un
disque ZIP, j'ai pensé qu'il aurait été plus simple de juste utiliser
un disque de démarrage (boot disk) de la Red Hat. Je me suis alors
réveillé. Je suis presque arrivé à créer un disque de démarrage, mais
même avec l'aide par e-mail de plusieurs personnes de chez Red Hat,
j'ai commencé à renoncer à tout ce projet lorsque j'ai découvert
l'option --root du rpm.</P>

<H3>Quels paquetages installer?</H3>

<P>J'ai trouv&eacute; quels &eacute;taient les paquetages n&eacute;cessaires en 
compulsant un fichier que j'ai trouv&eacute; sur un miroir RedHat. Ce fichier
peut &ecirc;tre trouv&eacute; sur n'importe quel miroir RedHat dans&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
redhat/redhat4.2/i386/RedHat/base/comps
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Pour cette installation, j'ai voulut inclure le support du réseau, mais,
à cause de la La configuration du réseau sous X de la RedHat, j'ai du configurer
à la main, ou plutot, tenter de configurer, les scripts qui se trouvent dans le
/etc/sysconfig (cf section 4.3.3.).
J'ai décidé de ne pas installer  de paquetage de développement, car le lecteur
ZIP, en tout cas avec un noyau non patché, est plutot lent pour compiler quoi que
ce soit. J'ai aussi choisit de ne pas installer X, surtout pour des raisons d'espace
disque disponible. Plus tard, j'essaierai de monter mon disque dur et de créer un
lien symbolique avec /usr pour voir si j'arrive à faire fonctionner X.</P>
<P>Voici une liste des paquetages que j'ai installés, dans l'ordre de leur
installation. Ceux marqués d'une * ont été mis à jour suit à des errata de RedHat.
Entre parenthèse, j'ai indiqué le numéro du paquet de mise à jour.
<BLOCKQUOTE><CODE>
<PRE>
Par exemple NetKit-B-0.09-6 a été mis à jour par NetKit-B-0.99-8, et
            apparait donc comme: *91) NetKit-B-0.99-6 (-8)
</PRE>
</CODE></BLOCKQUOTE>

<BLOCKQUOTE><CODE>
<HR>
<PRE>
        (Liste créée par la commande rpm --root /iomega -qa)

         1) setup-1.7-2                   2) pamconfig-0.51-2
         3) filesystem-1.3-1              4) MAKEDEV-2.2-9
         5) adduser-1.7-1                 6) libc-5.3.12-18
         7) SysVinit-2.64-8               8) ash-0.2-8
         9) at-2.9b-2                    10) libtermcap-2.0.8-4
        11) bash-1.14.7-1                12) bc-1.03-6
        13) bdflush-1.5-5                14) cpio-2.4.2-4
        15) cracklib-dicts-2.5-1         16) tmpwatch-1.2-1
        17) crontabs-1.5-1              *18) db-1.85-10 (-11)
        19) dev-2.5.1-1                  20) diffutils-2.7-5
        21) etcskel-1.3-1                22) file-3.22-5
        23) fileutils-3.16-1             24) findutils-4.1-11
        25) grep-2.0-5                   26) groff-1.10-8
       *27) ld.so-1.7.14-4 (-5)          28) getty_ps-2.0.7h-4
        29) gzip-1.2.4-7                 30) mingetty-0.9.4-3
       *31) initscripts-2.92-1 (93-1)    32) ed-0.2-5
        33) info-3.9-1                   34) ncurses-1.9.9e-4
        35) libg++-2.7.1.4-5            *36) pwdb-0.54-3 (-4)
        37) rootfiles-1.5-1             *38) pam-0.57-2 (-4)
        39) redhat-release-4.2-1         40) less-321-3
        41) mount-2.5l-2                 42) zlib-1.0.4-1
        43) rpm-2.3.11-1                 44) e2fsprogs-1.10-0
        45) sysklogd-1.3-15              46) tar-1.11.8-11
        47) passwd-0.50-7                48) gawk-3.0.2-1
        49) gdbm-1.7.3-8                 50) gpm-1.10-8
        51) hdparm-3.1-2                 52) kbd-0.91-9
        53) slang-0.99.37-2              54) newt-0.8-1
        55) kbdconfig-1.4-1              56) ncompress-4.2.4-7
       *57) sh-utils-1.16-4 (-5)         58) procinfo-0.9-1
       *59) logrotate-2.3-3 (4-1)        60) lilo-0.19-1
        61) losetup-2.5l-2               62) linuxthreads-0.5-1
       *63) mkinitrd-1.6-1 (7-1)         64) mailcap-1.0-3
       *65) man-1.4h-5 (j-1)             66) mt-st-0.4-2
        67) modules-2.0.0-5              68) mailx-5.5.kw-6
        69) net-tools-1.32.alpha-2       70) procmail-3.10-10
        71) procps-1.01-11               72) psmisc-11-4
        73) quota-1.55-4                 74) readline-2.0-10
        75) sed-2.05-6                   76) setconsole-1.0-1
        77) sendmail-8.8.5-4             78) shadow-utils-960530-6
        79) stat-1.5-5                   80) tcsh-6.06-10
        81) termcap-9.12.6-5             82) textutils-1.22-1
        83) time-1.7-1                   84) timeconfig-1.8-1
        85) util-linux-2.5-38            86) vim-4.5-2
        87) vixie-cron-3.0.1-14          88) which-1.0-5
        89) zoneinfo-96i-4               90) tcp_wrappers-7.5-1
       *91) NetKit-B-0.09-6 (-8)        *92) lpr-0.18-1 (19-1)
       *93) bind-4.9.5p1-2 (9.6-1)      *94) bind-utils-4.9.5p1-2 (9.6-1)
       *95) wu-ftpd-2.4.2b12-6 (b15-1)   96) anonftp-2.3-3
        97) zip-2.1-1                    98) unzip-5.12-5
        99) statserial-1.1-7            100) minicom-1.75-2
       101) lrzsz-0.12.14-1             102) dip-3.3.7o-9
       103) ppp-2.2.0f-3                104) portmap-4.0-3
       105) perl-5.003-8               *106) traceroute-1.0.4.4bsd-2 (1.4a5-1)
      *107) elm-2.4.25-7 (-8)           108) lynx-2.6-2
       109) ncftp-2.3.0-5               110) pine-3.95-2
       111) rdate-0.960923-1            112) apache-1.1.3-3
      *113) nfs-server-2.2beta16-7     *114) nfs-server-clients-2.2beta16-7
            (2.2beta16-8)                    (2.2beta16-8)
</PRE>
<HR>
</CODE></BLOCKQUOTE>

Et avec tout ça, j'ai encore 32Mo de libre!</P>

<H3>Mises à jour; errata</H3>

<P>Comme beaucoup d'utilisateurs de la RedHat (j'espère) le savent, certains
paquetages peuvent présenter des trous de sécurité ou quelque chose d'autre 
qui pose problème. Pour cette raison, RedHat diffuse des mises à jour pour certains
paquetages. J'ai installé ceux que j'ai signalé comme mis à jour ci-dessus.
Veuillez vous référer à la page web RedHat qui concerne les mises à jour sur:
<A HREF="http://www.redhat.com/support/docs/rhl/rh42-errata-general.html">http://www.redhat.com/support/docs/rhl/rh42-errata-general.html</A></P>
<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
   NOTE: avant les mises à jour de paquetages, il faut
         lancer ldconfig comme décrit à la section 3.3.1.1.
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>



<H3>Comment installer les paquetages en utilisant rpm; sans glint</H3>

<P>Avec rpm, utiliser l'option --root pour spécifier le dossier monté comme la racine pour
l'installation. J'ai d&eacute;couvert que plusieurs paquetages ne pouvaient pas
&ecirc;tre install&eacute;s, en raison de scripts de pr&eacute;installation et/ou 
postinstallation qui ne s'ex&eacute;cutaient pas correctement &agrave; cause du
r&eacute;pertoire racine diff&eacute;rent. En cons&eacute;quence, utiliser 
l'option --noscript&nbsp;:</P>
<P><B>==> rpm --root /iomega -i --noscripts PAQUETAGE.i386.rpm</B></P>
<P>Comme, j'en suis sur, beaucoup vont le voir, vous devriez avoir une
erreur du style&nbsp;:
<BLOCKQUOTE><CODE>
<HR>
<PRE>
  failed to open /iomega/var/lib/rpm/packages.rpm

  error: cannot open /iomega/var/lib/rpm/packages.rpm
</PRE>
<HR>
</CODE></BLOCKQUOTE>

Bon, ben, il suffit de créer le répertoire /var/lib/rpm</P>
<P><B> ==> mkdir /iomega/var; mkdir /iomega/var/lib; mkdir /iomega/var/lib/rpm</B></P>

<H3>Lequel est arrivé en premier, pamconfig ou pam?</H3>

<P>Si quelqu'un a déjà essayé d'installer pamconfig, celui-ci se plaint de
dépendre de pam; alors, si l'on essaie d'installer pam, celui-ci se plaint
d'avoir besoin de pamconfig! Ceci étant une nouvelle version de l'histoire
de la poule et de l'oeuf, m'a laissé perplexe quelques temps, mais 
grâce à l'option --nodeps, on peut  forcer l'installation de pamconfig;
en outre, pam a plus de dépendances en échec que pamconfig.</P>
<P><B> ==> rpm --root /iomega -i --nodeps --noscripts pamconfig-0.51-2</B></P>

<H2><A NAME="ss4.3">4.3 Problèmes après l'installation des paquetages</A>
</H2>

<P>Une fois que le dernier paquetage a été parfaitement installé, malheureusement,
le disque n'est pas entièrement fonctionnel, pour ainsi dire. Ce que je veux dire,
c'est que, si vous essayez de démarrer maintenant avec la disquette, vous n'irez
pas très loin. Dès qu'init essaie de démarrer, vous aurez deux adorables
petites erreurs; chacune se plaignant de quelques fichiers qui auraient été là
si les scripts avaient été lancés.</P>

<H3>L'absence de ld.so.cache et libc.so.5</H3>

<P>Si vous essayez de démarrer, vous avez donc deux messages d'erreurs. Le premier
concerne l'absence du fichier /etc/ld/so.cache. Le second râle à propos de
libc.so.5.</P>

<H3>/etc/ld.so.cache</H3>

<P>Comme me l'ont signalé pas mal de lecteurs, mes précédentes  instructions ne
fonctionnaient pas comme prévu. Pour créer ce fichier, il faut lancer
ldconfig lorsque le ZIP est encore monté.</P>
<P><B> ==> chroot /iomega /sbin/ldconfig</B></P>
<P>Merci à Javier Rodriguez pour cette solution.</P>

<H3>libc.so.5</H3>

<P>Pour résoudre le cas de l'absence de cette librairie, il faut créer un
lien symbolique qui aurait du être créé par les scripts d'installation.</P>
<P><B> ==> cd /iomega/lib; ln -s libc.so.5.3.12 libc.so.5</B></P>
<P>Merci à Darcy Boese pour cette solution.</P>

<H3>Configurer le mot de passe de root</H3>

<P>De même qu'il a fallut lancer ldconfig en 4.3.1.1, il faudrait changer, créer
le mot de passe de root pour ce nouveau système&nbsp;:</P>
<P><B> ==> chroot /iomega passwd root</B></P>

<H3>Ce que le programme d'installation a créé</H3>

<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
       NOTE: Ceci est just une configuration rapide, que je n'ai pas 
       été capable de tester pour voir si elle marche. En théorie, elle
       devrait, mais ne venez pas pleurer si
       elle ne fonctionne pas.
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>
<P>En parcourant mon CD Red Hat 4.2, je suis tombé sur quelque-chose de plutôt intéressant;
le code source du programme d'installation. Je l'ai trouvé dans /misc/src/install et
une chose que j'ai trouvé utile a été le fichier net.c. Là-dedans, j'ai trouvé
quels autres fichiers devaient être créés au lancement du programme d'installation.
La plupart participent au support du réseau (d'où le nom net.c) mais, même si
vous n'avez pas de carte réseau, vous pouvez avoir à utiliser le localhost en
réseau (en plus, apache va râler s'il ne peut pas déterminer de hostname). 
Ces fichiers comprennent&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
      /etc/hosts
      /etc/HOSTNAME
      /etc/resolv.conf
      /etc/sysconfig/network
      /etc/sysconfig/network-scripts/ifcfg-eth0
      (ou tout autre périphérique réseau que vous auriez.)
</PRE>
</CODE></BLOCKQUOTE>
</P>
<H3>Configuration du réseau</H3>

<P>Pour rédiger ce document, il m'a fallut le support réseau pour ma carte 
fast-ethernet 3Com 3c595 (qui avait été utilisée ces derniers mois sur
une autre machine).</P>
<P>D'abord, il me fallait un nom, et comme j'entretiens mon propre serveur de noms
(ce qui est une autre et longue histoire), j'ai moi-même donné le nom&nbsp;:
<I>dash-dot.wig.org</I> (J'aime bien comme ça sonne).
Avoir un nom sans adresse IP est un peu vain, donc j'ai utilisé un
numéro réseau réservé hors internet 192.168.10.0, que mon serveur de
nom utilise aussi. Même si le nom de machine est logiquement indiqué
dans /etc/HOSTNAME, Red Hat cherche ce nom dans /etc/sysconfig/network;
alors allons-y&nbsp;:
Extrait de mon /etc/sysconfig/network &nbsp;:
<BLOCKQUOTE><CODE>
<HR>
<PRE>
  NETWORKING=yes
  HOSTNAME=dash-dot
  DOMAINNAME=wig.org
  GATEWAY=
  GATEWAYDEV=eth0
  NS1=192.168.10.7
</PRE>
<HR>
</CODE></BLOCKQUOTE>

Ensuite, simplement, il faut recopier la même information, ici dans /etc/HOSTNAME,
/etc/resolv.conf, et /etc/hosts:</P>
<P><B>/etc/HOSTNAME:</B></P>
<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
dash-dot.wig.org
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>

<P><B>/etc/resolv.conf:</B></P>
<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
search wig.org
nameserver ns.wig.org
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>

<P><B>/etc/hosts:</B></P>
<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
127.0.0.1 localhost
192.168.10.99 dash-dot.wig.org dash-dot
192.168.10.7  ns.wig.org ns
</PRE>
<HR>
</CODE></BLOCKQUOTE>

Red Hat configure tous les periphériques réseau à partir des scripts trouvés dans
/etc/sysconfig/network-scripts. La configuration de chaque périphérique est habituellement
créée une première fois par le programme d'installation, j'ai donc du créer ces fichiers
de config à la main. Ils commencent tous par ifcfg-XXX où XXX est l'interface réseau
qu'ifconfig va activer; par exemple ppp0, eth0, etc. Dans cet exemple, j'ai du
créer un fichier ifcfg-eth0 qui contient ceci&nbsp;:;
<BLOCKQUOTE><CODE>
<HR>
<PRE>
  DEVICE=eth0
  ONBOOT=yes
  BOOTPROTO=none
  BROADCAST=192.168.10.255
  NETWORK=192.168.10.0
  NETMASK=255.255.255.0
  IPADDR=192.168.10.99
</PRE>
<HR>
</CODE></BLOCKQUOTE>

Et pour finir, afin que tout aille bien après ça, tant que l'on est dans
/etc/sysconfig/network-scripts, lancer juste&nbsp;:</P>
<P><B> ==> ./ifup ifcfg-eth0 boot</B></P>
<P>Ceci va lancer le script qui configure l'interface réseau, si cette interface est
configurée pour être lancée au démarrage.</P>
<P>Pour plus d'informations, prière de se reporter au NET-3-HOWTO.</P>


<H2><A NAME="s5">5. Installation pour la Slackware 2.2 </A></H2>

<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
    NOTE : Cette partie n'a pas été mise à jour.
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>
<H2><A NAME="ss5.1">5.1 &Eacute;quipement n&eacute;cessaire</A>
</H2>

<P>
<UL>
<LI> Disque et lecteur ZIP (&eacute;videment)</LI>
<LI> Noyau avec support ZIP</LI>
<LI> ZIP HowTo (recommand&eacute;)</LI>
<LI> Une disquette formatt&eacute;e HD</LI>
<LI> 1 &agrave; 2 heures de votre temps</LI>
</UL>
</P>
<H2><A NAME="ss5.2">5.2 Installation</A>
</H2>

<P>Bon, d'abord, le plus jouissif&nbsp;: d&eacute;terminer quels sont les
fichiers qui sont n&eacute;cessaires pour le disque syst&egrave;me,
et quels sont les paquetages que l'on veut (et que l'on peut)
faire rentrer sur le disque ZIP.</P>
<P>J'ai pens&eacute; que le moyen le plus facile pour d&eacute;marrer
&eacute;tait d'installer directement la Slackware sur le lecteur ZIP.
J'ai pens&eacute; &agrave; cette approche surtout parce que la Slackware
est une distribution plus petite que la RedHat, et qu'il
serait plus facile de supprimer ce que je ne voulais pas. Cela, et
le fait que j'utilise de toute fa&ccedil;on la distribution Slackware
ont rendu ce choix logique.</P>
<P>Installer la Slackware sur un disque ZIP est facile, en tant que root,
lancer le programme setup, et choisir /iomega comme partition d'installation.
Configurer l'installation depuis la partition o&ugrave; se 
trouvent les sources de la Slackware (cdrom, disque dur, etc),
s&eacute;lectionner 'install' et suivre les instructions.</P>

<H2><A NAME="ss5.3">5.3 Qu'y mettre ?</A>
</H2>


<P>La plus grosse difficult&eacute; est de d&eacute;cider ce que
l'on doit ajouter et ce dont on peut se passer. Bien &eacute;videmment,
on a besoin de la s&eacute;rie 'A' (qui fait a peu pr&eacute;s 8 Mo),
le reste d&eacute;pend de chacun.</P>
<P>J'ai essay&eacute; de ramener la Slackware &agrave; une taille
raisonnable de 70 Mo, et cela inclut gcc/g++, perl, X11R6
(MAIS PAS TOUT!), sendmail, de la doc (moins les pages
de man des outils de d&eacute;veloppement, mais avec tous les
howto), et un assortiment d'autres bonnes choses, ce qui 
laisse environ 10 Mo de libre pour les fichiers
utilisateurs. YMMV (note du traducteur&nbsp;: hein???).
C'est selon votre choix.</P>

<H2><A NAME="s6">6. Créer le fichier /etc/fstab (commun aux deux distributions.)</A></H2>

<P>La derni&egrave;re chose que l'on doit faire avant de
red&eacute;marrer est de créer le fichier fstab sur la partition
qui va bientôt devenir root. &Eacute;diter le fichier /iomega/etc/fstab qui devra
au minimum ressembler &agrave; &ccedil;a:
<BLOCKQUOTE><CODE>
<PRE>

       /dev/sda1      /         ext2        defaults   1   1
       /dev/sda2      none      swap        sw
       none           /proc     proc        defaults   1   1
</PRE>
</CODE></BLOCKQUOTE>

Sauver le fichier, et red&eacute;marrer &agrave; partir de
la disquette fra&icirc;chement pr&eacute;par&eacute;e, et amusez-vous bien!</P>
<P>(Un grand merci &agrave; Mike pour m'avoir rappel&eacute;
ce point tr&egrave;s important et m&ecirc;me crucial. - John)</P>

<H2><A NAME="s7">7. Installation avec Debian 1.2</A></H2>

<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
NOTE : l'auteur de cette section me l'a envoyée le 11 juin 1997
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>


<H2><A NAME="ss7.1">7.1 Conditions requises</A>
</H2>


<P>
<UL>
<LI>disque et lecteur ZIP pour port parallèle.</LI>
<LI>2 disquettes 1,44 M vierges</LI>
<LI>un jeu complet de disquettes d'installation Debian (voir la doc
d'installation Debian si vous ne savez pas comment les faire)</LI>
<LI>2 ou 3 heures de libres</LI>
</UL>
</P>

<H2><A NAME="ss7.2">7.2 Vue d'ensemble</A>
</H2>

<P>Après avoir passé quelques heures à me débattre avec <CODE>dpkg</CODE>, j'ai décidé
qu'il serait plus simple de modifier le disque de secours (<EM>rescue disk</EM>)
Debian pour qu'il reconnaisse le lecteur ZIP ppa. Cela s'est avéré être très
facile. Vous pouvez utiliser ce disque modifié pour effectuer l'installation
de base normale du système Debian. Une fois que vous avez installé le
système de base vous pouvez utiliser une disquette de démarrage pour
démarrer le nouveau système de base et compléter l'installation avec
<CODE>dselect</CODE>. Pour utiliser cette technique, il faut construire deux noyaux
- un avec le support ppa et disque mémoire initial, et un autre sans le
support du disque mémoire.</P>

<P>Si vous voulez, vous pouvez sauter toutes les étapes de la section 2 
et laisser la procédure d'installation de Debian formatter le disque 
ZIP pour vous.</P>

<H2><A NAME="ss7.3">7.3 Création du disque de secours modifié</A>
</H2>

<P>Le disque de secours Debian est un disque de démarrage de type SYSLINUX, qui
utilise un formattage DOS et un lanceur (<I>boot loader</I>) spécial pour
empêcher le chargement de MS-DOS. Ce type de disque est très facile à
modifier pour fabriquer vos propres disques de démarrage personnalisés. Le
paquetage Debian ``boot-floppies'' contient un ensemble de scripts pour
automatiser la création de disques de démarrage. Mais c'est tellement simple
que j'ai préféré le faire à la main. C'est s'écarter un peu de la
philosophie Debian, mais je suis au dessus de ça :). De brèves instructions
se trouvent dans le fichier '<CODE>readme.txt</CODE>' de la disquette de
secours.</P>

<H3>Utiliser <CODE>dd</CODE> (ou <CODE>RAWRITE</CODE> sous DOS) pour créer la nouvelledisquette de secours</H3>

<P>Consultez les docs d'installation de Debian si vous ne vous rappelez pas
comment faire.</P>

<H3><A NAME="sec:noyau_zip"></A> Construction d'un noyau avec le support ZIP ppa</H3>

<P>Construisez un nouveau noyau avec le support ZIP ppa (comme à l'étape
3.3.1), mais sélectionnez également les supports
``RAM disk'' et ``initial RAM disk''. Vous devez aussi sélectionner le
support pour les systèmes de fichiers msdos, fat, minix, ext2fs et procfs.</P>

<P>Configurez également les modules que vous voulez avoir dans votre
installation finale sur le disque ZIP.</P>

<P>Une fois la configuration du noyau effectuée, compilez le avec :</P>

<P><B> ==> make dep; make clean</B></P>
<P><I><B> ==> make bzImage</B></I></P>

<P>Compilez les modules avec :</P>
<P><B> ==> make modules</B></P>
<P>Vous les installerez plus tard.</P>
<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
NOTE : soyez bien sur d'utiliser 'make bzImage' et pas 'make zImage'.
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>

<H3>Monter le disque de secours</H3>

<P><B> ==> fdmount fd0</B></P>
<P>ou</P>
<P><B> ==> mount /dev/fd0 /mnt</B></P>
<P>ou</P>
<P><B> ==> que sais-je :)</B></P>

<H3>Copier l'image du noyau</H3>

<P>Copiez l'image du noyau (sur les plateformes i386 c'est le fichier
<CODE>arch/i386/boot/bzImage</CODE>) dans le fichier '<CODE>linux</CODE>' de la
disquette.</P>

<H3>Éditer le script <CODE>`rdev.sh'</CODE></H3>

<P>Ouvrez le script <CODE>`rdev.sh'</CODE> du disque de secours avec votre éditeur
favori. Remplacez la dernière ligne :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
rdev /mnt/linux /dev/ram0
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>par</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
rdev /mnt/linux /dev/sda1
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Il faudra aussi remplacer toutes les occurrences de <CODE>/mnt/linux</CODE> par
le chemin approprié. Comme je monte mes disquettes sous <CODE>/fd0</CODE>, j'ai
dû changer <CODE>/mnt/linux</CODE> en <CODE>/fd0/linux</CODE>.</P>

<H3>Lancer le script <CODE>`rdev.sh'</CODE> modifié</H3>

<P><B> ==> ./rdev.sh</B></P>

<H2><A NAME="ss7.4">7.4 Installer le système de base sur le disque ZIP</A>
</H2>

<P>Démarrez à partir du disque de secours. Si tout se passe bien vous retrouverez
le processus d'installation à base de menu de la Debian, sauf qu'il sait
maintenant que votre disque ZIP ppa existe. Effectuez l'installation
normalement, comme s'il s'agissait d'un disque dur, mais montez
<CODE>/dev/sda1</CODE> comme racine et choisissez <CODE>/dev/sda2</CODE> comme swap.</P>

<P>Il y a une différence par rapport au processus d'installation standard --
n'installez pas et ne configurez pas de modules chargeables. Vous installerez les
modules que vous avez compilés à l'étape 7.3.2 plus tard.</P>


<H2><A NAME="ss7.5">7.5 Création de la disquette de démarrage</A>
</H2>

<P>Vous pouvez créer la disquette de démarrage comme décrit aux étapes 3.3.1 
à 3.3.2,
ou, si vous préférez, utiliser simplement l'option ``Create Boot Disk''
pendant l'installation Debian. J'aime bien la seconde possibilité car elle
me permet d'avoir une autre disquette de démarrage SYSLINUX dans laquelle je
peux modifier le message de bienvenue pour décrire la nature de ce disque de
démarrage personnalisé et ajouter des paramètres noyau. Vous pouvez même
inclure des fichiers d'aide accessibles depuis les touches de
fonctions. Vous pouvez également recompiler le noyau et modifier à la main
la disquette pour enlever le support RAM disk. À vous de voir.</P>

<H2><A NAME="ss7.6">7.6 Redémarrer le système</A>
</H2>

<P>Insérez votre disquette de démarrage et choisissez l'option ``Reboot'' du
menu d'installation.</P>

<H2><A NAME="ss7.7">7.7 Configuration du système de base et poursuite de l'installation</A>
</H2>

<P>Quand le système redémarre vous avez une installation de base Debian tout à
fait utilisable (mais lente) depuis votre disque ZIP ppa. Continuez
l'installation normalement. j'ai installé tous les utilitaires UNIX
classiques, avec les documentations, make, gcc, les bibliothèques
(<I>libraries</I>), et divers utilitaires de manipulation de fichiers. Le
résultat est un système de démarrage de secours très puissant que je peux
utiliser pour ``secourir'' :-) n'importe lequel des systèmes de mon
département qui aurait un gros problème.</P>
<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
NOTE : vous devrez au moins installer ``make'' pour réaliser l'étape suivante.
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="ss7.8">7.8 Installation des modules que vous avez construits en </A>
<A HREF="#sec:noyau_zip">Construction d'un noyau avec le support ZIP ppa</A></H2>

<P>Si vous avez installé <CODE>make</CODE> à l'étape précédente, vous devriez pouvoir
monter la partition du disque dur qui contient votre noyau, aller dans le
répertoire approprié et lancer <CODE>make modules_install</CODE>. Par exemple :</P>
<P><B> ==> mount /dev/hda2 /mnt </B></P>
<P><B> ==> cd /mnt/usr/src/linux </B></P>
<P><B> ==> make modules_install </B></P>
<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
NOTE : vous n'aurez pas à modifier le fichier /etc/fstab, comme expliqué à
l'étape 5. Le processus d'installation Debian s'en est déjà occupé.
</PRE>
<HR>
</CODE></BLOCKQUOTE>
</P>
<H2><A NAME="s8">8. Épilogue</A></H2>

<P>Yahou, et snif. Après avoir entassé 31 disques ZIP et un pack de batteries
pour ZIP autonome, mon aventure suivante est de faire fonctionner le pcmcia
sur mon transportable (NdT&nbsp;: Il faut bien que je m'amuse aussi).</P>

</BODY>
</HTML>
