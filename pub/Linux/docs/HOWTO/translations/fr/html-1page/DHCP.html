<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.21">
 <TITLE>mini-HOWTO DHCP (DHCPd/DHCPcd)</TITLE>
</HEAD>
<BODY>
<H1>mini-HOWTO DHCP (DHCPd/DHCPcd)</H1>

<H2>Vladimir Vuksan <CODE>&lt;vuksan@veus.hr&gt;</CODE><BR>
Traduction française par Arnaud Gomes-do-Vale <CODE>&lt;arnaud@carrosse.frmug.org&gt;</CODE></H2>v4.12, 22 octobre 2000
<HR>
<EM>Ce document a pour but de r&eacute;pondre &agrave; des questions de base sur la
configuration de votre machine Linux comme serveur ou client DHCP.</EM>
<HR>
<H2><A NAME="s1">1. Introduction</A></H2>



<H2><A NAME="ss1.1">1.1 Avertissements</A>
</H2>

<P>Nous d&eacute;clinons toute responsabilit&eacute; quant au contenu de ce
document. L'utilisation des concepts, des exemples ou de tout autre contenu se
fait enti&egrave;rement &agrave; vos propres risques. Dans la mesure o&ugrave; il s'agit d'une
nouvelle &eacute;dition de ce document, il peut comporter des erreurs ou des
impr&eacute;cisions susceptibles d'endommager votre syst&egrave;me. Bien que ce soit tr&egrave;s
improbable, je n'en prends pas la responsabilit&eacute;.</P>
<P>De plus, gardez &agrave; l'esprit que les informations contenues dans ce document ne
sont <EM>PAS</EM> officielles. La majeure partie du contenu de ce document est
constitu&eacute;e de suppositions, qui se trouvent donner l'effet pr&eacute;vu pour
certaines personnes. Vous utilisez cette information &agrave; vos risques et p&eacute;rils.</P>

<H2><A NAME="ss1.2">1.2 Nouvelles versions de ce document</A>
</H2>

<P>Les nouvelles versions de ce document 
<BLOCKQUOTE>NdT&nbsp;: il s'agit ici de la
version originale en anglais</BLOCKQUOTE>
 sont disponibles sur&nbsp;:
<A HREF="http://www.oswg.org/oswg-nightly/DHCP.html">http://www.oswg.org/oswg-nightly/DHCP.html</A></P>
<P>Les versions traduites suivantes sont disponibles&nbsp;:</P>
<P>
<UL>
<LI> Chinois - 
<A HREF="http://www.linux.org.tw/CLDP/mini/DHCP.html">http://www.linux.org.tw/CLDP/mini/DHCP.html</A></LI>
<LI> Japonais - 
<A HREF="http://www.linux.or.jp/JF/JFdocs/DHCP.html">http://www.linux.or.jp/JF/JFdocs/DHCP.html</A></LI>
<LI> Espagnol - 
<A HREF="ftp://cuates.pue.upaep.mx/pub/linux/LuCAS/CHDP-mini-Como/">ftp://cuates.pue.upaep.mx/pub/linux/LuCAS/CHDP-mini-Como/</A></LI>
</UL>
</P>
<P>La version fran&ccedil;aise se trouve avec les autres HOWTO&nbsp;: 
<A HREF="http://www.freenix.org/linux/HOWTO/">http://www.freenix.org/linux/HOWTO/</A>.</P>
<P>Vous &ecirc;tes explicitement autoris&eacute;s &agrave; traduire ce document dans votre langue. Je
vous demande simplement de mettre un lien vers la version originale et de me
donner l'adresse URL de votre traduction pour que je puisse moi-m&ecirc;me mettre un
lien.</P>

<H2><A NAME="ss1.3">1.3 Retours</A>
</H2>

<P>Les retours concernant ce document seront vivement appr&eacute;ci&eacute;s. Sans vos
propositions, ce document n'existerait pas. Envoyez donc vos ajouts,
commentaires et critiques &agrave; 
<A HREF="mailto:vuksan-feedback@veus.hr">vuskan-feedback@veus.hr</A>.</P>
<P>Adressez vos commentaires concernant la version fran&ccedil;aise &agrave; 
<A HREF="mailto:arnaud@carrosse.frmug.org">mailto:arnaud@carrosse.frmug.org</A>.</P>

<H2><A NAME="ss1.4">1.4 Contributeurs</A>
</H2>

<P>Ce document est une version modifi&eacute;e de la version d'origine de Paul Makeev.</P>
<P>Les personnes suivantes ont contribu&eacute; &agrave; ce mini-HOWTO.
<UL>
<LI>Heiko Schlittermann</LI>
<LI>Jonathan Smith</LI>
<LI>Dan Khabaza</LI>
<LI>Hal Sadofsky</LI>
<LI>Henrik Stoerner</LI>
<LI>Paul Rossington</LI>
<LI>et de nombreux autres</LI>
</UL>
</P>

<H2><A NAME="ss1.5">1.5 Copyright</A>
</H2>

<P>Ce HOWTO est &copy; Vladimir Vuksan, 1998 et peut &ecirc;tre distribu&eacute; selon les termes
de la licence OpenContent (OPL)
<A HREF="http://www.opencontent.org/opl.shtml">http://www.opencontent.org/opl.shtml</A></P>


<H2><A NAME="s2">2. Le protocole DHCP</A></H2>

<P>DHCP est le protocole de configuration dynamique d'h&ocirc;tes (Dynamic Host
Configuration Protocol). Il est utilis&eacute; pour contr&ocirc;ler certains param&egrave;tres
importants de la configuration r&eacute;seau des h&ocirc;tes (faisant tourner un client) au
moyen d'un serveur. DHCP maintient une compatibilit&eacute; ascendante avec
BOOTP. Pour plus d'informations, voyez entre autres la RFC 2131 (anciennement
la RFC 1541). Reportez-vous &agrave; la section <I>Autres documents int&eacute;ressants</I> &agrave; la fin du document. Vous pouvez aussi lire 
<A HREF="http://web.syr.edu/~jmwobus/comfaqs/dhcp.faq.html">la FAQ DHCP</A>.</P>
<P>Ce mini-HOWTO d&eacute;crit aussi bien l'utilisation du d&eacute;mon <EM>serveur</EM> DHCP que
celle du d&eacute;mon <EM>client</EM> DHCP. La plupart des gens utilise le d&eacute;mon
client, qui est utilis&eacute; par des stations pour obtenir des informations sur
leur configuration r&eacute;seau depuis un serveur distant. Le d&eacute;mon serveur est
utilis&eacute; par les administrateurs r&eacute;seau pour distribuer ces informations aux
clients ; donc si vous &ecirc;tes juste un utilisateur, vous avez besoin du d&eacute;mon
<EM>client</EM>.</P>

<H2><A NAME="s3">3. Configuration des clients</A></H2>

<P>&Agrave; l'heure actuelle, il existe trois clients DHCP diff&eacute;rents pour Linux&nbsp;:
<CODE>dhcpcd</CODE>, <CODE>pump</CODE> et <CODE>dhclient</CODE>. Ce mini-HOWTO traite principalement
de <CODE>dhcpcd</CODE>.</P>

<H2><A NAME="ss3.1">3.1 T&eacute;l&eacute;chargement du d&eacute;mon client (<CODE>dhcpcd</CODE>)</A>
</H2>

<P>En fonction de votre distribution, vous pouvez avoir besoin de t&eacute;l&eacute;charger le
d&eacute;mon client DHCP. Si vous voulez le compiler &agrave; partir des sources, vous avez
besoin du paquetage <CODE>dhcpcd</CODE>, dont la derni&egrave;re version est la 1.3.18. Il
est maintenu par Sergei Viznyuk <CODE>sergei@phystech.com</CODE> et est aujourd'hui
livr&eacute; sous forme de binaire avec la plupart des distributions.</P>
<P>Les sources de <CODE>dhcpcd</CODE> peuvent &ecirc;tre t&eacute;l&eacute;charg&eacute;es depuis&nbsp;:</P>
<P>
<UL>
<LI>
<A HREF="ftp://ftp.phystech.com/pub/">ftp://ftp.phystech.com/pub/</A> (site principal)</LI>
<LI>
<A HREF="http://www.cps.msu.edu/~dunham/out/">http://www.cps.msu.edu/~dunham/out/</A></LI>
</UL>
</P>
<P>Ensuite, suivez les instructions ci-dessous. Elles devraient rester identiques.</P>

<H2><A NAME="slackware"></A> <A NAME="ss3.2">3.2 Slackware </A>
</H2>

<P>Vous pouvez t&eacute;l&eacute;charger la derni&egrave;re version de <CODE>dhcpcd</CODE> depuis n'importe
quel miroir de Metalab ou depuis l'un des sites suivants&nbsp;:
<UL>
<LI>
<A HREF="ftp://metalab.unc.edu/pub/Linux/system/network/daemons">ftp://metalab.unc.edu/pub/Linux/system/network/daemons</A></LI>
<LI>
<A HREF="ftp://ftp.phystech.com/pub/">ftp://ftp.phystech.com/pub/</A> (site principal)</LI>
</UL>
</P>
<P>T&eacute;l&eacute;chargez la derni&egrave;re version de <CODE>dhcpcd.tar.gz</CODE>.
<UL>
<LI> D&eacute;compactez la&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
tar -zxvf dhcpcd-1.3.18pl1.tar.gz
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI> Allez dans le nouveau r&eacute;pertoire et compilez <CODE>dhcpcd</CODE>
<BLOCKQUOTE><CODE>
<PRE>
cd dhcpcd-1.3.18pl1
make
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI> Installez le (vous devez &ecirc;tre root pour lancer la commande suivante)
<BLOCKQUOTE><CODE>
<PRE>
make install
</PRE>
</CODE></BLOCKQUOTE>
</LI>
</UL>
</P>
<P>Cela va cr&eacute;er un r&eacute;pertoire <CODE>/etc/dhcpc</CODE> o&ugrave; <CODE>dhcpcd</CODE> va stocker des
informations pour DHCP, et le fichier <CODE>dhcpcd</CODE> va &ecirc;tre copi&eacute; dans
<CODE>/usr/sbin</CODE>.</P>
<P>Pour que le syst&egrave;me initialise DHCP au d&eacute;marrage, tapez&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
cd /etc/rc.d
mv rc.inet1 rc.inet1.OLD
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Cela va renommer l'ancien script d'initalisation du r&eacute;seau en
<CODE>rc.inet1.OLD</CODE>. Maintenant, il vous faut cr&eacute;er un nouveau script
<CODE>rc.inet1</CODE>. Voici tout ce dont vous avez besoin&nbsp;:
<HR>
<PRE>
#!/bin/sh
#
# rc.inet1      This shell script boots up the base INET system.

HOSTNAME=`cat /etc/HOSTNAME` #This is probably not necessary but I
                             #will leave it in anyways

# Attach the loopback device.
/sbin/ifconfig lo 127.0.0.1
/sbin/route add -net 127.0.0.0 netmask 255.0.0.0 lo

# IF YOU HAVE AN ETHERNET CONNECTION, use these lines below to configure the
# eth0 interface. If you're only using loopback or SLIP, don't include the
# rest of the lines in this file.

/usr/sbin/dhcpcd
</PRE>
<HR>
</P>
<P>Sauvegardez le et red&eacute;marrez votre ordinateur.</P>
<P>Quand vous aurez termin&eacute;, allez &agrave; la section 
<A HREF="#nameserver">La touche finale</A>.</P>

<H2><A NAME="redhat6"></A> <A NAME="ss3.3">3.3 Red Hat 6.x et Mandrake 6.x </A>
</H2>

<P>La configuration de dhcpcd avec une Red Hat 6.0 ou plus r&eacute;cente est vraiment
facile. Vous devez simplement lancer le panneau de contr&ocirc;le en tapant&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
control-panel
</PRE>
</CODE></BLOCKQUOTE>

puis
<UL>
<LI> S&eacute;lectionnez <B>Network Configuration</B></LI>
<LI> Cliquez sur <B>Interfaces</B></LI>
<LI> Cliquez sur <B>Add</B></LI>
<LI> S&eacute;lectionnez <B>Ethernet</B></LI>
<LI> Dans la fen&ecirc;tre <B>Edit Ethernet/Bus Interface</B>, s&eacute;lectionnez
<B>Activate interface at boot time</B> et choisissez <B>DHCP</B>
comme <B>Interface configuration protocol</B>.</LI>
</UL>
</P>

<P>Notez que dans la Red Hat 6.x, le client DHCP par d&eacute;faut est un programme
nomm&eacute; <CODE>pump</CODE> qui remplace le <CODE>dhcpcd</CODE> mentionn&eacute; ci-dessus. Un paquetage
<CODE>dhcpcd</CODE> se trouve sur le CD-ROM, donc si vous ne vous en tirez pas avec
<CODE>pump</CODE>, vous pouvez toujours essayer avec <CODE>dhcpcd</CODE>. Une fois <CODE>dhcpcd</CODE>
install&eacute; (par exemple par <CODE>rpm -i dhcpcd-1.3.17pl2-1.i386.rpm</CODE>), vous allez
devoir faire quelques modification (voir 
<A HREF="#linuxppc-rh6">ici</A>).</P>
<P>Quelques notes suppl&eacute;mentaires d'Alexander Stevenson 
<A HREF="mailto:alexander.stevenson@home.com">alexander.stevenson@home.com</A>&nbsp;:</P>
<P>Je n'ai pas r&eacute;ussi &agrave; utiliser DHCPcd. Finalement, c'est <CODE>pump</CODE>, inclus dans
la Mandrake 6.0 (et je suppose donc dans la Red Hat) qui a bien voulu
fonctionner. J'ai utilis&eacute; la commande suivante&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
pump -i eth0 -h h&ocirc;te
</PRE>
</CODE></BLOCKQUOTE>

Le nom d'h&ocirc;te est sans importance, mais sans lui, le serveur ne r&eacute;pond pas.</P>
<P>J'ai alors chang&eacute; la ligne correspondante de mon script <CODE>/sbin/ifup</CODE> pour
y int&eacute;grer cette modification; la version par d&eacute;faut n'inclut pas l'option
<CODE>-h</CODE> et ne fonctionne donc pas chez moi.</P>
<P>En r&eacute;sum&eacute;, si vous utilisez Linuxconf, et si &ccedil;a ne fonctionne pas apr&egrave;s avoir
choisi l'option "DHCP" pour votre interface, essayez d'ajouter "<CODE>-h h&ocirc;te</CODE>"
&agrave; l'invocation de <CODE>pump</CODE> dans le script <CODE>/sbin/ifup</CODE>. Mon script
ressemble maintenant &agrave; &ccedil;a&nbsp;:
<HR>
<PRE>
...
if [ -n "$PUMP" ]; then
    echo -n "Determining IP information for $DEVICE..."
    if /sbin/pump -i $DEVICE -h hostname; then
        echo " done."
    else
        echo " failed."
        exit 1
    fi
else ...
</PRE>
<HR>
</P>
<P>Une fa&ccedil;on plus &eacute;l&eacute;gante d'ajouter le nom d'h&ocirc;te est indiqu&eacute;e par Aad van der 
Klaauw&nbsp;:</P>
<P>Je configure en ce moment une passerelle sur mon r&eacute;seau personnel. J'ai eu
besoin d'indiquer l'adresse MAC et d'utiliser l'option "-h h&ocirc;te". J'ai
d&eacute;cid&eacute; de <EM>ne pas</EM> changer le script, mais plut&ocirc;t d'utiliser le fichier
de configuration. Dans <CODE>/etc/sysconfig/network-scripts/ifcfg-eth0</CODE> j'ai
rajout&eacute; ce qui suit&nbsp;:
<HR>
<PRE>
DEVICE="eth0"
MACADDR="00:11:22:33:44:55"
DHCP_HOSTNAME="trigger_for_terayon"
</PRE>
<HR>

&Ccedil;a survit aux mises &agrave; jour, et &agrave; mon avis c'est plus propre.</P>
<P>C'est tout. Il suffit maintenant de red&eacute;marrer votre machine ou de taper
<BLOCKQUOTE><CODE>
<PRE>
/sbin/ifup eth0
</PRE>
</CODE></BLOCKQUOTE>

sur la ligne de commande.</P>

<H2><A NAME="ss3.4">3.4 Red Hat 5.x</A>
</H2>

<P>La configuration de dhcpcd avec une Red Hat 5.0 ou plus r&eacute;cente est vraiment
facile. Vous devez simplement lancer le panneau de contr&ocirc;le en tapant&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
control-panel
</PRE>
</CODE></BLOCKQUOTE>

puis
<UL>
<LI> S&eacute;lectionnez <B>Network Configuration</B></LI>
<LI> Cliquez sur <B>Interfaces</B></LI>
<LI> Cliquez sur <B>Add</B></LI>
<LI> S&eacute;lectionnez <B>Ethernet</B></LI>
<LI> Dans la fen&ecirc;tre <B>Edit Ethernet/Bus Interface</B>, s&eacute;lectionnez
<B>Activate interface at boot time</B> et choisissez <B>DHCP</B>
comme <B>Interface configuration protocol</B>.</LI>
</UL>
</P>
<P>Quand vous aurez termin&eacute;, allez &agrave; la section 
<A HREF="#nameserver">La touche finale</A>.</P>

<H2><A NAME="ss3.5">3.5 Red Hat 4.x et Caldera OpenLinux 1.1/1.2</A>
</H2>

<P><CODE>dhcpcd</CODE> est inclus dans la distribution standard de Red Hat sous la forme
d'un paquetage RPM. Vous pouvez le trouver dans le r&eacute;pertoire RPMS de votre
CD-ROM ou le t&eacute;l&eacute;charger depuis 
<A HREF="ftp://ftp.redhat.com/pub/redhat/redhat-4.2/i386/RedHat/RPMS/dhcpcd-0.6-2.i386.rpm">ftp://ftp.redhat.com/pub/redhat/redhat-4.2/i386/RedHat/RPMS/dhcpcd-0.6-2.i386.rpm</A>
et l'installer avec&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
rpm -i dhcpcd-0.6-2.i386.rpm
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Vous pouvez &eacute;galement compiler votre propre version en suivant les
instructions donn&eacute;es pour la Slackvare (
<A HREF="#slackware">voir ici</A>).</P>
<P>Ces informations m'ont &eacute;t&eacute; communiqu&eacute;es par 
<A HREF="nothing@cc.gatech.edu">nothing@cc.gatech.edu</A>&nbsp;:</P>
<P>
<HR>
<PRE>
J'ai enlev&eacute; mon IP fixe et mon nom d'h&ocirc;te de /etc/resolv.conf. Par contre, j'y
ai laiss&eacute; la ligne "search ..." et les lignes de mes deux serveurs de noms
(pour je ne sais quelle raison mon dhcpcd ne cr&eacute;e jamais de /etc/dhcpc/resolv.conf,
et je dois utiliser un /etc/resolv.conf statique).

Dans /etc/sysconfig/network, j'ai enlev&eacute; les entr&eacute;es HOSTNAME et GATEWAY. J'ai
laiss&eacute; les autres entr&eacute;es (NETWORKING, DOMAINNAME, GATEWAYDEV) telles quelles.

Dans /etc/sysconfig/network-scripts/ifcfg-eth0, j'ai enlev&eacute; les entr&eacute;es
IPADDR, NETMASK, NETWORK et BROADCAST. Je n'ai pas touch&eacute; &agrave; DEVICE et
ONBOOT. J'ai chang&eacute; la ligne BOOTPROTO en BOOTPROTO=dhcp.

Sauvegardez le fichier et red&eacute;marrez votre machine.
</PRE>
<HR>
</P>
<P>Quand vous aurez termin&eacute;, allez &agrave; la section 
<A HREF="#nameserver">La touche finale</A>.</P>

<H2><A NAME="ss3.6">3.6 Debian</A>
</H2>

<P>Il existe un paquet Debian de DHCPcd (assurez-vous que son nom commence bien
par dhcpcd) &agrave; l'adresse 
<A HREF="ftp://ftp.debian.org/debian/dists/slink/main/binary-i386/net/">ftp://ftp.debian.org/debian/dists/slink/main/binary-i386/net/</A>.</P>
<P>Vous pouvez aussi suivre les instructions d'installation sur Slackware. Pour
d&eacute;compacter le paquetage deb, tapez&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
dpkg -i /l/endroit/ou/vous/mettez/vos/paquetages/deb/dhcpcd*deb
</PRE>
</CODE></BLOCKQUOTE>

Il semble que vous n'ayez rien &agrave; configurer. D'apr&egrave;s 
<A HREF="mailto:heiko@os.inf.tu-dresden.de">Heiko Schlittermann</A>&nbsp;:</P>
<P>Comme les autres paquets Debian, le paquet dhcpcd installe son script
d'initialisation en <CODE>/etc/init.d/<I>&lt;nom_du_paquetage&gt;</I></CODE>, ici
<CODE>/etc/init.d/dhcpcd</CODE>, et cr&eacute;e des liens vers ce script dans les
r&eacute;pertoires <CODE>/etc/rc?.d/</CODE>.</P>
<P>Le contenu des r&eacute;pertoires <CODE>/etc/rc?.d/</CODE> est ensuite &eacute;x&eacute;cut&eacute;
automatiquement &agrave; l'initialisation du syst&egrave;me.</P>
<P>Si vous ne red&eacute;marrez pas votre syst&egrave;me apr&egrave;s l'installation, vous devriez
d&eacute;marrer le d&eacute;mon manuellement&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
/etc/init.d/dhcpcd start
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Quand vous aurez termin&eacute;, allez &agrave; la section 
<A HREF="#nameserver">La touche finale</A>.</P>

<H2><A NAME="ss3.7">3.7 LinuxPPC et MkLinux</A>
</H2>

<P>La section suivante a &eacute;t&eacute; &eacute;crite par R. Shapiro.</P>
<P>Depuis la version "1999" (R5), LinuxPPC est pratiquement compatible avec la
Red Hat 6, &agrave; l'exception du probl&egrave;me d&eacute;crit ci-dessous. En r&egrave;gle g&eacute;n&eacute;rale, le
mode d'emploi est le m&ecirc;me que pour la version actuelle des 
<A HREF="#redhat6">Red Hat 6.x et Mandrake 6.x</A></P>
<P>Le probl&egrave;me est que par d&eacute;faut, la Red Hat 6.x utilise le client DHCP
<CODE>pump</CODE>, qui ne fonctionne pas correctement sous LinuxPPC.
<A NAME="linuxppc-rh6"></A> 
Pour contourner ce probl&egrave;me, vous devez installer la derni&egrave;re version du
<CODE>dhcpcd</CODE> de Sergei Viznyuk et &eacute;diter <CODE>/sbin/ifup</CODE> pour lui faire
utiliser <CODE>dhcpcd</CODE> &agrave; la place de <CODE>pump</CODE>. Remplacez
<HR>
<PRE>
if [ "$BOOTPROTO" = bootp -o "$BOOTPROTO" = dhcp ]; then
     PUMP=true
 fi

 if [ -n "$PUMP" ]; then
</PRE>
<HR>

par
<HR>
<PRE>
if [  "$BOOTPROTO" = bootp ]; then
       echo " done."
     else
       echo " failed."
       exit 1
     fi
 elif [ "$BOOTPROTO" = dhcp ]; then
     echo -n "Determining IP information for $DEVICE..."
     if /sbin/dhcpcd -d $DEVICE ; then
       if [ -f /etc/dhcpc/dhcpcd-${DEVICE}.exe ]; then
           /etc/dhcpc/dhcpcd-${DEVICE}.exe
       fi
</PRE>
<HR>
</P>
<P>et faites le changement correspondant dans <CODE>/sbin/ifdown</CODE>&nbsp;: remplacez
<HR>
<PRE>
if [ "$BOOTPROTO" = bootp -o "$BOOTPROTO" = dhcp ]; then
....
fi
</PRE>
<HR>

par
<HR>
<PRE>
if [ "$BOOTPROTO" = bootp ]; then
fi

if [ "$BOOTPROTO" = dhcp ]; then
      if [ -f /var/run/dhcpcd-${DEVICE}.pid ]; then
              kill `cat /var/run/dhcpcd-${DEVICE}.pid`
              rm -f /var/run/dhcpcd-${DEVICE}.pid
      fi
fi
</PRE>
<HR>
</P>
<P>Une version RPM pour PPC de <CODE>dhcpcd</CODE> se trouve sur le CD de LinuxPPC 1999;
une version l&eacute;g&egrave;rement plus r&eacute;cente se trouve dans le r&eacute;pertoire contrib sur
<A HREF="ftp://ftp.linuxppc.org/">ftp://ftp.linuxppc.org/</A>. Les sources, qui compilent telles quelles
sur LinuxPPC 1999, sont disponibles &agrave; 
<A HREF="ftp://ftp.phystech.com/pub/dhcpcd-1.3.17-pl9.tar.gz">ftp://ftp.phystech.com/pub/dhcpcd-1.3.17-pl9.tar.gz</A>.</P>


<H2><A NAME="nameserver"></A> <A NAME="ss3.8">3.8 La touche finale</A>
</H2>

<P>Apr&egrave;s la r&eacute;initialisation de votre machine, votre interface r&eacute;seau devrait
&ecirc;tre configur&eacute;e. Tapez&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
ifconfig
</PRE>
</CODE></BLOCKQUOTE>

Vus devriez obtenir quelque chose comme &ccedil;a&nbsp;:
<HR>
<PRE>
lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Bcast:127.255.255.255  Mask:255.0.0.0
          UP BROADCAST LOOPBACK RUNNING  MTU:3584  Metric:1
          RX packets:302 errors:0 dropped:0 overruns:0 frame:0
          TX packets:302 errors:0 dropped:0 overruns:0 carrier:0 coll:0

eth0      Link encap:Ethernet  HWaddr 00:20:AF:EE:05:45
          inet addr:24.128.53.102  Bcast:24.128.53.255  Mask:255.255.254.0
          ^^^^^^^^^^^^^^^^^^^^^^^
          UP BROADCAST NOTRAILERS RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:24783 errors:1 dropped:1 overruns:0 frame:1
          TX packets:11598 errors:0 dropped:0 overruns:0 carrier:0 coll:96
          Interrupt:10 Base address:0x300 
</PRE>
<HR>

Si vous avez un nombre &agrave; l'air normal dans "inet addr", c'est bon. Si vous
voyez 0.0.0.0, ne d&eacute;sesp&eacute;rez pas, c'est un r&eacute;sultat temporaire, en attendant
que <CODE>dhcpcd</CODE> obtienne l'adresse IP. Si au bout de quelques minutes, vous
voyez toujours 0.0.0.0, consultez la sections 
<A HREF="#troubleshooting">probl&egrave;mes</A>. <CODE>dhcpcd</CODE> est un d&eacute;mon qui continuera &agrave; tourner tant que
votre machine restera allum&eacute;e. Toutes les trois heures, il contactera le
serveur DHCP pour renouveler l'attribution de l'adresse IP. Il consignera tous les
messages dans le journal du syst&egrave;me (<CODE>/var/adm/syslog/</CODE> sur Slackware,
<CODE>/var/log/syslog/</CODE> sur Red Hat ou OpenLinux).</P>
<P>Une derni&egrave;re chose&nbsp;: vous devez pr&eacute;ciser vos serveurs de noms. Il existe deux
fa&ccedil;ons de le faire. Vous pouvez demander les adresses de ses serveurs de noms
&agrave; votre fournisseur d'acc&egrave;s et les mettre dans <CODE>/etc/resolv.conf</CODE>. Vous
pouvez aussi laisser <CODE>dhcpcd</CODE> obtenir la liste des serveurs de noms depuis
le serveur DHCP et le laisser cr&eacute;er un <CODE>resolv.conf</CODE> adapt&eacute; dans
<CODE>/etc/dhcpc/</CODE>. Pour ma part, j'ai d&eacute;cid&eacute; de laisser faire
<CODE>dhcpcd</CODE>. Pour cela&nbsp;:
<UL>
<LI> Sauvegardez votre ancien <CODE>/etc/resolv.conf</CODE>
<BLOCKQUOTE><CODE>
<PRE>
mv /etc/resolv.conf /etc/resolv.conf.OLD
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI> Si le r&eacute;pertoire <CODE>/etc/dhcpc/</CODE> n'existe pas, cr&eacute;ez le
<BLOCKQUOTE><CODE>
<PRE>
mkdir /etc/dhcpc
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI> Faites un lien de <CODE>/etc/dhcpc/resolv.conf</CODE> vers
<CODE>/etc/resolv.conf</CODE>
<BLOCKQUOTE><CODE>
<PRE>
ln -s /etc/dhcpc/resolv.conf /etc/resolv.conf
</PRE>
</CODE></BLOCKQUOTE>
</LI>
</UL>

Si &ccedil;a ne fonctionne pas, essayez ceci (r&eacute;paration sugg&eacute;r&eacute;e par
<CODE>nothing@cc.gatech.edu</CODE>, avec quelques modifications de Henrik Stoerner)&nbsp;:</P>
<P>
<A NAME="error3"></A> 
J'ai du proc&eacute;der &agrave; ce changement car mon dhcpcd ne cr&eacute;e pas de fichier
<CODE>/etc/dhcpc/resolv.conf</CODE>. Dans
<CODE>/etc/sysconfig/network-scripts/ifup</CODE>, j'ai effectu&eacute; le changement
suivant, qui n'est qu'une malheureuse bidouille, mais qui marche chez moi&nbsp;:
j'ai chang&eacute;
<HR>
<PRE>
elif [ "$BOOTPROTO" = dhcp -a "$ISALIAS" = no ]; then
    echo -n "Using DHCP for ${DEVICE}... "
    /sbin/dhcpcd -c /etc/sysconfig/network-scripts/ifdhcpc-done ${DEVICE}
    echo "echo \$$ > /var/run/dhcp-wait-${DEVICE}.pid; exec sleep 30" | sh

    if [ -f /var/run/dhcp-wait-${DEVICE}.pid ]; then
        ^^^^
        echo "failed."
        exit 1
</PRE>
<HR>

en&nbsp;:
<HR>
<PRE>
elif [ "$BOOTPROTO" = dhcp -a "$ISALIAS" = no ]; then
    echo -n "Using DHCP for ${DEVICE}... "
    /sbin/dhcpcd
    echo "echo \$$ > /var/run/dhcp-wait-${DEVICE}.pid; exec sleep 30" | sh

    if [ ! -f /var/run/dhcp-wait-${DEVICE}.pid ]; then
        ^^^^^^
       echo "failed."
       exit 1
</PRE>
<HR>

Remarquez le point d'exclamation dans <CODE>if [ ! -f
/var/run/dhcp-wait-${DEVICE}.pid ];</CODE>.</P>
<P>Maintenant, admirez le r&eacute;sultat! :-)</P>

<H2><A NAME="ss3.9">3.9 Notes diverses</A>
</H2>

<P>Ce qui suit n'est pas &agrave; proprement parler n&eacute;cessaire, mais peut &ecirc;tre utile &agrave;
certaines personnes.</P>
<P>Si vous n'avez besoin de votre connexion qu'occasionnellement, vous pouvez
d&eacute;marrer <CODE>dhcpcd</CODE> depuis la ligne de commandes (&agrave; condition d'&ecirc;tre root) en
tapant&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
/usr/sbin/dhcpcd
</PRE>
</CODE></BLOCKQUOTE>

Quand vous voulez couper la connexion, tapez&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
/usr/sbin/dhcpcd -k
</PRE>
</CODE></BLOCKQUOTE>
</P>


<H2><A NAME="troubleshooting"></A> <A NAME="ss3.10">3.10 Probl&egrave;mes</A>
</H2>

<P>Si vous avez bien suivi toutes les &eacute;tapes ci-dessus et si malgr&eacute; tout vous ne
pouvez pas acc&eacute;der au r&eacute;seau, plusieurs explications sont possibles.</P>

<H3>Votre carte r&eacute;seau est mal configur&eacute;e.</H3>

<P>Pendant l'initialisation du syst&egrave;me, Linux va rechercher votre carte r&eacute;seau et
devrait afficher quelque chose de ce genre&nbsp;:
<HR>
<PRE>
eth0: 3c509 at 0x300 tag 1, 10baseT port, address  00 20 af ee 11 11, IRQ 10.
3c509.c:1.07 6/15/95 becker@cesdis.gsfc.nasa.gov
</PRE>
<HR>

Si aucun message de ce genre n'apparait, votre carte ethernet n'est
vraisemblablement pas reconnue par Linux. Si votre carte est une carte
g&eacute;n&eacute;rique (un clone de NE2000), vous devriez avoir une disquette avec des
utilitaires DOS que vous pouvez utiliser pour la configurer. Essayez plusieurs
IRQ jusqu'&agrave; ce que Linux reconnaisse votre carte. Les IRQ 9, 10 ou 12
conviennent g&eacute;n&eacute;ralement.</P>

<H3>Votre serveur DHCP ne supporte que la RFC 1541 ou fonctionne sous     Windows NT.</H3>

<P>Essayez de lancer <CODE>dhcpcd</CODE> par
<BLOCKQUOTE><CODE>
<PRE>
dhcpcd -r
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Utilisez <CODE>ifconfig</CODE> pour v&eacute;rifier que votre interface r&eacute;seau est configur&eacute;e
(attendez quelques secondes que la configuration soit termin&eacute;e; au d&eacute;part,
vous obtiendrez "inet addr: 0.0.0.0").</P>
<P>Si cela r&eacute;soud votre probl&egrave;me, ajoutez l'option "<CODE>-r</CODE>" &agrave; vos scripts
d'initialisation, c'est &agrave; dire remplacez <CODE>/sbin/dhcpcd</CODE> par
<CODE>/sbin/dhcpcd -r</CODE>.</P>
<P>Par exemple, sous Red Hat, &eacute;ditez le script
<CODE>/etc/sysconfig/network-scripts/ifup</CODE> et changez ce qui suit&nbsp;:
<HR>
<PRE>
        IFNAME=$[ {DEVICE} \
        "/sbin/dhcpcd -r -c /etc/"- etc etc.    
</PRE>
<HR>
</P>

<H3>Au d&eacute;marrage, je vois le message d'erreur "Using DHCP for eth0     ... failed" mais mon syst&egrave;me fonctionne correctement.</H3>

<P>Vous utilisez probablement une Red Hat et vous n'avez pas suivi
scrupuleusement les instructions. Il vous manque un point d'exclamation dans
un des scripts. Voyez 
<A HREF="#error3">ici</A> pour corriger &ccedil;a.</P>

<H3>Mon r&eacute;seau fonctionne pendant quelques minutes avant d'arr&ecirc;ter de     r&eacute;pondre.</H3>

<P>Il semble que <CODE>gated</CODE> (le d&eacute;mon de passerelle) puisse embrouiller le
routage sur des machines Linux, avec le r&eacute;sultat mentionn&eacute; ci-dessus. Regardez
s'il tourne&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
ps -auxww | grep gate
</PRE>
</CODE></BLOCKQUOTE>

S'il tourne effectivement, d&eacute;sinstallez-le avec le gestionnaire RPM de Red Hat
ou enlevez son entr&eacute;e dans <CODE>/etc/rc.d/</CODE>.</P>

<H3>Ma carte ethernet est reconnue au d&eacute;marrage, mais j'ai toujours le     message "NO DHCPOFFER" dans le journal du syst&egrave;me. Il se trouve que j'ai     une carte ethernet PCMCIA.</H3>

<P>Assurez-vous que le port 10baseT (la "prise de t&eacute;l&eacute;phone") de votre carte est
activ&eacute;. Le meilleur moyen de le v&eacute;rifier est de regarder pour quel type de
connecteur votre carte est configur&eacute;e &agrave; l'allumage, par exemple&nbsp;:
<HR>
<PRE>
eth0: 3c509 at 0x300 tag 1, 10baseT port, address  00 20 af ee 11 11, IRQ 10.
                            ^^^^^^^^^^^^
3c509.c:1.07 6/15/95 becker@cesdis.gsfc.nasa.gov
</PRE>
<HR>

Des utilisateurs de micro-ordinateurs portables m'ont signal&eacute; qu'ils avaient
ce genre de probl&egrave;mes &agrave; cause des utilitaires PCMCIA (plus sp&eacute;cifiquement
<CODE>ifport</CODE>), qui configurent la carte pour utiliser le port 10base2 (ethernet
fin). Vous devez vous assurer que vous utilisez le port 10baseT pour votre
connexion. Si ce n'est pas le cas, reconfigurez votre carte et red&eacute;marrez la
machine.</P>

<H3>Mon client DHCP envoie des requ&ecirc;tes, mais personne ne r&eacute;pond.</H3>

<P>Cette partie est due &agrave; Peter Amstutz.</P>
<P>Sur certains syst&egrave;mes, vous devez inclure un nom d'h&ocirc;te dans la requ&ecirc;te
DHCP. Avec <CODE>dhcpcd</CODE>, vous pouvez faire &ccedil;a comme &ccedil;a&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
dhcpcd -h hotetoto
</PRE>
</CODE></BLOCKQUOTE>

Le nom d'h&ocirc;te requis correspond probablement &agrave; votre nom d'utilisateur sur le
r&eacute;seau.</P>

<H3>J'ai bien suivi toutes les &eacute;tapes et ma machine ne se connecte     toujours pas.</H3>

<P>En g&eacute;n&eacute;ral, un modem cable m&eacute;morise l'adresse ethernet de votre carte
r&eacute;seau. Donc si vous connectez une nouvelle machine ou changez de carte
r&eacute;seau, vous allez devoir "apprendre" &agrave; votre modem &agrave; reconnaitre la nouvelle
machine ou la nouvelle carte. En g&eacute;n&eacute;ral, il suffit d'&eacute;teindre le modem et de
le rallumer avec l'ordinateur en marche. Sinon, vous devrez appeler le support
technique pour leur signaler que vous avez chang&eacute; de carte.</P>
<P>Il se peut aussi que vous ayez des r&egrave;gles de filtrage (install&eacute;es par
<CODE>ipfwadm</CODE>) qui interdisent le trafic sur les ports 67 et 68 utilis&eacute;s par
DHCP pour communiquer les informations de configuration. V&eacute;rifiez vos filtres
avec attention.</P>

<H3>Je suis abonn&eacute; &agrave; MediaOne Express et je ne peux toujours pas me     connecter.</H3>

<P>Il semble que MediaOne ait ajout&eacute; quelques extensions &agrave; DHCP qui ne devraient
pas y &ecirc;tre. C'est cens&eacute; ne plus &ecirc;tre un probl&egrave;me, mais si malgr&eacute; tout vous
rencontrez des probl&egrave;mes, regardez de ce c&ocirc;t&eacute;. Si vous avez la (mal)chance
d'avoir Windows NT sur votre machine, v&eacute;rifiez dans l'observateur d&eacute;v&eacute;nements,
vous devriez y trouver un avertissement de ce style&nbsp;:
<HR>
<PRE>
DHCP received an unknown option 067 of length 005. The raw option data is 
given  below.

0000: 62 61 73 69 63            basic
</PRE>
<HR>

S'il s'agit bien de ce probl&egrave;me, allez voir 
<A HREF="ftp://vanbuer.ddns.org/pub/">ftp://vanbuer.ddns.org/pub/</A> et t&eacute;l&eacute;chargez ou bien un binaire, ou bien
les sources de la version corrig&eacute;e.</P>


<H2><A NAME="ss3.11">3.11 Un autre client DHCP (le <CODE>dhclient</CODE> de l'ISC)</A>
</H2>

<P>Si vous n'arrivez pas &agrave; configurer votre connection au moyen de <CODE>dhcpcd</CODE>,
vous voudrez peut-&ecirc;tre essayer le <CODE>dhclient</CODE> de l'ISC. <CODE>dhclient</CODE> fait
partie de la distribution DHCP de l'ISC, qui contient un serveur et un
client. Les instructions sur la fa&ccedil;on de vous procurer et de compiler la
distribution DHCP se trouvent dans la section 
<A HREF="#dhcpserver">Un serveur DHCP pour UNIX</A>. Quand vous aurez termin&eacute;, revenez &agrave; la section
pr&eacute;sente pour la configuration du client.</P>
<P>Les informations qui suivent m'ont &eacute;t&eacute; fournies par Ted Lemon 
<A HREF="mailto:mellon@isc.org">mellon@isc.org</A>, un des auteurs de
<CODE>dhclient</CODE>.</P>
<P>Avec la version actuelle du client DHCP, vous n'avez pas r&eacute;ellement besoin
d'un fichier <CODE>dhclient.conf</CODE>. Il vous suffit d'invoquer
<CODE>dhclient</CODE>&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
/sbin/dhclient
</PRE>
</CODE></BLOCKQUOTE>

Cette commande va configurer toutes les interfaces pouvant faire de la
diffusion (NdT&nbsp;: broadcast). Si cela ne fonctionne pas, ou si vous
ne voulez configurer qu'une seule interface, cr&eacute;ez un fichier
<CODE>/etc/dhclient.conf</CODE> &agrave; partir de l'exemple de configuration
suivant&nbsp;:
<HR>
<PRE>
interface "eth0" {
  send dhcp-client-identifier 1:xx:xx:xx:xx:xx:xx;
  send dhcp-lease-time 86400;
}
</PRE>
<HR>

Ici, nous supposons que votre interface ethernet est eth0&nbsp;; sinon, faites
la modification ad&eacute;quate. Remplacez &eacute;galement xx:xx:xx:xx:xx:xx par votre
adresse ethernet. Ce fichier <CODE>dhclient.conf</CODE> fait ressembler votre client
DHCP &agrave; un client Windows&nbsp;95.</P>


<H2><A NAME="s4">4. Configurer un serveur DHCP</A></H2>

<H2><A NAME="dhcpserver"></A> <A NAME="ss4.1">4.1 Un serveur DHCP pour UNIX </A>
</H2>

<P>Il existe plusieurs serveurs DHCP pour les syst&egrave;mes d'exploitation "&agrave; la
UN*X", aussi bien commerciaux que libres. L'un des plus populaires est le
DHCPd de Paul Vixie et de l'ISC. Actuellement, la derni&egrave;re version est
la 2.0(dont l'utilisation est conseill&eacute;e pour le commun des mortels), mais
la 3.0 est en b&ecirc;ta-test. Vous pouvez les obtenir depuis 
<A HREF="ftp://ftp.isc.org/isc/dhcp/">ftp://ftp.isc.org/isc/dhcp/</A>. </P>
<P>Certaines distributions fournissent un paquetage <CODE>dhcpd</CODE> pr&eacute;compil&eacute;; si
vous l'avez obtenu de cette mani&egrave;re, vous pouvez ignorer ce qui suit.</P>
<P>Apr&egrave;s avoir t&eacute;l&eacute;charg&eacute; le serveur, d&eacute;compactez le. Ensuite, placez vous dans
le r&eacute;pertoire de la distribution et tapez&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
./configure
</PRE>
</CODE></BLOCKQUOTE>

La configuration des diff&eacute;rents param&egrave;tres va prendre quelques temps. Une fois 
qu'elle est termin&eacute;e, tapez&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
make
</PRE>
</CODE></BLOCKQUOTE>

puis
<BLOCKQUOTE><CODE>
<PRE>
make install
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="ss4.2">4.2 Configuration du serveur DHCP</A>
</H2>

<P>Une fois le serveur install&eacute;, tapez <CODE>ifconfig -a</CODE>. Vous devriez obtenir
quelque chose comme &ccedil;a&nbsp;:
<HR>
<PRE>
eth0      Link encap:10Mbps Ethernet  HWaddr 00:C0:4F:D3:C4:62
          inet addr:183.217.19.43  Bcast:183.217.19.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2875542 errors:0 dropped:0 overruns:0
          TX packets:218647 errors:0 dropped:0 overruns:0
          Interrupt:11 Base address:0x210
</PRE>
<HR>

Si le mot MULTICAST n'appara&icirc;t pas, vous devez recompiler votre noyau avec le
support multicast. Sur la plupart des syst&egrave;mes, &ccedil;a ne devrait pas &ecirc;tre
n&eacute;cessaire.</P>
<P>Ensuite, ajoutez une route pour 255.255.255.255. D'apr&egrave;s le fichier README du
DHCPd&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
Pour que dhcpd fonctionne correctement avec des clients DHCP pointilleux
(comme celui de Windows 95), il doit pouvoir envoyer des paquets IP avec une
adresse de destination de 255.255.255.255. Malheureusement, Linux insiste pour
changer 255.255.255.255 en l'adresse de diffusion du r&eacute;seau (ici
192.5.5.223). Ceci constitue une violation du protocole DHCP et, alors que
beaucoup de clients DHCP ignorent ce probl&egrave;me, certains (par exemple tous ceux
de Microsoft) le remarquent. Les clients qui ont ce probl&egrave;me sembleront ne pas
voir les messages DHCPOFFER du serveur.
</PRE>
</CODE></BLOCKQUOTE>

Pour cela, tapez&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
route add -host 255.255.255.255 dev eth0
</PRE>
</CODE></BLOCKQUOTE>

Si vous voyez un message d'erreur&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
"255.255.255.255: Unknown host"
</PRE>
</CODE></BLOCKQUOTE>

essayez d'ajouter la ligne suivante &agrave; votre fichier <CODE>/etc/hosts</CODE>&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
255.255.255.255 tout-le-monde
</PRE>
</CODE></BLOCKQUOTE>

Ensuite, essayez&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
route add -host tout-le-monde dev eth0
</PRE>
</CODE></BLOCKQUOTE>

ou
<BLOCKQUOTE><CODE>
<PRE>
route add 255.255.255.0 dev eth0
</PRE>
</CODE></BLOCKQUOTE>

<CODE>eth0</CODE> d&eacute;signe bien s&ucirc;r l'interface r&eacute;seau que vous utilisez. Si vous en
utilisez une autre, faites les changements n&eacute;cessaires.</P>

<H2><A NAME="ss4.3">4.3 Options de DHCPd</A>
</H2>

<P>Maintenant, il vous faut configurer DHCPd. Pour cela, vous allez devoir cr&eacute;er
ou &eacute;diter <CODE>/etc/dhcpd.conf</CODE>. Il existe une interface graphique pour
configurer <CODE>/etc/dhcpd.conf</CODE> sous KDE (
<A HREF="http://www.kde.org/">http://www.kde.org/</A>),
appel&eacute;e <CODE>kcmdhcpd</CODE>, tr&egrave;s similaire &agrave; l'outil de configuration de DHCP de
Windows NT. Lorsque KDE 2.0 sortira (NdT&nbsp;: C'est fait depuis quelques
mois), il devrait inclure <CODE>kcmdhcpd</CODE>. Vous pouvez aussi vous le
procurer directement &agrave; 
<A HREF="ftp://ftp.us.kde.org/pub/kde/unstable/apps/network/">ftp://ftp.us.kde.org/pub/kde/unstable/apps/network/</A>.</P>
<P>Si vous pr&eacute;f&eacute;rez configurer <CODE>dhcpd</CODE> &agrave; la main, suivez les instructions
ci-dessous.</P>
<P>La plupart du temps, vous voudrez assigner des adresses IP al&eacute;atoirement. Cela
peut se faire de la fa&ccedil;on suivante&nbsp;:</P>
<P>
<HR>
<PRE>
# Exemple de /etc/dhcpd.conf
# (Ajoutez vos commentaires ici)
default-lease-time 600;
max-lease-time 7200;
option subnet-mask 255.255.255.0;
option broadcast-address 192.168.1.255;
option routers 192.168.1.254;
option domain-name-servers 192.168.1.1, 192.168.1.2;
option domain-name "mondomaine.org";

subnet 192.168.1.0 netmask 255.255.255.0 {
   range 192.168.1.10 192.168.1.100;
   range 192.168.1.150 192.168.1.200;
}
</PRE>
<HR>

Le serveur DHCP distribuera aux clients des adresses IP dans les intervalles
192.168.1.10-192.168.1.100 et 192.168.1.150-192.168.1.200. L'attribution de
l'adresse IP se fera pour une durée de 600 secondes si le client ne demande pas une dur&eacute;e
diff&eacute;rente, la dur&eacute;e maximale du bail &eacute;tant de 7200 secondes. Le serveur va &eacute;galement
"conseiller" au client d'utiliser le masque de sous-r&eacute;seau 255.255.255.0,
l'adresse de diffusion 192.168.1.255, 192.168.1.254 comme routeur/passerelle
et 192.168.1.1 et 192.168.1.2 comme serveurs DNS.</P>
<P>Si vous devez sp&eacute;cifier un serveur WINS pour vos clients Windows, vous devrez
inclure l'option <CODE>netbios-name-servers</CODE>&nbsp;:
<HR>
<PRE>
option netbios-name-servers 192.168.1.1;
</PRE>
<HR>
</P>
<P>Vous pouvez aussi assigner des adresses IP sp&eacute;cifiques en utilisant l'adresse
ethernet du client&nbsp;:
<HR>
<PRE>
host haagen {
   hardware ethernet 08:00:2b:4c:59:23;
   fixed-address 192.168.1.222;
}
</PRE>
<HR>

Cela assignera l'adresse IP 192.168.1.222 &agrave; un client dont l'adresse ethernet
est 08:00:2b:4c:59:23.</P>
<P>Vous pouvez aussi m&eacute;langer ces diff&eacute;rentes possibilit&eacute;s, par exemple si vous
voulez donner des adresses IP statiques &agrave; certains clients (les serveurs, par
exemple) et des adresses IP dynamiques &agrave; d'autres (par exemple les ordinateurs
portables de certains utilisateurs). Il existe de nombreuses autres options:
adresse du serveur NIS, du serveur d'horloge... Si vous avez besoin de ces
options, lisez la page de manuel de dhcpd.conf.</P>

<H2><A NAME="ss4.4">4.4 D&eacute;marrage du serveur</A>
</H2>

<P>Il ne reste qu'une chose &agrave; faire avant de d&eacute;marrer le serveur. La plupart des
installations de DHCPd ne cr&eacute;ent pas par d&eacute;faut de fichier
<CODE>dhcpd.leases</CODE>. Ce fichier est utilis&eacute; par DHCPd pour stocker des
informations &agrave; propos des attributions en cours de validit&eacute;. Il est en format texte
brut, donc vous pouvez le lire pendant le fonctionnement de DHCPd. Pour le
cr&eacute;er, tapez&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
touch /var/state/dhcp/dhcpd.leases
</PRE>
</CODE></BLOCKQUOTE>

sur la ligne de commandes. Cela va cr&eacute;er un fichier vide (de taille
nulle). Certaines vieilles versions de <CODE>dhcpd</CODE> 2.0 pla&ccedil;aient ce fichier en
<CODE>/etc/dhcpd.leases</CODE>. Vous n'avez pas &agrave; y changer quoi que ce soit; c'est
<CODE>dhcpd</CODE> qui le manipulera lui-m&ecirc;me. Si vous voyez un message d'erreur
disant que le fichier n'existe pas, ignorez le et passez &agrave; l'&eacute;tape suivante.</P>
<P>Vous pouvez maintenant invoquer le serveur DHCP. Contentez vous de taper (ou
de rajouter dans les scripts de d&eacute;marrage)&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
/usr/sbin/dhcpd
</PRE>
</CODE></BLOCKQUOTE>

Cette commande invoquera <CODE>dhcpd</CODE> sur l'interface eth0. Pour l'utiliser sur
une autre interface, pr&eacute;cisez-le simplement sur la ligne de commande, par
exemple&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
/usr/sbin/dhcpd eth1
</PRE>
</CODE></BLOCKQUOTE>

Pour v&eacute;rifier que tout fonctionne correctement, vous devriez d'abord activer
le mode de d&eacute;bogage et mettre le serveur en avant-plan. Vous pouvez le faire
en tapant&nbsp;:
<BLOCKQUOTE><CODE>
<PRE>
/usr/sbin/dhcpd -d -f
</PRE>
</CODE></BLOCKQUOTE>

Ensuite, allumez un de vos clients et regardez la console de votre
serveur. Vous verrez apparaitre un certain nombre de messages de d&eacute;bogage. Si
tout se passe bien, vous avez termin&eacute;. :-) Quittez <CODE>dhcpd</CODE> et relancez-le
sans les options <CODE>-d -f</CODE>. Si vous voulez qu'il soit lanc&eacute; au d&eacute;marrage,
rajoutez <CODE>dhcpd</CODE> par exemple au fichier <CODE>/etc/rc.d/rc.local</CODE>.</P>

<H2><A NAME="ss4.5">4.5 Autres documents int&eacute;ressants</A>
</H2>

<P>Le num&eacute;ro d'avril 2000 de <EM>Linux Magazine</EM> contient un bon article
intitul&eacute; 
<A HREF="http://www.linux-mag.com/2000-04/networknirvana_01.html">Network Nirvana&nbsp;: How to make Network Configuration as easy as DHCP</A> qui
traite de la configuration de DHCP.</P>



</BODY>
</HTML>
