<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.21">
 <TITLE>Mini-HOWTO Fax-server</TITLE>
</HEAD>
<BODY>
<H1>Mini-HOWTO Fax-server</H1>

<H2>Erez Strauss <CODE>erez@newplaces.com</CODE>
Version v1.0</H2>8 November 1997
<HR>
<EM>Traduit par Frédéric Gacquer <CODE>gacquer@neuronnexion.fr</CODE>
Mercredi 14 janvier 1998.</EM>
<HR>

<P>Aucune garantie. Les commentaires sont les bienvenus. Ce document décrit
en détail une des façons les plus simples d'installer un serveur de fax
sur votre système linux. Le fax est disponible pour les utilisateurs sur 
le poste local et aux utilisateurs sur le réseau.</P>

<H2><A NAME="s1">1. Introduction</A></H2>

<P> </P>
<P>Pour faire fonctionner une imprimante/fax sur une machine linux vous  
devez avoir quelques logiciels et un modem fax.</P>

<P>Les logiciels pour l'Imprimante utiliseront le logiciel fax comme un 
filtre d'impression. Efax trouvera le numéro de fax à
partir du numéro de la tâche d'impression et enverra le fax. Le logiciel 
efax a été écrit par Ed Casas 
<CODE>
<A HREF="mailto://edc@cce.com">edc@cce.com</A></CODE>.</P>

<P>Le reste du document est construit autour de Question/Réponses.</P>


<H2><A NAME="s2">2. Questions et réponses</A></H2>



<H2><A NAME="ss2.1">2.1 Qu'est-ce qu'un serveur d'impression de fax</A>
      </H2>

<P>Un serveur d'impression de fax est une installation de quelques 
programmes: efax, et le serveur d'impression, de telle manière
qu'envoyer un fax à partir de l'ordinateur est aussi simple 
qu'envoyer une impression à l'imprimante.</P>

<H2><A NAME="ss2.2">2.2 Comment l'installer ?</A>
      </H2>

<P>Installer efax comme serveur d'impression de fax comporte peu
de problème. Comme j'ai travaillé dessus quelque fois, j'ai décidé 
de réunir ces connaissances dans ce petit mini-HOWTO, les commentaires
sont les bienvenus à <CODE>
<A HREF="erez@newplaces.com">erez@newplaces.com</A>.</CODE>Je les décrits ici ainsi que les solutions, et toutes les instructions en quelques étapes:</P>

<H3>Le logiciel efax      </H3>

<P>Assurez-vous que vous avez le progiciel efax.</P>
<P> 
Sur les systèmes qui reposent sur RPM utilisez la commande <CODE>'rpm -qv efax'</CODE>.</P>
<P>Vous pouvez obtenir les sources d'efax en format tar.gz chez sunsite:
<CODE>ftp://sunsite.unc.edu/pub/Linux/apps/serialcomm/fax/efax08a.tar.gz</CODE>
ou le progiciel binaire en rpm:
<CODE>ftp://ftp.redhat.com/pub/redhat/redhat-4.2/i386/RedHat/RPMS/efax-0.8a-3.i386.rpm</CODE>.</P>

<H3>L'entrée printcap      </H3>

<P>Le documentation d'efax a oublié le : à la fin de l'entrée printcap.</P>
<P> 
Solution: ajouter ce qui suit à l'entrée  <CODE>/etc/printcap</CODE>:
<BLOCKQUOTE><CODE>
<PRE>
  
       fax:\
               :lp=/dev/null:\
               :sd=/var/spool/fax:\
               :if=/usr/bin/faxlpr:
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H3>La command <CODE>fax</CODE>      </H3>

<P>Uilisez des liens physique et non des liens symboliques à la commande
fax.</P>
<P>Exécuter la commande:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  
            ln /usr/bin/fax /usr/bin/faxlpr
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H3>Le fichier <CODE>/usr/bin/fax</CODE>.      </H3>

<P>Editez <CODE>/usr/bin/fax</CODE> à votre convenance.</P>
<P>Choisir la bonne classe de votre modem:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  
       CLASS=2.0
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Positionner le champ FROM="votre numéro de téléphone international"</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  
       NAME="votre nom"
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Ajouter la ligne de conversion du numéro de téléphone international en 
local, par exemple pour Israël vous pourriez utiliser:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  
          TELCVT='sed -e s/+972/0/ -e s/+/00/'  # Israel
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Il y a un problème dans le fichier à la ligne 586, changer le cfile=...
avec les deux lignes suivantes:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  
       cfile=`/usr/bin/tail -1 lock`
       cfile=`cat $cfile`
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Aux lignes 586,587 il ne devriez pas y avoir le signe '-', les lignes sont</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  
       0) echo "$l" | mail -s "fax to $num succeeded" $user@$host ;;
       *) echo "$l" | mail -s "fax to $num failed   " $user@$host ;;
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H3>Le répertoire <CODE>/var/spool/fax</CODE>     </H3>

<P>Créer le répertoire <CODE>/var/spool/fax</CODE></P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  
       mkdir /var/spool/fax
       chmod 777 /var/spool/fax
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H3>Le fichier <CODE>lock</CODE>.     </H3>

<P>Le fichier lock (<CODE>/var/spool/fax/lock</CODE>) est créé avec des permissions
incorrectes, utiliser les commandes suivantes pour les positionner
correctement:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  
        touch /var/spool/fax/lock ; chmod 644 /var/spool/fax/lock
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H3>le fichier spécial <CODE>/dev/modem</CODE>     </H3>

<P>Le programme efax s'attend à un fichier device <CODE>/dev/modem</CODE> réél et
ne fonctionnera pas avec des liens symobliques, donc créer un fichier
device avec le même nombre majeur et le même mineur que <CODE>/dev/cua?</CODE>
qui est connecté au modem. Le fichier devra avoir les permissions
<CODE>rw-rw-rw-</CODE> pour autoriser n'importe quel utilisateur à utiliser le 
logiciel de fax.</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  
       ls -lL /dev/modem
       rm /dev/modem
       mknod /dev/modem c Mj Mi
       chmod 666 /dev/modem
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Mj est 5, et Mi est 64 pour cua0, 65 pour cua1 et ainsi de suite.
Par exemple (pour cua1) :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  
        mknod /dev/modem c 5 65
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H3>Le répertoire <CODE>/var/lock</CODE>.     </H3>


<P>
<BLOCKQUOTE><CODE>
<PRE>
  
        chmod 1777 /var/lock
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="ss2.3">2.3 Comment l'utiliser, avec le serveur ?</A>
        </H2>

<P>Vous devez utiliser l'imprimante fax en utilisant l'option -P
et l'option -J avec le numéro de fax.</P>

<P>Utiliser une des commandes lpr suivantes :</P>

<P>
<BLOCKQUOTE><CODE>
<PRE>
  
        lpr -Pfax -J &lt;Numéro-De-Fax&gt; [nom-de-fichiers]
        toute commande | lpr -Pfax -J &lt;Numéro-De-Fax&gt;
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="ss2.4">2.4 Où indique t on le numéro de fax destinataire ?</A>
        </H2>

<P>Après l'option -J.</P>

<H2><A NAME="ss2.5">2.5 Comment l'utiliser à partir d'autres unix ?</A>
        </H2>

<P>Ajouter les entrées suivantes dans le fichier <CODE>/etc/printcap</CODE> et
le système client Linux, créer le répertoire de spool, et ainsi
de suite...</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
  
         fax:\
                   :sd=/var/spool/fax:\
                   :mx#0:\
                   :sh:\
                   :rm=host.domain:\
                   :rp=fax:
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>ajouter le nom de l'hôte client dans <CODE>/etc/hosts.lpd</CODE> sur la 
machine serveur de fax.</P>

<P>Utiliser comme précédemment.</P>

<P>Note:</P>
<P>La chaîne de caractère d'entête qu'efax ajoute aux pages des fax
n'est pas effectué par l'utilisateur qui envoi le fax. (peut être 
mis à jour).</P>


<H3>Utilisateurs de Caldera, LPRng      </H3>

<P>Le logiciel de contrôle d'impression LPRng utilise une méthode 
différente pour prendre en charge le fichier de contrôle.</P>

<P>Merci à Luca Montecchiani 
<CODE>
<A HREF="mailto://m.luca@usa.net">m.luca@usa.net</A></CODE>, 
qui a trouvé le problème et la solution. Voici une mise à jour du fichier
<CODE>/usr/bin/fax</CODE>. Les lignes suivantes remplacent les deux simples 
lignes de cfile=... aux lignes 586,587</P>

<P>
<BLOCKQUOTE><CODE>
<PRE>
  

  # Modified to work also with the LPRng package
  # Luca Montecchiani (08/11/97 m.luca@usa.net)
  if [ !-z "$CONTROL_FILE" ]
      then
          cfile=`cat tail -1 lock`
          cfile=`cat $cfile`
      else
          cfile=$CONTROL_FILE
  fi
     
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="s3">3. Dernière version, Contacter l'auteur.</A> </H2>

<P> 
La dernière version de ce fichier peut être trouvé à travers le
world wide web en utilisant les URLs
<UL>
<LI>
<A HREF="http://www.newplaces.com/linux/faxsrv/faxsrv-mini-HOWTO.sgml">http://www.newplaces.com/linux/faxsrv/faxsrv-mini-HOWTO.sgml</A></LI>
<LI>
<A HREF="http://www.newplaces.com/linux/faxsrv/faxsrv-mini-HOWTO.html">http://www.newplaces.com/linux/faxsrv/faxsrv-mini-HOWTO.html</A></LI>
<LI>
<A HREF="http://www.newplaces.com/linux/faxsrv/faxsrv-mini-HOWTO.txt">http://www.newplaces.com/linux/faxsrv/faxsrv-mini-HOWTO.txt</A></LI>
<LI>
<A HREF="http://www.newplaces.com/linux/faxsrv/faxsrv-mini-HOWTO.info">http://www.newplaces.com/linux/faxsrv/faxsrv-mini-HOWTO.info</A></LI>
</UL>
</P>
<P>Vous pouvez me contacter :</P>
<P>Erez Strauss
<UL>
<LI> <CODE>
<A HREF="mailto://erez@newplaces.com">erez@newplaces.com</A></CODE></LI>
<LI> <CODE>
<A HREF="http://www.newplaces.com/linux/">http://www.newplaces.com/linux/</A></CODE></LI>
<LI> <CODE>
<A HREF="http://www.newplaces.com/">http://www.newplaces.com/</A></CODE></LI>
</UL>
</P>

<P>Phone: +972 52 739737
Fax:  +972 9 954 3034</P>
</BODY>
</HTML>
