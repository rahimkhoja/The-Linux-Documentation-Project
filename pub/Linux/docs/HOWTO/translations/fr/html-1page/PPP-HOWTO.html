<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.21">
 <TITLE>Linux PPP Howto</TITLE>
</HEAD>
<BODY>
<H1>Linux PPP Howto</H1>

<H2>par Robert Hart, hart@interweft.com.au</H2>Version 3.0, 31 mars 1997
<HR>
<EM>(Adaptation française par Antoine Levavasseur <CODE>levavass@efrei.fr</CODE>, le 22 octobre 1997).
Ce document montre comment connecter votre PC Linux à un serveur PPP, comment
utiliser PPP pour relier deux réseaux locaux ensemble, et fournit une méthode
pour configurer votre machine Linux comme serveur PPP. Ce document fournit
également une aide pour déboguer les connections PPP qui ne fonctionnent pas.</EM>
<HR>
<P><B>Copyright</B></P>
<P>Ce document est distribué sous les contraintes de la GPL 
(GNU Public Licence).</P>

<P><B>Distribution</B></P>
<P>Le document original sera posté dans comp.os.linux.answers lorsque de 
nouvelles versions du document arriveront. Il est également disponible en 
HTML à :
<UL>
<LI>
<A HREF="http://sunsite.unc.edu/mdw/linux.html#howto">Linux Howto Index</A></LI>
<LI>
<A HREF="http://www.interweft.com.au/other/ppp-howto/ppp-howto.html">PPP-HOWTO</A></LI>
</UL>
</P>

<P>Les autres formats (SGML, ASCII, PostScript, DVI) sont disponibles à 
<A HREF="ftp://sunsite.unc.edu/pub/Linux/docs/HOWTO/other-formats">Howtos - other formats</A>.</P>

<P>Comme sunsite.unc.edu est très chargé, vous êtes encouragés à utiliser un
miroir plus proche de chez vous. En particulier la version française de ce
HOWTO est posté régulièrement dans fr.comp.os.linux.annonce, et est disponible
sur ftp.lip6.fr et http://www.freenix.fr/.</P>

<P><B>Remerciements</B></P>

<P>Un nombre important et croissant de personnes m'ont aidé à préparer ce 
document. Remerciements spéciaux à Al Longyear pour l'aide sur PPP lui-même
(si il y a des erreurs ici, ce sont les miennes et pas les siennes), Greg
Hankins (qui maintient les Howto Linux) et Debi Tackett (de Maximum Access.com)
pour ses nombreuses suggestions sur le style, l'organisation du contenu, la
logique et la clarté des explications.</P>

<P>Pour finir, je remercie les nombreuses personnes qui m'ont envoyé leurs 
commentaires par courrier électronique. Comme tous les auteurs de HOWTO,
la satisfaction d'aider est le seul salaire que nous recevons, et cela nous
suffit. En écrivant ce HOWTO, je rembourse d'une certaine façon la dette que je
- et tous les autres utilisateurs Linux - dois aux personnes qui écrivent et
maintiennent le système d'exploitation que nous avons choisi.</P>
<P><B>Traduction Française de ce document</B></P>

<P>La traduction du présent document PPP-Howto (et précédemment PPP-FAQ) était 
assurée par René Cougnenc. C'était l'un des premiers (si ce n'est le premier) 
utilisateur de Linux en France alors que ce n'était qu'un petit projet un peu 
fou lancé par Linus Torvalds. René Cougnenc a participé au développement
de Linux et a assuré la traduction de nombreux HOWTO et ouvrages sur Linux qui 
font encore référence. Si vous utilisez Linux aujourd'hui c'est sans doute un
peu grâce à lui... <BR>
Prendre ses pas dans la traduction de ce HOWTO était un peu délicat car
la barre était placée haut, et j'espère que le lecteur que vous êtes ne sera
pas déçu par mon travail. <BR>
Et si René nous entends là-haut, je suis sûr qu'il lèvera avec nous son verre
à la santé de notre système d'exploitation favori ! :-)</P>
<P>Enfin merci à Thomas Parmelan pour la relecture et les conseils sur la forme de
la version française de ce document.</P>

<H2><A NAME="s1">1. Introduction</A></H2>


<P>PPP (Point to Point Protocol) est un mécanisme qui permet de faire fonctionner
IP (Internet Procotol) et tous les autres protocoles réseaux à travers une 
liaison série - qui peut être une connexion série directe (avec un câble 
null-modem), à travers une liaison par un telnet, ou encore une liaison 
utilisant les modems et les lignes téléphoniques (et bien sûr utilisant les 
lignes numériques comme RNIS). </P>

<P>Avec PPP, vous pouvez connecter votre PC sous Linux à un serveur PPP et accéder
aux ressources réseau aux quelles le serveur est connecté (presque) comme si
vous étiez directement connecté à ce réseau. </P>

<P>Vous pouvez également configurer votre PC Linux comme un serveur PPP, de cette
façon, d'autres ordinateurs peuvent appeler votre ordinateur et accéder aux
ressources de votre PC et/ou réseau local. </P>

<P>Comme PPP est un système qui marche dans les deux sens, vous pouvez également
utiliser PPP sur deux PC Linux pour relier ensemble deux réseaux (ou un
réseau local à Internet), créant ainsi un réseau à large domaine
(WAN : Wide Area Network). </P>

<P>Une différence majeure entre PPP et une connexion Ethernet est bien entendu
la vitesse - une connexion Ethernet standard offre à un débit maximal
théorique de 10 Mbs (Mega - millions de bits par seconde), alors qu'une 
liaison analogique par modem offre un maximum de 56 Kbs (kilo - millier de bits
par seconde). </P>

<P>Par conséquent, selon le type de votre connexion PPP, il y aura des limitations
sur l'utilisation des applications et des services.</P>

<H2><A NAME="ss1.1">1.1 Clients et Serveurs </A>
</H2>


<P>PPP est un protocole strictement symétrique; il n'y a (techniquement) aucune
différence entre la machine qui appelle et la machine qui est appelée. 
Cependant, pour des raisons de clarté, il est intéressant de penser en terme 
de <B>serveur</B> et <B>client</B>. </P>

<P>Quand vous appelez un site pour établir une connexion PPP, vous êtes un
<B>client</B>. La machine sur laquelle vous-vous connectez est le <B>serveur</B>.</P>

<P>Quand vous configurez une machine Linux pour répondre aux appels pour les 
connexion PPP, vous configurez un <B>serveur</B> PPP.</P>

<P>Tous les PC Linux peuvent être à la fois serveur et client PPP - même en même
temps si vous avez plus d'un port série (et d'un modem si nécessaire).  
Comme décrit plus haut, il n'y a pas de réelle différence entre les
clients et les serveurs tant que l'on utilise PPP et que la connexion est
établie. </P>

<P>Ce document référence la machine qui initie l'appel (qui le compose) comme
le <B>CLIENT</B>, alors que la machine qui répond au téléphone, vérifie 
l'authentification de l'appel (en utilisant les noms utilisateurs, les mots de 
passe et éventuellement d'autres mécanismes) est référencée comme le 
<B>SERVEUR</B>. </P>

<P>L'utilisation de PPP comme client pour relier une ou plusieurs machines à
Internet est probablement celle qui intéresse une majorité de gens.
Ils utiliseront alors leur PC Linux comme client. </P>

<P>La procédure exposée dans ce document va vous permettre d'établir et 
d'automatiser votre connexion à Internet. </P>

<P>Ce document va également vous offrir un guide pour permettre de configurer
un <B>serveur PPP</B> sur votre PC Linux et relier ensemble deux réseaux 
(avec le routage complet) en utilisant PPP (cela est aussi appelé
une liaison WAN - wide area network).</P>

<H2><A NAME="ss1.2">1.2 Différences entre les distributions Linux </A>
</H2>


<P>Il y a de nombreuses distributions Linux différentes qui on leurs propres 
idiosyncrasies et façons de faire les choses. </P>

<P>En particulier, il y a deux manières différentes sur une machine Linux
(ou Unix) de démarrer, configurer ses interfaces et ainsi de suite. </P>

<P>Il y <B>l'initialisation BSD </B> et <B>l'initialisation SysV system</B>. Si vous
consultez certains forums de discussion Unix, vous trouverez de temps en temps 
des guerres de religion entre les partisans de chacun des deux systèmes. Si
ce genre de chose vous plaît, allez donc les rejoindre pour gâcher de la bande 
passante avec eux ! </P>

<P>Les distributions les plus utilisées sont sans doute :</P>
<P>
<UL>
<LI>Slackware <BR>
qui utilise une initialisation système BSD </LI>
<LI>Red Hat (et son précédent associé Caldera) <BR>
qui utilise une initialisation SysV system (bien qu'un peu modifiée)</LI>
<LI>Debian <BR>
qui utilise une initialisation SysV system</LI>
</UL>
</P>

<P>Les initialisations de type BSD conservent typiquement ces fichiers dans
<CODE>/etc/</CODE> et ces fichiers sont :</P>
<P>
<HR>
<PRE>
        /etc/rc
        /etc/rc.local
        /etc/rc.serial
                (et parfois d'autres fichiers)
</PRE>
<HR>
</P>

<P>Récemment, certaines initialisation systèmes BSD se mettaient à utiliser 
un répertoire <CODE>/etc/rc.d/</CODE> contenant les fichiers de démarrage
plutôt que de tout mettre dans <CODE>/etc</CODE>.</P>


<P>L'initialisation System V conserve ses fichiers d'initialisation dans les
répertoires <CODE>/etc/</CODE> ou <CODE>/etc/rc.d</CODE> et un certain nombre de
sous-répertoires de ces derniers.</P>
<P>
<HR>
<PRE>
drwxr-xr-x   2 root     root         1024 Jul  6 15:12 init.d
-rwxr-xr-x   1 root     root         1776 Feb  9 05:01 rc
-rwxr-xr-x   1 root     root          820 Jan  2  1996 rc.local
-rwxr-xr-x   1 root     root         2567 Jul  5 20:30 rc.sysinit
drwxr-xr-x   2 root     root         1024 Jul  6 15:12 rc0.d
drwxr-xr-x   2 root     root         1024 Jul  6 15:12 rc1.d
drwxr-xr-x   2 root     root         1024 Jul  6 15:12 rc2.d
drwxr-xr-x   2 root     root         1024 Jul 18 18:07 rc3.d
drwxr-xr-x   2 root     root         1024 May 27  1995 rc4.d
drwxr-xr-x   2 root     root         1024 Jul  6 15:12 rc5.d
drwxr-xr-x   2 root     root         1024 Jul  6 15:12 rc6.d
</PRE>
<HR>
</P>

<P>Si vous essayez de chercher où votre interface et les routes réseau associées
sont configurées, vous devez parcourir tous les fichiers pour parvenir à trouver
où sont les commandes correspondantes.</P>

<H2><A NAME="ss1.3">1.3 Outils de configuration spécifiques aux distributions</A>
</H2>

<P>Dans certaines installations (par exemple Red Hat et Caldera), il y a un
système de configuration des PPP sous X Window. Ce HOWTO ne 
traite pas de ces outils spécifiques aux distributions. Si vous avez
des problèmes avec ceux-ci, contactez directement les distributeurs !</P>

<P>Pour les utilisateurs de Red Hat 4.x, il y a maintenant un 
<A HREF="http://www.interweft.com.au/">Red Hat PPP-TIP</A> dans la partie
Linux ressources et également chez  
<A HREF="http://www.redhat.com/">Red Hat Software</A> dans la partie support.</P>

<H2><A NAME="s2">2. Adresse IP </A></H2>

<P>Tout matériel connecté à Internet doit avoir sa propre, et unique adresse IP.
Elle sont distribuées de façon centralisée par l'autorité désignée pour
chaque pays. </P>

<P>Si vous êtes connectés par un réseau local (LAN) à Internet, <B>VOUS DEVEZ</B>
utiliser une adresse IP de votre propre domaine d'adresses qui vous a
été assigné pour les ordinateurs et matériels de votre réseau local. Vous 
<B>NE DEVEZ PAS</B> prendre n'importe quelle adresse IP et l'utiliser 
lorsque vous vous connectez avec un autre réseau local (et à plus forte raison
Internet). Au pire ça ne marchera pas du tout et cela peut causer des ravages
puisque votre adresse IP 'volée' va interférer avec les communications d'un
autre ordinateur qui utilise déjà l'adresse IP que vous avez prise au hasard.</P>

<P>Remarquez que les adresses IP de ce document appartiennent (à part quelques
exceptions) aux adresses de réseaux non connectés qui sont réservées aux
réseaux qui ne sont pas (encore) connectés à Internet. (RFC1918)</P>

<P>Il y a des adresses IP qui sont spécifiquement destinées aux réseaux locaux qui
ne sont pas connectés à Internet. Ces adresses IP sont :</P>
<P>
<UL>
<LI>Une Adresse Réseau de Classe A <BR>
10.0.0.0 (netmask 255.0.0.0)</LI>
<LI>16 Adresses Réseau de Classe B <BR>
172.16.0.0 - 172.31.0.0 (netmask 255.255.0.0)</LI>
<LI>256 Adresses Réseau de Classe C <BR>
192.168.0.0 - 192.168.255.0 (netmask 255.255.255.0)</LI>
</UL>
</P>


<P>Si vous avez un réseau pour lequel vous <B>n'avez pas</B> alloué d'adresse IP
auprès de l'autorité responsable de votre pays, vous devez utiliser une
des adresses réseau de la séquence précédente pour vos machines.</P>

<P>Ces adresses ne doivent <B>jamais</B> être utilisées sur Internet.</P>

<P>Cependant, elles peuvent être utilisées pour les réseaux locaux Ethernet sur la
machine qui est connectée à Internet. C'est parce que les adresses IP
sont en fait allouées aux interfaces réseau et non à l'ordinateur.
Ainsi, votre interface Ethernet peut utiliser 10.0.0.1 (par exemple),
et quand vous vous connecterez à Internet en utilisant PPP, votre interface PPP
récupérera une autre adresse IP (valide) du serveur. Votre PC sera connecté
à Internet alors que les autres ne le seront pas.</P>

<P>Cependant, en utilisant Linux, les capacités de IP Masquerading (aussi 
appelé NAT - Network Adress Translation) de Linux et du programme <B>ipfwadm</B>,
vous pouvez connecter votre réseau local à Internet (avec quelques restrictions
sur les services), même si vous n'avez pas d'adresse IP valide pour
vos machines en Ethernet.</P>

<P>Pour plus d'informations sur le sujet, consulter le mini-HOWTO
IP Masquerade à 
<A HREF="http://sunsite.unc.edu/mdw/HOWTO/mini/IP-Masquerade">Linux IP Masquerade mini HOWTO</A></P>

<P>Pour la plupart des utilisateurs, qui sont connectés avec une seule machine
à leur fournisseur d'accès Internet (FAI) par PPP, obtenir une 
adresse IP (ou plus largement une adresse réseau) n'est pas nécessaire.</P>

<P>Si vous souhaitez connecter un petit réseau local à Internet, de nombreux 
FAI peuvent vous fournir un sous-réseau dédié (une séquence spécifique 
d'adresses IP) sur leur espace d'adresses IP existant.
Alternativement, utilise IP masquerading.</P>

<P>Pour les utilisateurs qui connectent un seul PC à Internet, la plupart
des FAI utilise l'allocation <B>dynamique</B> des adresses IP.
C'est pendant le processus de connexion que le service PPP que vous contactez 
va indiquer à votre machine quelle adresse IP utiliser pour l'interface
PPP pendant la session en cours. Cette adresse ne sera pas forcément la même à 
chaque fois que vous vous connecterez à votre FAI.</P>

<P>Avec les adresses IP dynamiques, vous <B>n'avez pas</B> la même adresse IP à
chaque fois que vous vous connectez. Cela a des répercussions sur les
applications de type serveur de votre machine Linux telles que Sendmail,
ftpd, httpd et d'autres. Ces services supposent que l'ordinateur offrant
le service soit accessible tout le temps à la même adresse IP (ou au moins
au même nom de domaine qualifié, et que la résolution des noms par DNS du nom 
vers l'adresse IP est disponible).</P>

<P>Les limitations de service dues aux allocations dynamiques d'adresses IP
(et les façons d'éviter cela, quand c'est possible) sont décrites plus
loin.</P>

<H2><A NAME="s3">3. Buts de ce document</A></H2>

<H2><A NAME="ss3.1">3.1 Mettre en place un client PPP</A>
</H2>

<P>Ce document fournit un guide aux personnes qui souhaitent utiliser Linux et PPP
pour appeler un Serveur PPP et configurer une connexion IP avec PPP. Cela
suppose que PPP ait été compilé et installé sur votre machine Linux (mais
une brève description de la reconfiguration/recompilation de votre noyau avec
le support PPP est fournie).</P>

<P>Bien que <CODE>dip</CODE> (la manière standard de créer des connexions SLIP) puisse 
être utilisé pour mettre en place un connexion PPP, les scripts <CODE>dip</CODE> sont
généralement un peu complexes. Pour cette raison, ce document ne traite pas
l'utilisation de <CODE>dip</CODE> pour lancer une connexion PPP.</P>

<P>A la place, ce document décrit les programmes standard Linux/PPP (chat/pppd).</P>

<H2><A NAME="ss3.2">3.2 Relier deux Réseaux locaux ou un réseau local à Internet grâce à PPP</A>
</H2>

<P>Ce document donne des informations (de base) pour relier deux réseaux locaux
entre eux ou un réseau local à Internet grâce à PPP.</P>

<H2><A NAME="ss3.3">3.3 Configurer un serveur PPP</A>
</H2>

<P>Ce document fournit un guide pour configurer votre PC Linux comme serveur PPP
(autorisant d'autres personnes à appeler votre PC Linux et établir une
connexion PPP).</P>

<P>Notez qu'il y a un grand nombre de façons de configurer Linux comme
serveur PPP. Ce document donne une méthode - qui est utilisée par l'auteur pour
configurer quelques petits serveurs PPP (chacun avec 16 modems).</P>

<P>Cette méthode est connue pour fonctionner correctement. Cependant, ce n'est pas 
forcément la meilleure méthode.</P>

<H2><A NAME="ss3.4">3.4 Utiliser PPP avec une connexion Null-Modem directe</A>
</H2>

<P>Ce document offre un bref aperçu d'utilisation de PPP pour relier deux PC
Linux avec un câble null modem. Il est possible de relier d'autres Systèmes
d'exploitation à Linux de cette façon également. Pour ce faire, utiliser la 
documentation du système d'exploitation pour lequel vous êtes intéressé.</P>

<H2><A NAME="ss3.5">3.5 Pour le moment ce document ne couvre pas...</A>
</H2>

<P>
<UL>
<LI>La compilation du daemon PPP<BR>
Regarder la documentation fournie avec la version de <CODE>pppd</CODE> que vous 
utilisez.
</LI>
<LI>Connecter et configurer un modem sous Linux (en détail) <BR>
Regarder le Serial-HOWTO et pour les initialisations spécifiques au modem, voir
<A HREF="http://www.in.net/info/modems/index.html">Modem Setup Information</A> des informations qui pourraient vous aider à configurer votre
modem.
</LI>
<LI>Utiliser <CODE>dip</CODE> pour faire des connexion PPP<BR>
utiliser <CODE>chat</CODE> à la place
</LI>
<LI>Utiliser <CODE>socks</CODE> ou IP Masquerading<BR>
Il y a d'excellents documents qui couvrent déjà ces paquetages.
</LI>
<LI>Utiliser EQL pour regrouper deux modems pour une seule connexion PPP.
</LI>
<LI>Les méthodes de connexion PPP spécifiques aux distributions (comme
l'outil de configuration réseau de la Red Hat 4.x).
Voir votre distribution pour la documentation sur les méthodes utilisées.
</LI>
<LI>Le nombre croissant d'outils disponibles pour automatiser les connexions
PPP <BR>
Voir la documentation appropriée.</LI>
</UL>
</P>

<H2><A NAME="s4">4. Versions des logiciels traités</A></H2>

<P>Ce HOWTO suppose que vous utilisez un noyau Linux 1.2.X avec le programme PPP
2.1.2 ou Linux 1.3.X/2.0.x et PPP 2.2.</P>

<P>Au moment de la rédaction, la dernière version officielle de PPP disponible est
ppp-2.2.0f. La nouvelle version (ppp-2.3) est encore en beta.</P>

<P>Il est possible d'utiliser PPP 2.2.0 avec le noyau 1.2.13. Cela nécessite des
patchs pour le noyau. Il est recommandé aux utilisateurs du noyau 1.2.13 de 
passer à ppp-2.2 puisqu'il inclut quelques extensions et corrections de bogues.</P>

<P><B>Vous devez également être particulièrement vigilant et ne pas utiliser
le programme PPP 2.1.2 avec un noyau Linux 2.0.X.</B></P>

<P>Veuillez remarquer que ce document <B>ne traite pas</B> des problèmes venant de
l'utilisation de modules chargeables pour votre noyau Linux 2.0.x. Consulter
le mini-HOWTO kerneld et la documentation kerneld/module 2.0.x (dans les sources
de Linux 2.0.x à <CODE>/usr/src/linux/Documentation/..</CODE>).</P>

<P><B>Puisque ce document est destiné à aider les nouveaux utilisateurs, il est
fortement recommandé d'utiliser une nouvelle version du noyau Linux et
la version appropriée de PPP qui sont connus pour fonctionner ensemble.</B></P>

<H2><A NAME="s5">5. D'autres documents utiles/importants</A></H2>

<P>Je conseille aux utilisateurs de lire :
<UL>
<LI>la documentation accompagnant le paquetage PPP;</LI>
<LI>les pages de manuel de <CODE>pppd</CODE> et <CODE>chat</CODE>; <BR>
(utiliser <CODE>man chat</CODE> et <CODE>man pppd</CODE> pour les lire)</LI>
<LI>La page de configuration des modems - voir  
<A HREF="http://www.in.net/info/modems/index.html">Modem Setup Information</A></LI>
<LI>Les excellents livres Unix/Linux publiés par O'Reilly and Associates.
(
<A HREF=" http://www.ora.com/">O'Reilly and Associates On-Line Catalogue</A>). Si vous êtes nouveau à Unix/Linux,
<B>courez</B> (ne marchez pas) au plus proche marchand de livres informatiques et
investissez dans un certain nombre d'entre eux immédiatement !</LI>
<LI>La PPP-FAQ maintenue par Al Longyear, disponible sur  
<A HREF="ftp://sunsite.unc.edu/pub/Linux/docs/faqs">Linux PPP-FAQ</A>.<BR>
Elle contient un grand nombre d'informations utiles sous forme de 
questions/réponses indispensable lorsque l'on cherche pourquoi PPP ne fonctionne
pas (correctement).</LI>
<LI>Le nombre croissant de livre Linux venant des différents éditeurs et 
auteurs; <BR>
Vous êtes encouragés à vérifier la date de parution de ces livres. Le
développement et la distribution de Linux tendent à être plutôt rapides,
alors que la mise à jour des livres est (généralement) bien plus lente !
Acheter un excellent livre (et il y en a) qui est déjà dépassé entraine
une confusion et une frustration considérable pour les nouveaux utilisateurs.</LI>
</UL>
</P>

<P>Le meilleur point de départ pour la documentation Linux est  
<A HREF="http://sunsite.unc.edu/mdw/">The Linux Documentation Project Home Page</A>. Les HOWTO sont mis à jour raisonnablement régulièrement.</P>

<P>Bien que vous puissiez utiliser ce document pour créer votre liaison PPP sans
lire aucun de ces documents, vous devriez avoir une bien meilleure 
compréhension de ce qu'il se passe si vous le faites ! Vous pouvez également
exposer vous-même vos problèmes (ou du moins poser les questions les plus 
intelligentes sur les groupes de discussion comp.os.linux... ou 
fr.comp.os.linux/unix... ou les mailing list Linux).</P>

<P>Ces documents (ainsi que quelques autres, comme les RFCs correspondants)
fournissent des explications complémentaires et plus détaillées que ce qui est
possible dans les HOWTO.</P>

<P>Si vous connectez un réseau local à Internet avec PPP, vous avez besoin de 
connaître un certain nombre de choses sur les réseaux TCP/IP. En complément
des documents précédents, vous trouverez dans les livres O'Reilly
<CODE>&quot;</CODE>TCP/IP Network Administration<CODE>&quot;</CODE> et
<CODE>&quot;</CODE>Building Internet Firewalls<CODE>&quot;</CODE> un bénéfice
considérable !</P>

<H2><A NAME="ss5.1">5.1 Les Mailing Listes utiles</A>
</H2>

<P>Il y a de nombreuses mailing listes (listes de diffusion) Linux qui servent de 
moyen de communication entre les utilisateurs dans de nombreux domaines. 
Souscrivez absolument à celles qui vous intéressent pour donner votre point 
de vue.</P>

<P><B>Remarques de bon sens</B>: certaines listes sont spécifiquement destinés au
utilisateurs "experts" et/ou à certains sujets spécifiques. Même si personne 
ne se plaindra que vous soyez voyeur (souscrire sans poster de messages),
vous recevrez certainement des commentaires chauds (voire des flammes) si
vous postez des questions de débutant dans les listes innappropriées.</P>

<P>Ce n'est pas parce que les utilisateurs gourous détestent les nouveau 
utilisateurs, mais parce que ces listes sont là pour contenir des remarques 
spécifiques à un certain niveau de difficulté.</P>

<P>Vous êtes largement encouragés à souscrire librement à différentes listes
mais faites absolument des commentaires qui cadrent avec le sujet (et le
niveau) de la liste !</P>

<P>Un bon point de départ pour les mailing-list Linux est 
<A HREF="http://summer.snu.ac.kr/~djshin/linux/mail-list/index.shtml">Linux Mailing List Directory</A></P>


<H2><A NAME="s6">6. Présentation de ce qui doit être fait pour faire fonctionner PPP comme client</A></H2>

<P>Ce document contient un grand nombre d'informations - qui augmente à chaque 
version !</P>


<P>Par conséquent, cette section a pour but de fournir une présentation concise
des actions pour connecter votre système Linux comme client à un serveur PPP.</P>

<H2><A NAME="ss6.1">6.1 Obtenir/installer les programmes</A>
</H2>

<P>Si votre distribution Linux ne contient pas les programmes PPP, vous
devez les obtenir sur  
<A HREF="ftp://sunsite.unc.edu/pub/Linux/system/Network/serial/ppp/ppp-2.2.0f.tar.gz">the Linux PPP daemon</A></P>

<P>C'est la dernière version officielle lors de la rédaction du document.
Cependant, prenez la dernière version disponible sur ce site (ppp-2.3 était
en béta lors de la rédaction de ce document et devrait sortir bientôt).</P>

<P>Le paquetage PPP contient les instructions sur la façon de compiler et
d'installer le logiciel <B>donc ce HOWTO n'en parlera pas</B>. !</P>

<H2><A NAME="ss6.2">6.2 Compiler le support PPP dans le noyau</A>
</H2>

<P>L'installation de PPP Linux se divise en deux parties
<UL>
<LI>le daemon PPP mentionné ci-dessus</LI>
<LI>le support PPP dans le noyau</LI>
</UL>
</P>

<P>De nombreuses distributions semblent fournir un support PPP dans les noyaux
installés par défaut, mais certaines ne le font pas.</P>

<P>Si lors du boot, le noyau donne un message ressemblant à :</P>
<P>
<HR>
<PRE>
PPP Dynamic channel allocation code copyright 1995 Caldera, Inc.
PPP line discipline registered.
</PRE>
<HR>
</P>

<P>Votre noyau à le support PPP compilé.</P>

<P>Toutefois, vous devez recompiler votre propre noyau quelque soit votre 
distribution pour fournir l'utilisation la plus efficace possible des ressources
disponibles et de votre configuration matérielle personnelle. Il est bon de 
savoir que le noyau ne peut être swappé hors de la mémoire. Avoir un noyau le 
plus petit possible est donc intéressant surtout pour une machine limitée en 
mémoire.</P>

<P>Ce document fournit les instructions minimales pour la re-compilation du noyau
à la section 
<A HREF="#Configuration du noyau">Configurer votre noyau Linux</A>.</P>

<P>Pour plus de détails, voir le Kernel-HOWTO à 
<A HREF="http://sunsite.unc.edu/mdw/HOWTO/Kernel-HOWTO.html">The Linux Kernel HOWTO</A></P>

<H2><A NAME="ss6.3">6.3 Obtenir les informations pour votre fournisseur d'accès à Internet</A>
</H2>

<P>Il y a presque une infinité de manières de configurer un serveur PPP. Pour se
connecter chez votre fournisseur d'accès (ou un serveur PPP pour accéder à
votre intranet), vous devez obtenir des informations sur la façon dont le 
serveur fonctionne.</P>

<P>Puisque vous utilisez Linux, vous pourriez avoir quelques difficultés avec
le support de certains FAI (et les serveurs Intranet d'entreprise) qui ne 
connaissent que les clients MS-Windows.</P>

<P>Toutefois, un nombre croissant de FAI utilisent Linux pour offrir leur service 
- et Linux pénètre également l'environnement industriel, vous devriez réduire 
ainsi les chances de rencontrer des problèmes.</P>

<P>La section 
<A HREF="#Info Serveur">Fournir les informations dont vous avez besoin pour votre serveur PPP</A> vous explique ce dont vous devez savoir sur
le serveur PPP sur lequel vous vous connectez et comment obtenir les
informations dont vous avez besoin.</P>

<H2><A NAME="ss6.4">6.4 Configurer votre modem et votre port série</A>
</H2>

<P>Pour se connecter à un serveur PPP et obtenir le meilleur taux de transfert
possible, votre modem doit être configuré correctement.</P>

<P>De la même façon, les ports série de votre modem ainsi que votre ordinateur 
doivent être configurés correctement.</P>

<P>La section 
<A HREF="#Modem">Configurer votre modem et votre port série</A>
fournit des informations à ce sujet.</P>

<H2><A NAME="ss6.5">6.5 Mettre en place la résolution de noms (DNS)</A>
</H2>

<P>En plus des fichiers qui lancent PPP et automatisent la connexion sur le
serveur PPP, il y a un grand nombre de fichiers de configuration qui
sont mis en place pour que votre ordinateur puisse résoudre les noms comme
<CODE>www.interweft.com.au</CODE> vers l'adresse IP qui est réellement utilisée
pour contacter cet ordinateur. Ces fichiers sont : </P>
<P>
<UL>
<LI><CODE>/etc/resolv.conf</CODE></LI>
<LI><CODE>/etc/host.conf</CODE></LI>
</UL>
</P>

<P>Voir la section 
<A HREF="#DNS">Configurer la résolution de nom vers l'adresse</A>
pour une configuration détaillée de cela.</P>

<P>En particulier, vous <B>n'avez pas besoin</B> de lancer un serveur de nom sur 
votre PC Linux pour le connecter à Internet (sauf si vous le souhaitez).
Tout ce dont vous avez besoin est de connaître l'adresse IP d'au moins l'un
des serveurs de noms que vous pouvez utiliser (plutôt celui de votre 
fournisseur d'accès).</P>

<H2><A NAME="ss6.6">6.6 PPP et les privilèges root</A>
</H2>

<P>Puisqu'établir une liaison PPP entre votre ordinateur Linux et un autre 
serveur PPP nécessite la manipulation des périphériques réseau (l'interface 
PPP est une interface réseau) et des tables de routages du noyau, <CODE>pppd</CODE> 
nécessite les privilèges <B>root</B>.</P>

<P>Pour des détails là-dessus, voir la section 
<A HREF="#root">Utiliser PPP et les privilèges root</A>.</P>

<H2><A NAME="ss6.7">6.7 Vérifier les fichiers de votre distribution PPP et configurer les options de PPP</A>
</H2>

<P>Il y a un certain nombre de fichiers de configuration et d'appel qui doivent
être configurés pour rendre PPP opérationnel. Des exemples sont fournis 
avec la distribution de PPP et cette section montre quels fichiers il doit y 
avoir :</P>
<P>
<HR>
<PRE>
/etc/ppp/options
/etc/ppp/scripts/ppp-on
/etc/ppp/scripts/ppp-on-dialer
/etc/ppp/options.tpl
</PRE>
<HR>
</P>

<P>Vous devrez créer des fichiers supplémentaires en fonction de ce que
vous souhaitez exactement utiliser avec PPP :</P>
<P>
<HR>
<PRE>
/etc/ppp/options.ttyXX
/etc/ppp/ip-up
/etc/ppp/pap-secrets
/etc/ppp/chap-secrets
</PRE>
<HR>
</P>

<P>En plus, le daemon PPP peut traiter un grand nombre d'options en ligne de
commande et il est important d'utiliser les bonnes; ainsi cette section
montre les options standard de PPP et vous aide à choisir les options que 
vous utiliserez.</P>

<P> Pour les détails à ce sujet, voir en section 
<A HREF="#options">Configurer les fichiers de connexion de PPP</A>.</P>

<H2><A NAME="ss6.8">6.8 Si votre serveur PPP utilise PAP (Password Authentication Protocol)</A>
</H2>

<P>De nombreux fournisseurs d'accès et serveurs PPP utilisent PAP. Si votre
serveur <B>n'a pas</B> besoin d'utiliser PAP (si vous pouvez vous connecter
à la main et recevoir les messages textes de nom utilisateur/mot de passe
il n'utilise pas PAP), vous pouvez tranquillement ignorer cette section.</P>

<P>Plutôt que se connecter dans de tels serveurs en utilisant le nom utilisateur
et le mot de passe quand vous êtes interrogés par le serveur pour les entrer,
un serveur PPP utilisant PAP n'a pas besoin de login basé sur du texte.</P>

<P>Les informations d'authentification de l'utilisateur sont échangées à la place
comme partie prenante du protocole de contrôle de connexion qui est la 
première partie de l'établissement d'une liaison PPP.</P>

<P>La section 
<A HREF="#pap">Si votre serveur PPP utilise PAP (Password Authentification Protocol)</A> fournit des informations sur les
fichiers dont vous avez besoin pour établir une connexion PPP en utilisant
PAP.</P>

<H2><A NAME="ss6.9">6.9 Se connecter au serveur PPP à la main</A>
</H2>

<P>Une fois les fichiers de base configurés, c'est une bonne idée que d'essayer 
ceux-ci en se connectant (avec <CODE>minicom</CODE> ou <CODE>seyon</CODE>) et de lancer 
<CODE>pppd</CODE> sur votre PC Linux à la main.</P>

<P>Voir la section 
<A HREF="#manual">Configurer une connexion PPP à la main</A>
pour des détails complets.</P>

<H2><A NAME="ss6.10">6.10 Automatiser votre connexion PPP</A>
</H2>

<P>Une fois que vous pouvez vous connecter à la main, vous allez maintenant
commencer à configurer les scripts qui vont automatiser la mise en place de la
connexion.</P>

<P>La section 
<A HREF="#automatiser">Automatiser votre connexion - Créer  les scripts de connexion</A> couvre la configuration des fichiers nécessaires,
et la mise en place des scripts et du processus de login avec le serveur PPP,
ainsi que des détails complets sur <CODE>chat</CODE>.</P>

<P>Cette section traite des scripts d'authentification du nom utilisateur/mot
de passe ainsi que des scripts d'authentification pour les serveurs PAP/CHAP.</P>

<H2><A NAME="ss6.11">6.11 Terminer la connexion</A>
</H2>

<P>Une fois que votre connexion est activée et fonctionne, vous devez pouvoir
désactiver la liaison.</P>

<P>Consultez la section 
<A HREF="#off">Terminer une connexion PPP</A>.</P>

<H2><A NAME="ss6.12">6.12 Si vous avez des problèmes</A>
</H2>

<P>De nombreuses personnes ont des problèmes pour faire fonctionner PPP 
directement. Les différences entre les serveurs PPP et la façon dont il faut 
configurer la connexion sont énormes. De plus, PPP a de nombreuses options -
et certaines combinaisons d'entre elles ne fonctionnent absolument pas 
ensemble.</P>

<P>En plus des problèmes de journalisation et de démarrage du service PPP, il y a 
des problèmes liés aux modems et aux lignes de téléphones qui s'ajoutent !</P>

<P>La section 
<A HREF="#problemes">Résoudre les problèmes</A> fournit
des informations de base au sujet des erreurs classiques, et la façon de les
isoler et de les corriger.</P>

<P>Elle <B>n'est toutefois pas</B> destinée à offrir plus que les informations de 
base. Al Longyear maintient la PPP-FAQ qui contient bien plus d'informations à 
ce sujet !</P>

<H2><A NAME="ss6.13">6.13 Une fois que la connexion est lancée</A>
</H2>

<P>Une fois que la liaison PPP est opérationnelle (spécifiquement, une fois que les
trames IP fonctionnent), <CODE>pppd</CODE> peut lancer automatiquement
(comme utilisateur <CODE>root</CODE>) un script pour accomplir n'importe quelle 
fonction qu'un script peut accomplir.</P>

<P>La section 
<A HREF="#ip-up">Une fois que la connexion est lancée</A>
fournit des informations sur le script <CODE>/etc/ppp/ip-up</CODE>, les paramètres
que PPP lui envoie et comment l'utiliser pour récupérer votre courrier
électronique de votre compte de votre fournisseur d'accès, ou envoyer
les messages en attente de transmission sur votre machine.</P>

<H2><A NAME="ss6.14">6.14 Problèmes avec les services IP standards et l'adresse IP dynamique de la liaison PPP.</A>
</H2>

<P>Comme cela est mentionné dans l'introduction, les adresses IP dynamiques 
affectent la capacité de votre PC Linux à agir comme un serveur sur Internet.</P>

<P>La section 
<A HREF="#dynamic-serveur">Problèmes avec les services IP  standard et l'adresse IP dynamique de la liaison PPP</A> fournit des informations
sur les (principaux) services affectés et ce que vous pouvez faire (si c'est 
possible) pour contourner cela.</P>

<H2><A NAME="Configuration du noyau"></A> <A NAME="s7">7. Configurer votre noyau Linux </A></H2>

<P>Pour utiliser PPP, votre noyau Linux doit être compilé avec le support PPP.
Récupérez le code source de votre noyau Linux si vous ne l'avez pas encore -
il se situe dans <CODE>/usr/src/linux</CODE> dans un système de fichiers Linux
standard.</P>

<P>Vérifiez ce répertoire - de nombreuses distributions installent les sources
(fichiers et répertoires) pendant leur processus d'installation.</P>

<P>Au démarrage, votre noyau écrit une grande quantitée d'informations. Parmi
elles, est indiqué si le noyau contient le support PPP.
Pour afficher ces informations, regardez votre fichier syslog, ou utilisez
<CODE>dmesg | less</CODE> pour afficher ces informations à l'écran. Si votre noyau 
contient le support PPP, vous verrez quelques lignes du genre</P>
<P>
<HR>
<PRE>
PPP Dynamic channel allocation code copyright 1995 Caldera, Inc.
PPP line discipline registered.
</PRE>
<HR>
</P>

<P>(pour les noyau Linux version 2.0.x)</P>

<P>Les sources du noyau Linux sont disponibles par ftp à <CODE>sunsite.unc.edu</CODE> ou
ses nombreux miroirs, en particulier <CODE>ftp.lip6.fr</CODE>.</P>

<H2><A NAME="ss7.1">7.1 Installer les sources du noyau</A>
</H2>

<P>La suite regroupe de brèves instructions pour obtenir et installer les sources
du noyau Linux. Des informations complètes sont disponibles a  
<A HREF="http://sunsite.unc.edu/mdw/HOWTO/Kernel-HOWTO.html">The Linux Kernel HOWTO</A>.</P>

<P>Pour installer et compiler le noyau Linux vous devez être <CODE>root</CODE>.</P>
<P>
<OL>
<LI>Changer de répertoire vers <CODE>/usr/src/</CODE> <BR>
<CODE>cd /usr/src/</CODE></LI>
<LI>Vérifier dans <CODE>/usr/src/linux</CODE> pour voir si les sources sont
déjà installées.</LI>
<LI>Si vous n'avez pas les sources, récupérez les à 
<A HREF="ftp://sunsite.unc.edu/pub/Linux/kernel/v2.0">Linux kernel source directory</A> ou sur un miroir plus proche comme <CODE>ftp.lip6.fr</CODE>.<BR>
Si vous cherchez une version plus ancienne du noyau (comme la 1.2.X),
elles sont conservées dans  
<A HREF="ftp://sunsite.unc.edu/pub/Linux/kernel/old">Old Linux kernel source directory</A>. </LI>
<LI>Choisissez le noyau approprié - généralement le plus récent
disponible est le meilleur. Le récupérer et mettre le fichier tar dans 
<CODE>/usr/src</CODE>.<BR>
<B>Remarque</B>: un fichier 'tar' est une archive - parfois compressée (comme le
sont les fichiers tar des sources du noyau Linux) il contient de nombreux
fichiers répartis dans plusieurs répertoires. C'est l'équivalent Linux des
fichiers multi-répertoires sous MS-DOS.
</LI>
<LI>Si vous avez déjà les sources de Linux installées, mais que vous voulez
les mettre à jour, il faut effacer les anciens fichiers. Utiliser la
commande <BR>
<CODE>rm -rf /usr/src/linux</CODE></LI>
<LI>Maintenant décompresser et extraire les sources avec la commande<BR>
<CODE>tar xzf linux-2.0.XX.tar.gz</CODE></LI>
<LI>Maintenant, <CODE>cd /usr/usr/linux</CODE> et lire le fichier README. Il
contient une excellente explication de la façon de faire pour configurer et
compiler un nouveau noyau. Lisez ce fichier (c'est une bonne idée de 
l'imprimer pour en garder une copie sous la main quand vous compilerez votre
noyau jusqu'à ce que vous l'ayez fait suffisamment pour vous débrouiller
tout seul).</LI>
</OL>
</P>

<H2><A NAME="ss7.2">7.2 Connaître votre matériel</A>
</H2>

<P>Vous <B>DEVEZ</B> savoir quelles cartes/périphériques vous avez dans votre PC
si vous commencer à recompiler votre noyau !!! Pour certains périphériques
(comme les cartes sons) vous devez également connaitre quelques paramètres
(comme les IRQ et les adresse I/O et des choses du genre).</P>

<H2><A NAME="ss7.3">7.3 Compilation du noyau - le noyau Linux 1.2.13</A>
</H2>

<P>Pour commencer le processus de configuration, suivre les instructions du
fichier README pour installer les sources correctement. Vous lancez le
processus de configuration du noyau avec</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
make config
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Pour utiliser PPP, vous devez configurer le noyau pour inclure le support PPP
(PPP a besoin DE <CODE>pppd</CODE> ET DU support de PPP dans le noyau).</P>
<P>
<HR>
<PRE>
  PPP (point-to-point) support (CONFIG_PPP) [n] y
</PRE>
<HR>
</P>

<P>Répondre aux autres questions du <CODE>make config</CODE> en accord avec le matériel de
votre PC et les caractéristiques que vous souhaitez pour votre système 
d'exploitation Linux. Continuer ensuite à suivre les instructions de
compilation et d'installation du <CODE>README</CODE> pour votre nouveau noyau.</P>

<P>Le noyau 1.2.13 créait seulement 4 périphériques PPP. Pour les cartes séries
multiports, vous devez éditer les sources du noyau PPP pour avoir plus de 
ports. (Voir le fichier <CODE>README.Linux</CODE> accompagnant la distribution de 
PPP-2.1.2 pour des détails complets des éditions simples que vous devez
faire).</P>

<P>Remarque : la configuration du noyau 1.2.13 ne permet pas de revenir en
arrière - si vous faites une erreur en répondant à une des questions dans
le <CODE>make config</CODE> quitter avec CTRL-C et recommencer.</P>

<H2><A NAME="ss7.4">7.4 Compilation du noyau Linux 1.3.x et 2.0.x</A>
</H2>

<P>Pour Linux 1.3.x et 2.0.x, vous pouvez utiliser le même processus que pour 
Linux 1.2.13. De même, suivez les instructions du fichier <CODE>README</CODE> pour 
installer les sources correctement. Vous lancez la configuration du noyau avec</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
make config
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Cependant, vous pouvez aussi utiliser 
<BLOCKQUOTE><CODE>
<PRE>
make menuconfig
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Qui fournit un système de configuration avec une aide en ligne et vous 
pouvez avancer et reculer dans la configuration.</P>

<P>Il y a aussi l'interface de configuration sous X-Window chaudement recommandée
<BLOCKQUOTE><CODE>
<PRE>
make xconfig
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Vous pouvez compiler le support PPP directement dans votre noyau ou sous la 
forme d'un module chargeable dynamiquement.</P>

<P>Si vous utilisez PPP occasionnellement, alors compiler le support PPP en 
module chargeable est recommandé. Avec <CODE>kerneld</CODE>, votre noyau chargera
automatiquement le(s) module(s) nécessaires pour fournir le support PPP
quand vous lancerez une liaison PPP. Cela permet d'économiser une partie
de l'espace mémoire : le noyau ne peut être swappé, alors que les modules
chargeables sont automatiquement enlevés si ils ne sont pas utilisés.</P>

<P>Pour cela, vous devez activer le support des modules chargeables :
<HR>
<PRE>
        Enable loadable module support (CONFIG_MODULES) [Y/n/?] y
</PRE>
<HR>
</P>
<P>Pour ajouter le support PPP à votre noyau, répondre à la question suivante :
<HR>
<PRE>
        PPP (point-to-point) support (CONFIG_PPP) [M/n/y/?]
</PRE>
<HR>
</P>

<P>Pour un module chargeable, répondre <B>M</B>, sinon pour le compiler directement
dans le noyau, répondre <B>Y</B>.</P>

<P>A la différence du 1.2.13, le noyau 2.0.x crée les périphériques PPP au vol et
selon les besoins, et il n'y a absolument pas besoin de bricoler le source
pour augmenter le nombre de périphériques PPP.</P>

<H2><A NAME="ss7.5">7.5 Remarque sur PPP-2.2 et <CODE>/proc/net/dev</CODE></A>
</H2>

<P>Si vous utilisez PPP-2.2, vous trouverez qu'un problème de la création
des périphériques PPP 'au vol' est qu'aucun périphérique n'est trouvé dans le
fichier <CODE>/proc/net</CODE> tant qu'un périphérique n'est pas créé avec le
lancement de <CODE>pppd</CODE> :</P>
<P>
<HR>
<PRE>
[hartr@archenland hartr]$ cat /proc/net/dev
Inter-|   Receive                  |  Transmit
 face |packets errs drop fifo frame|packets errs drop fifo colls carrier
    lo:  92792    0    0    0    0    92792    0    0    0     0    0
  eth0: 621737   13   13    0   23   501621    0    0    0  1309    0
</PRE>
<HR>
</P>

<P>Une fois que vous avez un (ou plus) services ppp lancés, vous verrez
des entrées comme celles-ci (sur un serveur PPP) :</P>
<P>
<HR>
<PRE>
[root@kepler /root]# cat /proc/net/dev
Inter-|   Receive                  |  Transmit
 face |packets errs drop fifo frame|packets errs drop fifo colls carrier
    lo: 428021    0    0    0    0   428021    0    0    0     0    0
  eth0:4788257  648  648  319  650  1423836    0    0    0  4623    5
  ppp0:   2103    3    3    0    0     2017    0    0    0     0    0
  ppp1:  10008    0    0    0    0     8782    0    0    0     0    0
  ppp2:    305    0    0    0    0      297    0    0    0     0    0
  ppp3:   6720    7    7    0    0     7498    0    0    0     0    0
  ppp4: 118231  725  725    0    0   117791    0    0    0     0    0
  ppp5:  38915    5    5    0    0    28309    0    0    0     0    0
</PRE>
<HR>
</P>

<H2><A NAME="ss7.6">7.6 Considérations générales sur la configuration du noyau pour PPP</A>
</H2>

<P>Si vous configurez votre PC Linux comme un serveur PPP, vous devez
activer le support IP Forwarding. Il est également nécessaire si vous voulez
utiliser Linux pour relier deux réseaux locaux entre eux ou un réseau local
à Internet.</P>

<P>Si vous reliez un réseau local à Internet (ou reliez deux réseaux entre eux),
vous devez être concernés par la sécurité. Ajouter le support pour IP
firewall dans votre noyau est alors sans doute obligatoire !</P>

<P>Vous aurez également besoin, d'utiliser IP Masquerade pour
relier un réseau local qui utilise les adresses IP non connectées mentionnées
plus haut.</P>

<P>Pour activer IP Masquerade et IP firewalling, vous <B>DEVEZ</B> répondre Oui
à la première question de <CODE>make config</CODE> :
<HR>
<PRE>
Prompt for developement and/or incomplete code/drivers (CONFIG_EXPERIMENTAL)?
</PRE>
<HR>
</P>

<P>Bien que cela puisse sembler un peu bizarre aux nouveaux utilisateurs, je 
confirme que de nombreux utilisateurs utilisent les possibilités de IP 
Masquerading et de IP firewalling du noyau Linux 2.0.X sans problèmes.</P>

<P>Une fois que vous avez installé et booté votre nouveau noyau, vous pouvez 
commencer à configurer et à tester votre liaison PPP.</P>

<H2><A NAME="Info Serveur"></A> <A NAME="s8">8. Fournir les informations dont vous avez besoin pour votre serveur PPP</A></H2>

<P>Avant d'établir la connexion PPP avec un serveur, vous devez obtenir les
informations suivantes (de l'administrateur système/support utilisateur/
personnes gérant le serveur PPP) :
<UL>
<LI>Le numéro de téléphone à composer pour le service<BR>
Si vous êtes derrière un standard, vous avez aussi besoin du numéro qui vous
permet de sortir à l'extérieur du standard - c'est généralement le chiffre zéro
(0) ou neuf(9).
</LI>
<LI>Est-ce que le serveur utilise des adresse IP DYNAMIQUES ou STATIQUES ?<BR>
Si le serveur utilise des adresses IP STATIQUES, vous devez savoir quelle
adresse IP utiliser à la fin de la connexion PPP. Si votre FAI
vous fournit une adresse de sous-réseau valide, vous devez connaître
le masque de sous-réseau à utiliser (netmask).<BR>

La plupart des FAI utilisent des adresses IP DYNAMIQUES. Comme cela est 
mentionné plus haut, cela a des impliquations sur les services que vous pouvez 
utiliser.<BR>

Cependant, même si vous utilisez des adresses IP STATIQUES, la plupart des 
serveurs PPP ne laisseront jamais (pour des raisons de sécurité) les clients
spécifier leur adresse IP car c'est un risque pour la sécurité. Vous <B>devez</B>
connaître aussi cette information !
</LI>
<LI>Quel sont les adresses IP des serveur de noms des fournisseurs d'accès ?<BR>
Il doit y en avoir au moins deux, même si un seul suffit.<BR>

Il peut y avoir un problème à ce niveau. Le service PPP de MS Windows 95
permet que l'adresse DNS soit transmise au client dans le processus de
connexion. Ainsi, votre fournisseur d'accès pourrait vous répondre que
vous n'avez pas besoin de l'adresse IP du serveur DNS. <BR>

Avec Linux, vous <B>devez</B> connaître l'adresse d'au moins un DNS. 
L'implémentation PPP de Linux ne permet pas de configurer dynamiquement
à la connexion l'adresse du serveur DNS - et ne pourra certainement jamais.<BR>

<B>Remarque</B>: bien que Linux (comme client PPP) ne peut pas recevoir d'adresse
DNS du serveur, il peut, en tant que serveur, envoyer l'information au client
en utilisant l'option <CODE>dns-addr</CODE> de pppd.
</LI>
<LI>Est-ce-que le serveur a besoin d'utiliser PAP/CHAP ? <BR>
Si tel est le cas, vous devez connaître le id et le secret que vous avez 
pour vous connecter. (c'est probablement votre nom utilisateur et le mot de
passe de votre fournisseur d'accès).
</LI>
<LI>Le serveur est-il un système Microsoft Windows NT et, dans ce cas,
utilise-t-il le système PAP/CHAP ? <BR>
De nombreux fournisseurs d'accès semblent utiliser MS-Windows NT de cette façon
pour améliorer la sécurité.</LI>
</UL>
</P>

<P>Attention à l'information suivante - elle risque d'être utile !</P>

<H2><A NAME="Modem"></A> <A NAME="s9">9. Configurer votre modem et votre port série </A> </H2>

<P>Vous devez vous assurer que votre modem est correctement configuré et que
vous savez sur quel port série il est branché.</P>

<P><B>Se souvenir que</B> :
<UL>
<LI>DOS COM1: = Linux /dev/cua0 (et /dev/ttyS0)</LI>
<LI>DOS COM2: = Linux /dev/cua1 (et /dev/ttyS1)<BR>
etc.</LI>
</UL>
</P>

<P>Il est également bien de se souvenir que si vous avez 4 ports séries, la 
configuration standard d'un PC est d'avoir COM1 et COM3 partageant IRQ4 et 
COM2 et COM4 partageant IRQ3.</P>

<P>Si vous avez des périphériques sur vos ports séries qui partagent une IRQ avec 
votre modem vous allez avoir des problèmes. Vous devez vous assurer que le
port série de votre modem est sur sa propre et unique IRQ. De nombreuses 
cartes séries modernes (et les ports séries des cartes mères de bonne qualité)
permettent de changer les IRQ des ports série.</P>

<P>Si vous utilisez le noyau Linux 2, vous pouvez afficher des IRQ actuellement 
utilisés avec <CODE>cat /proc/interrupts</CODE>, qui produira une sortie 
ressemblant à :
<HR>
<PRE>
 0:    6766283   timer
 1:      91545   keyboard
 2:          0   cascade
 4:     156944 + serial
 7:     101764   WD8013
10:     134365 + BusLogic BT-958
13:          1   math error
15:    3671702 + serial
</PRE>
<HR>
</P>

<P>Cela montre que le le port série en IRQ4 (une souris) et le port série en IRQ15
(un modem permanent basé sur PPP pour une liaison Internet). (Il y a également
un port série sur le port COM2, IRQ3 et COM4 est dans l'IRQ14, mais comme ils
ne sont pas utilisés, ils ne sont pas affichés).</P>

<P>Avertissement - vous devez vous rendre compte de ce que vous faites lorsque 
vous voulez jouer avec
vos IRQ ! Non seulement, vous devez ouvrir votre ordinateur, retirer vos cartes
et jouer avec les jumpers, mais vous devez savoir ce qu'il y a sur chaque IRQ.
Dans mon cas, j'ai un PC totalement SCSI, et j'ai donc désactivé les
interfaces IDE de la carte-mère qui utilisent normalement les IRQ14 et 15 !</P>

<P>Je tiens également à préciser que si votre PC utilise un autre système 
d'exploitation, changer les IRQ pourrait bien signifier que votre OS ne bootera
plus correctement, ou plus du tout !</P>

<P>Si vous déplacez vos ports séries vers des IRQ non-standard, vous devez
spécifier à Linux quel IRQ utilise chaque port. <CODE>setserial</CODE> permet de 
le faire, et de préférence lors du processus de lancement dans <CODE>rc.local</CODE>
ou <CODE>rc.serial</CODE> qui est appelé dans <CODE>rc.local</CODE> ou comme une partie de
l'initialisation SysV system. Pour la machine présentée ci-dessus, les 
commandes utilisées sont
<HR>
<PRE>
/bin/setserial -b /dev/ttyS2 IRQ 11
/bin/setserial -b /dev/ttyS3 IRQ 15
</PRE>
<HR>
</P>

<P>Toutefois, si vous utilisez le module série chargé dynamiquement au besoin avec
le processus <CODE>kerneld</CODE>, vous ne pouvez pas définir et perdre les IRQ à chaque
redémarrage. Si le module série est effacé, Linux perds alors les
configurations spéciales.</P>

<P>Donc, si vous chargez le module série à la demande, vous devez reconfigurer
les IRQ à chaque fois qu'il est chargé.</P>

<H2><A NAME="ss9.1">9.1 Remarque au sujet des ports séries et des capacité de vitesse</A>
</H2>

<P>Si vous utilisez un modem haut débit (externe) (14.400 Bits par seconde ou 
plus), votre port série doit être capable de suivre le débit qu'un tel modem 
est capable de produire, en particulier si le modem compresse les données.</P>

<P> Cela demande que votre port série utilise un UART(Universal Asynchronous
Receiver Transmitter) moderne comme un 16550(A). Si vous utilisez une
vieille machine (ou une vieille carte série), il est tout à fait possible que
votre port série ait seulement un UART 8250, ce qui amènera des problèmes
considérables avec un modem haute vitesse.</P>

<P>Utiliser la commande
<BLOCKQUOTE><CODE>
<PRE>
setserial -a /dev/ttySx
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Pour que Linux vous affiche le type d'UART que vous avez. Si vous n'avez pas un
UART de type 16550, acheter une nouvelle carte série (disponible pour moins de
300 F). Quand vous acheterez une nouvelle carte, assurez vous que vous pouvez
changer les IRQ !</P>

<P>Remarque : les premières versions des puces UART 16550 avaient une erreur. Elle
a été rapidement découverte et une mise à jour de la puce est sortie - l'UART
16550A. Un nombre relativement faible de puces erronées ont cependant été mises 
en circulation. Ça serait de la malchance que d'un récupérer une, en particulier
sur certaines cartes d'occasion, mais il suffit de chercher la réponse qui 
s'appelle 16550A.</P>

<H2><A NAME="ss9.2">9.2 Noms des ports série</A>
</H2>

<P>Historiquement, Linux utilise les périphériques <CODE>cuaX</CODE> pour les appels 
sortants et <CODE>ttySx</CODE> pour les appels entrants.</P>

<P>Le code du noyau a eu besoin de changer cela dans la version 2.0.x du noyau,
et vous devez maintenant utiliser <CODE>ttySx</CODE> pour les appels entrants et 
sortants. Cela semble annoncer que les noms de périphériques <CODE>cuaX</CODE>
devraient disparaître dans les futures versions du noyau.</P>

<H2><A NAME="ss9.3">9.3 Configuration de votre modem</A>
</H2>

<P>Vous devez configurer votre modem correctement pour PPP - pour cela,
<B>LISEZ LE MANUEL DE VOTRE MODEM</B> ! La plupart des modems ont <B>une 
configuration par défaut en usine</B> avec les options requises par PPP.
La configuration minimale spécifie :
<UL>
<LI>Contrôle de flux matériel (RTS/CTS) (<CODE>&amp;</CODE>K3 sur les modems 
Hayes)</LI>
</UL>
</P>
<P>Les autres paramètres (en commandes Hayes standard) que vous devez vérifier 
sont :
<UL>
<LI>La commande E1 Echo ON (nécessaire pour que <CODE>chat</CODE> fonctionne)</LI>
<LI>S0=0 Auto Answer OFF (à moins que vous ne vouliez que votre modem réponde
au téléphone)</LI>
<LI><CODE>&amp;</CODE>C1 Carrier Detect ON seulement après la connexion</LI>
<LI><CODE>&amp;</CODE>S0 Data Set Ready (DSR) toujours ON</LI>
<LI>(variable) Data Terminal Ready</LI>
</UL>
</P>

<P>Un site fournit la configuration des modems pour une variété de fabricants
et de modèles de modems croissante à 
<A HREF="http://www.in.net/info/modems/index.html">Modem setup information</A>
qui devrait vous simplifier la configuration.</P>

<P>Il est aussi intéressant de vérifier comment fonctionne l'interface série entre
votre ordinateur et votre modem. La plupart des modems modernes vous 
permettent d'utiliser l'interface série à une vitesse FIXE permettant à 
l'interface avec la ligne téléphonique de changer de vitesse pour atteindre
la plus haute vitesse que les deux modems peuvent supporter.</P>

<P>Cela s'appelle l'opération de division de la vitesse. Si votre modem le 
supporte, bloquer l'interface série du modem à la vitesse disponible la
plus rapide (d'habitude 115.200 bauds mais parfois 38.400 pour les modems
14.400).</P>

<P>Utiliser les outils de communication (c.-à-d. <CODE>minicom</CODE> ou <CODE>seyon</CODE>) pour 
accéder à la configuration de votre modem, et l'adapter à ce qui est nécessaire 
à PPP. De nombreux modems renvoient leurs réglages courants après la commande
AT<CODE>&amp;</CODE>V, mais vous devez consulter le manuel de votre modem.</P>

<P>Si vous avez complètement modifié les réglages, vous pouvez repartir sur des
bases saines (généralement) en envoyant AT<CODE>&amp;</CODE>F - ça retourne aux
réglages usine. (Pour la majorité des modems que j'ai rencontré, les réglages
usine on tout ce qu'il faut pour faire du PPP - mais vous devez vérifier).</P>

<P>Un fois que vous avez la commande nécessaire pour configurer votre modem, 
écrivez-là.
Vous devez maintenant prendre une décision : vous pouvez stocker ces paramètres
dans la mémoire non-volatile de votre modem, comme cela vous pourrez la 
relancer en envoyant une commande AT appropriée. Alternativement, vous pouvez
passer le paramétrage correct à votre modem lors du processus de connexion de
PPP.</P>

<P>Si vous utilisez uniquement votre modem sous Linux pour appeler votre 
FAI ou un serveur d'entreprise, la manière la plus simple est
de sauver la configuration de votre modem dans la mémoire non-volatile.</P>

<P>D'un autre coté, si votre modem est utilisé par d'autres applications et
systèmes d'exploitation, il est plus sûr de passer ces informations au modem
à chaque appel que vous passez, comme cela, c'est sûr que le modem sera bien
configuré lors de l'appel. (Cela a aussi l'avantage de conserver la
ligne de configuration du modem au cas où le modem perdrait le contenu de sa
NV-RAM, ce qui peut parfois arriver).</P>

<H2><A NAME="ss9.4">9.4 Remarque sur le contrôle de flux série</A>
</H2>

<P>Lorsque les données transitent sur les lignes de communication série, il
peut arriver que les données arrivent plus vite que l'ordinateur ne peut les
traiter (l'ordinateur peut être occupé à faire autre chose - n'oubliez pas
que Linux est un système Multi-tâches Multi-utilisateurs). Pour s'assurer que
des données ne se sont pas perdues (les données n'arrivent pas dans le tampon
d'entrée pour se perdre ensuite), certaines méthodes de contrôles sont
nécessaires.</P>

<P>Il y a deux façons de faire sur des lignes séries :
<UL>
<LI>Utiliser des signaux matériels (Clear To Send/Request To Send CTS/RTS)</LI>
<LI>Utiliser des signaux logiciel (control S et control Q, aussi appelés XON/XOFF).</LI>
</UL>
</P>

<P>Bien que le dernier soit correct pour les liaisons vers des terminaux(texte),
les données sur une liaison PPP utilisent les 8 bits - et il est fort probable
que quelque part dans les données, un octet se traduis par un control S ou 
un control Q. Donc, si un modem est configuré pour utiliser le contrôle de 
flux, les choses vont rapidement s'envenimer !</P>

<P>Pour les liaisons à haut débit utilisant PPP (avec l'utilisation des 8 bits
de données) le contrôle de flux matériel est vital, et c'est la raison pour
laquelle vous devez utiliser le contrôle de flux matériel.</P>

<H2><A NAME="ss9.5">9.5 Tester votre modem pour composer un numéro</A>
</H2>

<P>Maintenant que vous en avez terminé avec la configuration du modem et du port
série, il serait utile de vérifier si cette configuration marche
vraiment en appelant votre fournisseur d'accès et voir si vous pouvez vous
connecter.</P>

<P>En utilisant le paquetage du terminal de communication (tel que <CODE>minicom</CODE>), 
la commande d'initialisation de votre modem pour PPP, appelez le
serveur PPP sur lequel vous voulez vous connecter pour une session PPP.</P>

<P>(Remarque : à ce niveau, nous <B>n'essayerons pas</B> d'établir la connexion PPP
- mais juste d'être sûr que nous pouvons composer un numéro et ainsi
trouver <B>exactement</B> ce que le serveur nous envoie pour se connecter et
lancer PPP).</P>

<P>Pendant le processus, soit vous capturez (dans un fichier) la totalité du
processus de login soit vous notez attentivement (<EM>très attentivement</EM>)
<B>exactement</B> ce que le serveur envoie pour savoir quand est le moment 
d'entrer votre nom utilisateur et votre mot de passe (et quelques autres
commandes nécessaires pour établir la connexion PPP).</P>

<P>Si votre serveur utilise PAP, vous ne verrez pas de message de login, mais
vous verrez à la place la (représentation texte) du protocole de contrôle de
liaison (une suite incohérente de caractères) s'afficher sur votre écran.</P>

<P>Quelques mots d'avertissements :</P>
<P>
<UL>
<LI>certains serveurs sont relativement intelligents : vous pouvez vous
connecter en utilisant un nom utilisateur /mot de passe basé sur du texte OU
en utilisant PAP. Ainsi, si votre fournisseur d'accès ou votre serveur
d'entreprise utilise PAP mais n'affiche pas le message directement, cela ne
signifie pas que vous avez fait une erreur.
</LI>
<LI>certains serveurs ont besoin que vous entriez du texte avant
de lancer <EM>ensuite</EM> la séquence PAP standard.
</LI>
<LI>Certains serveurs PPP sont passifs - il attendent et n'envoient rien
tant que le client avec lequel il dialogue ne lui envoie un paquet LCP valide.
Si le serveur PPP sur lequel vous vous connectez fonctionne en mode passif,
vous ne verrez jamais de message !
</LI>
<LI>Certains serveurs ne lancent pas PPP tant que vous n'avez pas pressé 
<CODE>ENTREE</CODE> - essayez donc cela si vous êtes connecté et ne voyez pas de 
message !</LI>
</UL>
</P>

<P>Il est intéressant de dialoguer au moins deux fois - certains serveurs 
changent leur message d'accueil (c.-à-d. avec le temps !) chaque fois que vous
vous connectez. Les deux messages critiques que votre machine Linux doit
pouvoir identifier chaque fois que vous vous vous connectez sont :
<UL>
<LI>le message qui vous demande d'entrer votre nom utilisateur ;</LI>
<LI>le message qui vous demande d'entrer votre mot de passe ;</LI>
</UL>
</P>

<P>Si vous avez tapé une commande pour lancer PPP sur le serveur, vous devez aussi
rechercher le message que le serveur vous envoie une fois que vous êtes 
connecté pour vous informer que vous pouvez entrer la commande pour lancer ppp.</P>

<P>Si votre serveur lance automatiquement PPP, une fois que vous êtes connecté,
vous allez voir des caractères s'afficher sur votre écran - c'est le serveur
PPP qui envoie à votre machine les informations pour démarrer et configurer 
la connexion PPP.</P>

<P>Ça doit donner quelque chose comme ceci :</P>
<P>
<HR>
<PRE>
</PRE>
<HR>
</P>

<P>(et ça ne s'arrête pas !)</P>

<P>Sur certains systèmes, PPP doit être explicitement lancé sur le serveur. Cela
vient généralement du fait que le serveur a été configuré pour permettre
aux connexions PPP et aux connexions Shell a utiliser les mêmes paires 
nom utilisateur/mot de passe. Si c'est le cas, envoyez cette commande lorsque
vous êtes connecté. Une nouvelle fois vous verrez des caractères que le serveur
envoie à la fin du lancement de la connexion PPP.</P>

<P>Si vous ne voyez pas directement après la connexion (et le processus de 
connexion et le lancement du serveur PPP si besoin), tapez <B>Entrée</B> pour 
voir si le serveur PPP démarre...</P>

<P>A ce niveau, vous pouvez raccrocher votre modem (généralement, taper 
<CODE>+++</CODE> rapidement et envoyer la commande ATHO une fois que votre modem
vous a répondu OK).</P>

<P>Si vous n'arrivez pas à faire fontionner votre modem, lisez le manuel du
modem, les pages de manuel des programmes de communication, et le Serial 
HOWTO ! Une fois que vous aurez fait tout cela reprenez l'étape précédente.</P>


<H2><A NAME="DNS"></A> <A NAME="s10">10. Configurer la résolution de nom vers l'adresse (DNS) </A></H2>

<P>Alors que les humains aiment donner des noms aux choses, les ordinateurs 
préfèrent les nombres. Sur un réseau TCP/IP (comme Internet), nous appelons 
les machines avec un nom particulier et chaque machine se trouve dans un 
<CODE>&quot;</CODE>domaine<CODE>&quot;</CODE> particulier. Par exemple, ma station
de travail Linux s'appelle <B>archenland</B> et se trouve dans le domaine
<B>interweft.com.au</B>. Son adresse lisible par un humain est donc 
archenland.interweft.com.au (qui s'appelle le FQDN - nom de domaine 
totalement qualifié).</P>

<P>Cependant, pour que cette machine soit trouvée par les autres ordinateurs sur
Internet, elle est réellement connue par son adresse IP lorsque les 
ordinateurs communiquent à travers Internet.</P>

<P>Traduire (résoudre) les noms de machines (et de domaine) en nombres réellement 
utilisés sur Internet est le travail de machines qui offrent le DNS.</P>

<P>Ce qui se passe en fait :</P>
<P>
<UL>
<LI>Votre machine à besoin de savoir l'adresse IP d'un ordinateur 
particulier. L'application qui a besoin de cette information interroge le 
resolveur de votre PC Linux pour obtenir cette information;
</LI>
<LI>Le résolveur interroge le fichier local <CODE>/etc/hosts</CODE>
et/ou les serveurs de noms des domaines qu'il connaît (le comportement
exact du résolveur est déterminé dans <CODE>/etc/hosts.conf</CODE>);
</LI>
<LI>si la réponse se trouve dans le fichier <CODE>hosts</CODE>, la réponse est 
renvoyée;
</LI>
<LI>si un serveur de nom est spécifié, votre PC interroge alors cette
machine
</LI>
<LI>si la machine DNS connaît déjà l'adresse IP du nom demandé, elle le 
retourne. Si elle ne le connaît pas, elle interroge un autre serveur de noms
sur Internet pour trouver l'information. Le serveur de noms redescend alors les
informations au résolveur qui les a demandé - qui les envoie à l'application 
qui l'a interrogé.</LI>
</UL>
</P>

<P>Quand vous utilisez une connexion PPP, vous devez indiquer à votre machine Linux
où elle peut récupérer l'adresse IP à partir du nom (résolution des adresses),
comme cela <B>vous pourrez utiliser le nom des machines</B> mais votre 
ordinateur pourra traduire ces derniers vers les adresses IP dont il a 
besoin pour travailler.</P>

<P>Une solution est de rentrer tous les hôtes avec qui vous voulez dialoguer dans
le fichier <CODE>/etc/hosts</CODE> (ce qui est en réalité totalement impossible
si vous êtes connecté à Internet); une autre façon est d'utiliser les
adresses IP plutôt que les noms (une tâche de mémorisation impossible sauf pour
les petits réseaux).</P>

<P>La meilleure façon est de configurer Linux pour qu'il connaisse ou récupère
l'information de conversion des noms en adresses - automatiquement. Ce service
est fourni par le système DNS. La seule chose à faire est d'entrer l'adresse IP
des serveurs de noms dans le fichier /etc/resolv.conf.</P>

<H2><A NAME="ss10.1">10.1 Le fichier <CODE>/etc/resolv.conf</CODE></A>
</H2>

<P>Le support client de votre serveur PPP doit vous fournir deux adresses IP de
DNS (un seul est nécessaire - mais deux permettent une redondance en cas 
d'échec).</P>

<P>Comme c'est mentionné plus haut, Linux ne peut pas définir l'adresse IP de son
serveur de noms comme MS Windows 95 le fait. Ainsi, vous devez <B>insister</B>
(poliment) auprès de votre FAI pour qu'il vous fournisse cette
information !</P>

<P>Votre <CODE>/etc/resolv.conf</CODE> doit ressembler à quelque chose comme :</P>

<P>
<HR>
<PRE>
domain votre.nom.de.domaine
nameserver 10.25.0.1
nameserver 10.25.1.2
</PRE>
<HR>
</P>


<P> Éditer ce fichier (le créer si nécessaire) pour contenir les
informations que votre FAI vous a donné. Il doit avoir les droits et les
permissions comme suit :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
-rw-r--r--   1 root     root           73 Feb 19 01:46 /etc/resolv.conf
</PRE>
</CODE></BLOCKQUOTE>
</P>


<P>Si vous avez déjà configuré un <CODE>/etc/resolv.conf</CODE> car vous êtes sur un
réseau local, ajoutez simplement les adresses IP du serveur DNS PPP dans votre
fichier existant.</P>

<H2><A NAME="ss10.2">10.2 Le fichier <CODE>/etc/hosts.conf</CODE></A>
</H2>

<P>Vous devez également vérifier que votre fichier <CODE>/etc/hosts.conf</CODE> est
correctement configuré. Il doit ressembler à 
<HR>
<PRE>
order hosts,bind
multi on
</PRE>
<HR>
</P>

<P>Il indique au résolveur d'utiliser les informations du fichier host avant
d'envoyer les requêtes pour une résolution DNS.</P>

<H2><A NAME="root"></A> <A NAME="s11">11. Utiliser PPP et les privilèges <B>root</B> </A></H2>

<P>Puisque PPP à besoin de configurer les périphériques réseau, modifier les
tables de routage entre autres, il a besoin des privilèges <B>root</B>.</P>

<P>Si des utilisateurs autres que <B>root</B> doivent lancer des connexions PPP, le
programme <CODE>pppd</CODE> doit avoir l'uid <B>root</B> :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
-rwsr-xr-x   1 root     root        95225 Jul 11 00:27 /usr/sbin/pppd
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Si <CODE>/usr/sbin/pppd</CODE> n'est pas défini comme cela, alors <B>en étant 
root</B> taper la commande :</P>

<P>
<BLOCKQUOTE><CODE>
<PRE>
chmod u+s /usr/sbin/pppd
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Cela permet à <CODE>pppd</CODE> de fonctionner avec les privilèges <CODE>root</CODE> <B>même</B> i
si le programme est lancé par un utilisateur ordinaire. Ainsi <CODE>pppd</CODE> a
les bons privilèges pour configurer les interfaces réseau et les tables de 
routage.</P>

<P>Les programmes qui utilisent le uid root sont autant de trous de sécurité
potentiels et vous devez être extrêmement vigilant par rapport aux programmes
uid root. De nombreux programmes (comme <CODE>pppd</CODE>) ont été écrits minutieusement
pour minimiser le danger d'utiliser suit root, vous devez donc être tranquille
avec celui-ci (mais sans garanties totales).</P>

<P>Selon ce que vous voulez faire de votre système - particulièrement si vous
voulez qu'un utilisateur puisse initialiser une liaison PPP, vous devez
mettre vos scripts <CODE>ppp-on/off</CODE> lisibles et exécutables par tout le 
monde.   (c'est sans doute génial si vous êtes le SEUL utilisateur du PC).</P>

<P>Cependant, si vous NE voulez PAS que n'importe qui puisse lancer une 
connexion PPP (par exemple, votre enfant qui a un compte sur votre PC Linux
et que vous ne voulez pas qu'il se connecte à Internet sans votre
permission), vous devez faire un groupe PPP (en tant que <CODE>root</CODE>, éditer le 
fichier <CODE>/etc/group</CODE>) et :
<UL>
<LI>Rendre <CODE>pppd</CODE> 'suid root', possédé par l'utilisateur <B>root</B> et le 
groupe PPP, avec ces nouvelles permissions sur le fichier. Il doit ressembler à 
<BLOCKQUOTE><CODE>
<PRE>
-rwsr-x---   1 root     PPP        95225 Jul 11 00:27 /usr/sbin/pppd
</PRE>
</CODE></BLOCKQUOTE>

</LI>
<LI>Mettre les scripts <CODE>ppp-on/off</CODE> possédés par l'utilisateur 
<B>root</B> et le groupe <B>PPP</B>
</LI>
<LI>Rendre le script <CODE>ppp-on/off</CODE> lisible/exécutable par le groupe PPP
<BLOCKQUOTE><CODE>
<PRE>
  -rwxr-x---   1 root     PPP           587 Mar 14  1995 /usr/sbin/ppp-on
  -rwxr-x---   1 root     PPP           631 Mar 14  1995 /usr/sbin/ppp-off
</PRE>
</CODE></BLOCKQUOTE>

</LI>
<LI>Ajouter les utilisateurs qui utilisent PPP dans le groupe PPP dans 
<CODE>/etc/group</CODE></LI>
</UL>
</P>

<P>Même si vous faites cela, les utilisateurs normaux ne pourront pas fermer
la connexion avec un programme ! Utiliser <CODE>ppp-off</CODE> nécessite les 
privilèges <B>root</B>. Même si n'importe quel utilisateur peut éteindre le
modem (ou déconnecter la ligne téléphonique sur un modem interne).</P>

<P>Un alternative (et une meilleure méthode) de faire cela est d'utiliser le 
programme <CODE>sudo</CODE>, qui offre une meilleure sécurité et vous permettra de 
choisir quels utilisateurs (autorisés) pourrons activer/désactiver
la liaison en utilisant des scripts. Utiliser <CODE>sudo</CODE> permet aux utilisateurs
autorisés d'activer/désactiver la liaison PPP de façon propre et
sécurisée.</P>


<H2><A NAME="options"></A> <A NAME="s12">12. Configurer les fichiers de connexion de PPP </A></H2>

<P>Maintenant, vous devez être connecté en tant que <B>root</B> pour créer les
répertoires et éditer les fichiers nécessaires à la configuration de PPP, 
même si vous souhaitez que PPP soit utilisable par tous les utilisateurs.</P>

<P>PPP utilise un certain nombre de fichiers pour configurer les connexions.
Ceux-ci diffèrent dans leur nom et les chemins entre PPP 2.1.2 et 2.2.</P>

<P>Pour PPP 2.1.2 les fichiers sont :</P>
<P>
<HR>
<PRE>
/usr/sbin/pppd          # le programme PPP
/usr/sbin/ppp-on        # le script d'appel/connexion
/usr/sbin/ppp-off       # le script de déconnexion
/etc/ppp/options        # les options utilisées pour toutes le connexions
/etc/ppp/options.ttyXX  # les options spécifiques pour ce connecter sur ce port
</PRE>
<HR>
</P>

<P>Pour PPP 2.2. les fichiers sont :
<HR>
<PRE>
/usr/sbin/pppd                  # Le programme PPP
/etc/ppp/scripts/ppp-on         # le script d'appel connexion
/etc/ppp/scripts/ppp-on-dialer  # première partie du script d'appel
/etc/ppp/scripts/ppp-off        # le script chat réel
/etc/ppp/options                # options utilisées par pppd pour toutes les 
                                # connexions
/etc/ppp/options.ttyXX          # options spécifiques pour se connecter sur ce
                                # port
</PRE>
<HR>
</P>

<P>Je rappelle aux utilisateurs de la RedHat Linux que dans l'installation
standard de la Red Hat 4.X les scripts sont placés dans
<CODE>/usr/doc/ppp-2.2.0f-2/scripts</CODE>.</P>

<P>Dans votre répertoire <CODE>/etc</CODE>, il devrait y avoir un répertoire <B>ppp</B> :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
drwxrwxr-x   2 root     root         1024 Oct  9 11:01 ppp
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>S'il n'existe pas - le créer avec ces possessions et permissions.</P>

<P>Si le répertoire existe déjà, il devrait contenir un fichier d'options
modèle appelé <B>options.tpl</B>. Ce fichier est inclus plus bas au cas où
il n'existerait pas.</P>

<P>Imprimez-le il contient une explication de presque toutes les options de PPP
et c'est pratique de le lire en même temps que les pages de manuel de ppp).
Même si vous pouvez utiliser ce fichier comme base à votre 
<CODE>/etc/ppp/options</CODE>, il est sans doute mieux de créer votre propre
fichier d'options qui ne contiendra pas tous les commentaires du modèle -
il sera bien plus court, et plus facile à lire/maintenir.</P>

<P>Si vous avez une ligne série/modems multiple (c'est typiquement le cas des 
serveurs PPP), créer un fichier général <CODE>/etc/ppp/options</CODE>
contenant les options communes à tous les ports séries dans lequel vous
supportez la composition et la réception d'appels et un fichier de 
configuration individuel pour chaque ligne série sur laquelle vous établirez
la configuration individuelle nécessaire pour chaque port.</P>

<P>Ces fichiers d'options spécifiques aux ports sont appelés <CODE>options.ttyx1</CODE>,
<CODE>options.ttyx2</CODE> et ainsi de suite (ou x est la lettre appropriée pour 
votre port série).</P>

<P>Toutefois, pour une connexion simple, vous pouvez tranquillement utiliser le
fichier <CODE>/etc/ppp/options</CODE>. Vous pouvez aussi mettre toutes les options 
comme argument de la commande <CODE>pppd</CODE> elle-même.</P>

<P>Il est plus simple de maintenir une configuration qui utilise les fichiers
<CODE>/etc/ppp/options.ttySx</CODE>. Si vous utilisez PPP sur différents
sites, vous pouvez créer un fichier d'options pour chaque site dans
<CODE>/etc/ppp/options.site</CODE>, et ainsi spécifier le fichier d'options en
paramètre à la commande PPP lorsque vous vous connectez (en utilisant 
l'option <CODE>file option-file</CODE> de <CODE>pppd</CODE> dans la ligne de commande de 
<CODE>pppd</CODE>).</P>

<H2><A NAME="ss12.1">12.1 Le fichier options.tpl fourni</A>
</H2>

<P>Certaines distributions de PPP semblent avoir perdu le fichier options.tpl,
donc voici le fichier complet. Je suggère de NE PAS éditer ce fichier pour 
créer votre fichier(s) <CODE>/etc/ppp/options</CODE>. Copiez plutôt celui-ci
dans un nouveau fichier et éditez-le alors. Si vous vous trompez dans votre
édition, vous pourrez toujours revenir en arrière en recommençant sur
l'original.</P>
<P>
<HR>
<PRE>
# /etc/ppp/options -*- sh -*- fichiers d'options generales pour pppd
# cree le 13-Jul-1995 jmk
# autodaté: 01-Aug-1995
# autotime: 19:45
# adaptation francaise par Antoine Levavasseur levavass@efrei.fr

# Utilise l'executable ou la commande shell specifiee pour configurer la ligne
# serie. Ce script va en fait utiliser le programme "chat" pour appeler le
# modem et le debut de la liaison distante ppp.
#connect "echo Vous devez installer une commande connect."

# Lance l'executable ou la commande shell specifie, une fois que ppp a termine
# la liaison. Ce script va, par exemple, envoyer les commandes au modem pour le
# faire raccrocher si les signaux de controles matériels ne sont pas 
# disponibles.
#disconnect "chat -- \d+++\d\c OK ath0 OK"

# table de caractere async -- 32-bit hex; chacun des bit est un caractere qui
# doit etre echappe pour que pppd le recoive.  0x00000001 represente '\x01', 
# et 0x80000000 represente '\x1f'.
#asyncmap 0

# Demande a votre correspondant de s'authentifier avant de pouvoir envoyer ou
# recevoir des paquets reseaux
#auth

# Utilise le controle de flux materiel (i.e. RTS/CTS) pour controler le flux
# de donnees du port série
#crtscts

# Utilise le controle de flux logiciel (i.e. XON/XOFF) pour controler le flux
# de donnees du port serie.
#xonxoff
# Ajouter une route par defaut aux tables de routage systeme, pour utiliser
# votre correspondant comme gateway, lorsque la negociation ICP reussi. Cette
# entree est supprimee lorsque la connexion PPP se termine.
#defaultroute

# Specifie que certains caracteres doivent etre echapes sur la transmission
# (en fonction de la facon dont le client souhaite qu'ils soient echappes avec
# la table de controle async). Les caracteres qui sont echappes sont specifies
# comme une liste de nombres hexa separes par des guillemets. La plupart des
# caracteres peuvent etres specifies avec l'option escape, a moins que l'option 
# asyncmap soit activee puisque dans ce cas seuls les caracteres de controle
# peuvent etres specifies. Les caracteres qui ne peuvent etre echapes ont les
# valeurs hexa 0x20 - 0x3f ou 0x5e.
#escape 11,13,ff

# Ne pas utiliser les lignes de controle du modem
#local

# Specifie que pppd doit utiliser un verouillage du peripherique serie style
# UUCP pour s'en assurer un acces exclusif.
#lock

# Utilise les lignes de controle du modem. Sur un Ultrix, cette option implique
# un controle de flux materiel, comme avec l'option crtscts. (Cette option 
# n'est pas completement implementee.)
#modem

# Definit la valeur MRU [Unite de Reception Maximum] a n pour la negociation.
# pppd demandera alors de se faire renvoyer les paquets pour au plus &lt;n> octets
# La valeur MRU minimale est de 128. La valeur par defaut est 1500. La valeur
# 296 est recommandee pour les liaisons lentes (40 octets pour l'entete TCP/IP
# + 256 octets de donnees).
#mru 542

# Definit le masque reseau avec &lt;n> qui est un masque reseau 32 bit en 
# "chiffres decimaux" note (e.g 255.255.255.0).
#netmask 255.255.255.0

# Desactive le comportement par defaut lorsque aucune adresse IP n'est 
# specifiee, et qu'elle est determine (quand c'est possible) a partir du
# hostname. Avec cette option, votre correspondant devra vous fournir votre
# adresse IP locale pendant la negotiation IPCP (a moins que cela ne soit
# specifie explicitement dans la ligne de commande ou un fichier d'options)
#noipdefault

# Active l'option passive sur le LCP. Avec cette option, pppd, essayera 
# d'initier la connexion; si aucune reponse n'est recue de votre correspondant,
# pppd attendra passivement un packet LCP (au lieu de s'arreter comme il fait
# sans cette option)
#passive

# Avec cette option, pppd ne va pas transmettre les paquets LCP pour 
# initialiser la connexion tant qu'un paquet LCP valide n'est pas envoye
# par votre correspondant (comme avec l'option "passive" pour des versions
# plus anciennes de pppd).
#silent

# Ne requiert et ne permet pas de negociation pour n'importe quelle option de
# LCP et IPCP (utilise  les valeurs par defaut).
#-all

# Desactive la negociation de la compression d'adresses/controle (utilise les
# reglages par defaut, i.e. le champ adresse/controle desactive)
#-ac

# Desactive la negociation asyncmap (utilise le reglage asyncmap par defaut,
# i.e. echappement de tout les caracteres de controle)
#-am

# Ne forke pas pour devenir un processus en tache de fond (sinon pppd le fera
# si un peripherique serie est specifie).
#-detach

# Desactive la negociation d'adresses IP (avec cette option, l'adresse IP
# distante doit etre specifiee avec une option en ligne de commande ou dans
# un fichier d'options).
#-ip

# Desactive la negociation des nombres magiques. Avec cette option, pppd ne
# peut pas detecter une ligne avec une boucle.
#-mn

# Desactive la negociation MRU [Unite de Reception Maximum] (utilise la valeur
# par defaut, i.e. 1500).
#-mru

# Desactive la negociation du protocole de compression par champ (utilise la
# valeur par defaut, i.e le protocole de compression par champs desactive)
#-pc

# Impose a votre corresondant de s'autentifier avec PAP. Cela necessite une
# authentification des DEUX COTES - NE PAS utiliser pour une liaison standard
# authentifiee par PAP vers un FAI puisqu'il faudra que la machine du FAI
# soit authentifie aupres de votre machine (et ce qu'elle ne pourra pas faire).
#+pap

# Refuse d'utiliser l'authentification avec PAP.
#-pap

# Oblige votre correspondant a s'authentifier avec une authentification
# CHAP [Cryptographic Handshake Authentication Protocol]
# Cela necessite une authentification des DEUX COTES - ne PAS utiliser pour une
# liaison avec un FAI puisqu'il faudra que la machine du FAI
# soit authentifie aupres de votre machine (et ce qu'elle ne pourra pas faire).
#+chap

# Refuse d'utiliser l'authentification avec CHAP.
#-chap

# Desactive la negociation de la compression de l'entete IP style Van Jacobson
# (utilise la valeur par defaut, i.e. pas de compression).
#-vj
# Augmente de niveau de deboguage (comme -d). Si cette option est passee, pppd
# enverra dans le log le contenu de tous les paquets de controle envoyes ou 
# recus dans une forme lisible. Les paquets seront envoyes dans syslog avec les
# possibilites des daemons et du niveau de deboguage. Ces informations peuvent
# etre diriges dans un fichier en configurant /etc/syslog.conf correctement
# (voir syslog.conf(5)). (Si pppd est compile avec des options de deboguage
# supplementaires, il enverra les messages de log dans local2 au lieu du 
# daemon).
#debug

# Ouvre le nom de domaine &lt;d> pour permettre l'authentification de nom d'hote
# local. Par exemple, si gethostname() retourne le nom porsche,
# mais le nom de domaine qualifie est porsche.Quotron.COM, vous devriez
# utiliser l'option domain pour mettre le nom de domaine a Quotron.COM.
#domain &lt;d>

# Active le code de deboguage du pilote PPP au niveau du noyau. L'argument n
# est un nombre qui est la somme des valeurs suivantes : 1 active les messages
# de deboguage generaux, 2 pour que le contenu des paquets recus soient 
# affiches, et 4 pour que le contenu des paquets envoyes soient affiches.
#kdebug n

# Configure la valeur MTU [Unitee de Transmission Maximum] a &lt;n>. A moins
# que votre correspondant ne demande une valeur plus petite lors de la
# negociation MRU, pppd demande que les codes reseaux du noyau envoie des
# paquets d'au plus n octets dans l'interface reseau PPP.
#mtu &lt;n>

# Definit le nom du systeme local avec &lt;n> dans un but d'authentification.
# Cela doit certainement avoir ete configure avec votre nom utilisateur de votre
# FAI si vous utilisez PAP/CHAP. 
#name &lt;n>

# Definit le nom utilisateur avec &lt;u> pour l'authentification avec le 
# correspondant utilisant PAP .
# Ne pas utiliser si vous utilisez le 'name' au-dessus !
#user &lt;u>

# Force l'utilisation du nom d'hote comme nom du systeme local pour les
# authentification (masque l'option name).
#usehostname

# Configure le nom du systeme distant pour les authentifications a &lt;n>.
#remotename &lt;n>

# Ajoute une entree au systeme des tables ARP [Protocole de Resolution 
# d'Adresses] avec l'adresse IP de votre correspondant et l'adresse Ethernet
# de ce syteme.
#proxyarp

# Utilise le systeme de base de donnes de mots de passe pour l'authentification
# de votre correspondant avec PAP.
#login

# Si cette option est passee, pppd va envoyer une requete-echo LCP a votre
# correspondant toutes les n secondes. Sous Linux, une requete-echo est envoyee
# lorsqu'aucun paquet n'a ete recu du correspondant depuis n secondes. 
# Normalement, le correspondant doit repondre a la requete-echo en envoyant une
# reponse-echo. Cette option peut etre utilise avec l'option lcp-echo-failure
# pour detecter que le correspondant n'est plus connecte.
#lcp-echo-interval &lt;n>

# Si cette option est passe, pppd va supposer que le correspondant est mort
# si n requetes-echo LCP sont envoyees sans recevoir de reponse-echo LCP
# valide. Si cela arrive, pppd va terminer la connexion. Utiliser cette option
# necessite une valeur non nulle pour le parametre lcp-echo-interval.
# Cette option peut etre utilisee pour permettre a pppd de terminer une fois 
# qu'une connexion pppd ait ete cassee (c.-a-d. le modem a ete raccroche) dans 
# les situations ou aucune ligne de controle materiel du modem n'est 
# disponibles
#lcp-echo-failure &lt;n>

# Definit l'intervale relance LCP (delay de retransmission) a &lt;n> secondes
# (defaut 3).
#lcp-restart &lt;n>

# Definit le nombre maximal de transmission de requete-fin de LCP a &lt;n>
# (defaut 3).
#lcp-max-terminate &lt;n>

# Definit la nombre maximum de transmission de requete-configure LCP a &lt;n>
# (defaut 10).
# Certains serveurs PPP sont lents a demarrer. Vous devrez alors augmenter 
# ceci si vous avez des erreurs 'serial line looped back' et que vous etes
# SUR que vous etes connecte correctement et que PPP doit demarrer sur le 
# serveur.
#lcp-max-configure &lt;n>

# Definit le nombre maximum de retours LCP configure-NAKs avant de commencer
# a envoyer des configure-Rejects a la place a &lt;n> (defaut 10).
#lcp-max-failure &lt;n>

# Definit l'intervale de relancce de IPCP (temps de retransmission) a &lt;n> 
# secondes (defaut 3).
#ipcp-restart &lt;n>

# Definit le nombre maximum de transmission de requete-fin IPCP a &lt;n>
# (defaut 3).
#ipcp-max-terminate &lt;n>

# Definit la nombre maximum de transmission de requete-configure IPCP a &lt;n>
# (defaut 10).
#ipcp-max-configure &lt;n>

# Definit la nombre maximem de retour configure-NAKs IPCP avant de commencer
# a envoyer des configure-Rejects a la place a &lt;n> (defaut 10).
#ipcp-max-failure &lt;n>

# Definit l'intervalle de relance PAP (temps de retransmission) a &lt;n> secondes
# (defaut 3).
#pap-restart &lt;n>

# Definit le nombre maximum de transmission de requete-d'authentification PAP
# a n (defaut 10)
#pap-max-authreq &lt;n>

# Definit les intervales de relance de CHAP (temps de retransmission) a &lt;n>
# secondes (defaut 3).
#chap-restart &lt;n>

# Definit le nombre maximal d'essai de  transmission de CHAP a &lt;n>
# (defaut 10).
#chap-max-challenge

# Si cette option est passee, pppd va relancer votre correspondant toutes les
# &lt;n> secondes.
#chap-interval &lt;n>

# Avec cette option, pppd va accepter la proposition de votre correspondant
# pour votre adresse IP locale, meme si l'adresse IP est specifiee en option.
#ipcp-accept-local

# Avec cette option, pppd va accepter la proposition d'adresse IP (distante),
# meme si l'adresse distante est specifiee en option.
#ipcp-accept-remote
</PRE>
<HR>
</P>


<H2><A NAME="ss12.2">12.2 Quelles options dois-je utiliser ? (Sans PAP/CHAP)</A>
</H2>

<P>En fait, comme toujours, ça dépend. Les options spécifiées ici devraient
marcher avec la plupart des serveurs.</P>

<P>Cependant, si ça NE fonctionne PAS LISEZ LE FICHIER MODELE
(<CODE>/etc/ppp/options.tpl</CODE>) <B>et</B> les pages de manuel de <CODE>pppd</CODE> <B>et</B>
demandez à votre administrateur/support client qui fait marcher le
serveur sur lequel vous vous connectez.</P>

<P>Je rappelle également que les scripts de connexion présentés ici
utilisent également des options en ligne de commande pour <CODE>pppd</CODE> et
rendre les choses plus facilement modifiables.</P>
<P>
<HR>
<PRE>
# /etc/ppp/options (NO PAP/CHAP)
#
# Empeche pppd de forker en tache de fond
-detach
#
# utilise les lignes de controle du modem
modem
# utilise les verrous style uucp pour assurer une utilisation exclusive du 
# port serie
lock
# utilise le flux de controle materiel
crtscts
# creer une route par defaut pour cette connexion dans la table de routage
defaultroute
# ne configure aucune sequence de controle echapee
asyncmap 0
# utlise une taille maximale de paquet transmis de 552 octets
mtu 552
# utilise une taille maximale de paquets recus de 552 octets.
mru 552
#
#-------FIN D'EXEMPLE /etc/ppp/options (sans PAP/CHAP)
</PRE>
<HR>
</P>

<H2><A NAME="pap"></A> <A NAME="s13">13. Si votre serveur PPP utilise PAP (Password Authentification Protocol) </A></H2>

<P>Si le serveur sur lequel vous vous connectez a besoin de l'authentification
PAP ou CHAP, vous avez un petit peu plus de travail.</P>

<P>Pour les fichiers de configuration précédents, ajouter les lignes suivantes :
<HR>
<PRE>
#
# force pppd a utiliser le nom utilisateur de FAI comme 'nom d'hote' pendant
# le processus d'authentification
name &lt;le nom de votre FAI>       # vous devez editer cette ligne
#
# Si vous avez un *serveur* PPP vous devez forcer PAP ou CHAP en decommentant
# l'une des lignes suivantes. Ne pas les utiliser si vous etes un client qui
# se connecte sur un serveur PPP (meme s'il utilise PAP ou CHAP) puisque cela
# forcera le serveur a s'authentifier aupres de votre machine (alors que cela
# ne sera certainement pas possible - et la liaison echouera).
#+chap
#+pap
#
# Si vous utilisez des secrets ENCRYPTES dans le fichier /etc/ppp/pap-secrets,
# alors decommentez la ligne suivante.
# Remarque: ce n'est pas pareil que d'utiliser les mots de passe MS encryptes
# comme ils peuvent etres avec MS RAS sur Windows NT.
#+papcrypt
</PRE>
<HR>
</P>

<H2><A NAME="ss13.1">13.1 Utiliser MSCHAP</A>
</H2>

<P>Microsoft Windows NT RAS peut être configuré pour utiliser une variation particulière de CHAP (Challenge/Handshake Authentication Protocol). Dans l'archive des
sources de PPP, vous devriez trouver un fichier appelé README.MSCHAP80 qui
parle de cela.</P>

<P>Vous pouvez déterminer si le serveur demande une authentification utilisant ce
protocole en activant le deboguage dans <CODE>pppd</CODE>. Si le serveur demande une 
authentification MS CHAP, vous devriez voir les lignes </P>
<P>
<HR>
<PRE>
rcvd [LCP ConfReq id=0x2 &lt;asyncmap 0x0> &lt;auth chap 80> &lt;magic 0x46a3>]
</PRE>
<HR>
</P>

<P>L'information critique ici est <B>auth chap 80</B>.</P>

<P>Pour utiliser MS CHAP, vous devez recompiler pppd. Veuillez consulter les
instructions dans le fichier README.MSCHAP80 des sources de PPP pour obtenir
les instructions sur la façon de compiler en utilisant cette variante.</P>

<P>Vous devez remarquer que le code présent supporte uniquement des clients Linux
PPP connectés sur un serveur MS Windows NT. Mais NE supporte PAS
la configuration d'un serveur PPP Linux pour utiliser l'authentification 
MSCHAP80 pour les clients.</P>

<H2><A NAME="ss13.2">13.2 Le fichier de secrets de PAP/CHAP</A>
</H2>

<P>Si vous utilisez l'authentification PAP ou CHAP, alors vous devez créer les
fichiers . Ce sont
<HR>
<PRE>
/etc/ppp/pap-secrets
/etc/ppp/chap-secrets
</PRE>
<HR>
</P>

<P>Il doivent être possédés par <B>root</B>, le groupe <B>root</B> et avoir les 
permissions 740 pour la sécurité.</P>

<P>Le premier point à remarquer au sujet de PAP et CHAP est qu'ils sont conçus
pour authentifier <B>les ordinateurs</B> mais pas <B>les utilisateurs</B></P>

<P>&quot;Humm? Qu'est ce que ça change ? &quot; Me demandez vous.</P>

<P>Hé bien, une fois que l'ordinateur a établi une connexion PPP avec le serveur,
<B>n'importe quel</B> utilisateur de votre système peut utiliser cette connexion
- pas seulement vous. C'est pourquoi vous pouvez configurer un réseau à
large domaine en reliant deux réseaux locaux avec PPP.</P>

<P>PAP peut (et CHAP <B>DOIT</B>) demander une authentification 
<B>bidirectionnelle</B> - c'est un nom et un code secret qui est nécessaire pour
chaque ordinateur avec lequel il est impliqué. Cependant, ce n'est
pas la façon dont tous les serveurs PPP fonctionnent pour offrir 
l'authentification PAP des appels PPP.</P>

<P>Il a été dit que votre FAI vous donnerait certainement un nom utilisateur et
un mot de passe pour vous permettre de vous connecter sur son système et 
ensuite sur Internet. Votre FAI se fiche de connaître le nom de votre 
ordinateur, vous devrez donc utiliser votre nom utilisateur chez votre FAI
comme nom pour votre machine.</P>

<P>Cela est possible avec l'option <CODE>name username</CODE> de <CODE>pppd</CODE>. Donc, si vous 
utilisez le nom donné par votre FAI, ajoutez la ligne
<HR>
<PRE>
name votre_utilisateur nom_chez_votre_FAI
</PRE>
<HR>
</P>
<P>dans votre fichier <CODE>/etc/ppp/options</CODE>.</P>

<P>Techniquement, vous devrez utiliser  
<CODE>user votre_utilisateur nom_chez_votre_FAI</CODE> pour PAP, mais <CODE>pppd</CODE> est
suffisamment intelligent pour interpréter l'option <CODE>name</CODE> comme <CODE>user</CODE>
si nécessaire pour utiliser PAP. L'avantage d'utiliser l'option <CODE>name</CODE>
est qu'elle est également valide pour CHAP.</P>

<P>Puisque PAP permet d'authentifier les <B>ordinateurs</B>, techniquement, vous
devez aussi spécifier un nom d'ordinateur distant. Toutefois, comme de
nombreuses personnes ont plus d'un seul FAI, vous pouvez utiliser un caractère
générique (*) pour le nom d'ordinateur distant dans le fichier de secrets.</P>

<P>Il est aussi intéressant de remarquer que de nombreux FAI utilise des banques
de modems multiples connectés sur différents serveurs de terminaux - tous ont
un nom différent, mais sont accessibles avec un seul numéro d'appel. Il peut 
alors être difficile dans certaines circonstances de savoir à l'avance quel 
est le nom de l'ordinateur distant, puisque cela dépendra du serveur de 
terminal sur lequel vous vous connecterez !</P>

<H2><A NAME="ss13.3">13.3 Le fichier de secrets de PAP</A>
</H2>

<P>Le fichier <CODE>/etc/ppp/pap-secrets</CODE> ressemble à
<HR>
<PRE>
# Authentication Secrete avec PAP
# client        serveur       secret     adresses_IP_locale_acceptable
</PRE>
<HR>
</P>

<P>Les quatre champs sont séparés par des espaces et le dernier peut être omis
(c'est l'adresse dynamique ou sans doute statique de votre FAI).</P>

<P>Supposons que votre FAI vous ait donné un nom utilisateur <CODE>fred</CODE> et un mot
de passe <CODE>flintstone</CODE> vous aurez l'option <CODE>name fred</CODE> dans 
<CODE>/etc/ppp/options[.ttySx]</CODE> et vous configurerez votre
<CODE>/etc/ppp/pap-secrets</CODE> comme suit</P>
<P>
<HR>
<PRE>
# Authentication Secrete avec PAP
# client        serveur       secret     adresses_IP_locale_acceptable
fred            *       flintstone
</PRE>
<HR>
</P>

<P>Cela signifie que pour une machine locale <CODE>fred</CODE> (<CODE>pppd</CODE> lui impose de 
s'appeler comme cela même si ça n'est pas son nom de machine réel) et 
pour <B>n'importe quel</B> serveur, utiliser le mot de passe (secret) 
<CODE>"flintstone"</CODE>.</P>

<P>Remarquez que vous ne devez pas spécifier d'adresse IP locale, à moins que 
vous ne deviez FORCER une adresse locale statique particulière. Même si vous
essayez cette option, il y a peu de chances qu'elle marche puisque la 
plupart des serveurs PPP (pour des raisons de sécurité) ne permettent pas
au système distant de configurer l'adresse IP qu'ils reçoivent.</P>

<H2><A NAME="ss13.4">13.4 Le fichier de secrets de CHAP</A>
</H2>

<P> 
Cette méthode nécessite une méthode authentification mutuelle - c'est à dire
que vous devez permettre à votre machine d'authentifier le serveur distant
<B>ET</B> le serveur distant d'authentifier votre machine.</P>

<P>Donc, si votre machine s'appelle <CODE>fred</CODE> et que le serveur distant s'appelle
<CODE>barney</CODE> il faut définir sur fred <CODE>name fred remotename barney</CODE> et
sur la machine distante <CODE>name barney remotename fred</CODE> dans les fichiers
<CODE>/etc/ppp/options.ttySx</CODE> respectifs.</P>

<P>Le fichier <CODE>/etc/chap-secrets</CODE> de <CODE>fred</CODE> ressemblera à 
<HR>
<PRE>
# Authentication Secrete avec CHAP
# client        serveur       secret     adresses_IP_locale_acceptable
fred            barney      flintstone
barney          fred        wilma
</PRE>
<HR>
</P>

<P>et pour <CODE>barney</CODE></P>
<P>
<HR>
<PRE>
# Authentication Secrete avec CHAP
# client        serveur       secret     adresses_IP_locale_acceptable
barney          fred    flintstone
fred            barney  wilma
</PRE>
<HR>
</P>


<P>Remarquez en particulier que les deux machines doivent avoir des entrées pour 
une authentification bidirectionnelle. Cela permet à la machine locale 
d'authentifier elle-même la machine distante <B>ET</B> la machine distante
d'authentifier elle-même la machine locale.</P>

<H2><A NAME="ss13.5">13.5 Supporter plusieurs connexions authentifiées avec PAP</A>
</H2>

<P>Certains utilisateurs ont plus d'un serveur sur lesquels ils se connectent en
utilisant PAP. A partir du moment où votre nom utilisateur est différent sur
chacune des machines sur lesquelles vous vous connectez, il n'y a pas de 
problème.</P>

<P>Mais, nombreux sont les utilisateurs qui ont le même nom utilisateur sur deux
(ou plus, voire même tous les) systèmes où ils se connectent. Le problème 
revient donc à choisir la bonne ligne du fichier <CODE>/etc/ppp/pap-secrets</CODE>.</P>

<P>Comme vous pouvez le supposer, PPP fournit un mécanisme pour régler cela.
PPP permet de définir un &lt;&lt; pseudonyme >> pour le serveur distant final de la
connexion en utilisant l'option <B>remotename</B> de pppd.</P>

<P>Supposons que vous vous connectiez sur deux serveurs PPP utilisant le même nom
utilisateur <CODE>fred</CODE>. Vous configurerez votre <CODE>/etc/ppp/pap-secrets</CODE> 
avec</P>
<P>
<HR>
<PRE>
fred    pppserveur1      barney
fred    pppserveur2      wilma
</PRE>
<HR>
</P>

<P>Maintenant, pour se connecter sur <CODE>pppserveur1</CODE> vous utiliserez 
<CODE>name fred remotename pppserver1</CODE> dans votre <CODE>ppp-options</CODE> et pour
<CODE>pppserveur2</CODE> <CODE>name fred remotename pppserver2</CODE>.</P>

<P>Puisque vous pouvez sélectionner le fichier d'options à utiliser avec
<CODE>pppd</CODE> en utilisant l'option <CODE>file filename</CODE>, vous pouvez définir un
script pour se connecter sur chacun de vos serveurs PPP, qui choisira le
fichier d'options correct et mettra la bonne option <CODE>remotename</CODE>.</P>

<H2><A NAME="manual"></A> <A NAME="s14">14. Configurer une connexion PPP à la main</A></H2>

<P>Maintenant que vous avez créé les fichiers <CODE>/etc/ppp/options</CODE> et
<CODE>/etc/resolv.conf</CODE> (et si besoin le fichier 
<CODE>/etc/ppp/pap/chap-secrets</CODE>), vous pouvez tester les paramètres en
établissant une connexion PPP à la main. (Une fois que la connexion 
manuelle marchera, nous automatiserons le processus).</P>

<P>Pour ce faire, votre programme de communication doit pouvoir être quitté sans
réinitialiser le modem. <CODE>Minicom</CODE> peut le faire avec Alt-Q (ou dans les
versions plus ancienne de <CODE>minicom</CODE> CTRL-A Q)</P>

<P>Vérifiez que vous êtes <B>root</B>.</P>

<P>Lancez le programme de communication (<CODE>minicom</CODE> par exemple), appelez le 
serveur PPP et connectez-vous comme d'habitude. Si vous avez besoin d'envoyer 
une commande pour démarrer PPP sur le serveur, faites-le. Vous devriez 
maintenant voir les messages que vous aviez déjà vus.</P>

<P>Si vous utilisez PAP ou CHAP, se connecter simplement sur le système distant
devrait démarrer PPP et vous devriez voir des caractères s'afficher sans
toutefois se connecter (même si ça peut ne pas marcher sur certains serveurs -
essayez alors d'appuyer sur <B>Entrée</B> et les caractères devraient s'afficher).</P>

<P>Maintenant quittez le programme de communication <EM>sans initialiser le modem</EM>
(ALT-Q ou CTRL-A Q dans <CODE>minicom</CODE>) et au message d'accueil de Linux (étant 
<B>root</B>) tapez</P>
<P>
<HR>
<PRE>
pppd -d -detach /dev/ttySx 38400 &amp;
</PRE>
<HR>
</P>

<P>L'option -d active le déboguage - la conversation de démarrage de la connexion
ppp sera retranscrite dans votre journal système - ce qui est très utile si des
problèmes apparaissent.</P>

<P>Les lumières de votre modem devraient alors clignoter puisque la connexion PPP
est établie. Cela peut prendre un peu de temps avant que la connexion soit
terminée.</P>

<P>A ce niveau, vous pouver afficher l'interface PPP en tapant la commande :</P>
<P>
<HR>
<PRE>
ifconfig
</PRE>
<HR>
</P>

<P>En plus des éventuels périphériques loopback et Ethernet, vous devriez avoir
quelque chose qui ressemble à :</P>
<P>
<HR>
<PRE>
ppp0     Link encap:Point-Point Protocol
         inet addr:10.144.153.104  P-t-P:10.144.153.51 Mask:255.255.255.0
         UP POINTOPOINT RUNNING  MTU:552  Metric:1
         RX packets:0 errors:0 dropped:0 overruns:0
         TX packets:0 errors:0 dropped:0 overruns:0
</PRE>
<HR>
</P>

<P>Où
<UL>
<LI>inet addr:10.144.153.10 est l'adresse IP de votre connexion.</LI>
<LI>P-t-P:10.144.153.5 est l'adresse IP du serveur.</LI>
</UL>
</P>
<P>(Naturellement, <CODE>ifconfig</CODE> ne renvoie pas ces nombres là, mais ceux qui sont
utilisés par le serveur PPP.)</P>

<P>Remarque : <CODE>ifconfig</CODE> indique également que votre liaison fonctionne 
correctement !</P>

<P>Si vous aucun périphérique PPP n'est affiché ou quelque chose du genre</P>
<P>
<HR>
<PRE>
ppp0     Link encap:Point-Point Protocol
         inet addr:0.0.0.0  P-t-P:0.0.0.0  Mask:0.0.0.0
         POINTOPOINT  MTU:1500  Metric:1
         RX packets:0 errors:0 dropped:0 overruns:0
         TX packets:0 errors:0 dropped:0 overruns:0
</PRE>
<HR>
</P>

<P>Votre liaison PPP n'est pas correcte... voir la section suivante sur le 
débuggage !</P>

<P>Vous devez aussi pouvoir voir une route vers l'hôte distant (et même plus).
Pour cela, entrez la commande</P>
<P>
<HR>
<PRE>
route -n
</PRE>
<HR>
</P>

<P>Vous devriez obtenir quelque chose comme :</P>
<P>
<HR>
<PRE>
Kernel routing table
Destination     Gateway         Genmask         Flags MSS    Window Use Iface
10.144.153.3    *               255.255.255.255 UH    1500   0        1 ppp0
127.0.0.0       *               255.0.0.0       U     3584   0       11 lo
10.0.0.0        *               255.0.0.0       U     1500   0       35 eth0
default         10.144.153.3    *               UG    1500   0        5 ppp0
</PRE>
<HR>
</P>

<P>Ce qui est important ici, c'est d'avoir DEUX entrées pointant vers votre 
interface ppp.</P>

<P>La première est une route d'hôte (indiqué par le drapeau H) et qui permet de 
voir l'hôte sur lequel vous êtes connecté - mais pas plus.</P>

<P>La seconde est la route par défaut (établie en donnant à <CODE>pppd</CODE> l'option
<CODE>defaultroute</CODE>). C'est cette route qui indique à votre PC Linux d'envoyer
tous les paquets qui ne sont pas destinés à vos interfaces Ethernet - vers
lesquelles vous avez des routes réseau spécifiques - au serveur PPP lui-même.
Le serveur PPP est alors responsable de router vos paquets vers Internet et
de vous renvoyer les paquets chez vous.</P>

<P>Si vous ne voyez pas une table de routage avec deux entrées, quelque chose ne
marche pas. En particulier si votre syslog contient des messages indiquant que
<CODE>pppd</CODE> ne remplace pas la route par défaut, vous devez avoir une route par
défaut qui pointe sur votre interface Ethernet - qui <B>DOIT</B> être remplacée
par une route réseau spécifique : <B>VOUS NE POUVEZ AVOIR QU'UNE SEULE ROUTE
PAR DEFAUT !!!</B></P>

<P>Vous devez explorer vos fichiers d'initialisation de votre système pour trouver
où est configuré votre route par défaut (elle doit utiliser la commande
<CODE>route add default...</CODE>). Changer cette commande par quelque chose du genre
<CODE>route add net ...</CODE>.</P>

<P>Maintenant testez la liaison en 'pingant' le serveur à l'adresse IP affiché
par ifconfig, comme suit : </P>
<P>
<HR>
<PRE>
ping 10.144.153.51
</PRE>
<HR>
</P>

<P>Vous devriez obtenir</P>
<P>
<HR>
<PRE>
PING 10.144.153.51 (10.144.153.51): 56 data bytes
64 bytes from 10.144.153.51: icmp_seq=0 ttl=255 time=328.3 ms
64 bytes from 10.144.153.51: icmp_seq=1 ttl=255 time=190.5 ms
64 bytes from 10.144.153.51: icmp_seq=2 ttl=255 time=187.5 ms
64 bytes from 10.144.153.51: icmp_seq=3 ttl=255 time=170.7 ms
</PRE>
<HR>
</P>

<P>Ce listing doit continuer sans jamais s'arrêter - pour le stopper, taper
CTRL C, vous recevrez alors des informations complémentaires :</P>
<P>
<HR>
<PRE>
--- 10.144.153.51 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max = 170.7/219.2/328.3 ms
</PRE>
<HR>
</P>

<P>Jusqu'ici tout va bien, jusqu'ici tout va bien.</P>

<P>Maintenant, essayez de pinger un nom d'hôte (pas le nom du serveur PPP 
lui-même) mais un hôte d'un autre site dont vous SAVEZ qu'il y a de très fortes 
chances qu'il marche...). Par exemple</P>
<P>
<HR>
<PRE>
ping sunsite.unc.edu
</PRE>
<HR>

<EM> ou lip6.fr</EM></P>

<P>Dans ce cas, il va y avoir une petite pause le temps que Linux obtienne 
l'adresse IP du nom de hôte que vous avez 'pingé' par le DNS que vous avez
spécifié dans le <CODE>/etc/resolv.conf</CODE> - ne vous inquiétez pas (les 
lumières de votre modem devraient clignoter). Rapidement, vous devriez avoir
l'affichage suivant</P>
<P>
<HR>
<PRE>
 PING sunsite.unc.edu (152.2.254.81): 56 data bytes
64 bytes from 152.2.254.81: icmp_seq=0 ttl=254 time=190.1 ms
64 bytes from 152.2.254.81: icmp_seq=1 ttl=254 time=180.6 ms
64 bytes from 152.2.254.81: icmp_seq=2 ttl=254 time=169.8 ms
64 bytes from 152.2.254.81: icmp_seq=3 ttl=254 time=170.6 ms
64 bytes from 152.2.254.81: icmp_seq=4 ttl=254 time=170.6 ms
</PRE>
<HR>
</P>

<P>Là encore, arrêtez le en tapant CTRL C pour obtenir les statistiques...</P>
<P>
<HR>
<PRE>
--- sunsite.unc.edu ping statistics ---
5 packets transmitted, 5 packets received, 0% packet loss
round-trip min/avg/max = 169.8/176.3/190.1 ms
</PRE>
<HR>
</P>

<P>Si vous n'avez pas de réponse, essayer de pinger l'adresse de votre serveur DNS
de votre FAI. Si vous n'avez pas de résultat, alors il doit y avoir un
problème avec votre <CODE>/etc/resolv.conf</CODE>.</P>

<P>Si ça ne fonctionne pas, vous devez avoir un problème de routage, ou votre FAI
a un problème à vous renvoyer les paquets. Vérifiez les tables de routages
présentées plus haut et si tout est OK, contacter votre FAI. Si cela se trouve
après votre FAI, alors le problème est de votre coté.</P>

<P>Si tout marche correctement, fermez la connexion en tapant</P>
<P>
<HR>
<PRE>
ppp-off
</PRE>
<HR>
</P>

<P>Après une courte pause, le modem devrait raccrocher.</P>

<P>Si ça ne marche pas, soit vous éteignez votre modem, soit vous lancez votre 
programme de communication et vous interrompez votre modem avec +++ puis 
vous raccrochez avec ATH0 quand vous recevez le message OK de votre modem.</P>

<P>Vous devez également effacer le fichier créé par pppd
<HR>
<PRE>
rm -f /var/lock/LCK..ttySx
</PRE>
<HR>
</P>

<H2><A NAME="automatiser"></A> <A NAME="s15">15. Automatiser votre connexion - Créer les scripts de connexion </A></H2>

<P>Même si vous pouvez continuer à vous connecter à la main comme montré ci-dessus
il est plus sympa de faire quelques scripts pour automatiser tout ça.</P>

<P>Quelques scripts vont automatiser la connexion et le lancement de PPP, vous
n'aurez alors plus qu'à envoyer une seule commande (en étant <B>root</B> ou membre
du groupe PPP) pour lancer votre connexion.</P>

<H2><A NAME="ss15.1">15.1 Scripts de connexion pour l'authentification nom utilisateur/mot de passe</A>
</H2>

<P>Si votre FAI n'a pas besoin d'utiliser PAP/CHAP, ces scripts sont faits pour
vous !</P>

<P>Si le paquetage ppp est correctement installé, vous devez avoir deux fichiers
d'exemple. Pour PPP 2.1.2 il sont dans <CODE>/usr/sbin</CODE> et pour PPP 2.2 il
sont dans <CODE>/etc/ppp/scripts</CODE>. Ils s'appellent</P>

<P>pour PPP-2.1.2</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
ppp-on
ppp-off
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>et pour PPP 2.2</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
ppp-off
ppp-on
ppp-on-dialer
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Maintenant, si vous utilisez PPP 2.1.2, je vous presse fermement de détruire 
ces fichiers d'exemple. Il y a pleins de problèmes potentiels avec ceux-ci -
et ne me dites pas qu'ils marchent correctement - je les ai également utilisé
pendant des années (et les recommandait même dans la première version de ce
HOWTO) !</P>

<P>Pour les utilisateurs de PPP 2.1.2, voici de BIEN MEILLEURS modèles,
pris dans la distribution 2.2 de PPP. Je vous conseille de les copier et
d'utiliser ces scripts à la place des anciens de PPP-2.1.2.</P>

<H2><A NAME="ss15.2">15.2 Le script ppp-on</A>
</H2>

<P>C'est le premier des DEUX scripts qui lance la connexion.</P>
<P>
<HR>
<PRE>
#!/bin/sh
#
# Script pour initialiser une connexion PPP. C'est la premiere partie de deux
# scripts. Ce ne sont pas des scripts securises, puisque les codes sont
# visibles avec la commande 'ps'. Cependant ils sont simples.
#
# Ce sont des parametres a changer selon les besoins
TELEPHONE=555-1212    # Le numero de telephone de la connexion
ACCOUNT=george        # Le nom du compte (comme dans 'George Burns')
PASSWORD=gracie       # Le mot de passe du compte (et 'Gracie Allen')
LOCAL_IP=0.0.0.0      # L'adresse IP locale si elle est connue Dynamic = 0.0.0.0
REMOTE_IP=0.0.0.0     # Adresse IP distante. Normally 0.0.0.0
NETMASK=255.255.255.0 # Le masque reseau si besoin
#
# Les exporter pour qu'ils soit disponible avec 'ppp-on-dialer'
export TELEPHONE ACCOUNT PASSWORD
#
# C'est l'emplacement du script qui compose le numero et se connecte.
# Utilisez les noms de fichiers absolus, car la variable $PATH n'est pas
# utilisee avec l'option connect. (Faire ca en etant 'root' entraine un
# trou de securite.)
#
DIALER_SCRIPT=/etc/ppp/ppp-on-dialer
#
# Commencer la connexion
#
#
exec /usr/sbin/pppd debug /dev/ttySx 38400 \
        $LOCAL_IP:$REMOTE_IP \
        connect $DIALER_SCRIPT
</PRE>
<HR>
</P>

<P>Voici le script ppp-on-dialer :</P>
<P>
<HR>
<PRE>
#!/bin/sh
#
# C'est la deuxieme partie du script ppp-on. Il contient le protocole de 
# connexion de la connexion desiree.
#
/usr/sbin/chat -v                                                 \
        TIMEOUT         3                               \
        ABORT           '\nBUSY\r'                      \
        ABORT           '\nNO ANSWER\r'                 \
        ABORT           '\nRINGING\r\n\r\nRINGING\r'    \
        ''              \rAT                            \
        'OK-+++\c-OK'   ATH0                            \
        TIMEOUT         30                              \
        OK              ATDT$TELEPHONE                  \
        CONNECT         ''                              \
        ogin:--ogin:    $ACCOUNT                        \
        assword:        $PASSWORD
</PRE>
<HR>
</P>

<P>Avec PPP-2.2, le script <CODE>ppp-off</CODE> ressemble à :</P>
<P>
<HR>
<PRE>
#!/bin/sh
######################################################################
#
# Determine le peripherique a terminer.
#
if [ "$1" = "" ]; then
        DEVICE=ppp0
else
        DEVICE=$1
fi

######################################################################
#
# Si le fichier pid ppp0 est present alors le programme est lance. Le stopper.
if [ -r /var/run/$DEVICE.pid ]; then
        kill -INT `cat /var/run/$DEVICE.pid`
#
# Si le kill ne marche pas, alors il n'y a pas de processus lance pour ce pid.
# Cela peut signifier que le fichier de lock a ete laisse. Vous souhaitez 
# peut-etre detruire le fichier de lock en meme temps.
        if [ ! "$?" = "0" ]; then
                rm -f /var/run/$DEVICE.pid
                echo "ERROR: Removed stale pid file"
                exit 1
        fi
#
# Succes. pppd a enlever tout ce qu'il avait cree.
        echo "PPP link to $DEVICE terminated."
        exit 0
fi
#
# Le processus ppp ne marche pas pour ppp0
echo "ERROR: PPP link is not active on $DEVICE"
exit 1
</PRE>
<HR>
</P>

<H2><A NAME="ss15.3">15.3 Editer les scripts de démarrage de PPP fournis</A>
</H2>

<P>Puisque les nouveaux scripts sont en deux parties, nous allons les éditer 
chacun leur tour.</P>

<H3>Le script ppp-on</H3>

<P>Vous devez éditer ces fichiers pour contenir VOTRE nom utilisateur de votre FAI,
VOTRE mot de passe de votre FAI, et le numéro de téléphone de votre FAI. </P>

<P>Chacune des lignes ressemblant à <CODE>TELEPHONE=</CODE> définissent une variable
du shell contenant les informations à droite du '=' (mise à part les
commentaires évidemment). Éditer donc toutes les lignes de ce fichier
pour qu'il corresponde a votre FAI et votre connexion.</P>

<P>De plus, si vous configurez l'adresse IP (si vous avez besoin) dans le fichier
<CODE>/etc/ppp/options</CODE>, DETRUISEZ les lignes mentionnant</P>
<P>
<HR>
<PRE>
$LOCAL_IP:$REMOTE_IP \
</PRE>
<HR>
</P>

<P>Assurez-vous également que la variable shell DIALER_SCRIPT pointe sur le
chemin complet du script d'appel qui sera réellement utilisé. Ainsi, si vous
déplacez ou renommez ce script, assurez-vous que vous modifier correctement
cette ligne dans le script <CODE>ppp-on</CODE> !</P>

<H3>Le script ppp-on-dialer</H3>

<P>C'est le deuxième des scripts qui lance votre liaison PPP.</P>

<P>Remarque : un script <CODE>chat</CODE> est normalement sur une ligne complète.
Les backslashs sont utilisés pour permettre à la ligne de se répartir
sur plusieurs lignes physiques (pour une lisibilité plus humaine) et 
ne font pas partie du script lui-même.</P>

<P>Cependant, il est très utile de le regarder en détail, comme cela nous 
comprenons ce qu'il est réellement supposé faire !</P>

<H2><A NAME="ss15.4">15.4 Ce que script Chat signifie...</A>
</H2>

<P>Un script <CODE>chat</CODE> est une séquence de paires de <CODE>&quot;</CODE>chaînes
d'attentes<CODE>&quot;</CODE> et de <CODE>&quot;</CODE>chaînes d'envoi
<CODE>&quot;</CODE>. En particulier, remarquez que nous attendons <B>TOUJOURS</B>
quelque chose avant d'envoyer quoi que ce soit.</P>

<P>Si nous envoyons quelque chose <B>SANS</B> avoir rien reçu avant, nous devons
attendre une chaîne vide avant (indiquée par un 
<CODE>&quot;</CODE><CODE>&quot;</CODE>) Et de la même manière attendre quelque chose
sans avoir rien envoyé ! Ainsi, si les chaîne consistent en quelques mots,
(c.-à-d. NO CARRIER), vous devez entourez les chaînes par des quotes pour 
qu'elles soient vues comme une seule entité par chat.</P>

<P>La ligne <CODE>chat</CODE> de notre modèle est :</P>
<P>
<HR>
<PRE>
exec /usr/sbin/chat -v
</PRE>
<HR>
</P>
<P>Invoque chat, le -v indique à <CODE>chat</CODE> de mettre toutes ses entrée/sorties 
dans le journal système (généralement /var/log/messages). Une fois que votre 
script <CODE>chat</CODE> marchera correctement, éditez cette ligne et enlevez le -v 
pour économiser des messages inutiles dans votre syslog.</P>
<P>
<HR>
<PRE>
TIMEOUT         3
</PRE>
<HR>

Ça définit un temps d'attente de trois secondes avant la réception d'une 
entrée attendue. Vous devrez l'augmenter à 5 ou 10 secondes si vous utilisez un
modem extrêmement lent !</P>
<P>
<HR>
<PRE>
ABORT           '\nBUSY\r'
</PRE>
<HR>
</P>
<P>Si la chaîne BUSY est reçue, abandonner l'opération.</P>
<P>M
<HR>
<PRE>
ABORT           '\nNO ANSWER\r'
</PRE>
<HR>
</P>
<P>Si la chaîne NO ANSWER est reçue, abandonner l'opération.</P>
<P>
<HR>
<PRE>
ABORT           '\nRINGING\r\n\r\nRINGING\r'
</PRE>
<HR>
</P>
<P>Si la chaîne RINGING est reçue de manière répétée, abandonner l'opération.
C'est parce que quelqu'un vous appelle !</P>
<P>
<HR>
<PRE>
&quot;              \rAT
</PRE>
<HR>
</P>
<P>Ne rien attendre du modem et envoyer la chaîne AT.</P>

<P>
<HR>
<PRE>
OK-+++\c-OK   ATH0
</PRE>
<HR>
</P>
<P>C'est un petit plus compliqué car cela utilise certaines capacités de chat
à récupérer les erreurs.</P>

<P>Ça veux dire...Expect OK, si on ne l'a pas reçu (parce que le modem n'est pas
en ligne de commande) alors envoyer +++ (la chaîne standard des modems
compatible Hayes pour retourner en ligne de commande) et attendre OK.
Ensuite envoyer ATH0 (la chaîne pour raccrocher). Cela permet au script de 
répondre à la situation ou votre modem avait laissé la ligne décrochée !</P>
<P>
<HR>
<PRE>
TIMEOUT         30
</PRE>
<HR>
</P>
<P>Mettre le temps d'attente à 30 secondes pour le reste du script. Si vous avez
des soucis avec des abandons du script <CODE>chat</CODE> à cause de timeout, augmentez 
cette valeur à 45 secondes ou plus.</P>
<P>
<HR>
<PRE>
OK              ATDT$TELEPHONE
</PRE>
<HR>
</P>
<P>Attends un OK (la réponse du modem à la commande ATH0) et compose le numéro
que nous voulez appeler.</P>
<P>
<HR>
<PRE>
CONNECT         ''
</PRE>
<HR>
</P>
<P>Attendre CONNECT(ce que le modem nous envoie lorsque le modem distant décroche)
et n'envoie rien en réponse.</P>
<P>
<HR>
<PRE>
ogin:--ogin:    $ACCOUNT
</PRE>
<HR>
</P>
<P>Une fois encore nous avons une récupération d'erreur ici. Attendre le message
de login (...ogin:) mais si nous ne le recevons pas au bout d'un certain temps,
envoyer un retour chariot et attendre une nouvelle fois le message de
login. Lorsque le message est reçu, envoyer le nom utilisateur (stocké dans
la variable shell $ACCOUNT).</P>
<P>
<HR>
<PRE>
assword:        $PASSWORD
</PRE>
<HR>
</P>
<P>Attendre le message du mot de passe et envoyer le mot de passe (là aussi 
stocké dans une variable shell).</P>

<P>Ce script <CODE>chat</CODE> à une capacité de récupération d'erreurs résonnable. Chat 
possède bien d'autres possibilités que celles détaillés. Pour plus
d'informations, consulter la page de manuel de <CODE>chat</CODE> (<CODE>man 8 chat</CODE>).</P>

<H3>Démarrer PPP sur le serveur final</H3>

<P>Bien que le script ppp-on-dialer soit parfait pour les serveurs qui lancent
automatiquement <CODE>pppd</CODE> sur le serveur final une fois que vous êtes connectés,
certains serveurs nécessitent que vous lanciez PPP explicitement sur le serveur.</P>

<P>Si vous avez besoin d'envoyer une commande de lancement de PPP sur le serveur,
vous DEVEZ éditer le script ppp-on-dialer.</P>

<P>A la fin du script (après la ligne password) ajouter une paire 
<B>attente envoi</B> en plus - elle cherchera un message de login (une suite de
caractères qui ont une signification particulière dans le shell Bourne - 
comme $ et [ ou ] (les crochets ouverts et fermés).</P>

<P>Une fois que <CODE>chat</CODE> à obtenu le prompt du shell, <CODE>chat</CODE> doit envoyer la 
commande de démarrage de ppp nécessaire sur le serveur PPP de votre FAI.</P>

<P>Pour ma part, mon serveur PPP utilise un prompt Bash standard
<HR>
<PRE>
[hartr@kepler hartr]$
</PRE>
<HR>
</P>

<P>et nécessite que je tapes</P>
<P>
<HR>
<PRE>
ppp
</PRE>
<HR>
</P>

<P>pour lancer ppp sur le serveur.</P>

<P>Une idée judicieuse peut être d'ajouter un peu de récupération d'erreur, dans
mon cas j'utilise
<HR>
<PRE>
        hartr--hartr    ppp
</PRE>
<HR>
</P>

<P>Cela signifie que si je ne reçois pas le prompt dans le temps imparti, j'envoie
un retour chariot et je recherche le prompt une nouvelle fois.</P>

<P>Une fois que le message est reçu, j'envoie la chaîne <CODE>ppp</CODE>.</P>

<P>Remarque : n'oubliez pas d'ajouter un \ à la fin de la ligne précédente
pour que <CODE>chat</CODE> pense que le script de connexion de <CODE>chat</CODE> est toujours 
sur une seule ligne !</P>

<P>Malheureusement, certains serveurs génèrent un nombre de messages très 
variable ! Vous aurez peut-être besoin de vous connecter plusieurs fois
avec <CODE>minicom</CODE> pour comprendre comment ça marche et récupérer une chaîne 
&quot;d'attente&quot; stable.</P>

<H2><A NAME="ss15.5">15.5 Un script chat pour les connections authentifiées avec PAP/CHAP</A>
</H2>

<P>Si votre FAI utilise PAP/CHAP, alors votre script <CODE>chat</CODE> est bien plus 
simple. Tout ce que votre script <CODE>chat</CODE> doit faire est de composer le 
numéro, attendre
la connexion et ensuite laisser <CODE>pppd</CODE> s'occuper du processus de connexion !</P>
<P>
<HR>
<PRE>
#!/bin/sh
#
# C'est la deuxieme partie du script ppp-on. Il contient le protocole de 
# connexion de la connexion desiree.
#
exec /usr/sbin/chat -v                                  \
        TIMEOUT         3                               \
        ABORT           '\nBUSY\r'                      \
        ABORT           '\nNO ANSWER\r'                 \
        ABORT           '\nRINGING\r\n\r\nRINGING\r'    \
        ''              \rAT                            \
        'OK-+++\c-OK'   ATH0                            \
        TIMEOUT         30                              \
        OK              ATDT$TELEPHONE                  \
        CONNECT         ''                              \
</PRE>
<HR>
</P>

<H2><A NAME="ss15.6">15.6 Les options <CODE>debug</CODE> et <CODE>file option_file</CODE> de pppd</A>
</H2>

<P>Comme nous l'avons déjà vu, vous pouvez activer les informations de débuggage
avec l'option -d de pppd. L'option 'debug' est équivalente à celle-ci.</P>

<P>Puisque vous établissez la connexion avec un nouveau script, laissez pour le
moment les informations de débuggage. (Attention : si votre espace disque est
réduit, les échanges de connexion de <CODE>pppd</CODE> peuvent rapidement augmenter 
votre fichier syslog et vous amener des problèmes - mais pour aller jusque là,
il faut que vous essayez et vous échouiez vos connexions un certain temps).</P>

<P>Une fois que tout marche correctement, vous pouvez alors enlever cette option.</P>

<P>Si vous avez appelé votre fichier d'options de ppp autrement que
<CODE>/etc/ppp/options</CODE> ou <CODE>/etc/ppp/options.ttySx</CODE>, spécifiez le
nom du fichier avec l'option <CODE>file</CODE> de <CODE>pppd</CODE> :</P>
<P>
<HR>
<PRE>
exec /usr/sbin/pppd debug file options.myserver /dev/ttyS0 38400 \
</PRE>
<HR>
</P>

<H2><A NAME="s16">16. Testez votre script de connexion</A></H2>

<P>Ouvrez un nouveau Xterm <B>root</B> (si vous êtes sous X) ou ouvrez une nouvelle 
console virtuelle et connectez vous comme <B>root</B>.</P>

<P>Dans cette nouvelle session, tapez la commande</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
tail -f /var/log/messages
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>(ou l'endroit exact ou se trouve le fichier log).</P>

<P>Dans la première fenêtre (ou console virtuelle), tapez la commande</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
ppp-on &amp;
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>(ou le nom que vous avez donné à la nouvelle version de votre  /usr/sbin/ppp-
on). Si vous ne mettez pas le script en tâche de fond en spécifiant &amp; en
fin de commande, vous ne récupérerez pas le prompt de votre terminal avant
que ppp se termine (ou que la liaison se termine).</P>

<P>Maintenant revenez dans la fenêtre ou vous affichez votre journal système.</P>

<P>L'affichage devrait ressembler à ce qui suit (si vous avez spécifié l'option -vi
a <CODE>chat</CODE> et -d à <CODE>pppd</CODE> )....c'est le déroulement du script <CODE>chat</CODE> et 
des réponses envoyées dans le fichier journal système suivi des informations 
de démarrage de <CODE>pppd</CODE> :</P>
<P>
<HR>
<PRE>
Oct 21 16:09:58 hwin chat[19868]: abort on (NO CARRIER)
Oct 21 16:09:59 hwin chat[19868]: abort on (BUSY)
Oct 21 16:09:59 hwin chat[19868]: send (ATZ^M)
Oct 21 16:09:59 hwin chat[19868]: expect (OK)
Oct 21 16:10:00 hwin chat[19868]: ATZ^M^M
Oct 21 16:10:00 hwin chat[19868]: OK -- got it
Oct 21 16:10:00 hwin chat[19868]: send (ATDT722298^M)
Oct 21 16:10:00 hwin chat[19868]: expect (CONNECT)
Oct 21 16:10:00 hwin chat[19868]: ^M
Oct 21 16:10:22 hwin chat[19868]: ATDT722298^M^M
Oct 21 16:10:22 hwin chat[19868]: CONNECT -- got it
Oct 21 16:10:22 hwin chat[19868]: send (^M)
Oct 21 16:10:22 hwin chat[19868]: expect (ogin:)
Oct 21 16:10:23 hwin chat[19868]: kepler login: -- got it
Oct 21 16:10:23 hwin chat[19868]: send (hartr^M)
Oct 21 16:10:23 hwin chat[19868]: expect (ssword:)
Oct 21 16:10:23 hwin chat[19868]:  hartr^M
Oct 21 16:10:23 hwin chat[19868]: Password: -- got it
Oct 21 16:10:23 hwin chat[19868]: send (??????^M)
Oct 21 16:10:23 hwin chat[19868]: expect (hartr)
Oct 21 16:10:24 hwin chat[19868]: [hartr -- got it
Oct 21 16:10:24 hwin chat[19868]: send (ppp^M)
Oct 21 16:10:27 hwin pppd[19872]: pppd 2.1.2 started by root, uid 0
Oct 21 16:10:27 hwin pppd[19873]: Using interface ppp0
Oct 21 16:10:27 hwin pppd[19873]: Connect: ppp0 &lt;--> /dev/cua1
Oct 21 16:10:27 hwin pppd[19873]: fsm_sdata(LCP): Sent code 1, id 1.
Oct 21 16:10:27 hwin pppd[19873]: LCP: sending Configure-Request, id 1
Oct 21 16:10:27 hwin pppd[19873]: fsm_rconfreq(LCP): Rcvd id 1.
Oct 21 16:10:27 hwin pppd[19873]: lcp_reqci: rcvd MRU
Oct 21 16:10:27 hwin pppd[19873]: (1500)
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: lcp_reqci: rcvd ASYNCMAP
Oct 21 16:10:27 hwin pppd[19873]: (0)
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: lcp_reqci: rcvd MAGICNUMBER
Oct 21 16:10:27 hwin pppd[19873]: (a098b898)
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: lcp_reqci: rcvd PCOMPRESSION
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: lcp_reqci: rcvd ACCOMPRESSION
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: lcp_reqci: returning CONFACK.
Oct 21 16:10:27 hwin pppd[19873]: fsm_sdata(LCP): Sent code 2, id 1.
Oct 21 16:10:27 hwin pppd[19873]: fsm_rconfack(LCP): Rcvd id 1.
Oct 21 16:10:27 hwin pppd[19873]: fsm_sdata(IPCP): Sent code 1, id 1.
Oct 21 16:10:27 hwin pppd[19873]: IPCP: sending Configure-Request, id 1
Oct 21 16:10:27 hwin pppd[19873]: fsm_rconfreq(IPCP): Rcvd id 1.
Oct 21 16:10:27 hwin pppd[19873]: ipcp: received ADDR
Oct 21 16:10:27 hwin pppd[19873]: (10.144.153.51)
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: ipcp: received COMPRESSTYPE
Oct 21 16:10:27 hwin pppd[19873]: (45)
Oct 21 16:10:27 hwin pppd[19873]:  (ACK)
Oct 21 16:10:27 hwin pppd[19873]: ipcp: returning Configure-ACK
Oct 21 16:10:28 hwin pppd[19873]: fsm_sdata(IPCP): Sent code 2, id 1.
Oct 21 16:10:30 hwin pppd[19873]: fsm_sdata(IPCP): Sent code 1, id 1.
Oct 21 16:10:30 hwin pppd[19873]: IPCP: sending Configure-Request, id 1
Oct 21 16:10:30 hwin pppd[19873]: fsm_rconfreq(IPCP): Rcvd id 255.
Oct 21 16:10:31 hwin pppd[19873]: ipcp: received ADDR
Oct 21 16:10:31 hwin pppd[19873]: (10.144.153.51)
Oct 21 16:10:31 hwin pppd[19873]:  (ACK)
Oct 21 16:10:31 hwin pppd[19873]: ipcp: received COMPRESSTYPE
Oct 21 16:10:31 hwin pppd[19873]: (45)
Oct 21 16:10:31 hwin pppd[19873]:  (ACK)
Oct 21 16:10:31 hwin pppd[19873]: ipcp: returning Configure-ACK
Oct 21 16:10:31 hwin pppd[19873]: fsm_sdata(IPCP): Sent code 2, id 255.
Oct 21 16:10:31 hwin pppd[19873]: fsm_rconfack(IPCP): Rcvd id 1.
Oct 21 16:10:31 hwin pppd[19873]: ipcp: up
Oct 21 16:10:31 hwin pppd[19873]: local  IP address 10.144.153.104
Oct 21 16:10:31 hwin pppd[19873]: remote IP address 10.144.153.51
</PRE>
<HR>
</P>

<P>(Remarque - j'utilise les adresses IP STATIQUES - ma machine l'envoie au 
serveur PPP - vous ne verrez pas la même chose si vous utilisez des adresses IP
DYNAMIQUES.) Ainsi, le server nécessite une commande spécifique pour démarrer
ppp à la fin.</P>

<P>Ca semble OK - alors testez comme avant avec des ping des adresses IP et des
noms des hôtes.</P>

<P>Lancer votre navigateur web ou n'importe quoi d'autre et allez surfer -
vous êtes connecté !</P>

<H2><A NAME="off"></A> <A NAME="s17">17. Terminer une connexion PPP</A></H2>

<P>Quand vous en avez terminé avec la liaison PPP, utilisez la commande standard
ppp-off pour la terminer (rappel - vous devez être <B>root</B> ou membre du 
groupe PPP ! ).</P>

<P>Dans votre fichier journal de votre système, il devrait y avoir quelque chose 
ressemblant à :</P>
<P>
<HR>
<PRE>
Oct 21 16:10:45 hwin pppd[19873]: Interrupt received: terminating link
Oct 21 16:10:45 hwin pppd[19873]: ipcp: down
Oct 21 16:10:45 hwin pppd[19873]: default route ioctl(SIOCDELRT): Bad address
Oct 21 16:10:45 hwin pppd[19873]: fsm_sdata(LCP): Sent code 5, id 2.
Oct 21 16:10:46 hwin pppd[19873]: fsm_rtermack(LCP).
Oct 21 16:10:46 hwin pppd[19873]: Connection terminated.
Oct 21 16:10:46 hwin pppd[19873]: Exit.
</PRE>
<HR>
</P>

<P>Ne pas s'inquiéter du <CODE>SIOCDELRT</CODE> - c'est juste <CODE>pppd</CODE> qui indique qu'il 
se termine, il n'y a pas à s'en inquiéter.</P>

<H2><A NAME="problemes"></A> <A NAME="s18">18. Résoudre les problèmes </A> </H2>

<P>Il y a de nombreuses raisons pour que votre liaison ne fonctionne pas -
<CODE>chat</CODE> n'a pas réussi à aller jusqu'au bout, vous avez une mauvaise ligne, 
etc.  Regardez votre syslog pour avoir des indications.</P>

<H2><A NAME="ss18.1">18.1 J'ai compilé le support PPP dans le noyau, mais...</A>
</H2>

<P>Un problème relativement courant est que les gens compilent le support PPP
dans leur noyau et après, lorsqu'ils essayent de lancer pppd, le noyau répond
qu'il ne supporte pas ppp ! Un grand nombre de raisons peuvent en être
la cause.</P>

<H3>Bootez-vous avec le bon noyau ?</H3>

<P>Même si vous <B>avez</B> recomplié votre support de ppp dans le noyau, vous ne
bootez pas sur le nouveau noyau. Cela peut arriver si vous n'avez pas mis à
jour <CODE>/etc/lilo.conf</CODE> et relancé lilo.</P>

<P>Une bonne façon de vérifier le noyau est d'envoyer la commande <CODE>uname -a</CODE>,
qui affiche la ligne ressemblant à</P>
<P>
<HR>
<PRE>
Linux archenland 2.0.28 #2 Thu Feb 13 12:31:37 EST 1997 i586
</PRE>
<HR>
</P>

<P>Cela donne la version du noyau et la date à laquelle il a été compilé - ce qui
vous donnera une bonne idée de ce qui se passe.</P>

<H3>Avez-vous compilé le support noyau de ppp comme un module ?</H3>

<P>Si vous avez compilé le support de ppp comme un module, mais n'avez pas fait
d'installation des modules, alors vous pouvez avoir cette erreur. Relisez le
kernel-HOWTO et le fichier README de <CODE>/usr/src/linux</CODE> !</P>

<P>Une autre possibilité concernant les modules est que vous supposez que les
modules sont chargés automatiquement, alors que le daemon <CODE>kerneld</CODE> n'est
pas lancé (il charge et décharge les modules au vol). Vérifiez le mini-HOWTO
kerneld pour des informations sur la configuration de kerneld.</P>

<H3>Utilisez-vous une bonne version de PPP pour votre noyau ?</H3>

<P>Vous <B>devez</B> utiliser ppp-2.2 avec les versions 2.0.x du noyau. Vous pouvez
utiliser ppp-2.2 avec les versions 1.2.x du noyau (si vous le patchez) sinon
vous devez utiliser ppp-2.1.2.</P>

<H3>Lancez vous pppd en étant root ?</H3>

<P>Si vous ne lancez pas <CODE>pppd</CODE> en étant l'utilisateur <B>root</B> (et que 
<CODE>pppd</CODE> n'est pas suid vers <B>root</B>), vous pourrez recevoir ce message.</P>

<H2><A NAME="ss18.2">18.2 Mon modem se connecte mais PPP ne démarre jamais</A>
</H2>

<P>Il y a d'innombrables possibilités avec ça (regardez dans comp.os.linux....).</P>

<P>Une erreur <B>EXTREMEMENT</B> fréquente est que vous avez mal tapé quelque chose
dans vos scripts. La seule chose à faire est de vérifier que vous avez la
conversation entre votre PC Linux et le serveur rapporté dans le syslog
/var/log/message) allez ensuite dans celui-ci <EM>ligne par ligne</EM>. Vous aurez
peut-être besoin d'appeler votre serveur ppp à la main pour revérifier tout ça.</P>

<P>Vous devez vérifier les messages de logs réels très attentivement - et ayez à
l'esprit que les hommes on tendance à lire ce qu'ils PENSENT avoir tapé - et non
ce qu'ils ont sous leurs yeux !</P>

<H2><A NAME="ss18.3">18.3 Le syslog contient &quot;<CODE>serial line is not 8 bit clean</CODE>...&quot;</A>
</H2>

<P>Il y a plusieurs possibilités à cela - comme des retours sur la ligne etc.,
qui peuvent être la conséquence d'une (ou plusieurs) choses.</P>

<P>Pour comprendre ce qui se passe, il est nécessaire de chercher se qui se passe
en coulisses dans <CODE>pppd</CODE> lui-même.</P>

<P>Lorsque <CODE>pppd</CODE> démarre, il envoie des paquets LCP (Link Control Protocol) 
à la machine distante. Si il reçoit une réponse valide il passe ensuite à 
l'étape suivante (avec IPCP - les paquets de contrôle IP) et c'est seulement 
une fois que cette négociation est terminée que les trames IP réelles 
commencent et que vous pouvez utiliser la liaison PPP.</P>

<P>Si il n'y a pas de serveur ppp fonctionnel à l'autre bout quand votre PC envoie
les paquets LCP, ceux-ci sont renvoyés par le processus de login final. Comme
ces paquets utilisent 8 bits, et sont réfléchis avec le 8ème bit (souvenez
vous qu'ASCII est un code 7 bits). PPP s'en aperçoit et s'en plaint.</P>

<P>Il y a plusieurs possibilité pour qu'un réflexion arrive.</P>

<H3>Vous n'êtes pas correctement connecté sur le serveur</H3>

<P>Lorsque le script <CODE>chat</CODE> se termine, <CODE>pppd</CODE> démarre sur votre PC. 
Cependant, si
vous n'avez pas terminé le processus de connexion au serveur (comme envoyer
une commande nécessaire à lancer PPP sur le serveur), PPP ne se lancera pas.</P>

<P>Ainsi, le paquet LCP sera réfléchi et vous aurez une erreur.</P>

<P>Vous devez vérifier et corriger (si nécessaire) attentivement votre
script <CODE>chat</CODE> (voir plus haut).</P>

<H3>Vous n'avez pas lancé PPP sur le serveur</H3>

<P>Certains serveurs PPP nécessitent que vous entriez une commande et/ou un
retour chariot après avoir terminé le processus de connexion et avant que
ppp soit lancé à l'autre bout.</P>

<P> 
Vérifiez votre script <CODE>chat</CODE> (voir plus haut).</P>

<P>Si vous vous connectez à la main et que vous vous rendez compte que vous devez
envoyer sur ENTREE après avoir lancé PPP, ajouter simplement une paire 
attente/envoi vide à la fin de votre script <CODE>chat</CODE> (un chaîne vide envoie 
en fait ENTREE).</P>

<H2><A NAME="ss18.4">18.4 Le processus PPP distant est long à démarrer</A>
</H2>

<P>Là c'est un peu délicat !</P>

<P>Par défaut, votre <CODE>pppd</CODE> Linux est compilé pour envoyer un maximum de 10 
requêtes LCP de configuration. Si le serveur est un peu lent à démarrer, la 
totalité des 10 requêtes auront été envoyées avant que le serveur PPP distant 
n'ait eu le temps de les recevoir.</P>

<P>Sur votre machine, <CODE>pppd</CODE> voit la réflexion des 10 requêtes (avec le 8éme bit
inversé) et s'arrête.</P>

<P>Il y a deux façon de résoudre cela :</P>

<P>Ajouter <CODE>lcp-max-configure 30</CODE> comme option de ppp. Cela augmentera le
nombre de packets de configuration LCP que <CODE>pppd</CODE> enverra avant d'abandonner.
Pour les serveurs vraiment lents, vous devez même mettre plus que ça.</P>

<P>Sinon, vous pouvez être un peu malin de votre côté. Vous avez peut-être 
remarqué que lorsque vous vous connectez à la main au serveur PPP et que vous
démarrez alors PPP, le <B>premier</B> caractère que ppp envoie et qui apparaît est
toujours le caractère tilda (~).</P>

<P>En savant cela, vous pouvez ajouter une nouvelle paire <CODE>attente/envoi</CODE> à
la fin de votre script <CODE>chat</CODE> qui attendra un tilda et n'enverra rien. Cela
ressemblera alors à :</P>
<P>
<HR>
<PRE>
\~      ''
</PRE>
<HR>
</P>

<P>Remarque : comme le caractère tilda a une signification particulière pour le
shell, il doit être échappé (en fait précédé par un backslash).</P>

<H2><A NAME="ss18.5">18.5 La route par défaut n'est pas configurée</A>
</H2>

<P>Si <CODE>pppd</CODE> refuse de configurer la route par défaut, c'est parce que (assez 
justement) il refuse de remplacer/supprimer une route par défaut existante.</P>

<P>La raison habituelle lorsque cette erreur apparaît est que certaines 
distributions configurent une route par défaut pour votre carte Ethernet
au lieu de la configurer comme une route réseau spécifique.</P>

<P>Voir le Linux NAG et le HOWTO Net2/3 pour des informations sur la façon de 
configurer correctement votre carte Ethernet et les routes associées.</P>

<P>Une alternative à cela est que votre réseau local utilise déjà un
gateway/routeur et que votre table de routage est déjà configurée pour envoyer
la route par défaut à cet endroit.</P>

<P>Résoudre cette situation peut nécessiter quelques connaissances de réseau IP
qui sort du domaine de ce HOWTO. Il est suggéré d'obtenir l'avis d'un expert
(par les groupes de news ou quelqu'un que vous pouvez interroger près de vous).</P>

<H2><A NAME="ss18.6">18.6 Autres problèmes</A>
</H2>

<P>Il y a des tas de raisons autres que celles-ci pour que ppp ne parvienne pas
à se connecter et/ou fonctionner correctement.</P>

<P>Lisez la FAQ PPP(qui est une série de questions-réponses). C'est un document
très didactique et les réponses y SONT ! De ma propre (et triste) expérience,
si la réponse à votre problème n'est pas dedans, votre problème N'est PAS de la
faute de ppp ! Pour ma part, j'utilisais un noyau ELF alors que je n'avais pas
mis à jour les modules du noyau. J'ai juste perdu 2 jours (et presque une 
nuit) à chercher comment doit être un serveur PPP parfait avant de faire 
lumière !</P>

<H2><A NAME="s19">19. Obtenir de l'aide quand on est totalement perdu</A></H2>

<P>Si vous n'arrivez pas à faire fonctionner votre liaison PPP, relisez ce 
document et tout vérifier - en conjonction avec les sorties de "chat-v..."
et "pppd -d" dans votre journal système.</P>

<P>Consultez également la documentation de PPP la FAQ et tout les documents
mentionnés ici !</P>

<P>Si vous êtes encore bloqué, essayez les groupes de news comp.os.linux.misc et
comp.os.linux.networking qui sont régulièrement parcourus par des gens
capable de vous aider sur PPP ainsi que dans comp.protocols.ppp</P>

<P>Vous pouvez essayer de m'envoyer personnellement un email, mais si j'ai
une journée (et même une vie) chargé, je ne garanti pas de répondre rapidement
(même pas du tout) selon la quantité de travail en cours et l'état de ma
vie privée !</P>

<P>En particulier - <B>NE POSTEZ PAS DES PAGES ET DES PAGES DE SORTIE DE 
DEBUGGAGE DANS LES NEWS GROUPS NI MEME A MOI PAR EMAIL</B> - c'est une énorme 
perte de bande passante, et la majorité sera envoyé dans /dev/null (à moins 
qu'elle ne soit expressément demandé).</P>

<H2><A NAME="s20">20. Problèmes classiques lorsque la liaison fonctionne</A></H2>

<P>Un des problèmes que vous rencontrerez est que de nombreux fournisseurs 
d'accès est qu'ils ne supporterons que les programmes de connexions qu'ils 
distribuent avec les nouveaux comptes. Il sont (habituellement) pour Microsoft
Windows :-( - et la plupart des bureau d'aide des fournisseurs d'accès
ne sembleront rien savoir au sujet d'Unix (ou Linux). Donc préparez vous
à une assistance limité de leur part !</P>

<P>Vous pouvez évidemment leur faire une faveur et leur apprendre ce qu'est Linux
(certaines personnes au support de votre fournisseur d'accès seront
relativement 'branché' avec le monde Internet est auront une machine Linux
chez eux - bien sûr que ça existe ! )</P>

<H2><A NAME="ss20.1">20.1 Je n'arrive pas à voir après le serveur PPP ou je suis connecté</A>
</H2>

<P>OK - votre connexion PPP est lancée et fonctionne vous pouvez pinger le
serveur PPP avec son adresse IP (la deuxième ou "remote" adresse IP affichée 
par <CODE>ifconfig ppp0</CODE>), mais vous ne pouvez rien atteindre après cela.</P>

<P>Tout d'abord, essayez de pinger les adresses IP que vous avez spécifié dans
/etc/resolv.conf comme serveur de noms. Si elles marchent, vous <B>pouvez</B> 
voir après votre serveur PPP (en tout cas ce qui à une adresse IP identique
à ce que vous avez spécifié). Maintenant essayez de pinger l'adresse 
complète de votre fournisseur d'accès :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
ping mon.fournisseur.internet.fr
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Si ça ne marche pas, vous avez un problème avec la résolution des noms. C'est
probablement à cause d'une faute de frappe dans votre fichier /etc/resolv.conf.
Vérifiez ça attentivement à partir des informations que vous aviez obtenues en
appelant votre fournisseur d'accès. Si ça semble correct, appelez votre
fournisseur d'accès, et vérifiez que vous avez noté l'adresse IP correctement.</P>

<P>Si ça ne marche TOUJOURS pas (et que votre fournisseur d'accès vous confirme
que le serveur de noms fonctionne correctement), vous devez avoir un problème
ailleurs - et je vous suggère de vérifier votre installation de Linux 
(en particulier les permissions des fichiers).</P>

<P>Si vous ne pouvez TOUJOURS pas pinger le serveur de nom de votre fournisseur
d'accès par l'adresse IP, soit il est éteint (appelez les par téléphone et 
vérifiez) soit il y a un problème de routage du côté de votre fournisseur
d'accès. De même appelez-les et demandez leur.</P>

<P>Un autre possibilité est qu'à l'autre bout le serveur PPP Linux n'ait pas
l'option IP forwarding d'activée dans le noyau !</P>

<P>Un bon test est d'essayer de se connecter avec le programme que votre 
fournisseur d'accès vous a donné pour (oups) Microsoft Windows. Si tout marche
sur un autre système d'exploitation avec exactement le même compte, alors
le problème vient de votre machine Linux et NON de votre fournisseur d'accès.</P>

<H2><A NAME="ss20.2">20.2 Je peux envoyer du courrier mais pas en recevoir</A>
</H2>

<P>Si vous avez une adresse IP dynamique, c'est tout à fait normal. Voir 
"Configurer les services" plus bas.</P>

<H2><A NAME="ss20.3">20.3 Pourquoi les gens ne peuvent pas faire de finger, WWW, gopher, talk etc</A>
avec ma machine ?</H2>

<P>La aussi, si vous utilisez une adresse IP dynamique c'est tout à fait normal.
voir "Configurer les services" plus bas.</P>


<H2><A NAME="dynamic-serveur"></A> <A NAME="s21">21. Utiliser les services Internet avec des adresses IP dynamiques</A></H2>

<P>Si vous utilisez une adresse IP dynamique (et tous les provideurs ne vous
donnerons qu'une adresse dynamique à moins que vous ne payez bien plus pour
votre connexion), vous devez accepter les limitations qu'elle impose.</P>

<P>Tout d'abord, les requêtes pour les services sortant fonctionneront 
parfaitement. Cela signifie que vous pourrez envoyer du courrier avec sendmail
(si sendmail est configuré correctement), les fichiers ftp pour les sites 
distants, les fingers vers d'autres machines, surfer sur le web etc.</P>

<P>En particulier, vous pourrez répondre au courrier que vous avez reçu même si 
votre machine n'est plus connectée. Le courrier restera dans votre queue de
messages jusqu'à ce que vous appeliez votre FAI.</P>

<P> 
Cependant, votre machine N'est PAS connectée à Internet 24H/24, et en plus elle
n'a pas la même adresse IP à chaque fois qu'elle se connecte. Il est donc
impossible de recevoir du courrier électronique directement sur votre machine,
et de créer un serveur web et ftp que vos amis pourraient accéder ! A partir
du moment ou ça concerne Internet, votre machine n'est pas unique, ni accessible
de manière permanente comme cela serait le cas avec une adresse IP unique
(rappel - les autres machines utilisent les adresses IP pour accéder à votre 
machine).</P>

<P>Si vous configurez en serveur WWW (ou n'importe quoi d'autre), il est 
totalement inconnu des utilisateurs d'Internet A MOINS QU'ils soient au 
courant que votre machine est connectée et qu'ils connaissent votre adresse IP
courante. Il y a plusieurs façon de fournir cette information, vous demander
par téléphone, leur envoyer un e-mail pour leur dire, ou utiliser un fichier
".plan" sur le compte shell de votre fournisseur d'accès (en partant du 
principe que votre fournisseur d'accès permet les script shell et les finger).</P>

<P>Maintenant, pour la majorité des utilisateurs, ça n'est pas vraiment un 
problème - la plupart des gens veulent pouvoir envoyer et recevoir leur email
(sur le compte de leur fournisseur d'accès) et faire des connexions sortantes
vers WWW, ftp et d'autres services d'Internet. Si vous AVEZ un besoin impératif
de connexion sortantes, vous feriez mieux de prendre une adresse IP statique.
Cependant, vous pouvez aussi explorer les méthodes astucieuses ci dessous...</P>

<H2><A NAME="ss21.1">21.1 Configurer le courrier électronique (email)</A>
</H2>

<P>Même avec une adresse IP dynamique, vous devrez certainement configurer 
sendmail sur votre machine pour envoyer le courrier que vous écrivez localement.
La configuration de sendmail peut être obscure et difficile - ce document
ne vous parleras pas de la façon de faire. Cependant, vous aimeriez sans doute
configurer sendmail pour que votre fournisseur d'accès soit considéré comme 
un hôte "smart relay" (l'options <B>DS</B> de sendmail). (Pour plus d'info sur
la configuration de sendmail, voir la documentation de sendmail - et regardez 
la configuration de m4 fourni avec sendmail. Il y a forcement quelque chose
qui réponds à ce que vous cherchez).</P>

<P>Il y a un excellent livre sur Sendmail (une véritable 'bible' aux éditions
O'Reilly and Associates), mais c'est certainement beaucoup trop pour la 
plupart des utilisateurs !</P>

<P>Une fois que vous avez configuré sendmail, vous avez probablement envie que
sendmail envoie les messages en attente dès que la connexion PPP est lancée.
Pour cela, ajouter la commande</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
sendmail -q &amp;
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>dans votre script /etc/ppp/ip-up (voir plus haut).</P>

<P>Les mails entrant sont problématique avec les adresses IP dynamiques. La
façon de les supporter est de :
<UL>
<LI>configurer votre lecteur d'email pour que le courrier contiennent un
champ "reply to" dans lequel il y aura votre adresse électronique chez votre
fournisseur d'accès.<BR> 
Si vous le pouvez, configurez également le champ FROM avec votre adresse
électronique chez votre FAI.
</LI>
<LI>utiliser les programmes popclient, fetchmail pour récupérer le courrier
chez votre fournisseur d'accès. Ou bien, si votre FAI utilise IMAP, utilisez
un lecteur de courrier électronique ayant IMAP d'activé (comme pine).</LI>
</UL>
</P>

<P>Vous pouvez automatiser ce processus lors de l'appel en ajoutant la commande
nécessaire dans le script <CODE>/etc/ppp/ip-up</CODE> (voir plus haut).</P>

<H2><A NAME="ss21.2">21.2 Configurer un serveur de noms local</A>
</H2>

<P>Même si vous êtes content d'utiliser le serveur de noms situé chez votre
fournisseur d'accès, vous pouvez en plus configurer un serveur de nom local
(secondaire) de cache uniquement qui serait lancé avec le script ip-up. 
L'avantage d'utiliser un serveur de noms local (cache uniquement) est de gagner
du temps (et de la bande passante) si vous contactez souvent les même sites 
pendant de longues sessions en ligne.</P>

<P>La configuration du DNS pour un serveur de cache seulement (qui utilise une
ligne 'forwarders' dans le fichier named.boot pointant sur le DNS de votre FAI)
est relativement simple. Le livre O'Reilly (DNS et Bind) explique tout ce que
vous devez savoir sur le sujet.</P>

<P>Il existe également un DNS-HOWTO.</P>

<P>Si un petit réseau local accède à Internet grâce à votre PC Linux (avec IP
masquerading par exemple), c'est sans doute une excellente idée d'utiliser
un serveur de noms (avec la directive forwarders) puisque cela réduira les
delais et la bande passante utilisée pour la résolution des noms.</P>

<P>Un point de la Netiquette : demandez la permission à votre fournisseur d'accès
avant de mettre en place un serveur de noms secondaire de cache uniquement dans
le domaine de votre FAI. Configuré correctement, il n'entrainera aucun problème
chez votre FAI, mais si il ne l'est pas, il peut causer de nombreux problèmes.</P>

<H2><A NAME="s22">22. Relier deux réseaux locaux avec PPP</A></H2>

<P>Il y a fondamentalement aucune différence entre le fait de relier un seul PC
Linux avec PPP et relier deux réseaux locaux avec PPP et une machine sur
chaque réseau. Souvenez-vous PPP est un protocole <B>réversible</B>.</P>

<P>Cependant, vous devez <B>REELLEMENT</B> comprendre comment le routage se déroule.
Lisez le NET-2 HOWTO et le Guide d'administration Linux (NAG). Vous trouverez
également une aide inestimable dans le  &quot; TCP/IP Network
Administration&quot; (publié par O'Reilly and Assoc - ISBN 0-937175-82-X) </P>

<P>Si vous utilisez une adresse de sous-réseau de chaque côté de la liaison, le
(brouillon) de mini-howto Linux sub networking pourra vous être utile.
Il est disponible à 
<A HREF="http://www.interweft.com.au/other/">Linux Sub networking mini-HOWTO</A>.</P>

<P>Pour relier deux réseaux locaux, vous <B>devez</B> utiliser des adresses IP
différentes (ou des sous-réseau d'adresses différentes) et vous devrez utiliser
des adresses IP statiques ou l'IP Masquerading. Si vous voulez utiliser
l'IP Masquerading, consultez le mini-howto IP masquerade pour avoir des 
instructions sur la manière de le configurer.</P>

<H2><A NAME="ss22.1">22.1 Configurer les adresses IP</A>
</H2>

<P>Arrangez-vous avec l'administrateur système de l'autre réseau local pour
choisir les adresses IP qui seront utilisés de chaque côté de l'interface PPP. 
Si vous utilisez des adresses IP statiques, il sera sans doute pratique 
d'appeler un numéro de téléphone dédié.</P>

<P>Maintenant, éditez le fichier <CODE>/etc/ppp/options[.ttyXX]</CODE> approprié - il
est judicieux d'avoir un modem et un port dédié de chaque côté de la connexion.
Cela nécessite quelques changements dans le fichier <CODE>/etc/ppp/options</CODE>
et la création d'un fichier options.ttyXX approprié pour les autres connexions !</P>

<P>Spécifiez les adresses IP pour le côté de votre liaison PPP dans les fichiers
d'options appropriés exactement comme cela est décris plus haut pour les 
adresses IP statiques.</P>

<H2><A NAME="ss22.2">22.2 Configurer le routage.</A>
</H2>

<P>Vous devez vous occuper que les paquets du réseau local soit routés à travers
l'interface lorsque la liaison PPP est lancée. Ce processus se fait en deux 
parties.</P>

<P>Tout d'abord, vous devez configurer une route partant de la machine qui
fait marcher la liaison PPP vers le réseau situé à l'autre bout. Si
cette liaison donne sur Internet, vous pouvez utilisez la route par défaut
mise en place par <CODE>pppd</CODE> lui-même à la connexion avec l'option 
<CODE>defaultroute</CODE>.</P>

<P>Si toutefois, la liaison relie seulement deux réseaux locaux, alors une
route réseau spécifique doit être ajoutée pour tous les réseaux accessible
par cette liaison. C'est la commande 'route' qui le fait pour chaque réseau
dans le script /etc/ppp/ip-up script (voir une fois que la liaison 
fonctionne...) pour des instructions détaillées.</P>

<P>La seconde chose dont vous avez besoin est de prévenir les autres ordinateurs
que vous êtes le gateway vers les réseaux situés à l'autre bout de la liaison.</P>

<P>Bien sûr, l'administrateur réseau de l'autre coté de la liaison doit faire les
même choses ! Cependant, puisque qu'il route les paquets vers votre
réseau particulier, une <B>route réseau spécifique</B> est indispensable, et non
la route par défaut (à moins que le réseau situé à l'autre bout se connecte
chez vous pour accéder à Internet).</P>

<H2><A NAME="ss22.3">22.3 Sécurité réseau</A>
</H2>

<P>Si vous reliez votre réseau local à Internet avec PPP - ou du moins avec un
réseau local &quot;étranger&quot;, vous devez réfléchir aux problèmes de 
sécurité. Je vous conseille fermement de penser à configurer un firewall !</P>

<P>Vous devriez également parler à l'administrateur réseau de votre site
<B>AVANT</B> de lancer une connexion vers un réseau local étranger voire vers
Internet ce cette manière. Ne rien faire peut soit n'amener aucune réaction
soit de sérieux problèmes !</P>

<H2><A NAME="ip-up"></A> <A NAME="s23">23. Une fois que la connexion fonctionne - le script <CODE>/etc/ppp/ip-up</CODE></A></H2>

<P>Une fois que la connexion est établie, <CODE>pppd</CODE> cherche un 
<CODE>/etc/ppp/ip-up</CODE>.
Si ce script existe et est exécutable, le daemon PPP le lance. Cela permet
d'automatiser des commandes de routages spéciales qui peuvent être nécessaires
et toutes les autres actions que vous souhaitez lancer une fois que la liaison
PPP est activée.</P>

<P>C'est un simple script shell qui fait uniquement ce qu'un script shell peut 
faire (en fait quasiment tout ce que vous voulez).</P>

<P>Par exemple, vous pouvez demander à sendmail d'envoyer les messages en attentes.</P>

<P>Il y a quelques restrictions avec <CODE>/etc/ppp/ip-up</CODE>:</P>
<P>
<UL>
<LI>Il fonctionne délibéremment dans un environnement réduit pour augmenter
la sécurité. Cela signifie que vous devez donner le chemin complet des 
exécutables.</LI>
<LI>Techniquement, <CODE>/etc/ppp/ip-up</CODE> est un <EM>programme</EM> et non un
script. Cela signifie qu'il ne peut pas être exécuté directement - même si
il a besoin du (<CODE>#!/bin/bash</CODE>) magique au début de la première ligne
et qu'il doit être lisible est exécutable par root.</LI>
</UL>
</P>


<H2><A NAME="ss23.1">23.1 Routages spéciaux</A>
</H2>

<P>Si vous reliez deux réseaux locaux, vous devez configurer des routes 
spécifiques vers le réseau 'étranger'. Le script <CODE>/etc/ppp/ip-up</CODE> peut
le faire facilement. La seule difficulté est lorsque votre machine supporte
plusieurs liaisons PPP.</P>

<P><CODE>/etc/ppp/ip-up</CODE> est utilisé à chaque lancement de ppp, vous devez donc
être extrêmement vigilant d'exécuter les commandes de routage correctes pour
la liaison qui démarre - et non lorsque n'importe quelle liaison démarre !</P>

<H2><A NAME="ss23.2">23.2 Support du courrier électronique en attente</A>
</H2>

<P>Lorsqu'une liaison entre deux réseaux locaux démarre, vous voudriez vous
assurez que le courrier en attente de chaque coté de la liaison est bien
envoyé à son destinataire. Cela est possible en ajoutant un appel correct à
<CODE>sendmail</CODE>.</P>

<P>Utiliser la commande case du bash sur le bon paramètre que passe pppd
au script permet cela. Par exemple, voici un script <CODE>/etc/ppp/ip-up</CODE> que
j'utilise pour mes liaisons entre l'entreprise et chez mon réseau Ethernet 
(également connecté au même serveur ppp).</P>

<H2><A NAME="ss23.3">23.3 Un exemple de script <CODE>/etc/ppp/ip-up</CODE></A>
</H2>

<P>Le script suivant permet de nombreuses utilisations.</P>
<P>
<HR>
<PRE>
#!/bin/bash
#
# Script permettant de supporter les possiblites de routages necessaires a pppd
# Seule la liaison vers Newman necessite ce support.
#
# Quand la liaison ppp demarre, ce script est appele avec les parmetres 
# suivants
#       $1      le nom de l'interface utilisee par pppd (c.-a-d. ppp3)
#       $2      le nom du peripherique tty
#       $3      la vitesse du peripherique tty
#       $4      l'adresse IP locale de l'interface
#       $5      l'adresse  IP distante
#       $6      le parametre specifie par l'option 'ipparam' a pppd
#
case "$5" in
# Supporte le routage vers le serveur du Newman Campus
        202.12.126.1)
                /sbin/route add -net 202.12.126.0 gw 202.12.126.1
# et envoie les courriers en attente la-bas !
                /usr/sbin/sendmail -q &amp;
                ;;
        139.130.177.2)
# Notre liaison Internet
# Lorsque notre liaison est lancee, demarre le serveur de temps et 
# se synchronise avec le monde si il n'a pas encore bouge.
                if [ ! -f /var/lock/subsys/xntpd ]; then
                        /etc/rc.d/init.d/xntpd.init start &amp;
                fi
# Demarre le serveur de news (si il ne marche pas encore)
                if [ ! -f /var/lock/subsys/news ]; then
                        /etc/rc.d/init.d/news start &amp;
                fi
                ;;
        203.18.8.104)
# Recupere le courrier electronique sur ma machine tant que la liaison 
# fonctionne. Aucun routage n'est necessaire tant que mon reseau local
# Ethernet supporte IP masquerade et le routages proxyarp.
                /usr/sbin/sendmail -q &amp;
                ;;
        *)
esac
exit 0
</PRE>
<HR>
</P>

<P>Le résultat du lancement de la liaison PPP vers notre campus Newman et le 
démarrage de ce script, détermine les entrées de la table de routage (cette 
machine est aussi notre serveur PPP général ET supporte nos liaisons Internet).
J'ai ajouté des commentaires sur la sortie pour expliquer a quoi correspond
chaque entrée) :</P>
<P>
<HR>
<PRE>
[root@kepler /root]# route -n
Kernel routing table
Destination     Gateway         Genmask         Flags MSS    Window Use Iface
# la route de l'HOTE de notre gateway internet
139.130.177.2   *               255.255.255.255 UH    1500   0      134 ppp4
# la route de l'HOTE vers le serveur Newman campus
202.12.126.1    *               255.255.255.255 UH    1500   0       82 ppp5
# la route de l'HOTE de mon réseau local ethernet
203.18.8.104    *               255.255.255.255 UH    1500   0       74 ppp3
# deux des lignes générales PPP
203.18.8.64     *               255.255.255.255 UH    552    0        0 ppp2
203.18.8.62     *               255.255.255.255 UH    552    0        1 ppp1
# la route réseau specifique vers le réseau Newman campus
202.12.126.0    202.12.126.1    255.255.255.0   UG    1500   0        0 ppp5
# la route de notre réseau local Ethernet (super-netting two adjacent C classes)
203.18.8.0      *               255.255.254.0   U     1500   0     1683 eth0
# la route vers le périphérique loop back
127.0.0.0       *               255.0.0.0       U     3584   0      483 lo
# la route par défaut vers Internet
default         139.130.177.2   *               UG    1500   0     3633 ppp4
</PRE>
<HR>
</P>

<H2><A NAME="ss23.4">23.4 Support du courrier électronique</A>
</H2>

<P>La section précédente montrait comment supporter le mail sortant - en
envoyant simplement le courrier lorsque la liaison démarrait.</P>

<P>Si vous utilisez une liaison pour un réseau large, vous pouvez vous arranger 
avec l'administrateur réseau du site distant pour qu'il fasse exactement la 
même chose. Par exemple, à l'autre bout de la liaison au Newman Campus, le 
script <CODE>/etc/ppp/ip-up</CODE> ressemble à :</P>
<P>
<HR>
<PRE>
#!/bin/bash
#
# Script permettant de supporter les possiblites de routages necessaires a pppd
# Seule la liaison vers Hedland necessite ce support.
#
# Quand la liaison ppp demarre, ce script est appele avec les parmetres 
# suivants
#       $1      le nom de l'interface utilisee par pppd (c.-a-d. ppp3)
#       $2      le nom du peripherique tty
#       $3      la vitesse du peripherique tty
#       $4      l'adresse IP locale de l'interface
#       $5      l'adresse  IP distante
#       $6      le parametre specifie par l'option 'ipparam' a pppd
#
case "$5" in
        203.18.8.4)
                /usr/sbin/sendmail -q
                ;;
        *)
esac
exit 0
</PRE>
<HR>
</P>

<P>Si toutefois, vous n'avez qu'une adresse IP dynamique chez votre FAI, vous
devrez recevoir votre courrier sur le compte de votre fournisseur d'accès. Cela
est généralement possible en utilisant POP (Post Office Protocol). Ce processus
peut être supporté avec le programme 'popclient" - le script ip-up peut
automatiser le processus pour vous !</P>

<P>Créez simplement un script <CODE>/etc/ppp/ip-up</CODE> qui contient un appel correct
à popclient. Pour mon portable avec la RedHat Linux (que je prends lorsque je
voyage), j'ai </P>
<P>
<HR>
<PRE>
popclient -3 -c -u hartr -p &lt;password> kepler.hedland.edu.au |formail -s procmail
</PRE>
<HR>
</P>

<P>Vous pouvez aussi utiliser slurp en quelque chose d'autre d'identique pour les
news, et d'autres trucs. Souvenez vous que le script ip-up est un script bash
standard et qui peut servir à automatiser TOUTES les fonctions que vous devez
accomplir chaque fois qu'une liaison PPP correspondante démarre.</P>

<H2><A NAME="s24">24. Utiliser <CODE>/etc/ppp/ip-down</CODE></A></H2>

<P>Vous pouvez écrire un script, qui sera exécuté à chaque fois qu'une liaison se
termine. Qui se situe dans <CODE>/etc/ppp/ip-down</CODE>. Il peut être utilisé pour
retirer ce que vous avez ajoutez de spécial avec le script /etc/ppp/ip-up
correspondant.</P>

<H2><A NAME="s25">25. Possibilité de routage sur un réseau local</A></H2>

<P>Si vous êtes connecté sur un réseau local et que vous voulez toujours utiliser
PPP avec votre machine Linux, vous devez définir les routes que les packets
doivent prendre pour atteindre le réseau local à partir de votre machine (par
l'interface Ethernet) et également le serveur PPP distant voire plus loin.</P>

<P>Cette section ne prétend pas vous apprendre le routage - elle traite seulement
de cas simples et spéciaux de routage (statique) !</P>

<P>Je vous recommande chaudement de lire de Guide d'administration Réseau Linux
si vous n'êtes pas habitué avec le routage. De même le livre d'O'Reilly
"TCP/IP Network Administration" couvre le sujet de manière très abordable.</P>

<P>La règle de base du routage statique est que la route par DEFAUT pointe à
l'endroit où il y le PLUS grand nombre d'adresse réseau. Pour les autres
réseau, entrés des routes spécifiques dans la table de routage.</P>

<P>La SEULE situation que je couvre ici est lorsque votre machine Linux est sur
un réseau non connecté à Internet - et vous voulez vous connectez à Internet
pour une utilisation personnelle tout en restant connecté au réseau local.</P>

<P>Tout d'abord, assurez-vous que votre route Ethernet est bien configuré comme
une adresse réseau spécifique disponible sur votre réseau local - et PAS dans
la route par defaut !</P>

<P>Vérifiez cela en tapant la commande route, vous devriez avoir quelque chose
qui ressemble à ce qui suit :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
[root@hwin /root]# route -n
Kernel routing table
Destination     Gateway         Genmask         Flags MSS    Window Use Iface
loopback        *               255.255.255.0   U     1936   0       50 lo
10.0.0.0        *               255.255.255.0   U     1436   0      565 eth0
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Si votre interface Ethernet (eth0) pointe vers la route par défaut, (la 
première colonne contiendra un "default" dans la ligne eth0) vous devez
changer les scripts d'inititalisation d'Ethernet pour qu'ils utilisent des
adresses réseau spécifiques plutôt que la route par défaut (consultez le
HOWTO Net2 et le NAG).</P>

<P>Cela va permettre à <CODE>pppd</CODE> de configurer votre route par défaut comme suit :</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
[root@hwin /root]# route -n
Kernel routing table

Destination     Gateway         Genmask         Flags MSS    Window Use Iface
10.144.153.51   *               255.255.255.255 UH    488    0        0 ppp0
127.0.0.0       *               255.255.255.0   U     1936   0       50 lo
10.1.0.0        *               255.255.255.0   U     1436   0      569 eth0
default         10.144.153.51   *               UG    488    0        3 ppp0
</PRE>
</CODE></BLOCKQUOTE>
</P>

<P>Comme vous pouvez le voir, nous avons une route d'hôte vers le serveur PPP
(10.144.153.51) par ppp0 qui est également la route par défaut utilisé par
le serveur PPP comme gateway.</P>

<P>Si votre configuration est plus compliqué que cela, lisez les documents
concernant le routage cités plus haut, et consultez un expert de votre site !</P>

<P>Si votre réseau local à aussi des routeurs, vous devez déjà avoir des gateways
pour interconnecter les réseaux disponibles sur votre site. Vous devez TOUJOURS
mettre la route par défaut vers l'interface PPP - et utiliser des routes 
spécifiques pour les autres réseaux que vous accédez.</P>

<H2><A NAME="ss25.1">25.1 Remarques sur la sécurité</A>
</H2>

<P>Lorsque vous configurez une machine Linux sur un réseau local existant sur
Internet, vous ouvrez potentiellement tout votre réseau local vers Internet -
ainsi que les pirates qui l'utilise. Avant de commencer, je vous conseille
vivement de consulter votre administrateur réseau et le responsable de la 
sécurité de votre site. Si votre connexion PPP vers Internet est utilisé et
permet d'attaquer votre site, vous serez dans la plus mauvaise position face
à la colère de vos collègues et votre administrateur système et réseau. Vous
pourriez vous-même avoir de sérieux problèmes !</P>

<P>Avant de connecter un réseau local sur Internet, vous devez prendre en compte
les problèmes de sécurité même avec une connexion DYNAMIQUE - dans ce cas la
référence la plus récente est le "Building Internet Firewalls" d'O'Reilly !</P>

<H2><A NAME="ppp-serveur"></A> <A NAME="s26">26. Configurer un serveur PPP </A></H2>

<P>Comme c'est mentionné plus haut, il y a des tas de façons de faire. Ce que je
présente ici est la façon de faire une liaison tournante sur plusieurs
lignes téléphoniques (avec une carte série multi-ports utilisant des Cyclades)</P>

<P>Si vous n'aimez pas la méthode présentée ici, faites donc comme vous préférez.
J'aimerais toutefois ajouter des méthodes supplémentaires dans les prochaines
versions de ce HOWTO. Envoyez donc moi comment vous faites !</P>

<P>Remarquez que cette section ne concerne que la configuration de Linux comme
serveur PPP. Je ne compte absolument pas donner d'informations sur la façon de
configurer des serveurs terminaux ou autre.</P>

<P>Même si, j'ai déjà expérimenté l'utilisation de shadow password (et l'utilise
de temps en temps). Les informations présentées ici n'utiliserons toutefois
pas ce mécanisme.</P>

<H2><A NAME="ss26.1">26.1 Compiler le noyau</A>
</H2>

<P>Tous les commentaires précédent concernant la compilation du noyau et les
versions du noyau et de <CODE>pppd</CODE> sont encore valables. Cette section 
considère que vous avez lu les sections précédentes du document !</P>

<P>Pour un serveur PPP, vous <B>DEVEZ</B> ajouter le support de IP forwarding
dans votre noyau. Vous pouvez aussi inclure d'autres supports (comme le IP
fire walls, accounting etc etc).</P>

<P>Si vous utilisez une carte série multi-port, vous devez bien entendu inclure
également les pilotes nécessaires dans le noyau !</P>

<H2><A NAME="ss26.2">26.2 Présentation du système de serveur</A>
</H2>

<P>Nous offrons des comptes PPP (ou SLIP) et des comptes shell en utilisant les
mêmes paires nom utilisateur/ mot de passe. Cela permet (pour nous) que les 
utilisateurs n'aient qu'un seul compte qu'ils peuvent utiliser pour toutes
les connexions.</P>

<P>Comme nous sommes une organisation éducative, nous ne faisons pas payer le 
personnel ni les étudiants pour leur accès, et nous n'avons donc pas besoin de
nous inquiéter des problèmes de payement.</P>

<P>Un firewall existe entre notre site et Internet, et cela limite les accès des
utilisateurs puisque les lignes d'appels sont sur notre firewall Internet 
(pour certaines raisons évidentes, le détails des autres firewalls internes
ne sera pas présenté ici et serait de toute façon inutile)</P>

<P>Le processus avec lequel un utilisateur établit une liaison PPP avec notre 
site (une fois qu'ils ont un compte bien sûr) :
<UL>
<LI>Appeler notre ligne d'appel groupé (qui est un numéro de téléphone qui
se connecte sur une banque de modems - le premier modem libre est utilisé).</LI>
<LI>Connexion avec une paire valide de nom utilisateur et mot de passe</LI>
<LI>Au prompt du shell, lancement de la commande <CODE>ppp</CODE> pour lancer PPP sur
le serveur.</LI>
<LI>Démarrer PPP sur le PC (il peut utiliser Windows, DOS, Linux, MAC OS ou
n'importe quoi d'autre - ce n'est pas un problème).</LI>
</UL>
</P>

<P>Le serveur utilise un fichier <CODE>/etc/ppp/options.ttyXX</CODE> individuel pour
chacune des connexions sur le port où est configuré l'adresse IP distante pour
l'allocation des adresses IP dynamiques. Le serveur utilisateur route les 
clients avec proxyarp (configuré avec l'option appropriée de pppd). Cela 
oblige la présence de routed ou gated.</P>

<P>Quand l'utilisateur raccroche de son coté, <CODE>pppd</CODE> le détecte et indique au 
modem de raccrocher, fermant en même temps la liaison PPP.</P>

<H2><A NAME="ss26.3">26.3 Faire marcher les programmes tous ensemble</A>
</H2>

<P>Vous avez besoin des programmes suivants :
<UL>
<LI>Linux, correctement compilé avec les options nécessaires</LI>
<LI>La version de <CODE>pppd</CODE> correspondant à votre noyau</LI>
<LI>Un programme 'getty' qui décroche intelligemment les communications par 
modem. <BR>
Nous utilisons getty_ps2.0.7h, mais mgetty est aussi bien. Je sais que mgetty
peut s'apercevoir qu'un appel utiliser PAP/CHAP (PAP est le standard pour
Windows 95) et invoquer <CODE>ppp</CODE>d automatiquement, mais je dois encore explorer un
peu ça.</LI>
<LI>Un serveur de nom (DNS) fonctionnel qui est accessible pour les 
utilisateurs qui se connectent.</LI>
</UL>
</P>

<P><B>Ce howto ne couvre pas sa configuration. Regardez la documentation de
getty de votre choix ou le serial HOWTO pour plus d'informations sur le sujet.</B></P>

<H2><A NAME="ss26.4">26.4 Configurer les fichiers d'options</A>
</H2>

<P>Vous avez besoin de configurer la totalité de <CODE>/etc/ppp/options</CODE> avec 
les options standard pour les ports d'appel. Les options utiles sont :</P>
<P>
<HR>
<PRE>
asyncmap 0
netmask 255.255.254.0
proxyarp
lock
crtscts
modem
</PRE>
<HR>
</P>

<P>Remarque - nous n'utilisons AUCUN routage (direct) - et en particulier il
n'y a pas d'option defaultroute. La raison de cela est que tout ce dont vous
avez besoin (en tant que serveur PPP) à l'endroit où router les paquets
<B>venant</B> du client ppp vers votre réseau local ou Internet et de 
router les paquets <B>vers</B> le client ppp qui viennent du votre réseau local
ou d'Internet.</P>

<P>Tout ce dont vous avez besoin est la route hôte de la machine client et 
l'utilisation de l'option 'proxyarp' de pppd.</P>

<P>L'option 'proxyarp' configure (surprise) une entrée proxy ARP dans la table
ARP du serveur qui signifie en substance 'envoie moi tous les paquets destinés
au client'. C'est la manière la plus simple de configurer le routage vers un
client PPP unique - mais elle ne peut être utilisé pour le routage entre deux
réseaux locaux - vous devez alors utiliser les routes réseau réelles qui ne
pourront pas utiliser le proxy ARP.</P>

<P>Vous devez certainement avoir envie de fournir des adresses IP dynamiques aux
utilisateurs qui se connectent. Vous pouvez le faire en associant une adresse
IP dynamique sur chaque port d'appel. Créez alors pour chaque port d'appel
un <CODE>/etc/ppp/options.ttyXX</CODE>.</P>

<P>Dedans, mettez simplement l'adresse IP locale du serveur et l'adresse IP
qui doit être utilisé pour ce port. Par exemple </P>
<P>
<HR>
<PRE>
kepler:slip01
</PRE>
<HR>
</P>
<P>Remarquez en particulier que vous pouvez utiliser les noms d'hôtes valides
dans ce fichier (je trouve que c'est la seule façon de se souvenir des adresses
IP des machines importantes de mon réseau, les noms sont bien plus 
significatifs) !</P>

<H2><A NAME="ss26.5">26.5 Configurer pppd pour permettre aux utilisateurs de le lancer</A>
</H2>

<P>Comme configurer une liaison ppp implique de configurer un périphérique dans
le noyau (une interface réseau) et de manipuler les tables de routage, des
privilèges spéciaux sont nécessaires - en fait la totalité des privilèges root.</P>

<P>Heureusement, <CODE>pppd</CODE> est prévu pour marcher correctement avec set uid root.
Vous devez donc
<HR>
<PRE>
chmod u+s /usr/sbin/pppd
</PRE>
<HR>
</P>

<P>Quand vous listez le fichier, il doit apparaître comme cela
<HR>
<PRE>
-rwsr-xr-x   1 root     root        74224 Apr 28 07:17 /usr/sbin/pppd
</PRE>
<HR>
</P>

<P>Si vous n'avez pas ça, vous ne pourrez pas utiliser votre liaison ppp.</P>

<H2><A NAME="ss26.6">26.6 Créer un alias global pour pppd</A>
</H2>

<P>Pour simplifier les choses pour les utilisateurs de notre connexion PPP, nous
créerons un alias global (dans /etc/bashrc) qui est en fait une simple
commande qui lancera ppp sur le serveur dès qu'ils seront connectés.</P>

<P>Cela nous donne
<HR>
<PRE>
alias ppp="exec /usr/sbin/pppd -detach"
</PRE>
<HR>
</P>

<P>Et il fait ceci
<UL>
<LI>exec : va remplacer le programme en cours (dans le cas d'un shell)
par le programme qui va être lancé.</LI>
<LI>pppd -detach : lance <CODE>pppd</CODE> et le laisse pas en tâche de fond. Cela
assure que <CODE>pppd</CODE> existe et qu'il n'y a pas d'autres processus qui traînent.</LI>
</UL>
</P>
<P>Quand un utilisateur se connecte comme cela, il va apparaître après un 'w'
<HR>
<PRE>
  6:24pm  up 3 days,  7:00,  4 users,  load average: 0.05, 0.03, 0.00
User     tty       login@  idle   JCPU   PCPU  what
hartr    ttyC0     3:05am  9:14                -
</PRE>
<HR>
</P>

<P>Et c'est tout... Je vous avais dit que c'était simple un serveur PPP de base !</P>

<H2><A NAME="directe"></A> <A NAME="s27">27. Utiliser PPP avec une connexion null modem </A></H2>

<P>C'est très simple - il n'y a pas de modem et ainsi les choses sont bien plus
facile.</P>

<P>Tout d'abord, choisissez une machine comme 'serveur', configurez getty sur 
le port série pour que vous testiez si vous avez une connectivité en utilisant
minicom sur le 'client'.</P>

<P>Une fois que ça fonctionne, vous pouvez enlever le getty A MOINS que vous 
vouliez être sûr que la connexion permet d'utiliser les paires nom utilisateur/
mot de passe pour les connexions entrantes. Comme vous avez un 'contrôle 
physique' des deux machines, je pense que vous n'avez pas besoin de ça.</P>

<P>Maintenant, sur le serveur, enlevez getty et assurez vous que les ports série
sont configurés correctement sur les deux machines avec 'setserial'.</P>

<P>Tout ce que vous avez besoin maintenant est de démarrer <CODE>pppd</CODE> sur les deux
systèmes. Je suppose que les connexions utilise une connexion par /dev/ttyS34.
Ainsi sur les deux machines lancez la commande :</P>
<P>
<HR>
<PRE>
pppd -detach crtscts lock &lt;local IP>:&lt;remote IP> /dev/ttyS3 38400 &amp;
</PRE>
<HR>
</P>

<P>Cela devrait lancer la connexion - mais pour le moment il n'y a aucun routage 
de spécifié. Vous pouvez tester la connexion en pingant l'autre machine.
Si ça marche, éteignez la liaison en tuant le processus pppd</P>

<P>Le routage dont vous avez besoin dépend de ce que vous voulez faire exactement.
Généralement, une des machines sera connecté sur un réseau Ethernet (et même
plus) le routage nécessaire est donc exactement le même qu'entre un serveur
PPP et un client.</P>

<P>Sur la machine équipée d'Ethernet, la commande sera donc</P>
<P>
<HR>
<PRE>
pppd -detach crtscts lock proxyarp &lt;local IP>:&lt;remote IP> /dev/ttyS3 38400 &amp;
</PRE>
<HR>
</P>

<P>et sur l'autre machine</P>
<P>
<HR>
<PRE>
pppd -detach crtscts lock defaultroute &lt;local IP>:&lt;remote IP> /dev/ttyS3 38400 &amp;
</PRE>
<HR>
</P>
<P>Si vous reliez deux réseaux locaux (avec une liaison série !) vous aurez besoin
d'un routage plus complexe, vous pouvez utiliser /etc/ppp/ip-up exactement
de la même façon qu'il est décrit plus haut.</P>



<P><B>Robert Hart</B><BR>
Port Hedland, Western Australia<BR>
Melbourne, Victoria, Australia
August/October 1996
January/March 1997</P>

</BODY>
</HTML>
