<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>
        Guide pratique du logiciel Linux 
        Crash
    </title><link rel="stylesheet" href="style.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.64.1"><meta name="description" content="
    
        Ce document décrit l'installation et l'utilisation du paquet
        LKCD (Linux Kernel
        Crash Dump). Ce paquet permet la récupération
        d'une copie de la mémoire suite à un plantage du noyau.
    
    "></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article" lang="fr"><div class="titlepage"><div><div><h1 class="title"><a name="id2393956"></a>
        Guide pratique du logiciel <span class="application">Linux 
        Crash</span>
    </h1></div><div><h3 class="subtitle"><i>
        Adaptation française du <span class="foreignphrase"><i class="foreignphrase">Linux Crash
        HOWTO</i></span>
    </i></h3></div><div><div class="author"><h3 class="author"><span class="firstname">Norman</span> <span class="surname">Patten</span></h3><div class="affiliation"><div class="address"><p><br>
        <tt class="email">&lt;<a href="mailto:nepatten%20CHEZ%20us%20POINT%20ibm%20POINT%20com">nepatten CHEZ us POINT ibm POINT com</a>&gt;</tt><br>
      </p></div></div></div></div><div><p class="othercredit"><span class="contrib">Adaptation française</span>: <span class="firstname">Simon</span> <span class="surname">Depiets</span></p></div><div><p class="othercredit"><span class="contrib">Relecture de la version française</span>: <span class="firstname">Karine</span> <span class="surname">Volpi</span></p></div><div><p class="othercredit"><span class="contrib">Préparation de la publication de la v.f.</span>: <span class="firstname">Jean-Philippe</span> <span class="surname">Guérard</span></p></div><div><p class="releaseinfo">1.0.fr.1.0</p></div><div><p class="pubdate">2004-03-21</p></div><div><div class="revhistory"><table border="1" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><b>Historique des versions</b></th></tr><tr><td align="left">Version 1.0.fr.1.0</td><td align="left">2004-03-21</td><td align="left">SD,KV,JPG</td></tr><tr><td align="left" colspan="3">
         
           Première adaptation française
         
         </td></tr><tr><td align="left">Version 1.0</td><td align="left">2002-01-30</td><td align="left">NM</td></tr><tr><td align="left" colspan="3">
           
           Version initiale — <span class="emphasis"><em>Initial
           release.</em></span>
         
         </td></tr></table></div></div><div><div class="abstract"><p class="title"><b>Résumé</b></p><p>
    
        Ce document décrit l'installation et l'utilisation du paquet
        <span class="application">LKCD</span> (<span class="foreignphrase"><i class="foreignphrase">Linux Kernel
        Crash Dump</i></span>). Ce paquet permet la récupération
        d'une copie de la mémoire suite à un plantage du noyau.
    
    </p></div></div></div><div></div><hr></div><div class="toc"><p><b>Table des matières</b></p><dl><dt><span class="section"><a href="#introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#droits.d.utilisation">1.1. Droits d'utilisation</a></span></dt></dl></dd><dt><span class="section"><a href="#comment.ca.marche">2. 
      
        Comment fonctionne LKCD
        
      </a></span></dt><dd><dl><dt><span class="section"><a href="#cedontvousaurezbesoin">2.1. Ce dont vous aurez besoin</a></span></dt></dl></dd><dt><span class="section"><a href="#installation">3. L'installation de LKCD</a></span></dt><dd><dl><dt><span class="section"><a href="#id2435414">3.1. Installer depuis le code source</a></span></dt><dt><span class="section"><a href="#id2435522">3.2. 
        
        Compiler et installer les outils LKCD
        
      </a></span></dt><dt><span class="section"><a href="#id2435594">3.3. 
      
        Qu'est-ce qui est installé
        
      </a></span></dt><dt><span class="section"><a href="#id2435642">3.4. 
        
        Installer les outils LKCD à partir du
        paquet RPM
     
       </a></span></dt><dt><span class="section"><a href="#id2435684">3.5. 
      
        Appliquer le correctif au noyau
        
      </a></span></dt><dt><span class="section"><a href="#id2435761">3.6. 
        
        Compiler et installer le noyau
      
      </a></span></dt></dl></dd><dt><span class="section"><a href="#configuration">4. 
    
      Installer, essayer et lancer crash
      
    </a></span></dt><dd><dl><dt><span class="section"><a href="#id2504163">4.1. 
        
        Installer crash dump
      
      </a></span></dt><dt><span class="section"><a href="#id2504230">4.2. 
        
        Essayer crash
      
      </a></span></dt><dt><span class="section"><a href="#id2504286">4.3. 
     
       Lancez crash
     
     </a></span></dt></dl></dd></dl></div><div class="section" lang="fr"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="introduction"></a>1. Introduction</h2></div></div><div></div></div><p>
    
        Le projet <span class="strong">LKCD</span><sup>[<a name="id2436817" href="#ftn.id2436817">1</a>]</sup>
        
        est un ensemble de correctifs du noyau Linux et d'outils
        permettant de sauvegarder une copie de la mémoire du noyau
        lorsque celui-ci panique. L'image mémoire du noyau permet une
        analyse après coup de la cause de sa panique. Ceci grâce aux
        outils inclus dans le paquet. La plupart des systèmes Unix
        commerciaux sont vendus avec des outils semblables. Sur Linux,
        cependant, ce paquet est assez nouveau et doit être ajouté
        manuellement. L'utilitaire <span class="application">LKCD</span> n'est
        pas destiné à donner des informations utiles dans le cas d'une
        panique causée par un problème matériel ou lors d'une violation
        de la segmentation mémoire. Le paquet
        <span class="application">LKCD</span> complet peut être téléchargé sur
        <a href="http://lkcd.sourceforge.net/" target="_top">http://lkcd.sourceforge.net/</a>.
        
    </p><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="droits.d.utilisation"></a>1.1. Droits d'utilisation</h3></div></div><div></div></div><p>

        Copyright © 2002 Norman Patten.

      </p><p>

        Copyright © 2004 Simon Depiets, Karine Volpi et 
        Jean-Philippe Guérard pour l'adaptation française.

      </p><p>
        
        Vous avez la permission de copier, de distribuer et de modifier
        ce document selon les termes de la licence de documentation
        libre GNU (GFDL), dans sa version 1.1 ou dans une version
        ultérieure, telle que publiée par la Free Software
        Foundation ; sans section invariante, ni texte de première
        de couverture, ni texte de quatrième de couverture. Une copie de
        cette licence est disponible sur <a href="http://www.gnu.org/copyleft/fdl.html" target="_top">http://www.gnu.org/copyleft/fdl.html</a>.

      </p><p><span class="foreignphrase"><i class="foreignphrase">

        Permission is granted to copy, distribute and/or modify this
        document under the terms of the GNU Free Documentation License,
        Version 1.1 or any later version published by the Free Software
        Foundation; with no Invariant Sections, with no Front-Cover
        Texts, and with no Back-Cover Texts. A copy of the license is
        available at <a href="http://www.gnu.org/copyleft/fdl.html" target="_top">http://www.gnu.org/copyleft/fdl.html</a>.

      </i></span></p><p>
      
        Linux est une marque enregistrée de Linus Torvalds. LKCD est
        distribué sous copyright par Silicon Graphics Inc.

      </p><p><span class="foreignphrase"><i class="foreignphrase">

        Linux is a registered trademark of Linus Torvalds . LKCD is 
        distributed under the copyright of Silicon Graphics Inc.

      </i></span></p><p>
      
        Envoyez vos commentaires et corrections en anglais à 
        <tt class="email">&lt;<a href="mailto:nepatten%20CHEZ%20us%20POINT%20ibm%20POINT%20com">nepatten CHEZ us POINT ibm POINT com</a>&gt;</tt>. 
      
      </p><p><span class="foreignphrase"><i class="foreignphrase">

        Send feedback to

        <tt class="email">&lt;<a href="mailto:nepatten%20AT%20us%20DOT%20ibm%20DOT%20com">nepatten AT us DOT ibm DOT com</a>&gt;</tt>. 

      </i></span></p><p>
       
          N'hésitez pas à faire parvenir tout commentaire relatif à la
          version française de ce document à
          
          <tt class="email">&lt;<a href="mailto:commentaires%20CHEZ%20traduc%20POINT%20org">commentaires CHEZ traduc POINT org</a>&gt;</tt>
          
          en précisant le titre et la version de ce document.
      
      </p></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="comment.ca.marche"></a>2. 
      
        Comment fonctionne <span class="application">LKCD</span>
        
      </h2></div></div><div></div></div><p>
    
        Quand un noyau rencontre certaines erreurs, il appelle la
        fonction <tt class="function">panic</tt> qui est produite par une
        erreur irréversible. Lors d'une telle situation,
        <span class="application">LKCD</span> réalisera une copie de la
        mémoire du noyau vers une zone pré-désignée. La zone est par
        défaut la partition d'échange principale (<span class="foreignphrase"><i class="foreignphrase">primary
        swap</i></span>). Le noyau n'est pas complètement
        fonctionnel à cette étape, mais il y dispose de capacités
        suffisantes pour recopier la mémoire sur le disque.  Lorsque la
        copie est terminée, le système redémarre.
      
      </p><p>
            
        Lors du redémarrage du système, si une nouvelle copie de la
        mémoire est trouvée sur la partition d'échange principale, elle
        est copiée par défaut vers le répertoire <tt class="filename">/var/log/dump</tt>. Une fois l'image
        recopiée, le démarrage se poursuit normalement et une analyse
        médico-légale pourra être effectuée plus tard.
      
      </p><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="cedontvousaurezbesoin"></a>2.1. Ce dont vous aurez besoin</h3></div></div><div></div></div><p>
    
          Le fichier
          <tt class="filename">lkcd-<i class="replaceable"><tt>noyauxxx</tt></i>.diff</tt>
          qui est un correctif à appliquer au noyau. La version du noyau
          à laquelle s'applique ce correctif change régulièrement.
          
        </p><p>
          
          <tt class="filename">lkcdutils-<i class="replaceable"><tt>xx</tt></i>.src.rpm</tt>
          — ce sont les scripts et les sources des outils dont
          vous aurez besoin pour installer
          <span class="application">LKCD</span> et lire la copie mémoire. Au
          moment où j'écris, il existe un paquet rpm binaire destiné aux
          processeurs i386. Il est disponible sur <a href="http://lkcd.sourceforge.net/" target="_top">http://lkcd.sourceforge.net/</a>. Cependant, vous aurez
          quand même besoin des correctifs à appliquer aux scripts de
          démarrage. Vous trouverez ces correctifs dans le paquet rpm
          des sources.
        
      </p></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="installation"></a>3. L'installation de <span class="application">LKCD</span></h2></div></div><div></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="id2435414"></a>3.1. Installer depuis le code source</h3></div></div><div></div></div><p>
      
        Téléchargez <tt class="filename">lkcdutils-xxx.src.rpm</tt> et
        installez le en utilisant la commande :
        
      </p><pre class="programlisting">
rpm -i kcdutils-<i class="replaceable"><tt>xxx</tt></i>.src.rpm
</pre><p>

        Cela placera un fichier appelé
        <tt class="filename">lkcdutils-<i class="replaceable"><tt>xxx</tt></i>.tar.gz</tt>
        dans le répertoire <tt class="filename">/usr/src/redhat/SOURCES</tt>. Ce fichier
        est une archive au format tar compressée de l'arborescence des
        sources de <span class="application">LKCD</span>.
        
      </p><p>

        Décompressez les sources dans le répertoire de votre choix,
        comme par exemple <tt class="filename">/usr/src</tt> en utilisant la
        commande :
        
      </p><pre class="programlisting">
tar -zxvf kcdutils-<i class="replaceable"><tt>xxx</tt></i>.src.rpm
</pre><p>

        Cela créera un répertoire appelé
        <tt class="filename">kcdutils-<i class="replaceable"><tt>xxx</tt></i></tt>
        contenant les sources des outils
        <span class="application">LKCD</span>.
              
      </p></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="id2435522"></a>3.2. 
        
        Compiler et installer les outils <span class="application">LKCD</span>
        
      </h3></div></div><div></div></div><p>
  
        <span class="application">LKCD</span> utilise les fichiers
        <span class="application">make</span> et le compilateur
        <span class="application">gcc</span> standards. Pour compiler
        l'ensemble <span class="application">LKCD</span>, rendez-vous au
        répertoire des sources de <span class="application">LKCD</span> et
        lancez <b class="userinput"><tt>./configure</tt></b> pour fabriquer les
        fichiers de configuration. L'étape suivante est de lancer
        <b class="userinput"><tt>make</tt></b> pour compiler les outils et
        finalement <b class="userinput"><tt>make install</tt></b> pour installer
        les outils et les pages de manuels.
        
      </p></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="id2435594"></a>3.3. 
      
        Qu'est-ce qui est installé
        
      </h3></div></div><div></div></div><pre class="screen">
/etc/sysconfig/dump            # Configuration de dump (recopie mémoire)
/sbin/lcrash                   # L'outil « crash » (analyse 
                               #  médico-légale)
/sbin/lkcd                     # Script de paramétrage du système
/sbin/lkcd_config              # Outil de configuration de « dump »
/sbin/lkcd_ksyms               # Outil de reconstruction des symboles du
                               #  noyau
/usr/include/sial_api.h        # Fichier d'en-têtes C des fonctions 
                               #  utilisateurs SIAL
/usr/lib/libsial.a             # Bibliothèque SIAL (Langage Simple 
                               #  d'Accès aux Images)
/usr/man/man1/lcrash.1         # Page de manuel de « lcrash »
/usr/man/man1/lkcd_config.1    # Page de manuel de « lkcd_config »
/usr/man/man1/lkcd_ksyms.1     # Page de manuel de « lkcd_ksyms »
/usr/share/sial/lcrash/ps.sial # Commande ps réalisée avec SIAL
</pre></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="id2435642"></a>3.4. 
        
        Installer les outils <span class="application">LKCD</span> à partir du
        paquet RPM
     
       </h3></div></div><div></div></div><p>
      
        Vous pouvez installer les utilitaires pré-compilés à partir du
        paquet rpm en utilisant la commande :
        
      </p><pre class="programlisting">
rpm -i kcdutils-<i class="replaceable"><tt>xxx</tt></i>.rpm
</pre><p>
      
        Vous aurez toujours à appliquer le correctif au noyau et à
        installer les scripts de démarrage. Cependant vous n'aurez pas à
        effectuer l'étape de compilation des outils.
      
      </p></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="id2435684"></a>3.5. 
      
        Appliquer le correctif au noyau
        
      </h3></div></div><div></div></div><p>
      
        L'étape suivante consiste à appliquer le correctif et à
        recompiler le noyau. Vous devrez appliquer au code source du
        noyau le correctif
        <tt class="filename">lkcd-<i class="replaceable"><tt>xxx</tt></i>.diff</tt>
        que vous aurez téléchargé depuis <a href="http://lkcd.sourceforge.net/" target="_top">http://lkcd.sourceforge.net/</a>. Copiez le correctif dans
        le répertoire des sources noyau et lancez la commande :

      </p><pre class="programlisting">
patch -p0 &lt; lkcd-<i class="replaceable"><tt>noyauxxx</tt></i>.diff
</pre><p>
        
        Assurez-vous que le correctif que vous utilisez est bien pour
        votre version du noyau. Vous devrez ensuite configurer le noyau
        pour activer l'option « Kernel crash dumps ». Cette
        option est désactivée par défaut. Si vous utilisez
        <b class="userinput"><tt>make menuconfig</tt></b> ou <b class="userinput"><tt>make
        xconfig</tt></b>, vous trouverez cette option dans la section
        « Kernel hacking ». N'oubliez pas d'activer les
        fonctions du noyau dont votre système a besoin. Consultez le
        <a href="http://www.traduc.org/docs/howto/lecture/Kernel-HOWTO.html" target="_top">guide pratique du noyau
        Linux</a> pour plus d'informations.
        
      </p></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="id2435761"></a>3.6. 
        
        Compiler et installer le noyau
      
      </h3></div></div><div></div></div><p>
      
        Il vous faut maintenant compiler et installer le noyau incluant
        le support <span class="application">LKCD</span>. Dans le répertoire
        des sources du noyau, lancez dans l'ordre les commandes 
        suivantes :
      
      </p><pre class="screen">
make depend
make install
make modules
make modules_install
</pre><p>

        Cela compilera et installera le nouveau noyau. Vous devrez aussi
        copier le fichier <tt class="filename">Kerntypes</tt> inclus dans les
        sources du noyau dans le répertoire <tt class="filename">/boot</tt>. Il sera peut-être également
        nécessaire d'éditer le fichier <tt class="filename">lilo.conf</tt>
        pour qu'il pointe vers votre nouveau noyau. Consultez le <a href="http://www.traduc.org/docs/howto/lecture/Kernel-HOWTO.html" target="_top">guide pratique du noyau
        Linux</a> pour plus d'informations sur la compilation et
        l'installation d'un nouveau noyau.
    
      </p></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration"></a>4. 
    
      Installer, essayer et lancer crash
      
    </h2></div></div><div></div></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="id2504163"></a>4.1. 
        
        Installer crash dump
      
      </h3></div></div><div></div></div><p>
      
        Afin de pouvoir récupérer l'image mémoire qui a été écrite sur
        la partition d'échange, il est nécessaire de sauvegarder cette
        image mémoire avant que la partition d'échange n'aie été montée
        par le système. À cette fin, le fichier de démarrage
        <span class="application">sysinit</span> doit être modifié. Le paquet
        des sources de <span class="application">LKCD</span> inclut un
        répertoire <tt class="filename">scripts</tt> qui contient des
        correctifs pour plusieurs des scripts de démarrage
        <span class="application">sysinit</span>. Ces correctifs ajoutent les
        commandes <tt class="literal">lkcd config</tt> et <tt class="literal">lkcd
        save</tt> pour activer la recopie mémoire en cas de panne
        et pour sauvegarder au démarrage une éventuelle copie mémoire
        préexistante.
        
      </p></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="id2504230"></a>4.2. 
        
        Essayer crash
      
      </h3></div></div><div></div></div><p>

        Pour forcer une panique afin d'essayer votre nouvelle
        installation de <span class="application">crash</span>, compilez le
        code ci-dessous avec la commande : « <b class="userinput"><tt>cc -c
        -O2 -isystem /lib/modules/`uname -r`/build/include -Wall
        panic.c</tt></b> ». Après avoir compilé le module
        <tt class="filename">panic.o</tt>, il vous suffira d'utiliser la
        commande <span><b class="command">insmod panic.o</b></span> pour déclencher une
        panique du noyau.
      
      </p><pre class="programlisting">
### panic.c ###########################
#define __KERNEL__
#define MODULE

#include &lt;linux/module.h&gt;

int init_module (void)
{
    panic(" panic a ete appele");
    return 0;
}
        
</pre></div><div class="section" lang="fr"><div class="titlepage"><div><div><h3 class="title"><a name="id2504286"></a>4.3. 
     
       Lancez <span class="application">crash</span>
     
     </h3></div></div><div></div></div><p>
      
      Afin d'examiner votre sauvegarde de la mémoire du noyau, vous
      devrez lancer <span><b class="command">lcrash</b></span> avec quelques
      paramètres :
      
    </p><pre class="screen">
lcrash [ fichier System.map ] [ copie de la mémoire ] [ Kerntypes ]
</pre><p>
    
      Par exemple :
    
    </p><pre class="screen">
lcrash /boot/System.map ./dump.1 /boot/Kerntypes
</pre><p>
      
        Le chargement de l'image mémoire prendra une minute avant que
        vous ne vous retrouviez dans l'interpréteur de commandes de
        <span class="application">crash</span>. Vous pouvez taper un
        <b class="userinput"><tt>?</tt></b> pour obtenir la liste des commandes
        disponibles.
      
      </p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.id2436817" href="#id2436817">1</a>] </sup> 

        <span class="foreignphrase"><i class="foreignphrase">Linux Kernel Crash Dump</i></span> —
        Sauvegarde de la mémoire du noyau Linux en cas de plantage.

        </p></div></div></div></body></html>
