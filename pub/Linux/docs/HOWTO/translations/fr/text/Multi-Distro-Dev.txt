Petit guide du développement multi-distributions

  Traduction française du Development for Multiple Linux Distributions
  mini-HOWTO

  Ed Hill

   <ed CHEZ eh3 POINT com>

   Adaptation française : Joan Goutte

   Relecture de la version française : Dorian Musso, Simon Depiets

   Préparation de la publication de la v.f. : Jean-Philippe Guérard

   Version : 0.9.1.fr.1.0

   2004-03-11

   +------------------------------------------------------------------------+
   | Historique des versions                                                |
   |------------------------------------------------------------------------|
   | Version 0.9.1.fr.1.0         | 2004-03-11       | JG, DM, SD, JPG      |
   |------------------------------------------------------------------------|
   | Traduction française                                                   |
   |------------------------------------------------------------------------|
   | Version 0.9.1                | 2002-08-14       | EH3                  |
   |------------------------------------------------------------------------|
   | Petite mise à jour pour l'utilisation de X11 (sockets). Small update   |
   | for using X11 (sockets).                                               |
   |------------------------------------------------------------------------|
   | Version 0.9                  | 2001-12-03       | EH3                  |
   |------------------------------------------------------------------------|
   | Version initiale. Initial version.                                     |
   +------------------------------------------------------------------------+

   Résumé

   Ce document décrit un bricolage rapide destiné à faciliter le
   développement et les tests de programmes tournant dans l'espace
   utilisateurs pour différentes distributions Linux.

   --------------------------------------------------------------------------

   Table des matières

   1. Introduction

                1.1. Droits d'utilisation

                1.2. Commentaires et corrections

   2. Installation

   3. Utiliser les distributions secondaires

   4. Remerciements

1. Introduction

   Lors du développement d'une application, il est parfois nécessaire de
   programmer ou de tester des programmes sur différentes distributions
   Linux. Ce petit guide trace les grandes lignes d'une utilisation élégante
   de chroot qui peut, dans bien des cas, éviter de redémarrer sous
   différentes distribution Linux pour réaliser des tests ou des
   développements.

   En quelques mots, l'astuce consiste à placer tous les fichiers d'une
   certaine distribution dans un simple répertoire et de faire un chroot^[1]
   vers l'intérieur de ce répertoire. Vous vous retrouverez ainsi dans un
   environnement d'exécution restreint qui vous permettra de développer,
   tester ou rechercher les erreurs de votre programme dans le contexte qui
   vous intéresse. Cette méthode fonctionnera à condition que :

    1. la version du noyau de la distribution « principale » (ou
       « primaire ») que vous exécutez soit (un minimum) compatible avec la
       distribution « secondaire », c'est-à-dire la distribution exécutée en
       environnement restreint ;

    2. votre application tourne principalement dans l'espace utilisateur (i.
       e. : ne soit pas un module du noyau) et ne dépende pas intimement d'un
       dispositif particulier du noyau (i. e. : du comportement de /proc).

  1.1. Droits d'utilisation

   Copyright © 2001 Ed Hill III.

   Copyright © 2004 Joan Goutte, Dorian Musso, Simon Depiets et Jean-Philippe
   Guérard pour la version française.

   Vous pouvez redistribuer et modifier ce document selon les termes de la
   Licence de documentation libre GNU (FDL) (version 1.1 ou toute version
   ultérieure publiée par la Free Software Foundation), sans section
   invariante, ni texte de première ou de quatrième de couverture. Une copie
   de cette licence est accessible sur http://www.gnu.org/copyleft/fdl.html
   [http://www.gnu.org/copyleft/fdl.html].

   Permission is granted to copy, distribute and/or modify this document
   under the terms of the GNU Free Documentation License, Version 1.1 or any
   later version published by the Free Software Foundation; with no Invariant
   Sections, with no Front-Cover Texts, and with no Back-Cover Texts. A copy
   of the license is available at http://www.gnu.org/copyleft/fdl.html
   [http://www.gnu.org/copyleft/fdl.html].

  1.2. Commentaires et corrections

   Ce document a été traduit dans le cadre du projet traduc.org
   [http://www.traduc.org]. N'hésitez pas à faire parvenir vos commentaires,
   corrections et suggestions d'améliorations à <commentaires CHEZ traduc
   POINT org>.

2. Installation

   Nous supposerons que vous avez déjà :

    1. une distribution Linux « principale » (ou « primaire ») installée avec
       un noyau 2.4 ou supérieur ;

    2. une partition libre de 2 à 4 Go ;

    3. suffisamment d'espace disque pour l'installation des distributions
       secondaires (et pour les travaux de développement et de test en
       découlant).

   Partant de ces hypothèses, voici les grandes lignes de l'une des solutions
   permettant d'installer plusieurs distributions secondaires qui seront
   utilisées pour des développements, des tests, ou d'autres choses :

    1. Premièrement, créez ou allouez une partition non utilisée de votre
       disque dur qui soit assez grande (2 à 4 Go seront en général
       suffisants) pour faire une installation de base de l'une des
       distributions Linux secondaires.

    2. Installez la distribution secondaire sur cette partition mais ne
       l'ajoutez pas à votre configuration de démarrage. Notez que cette
       installation a seulement besoin d'inclure les paquets que votre
       application (ou votre essai) exige. Par exemple, il est possible que
       vous puissiez vous passez d'installer des applications très gourmandes
       en espaces telles que le serveur X.

    3. Redémarrez votre distribution Linux principale et montez la partition
       contenant la distribution fraîchement installée. Copiez (de préférence
       en utilisant tar -cp ou une autre méthode conservant les droits) tous
       les fichiers de la distribution secondaire vers une destination telle
       que /opt/distributions/NOM_DE_LA_DISTRIBUTION.

    4. Répétez les étapes 2 et 3 pour toutes les distributions
       supplémentaires que vous souhaitez installer. Au bout du compte, vous
       devriez obtenir une structure de répertoires ressemblant à celle-ci :

 /opt/distributions/redhat_6.2/
                    suse_7.2/
                    mandrake_8.1/
                    debian-potato/
                    slackware_8.0/

       où chaque répertoire contient la totalité des fichiers issus de
       l'installation de chaque distribution.

3.  Utiliser les distributions secondaires

   Une fois les distributions secondaires installées, les étapes à suivre
   pour les utiliser sont :

    1. Il est important que la distribution Linux principale utilise un noyau
       Linux 2.4 ou plus récent, afin de profiter des possibilités de points
       de montage multiples qu'offrent ces noyaux. Pour de nombreuses tâches,
       les systèmes de fichiers /proc et /tmp devront être montés à nouveau
       dans la distribution secondaire en utilisant :

 mount --bind /proc /opt/distributions/redhat_6.2/proc
 mount --bind /tmp /opt/distributions/redhat_6.2/tmp

    2. Aussi, il peut être utile de réaliser un nouveau montage (au lieu de
       la copier) de l'arborescence des sources de la première distribution
       dans la distribution secondaire :

 mount --bind /home/UTILISATEUR/src/PROJET \
     /opt/distributions/redhat_6.2/home/UTILISATEUR/src/PROJET

    3. Connectez-vous sous le compte root et faites :

 xhost +localhost chroot /opt/distributions/redhat_6.2 /bin/bash

       pour obtenir un interpréteur de commandes (shell) dans l'une des
       distributions secondaires. Notez que la commande xhost n'est utile que
       si vous avez l'intention d'utiliser des applications X.

    4. Enfin (si nécessaire) créez un utilisateur dans l'environnement
       restreint. Vous pouvez maintenant développer, construire ou tester
       votre application dans cette distribution Linux « séparée » ! Notez
       que vous aurez également à définir la variable d'environnement DISPLAY
       si vous désirez utiliser des applications X.

   Bien ! Vous disposez maintenant d'un interpréteur de commandes que vous
   pouvez, à toutes fins utiles, exécuter sous la distribution Linux
   secondaire de votre choix.

4. Remerciements

   Je ne suis pas à l'origine des idées présentées dans ce petit guide. Elles
   ont été recueillies dans des messages de Ben Reed (de OpenNMS
   [http://www.opennms.org/]) pour l'une des listes de discussions du groupe
   d'utilisateurs de Linux TriLUG [http://www.trilug.org/]. J'ai trouvé que
   ces informations pouvaient être très utiles et j'ai voulu documenter ces
   idées pour les autres.

   --------------

   ^[1] La commande chroot permet d'exécuter une commande ou un interpréteur
   de commandes en utilisant un répertoire racine différent. On parle d'une
   commande exécutée dans un environnement d'exécution restreint.

