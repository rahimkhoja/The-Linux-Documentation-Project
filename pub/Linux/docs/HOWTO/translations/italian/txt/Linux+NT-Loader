  NT OS Loader + Linux mini-HOWTO
  Bernd Reichert, <reichert@dial.eunet.ch>
  v1.11, 2 settembre 1997

  Questo documento descrive l'uso del boot Loader di Windows NT per
  avviare Linux. La procedura è stata provata con Windows NT 4.0 WS e
  Linux 2.0. Traduzione di Leonardo Boselli, <leo@dicea.unifi.it>
  ______________________________________________________________________

  Indice Generale


  1. Come funziona il loader di NT
  2. Suggerimenti su come installare Windows NT e Linux nello stesso Sistema
     2.1 Installazione di Windows NT
     2.2 Partizionamento del disco
     2.3 Installazione Linux
     2.4 Lilo

  3. Bootpart
  4. La parte Linux del lavoro (a parte la configurazione di lilo)
  5. La parte NT del lavoro
  6. Provaci ancora Sam
  7. Risoluzione dei problemi
  8. Riferimenti
  9. Ringraziamenti
  10. Retroazione


  ______________________________________________________________________

  11..  CCoommee ffuunnzziioonnaa iill llooaaddeerr ddii NNTT

  Il loader di NT desidera avere il settore di boot degli altri sistemi
  operativi disponibile in un file. Legge questo file e fa partire il
  sistema operativo scelto che può essere sia NT in una diversa
  partizione [NDT: nel testo originale era "in un diverso modo" : I
  diversi modi sono ottenuti in una maniera leggermente diversa, vedi il
  Windows NT resource kit] o un diverso sistema operativo.


  22..  SSuuggggeerriimmeennttii ssuu ccoommee iinnssttaallllaarree WWiinnddoowwss NNTT ee LLiinnuuxx nneelllloo sstteessssoo
  SSiisstteemmaa

  [aggiunta alla traduzione italiana]
  Se dovete installare anche Win95 questo DEVE essere il primo sistema
  ad essere installato oppure renderà NT inavviabile.


  22..11..  IInnssttaallllaazziioonnee ddii WWiinnddoowwss NNTT

  Provate a installare Windows NT per primo. Se volete usare NTFS
  (raccomandato) per la vostra partizione Windows NT, tenete conto che
  le versioni correnti di linux non possono accedere alla partizione
  NTFS.  Un driver in versione alfa che può LEGGERE le partizioni NTFS è
  disponibile presso  <http://www.informatik.hu-berlin.de/~loewis/ntfs>.
  Potete creare una partizione FAT separata per scambiare dati oppure
  usare dischetti formattati DOS (il metodo consigliato è quello di
  creare una partizione FAT iniziale. In questo modo oltre a poter usare
  un sistema operativo DOS o simile potete avere un'area libera per lo
  scambio files. Inoltre, cosa più importante, non avrete il limite dei
  1024 cilindri per la partizione di avvio).



  22..22..  PPaarrttiizziioonnaammeennttoo ddeell ddiissccoo

  Un altro Mini-howto raccomanda di non usare il "Disk Administartor" di
  NT per creare le partizioni di swap e root. È sufficiente controllare
  tramite questo lo spazio libero e usare il fdisk di linux
  successivamente.



  22..33..  IInnssttaallllaazziioonnee LLiinnuuxx

  Adesso fate il bopot di Linux dai dischetto (o dal CD), create le
  partizioni di swap e root.  fdisk assume che la partizione ntfs sia
  HPFS. Questo è normale.  Se l'installazione chiedesse di montare
  questa partizione ignorate la richiesta.  Ripartite nuovamente (se
  avete una versione di installer che lo richiede) e installate linux
  secondo le vostre esigenze.


  22..44..  LLiilloo

  Quando arrivate alla sezione Lilo, specificate che il device di boot,
  su cui scrivere il MBR è la partizione root di Linux, questo perché il
  MBR primario appartiene al loader di NT.  Questo significa che sia la
  voce root che boot nel file /etc/lilo.conf avranno lo stesso valore.
  Se ad esempio avete un disco IDE e la partizione Linux è la seconda
  partizione la voce boot in /etc/lilo.conf sarà come:



           boot=/dev/hda2



  Se avete due dischi (montati sullo stesso controller) e Linux risiede
  sulla prima partizione del secondo disco la vostra voce boot in
  /etc/lilo.conf sarà:



           boot=/dev/hdb1



  Eseguite lilo con un kernel che corrisponda al vostro sistema.
  Controllate il kernel facendo il boot dal dischetto se avete dei
  dubbi.

  Se adesso non riuscite a fare il boot di NT allore ci sono dei
  problemi.Spero che abbiate creato un disco di repair di recente (se
  avete appena installato lasciate correre e rifate la installazione da
  zero: è più veloce !).


  33..  BBoooottppaarrtt

  Esiste un programma NT chiamato bootpart scritto da G. Vollant che può
  fare per voi il lavoro descritto ai prossimi due punti. Bootpart è
  disponibile su
  <http://ourworld.compuserve.com/homepages/gvollant/bootpart.htm>.

  Se invece volete sapere come funzionano le cose che usate, si vedano
  invece le procedure descritte nei punti 4 e 5.

  44..  LLaa ppaarrttee LLiinnuuxx ddeell llaavvoorroo ((aa ppaarrttee llaa ccoonnffiigguurraazziioonnee ddii lliilloo))

  Dovete fare il boot da dischetto finché la parte NT non è sistemata.

  Ora dovete estrarre il settore di boot dalla partizione root di Linux.
  Assumendo che /dev/hda2 sia la vostra partizione il comando è :



           # dd if=/dev/hda2 of=/bootsect.lnx bs=512 count=1



  C'è qualcosa che non va se il file bootsect.lnx è più di 512 byte.

  Adesso copiate il file bootsect.lnx su un dischetto formattato DOS, se
  questo è il vostro modo di trasferire file su Windows NT.

  Potete copiarlo col comando:



           # mcopy /bootsect.lnx a:



  oppure meglio con:



           # mount -t msdos /dev/fd0 /mnt
           # copy /bootsect.lnx /mnt
           # umount /mnt



  [il nome del file non è del tutto arbitrario: a meno che non abbiate
  più partizioni linux da avviare in alternativa non cambiatelo (e
  nell'altro caso usate .lny .lnz)]


  55..  LLaa ppaarrttee NNTT ddeell llaavvoorroo

  Copiate il file bootsect.lnx sulla radice del disco C:

  Ciò che /etc/lilo.conf è per linux, c:\boot.ini lo è per Windows NT.
  Rimuovete gli attributi di sola lettura e sistema prima di modificare
  il file con il comando:



           C:\attrib -s -r c:\boot.ini



  [NDT: su alcune installazioni il flag di sistema non è settato, in
  questo caso non usate il -s ... in ogni caso se il comando suggerito
  NON da errori è tutto ok]

  Ora cambiate il file boot.ini con un text editor [sotto NT] quale ad
  esempio notepad o edit mel seguente modo:

           [boot loader]
           timeout=30
           default=multi(0)disk(0)rdisk(0)partition(1)\WINNT
           [operating systems]
           multi(0)disk(0)rdisk(0)partition(1)\WINNT="Windows NT Workstation ...
           multi(0)disk(0)rdisk(0)partition(1)\WINNT="Windows NT Workstation ...
           C:\BOOTSECT.LNX="Linux"



  In questo esempio è stata agginta solo l'ultima riga.  Ripristinate
  gli attributi dopo che avete salvato boot.ini con:



           C:\attrib +s +r c:\boot.ini



  Dopo uno shutdown ordinato di NT al riavvio dovreste vedere il
  seguente messaggio [assumendo che abbiate modificato i file come
  indicato nell'esempio]:



           OS Loader V4.00

           Please select the operating system to start:

           Windows NT Workstation Version 4.0
           Windows NT Workstation Version 4.0 [VGA mode]
           Linux



  Selezionate Linux e vedrete:



           LILO loading zImage ....



  66..  PPrroovvaaccii aannccoorraa SSaamm

  Una nuova copia del bootsect.lnx dovrebbe essere trasferita ogni
  qualvolta il bootsector della vostra partizione linux viene
  modificato.  Questo accade per esempio quando installate un nuovo
  kernel con lilo.  Come potete vedere questo non è il sistema ideale
  per sperimentare nuovi kernel.



  77..  RRiissoolluuzziioonnee ddeeii pprroobblleemmii

  Se le cose non vanno come avrebbero dovuto, provate a partire con un
  floppy.  Con /dev/hdb1 quale partizione Linux, il vostro
  /etc/lilo.conf dovrebbe avere:



      root=/dev/hdb1
      boot=/dev/fd0



  Lanciate lilo con un dischetto inserito. Ora provate a fare il boot
  dal dischetto.  Se il vostro Linux su /dev/hdb1 non può essere avviato
  anche il loader di NT non sarà in grado di farlo partire. Se vedete
  molti 01 01 01 01, il vostro disco root non è accessibile. Verificate
  che tutti i vostri dischi siano visibili dal bios.

  Se il floppy riesce a fare partire Linux prelevate il MBR dal floppy
  con:



           # dd if=/dev/fd0 of=/bootsect.lnx bs=512 count=1



  Potete conservare questo dischetto come avvio di emergenza qualora
  l'installazione di NT si guastasse.


  88..  RRiiffeerriimmeennttii


  ·  The Linux+WindowsNT mini-HOWTO

  ·  The FAQ for FreeBSD 2.X


  99..  RRiinnggrraazziiaammeennttii


  ·  Grazie a Xiaoming Yi <z3c20@ttacs.ttu.edu> per avermi suggerito che
     la procedura funziona anche per dischi diversi dal primo.

  ·  Grazie a Frank Dennler <Frank.Dennler@zkb.ch> per il trucco del
     dischetto.


  1100..  RReettrrooaazziioonnee

  Qualunque commento è benvenuto.



