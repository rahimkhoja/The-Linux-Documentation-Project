
<HTML>
<HEAD>
<TITLE>DMA to user space</TITLE>
<LINK rel="owner" href="mailto:">
<SCRIPT LANGUAGE="JavaScript">
<!-- hide this

function help(message) {
  self.status = message;
  return true;
}
// stop hiding -->
</SCRIPT>

</HEAD>
<BODY>
<strong>The
HyperNews <a href="../../khg.html">Linux KHG</a>
Discussion Pages</strong>
<hr>
<NOBR>





</NOBR><BR>
<H2><IMG src="../../../../Icons/question.gif" ALT="Question:"
  WIDTH=15 HEIGHT=15
  ALIGN="bottom">
DMA to user space</H2>

<DL> <DD>
<NOBR>
<font size=+1><I>Forum:</I> <A HREF="../devices.html" >
 Device Drivers</A> </font><BR>
<I>Date:</I> Wed, 11 Jun 1997 09:23:28 GMT <BR>
<I>From:</I> Marcel Boosten &lt;<A HREF="mailto:Marcel.Boosten@cern.ch" >Marcel.Boosten@cern.ch</A>&gt; <BR>

</NOBR>
</DD> </DL>

<P>
<table border cellpadding=5 cellspacing=0 
 width="100%" BGCOLOR="#FFFFFF">
 <tr><td>
<PRE>Hello,

I'm developing a device driver for a PCI board meant for
high performance communication. Interaction with the board
is possible via DMA. In order to get optimal performance
I need to do DMA directly to user space.

QUESTION:
How do I implement DMA to user space?

SUBQUESTIONS:
In "The Linux Kernel", David A Rusling writes the following:
"Device drivers have to be careful when using DMA. First
of all the DMA controller knows nothing of virtual memory,
it only has access to the physical memory in the system.
Therefore the memory that is being DMA'd to or from must
be a contiguous block of physical memory. This means that
you cannot DMA directly into the virtual address space of
a process. YOU CAN HOWEVER LOCK THE PROCESSES PHYSICAL
PAGES INTO MEMORY, PREVENTING THEM FROM BEING SWAPPED OUT
TO THE SWAP DEVICE DURING A DMA OPERATION. Secondly, the
DMA controller cannot access the whole of physical memory.
The DMA channel's address register represents the first 16
bits of the DMA address, the next 8 bits come from the page
register. This means that DMA requests are limited to the
bottom 16 Mbytes of memory."
[see <A HREF="http://www.linuxhq.com/guides/TLK/node87.html">http://www.linuxhq.com/guides/TLK/node87.html</A>]

Reading this the following subquestions arise:
  - How can one lock specific process pages?
  - How can one obtain the physical address of
    the pages involved?
  - How can one ensure that the pages involved
    are DMA-able (below 16Mb)?
  - Is it possible to obtain a continues block of
    physical memory in user space?  

Greetings,
  Marcel</PRE>
</td></tr>
</table>
<P><NOBR>





</NOBR><BR>

<P>
<P>



  






<BR> 
 
<BR></BODY>
</HTML>
