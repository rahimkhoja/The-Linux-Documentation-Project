<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML
><HEAD
><TITLE
>Design</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
TITLE="Pocket Linux Guide"
HREF="index.html"><LINK
REL="UP"
TITLE="Enabling Multiple Users"
HREF="phase6.html"><LINK
REL="PREVIOUS"
TITLE="Analysis"
HREF="x1257.html"><LINK
REL="NEXT"
TITLE="Construction"
HREF="x1378.html"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Pocket Linux Guide</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x1257.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 7. Enabling Multiple Users</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x1378.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="AEN1265"
></A
>7.2. Design</H1
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1267"
></A
>7.2.1. The login process</H2
><P
>The From-Powerup-To-BASH-Prompt-HOWTO does a good job of outlining
      the steps in the login process. Basically it works like this.</P
><P
></P
><OL
TYPE="1"
><LI
><P
>The <B
CLASS="command"
>init</B
> daemon starts a
          <B
CLASS="command"
>getty</B
> process on the terminal.</P
></LI
><LI
><P
>The <B
CLASS="command"
>getty</B
> program displays the contents of
          <TT
CLASS="filename"
>/etc/issue</TT
> and prompts for a user name.</P
></LI
><LI
><P
>When the user name is entered, control is handed off to the
          <B
CLASS="command"
>login</B
> program.</P
></LI
><LI
><P
>The <B
CLASS="command"
>login</B
> program asks for a password and
          verifies the credentials using <TT
CLASS="filename"
>/etc/passwd</TT
>,
          <TT
CLASS="filename"
>/etc/group</TT
> and possibly
          <TT
CLASS="filename"
>/etc/shadow</TT
>.</P
></LI
><LI
><P
>If everything is okay the user's shell is started.</P
></LI
></OL
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1290"
></A
>7.2.2. Obtaining source code</H2
><P
>The <B
CLASS="command"
>getty</B
> and <B
CLASS="command"
>login</B
> programs
      were already installed as part of the util-linux package so there is no
      need to download any new source code.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1295"
></A
>7.2.3. Creating support files</H2
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1297"
></A
>7.2.3.1. Device nodes</H3
><P
>Details about virtual console device files can be found in the
        Linux kernel source code file called <TT
CLASS="filename"
>devices.txt</TT
>
        in the <TT
CLASS="filename"
>Documentation</TT
> directory. We will need to
        create <TT
CLASS="filename"
>tty1</TT
> through <TT
CLASS="filename"
>tty6</TT
> for
        each of the virtual consoles as well as <TT
CLASS="filename"
>tty0</TT
> and
        <TT
CLASS="filename"
>tty</TT
> to represent the current virtual
        console.</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1306"
></A
>7.2.3.2. /etc/issue</H3
><P
>The <TT
CLASS="filename"
>/etc/issue</TT
> file is pretty easy to
        construct. It can contain any text we want displayed on the screen
        prior to the login prompt. It could be something friendly like
        "Welcome to Pocket Linux", something menacing like "Authorized users
        only!" or something informational like "Connected to tty1 at 9600bps".
        The agetty(8) manpage explains how to display information like tty
        line and baud rate using escape codes.</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1310"
></A
>7.2.3.3. /etc/passwd</H3
><P
>The format of <TT
CLASS="filename"
>/etc/passwd</TT
> can be obtained
        by reading the passwd(5) manpage. We can easily create a user account
        by adding a line like "root::0:0:superuser:/root:/bin/sh" to the
        file.</P
><P
>Maintaining passwords will be somewhat challenging because of
        the system being loaded into ramdisk. Any changes to
        <TT
CLASS="filename"
>/etc/passwd</TT
> will be lost when the system is
        shutdown. So to make things easy, we will create all users with null
        passwords.</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1316"
></A
>7.2.3.4. /etc/group</H3
><P
>The structure of <TT
CLASS="filename"
>/etc/group</TT
> is available
        from the group(5) manpage. A line of "root::0:root" would define a
        group called "root" with no password, a group id of zero and the user
        root assigned to it as the only member.</P
></DIV
><DIV
CLASS="sect3"
><H3
CLASS="sect3"
><A
NAME="AEN1320"
></A
>7.2.3.5. Conventions</H3
><P
>User and group names and id's are generally not chosen at
        random. Most Linux systems have very similar looking
        <TT
CLASS="filename"
>/etc/passwd</TT
> and <TT
CLASS="filename"
>/etc/group</TT
>
        files. Definitions for commonly used user id and group id assignments
        may be found in one of several places:</P
><P
></P
><UL
><LI
><P
>The <TT
CLASS="filename"
>/etc/passwd</TT
> and
            <TT
CLASS="filename"
>/etc/group</TT
> files on any popular GNU/Linux
            distribution.</P
></LI
><LI
><P
>The Debian Policy Manual -- available online at <A
HREF="http://www.debian.org/doc/debian-policy"
TARGET="_top"
>http://www.debian.org/doc/debian-policy</A
>.</P
></LI
><LI
><P
>The Linux Standard Base specification -- downloadable in
            many formats from <A
HREF="http://www.linuxbase.org/spec/index.shtml"
TARGET="_top"
>http://www.linuxbase.org/spec/index.shtml</A
>.</P
></LI
><LI
><P
>Essential System Administration, 3rd Edition by Aeleen
            Frisch -- available at libraries, bookstores or directly from
            O'Reilly Publishing at <A
HREF="http://www.oreilly.com/"
TARGET="_top"
>http://www.oreilly.com/</A
>.</P
></LI
></UL
></DIV
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1339"
></A
>7.2.4. Dependencies</H2
><P
>Running <B
CLASS="command"
>ldd</B
> on the <TT
CLASS="filename"
>login</TT
>
      program from util-linux will reveal that it is linked to the libraries
      <TT
CLASS="filename"
>libcrypt.so.1</TT
>, <TT
CLASS="filename"
>libc.so.6</TT
> and
      <TT
CLASS="filename"
>ld-linux.so.2</TT
>. In addition to these libraries there
      is another, unseen dependency on <TT
CLASS="filename"
>libnss_files.so.2</TT
>
      and the configuration file
      <TT
CLASS="filename"
>/etc/nsswitch.conf</TT
>.</P
><P
>The name service switch library
      <TT
CLASS="filename"
>libnss_files.so.2</TT
> and
      <TT
CLASS="filename"
>nsswitch.conf</TT
> are required for
      <TT
CLASS="filename"
>libc.so.6</TT
>, and consequently the
      <TT
CLASS="filename"
>login</TT
> program, to access the
      <TT
CLASS="filename"
>/etc/passwd</TT
> file. Without libnss and its
      configuration file, all logins will mysteriously fail. More information
      about glibc's use of the name service switch libraries can be found at
      <A
HREF="http://www.gnu.org/software/libc/manual/html_node/Name-Service-Switch.html"
TARGET="_top"
>http://www.gnu.org/software/libc/manual/html_node/Name-Service-Switch.html</A
>.</P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN1356"
></A
>7.2.5. Assigning ownership and permissions</H2
><P
>Previously, with the single user system, there was no need to
      worry about permissions when installing directories, files and device
      nodes. The shell was effectively operating as root, so everything was
      accessible. Things become more complex with the addition of multiple
      user capability. Now we need to make sure that every user has access to
      what they need and at the same time gets blocked from what they do not
      need.</P
><P
>A good guideline for assigning ownership and permissions would be
      to give the minimum level of access required. Take the
      <TT
CLASS="filename"
>/bin</TT
> directory as an example. The Filesystem
      Hierarchy (FHS) document says, "<TT
CLASS="filename"
>/bin</TT
> contains
      commands that may be used by both the system administrator and by
      users". From that statement we can infer that <TT
CLASS="filename"
>/bin</TT
>
      should have read and execute permission for everyone. On the other hand,
      the <TT
CLASS="filename"
>/boot</TT
> directory contains files for the boot
      loader. Chances are good that regular users will not need to access
      anything in the <TT
CLASS="filename"
>/boot</TT
> directory. So the minimum
      level of access would be read permission for the root user and other
      administrators who are members of the root group. Normal users would
      have no permissions assigned on the <TT
CLASS="filename"
>/boot</TT
>
      directory.</P
><P
>Most of the time we can assign similar permissions to all the
      commands in a directory, but there are some programs that prove to be
      exceptions to the rule. The <B
CLASS="command"
>su</B
> command is a good
      example. Other commands in the /bin directory have a minimum requirement
      of read and execute, but the <B
CLASS="command"
>su</B
> command needs to be
      setuid root in order to run correctly. Since it is a setuid binary, it
      might not be a good idea to allow just anyone to run it. Ownership of
      0:0 (root user, root group) and permissions of rwsr-x--- (octal 4750)
      would be a good fit for <B
CLASS="command"
>su</B
>.</P
><P
>The same logic can be applied to other directories and files in
      the root filesystem using the following steps:</P
><P
></P
><OL
TYPE="1"
><LI
><P
>Assign ownership to the root user and root group.</P
></LI
><LI
><P
>Set the most restrictive permissions possible.</P
></LI
><LI
><P
>Adjust ownership and permissions on an "as needed"
          basis.</P
></LI
></OL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x1257.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x1378.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Analysis</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="phase6.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Construction</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>