<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML
><HEAD
><TITLE
>Construction</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
TITLE="Pocket Linux Guide"
HREF="index.html"><LINK
REL="UP"
TITLE="Saving Space"
HREF="phase2.html"><LINK
REL="PREVIOUS"
TITLE="Design"
HREF="x367.html"><LINK
REL="NEXT"
TITLE="Implementation"
HREF="x459.html"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Pocket Linux Guide</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x367.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 3. Saving Space</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x459.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="AEN388"
></A
>3.3. Construction</H1
><P
>This section is written using ramdisk seven
    (<TT
CLASS="filename"
>/dev/ram7</TT
>) to build the root image. There is nothing
    particularly special about ramdisk seven and it is possible to use any of
    the other available ramdisks provided they are not already in use.</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN392"
></A
>3.3.1. Create a ramdisk</H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> dd if=/dev/zero of=/dev/ram7 bs=1k count=4096
<TT
CLASS="prompt"
>bash#</TT
> mke2fs -m0 /dev/ram7 4096
<TT
CLASS="prompt"
>bash#</TT
> mount /dev/ram7 /mnt</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN399"
></A
>3.3.2. Rebuild the BASH shell</H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> cd /usr/src/bash-3.0
<TT
CLASS="prompt"
>bash#</TT
> make distclean
<TT
CLASS="prompt"
>bash#</TT
> export CC="gcc -mcpu=i386"
<TT
CLASS="prompt"
>bash#</TT
> ./configure --enable-minimal-config --host=i386-pc-linux-gnu
<TT
CLASS="prompt"
>bash#</TT
> make
<TT
CLASS="prompt"
>bash#</TT
> strip bash</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN409"
></A
>3.3.3. Determine which libraries are required</H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> ldd bash</PRE
></FONT
></TD
></TR
></TABLE
></P
><P
>View the output from the <B
CLASS="command"
>ldd</B
> command. It should
      look similar to the example below.</P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="screen"
>bash# ldd bash
  libdl.so.2 =&#62; /lib/libdl.so.2 (0x4001d000)
  libc.so.6 =&#62; /lib/libc.so.6 (0x40020000)
  /lib/ld-linux.so.2 =&#62; /lib/ld-linux.so.2 (0x40000000)</PRE
></FONT
></TD
></TR
></TABLE
><DIV
CLASS="note"
><P
></P
><TABLE
CLASS="note"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Some systems may have a slightly different library set up. For
        example, you may see <TT
CLASS="computeroutput"
>libc.so.6 =&#62;
        /lib/tls/libc.so.6</TT
> rather than
        <TT
CLASS="computeroutput"
>libc.so.6 =&#62; /lib/libc.so.6</TT
> as
        shown in the example. If your <B
CLASS="command"
>ldd</B
> output does not
        match the example then use the path given by your
        <B
CLASS="command"
>ldd</B
> command when completing the next step.</P
></TD
></TR
></TABLE
></DIV
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN423"
></A
>3.3.4. Copy BASH and its libraries to the ramdisk</H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> mkdir /mnt/bin
<TT
CLASS="prompt"
>bash#</TT
> cp bash /mnt/bin
<TT
CLASS="prompt"
>bash#</TT
> ln -s bash /mnt/bin/sh
<TT
CLASS="prompt"
>bash#</TT
> mkdir /mnt/lib
<TT
CLASS="prompt"
>bash#</TT
> strip --strip-unneeded -o /mnt/lib/libdl.so.2 /lib/libdl.so.2
<TT
CLASS="prompt"
>bash#</TT
> strip --strip-unneeded -o /mnt/lib/libc.so.6 /lib/libc.so.6
<TT
CLASS="prompt"
>bash#</TT
> strip --strip-unneeded -o /mnt/lib/ld-linux.so.2 /lib/ld-linux.so.2
<TT
CLASS="prompt"
>bash#</TT
> chmod +x /mnt/lib/ld-linux.so.2</PRE
></FONT
></TD
></TR
></TABLE
><DIV
CLASS="note"
><P
></P
><TABLE
CLASS="note"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="../images/note.gif"
HSPACE="5"
ALT="Note"></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Using <B
CLASS="command"
>strip -o</B
> might seem an odd way to
          copy library files from the development system to the ramdisk. What
          it does is strip the symbols while the file is in transit from the
          source location to the destination. This has the effect of stripping
          symbols from the library on the ramdisk without altering the
          libraries on the development system. Unfortunately file permissions
          are lost when copying libraries this way which is why the
          <B
CLASS="command"
>chmod +x</B
> command is then used to set the execute
          flag for the rootdisk's dynamic loader.</P
></TD
></TR
></TABLE
></DIV
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN439"
></A
>3.3.5. Create a console device</H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> mkdir /mnt/dev
<TT
CLASS="prompt"
>bash#</TT
> mknod /mnt/dev/console c 5 1</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN445"
></A
>3.3.6. Compress the ramdisk image</H2
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> cd /
<TT
CLASS="prompt"
>bash#</TT
> umount /dev/ram7
<TT
CLASS="prompt"
>bash#</TT
> dd if=/dev/ram7 of=~/phase2-image bs=1k count=4096
<TT
CLASS="prompt"
>bash#</TT
> gzip -9 ~/phase2-image</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="AEN453"
></A
>3.3.7. Copy the compressed image to diskette</H2
><P
>Insert the floppy labeled "root disk" into drive fd0.</P
><P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><FONT
COLOR="#000000"
><PRE
CLASS="programlisting"
><TT
CLASS="prompt"
>bash#</TT
> dd if=~/phase2-image.gz of=/dev/fd0 bs=1k</PRE
></FONT
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x367.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x459.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Design</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="phase2.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Implementation</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>