<HTML
><HEAD
><TITLE
>The syslog daemon</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.60"><LINK
REL="HOME"
TITLE="Securing and Optimizing Linux"
HREF="index.html"><LINK
REL="UP"
TITLE="Software -Networking"
HREF="soft-netwrkng.html"><LINK
REL="PREVIOUS"
TITLE="Run ISC  BIND/DNS in a chroot jail"
HREF="chap21sec167.html"><LINK
REL="NEXT"
TITLE="Clean-up and Test the new chrooted jail"
HREF="chap21sec169.html"></HEAD
><BODY
CLASS="section"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Securing and Optimizing Linux: RedHat Edition -A Hands on Guide</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="chap21sec167.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 21. Software -Networking</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="chap21sec169.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="section"
><H1
CLASS="section"
><A
NAME="AEN11151"
>21.7. The syslog daemon</A
></H1
><P
>&#13; We must tell syslogd <EM
>the syslog daemon program</EM
> about the new chrooted service, since normally, processes talk to syslogd through <TT
CLASS="filename"
>/dev/log</TT
>. As a result of the chroot 
 jail, this won't be possible, so syslogd needs to be told to listen to <TT
CLASS="filename"
>/chroot/named/dev/log</TT
> instead of the default <TT
CLASS="filename"
>dev/log</TT
>. To do this, edit the syslog startup script file to specify 
 additional places to listen.
 </P
><P
>&#13; Edit the <TT
CLASS="filename"
>syslog</TT
> script file <B
CLASS="command"
>vi</B
> +24 <TT
CLASS="filename"
>/etc/rc.d/init.d/syslog</TT
> and change the line:
 <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; daemon syslogd -m 0
 </PRE
></TD
></TR
></TABLE
>
 To read:
 <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; daemon syslogd -m 0 -a /chroot/named/dev/log
 </PRE
></TD
></TR
></TABLE
>
 </P
><P
>&#13; The default named script file of <SPAN
CLASS="acronym"
>ISC</SPAN
> <SPAN
CLASS="acronym"
>BIND</SPAN
>/<SPAN
CLASS="acronym"
>DNS</SPAN
> starts the daemon <TT
CLASS="literal"
>named</TT
> outside the chroot jail. We must change it to start named from the 
 chroot jail. Edit the named script file <B
CLASS="command"
>vi</B
> <TT
CLASS="filename"
>/etc/rc.d/init.d/named</TT
> and change the lines:
 </P
><DIV
CLASS="procedure"
><OL
TYPE="1"
><LI
><P
>&#13;     <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; [ -f /usr/sbin/named ] || exit 0
 </PRE
></TD
></TR
></TABLE
>
 To read:
 <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; [ -f /chroot/named/usr/sbin/named ] || exit 0
 </PRE
></TD
></TR
></TABLE
>
 </P
></LI
><LI
><P
>&#13;   <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; [ -f /etc/named.conf ] || exit 0
 </PRE
></TD
></TR
></TABLE
>
 To read:
 <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; [ -f /chroot/named/etc/named.conf ] || exit 0
 </PRE
></TD
></TR
></TABLE
>
 </P
></LI
><LI
><P
>&#13;   <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; daemon named
 </PRE
></TD
></TR
></TABLE
>
 To read:
 <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; daemon /chroot/named/usr/sbin/named -t /chroot/named/ -unamed -gnamed
 </PRE
></TD
></TR
></TABLE
>
 </P
></LI
></OL
></DIV
><P
></P
><DIV
CLASS="variablelist"
><DL
><DT
>The  -t</DT
><DD
><P
>&#13; option tells <TT
CLASS="literal"
>named</TT
> to start up using the new chroot environment.
 </P
></DD
><DT
>The  -u</DT
><DD
><P
>&#13; option specifies the user to run as.
 </P
></DD
><DT
>The  -g</DT
><DD
><P
>&#13; option specifies the group to run as.
 </P
></DD
></DL
></DIV
><P
>&#13; In <SPAN
CLASS="acronym"
>BIND</SPAN
> 8.2 version, the <B
CLASS="command"
>ndc</B
> command of <SPAN
CLASS="acronym"
>ISC</SPAN
> <SPAN
CLASS="acronym"
>BIND</SPAN
>/<SPAN
CLASS="acronym"
>DNS</SPAN
> software became a binary file; before, it was a script file, which 
 renders the shipped <B
CLASS="command"
>ndc</B
> useless in this setting. To fix it, the <SPAN
CLASS="acronym"
>ISC</SPAN
> <SPAN
CLASS="acronym"
>BIND</SPAN
>/<SPAN
CLASS="acronym"
>DNS</SPAN
> package must be compiled again from source.

 To do this, in the top level of <SPAN
CLASS="acronym"
>ISC</SPAN
> <SPAN
CLASS="acronym"
>BIND</SPAN
>/<SPAN
CLASS="acronym"
>DNS</SPAN
> source directory.
  </P
><DIV
CLASS="procedure"
><OL
TYPE="1"
><LI
><P
>&#13; For ndc utility:
 <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
>&#13; [root@deep] /# <B
CLASS="command"
>cp</B
> bind-src.tar.gz /vat/tmp
 [root@deep] /# <B
CLASS="command"
>cd</B
> /var/tmp/
 [root@deep ]/tmp# <B
CLASS="command"
>tar</B
> xzpf bind-src.tar.gz
 [root@deep ]/tmp# <B
CLASS="command"
>cd</B
> src
 [root@deep ]/src# <B
CLASS="command"
>cp</B
> port/linux/Makefile.set port/linux/Makefile.set-orig
 </PRE
></TD
></TR
></TABLE
>
 </P
></LI
><LI
><P
>&#13; Edit the <TT
CLASS="filename"
>Makefile.set file</TT
>, <B
CLASS="command"
>vi</B
> <TT
CLASS="filename"
>port/linux/Makefile.set</TT
> to make the changes listed below:
 <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13; 'CC=egcs -D_GNU_SOURCE'
 'CDEBUG=-O9 -funroll-loops -ffast-math -malign-double -mcpu=pentiumpro -march=pentiumpro -fomit-frame-pointer -fno-exceptions -g
 'DESTBIN=/usr/bin'
 'DESTSBIN=/chroot/named/usr/sbin'
 'DESTEXEC=/chroot/named/usr/sbin'
 'DESTMAN=/usr/man'
 'DESTHELP=/usr/lib'
 'DESTETC=/etc'
 'DESTRUN=/chroot/named/var/run'
 'DESTLIB=/usr/lib/bind/lib'
 'DESTINC=/usr/lib/bind/include'
 'LEX=flex -8 -I'
 'YACC=yacc -d'
 'SYSLIBS=-lfl'
 'INSTALL=install'
 'MANDIR=man'
 'MANROFF=cat'
 'CATEXT=$$N'
 'PS=ps p'
 'AR=ar crus'
 'RANLIB=:'
  </PRE
></TD
></TR
></TABLE
>
  </P
></LI
><LI
><P
>&#13; The difference between the Makefile we used before and this one is that we modify the <TT
CLASS="envar"
>DESTSBIN=</TT
>, <TT
CLASS="envar"
>DESTEXEC=</TT
>, and <TT
CLASS="envar"
>DESTRUN=</TT
> lines to point to the chrooted directory 
 of <SPAN
CLASS="acronym"
>BIND</SPAN
>/<SPAN
CLASS="acronym"
>DNS</SPAN
>. With this modification, the <B
CLASS="command"
>ndc</B
> program knows where to find <TT
CLASS="literal"
>named</TT
>.
 <TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="screen"
> 
 [root@deep ]/src# <B
CLASS="command"
>make clean</B
>
 [root@deep ]/src# <B
CLASS="command"
>make</B
>
 [root@deep ]/src# <B
CLASS="command"
>cp</B
> bin/ndc/ndc /usr/sbin/
 [root@deep ]/src# <B
CLASS="command"
>cp</B
>: overwrite `/usr/sbin/ndc'? y
 [root@deep ]/src# <B
CLASS="command"
>strip</B
> /usr/sbin/ndc 
 </PRE
></TD
></TR
></TABLE
>
 We build the binary file, then copy the result of ndc program to <TT
CLASS="filename"
>/usr/sbin</TT
> and overwrite the old one. We dont forget to strip our new ndc binary for better performance.
 </P
></LI
></OL
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="chap21sec167.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="chap21sec169.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Run <SPAN
CLASS="acronym"
>ISC</SPAN
>  <SPAN
CLASS="acronym"
>BIND</SPAN
>/<SPAN
CLASS="acronym"
>DNS</SPAN
> in a chroot jail</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="soft-netwrkng.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Clean-up and Test the new chrooted jail</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>